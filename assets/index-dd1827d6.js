(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const u of document.querySelectorAll('link[rel="modulepreload"]'))i(u);new MutationObserver(u=>{for(const h of u)if(h.type==="childList")for(const d of h.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&i(d)}).observe(document,{childList:!0,subtree:!0});function n(u){const h={};return u.integrity&&(h.integrity=u.integrity),u.referrerPolicy&&(h.referrerPolicy=u.referrerPolicy),u.crossOrigin==="use-credentials"?h.credentials="include":u.crossOrigin==="anonymous"?h.credentials="omit":h.credentials="same-origin",h}function i(u){if(u.ep)return;u.ep=!0;const h=n(u);fetch(u.href,h)}})();var GM=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function gE(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function _E(t){if(t.__esModule)return t;var e=t.default;if(typeof e=="function"){var n=function i(){return this instanceof i?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};n.prototype=e.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(t).forEach(function(i){var u=Object.getOwnPropertyDescriptor(t,i);Object.defineProperty(n,i,u.get?u:{enumerable:!0,get:function(){return t[i]}})}),n}var qM={exports:{}},ox={},XM={exports:{}},Cn={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var L_=Symbol.for("react.element"),mk=Symbol.for("react.portal"),gk=Symbol.for("react.fragment"),_k=Symbol.for("react.strict_mode"),yk=Symbol.for("react.profiler"),vk=Symbol.for("react.provider"),xk=Symbol.for("react.context"),wk=Symbol.for("react.forward_ref"),bk=Symbol.for("react.suspense"),Ek=Symbol.for("react.memo"),Sk=Symbol.for("react.lazy"),TI=Symbol.iterator;function Tk(t){return t===null||typeof t!="object"?null:(t=TI&&t[TI]||t["@@iterator"],typeof t=="function"?t:null)}var $M={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},ZM=Object.assign,WM={};function Rd(t,e,n){this.props=t,this.context=e,this.refs=WM,this.updater=n||$M}Rd.prototype.isReactComponent={};Rd.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};Rd.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function HM(){}HM.prototype=Rd.prototype;function yE(t,e,n){this.props=t,this.context=e,this.refs=WM,this.updater=n||$M}var vE=yE.prototype=new HM;vE.constructor=yE;ZM(vE,Rd.prototype);vE.isPureReactComponent=!0;var CI=Array.isArray,YM=Object.prototype.hasOwnProperty,xE={current:null},KM={key:!0,ref:!0,__self:!0,__source:!0};function JM(t,e,n){var i,u={},h=null,d=null;if(e!=null)for(i in e.ref!==void 0&&(d=e.ref),e.key!==void 0&&(h=""+e.key),e)YM.call(e,i)&&!KM.hasOwnProperty(i)&&(u[i]=e[i]);var s=arguments.length-2;if(s===1)u.children=n;else if(1<s){for(var w=Array(s),T=0;T<s;T++)w[T]=arguments[T+2];u.children=w}if(t&&t.defaultProps)for(i in s=t.defaultProps,s)u[i]===void 0&&(u[i]=s[i]);return{$$typeof:L_,type:t,key:h,ref:d,props:u,_owner:xE.current}}function Ck(t,e){return{$$typeof:L_,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function wE(t){return typeof t=="object"&&t!==null&&t.$$typeof===L_}function Ik(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var II=/\/+/g;function _w(t,e){return typeof t=="object"&&t!==null&&t.key!=null?Ik(""+t.key):e.toString(36)}function Zv(t,e,n,i,u){var h=typeof t;(h==="undefined"||h==="boolean")&&(t=null);var d=!1;if(t===null)d=!0;else switch(h){case"string":case"number":d=!0;break;case"object":switch(t.$$typeof){case L_:case mk:d=!0}}if(d)return d=t,u=u(d),t=i===""?"."+_w(d,0):i,CI(u)?(n="",t!=null&&(n=t.replace(II,"$&/")+"/"),Zv(u,e,n,"",function(T){return T})):u!=null&&(wE(u)&&(u=Ck(u,n+(!u.key||d&&d.key===u.key?"":(""+u.key).replace(II,"$&/")+"/")+t)),e.push(u)),1;if(d=0,i=i===""?".":i+":",CI(t))for(var s=0;s<t.length;s++){h=t[s];var w=i+_w(h,s);d+=Zv(h,e,n,w,u)}else if(w=Tk(t),typeof w=="function")for(t=w.call(t),s=0;!(h=t.next()).done;)h=h.value,w=i+_w(h,s++),d+=Zv(h,e,n,w,u);else if(h==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return d}function yv(t,e,n){if(t==null)return t;var i=[],u=0;return Zv(t,i,"","",function(h){return e.call(n,h,u++)}),i}function Mk(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var Mo={current:null},Wv={transition:null},Ak={ReactCurrentDispatcher:Mo,ReactCurrentBatchConfig:Wv,ReactCurrentOwner:xE};Cn.Children={map:yv,forEach:function(t,e,n){yv(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return yv(t,function(){e++}),e},toArray:function(t){return yv(t,function(e){return e})||[]},only:function(t){if(!wE(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};Cn.Component=Rd;Cn.Fragment=gk;Cn.Profiler=yk;Cn.PureComponent=yE;Cn.StrictMode=_k;Cn.Suspense=bk;Cn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Ak;Cn.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var i=ZM({},t.props),u=t.key,h=t.ref,d=t._owner;if(e!=null){if(e.ref!==void 0&&(h=e.ref,d=xE.current),e.key!==void 0&&(u=""+e.key),t.type&&t.type.defaultProps)var s=t.type.defaultProps;for(w in e)YM.call(e,w)&&!KM.hasOwnProperty(w)&&(i[w]=e[w]===void 0&&s!==void 0?s[w]:e[w])}var w=arguments.length-2;if(w===1)i.children=n;else if(1<w){s=Array(w);for(var T=0;T<w;T++)s[T]=arguments[T+2];i.children=s}return{$$typeof:L_,type:t.type,key:u,ref:h,props:i,_owner:d}};Cn.createContext=function(t){return t={$$typeof:xk,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:vk,_context:t},t.Consumer=t};Cn.createElement=JM;Cn.createFactory=function(t){var e=JM.bind(null,t);return e.type=t,e};Cn.createRef=function(){return{current:null}};Cn.forwardRef=function(t){return{$$typeof:wk,render:t}};Cn.isValidElement=wE;Cn.lazy=function(t){return{$$typeof:Sk,_payload:{_status:-1,_result:t},_init:Mk}};Cn.memo=function(t,e){return{$$typeof:Ek,type:t,compare:e===void 0?null:e}};Cn.startTransition=function(t){var e=Wv.transition;Wv.transition={};try{t()}finally{Wv.transition=e}};Cn.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")};Cn.useCallback=function(t,e){return Mo.current.useCallback(t,e)};Cn.useContext=function(t){return Mo.current.useContext(t)};Cn.useDebugValue=function(){};Cn.useDeferredValue=function(t){return Mo.current.useDeferredValue(t)};Cn.useEffect=function(t,e){return Mo.current.useEffect(t,e)};Cn.useId=function(){return Mo.current.useId()};Cn.useImperativeHandle=function(t,e,n){return Mo.current.useImperativeHandle(t,e,n)};Cn.useInsertionEffect=function(t,e){return Mo.current.useInsertionEffect(t,e)};Cn.useLayoutEffect=function(t,e){return Mo.current.useLayoutEffect(t,e)};Cn.useMemo=function(t,e){return Mo.current.useMemo(t,e)};Cn.useReducer=function(t,e,n){return Mo.current.useReducer(t,e,n)};Cn.useRef=function(t){return Mo.current.useRef(t)};Cn.useState=function(t){return Mo.current.useState(t)};Cn.useSyncExternalStore=function(t,e,n){return Mo.current.useSyncExternalStore(t,e,n)};Cn.useTransition=function(){return Mo.current.useTransition()};Cn.version="18.2.0";XM.exports=Cn;var Mn=XM.exports;const hs=gE(Mn);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Pk=Mn,Lk=Symbol.for("react.element"),Dk=Symbol.for("react.fragment"),Rk=Object.prototype.hasOwnProperty,Nk=Pk.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,kk={key:!0,ref:!0,__self:!0,__source:!0};function QM(t,e,n){var i,u={},h=null,d=null;n!==void 0&&(h=""+n),e.key!==void 0&&(h=""+e.key),e.ref!==void 0&&(d=e.ref);for(i in e)Rk.call(e,i)&&!kk.hasOwnProperty(i)&&(u[i]=e[i]);if(t&&t.defaultProps)for(i in e=t.defaultProps,e)u[i]===void 0&&(u[i]=e[i]);return{$$typeof:Lk,type:t,key:h,ref:d,props:u,_owner:Nk.current}}ox.Fragment=Dk;ox.jsx=QM;ox.jsxs=QM;qM.exports=ox;var pt=qM.exports,tb={},eA={exports:{}},Is={},tA={exports:{}},nA={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(qe,Et){var Ct=qe.length;qe.push(Et);e:for(;0<Ct;){var kt=Ct-1>>>1,Vt=qe[kt];if(0<u(Vt,Et))qe[kt]=Et,qe[Ct]=Vt,Ct=kt;else break e}}function n(qe){return qe.length===0?null:qe[0]}function i(qe){if(qe.length===0)return null;var Et=qe[0],Ct=qe.pop();if(Ct!==Et){qe[0]=Ct;e:for(var kt=0,Vt=qe.length,hn=Vt>>>1;kt<hn;){var tr=2*(kt+1)-1,Wn=qe[tr],Gr=tr+1,Kr=qe[Gr];if(0>u(Wn,Ct))Gr<Vt&&0>u(Kr,Wn)?(qe[kt]=Kr,qe[Gr]=Ct,kt=Gr):(qe[kt]=Wn,qe[tr]=Ct,kt=tr);else if(Gr<Vt&&0>u(Kr,Ct))qe[kt]=Kr,qe[Gr]=Ct,kt=Gr;else break e}}return Et}function u(qe,Et){var Ct=qe.sortIndex-Et.sortIndex;return Ct!==0?Ct:qe.id-Et.id}if(typeof performance=="object"&&typeof performance.now=="function"){var h=performance;t.unstable_now=function(){return h.now()}}else{var d=Date,s=d.now();t.unstable_now=function(){return d.now()-s}}var w=[],T=[],A=1,D=null,R=3,G=!1,$=!1,ie=!1,_e=typeof setTimeout=="function"?setTimeout:null,Y=typeof clearTimeout=="function"?clearTimeout:null,B=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function q(qe){for(var Et=n(T);Et!==null;){if(Et.callback===null)i(T);else if(Et.startTime<=qe)i(T),Et.sortIndex=Et.expirationTime,e(w,Et);else break;Et=n(T)}}function oe(qe){if(ie=!1,q(qe),!$)if(n(w)!==null)$=!0,Bt(de);else{var Et=n(T);Et!==null&&Zt(oe,Et.startTime-qe)}}function de(qe,Et){$=!1,ie&&(ie=!1,Y(Te),Te=-1),G=!0;var Ct=R;try{for(q(Et),D=n(w);D!==null&&(!(D.expirationTime>Et)||qe&&!We());){var kt=D.callback;if(typeof kt=="function"){D.callback=null,R=D.priorityLevel;var Vt=kt(D.expirationTime<=Et);Et=t.unstable_now(),typeof Vt=="function"?D.callback=Vt:D===n(w)&&i(w),q(Et)}else i(w);D=n(w)}if(D!==null)var hn=!0;else{var tr=n(T);tr!==null&&Zt(oe,tr.startTime-Et),hn=!1}return hn}finally{D=null,R=Ct,G=!1}}var we=!1,Se=null,Te=-1,xe=5,et=-1;function We(){return!(t.unstable_now()-et<xe)}function He(){if(Se!==null){var qe=t.unstable_now();et=qe;var Et=!0;try{Et=Se(!0,qe)}finally{Et?$e():(we=!1,Se=null)}}else we=!1}var $e;if(typeof B=="function")$e=function(){B(He)};else if(typeof MessageChannel<"u"){var ze=new MessageChannel,Pt=ze.port2;ze.port1.onmessage=He,$e=function(){Pt.postMessage(null)}}else $e=function(){_e(He,0)};function Bt(qe){Se=qe,we||(we=!0,$e())}function Zt(qe,Et){Te=_e(function(){qe(t.unstable_now())},Et)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(qe){qe.callback=null},t.unstable_continueExecution=function(){$||G||($=!0,Bt(de))},t.unstable_forceFrameRate=function(qe){0>qe||125<qe?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):xe=0<qe?Math.floor(1e3/qe):5},t.unstable_getCurrentPriorityLevel=function(){return R},t.unstable_getFirstCallbackNode=function(){return n(w)},t.unstable_next=function(qe){switch(R){case 1:case 2:case 3:var Et=3;break;default:Et=R}var Ct=R;R=Et;try{return qe()}finally{R=Ct}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(qe,Et){switch(qe){case 1:case 2:case 3:case 4:case 5:break;default:qe=3}var Ct=R;R=qe;try{return Et()}finally{R=Ct}},t.unstable_scheduleCallback=function(qe,Et,Ct){var kt=t.unstable_now();switch(typeof Ct=="object"&&Ct!==null?(Ct=Ct.delay,Ct=typeof Ct=="number"&&0<Ct?kt+Ct:kt):Ct=kt,qe){case 1:var Vt=-1;break;case 2:Vt=250;break;case 5:Vt=1073741823;break;case 4:Vt=1e4;break;default:Vt=5e3}return Vt=Ct+Vt,qe={id:A++,callback:Et,priorityLevel:qe,startTime:Ct,expirationTime:Vt,sortIndex:-1},Ct>kt?(qe.sortIndex=Ct,e(T,qe),n(w)===null&&qe===n(T)&&(ie?(Y(Te),Te=-1):ie=!0,Zt(oe,Ct-kt))):(qe.sortIndex=Vt,e(w,qe),$||G||($=!0,Bt(de))),qe},t.unstable_shouldYield=We,t.unstable_wrapCallback=function(qe){var Et=R;return function(){var Ct=R;R=Et;try{return qe.apply(this,arguments)}finally{R=Ct}}}})(nA);tA.exports=nA;var Ok=tA.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var rA=Mn,_s=Ok;function dt(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var iA=new Set,Wg={};function Ef(t,e){td(t,e),td(t+"Capture",e)}function td(t,e){for(Wg[t]=e,t=0;t<e.length;t++)iA.add(e[t])}var xu=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),nb=Object.prototype.hasOwnProperty,zk=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,MI={},AI={};function Fk(t){return nb.call(AI,t)?!0:nb.call(MI,t)?!1:zk.test(t)?AI[t]=!0:(MI[t]=!0,!1)}function Bk(t,e,n,i){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return i?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function Uk(t,e,n,i){if(e===null||typeof e>"u"||Bk(t,e,n,i))return!0;if(i)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function Ao(t,e,n,i,u,h,d){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=i,this.attributeNamespace=u,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=h,this.removeEmptyString=d}var qi={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){qi[t]=new Ao(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];qi[e]=new Ao(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){qi[t]=new Ao(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){qi[t]=new Ao(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){qi[t]=new Ao(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){qi[t]=new Ao(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){qi[t]=new Ao(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){qi[t]=new Ao(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){qi[t]=new Ao(t,5,!1,t.toLowerCase(),null,!1,!1)});var bE=/[\-:]([a-z])/g;function EE(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(bE,EE);qi[e]=new Ao(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(bE,EE);qi[e]=new Ao(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(bE,EE);qi[e]=new Ao(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){qi[t]=new Ao(t,1,!1,t.toLowerCase(),null,!1,!1)});qi.xlinkHref=new Ao("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){qi[t]=new Ao(t,1,!1,t.toLowerCase(),null,!0,!0)});function SE(t,e,n,i){var u=qi.hasOwnProperty(e)?qi[e]:null;(u!==null?u.type!==0:i||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(Uk(e,n,u,i)&&(n=null),i||u===null?Fk(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):u.mustUseProperty?t[u.propertyName]=n===null?u.type===3?!1:"":n:(e=u.attributeName,i=u.attributeNamespace,n===null?t.removeAttribute(e):(u=u.type,n=u===3||u===4&&n===!0?"":""+n,i?t.setAttributeNS(i,e,n):t.setAttribute(e,n))))}var ku=rA.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,vv=Symbol.for("react.element"),Rp=Symbol.for("react.portal"),Np=Symbol.for("react.fragment"),TE=Symbol.for("react.strict_mode"),rb=Symbol.for("react.profiler"),oA=Symbol.for("react.provider"),sA=Symbol.for("react.context"),CE=Symbol.for("react.forward_ref"),ib=Symbol.for("react.suspense"),ob=Symbol.for("react.suspense_list"),IE=Symbol.for("react.memo"),xc=Symbol.for("react.lazy"),aA=Symbol.for("react.offscreen"),PI=Symbol.iterator;function vg(t){return t===null||typeof t!="object"?null:(t=PI&&t[PI]||t["@@iterator"],typeof t=="function"?t:null)}var Vr=Object.assign,yw;function Pg(t){if(yw===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);yw=e&&e[1]||""}return`
`+yw+t}var vw=!1;function xw(t,e){if(!t||vw)return"";vw=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(T){var i=T}Reflect.construct(t,[],e)}else{try{e.call()}catch(T){i=T}t.call(e.prototype)}else{try{throw Error()}catch(T){i=T}t()}}catch(T){if(T&&i&&typeof T.stack=="string"){for(var u=T.stack.split(`
`),h=i.stack.split(`
`),d=u.length-1,s=h.length-1;1<=d&&0<=s&&u[d]!==h[s];)s--;for(;1<=d&&0<=s;d--,s--)if(u[d]!==h[s]){if(d!==1||s!==1)do if(d--,s--,0>s||u[d]!==h[s]){var w=`
`+u[d].replace(" at new "," at ");return t.displayName&&w.includes("<anonymous>")&&(w=w.replace("<anonymous>",t.displayName)),w}while(1<=d&&0<=s);break}}}finally{vw=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?Pg(t):""}function Vk(t){switch(t.tag){case 5:return Pg(t.type);case 16:return Pg("Lazy");case 13:return Pg("Suspense");case 19:return Pg("SuspenseList");case 0:case 2:case 15:return t=xw(t.type,!1),t;case 11:return t=xw(t.type.render,!1),t;case 1:return t=xw(t.type,!0),t;default:return""}}function sb(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case Np:return"Fragment";case Rp:return"Portal";case rb:return"Profiler";case TE:return"StrictMode";case ib:return"Suspense";case ob:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case sA:return(t.displayName||"Context")+".Consumer";case oA:return(t._context.displayName||"Context")+".Provider";case CE:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case IE:return e=t.displayName||null,e!==null?e:sb(t.type)||"Memo";case xc:e=t._payload,t=t._init;try{return sb(t(e))}catch{}}return null}function jk(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return sb(e);case 8:return e===TE?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function Oc(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function lA(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function Gk(t){var e=lA(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),i=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var u=n.get,h=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return u.call(this)},set:function(d){i=""+d,h.call(this,d)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return i},setValue:function(d){i=""+d},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function xv(t){t._valueTracker||(t._valueTracker=Gk(t))}function uA(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),i="";return t&&(i=lA(t)?t.checked?"true":"false":t.value),t=i,t!==n?(e.setValue(t),!0):!1}function f0(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function ab(t,e){var n=e.checked;return Vr({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??t._wrapperState.initialChecked})}function LI(t,e){var n=e.defaultValue==null?"":e.defaultValue,i=e.checked!=null?e.checked:e.defaultChecked;n=Oc(e.value!=null?e.value:n),t._wrapperState={initialChecked:i,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function cA(t,e){e=e.checked,e!=null&&SE(t,"checked",e,!1)}function lb(t,e){cA(t,e);var n=Oc(e.value),i=e.type;if(n!=null)i==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(i==="submit"||i==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?ub(t,e.type,n):e.hasOwnProperty("defaultValue")&&ub(t,e.type,Oc(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function DI(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var i=e.type;if(!(i!=="submit"&&i!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function ub(t,e,n){(e!=="number"||f0(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var Lg=Array.isArray;function Wp(t,e,n,i){if(t=t.options,e){e={};for(var u=0;u<n.length;u++)e["$"+n[u]]=!0;for(n=0;n<t.length;n++)u=e.hasOwnProperty("$"+t[n].value),t[n].selected!==u&&(t[n].selected=u),u&&i&&(t[n].defaultSelected=!0)}else{for(n=""+Oc(n),e=null,u=0;u<t.length;u++){if(t[u].value===n){t[u].selected=!0,i&&(t[u].defaultSelected=!0);return}e!==null||t[u].disabled||(e=t[u])}e!==null&&(e.selected=!0)}}function cb(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(dt(91));return Vr({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function RI(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(dt(92));if(Lg(n)){if(1<n.length)throw Error(dt(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:Oc(n)}}function hA(t,e){var n=Oc(e.value),i=Oc(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),i!=null&&(t.defaultValue=""+i)}function NI(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function fA(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function hb(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?fA(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var wv,pA=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,n,i,u){MSApp.execUnsafeLocalFunction(function(){return t(e,n,i,u)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(wv=wv||document.createElement("div"),wv.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=wv.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function Hg(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var Bg={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},qk=["Webkit","ms","Moz","O"];Object.keys(Bg).forEach(function(t){qk.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),Bg[e]=Bg[t]})});function dA(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||Bg.hasOwnProperty(t)&&Bg[t]?(""+e).trim():e+"px"}function mA(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var i=n.indexOf("--")===0,u=dA(n,e[n],i);n==="float"&&(n="cssFloat"),i?t.setProperty(n,u):t[n]=u}}var Xk=Vr({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function fb(t,e){if(e){if(Xk[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(dt(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(dt(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(dt(61))}if(e.style!=null&&typeof e.style!="object")throw Error(dt(62))}}function pb(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var db=null;function ME(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var mb=null,Hp=null,Yp=null;function kI(t){if(t=N_(t)){if(typeof mb!="function")throw Error(dt(280));var e=t.stateNode;e&&(e=cx(e),mb(t.stateNode,t.type,e))}}function gA(t){Hp?Yp?Yp.push(t):Yp=[t]:Hp=t}function _A(){if(Hp){var t=Hp,e=Yp;if(Yp=Hp=null,kI(t),e)for(t=0;t<e.length;t++)kI(e[t])}}function yA(t,e){return t(e)}function vA(){}var ww=!1;function xA(t,e,n){if(ww)return t(e,n);ww=!0;try{return yA(t,e,n)}finally{ww=!1,(Hp!==null||Yp!==null)&&(vA(),_A())}}function Yg(t,e){var n=t.stateNode;if(n===null)return null;var i=cx(n);if(i===null)return null;n=i[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(i=!i.disabled)||(t=t.type,i=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!i;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(dt(231,e,typeof n));return n}var gb=!1;if(xu)try{var xg={};Object.defineProperty(xg,"passive",{get:function(){gb=!0}}),window.addEventListener("test",xg,xg),window.removeEventListener("test",xg,xg)}catch{gb=!1}function $k(t,e,n,i,u,h,d,s,w){var T=Array.prototype.slice.call(arguments,3);try{e.apply(n,T)}catch(A){this.onError(A)}}var Ug=!1,p0=null,d0=!1,_b=null,Zk={onError:function(t){Ug=!0,p0=t}};function Wk(t,e,n,i,u,h,d,s,w){Ug=!1,p0=null,$k.apply(Zk,arguments)}function Hk(t,e,n,i,u,h,d,s,w){if(Wk.apply(this,arguments),Ug){if(Ug){var T=p0;Ug=!1,p0=null}else throw Error(dt(198));d0||(d0=!0,_b=T)}}function Sf(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function wA(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function OI(t){if(Sf(t)!==t)throw Error(dt(188))}function Yk(t){var e=t.alternate;if(!e){if(e=Sf(t),e===null)throw Error(dt(188));return e!==t?null:t}for(var n=t,i=e;;){var u=n.return;if(u===null)break;var h=u.alternate;if(h===null){if(i=u.return,i!==null){n=i;continue}break}if(u.child===h.child){for(h=u.child;h;){if(h===n)return OI(u),t;if(h===i)return OI(u),e;h=h.sibling}throw Error(dt(188))}if(n.return!==i.return)n=u,i=h;else{for(var d=!1,s=u.child;s;){if(s===n){d=!0,n=u,i=h;break}if(s===i){d=!0,i=u,n=h;break}s=s.sibling}if(!d){for(s=h.child;s;){if(s===n){d=!0,n=h,i=u;break}if(s===i){d=!0,i=h,n=u;break}s=s.sibling}if(!d)throw Error(dt(189))}}if(n.alternate!==i)throw Error(dt(190))}if(n.tag!==3)throw Error(dt(188));return n.stateNode.current===n?t:e}function bA(t){return t=Yk(t),t!==null?EA(t):null}function EA(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=EA(t);if(e!==null)return e;t=t.sibling}return null}var SA=_s.unstable_scheduleCallback,zI=_s.unstable_cancelCallback,Kk=_s.unstable_shouldYield,Jk=_s.unstable_requestPaint,Zr=_s.unstable_now,Qk=_s.unstable_getCurrentPriorityLevel,AE=_s.unstable_ImmediatePriority,TA=_s.unstable_UserBlockingPriority,m0=_s.unstable_NormalPriority,eO=_s.unstable_LowPriority,CA=_s.unstable_IdlePriority,sx=null,Pl=null;function tO(t){if(Pl&&typeof Pl.onCommitFiberRoot=="function")try{Pl.onCommitFiberRoot(sx,t,void 0,(t.current.flags&128)===128)}catch{}}var ja=Math.clz32?Math.clz32:iO,nO=Math.log,rO=Math.LN2;function iO(t){return t>>>=0,t===0?32:31-(nO(t)/rO|0)|0}var bv=64,Ev=4194304;function Dg(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function g0(t,e){var n=t.pendingLanes;if(n===0)return 0;var i=0,u=t.suspendedLanes,h=t.pingedLanes,d=n&268435455;if(d!==0){var s=d&~u;s!==0?i=Dg(s):(h&=d,h!==0&&(i=Dg(h)))}else d=n&~u,d!==0?i=Dg(d):h!==0&&(i=Dg(h));if(i===0)return 0;if(e!==0&&e!==i&&!(e&u)&&(u=i&-i,h=e&-e,u>=h||u===16&&(h&4194240)!==0))return e;if(i&4&&(i|=n&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=i;0<e;)n=31-ja(e),u=1<<n,i|=t[n],e&=~u;return i}function oO(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function sO(t,e){for(var n=t.suspendedLanes,i=t.pingedLanes,u=t.expirationTimes,h=t.pendingLanes;0<h;){var d=31-ja(h),s=1<<d,w=u[d];w===-1?(!(s&n)||s&i)&&(u[d]=oO(s,e)):w<=e&&(t.expiredLanes|=s),h&=~s}}function yb(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function IA(){var t=bv;return bv<<=1,!(bv&4194240)&&(bv=64),t}function bw(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function D_(t,e,n){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-ja(e),t[e]=n}function aO(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var i=t.eventTimes;for(t=t.expirationTimes;0<n;){var u=31-ja(n),h=1<<u;e[u]=0,i[u]=-1,t[u]=-1,n&=~h}}function PE(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var i=31-ja(n),u=1<<i;u&e|t[i]&e&&(t[i]|=e),n&=~u}}var Yn=0;function MA(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var AA,LE,PA,LA,DA,vb=!1,Sv=[],Cc=null,Ic=null,Mc=null,Kg=new Map,Jg=new Map,bc=[],lO="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function FI(t,e){switch(t){case"focusin":case"focusout":Cc=null;break;case"dragenter":case"dragleave":Ic=null;break;case"mouseover":case"mouseout":Mc=null;break;case"pointerover":case"pointerout":Kg.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":Jg.delete(e.pointerId)}}function wg(t,e,n,i,u,h){return t===null||t.nativeEvent!==h?(t={blockedOn:e,domEventName:n,eventSystemFlags:i,nativeEvent:h,targetContainers:[u]},e!==null&&(e=N_(e),e!==null&&LE(e)),t):(t.eventSystemFlags|=i,e=t.targetContainers,u!==null&&e.indexOf(u)===-1&&e.push(u),t)}function uO(t,e,n,i,u){switch(e){case"focusin":return Cc=wg(Cc,t,e,n,i,u),!0;case"dragenter":return Ic=wg(Ic,t,e,n,i,u),!0;case"mouseover":return Mc=wg(Mc,t,e,n,i,u),!0;case"pointerover":var h=u.pointerId;return Kg.set(h,wg(Kg.get(h)||null,t,e,n,i,u)),!0;case"gotpointercapture":return h=u.pointerId,Jg.set(h,wg(Jg.get(h)||null,t,e,n,i,u)),!0}return!1}function RA(t){var e=Hh(t.target);if(e!==null){var n=Sf(e);if(n!==null){if(e=n.tag,e===13){if(e=wA(n),e!==null){t.blockedOn=e,DA(t.priority,function(){PA(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function Hv(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=xb(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var i=new n.constructor(n.type,n);db=i,n.target.dispatchEvent(i),db=null}else return e=N_(n),e!==null&&LE(e),t.blockedOn=n,!1;e.shift()}return!0}function BI(t,e,n){Hv(t)&&n.delete(e)}function cO(){vb=!1,Cc!==null&&Hv(Cc)&&(Cc=null),Ic!==null&&Hv(Ic)&&(Ic=null),Mc!==null&&Hv(Mc)&&(Mc=null),Kg.forEach(BI),Jg.forEach(BI)}function bg(t,e){t.blockedOn===e&&(t.blockedOn=null,vb||(vb=!0,_s.unstable_scheduleCallback(_s.unstable_NormalPriority,cO)))}function Qg(t){function e(u){return bg(u,t)}if(0<Sv.length){bg(Sv[0],t);for(var n=1;n<Sv.length;n++){var i=Sv[n];i.blockedOn===t&&(i.blockedOn=null)}}for(Cc!==null&&bg(Cc,t),Ic!==null&&bg(Ic,t),Mc!==null&&bg(Mc,t),Kg.forEach(e),Jg.forEach(e),n=0;n<bc.length;n++)i=bc[n],i.blockedOn===t&&(i.blockedOn=null);for(;0<bc.length&&(n=bc[0],n.blockedOn===null);)RA(n),n.blockedOn===null&&bc.shift()}var Kp=ku.ReactCurrentBatchConfig,_0=!0;function hO(t,e,n,i){var u=Yn,h=Kp.transition;Kp.transition=null;try{Yn=1,DE(t,e,n,i)}finally{Yn=u,Kp.transition=h}}function fO(t,e,n,i){var u=Yn,h=Kp.transition;Kp.transition=null;try{Yn=4,DE(t,e,n,i)}finally{Yn=u,Kp.transition=h}}function DE(t,e,n,i){if(_0){var u=xb(t,e,n,i);if(u===null)Dw(t,e,i,y0,n),FI(t,i);else if(uO(u,t,e,n,i))i.stopPropagation();else if(FI(t,i),e&4&&-1<lO.indexOf(t)){for(;u!==null;){var h=N_(u);if(h!==null&&AA(h),h=xb(t,e,n,i),h===null&&Dw(t,e,i,y0,n),h===u)break;u=h}u!==null&&i.stopPropagation()}else Dw(t,e,i,null,n)}}var y0=null;function xb(t,e,n,i){if(y0=null,t=ME(i),t=Hh(t),t!==null)if(e=Sf(t),e===null)t=null;else if(n=e.tag,n===13){if(t=wA(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return y0=t,null}function NA(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Qk()){case AE:return 1;case TA:return 4;case m0:case eO:return 16;case CA:return 536870912;default:return 16}default:return 16}}var Sc=null,RE=null,Yv=null;function kA(){if(Yv)return Yv;var t,e=RE,n=e.length,i,u="value"in Sc?Sc.value:Sc.textContent,h=u.length;for(t=0;t<n&&e[t]===u[t];t++);var d=n-t;for(i=1;i<=d&&e[n-i]===u[h-i];i++);return Yv=u.slice(t,1<i?1-i:void 0)}function Kv(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function Tv(){return!0}function UI(){return!1}function Ms(t){function e(n,i,u,h,d){this._reactName=n,this._targetInst=u,this.type=i,this.nativeEvent=h,this.target=d,this.currentTarget=null;for(var s in t)t.hasOwnProperty(s)&&(n=t[s],this[s]=n?n(h):h[s]);return this.isDefaultPrevented=(h.defaultPrevented!=null?h.defaultPrevented:h.returnValue===!1)?Tv:UI,this.isPropagationStopped=UI,this}return Vr(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=Tv)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=Tv)},persist:function(){},isPersistent:Tv}),e}var Nd={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},NE=Ms(Nd),R_=Vr({},Nd,{view:0,detail:0}),pO=Ms(R_),Ew,Sw,Eg,ax=Vr({},R_,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:kE,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==Eg&&(Eg&&t.type==="mousemove"?(Ew=t.screenX-Eg.screenX,Sw=t.screenY-Eg.screenY):Sw=Ew=0,Eg=t),Ew)},movementY:function(t){return"movementY"in t?t.movementY:Sw}}),VI=Ms(ax),dO=Vr({},ax,{dataTransfer:0}),mO=Ms(dO),gO=Vr({},R_,{relatedTarget:0}),Tw=Ms(gO),_O=Vr({},Nd,{animationName:0,elapsedTime:0,pseudoElement:0}),yO=Ms(_O),vO=Vr({},Nd,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),xO=Ms(vO),wO=Vr({},Nd,{data:0}),jI=Ms(wO),bO={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},EO={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},SO={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function TO(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=SO[t])?!!e[t]:!1}function kE(){return TO}var CO=Vr({},R_,{key:function(t){if(t.key){var e=bO[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=Kv(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?EO[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:kE,charCode:function(t){return t.type==="keypress"?Kv(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?Kv(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),IO=Ms(CO),MO=Vr({},ax,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),GI=Ms(MO),AO=Vr({},R_,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:kE}),PO=Ms(AO),LO=Vr({},Nd,{propertyName:0,elapsedTime:0,pseudoElement:0}),DO=Ms(LO),RO=Vr({},ax,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),NO=Ms(RO),kO=[9,13,27,32],OE=xu&&"CompositionEvent"in window,Vg=null;xu&&"documentMode"in document&&(Vg=document.documentMode);var OO=xu&&"TextEvent"in window&&!Vg,OA=xu&&(!OE||Vg&&8<Vg&&11>=Vg),qI=String.fromCharCode(32),XI=!1;function zA(t,e){switch(t){case"keyup":return kO.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function FA(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var kp=!1;function zO(t,e){switch(t){case"compositionend":return FA(e);case"keypress":return e.which!==32?null:(XI=!0,qI);case"textInput":return t=e.data,t===qI&&XI?null:t;default:return null}}function FO(t,e){if(kp)return t==="compositionend"||!OE&&zA(t,e)?(t=kA(),Yv=RE=Sc=null,kp=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return OA&&e.locale!=="ko"?null:e.data;default:return null}}var BO={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function $I(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!BO[t.type]:e==="textarea"}function BA(t,e,n,i){gA(i),e=v0(e,"onChange"),0<e.length&&(n=new NE("onChange","change",null,n,i),t.push({event:n,listeners:e}))}var jg=null,e_=null;function UO(t){YA(t,0)}function lx(t){var e=Fp(t);if(uA(e))return t}function VO(t,e){if(t==="change")return e}var UA=!1;if(xu){var Cw;if(xu){var Iw="oninput"in document;if(!Iw){var ZI=document.createElement("div");ZI.setAttribute("oninput","return;"),Iw=typeof ZI.oninput=="function"}Cw=Iw}else Cw=!1;UA=Cw&&(!document.documentMode||9<document.documentMode)}function WI(){jg&&(jg.detachEvent("onpropertychange",VA),e_=jg=null)}function VA(t){if(t.propertyName==="value"&&lx(e_)){var e=[];BA(e,e_,t,ME(t)),xA(UO,e)}}function jO(t,e,n){t==="focusin"?(WI(),jg=e,e_=n,jg.attachEvent("onpropertychange",VA)):t==="focusout"&&WI()}function GO(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return lx(e_)}function qO(t,e){if(t==="click")return lx(e)}function XO(t,e){if(t==="input"||t==="change")return lx(e)}function $O(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var $a=typeof Object.is=="function"?Object.is:$O;function t_(t,e){if($a(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),i=Object.keys(e);if(n.length!==i.length)return!1;for(i=0;i<n.length;i++){var u=n[i];if(!nb.call(e,u)||!$a(t[u],e[u]))return!1}return!0}function HI(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function YI(t,e){var n=HI(t);t=0;for(var i;n;){if(n.nodeType===3){if(i=t+n.textContent.length,t<=e&&i>=e)return{node:n,offset:e-t};t=i}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=HI(n)}}function jA(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?jA(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function GA(){for(var t=window,e=f0();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=f0(t.document)}return e}function zE(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function ZO(t){var e=GA(),n=t.focusedElem,i=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&jA(n.ownerDocument.documentElement,n)){if(i!==null&&zE(n)){if(e=i.start,t=i.end,t===void 0&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if(t=(e=n.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var u=n.textContent.length,h=Math.min(i.start,u);i=i.end===void 0?h:Math.min(i.end,u),!t.extend&&h>i&&(u=i,i=h,h=u),u=YI(n,h);var d=YI(n,i);u&&d&&(t.rangeCount!==1||t.anchorNode!==u.node||t.anchorOffset!==u.offset||t.focusNode!==d.node||t.focusOffset!==d.offset)&&(e=e.createRange(),e.setStart(u.node,u.offset),t.removeAllRanges(),h>i?(t.addRange(e),t.extend(d.node,d.offset)):(e.setEnd(d.node,d.offset),t.addRange(e)))}}for(e=[],t=n;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)t=e[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var WO=xu&&"documentMode"in document&&11>=document.documentMode,Op=null,wb=null,Gg=null,bb=!1;function KI(t,e,n){var i=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;bb||Op==null||Op!==f0(i)||(i=Op,"selectionStart"in i&&zE(i)?i={start:i.selectionStart,end:i.selectionEnd}:(i=(i.ownerDocument&&i.ownerDocument.defaultView||window).getSelection(),i={anchorNode:i.anchorNode,anchorOffset:i.anchorOffset,focusNode:i.focusNode,focusOffset:i.focusOffset}),Gg&&t_(Gg,i)||(Gg=i,i=v0(wb,"onSelect"),0<i.length&&(e=new NE("onSelect","select",null,e,n),t.push({event:e,listeners:i}),e.target=Op)))}function Cv(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var zp={animationend:Cv("Animation","AnimationEnd"),animationiteration:Cv("Animation","AnimationIteration"),animationstart:Cv("Animation","AnimationStart"),transitionend:Cv("Transition","TransitionEnd")},Mw={},qA={};xu&&(qA=document.createElement("div").style,"AnimationEvent"in window||(delete zp.animationend.animation,delete zp.animationiteration.animation,delete zp.animationstart.animation),"TransitionEvent"in window||delete zp.transitionend.transition);function ux(t){if(Mw[t])return Mw[t];if(!zp[t])return t;var e=zp[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in qA)return Mw[t]=e[n];return t}var XA=ux("animationend"),$A=ux("animationiteration"),ZA=ux("animationstart"),WA=ux("transitionend"),HA=new Map,JI="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Zc(t,e){HA.set(t,e),Ef(e,[t])}for(var Aw=0;Aw<JI.length;Aw++){var Pw=JI[Aw],HO=Pw.toLowerCase(),YO=Pw[0].toUpperCase()+Pw.slice(1);Zc(HO,"on"+YO)}Zc(XA,"onAnimationEnd");Zc($A,"onAnimationIteration");Zc(ZA,"onAnimationStart");Zc("dblclick","onDoubleClick");Zc("focusin","onFocus");Zc("focusout","onBlur");Zc(WA,"onTransitionEnd");td("onMouseEnter",["mouseout","mouseover"]);td("onMouseLeave",["mouseout","mouseover"]);td("onPointerEnter",["pointerout","pointerover"]);td("onPointerLeave",["pointerout","pointerover"]);Ef("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Ef("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Ef("onBeforeInput",["compositionend","keypress","textInput","paste"]);Ef("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Ef("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Ef("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Rg="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),KO=new Set("cancel close invalid load scroll toggle".split(" ").concat(Rg));function QI(t,e,n){var i=t.type||"unknown-event";t.currentTarget=n,Hk(i,e,void 0,t),t.currentTarget=null}function YA(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var i=t[n],u=i.event;i=i.listeners;e:{var h=void 0;if(e)for(var d=i.length-1;0<=d;d--){var s=i[d],w=s.instance,T=s.currentTarget;if(s=s.listener,w!==h&&u.isPropagationStopped())break e;QI(u,s,T),h=w}else for(d=0;d<i.length;d++){if(s=i[d],w=s.instance,T=s.currentTarget,s=s.listener,w!==h&&u.isPropagationStopped())break e;QI(u,s,T),h=w}}}if(d0)throw t=_b,d0=!1,_b=null,t}function dr(t,e){var n=e[Ib];n===void 0&&(n=e[Ib]=new Set);var i=t+"__bubble";n.has(i)||(KA(e,t,2,!1),n.add(i))}function Lw(t,e,n){var i=0;e&&(i|=4),KA(n,t,i,e)}var Iv="_reactListening"+Math.random().toString(36).slice(2);function n_(t){if(!t[Iv]){t[Iv]=!0,iA.forEach(function(n){n!=="selectionchange"&&(KO.has(n)||Lw(n,!1,t),Lw(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[Iv]||(e[Iv]=!0,Lw("selectionchange",!1,e))}}function KA(t,e,n,i){switch(NA(e)){case 1:var u=hO;break;case 4:u=fO;break;default:u=DE}n=u.bind(null,e,n,t),u=void 0,!gb||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(u=!0),i?u!==void 0?t.addEventListener(e,n,{capture:!0,passive:u}):t.addEventListener(e,n,!0):u!==void 0?t.addEventListener(e,n,{passive:u}):t.addEventListener(e,n,!1)}function Dw(t,e,n,i,u){var h=i;if(!(e&1)&&!(e&2)&&i!==null)e:for(;;){if(i===null)return;var d=i.tag;if(d===3||d===4){var s=i.stateNode.containerInfo;if(s===u||s.nodeType===8&&s.parentNode===u)break;if(d===4)for(d=i.return;d!==null;){var w=d.tag;if((w===3||w===4)&&(w=d.stateNode.containerInfo,w===u||w.nodeType===8&&w.parentNode===u))return;d=d.return}for(;s!==null;){if(d=Hh(s),d===null)return;if(w=d.tag,w===5||w===6){i=h=d;continue e}s=s.parentNode}}i=i.return}xA(function(){var T=h,A=ME(n),D=[];e:{var R=HA.get(t);if(R!==void 0){var G=NE,$=t;switch(t){case"keypress":if(Kv(n)===0)break e;case"keydown":case"keyup":G=IO;break;case"focusin":$="focus",G=Tw;break;case"focusout":$="blur",G=Tw;break;case"beforeblur":case"afterblur":G=Tw;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":G=VI;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":G=mO;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":G=PO;break;case XA:case $A:case ZA:G=yO;break;case WA:G=DO;break;case"scroll":G=pO;break;case"wheel":G=NO;break;case"copy":case"cut":case"paste":G=xO;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":G=GI}var ie=(e&4)!==0,_e=!ie&&t==="scroll",Y=ie?R!==null?R+"Capture":null:R;ie=[];for(var B=T,q;B!==null;){q=B;var oe=q.stateNode;if(q.tag===5&&oe!==null&&(q=oe,Y!==null&&(oe=Yg(B,Y),oe!=null&&ie.push(r_(B,oe,q)))),_e)break;B=B.return}0<ie.length&&(R=new G(R,$,null,n,A),D.push({event:R,listeners:ie}))}}if(!(e&7)){e:{if(R=t==="mouseover"||t==="pointerover",G=t==="mouseout"||t==="pointerout",R&&n!==db&&($=n.relatedTarget||n.fromElement)&&(Hh($)||$[wu]))break e;if((G||R)&&(R=A.window===A?A:(R=A.ownerDocument)?R.defaultView||R.parentWindow:window,G?($=n.relatedTarget||n.toElement,G=T,$=$?Hh($):null,$!==null&&(_e=Sf($),$!==_e||$.tag!==5&&$.tag!==6)&&($=null)):(G=null,$=T),G!==$)){if(ie=VI,oe="onMouseLeave",Y="onMouseEnter",B="mouse",(t==="pointerout"||t==="pointerover")&&(ie=GI,oe="onPointerLeave",Y="onPointerEnter",B="pointer"),_e=G==null?R:Fp(G),q=$==null?R:Fp($),R=new ie(oe,B+"leave",G,n,A),R.target=_e,R.relatedTarget=q,oe=null,Hh(A)===T&&(ie=new ie(Y,B+"enter",$,n,A),ie.target=q,ie.relatedTarget=_e,oe=ie),_e=oe,G&&$)t:{for(ie=G,Y=$,B=0,q=ie;q;q=Lp(q))B++;for(q=0,oe=Y;oe;oe=Lp(oe))q++;for(;0<B-q;)ie=Lp(ie),B--;for(;0<q-B;)Y=Lp(Y),q--;for(;B--;){if(ie===Y||Y!==null&&ie===Y.alternate)break t;ie=Lp(ie),Y=Lp(Y)}ie=null}else ie=null;G!==null&&e2(D,R,G,ie,!1),$!==null&&_e!==null&&e2(D,_e,$,ie,!0)}}e:{if(R=T?Fp(T):window,G=R.nodeName&&R.nodeName.toLowerCase(),G==="select"||G==="input"&&R.type==="file")var de=VO;else if($I(R))if(UA)de=XO;else{de=GO;var we=jO}else(G=R.nodeName)&&G.toLowerCase()==="input"&&(R.type==="checkbox"||R.type==="radio")&&(de=qO);if(de&&(de=de(t,T))){BA(D,de,n,A);break e}we&&we(t,R,T),t==="focusout"&&(we=R._wrapperState)&&we.controlled&&R.type==="number"&&ub(R,"number",R.value)}switch(we=T?Fp(T):window,t){case"focusin":($I(we)||we.contentEditable==="true")&&(Op=we,wb=T,Gg=null);break;case"focusout":Gg=wb=Op=null;break;case"mousedown":bb=!0;break;case"contextmenu":case"mouseup":case"dragend":bb=!1,KI(D,n,A);break;case"selectionchange":if(WO)break;case"keydown":case"keyup":KI(D,n,A)}var Se;if(OE)e:{switch(t){case"compositionstart":var Te="onCompositionStart";break e;case"compositionend":Te="onCompositionEnd";break e;case"compositionupdate":Te="onCompositionUpdate";break e}Te=void 0}else kp?zA(t,n)&&(Te="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(Te="onCompositionStart");Te&&(OA&&n.locale!=="ko"&&(kp||Te!=="onCompositionStart"?Te==="onCompositionEnd"&&kp&&(Se=kA()):(Sc=A,RE="value"in Sc?Sc.value:Sc.textContent,kp=!0)),we=v0(T,Te),0<we.length&&(Te=new jI(Te,t,null,n,A),D.push({event:Te,listeners:we}),Se?Te.data=Se:(Se=FA(n),Se!==null&&(Te.data=Se)))),(Se=OO?zO(t,n):FO(t,n))&&(T=v0(T,"onBeforeInput"),0<T.length&&(A=new jI("onBeforeInput","beforeinput",null,n,A),D.push({event:A,listeners:T}),A.data=Se))}YA(D,e)})}function r_(t,e,n){return{instance:t,listener:e,currentTarget:n}}function v0(t,e){for(var n=e+"Capture",i=[];t!==null;){var u=t,h=u.stateNode;u.tag===5&&h!==null&&(u=h,h=Yg(t,n),h!=null&&i.unshift(r_(t,h,u)),h=Yg(t,e),h!=null&&i.push(r_(t,h,u))),t=t.return}return i}function Lp(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function e2(t,e,n,i,u){for(var h=e._reactName,d=[];n!==null&&n!==i;){var s=n,w=s.alternate,T=s.stateNode;if(w!==null&&w===i)break;s.tag===5&&T!==null&&(s=T,u?(w=Yg(n,h),w!=null&&d.unshift(r_(n,w,s))):u||(w=Yg(n,h),w!=null&&d.push(r_(n,w,s)))),n=n.return}d.length!==0&&t.push({event:e,listeners:d})}var JO=/\r\n?/g,QO=/\u0000|\uFFFD/g;function t2(t){return(typeof t=="string"?t:""+t).replace(JO,`
`).replace(QO,"")}function Mv(t,e,n){if(e=t2(e),t2(t)!==e&&n)throw Error(dt(425))}function x0(){}var Eb=null,Sb=null;function Tb(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var Cb=typeof setTimeout=="function"?setTimeout:void 0,ez=typeof clearTimeout=="function"?clearTimeout:void 0,n2=typeof Promise=="function"?Promise:void 0,tz=typeof queueMicrotask=="function"?queueMicrotask:typeof n2<"u"?function(t){return n2.resolve(null).then(t).catch(nz)}:Cb;function nz(t){setTimeout(function(){throw t})}function Rw(t,e){var n=e,i=0;do{var u=n.nextSibling;if(t.removeChild(n),u&&u.nodeType===8)if(n=u.data,n==="/$"){if(i===0){t.removeChild(u),Qg(e);return}i--}else n!=="$"&&n!=="$?"&&n!=="$!"||i++;n=u}while(n);Qg(e)}function Ac(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function r2(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var kd=Math.random().toString(36).slice(2),Ml="__reactFiber$"+kd,i_="__reactProps$"+kd,wu="__reactContainer$"+kd,Ib="__reactEvents$"+kd,rz="__reactListeners$"+kd,iz="__reactHandles$"+kd;function Hh(t){var e=t[Ml];if(e)return e;for(var n=t.parentNode;n;){if(e=n[wu]||n[Ml]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=r2(t);t!==null;){if(n=t[Ml])return n;t=r2(t)}return e}t=n,n=t.parentNode}return null}function N_(t){return t=t[Ml]||t[wu],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function Fp(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(dt(33))}function cx(t){return t[i_]||null}var Mb=[],Bp=-1;function Wc(t){return{current:t}}function mr(t){0>Bp||(t.current=Mb[Bp],Mb[Bp]=null,Bp--)}function ur(t,e){Bp++,Mb[Bp]=t.current,t.current=e}var zc={},ao=Wc(zc),$o=Wc(!1),nf=zc;function nd(t,e){var n=t.type.contextTypes;if(!n)return zc;var i=t.stateNode;if(i&&i.__reactInternalMemoizedUnmaskedChildContext===e)return i.__reactInternalMemoizedMaskedChildContext;var u={},h;for(h in n)u[h]=e[h];return i&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=u),u}function Zo(t){return t=t.childContextTypes,t!=null}function w0(){mr($o),mr(ao)}function i2(t,e,n){if(ao.current!==zc)throw Error(dt(168));ur(ao,e),ur($o,n)}function JA(t,e,n){var i=t.stateNode;if(e=e.childContextTypes,typeof i.getChildContext!="function")return n;i=i.getChildContext();for(var u in i)if(!(u in e))throw Error(dt(108,jk(t)||"Unknown",u));return Vr({},n,i)}function b0(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||zc,nf=ao.current,ur(ao,t),ur($o,$o.current),!0}function o2(t,e,n){var i=t.stateNode;if(!i)throw Error(dt(169));n?(t=JA(t,e,nf),i.__reactInternalMemoizedMergedChildContext=t,mr($o),mr(ao),ur(ao,t)):mr($o),ur($o,n)}var pu=null,hx=!1,Nw=!1;function QA(t){pu===null?pu=[t]:pu.push(t)}function oz(t){hx=!0,QA(t)}function Hc(){if(!Nw&&pu!==null){Nw=!0;var t=0,e=Yn;try{var n=pu;for(Yn=1;t<n.length;t++){var i=n[t];do i=i(!0);while(i!==null)}pu=null,hx=!1}catch(u){throw pu!==null&&(pu=pu.slice(t+1)),SA(AE,Hc),u}finally{Yn=e,Nw=!1}}return null}var Up=[],Vp=0,E0=null,S0=0,Xs=[],$s=0,rf=null,du=1,mu="";function Xh(t,e){Up[Vp++]=S0,Up[Vp++]=E0,E0=t,S0=e}function eP(t,e,n){Xs[$s++]=du,Xs[$s++]=mu,Xs[$s++]=rf,rf=t;var i=du;t=mu;var u=32-ja(i)-1;i&=~(1<<u),n+=1;var h=32-ja(e)+u;if(30<h){var d=u-u%5;h=(i&(1<<d)-1).toString(32),i>>=d,u-=d,du=1<<32-ja(e)+u|n<<u|i,mu=h+t}else du=1<<h|n<<u|i,mu=t}function FE(t){t.return!==null&&(Xh(t,1),eP(t,1,0))}function BE(t){for(;t===E0;)E0=Up[--Vp],Up[Vp]=null,S0=Up[--Vp],Up[Vp]=null;for(;t===rf;)rf=Xs[--$s],Xs[$s]=null,mu=Xs[--$s],Xs[$s]=null,du=Xs[--$s],Xs[$s]=null}var ds=null,ps=null,br=!1,za=null;function tP(t,e){var n=Ws(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,e=t.deletions,e===null?(t.deletions=[n],t.flags|=16):e.push(n)}function s2(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,ds=t,ps=Ac(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,ds=t,ps=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=rf!==null?{id:du,overflow:mu}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=Ws(18,null,null,0),n.stateNode=e,n.return=t,t.child=n,ds=t,ps=null,!0):!1;default:return!1}}function Ab(t){return(t.mode&1)!==0&&(t.flags&128)===0}function Pb(t){if(br){var e=ps;if(e){var n=e;if(!s2(t,e)){if(Ab(t))throw Error(dt(418));e=Ac(n.nextSibling);var i=ds;e&&s2(t,e)?tP(i,n):(t.flags=t.flags&-4097|2,br=!1,ds=t)}}else{if(Ab(t))throw Error(dt(418));t.flags=t.flags&-4097|2,br=!1,ds=t}}}function a2(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;ds=t}function Av(t){if(t!==ds)return!1;if(!br)return a2(t),br=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!Tb(t.type,t.memoizedProps)),e&&(e=ps)){if(Ab(t))throw nP(),Error(dt(418));for(;e;)tP(t,e),e=Ac(e.nextSibling)}if(a2(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(dt(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){ps=Ac(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}ps=null}}else ps=ds?Ac(t.stateNode.nextSibling):null;return!0}function nP(){for(var t=ps;t;)t=Ac(t.nextSibling)}function rd(){ps=ds=null,br=!1}function UE(t){za===null?za=[t]:za.push(t)}var sz=ku.ReactCurrentBatchConfig;function ka(t,e){if(t&&t.defaultProps){e=Vr({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}var T0=Wc(null),C0=null,jp=null,VE=null;function jE(){VE=jp=C0=null}function GE(t){var e=T0.current;mr(T0),t._currentValue=e}function Lb(t,e,n){for(;t!==null;){var i=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,i!==null&&(i.childLanes|=e)):i!==null&&(i.childLanes&e)!==e&&(i.childLanes|=e),t===n)break;t=t.return}}function Jp(t,e){C0=t,VE=jp=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(qo=!0),t.firstContext=null)}function Js(t){var e=t._currentValue;if(VE!==t)if(t={context:t,memoizedValue:e,next:null},jp===null){if(C0===null)throw Error(dt(308));jp=t,C0.dependencies={lanes:0,firstContext:t}}else jp=jp.next=t;return e}var Yh=null;function qE(t){Yh===null?Yh=[t]:Yh.push(t)}function rP(t,e,n,i){var u=e.interleaved;return u===null?(n.next=n,qE(e)):(n.next=u.next,u.next=n),e.interleaved=n,bu(t,i)}function bu(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}var wc=!1;function XE(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function iP(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function _u(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function Pc(t,e,n){var i=t.updateQueue;if(i===null)return null;if(i=i.shared,Ln&2){var u=i.pending;return u===null?e.next=e:(e.next=u.next,u.next=e),i.pending=e,bu(t,n)}return u=i.interleaved,u===null?(e.next=e,qE(i)):(e.next=u.next,u.next=e),i.interleaved=e,bu(t,n)}function Jv(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var i=e.lanes;i&=t.pendingLanes,n|=i,e.lanes=n,PE(t,n)}}function l2(t,e){var n=t.updateQueue,i=t.alternate;if(i!==null&&(i=i.updateQueue,n===i)){var u=null,h=null;if(n=n.firstBaseUpdate,n!==null){do{var d={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};h===null?u=h=d:h=h.next=d,n=n.next}while(n!==null);h===null?u=h=e:h=h.next=e}else u=h=e;n={baseState:i.baseState,firstBaseUpdate:u,lastBaseUpdate:h,shared:i.shared,effects:i.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function I0(t,e,n,i){var u=t.updateQueue;wc=!1;var h=u.firstBaseUpdate,d=u.lastBaseUpdate,s=u.shared.pending;if(s!==null){u.shared.pending=null;var w=s,T=w.next;w.next=null,d===null?h=T:d.next=T,d=w;var A=t.alternate;A!==null&&(A=A.updateQueue,s=A.lastBaseUpdate,s!==d&&(s===null?A.firstBaseUpdate=T:s.next=T,A.lastBaseUpdate=w))}if(h!==null){var D=u.baseState;d=0,A=T=w=null,s=h;do{var R=s.lane,G=s.eventTime;if((i&R)===R){A!==null&&(A=A.next={eventTime:G,lane:0,tag:s.tag,payload:s.payload,callback:s.callback,next:null});e:{var $=t,ie=s;switch(R=e,G=n,ie.tag){case 1:if($=ie.payload,typeof $=="function"){D=$.call(G,D,R);break e}D=$;break e;case 3:$.flags=$.flags&-65537|128;case 0:if($=ie.payload,R=typeof $=="function"?$.call(G,D,R):$,R==null)break e;D=Vr({},D,R);break e;case 2:wc=!0}}s.callback!==null&&s.lane!==0&&(t.flags|=64,R=u.effects,R===null?u.effects=[s]:R.push(s))}else G={eventTime:G,lane:R,tag:s.tag,payload:s.payload,callback:s.callback,next:null},A===null?(T=A=G,w=D):A=A.next=G,d|=R;if(s=s.next,s===null){if(s=u.shared.pending,s===null)break;R=s,s=R.next,R.next=null,u.lastBaseUpdate=R,u.shared.pending=null}}while(1);if(A===null&&(w=D),u.baseState=w,u.firstBaseUpdate=T,u.lastBaseUpdate=A,e=u.shared.interleaved,e!==null){u=e;do d|=u.lane,u=u.next;while(u!==e)}else h===null&&(u.shared.lanes=0);sf|=d,t.lanes=d,t.memoizedState=D}}function u2(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var i=t[e],u=i.callback;if(u!==null){if(i.callback=null,i=n,typeof u!="function")throw Error(dt(191,u));u.call(i)}}}var oP=new rA.Component().refs;function Db(t,e,n,i){e=t.memoizedState,n=n(i,e),n=n==null?e:Vr({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var fx={isMounted:function(t){return(t=t._reactInternals)?Sf(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var i=wo(),u=Dc(t),h=_u(i,u);h.payload=e,n!=null&&(h.callback=n),e=Pc(t,h,u),e!==null&&(Ga(e,t,u,i),Jv(e,t,u))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var i=wo(),u=Dc(t),h=_u(i,u);h.tag=1,h.payload=e,n!=null&&(h.callback=n),e=Pc(t,h,u),e!==null&&(Ga(e,t,u,i),Jv(e,t,u))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=wo(),i=Dc(t),u=_u(n,i);u.tag=2,e!=null&&(u.callback=e),e=Pc(t,u,i),e!==null&&(Ga(e,t,i,n),Jv(e,t,i))}};function c2(t,e,n,i,u,h,d){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(i,h,d):e.prototype&&e.prototype.isPureReactComponent?!t_(n,i)||!t_(u,h):!0}function sP(t,e,n){var i=!1,u=zc,h=e.contextType;return typeof h=="object"&&h!==null?h=Js(h):(u=Zo(e)?nf:ao.current,i=e.contextTypes,h=(i=i!=null)?nd(t,u):zc),e=new e(n,h),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=fx,t.stateNode=e,e._reactInternals=t,i&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=u,t.__reactInternalMemoizedMaskedChildContext=h),e}function h2(t,e,n,i){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,i),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,i),e.state!==t&&fx.enqueueReplaceState(e,e.state,null)}function Rb(t,e,n,i){var u=t.stateNode;u.props=n,u.state=t.memoizedState,u.refs=oP,XE(t);var h=e.contextType;typeof h=="object"&&h!==null?u.context=Js(h):(h=Zo(e)?nf:ao.current,u.context=nd(t,h)),u.state=t.memoizedState,h=e.getDerivedStateFromProps,typeof h=="function"&&(Db(t,e,h,n),u.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof u.getSnapshotBeforeUpdate=="function"||typeof u.UNSAFE_componentWillMount!="function"&&typeof u.componentWillMount!="function"||(e=u.state,typeof u.componentWillMount=="function"&&u.componentWillMount(),typeof u.UNSAFE_componentWillMount=="function"&&u.UNSAFE_componentWillMount(),e!==u.state&&fx.enqueueReplaceState(u,u.state,null),I0(t,n,u,i),u.state=t.memoizedState),typeof u.componentDidMount=="function"&&(t.flags|=4194308)}function Sg(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(dt(309));var i=n.stateNode}if(!i)throw Error(dt(147,t));var u=i,h=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===h?e.ref:(e=function(d){var s=u.refs;s===oP&&(s=u.refs={}),d===null?delete s[h]:s[h]=d},e._stringRef=h,e)}if(typeof t!="string")throw Error(dt(284));if(!n._owner)throw Error(dt(290,t))}return t}function Pv(t,e){throw t=Object.prototype.toString.call(e),Error(dt(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function f2(t){var e=t._init;return e(t._payload)}function aP(t){function e(Y,B){if(t){var q=Y.deletions;q===null?(Y.deletions=[B],Y.flags|=16):q.push(B)}}function n(Y,B){if(!t)return null;for(;B!==null;)e(Y,B),B=B.sibling;return null}function i(Y,B){for(Y=new Map;B!==null;)B.key!==null?Y.set(B.key,B):Y.set(B.index,B),B=B.sibling;return Y}function u(Y,B){return Y=Rc(Y,B),Y.index=0,Y.sibling=null,Y}function h(Y,B,q){return Y.index=q,t?(q=Y.alternate,q!==null?(q=q.index,q<B?(Y.flags|=2,B):q):(Y.flags|=2,B)):(Y.flags|=1048576,B)}function d(Y){return t&&Y.alternate===null&&(Y.flags|=2),Y}function s(Y,B,q,oe){return B===null||B.tag!==6?(B=Vw(q,Y.mode,oe),B.return=Y,B):(B=u(B,q),B.return=Y,B)}function w(Y,B,q,oe){var de=q.type;return de===Np?A(Y,B,q.props.children,oe,q.key):B!==null&&(B.elementType===de||typeof de=="object"&&de!==null&&de.$$typeof===xc&&f2(de)===B.type)?(oe=u(B,q.props),oe.ref=Sg(Y,B,q),oe.return=Y,oe):(oe=i0(q.type,q.key,q.props,null,Y.mode,oe),oe.ref=Sg(Y,B,q),oe.return=Y,oe)}function T(Y,B,q,oe){return B===null||B.tag!==4||B.stateNode.containerInfo!==q.containerInfo||B.stateNode.implementation!==q.implementation?(B=jw(q,Y.mode,oe),B.return=Y,B):(B=u(B,q.children||[]),B.return=Y,B)}function A(Y,B,q,oe,de){return B===null||B.tag!==7?(B=ef(q,Y.mode,oe,de),B.return=Y,B):(B=u(B,q),B.return=Y,B)}function D(Y,B,q){if(typeof B=="string"&&B!==""||typeof B=="number")return B=Vw(""+B,Y.mode,q),B.return=Y,B;if(typeof B=="object"&&B!==null){switch(B.$$typeof){case vv:return q=i0(B.type,B.key,B.props,null,Y.mode,q),q.ref=Sg(Y,null,B),q.return=Y,q;case Rp:return B=jw(B,Y.mode,q),B.return=Y,B;case xc:var oe=B._init;return D(Y,oe(B._payload),q)}if(Lg(B)||vg(B))return B=ef(B,Y.mode,q,null),B.return=Y,B;Pv(Y,B)}return null}function R(Y,B,q,oe){var de=B!==null?B.key:null;if(typeof q=="string"&&q!==""||typeof q=="number")return de!==null?null:s(Y,B,""+q,oe);if(typeof q=="object"&&q!==null){switch(q.$$typeof){case vv:return q.key===de?w(Y,B,q,oe):null;case Rp:return q.key===de?T(Y,B,q,oe):null;case xc:return de=q._init,R(Y,B,de(q._payload),oe)}if(Lg(q)||vg(q))return de!==null?null:A(Y,B,q,oe,null);Pv(Y,q)}return null}function G(Y,B,q,oe,de){if(typeof oe=="string"&&oe!==""||typeof oe=="number")return Y=Y.get(q)||null,s(B,Y,""+oe,de);if(typeof oe=="object"&&oe!==null){switch(oe.$$typeof){case vv:return Y=Y.get(oe.key===null?q:oe.key)||null,w(B,Y,oe,de);case Rp:return Y=Y.get(oe.key===null?q:oe.key)||null,T(B,Y,oe,de);case xc:var we=oe._init;return G(Y,B,q,we(oe._payload),de)}if(Lg(oe)||vg(oe))return Y=Y.get(q)||null,A(B,Y,oe,de,null);Pv(B,oe)}return null}function $(Y,B,q,oe){for(var de=null,we=null,Se=B,Te=B=0,xe=null;Se!==null&&Te<q.length;Te++){Se.index>Te?(xe=Se,Se=null):xe=Se.sibling;var et=R(Y,Se,q[Te],oe);if(et===null){Se===null&&(Se=xe);break}t&&Se&&et.alternate===null&&e(Y,Se),B=h(et,B,Te),we===null?de=et:we.sibling=et,we=et,Se=xe}if(Te===q.length)return n(Y,Se),br&&Xh(Y,Te),de;if(Se===null){for(;Te<q.length;Te++)Se=D(Y,q[Te],oe),Se!==null&&(B=h(Se,B,Te),we===null?de=Se:we.sibling=Se,we=Se);return br&&Xh(Y,Te),de}for(Se=i(Y,Se);Te<q.length;Te++)xe=G(Se,Y,Te,q[Te],oe),xe!==null&&(t&&xe.alternate!==null&&Se.delete(xe.key===null?Te:xe.key),B=h(xe,B,Te),we===null?de=xe:we.sibling=xe,we=xe);return t&&Se.forEach(function(We){return e(Y,We)}),br&&Xh(Y,Te),de}function ie(Y,B,q,oe){var de=vg(q);if(typeof de!="function")throw Error(dt(150));if(q=de.call(q),q==null)throw Error(dt(151));for(var we=de=null,Se=B,Te=B=0,xe=null,et=q.next();Se!==null&&!et.done;Te++,et=q.next()){Se.index>Te?(xe=Se,Se=null):xe=Se.sibling;var We=R(Y,Se,et.value,oe);if(We===null){Se===null&&(Se=xe);break}t&&Se&&We.alternate===null&&e(Y,Se),B=h(We,B,Te),we===null?de=We:we.sibling=We,we=We,Se=xe}if(et.done)return n(Y,Se),br&&Xh(Y,Te),de;if(Se===null){for(;!et.done;Te++,et=q.next())et=D(Y,et.value,oe),et!==null&&(B=h(et,B,Te),we===null?de=et:we.sibling=et,we=et);return br&&Xh(Y,Te),de}for(Se=i(Y,Se);!et.done;Te++,et=q.next())et=G(Se,Y,Te,et.value,oe),et!==null&&(t&&et.alternate!==null&&Se.delete(et.key===null?Te:et.key),B=h(et,B,Te),we===null?de=et:we.sibling=et,we=et);return t&&Se.forEach(function(He){return e(Y,He)}),br&&Xh(Y,Te),de}function _e(Y,B,q,oe){if(typeof q=="object"&&q!==null&&q.type===Np&&q.key===null&&(q=q.props.children),typeof q=="object"&&q!==null){switch(q.$$typeof){case vv:e:{for(var de=q.key,we=B;we!==null;){if(we.key===de){if(de=q.type,de===Np){if(we.tag===7){n(Y,we.sibling),B=u(we,q.props.children),B.return=Y,Y=B;break e}}else if(we.elementType===de||typeof de=="object"&&de!==null&&de.$$typeof===xc&&f2(de)===we.type){n(Y,we.sibling),B=u(we,q.props),B.ref=Sg(Y,we,q),B.return=Y,Y=B;break e}n(Y,we);break}else e(Y,we);we=we.sibling}q.type===Np?(B=ef(q.props.children,Y.mode,oe,q.key),B.return=Y,Y=B):(oe=i0(q.type,q.key,q.props,null,Y.mode,oe),oe.ref=Sg(Y,B,q),oe.return=Y,Y=oe)}return d(Y);case Rp:e:{for(we=q.key;B!==null;){if(B.key===we)if(B.tag===4&&B.stateNode.containerInfo===q.containerInfo&&B.stateNode.implementation===q.implementation){n(Y,B.sibling),B=u(B,q.children||[]),B.return=Y,Y=B;break e}else{n(Y,B);break}else e(Y,B);B=B.sibling}B=jw(q,Y.mode,oe),B.return=Y,Y=B}return d(Y);case xc:return we=q._init,_e(Y,B,we(q._payload),oe)}if(Lg(q))return $(Y,B,q,oe);if(vg(q))return ie(Y,B,q,oe);Pv(Y,q)}return typeof q=="string"&&q!==""||typeof q=="number"?(q=""+q,B!==null&&B.tag===6?(n(Y,B.sibling),B=u(B,q),B.return=Y,Y=B):(n(Y,B),B=Vw(q,Y.mode,oe),B.return=Y,Y=B),d(Y)):n(Y,B)}return _e}var id=aP(!0),lP=aP(!1),k_={},Ll=Wc(k_),o_=Wc(k_),s_=Wc(k_);function Kh(t){if(t===k_)throw Error(dt(174));return t}function $E(t,e){switch(ur(s_,e),ur(o_,t),ur(Ll,k_),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:hb(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=hb(e,t)}mr(Ll),ur(Ll,e)}function od(){mr(Ll),mr(o_),mr(s_)}function uP(t){Kh(s_.current);var e=Kh(Ll.current),n=hb(e,t.type);e!==n&&(ur(o_,t),ur(Ll,n))}function ZE(t){o_.current===t&&(mr(Ll),mr(o_))}var kr=Wc(0);function M0(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var kw=[];function WE(){for(var t=0;t<kw.length;t++)kw[t]._workInProgressVersionPrimary=null;kw.length=0}var Qv=ku.ReactCurrentDispatcher,Ow=ku.ReactCurrentBatchConfig,of=0,Ur=null,mi=null,Ci=null,A0=!1,qg=!1,a_=0,az=0;function no(){throw Error(dt(321))}function HE(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!$a(t[n],e[n]))return!1;return!0}function YE(t,e,n,i,u,h){if(of=h,Ur=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,Qv.current=t===null||t.memoizedState===null?hz:fz,t=n(i,u),qg){h=0;do{if(qg=!1,a_=0,25<=h)throw Error(dt(301));h+=1,Ci=mi=null,e.updateQueue=null,Qv.current=pz,t=n(i,u)}while(qg)}if(Qv.current=P0,e=mi!==null&&mi.next!==null,of=0,Ci=mi=Ur=null,A0=!1,e)throw Error(dt(300));return t}function KE(){var t=a_!==0;return a_=0,t}function Sl(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ci===null?Ur.memoizedState=Ci=t:Ci=Ci.next=t,Ci}function Qs(){if(mi===null){var t=Ur.alternate;t=t!==null?t.memoizedState:null}else t=mi.next;var e=Ci===null?Ur.memoizedState:Ci.next;if(e!==null)Ci=e,mi=t;else{if(t===null)throw Error(dt(310));mi=t,t={memoizedState:mi.memoizedState,baseState:mi.baseState,baseQueue:mi.baseQueue,queue:mi.queue,next:null},Ci===null?Ur.memoizedState=Ci=t:Ci=Ci.next=t}return Ci}function l_(t,e){return typeof e=="function"?e(t):e}function zw(t){var e=Qs(),n=e.queue;if(n===null)throw Error(dt(311));n.lastRenderedReducer=t;var i=mi,u=i.baseQueue,h=n.pending;if(h!==null){if(u!==null){var d=u.next;u.next=h.next,h.next=d}i.baseQueue=u=h,n.pending=null}if(u!==null){h=u.next,i=i.baseState;var s=d=null,w=null,T=h;do{var A=T.lane;if((of&A)===A)w!==null&&(w=w.next={lane:0,action:T.action,hasEagerState:T.hasEagerState,eagerState:T.eagerState,next:null}),i=T.hasEagerState?T.eagerState:t(i,T.action);else{var D={lane:A,action:T.action,hasEagerState:T.hasEagerState,eagerState:T.eagerState,next:null};w===null?(s=w=D,d=i):w=w.next=D,Ur.lanes|=A,sf|=A}T=T.next}while(T!==null&&T!==h);w===null?d=i:w.next=s,$a(i,e.memoizedState)||(qo=!0),e.memoizedState=i,e.baseState=d,e.baseQueue=w,n.lastRenderedState=i}if(t=n.interleaved,t!==null){u=t;do h=u.lane,Ur.lanes|=h,sf|=h,u=u.next;while(u!==t)}else u===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function Fw(t){var e=Qs(),n=e.queue;if(n===null)throw Error(dt(311));n.lastRenderedReducer=t;var i=n.dispatch,u=n.pending,h=e.memoizedState;if(u!==null){n.pending=null;var d=u=u.next;do h=t(h,d.action),d=d.next;while(d!==u);$a(h,e.memoizedState)||(qo=!0),e.memoizedState=h,e.baseQueue===null&&(e.baseState=h),n.lastRenderedState=h}return[h,i]}function cP(){}function hP(t,e){var n=Ur,i=Qs(),u=e(),h=!$a(i.memoizedState,u);if(h&&(i.memoizedState=u,qo=!0),i=i.queue,JE(dP.bind(null,n,i,t),[t]),i.getSnapshot!==e||h||Ci!==null&&Ci.memoizedState.tag&1){if(n.flags|=2048,u_(9,pP.bind(null,n,i,u,e),void 0,null),Li===null)throw Error(dt(349));of&30||fP(n,e,u)}return u}function fP(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=Ur.updateQueue,e===null?(e={lastEffect:null,stores:null},Ur.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function pP(t,e,n,i){e.value=n,e.getSnapshot=i,mP(e)&&gP(t)}function dP(t,e,n){return n(function(){mP(e)&&gP(t)})}function mP(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!$a(t,n)}catch{return!0}}function gP(t){var e=bu(t,1);e!==null&&Ga(e,t,1,-1)}function p2(t){var e=Sl();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:l_,lastRenderedState:t},e.queue=t,t=t.dispatch=cz.bind(null,Ur,t),[e.memoizedState,t]}function u_(t,e,n,i){return t={tag:t,create:e,destroy:n,deps:i,next:null},e=Ur.updateQueue,e===null?(e={lastEffect:null,stores:null},Ur.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(i=n.next,n.next=t,t.next=i,e.lastEffect=t)),t}function _P(){return Qs().memoizedState}function e0(t,e,n,i){var u=Sl();Ur.flags|=t,u.memoizedState=u_(1|e,n,void 0,i===void 0?null:i)}function px(t,e,n,i){var u=Qs();i=i===void 0?null:i;var h=void 0;if(mi!==null){var d=mi.memoizedState;if(h=d.destroy,i!==null&&HE(i,d.deps)){u.memoizedState=u_(e,n,h,i);return}}Ur.flags|=t,u.memoizedState=u_(1|e,n,h,i)}function d2(t,e){return e0(8390656,8,t,e)}function JE(t,e){return px(2048,8,t,e)}function yP(t,e){return px(4,2,t,e)}function vP(t,e){return px(4,4,t,e)}function xP(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function wP(t,e,n){return n=n!=null?n.concat([t]):null,px(4,4,xP.bind(null,e,t),n)}function QE(){}function bP(t,e){var n=Qs();e=e===void 0?null:e;var i=n.memoizedState;return i!==null&&e!==null&&HE(e,i[1])?i[0]:(n.memoizedState=[t,e],t)}function EP(t,e){var n=Qs();e=e===void 0?null:e;var i=n.memoizedState;return i!==null&&e!==null&&HE(e,i[1])?i[0]:(t=t(),n.memoizedState=[t,e],t)}function SP(t,e,n){return of&21?($a(n,e)||(n=IA(),Ur.lanes|=n,sf|=n,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,qo=!0),t.memoizedState=n)}function lz(t,e){var n=Yn;Yn=n!==0&&4>n?n:4,t(!0);var i=Ow.transition;Ow.transition={};try{t(!1),e()}finally{Yn=n,Ow.transition=i}}function TP(){return Qs().memoizedState}function uz(t,e,n){var i=Dc(t);if(n={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null},CP(t))IP(e,n);else if(n=rP(t,e,n,i),n!==null){var u=wo();Ga(n,t,i,u),MP(n,e,i)}}function cz(t,e,n){var i=Dc(t),u={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null};if(CP(t))IP(e,u);else{var h=t.alternate;if(t.lanes===0&&(h===null||h.lanes===0)&&(h=e.lastRenderedReducer,h!==null))try{var d=e.lastRenderedState,s=h(d,n);if(u.hasEagerState=!0,u.eagerState=s,$a(s,d)){var w=e.interleaved;w===null?(u.next=u,qE(e)):(u.next=w.next,w.next=u),e.interleaved=u;return}}catch{}finally{}n=rP(t,e,u,i),n!==null&&(u=wo(),Ga(n,t,i,u),MP(n,e,i))}}function CP(t){var e=t.alternate;return t===Ur||e!==null&&e===Ur}function IP(t,e){qg=A0=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function MP(t,e,n){if(n&4194240){var i=e.lanes;i&=t.pendingLanes,n|=i,e.lanes=n,PE(t,n)}}var P0={readContext:Js,useCallback:no,useContext:no,useEffect:no,useImperativeHandle:no,useInsertionEffect:no,useLayoutEffect:no,useMemo:no,useReducer:no,useRef:no,useState:no,useDebugValue:no,useDeferredValue:no,useTransition:no,useMutableSource:no,useSyncExternalStore:no,useId:no,unstable_isNewReconciler:!1},hz={readContext:Js,useCallback:function(t,e){return Sl().memoizedState=[t,e===void 0?null:e],t},useContext:Js,useEffect:d2,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,e0(4194308,4,xP.bind(null,e,t),n)},useLayoutEffect:function(t,e){return e0(4194308,4,t,e)},useInsertionEffect:function(t,e){return e0(4,2,t,e)},useMemo:function(t,e){var n=Sl();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var i=Sl();return e=n!==void 0?n(e):e,i.memoizedState=i.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},i.queue=t,t=t.dispatch=uz.bind(null,Ur,t),[i.memoizedState,t]},useRef:function(t){var e=Sl();return t={current:t},e.memoizedState=t},useState:p2,useDebugValue:QE,useDeferredValue:function(t){return Sl().memoizedState=t},useTransition:function(){var t=p2(!1),e=t[0];return t=lz.bind(null,t[1]),Sl().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var i=Ur,u=Sl();if(br){if(n===void 0)throw Error(dt(407));n=n()}else{if(n=e(),Li===null)throw Error(dt(349));of&30||fP(i,e,n)}u.memoizedState=n;var h={value:n,getSnapshot:e};return u.queue=h,d2(dP.bind(null,i,h,t),[t]),i.flags|=2048,u_(9,pP.bind(null,i,h,n,e),void 0,null),n},useId:function(){var t=Sl(),e=Li.identifierPrefix;if(br){var n=mu,i=du;n=(i&~(1<<32-ja(i)-1)).toString(32)+n,e=":"+e+"R"+n,n=a_++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=az++,e=":"+e+"r"+n.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},fz={readContext:Js,useCallback:bP,useContext:Js,useEffect:JE,useImperativeHandle:wP,useInsertionEffect:yP,useLayoutEffect:vP,useMemo:EP,useReducer:zw,useRef:_P,useState:function(){return zw(l_)},useDebugValue:QE,useDeferredValue:function(t){var e=Qs();return SP(e,mi.memoizedState,t)},useTransition:function(){var t=zw(l_)[0],e=Qs().memoizedState;return[t,e]},useMutableSource:cP,useSyncExternalStore:hP,useId:TP,unstable_isNewReconciler:!1},pz={readContext:Js,useCallback:bP,useContext:Js,useEffect:JE,useImperativeHandle:wP,useInsertionEffect:yP,useLayoutEffect:vP,useMemo:EP,useReducer:Fw,useRef:_P,useState:function(){return Fw(l_)},useDebugValue:QE,useDeferredValue:function(t){var e=Qs();return mi===null?e.memoizedState=t:SP(e,mi.memoizedState,t)},useTransition:function(){var t=Fw(l_)[0],e=Qs().memoizedState;return[t,e]},useMutableSource:cP,useSyncExternalStore:hP,useId:TP,unstable_isNewReconciler:!1};function sd(t,e){try{var n="",i=e;do n+=Vk(i),i=i.return;while(i);var u=n}catch(h){u=`
Error generating stack: `+h.message+`
`+h.stack}return{value:t,source:e,stack:u,digest:null}}function Bw(t,e,n){return{value:t,source:null,stack:n??null,digest:e??null}}function Nb(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var dz=typeof WeakMap=="function"?WeakMap:Map;function AP(t,e,n){n=_u(-1,n),n.tag=3,n.payload={element:null};var i=e.value;return n.callback=function(){D0||(D0=!0,qb=i),Nb(t,e)},n}function PP(t,e,n){n=_u(-1,n),n.tag=3;var i=t.type.getDerivedStateFromError;if(typeof i=="function"){var u=e.value;n.payload=function(){return i(u)},n.callback=function(){Nb(t,e)}}var h=t.stateNode;return h!==null&&typeof h.componentDidCatch=="function"&&(n.callback=function(){Nb(t,e),typeof i!="function"&&(Lc===null?Lc=new Set([this]):Lc.add(this));var d=e.stack;this.componentDidCatch(e.value,{componentStack:d!==null?d:""})}),n}function m2(t,e,n){var i=t.pingCache;if(i===null){i=t.pingCache=new dz;var u=new Set;i.set(e,u)}else u=i.get(e),u===void 0&&(u=new Set,i.set(e,u));u.has(n)||(u.add(n),t=Mz.bind(null,t,e,n),e.then(t,t))}function g2(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function _2(t,e,n,i,u){return t.mode&1?(t.flags|=65536,t.lanes=u,t):(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=_u(-1,1),e.tag=2,Pc(n,e,1))),n.lanes|=1),t)}var mz=ku.ReactCurrentOwner,qo=!1;function yo(t,e,n,i){e.child=t===null?lP(e,null,n,i):id(e,t.child,n,i)}function y2(t,e,n,i,u){n=n.render;var h=e.ref;return Jp(e,u),i=YE(t,e,n,i,h,u),n=KE(),t!==null&&!qo?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~u,Eu(t,e,u)):(br&&n&&FE(e),e.flags|=1,yo(t,e,i,u),e.child)}function v2(t,e,n,i,u){if(t===null){var h=n.type;return typeof h=="function"&&!aS(h)&&h.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=h,LP(t,e,h,i,u)):(t=i0(n.type,null,i,e,e.mode,u),t.ref=e.ref,t.return=e,e.child=t)}if(h=t.child,!(t.lanes&u)){var d=h.memoizedProps;if(n=n.compare,n=n!==null?n:t_,n(d,i)&&t.ref===e.ref)return Eu(t,e,u)}return e.flags|=1,t=Rc(h,i),t.ref=e.ref,t.return=e,e.child=t}function LP(t,e,n,i,u){if(t!==null){var h=t.memoizedProps;if(t_(h,i)&&t.ref===e.ref)if(qo=!1,e.pendingProps=i=h,(t.lanes&u)!==0)t.flags&131072&&(qo=!0);else return e.lanes=t.lanes,Eu(t,e,u)}return kb(t,e,n,i,u)}function DP(t,e,n){var i=e.pendingProps,u=i.children,h=t!==null?t.memoizedState:null;if(i.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},ur(qp,cs),cs|=n;else{if(!(n&1073741824))return t=h!==null?h.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,ur(qp,cs),cs|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},i=h!==null?h.baseLanes:n,ur(qp,cs),cs|=i}else h!==null?(i=h.baseLanes|n,e.memoizedState=null):i=n,ur(qp,cs),cs|=i;return yo(t,e,u,n),e.child}function RP(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function kb(t,e,n,i,u){var h=Zo(n)?nf:ao.current;return h=nd(e,h),Jp(e,u),n=YE(t,e,n,i,h,u),i=KE(),t!==null&&!qo?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~u,Eu(t,e,u)):(br&&i&&FE(e),e.flags|=1,yo(t,e,n,u),e.child)}function x2(t,e,n,i,u){if(Zo(n)){var h=!0;b0(e)}else h=!1;if(Jp(e,u),e.stateNode===null)t0(t,e),sP(e,n,i),Rb(e,n,i,u),i=!0;else if(t===null){var d=e.stateNode,s=e.memoizedProps;d.props=s;var w=d.context,T=n.contextType;typeof T=="object"&&T!==null?T=Js(T):(T=Zo(n)?nf:ao.current,T=nd(e,T));var A=n.getDerivedStateFromProps,D=typeof A=="function"||typeof d.getSnapshotBeforeUpdate=="function";D||typeof d.UNSAFE_componentWillReceiveProps!="function"&&typeof d.componentWillReceiveProps!="function"||(s!==i||w!==T)&&h2(e,d,i,T),wc=!1;var R=e.memoizedState;d.state=R,I0(e,i,d,u),w=e.memoizedState,s!==i||R!==w||$o.current||wc?(typeof A=="function"&&(Db(e,n,A,i),w=e.memoizedState),(s=wc||c2(e,n,s,i,R,w,T))?(D||typeof d.UNSAFE_componentWillMount!="function"&&typeof d.componentWillMount!="function"||(typeof d.componentWillMount=="function"&&d.componentWillMount(),typeof d.UNSAFE_componentWillMount=="function"&&d.UNSAFE_componentWillMount()),typeof d.componentDidMount=="function"&&(e.flags|=4194308)):(typeof d.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=i,e.memoizedState=w),d.props=i,d.state=w,d.context=T,i=s):(typeof d.componentDidMount=="function"&&(e.flags|=4194308),i=!1)}else{d=e.stateNode,iP(t,e),s=e.memoizedProps,T=e.type===e.elementType?s:ka(e.type,s),d.props=T,D=e.pendingProps,R=d.context,w=n.contextType,typeof w=="object"&&w!==null?w=Js(w):(w=Zo(n)?nf:ao.current,w=nd(e,w));var G=n.getDerivedStateFromProps;(A=typeof G=="function"||typeof d.getSnapshotBeforeUpdate=="function")||typeof d.UNSAFE_componentWillReceiveProps!="function"&&typeof d.componentWillReceiveProps!="function"||(s!==D||R!==w)&&h2(e,d,i,w),wc=!1,R=e.memoizedState,d.state=R,I0(e,i,d,u);var $=e.memoizedState;s!==D||R!==$||$o.current||wc?(typeof G=="function"&&(Db(e,n,G,i),$=e.memoizedState),(T=wc||c2(e,n,T,i,R,$,w)||!1)?(A||typeof d.UNSAFE_componentWillUpdate!="function"&&typeof d.componentWillUpdate!="function"||(typeof d.componentWillUpdate=="function"&&d.componentWillUpdate(i,$,w),typeof d.UNSAFE_componentWillUpdate=="function"&&d.UNSAFE_componentWillUpdate(i,$,w)),typeof d.componentDidUpdate=="function"&&(e.flags|=4),typeof d.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof d.componentDidUpdate!="function"||s===t.memoizedProps&&R===t.memoizedState||(e.flags|=4),typeof d.getSnapshotBeforeUpdate!="function"||s===t.memoizedProps&&R===t.memoizedState||(e.flags|=1024),e.memoizedProps=i,e.memoizedState=$),d.props=i,d.state=$,d.context=w,i=T):(typeof d.componentDidUpdate!="function"||s===t.memoizedProps&&R===t.memoizedState||(e.flags|=4),typeof d.getSnapshotBeforeUpdate!="function"||s===t.memoizedProps&&R===t.memoizedState||(e.flags|=1024),i=!1)}return Ob(t,e,n,i,h,u)}function Ob(t,e,n,i,u,h){RP(t,e);var d=(e.flags&128)!==0;if(!i&&!d)return u&&o2(e,n,!1),Eu(t,e,h);i=e.stateNode,mz.current=e;var s=d&&typeof n.getDerivedStateFromError!="function"?null:i.render();return e.flags|=1,t!==null&&d?(e.child=id(e,t.child,null,h),e.child=id(e,null,s,h)):yo(t,e,s,h),e.memoizedState=i.state,u&&o2(e,n,!0),e.child}function NP(t){var e=t.stateNode;e.pendingContext?i2(t,e.pendingContext,e.pendingContext!==e.context):e.context&&i2(t,e.context,!1),$E(t,e.containerInfo)}function w2(t,e,n,i,u){return rd(),UE(u),e.flags|=256,yo(t,e,n,i),e.child}var zb={dehydrated:null,treeContext:null,retryLane:0};function Fb(t){return{baseLanes:t,cachePool:null,transitions:null}}function kP(t,e,n){var i=e.pendingProps,u=kr.current,h=!1,d=(e.flags&128)!==0,s;if((s=d)||(s=t!==null&&t.memoizedState===null?!1:(u&2)!==0),s?(h=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(u|=1),ur(kr,u&1),t===null)return Pb(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(d=i.children,t=i.fallback,h?(i=e.mode,h=e.child,d={mode:"hidden",children:d},!(i&1)&&h!==null?(h.childLanes=0,h.pendingProps=d):h=gx(d,i,0,null),t=ef(t,i,n,null),h.return=e,t.return=e,h.sibling=t,e.child=h,e.child.memoizedState=Fb(n),e.memoizedState=zb,t):eS(e,d));if(u=t.memoizedState,u!==null&&(s=u.dehydrated,s!==null))return gz(t,e,d,i,s,u,n);if(h){h=i.fallback,d=e.mode,u=t.child,s=u.sibling;var w={mode:"hidden",children:i.children};return!(d&1)&&e.child!==u?(i=e.child,i.childLanes=0,i.pendingProps=w,e.deletions=null):(i=Rc(u,w),i.subtreeFlags=u.subtreeFlags&14680064),s!==null?h=Rc(s,h):(h=ef(h,d,n,null),h.flags|=2),h.return=e,i.return=e,i.sibling=h,e.child=i,i=h,h=e.child,d=t.child.memoizedState,d=d===null?Fb(n):{baseLanes:d.baseLanes|n,cachePool:null,transitions:d.transitions},h.memoizedState=d,h.childLanes=t.childLanes&~n,e.memoizedState=zb,i}return h=t.child,t=h.sibling,i=Rc(h,{mode:"visible",children:i.children}),!(e.mode&1)&&(i.lanes=n),i.return=e,i.sibling=null,t!==null&&(n=e.deletions,n===null?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=i,e.memoizedState=null,i}function eS(t,e){return e=gx({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function Lv(t,e,n,i){return i!==null&&UE(i),id(e,t.child,null,n),t=eS(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function gz(t,e,n,i,u,h,d){if(n)return e.flags&256?(e.flags&=-257,i=Bw(Error(dt(422))),Lv(t,e,d,i)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(h=i.fallback,u=e.mode,i=gx({mode:"visible",children:i.children},u,0,null),h=ef(h,u,d,null),h.flags|=2,i.return=e,h.return=e,i.sibling=h,e.child=i,e.mode&1&&id(e,t.child,null,d),e.child.memoizedState=Fb(d),e.memoizedState=zb,h);if(!(e.mode&1))return Lv(t,e,d,null);if(u.data==="$!"){if(i=u.nextSibling&&u.nextSibling.dataset,i)var s=i.dgst;return i=s,h=Error(dt(419)),i=Bw(h,i,void 0),Lv(t,e,d,i)}if(s=(d&t.childLanes)!==0,qo||s){if(i=Li,i!==null){switch(d&-d){case 4:u=2;break;case 16:u=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:u=32;break;case 536870912:u=268435456;break;default:u=0}u=u&(i.suspendedLanes|d)?0:u,u!==0&&u!==h.retryLane&&(h.retryLane=u,bu(t,u),Ga(i,t,u,-1))}return sS(),i=Bw(Error(dt(421))),Lv(t,e,d,i)}return u.data==="$?"?(e.flags|=128,e.child=t.child,e=Az.bind(null,t),u._reactRetry=e,null):(t=h.treeContext,ps=Ac(u.nextSibling),ds=e,br=!0,za=null,t!==null&&(Xs[$s++]=du,Xs[$s++]=mu,Xs[$s++]=rf,du=t.id,mu=t.overflow,rf=e),e=eS(e,i.children),e.flags|=4096,e)}function b2(t,e,n){t.lanes|=e;var i=t.alternate;i!==null&&(i.lanes|=e),Lb(t.return,e,n)}function Uw(t,e,n,i,u){var h=t.memoizedState;h===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:i,tail:n,tailMode:u}:(h.isBackwards=e,h.rendering=null,h.renderingStartTime=0,h.last=i,h.tail=n,h.tailMode=u)}function OP(t,e,n){var i=e.pendingProps,u=i.revealOrder,h=i.tail;if(yo(t,e,i.children,n),i=kr.current,i&2)i=i&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&b2(t,n,e);else if(t.tag===19)b2(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}i&=1}if(ur(kr,i),!(e.mode&1))e.memoizedState=null;else switch(u){case"forwards":for(n=e.child,u=null;n!==null;)t=n.alternate,t!==null&&M0(t)===null&&(u=n),n=n.sibling;n=u,n===null?(u=e.child,e.child=null):(u=n.sibling,n.sibling=null),Uw(e,!1,u,n,h);break;case"backwards":for(n=null,u=e.child,e.child=null;u!==null;){if(t=u.alternate,t!==null&&M0(t)===null){e.child=u;break}t=u.sibling,u.sibling=n,n=u,u=t}Uw(e,!0,n,null,h);break;case"together":Uw(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function t0(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function Eu(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),sf|=e.lanes,!(n&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(dt(153));if(e.child!==null){for(t=e.child,n=Rc(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=Rc(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function _z(t,e,n){switch(e.tag){case 3:NP(e),rd();break;case 5:uP(e);break;case 1:Zo(e.type)&&b0(e);break;case 4:$E(e,e.stateNode.containerInfo);break;case 10:var i=e.type._context,u=e.memoizedProps.value;ur(T0,i._currentValue),i._currentValue=u;break;case 13:if(i=e.memoizedState,i!==null)return i.dehydrated!==null?(ur(kr,kr.current&1),e.flags|=128,null):n&e.child.childLanes?kP(t,e,n):(ur(kr,kr.current&1),t=Eu(t,e,n),t!==null?t.sibling:null);ur(kr,kr.current&1);break;case 19:if(i=(n&e.childLanes)!==0,t.flags&128){if(i)return OP(t,e,n);e.flags|=128}if(u=e.memoizedState,u!==null&&(u.rendering=null,u.tail=null,u.lastEffect=null),ur(kr,kr.current),i)break;return null;case 22:case 23:return e.lanes=0,DP(t,e,n)}return Eu(t,e,n)}var zP,Bb,FP,BP;zP=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};Bb=function(){};FP=function(t,e,n,i){var u=t.memoizedProps;if(u!==i){t=e.stateNode,Kh(Ll.current);var h=null;switch(n){case"input":u=ab(t,u),i=ab(t,i),h=[];break;case"select":u=Vr({},u,{value:void 0}),i=Vr({},i,{value:void 0}),h=[];break;case"textarea":u=cb(t,u),i=cb(t,i),h=[];break;default:typeof u.onClick!="function"&&typeof i.onClick=="function"&&(t.onclick=x0)}fb(n,i);var d;n=null;for(T in u)if(!i.hasOwnProperty(T)&&u.hasOwnProperty(T)&&u[T]!=null)if(T==="style"){var s=u[T];for(d in s)s.hasOwnProperty(d)&&(n||(n={}),n[d]="")}else T!=="dangerouslySetInnerHTML"&&T!=="children"&&T!=="suppressContentEditableWarning"&&T!=="suppressHydrationWarning"&&T!=="autoFocus"&&(Wg.hasOwnProperty(T)?h||(h=[]):(h=h||[]).push(T,null));for(T in i){var w=i[T];if(s=u!=null?u[T]:void 0,i.hasOwnProperty(T)&&w!==s&&(w!=null||s!=null))if(T==="style")if(s){for(d in s)!s.hasOwnProperty(d)||w&&w.hasOwnProperty(d)||(n||(n={}),n[d]="");for(d in w)w.hasOwnProperty(d)&&s[d]!==w[d]&&(n||(n={}),n[d]=w[d])}else n||(h||(h=[]),h.push(T,n)),n=w;else T==="dangerouslySetInnerHTML"?(w=w?w.__html:void 0,s=s?s.__html:void 0,w!=null&&s!==w&&(h=h||[]).push(T,w)):T==="children"?typeof w!="string"&&typeof w!="number"||(h=h||[]).push(T,""+w):T!=="suppressContentEditableWarning"&&T!=="suppressHydrationWarning"&&(Wg.hasOwnProperty(T)?(w!=null&&T==="onScroll"&&dr("scroll",t),h||s===w||(h=[])):(h=h||[]).push(T,w))}n&&(h=h||[]).push("style",n);var T=h;(e.updateQueue=T)&&(e.flags|=4)}};BP=function(t,e,n,i){n!==i&&(e.flags|=4)};function Tg(t,e){if(!br)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var i=null;n!==null;)n.alternate!==null&&(i=n),n=n.sibling;i===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:i.sibling=null}}function ro(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,i=0;if(e)for(var u=t.child;u!==null;)n|=u.lanes|u.childLanes,i|=u.subtreeFlags&14680064,i|=u.flags&14680064,u.return=t,u=u.sibling;else for(u=t.child;u!==null;)n|=u.lanes|u.childLanes,i|=u.subtreeFlags,i|=u.flags,u.return=t,u=u.sibling;return t.subtreeFlags|=i,t.childLanes=n,e}function yz(t,e,n){var i=e.pendingProps;switch(BE(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return ro(e),null;case 1:return Zo(e.type)&&w0(),ro(e),null;case 3:return i=e.stateNode,od(),mr($o),mr(ao),WE(),i.pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),(t===null||t.child===null)&&(Av(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,za!==null&&(Zb(za),za=null))),Bb(t,e),ro(e),null;case 5:ZE(e);var u=Kh(s_.current);if(n=e.type,t!==null&&e.stateNode!=null)FP(t,e,n,i,u),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!i){if(e.stateNode===null)throw Error(dt(166));return ro(e),null}if(t=Kh(Ll.current),Av(e)){i=e.stateNode,n=e.type;var h=e.memoizedProps;switch(i[Ml]=e,i[i_]=h,t=(e.mode&1)!==0,n){case"dialog":dr("cancel",i),dr("close",i);break;case"iframe":case"object":case"embed":dr("load",i);break;case"video":case"audio":for(u=0;u<Rg.length;u++)dr(Rg[u],i);break;case"source":dr("error",i);break;case"img":case"image":case"link":dr("error",i),dr("load",i);break;case"details":dr("toggle",i);break;case"input":LI(i,h),dr("invalid",i);break;case"select":i._wrapperState={wasMultiple:!!h.multiple},dr("invalid",i);break;case"textarea":RI(i,h),dr("invalid",i)}fb(n,h),u=null;for(var d in h)if(h.hasOwnProperty(d)){var s=h[d];d==="children"?typeof s=="string"?i.textContent!==s&&(h.suppressHydrationWarning!==!0&&Mv(i.textContent,s,t),u=["children",s]):typeof s=="number"&&i.textContent!==""+s&&(h.suppressHydrationWarning!==!0&&Mv(i.textContent,s,t),u=["children",""+s]):Wg.hasOwnProperty(d)&&s!=null&&d==="onScroll"&&dr("scroll",i)}switch(n){case"input":xv(i),DI(i,h,!0);break;case"textarea":xv(i),NI(i);break;case"select":case"option":break;default:typeof h.onClick=="function"&&(i.onclick=x0)}i=u,e.updateQueue=i,i!==null&&(e.flags|=4)}else{d=u.nodeType===9?u:u.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=fA(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=d.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof i.is=="string"?t=d.createElement(n,{is:i.is}):(t=d.createElement(n),n==="select"&&(d=t,i.multiple?d.multiple=!0:i.size&&(d.size=i.size))):t=d.createElementNS(t,n),t[Ml]=e,t[i_]=i,zP(t,e,!1,!1),e.stateNode=t;e:{switch(d=pb(n,i),n){case"dialog":dr("cancel",t),dr("close",t),u=i;break;case"iframe":case"object":case"embed":dr("load",t),u=i;break;case"video":case"audio":for(u=0;u<Rg.length;u++)dr(Rg[u],t);u=i;break;case"source":dr("error",t),u=i;break;case"img":case"image":case"link":dr("error",t),dr("load",t),u=i;break;case"details":dr("toggle",t),u=i;break;case"input":LI(t,i),u=ab(t,i),dr("invalid",t);break;case"option":u=i;break;case"select":t._wrapperState={wasMultiple:!!i.multiple},u=Vr({},i,{value:void 0}),dr("invalid",t);break;case"textarea":RI(t,i),u=cb(t,i),dr("invalid",t);break;default:u=i}fb(n,u),s=u;for(h in s)if(s.hasOwnProperty(h)){var w=s[h];h==="style"?mA(t,w):h==="dangerouslySetInnerHTML"?(w=w?w.__html:void 0,w!=null&&pA(t,w)):h==="children"?typeof w=="string"?(n!=="textarea"||w!=="")&&Hg(t,w):typeof w=="number"&&Hg(t,""+w):h!=="suppressContentEditableWarning"&&h!=="suppressHydrationWarning"&&h!=="autoFocus"&&(Wg.hasOwnProperty(h)?w!=null&&h==="onScroll"&&dr("scroll",t):w!=null&&SE(t,h,w,d))}switch(n){case"input":xv(t),DI(t,i,!1);break;case"textarea":xv(t),NI(t);break;case"option":i.value!=null&&t.setAttribute("value",""+Oc(i.value));break;case"select":t.multiple=!!i.multiple,h=i.value,h!=null?Wp(t,!!i.multiple,h,!1):i.defaultValue!=null&&Wp(t,!!i.multiple,i.defaultValue,!0);break;default:typeof u.onClick=="function"&&(t.onclick=x0)}switch(n){case"button":case"input":case"select":case"textarea":i=!!i.autoFocus;break e;case"img":i=!0;break e;default:i=!1}}i&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return ro(e),null;case 6:if(t&&e.stateNode!=null)BP(t,e,t.memoizedProps,i);else{if(typeof i!="string"&&e.stateNode===null)throw Error(dt(166));if(n=Kh(s_.current),Kh(Ll.current),Av(e)){if(i=e.stateNode,n=e.memoizedProps,i[Ml]=e,(h=i.nodeValue!==n)&&(t=ds,t!==null))switch(t.tag){case 3:Mv(i.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&Mv(i.nodeValue,n,(t.mode&1)!==0)}h&&(e.flags|=4)}else i=(n.nodeType===9?n:n.ownerDocument).createTextNode(i),i[Ml]=e,e.stateNode=i}return ro(e),null;case 13:if(mr(kr),i=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(br&&ps!==null&&e.mode&1&&!(e.flags&128))nP(),rd(),e.flags|=98560,h=!1;else if(h=Av(e),i!==null&&i.dehydrated!==null){if(t===null){if(!h)throw Error(dt(318));if(h=e.memoizedState,h=h!==null?h.dehydrated:null,!h)throw Error(dt(317));h[Ml]=e}else rd(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;ro(e),h=!1}else za!==null&&(Zb(za),za=null),h=!0;if(!h)return e.flags&65536?e:null}return e.flags&128?(e.lanes=n,e):(i=i!==null,i!==(t!==null&&t.memoizedState!==null)&&i&&(e.child.flags|=8192,e.mode&1&&(t===null||kr.current&1?gi===0&&(gi=3):sS())),e.updateQueue!==null&&(e.flags|=4),ro(e),null);case 4:return od(),Bb(t,e),t===null&&n_(e.stateNode.containerInfo),ro(e),null;case 10:return GE(e.type._context),ro(e),null;case 17:return Zo(e.type)&&w0(),ro(e),null;case 19:if(mr(kr),h=e.memoizedState,h===null)return ro(e),null;if(i=(e.flags&128)!==0,d=h.rendering,d===null)if(i)Tg(h,!1);else{if(gi!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(d=M0(t),d!==null){for(e.flags|=128,Tg(h,!1),i=d.updateQueue,i!==null&&(e.updateQueue=i,e.flags|=4),e.subtreeFlags=0,i=n,n=e.child;n!==null;)h=n,t=i,h.flags&=14680066,d=h.alternate,d===null?(h.childLanes=0,h.lanes=t,h.child=null,h.subtreeFlags=0,h.memoizedProps=null,h.memoizedState=null,h.updateQueue=null,h.dependencies=null,h.stateNode=null):(h.childLanes=d.childLanes,h.lanes=d.lanes,h.child=d.child,h.subtreeFlags=0,h.deletions=null,h.memoizedProps=d.memoizedProps,h.memoizedState=d.memoizedState,h.updateQueue=d.updateQueue,h.type=d.type,t=d.dependencies,h.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return ur(kr,kr.current&1|2),e.child}t=t.sibling}h.tail!==null&&Zr()>ad&&(e.flags|=128,i=!0,Tg(h,!1),e.lanes=4194304)}else{if(!i)if(t=M0(d),t!==null){if(e.flags|=128,i=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),Tg(h,!0),h.tail===null&&h.tailMode==="hidden"&&!d.alternate&&!br)return ro(e),null}else 2*Zr()-h.renderingStartTime>ad&&n!==1073741824&&(e.flags|=128,i=!0,Tg(h,!1),e.lanes=4194304);h.isBackwards?(d.sibling=e.child,e.child=d):(n=h.last,n!==null?n.sibling=d:e.child=d,h.last=d)}return h.tail!==null?(e=h.tail,h.rendering=e,h.tail=e.sibling,h.renderingStartTime=Zr(),e.sibling=null,n=kr.current,ur(kr,i?n&1|2:n&1),e):(ro(e),null);case 22:case 23:return oS(),i=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==i&&(e.flags|=8192),i&&e.mode&1?cs&1073741824&&(ro(e),e.subtreeFlags&6&&(e.flags|=8192)):ro(e),null;case 24:return null;case 25:return null}throw Error(dt(156,e.tag))}function vz(t,e){switch(BE(e),e.tag){case 1:return Zo(e.type)&&w0(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return od(),mr($o),mr(ao),WE(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return ZE(e),null;case 13:if(mr(kr),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(dt(340));rd()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return mr(kr),null;case 4:return od(),null;case 10:return GE(e.type._context),null;case 22:case 23:return oS(),null;case 24:return null;default:return null}}var Dv=!1,oo=!1,xz=typeof WeakSet=="function"?WeakSet:Set,Lt=null;function Gp(t,e){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(i){$r(t,e,i)}else n.current=null}function Ub(t,e,n){try{n()}catch(i){$r(t,e,i)}}var E2=!1;function wz(t,e){if(Eb=_0,t=GA(),zE(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var i=n.getSelection&&n.getSelection();if(i&&i.rangeCount!==0){n=i.anchorNode;var u=i.anchorOffset,h=i.focusNode;i=i.focusOffset;try{n.nodeType,h.nodeType}catch{n=null;break e}var d=0,s=-1,w=-1,T=0,A=0,D=t,R=null;t:for(;;){for(var G;D!==n||u!==0&&D.nodeType!==3||(s=d+u),D!==h||i!==0&&D.nodeType!==3||(w=d+i),D.nodeType===3&&(d+=D.nodeValue.length),(G=D.firstChild)!==null;)R=D,D=G;for(;;){if(D===t)break t;if(R===n&&++T===u&&(s=d),R===h&&++A===i&&(w=d),(G=D.nextSibling)!==null)break;D=R,R=D.parentNode}D=G}n=s===-1||w===-1?null:{start:s,end:w}}else n=null}n=n||{start:0,end:0}}else n=null;for(Sb={focusedElem:t,selectionRange:n},_0=!1,Lt=e;Lt!==null;)if(e=Lt,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,Lt=t;else for(;Lt!==null;){e=Lt;try{var $=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if($!==null){var ie=$.memoizedProps,_e=$.memoizedState,Y=e.stateNode,B=Y.getSnapshotBeforeUpdate(e.elementType===e.type?ie:ka(e.type,ie),_e);Y.__reactInternalSnapshotBeforeUpdate=B}break;case 3:var q=e.stateNode.containerInfo;q.nodeType===1?q.textContent="":q.nodeType===9&&q.documentElement&&q.removeChild(q.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(dt(163))}}catch(oe){$r(e,e.return,oe)}if(t=e.sibling,t!==null){t.return=e.return,Lt=t;break}Lt=e.return}return $=E2,E2=!1,$}function Xg(t,e,n){var i=e.updateQueue;if(i=i!==null?i.lastEffect:null,i!==null){var u=i=i.next;do{if((u.tag&t)===t){var h=u.destroy;u.destroy=void 0,h!==void 0&&Ub(e,n,h)}u=u.next}while(u!==i)}}function dx(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var i=n.create;n.destroy=i()}n=n.next}while(n!==e)}}function Vb(t){var e=t.ref;if(e!==null){var n=t.stateNode;switch(t.tag){case 5:t=n;break;default:t=n}typeof e=="function"?e(t):e.current=t}}function UP(t){var e=t.alternate;e!==null&&(t.alternate=null,UP(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[Ml],delete e[i_],delete e[Ib],delete e[rz],delete e[iz])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function VP(t){return t.tag===5||t.tag===3||t.tag===4}function S2(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||VP(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function jb(t,e,n){var i=t.tag;if(i===5||i===6)t=t.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=x0));else if(i!==4&&(t=t.child,t!==null))for(jb(t,e,n),t=t.sibling;t!==null;)jb(t,e,n),t=t.sibling}function Gb(t,e,n){var i=t.tag;if(i===5||i===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(i!==4&&(t=t.child,t!==null))for(Gb(t,e,n),t=t.sibling;t!==null;)Gb(t,e,n),t=t.sibling}var Ui=null,Oa=!1;function _c(t,e,n){for(n=n.child;n!==null;)jP(t,e,n),n=n.sibling}function jP(t,e,n){if(Pl&&typeof Pl.onCommitFiberUnmount=="function")try{Pl.onCommitFiberUnmount(sx,n)}catch{}switch(n.tag){case 5:oo||Gp(n,e);case 6:var i=Ui,u=Oa;Ui=null,_c(t,e,n),Ui=i,Oa=u,Ui!==null&&(Oa?(t=Ui,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):Ui.removeChild(n.stateNode));break;case 18:Ui!==null&&(Oa?(t=Ui,n=n.stateNode,t.nodeType===8?Rw(t.parentNode,n):t.nodeType===1&&Rw(t,n),Qg(t)):Rw(Ui,n.stateNode));break;case 4:i=Ui,u=Oa,Ui=n.stateNode.containerInfo,Oa=!0,_c(t,e,n),Ui=i,Oa=u;break;case 0:case 11:case 14:case 15:if(!oo&&(i=n.updateQueue,i!==null&&(i=i.lastEffect,i!==null))){u=i=i.next;do{var h=u,d=h.destroy;h=h.tag,d!==void 0&&(h&2||h&4)&&Ub(n,e,d),u=u.next}while(u!==i)}_c(t,e,n);break;case 1:if(!oo&&(Gp(n,e),i=n.stateNode,typeof i.componentWillUnmount=="function"))try{i.props=n.memoizedProps,i.state=n.memoizedState,i.componentWillUnmount()}catch(s){$r(n,e,s)}_c(t,e,n);break;case 21:_c(t,e,n);break;case 22:n.mode&1?(oo=(i=oo)||n.memoizedState!==null,_c(t,e,n),oo=i):_c(t,e,n);break;default:_c(t,e,n)}}function T2(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new xz),e.forEach(function(i){var u=Pz.bind(null,t,i);n.has(i)||(n.add(i),i.then(u,u))})}}function Na(t,e){var n=e.deletions;if(n!==null)for(var i=0;i<n.length;i++){var u=n[i];try{var h=t,d=e,s=d;e:for(;s!==null;){switch(s.tag){case 5:Ui=s.stateNode,Oa=!1;break e;case 3:Ui=s.stateNode.containerInfo,Oa=!0;break e;case 4:Ui=s.stateNode.containerInfo,Oa=!0;break e}s=s.return}if(Ui===null)throw Error(dt(160));jP(h,d,u),Ui=null,Oa=!1;var w=u.alternate;w!==null&&(w.return=null),u.return=null}catch(T){$r(u,e,T)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)GP(e,t),e=e.sibling}function GP(t,e){var n=t.alternate,i=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(Na(e,t),xl(t),i&4){try{Xg(3,t,t.return),dx(3,t)}catch(ie){$r(t,t.return,ie)}try{Xg(5,t,t.return)}catch(ie){$r(t,t.return,ie)}}break;case 1:Na(e,t),xl(t),i&512&&n!==null&&Gp(n,n.return);break;case 5:if(Na(e,t),xl(t),i&512&&n!==null&&Gp(n,n.return),t.flags&32){var u=t.stateNode;try{Hg(u,"")}catch(ie){$r(t,t.return,ie)}}if(i&4&&(u=t.stateNode,u!=null)){var h=t.memoizedProps,d=n!==null?n.memoizedProps:h,s=t.type,w=t.updateQueue;if(t.updateQueue=null,w!==null)try{s==="input"&&h.type==="radio"&&h.name!=null&&cA(u,h),pb(s,d);var T=pb(s,h);for(d=0;d<w.length;d+=2){var A=w[d],D=w[d+1];A==="style"?mA(u,D):A==="dangerouslySetInnerHTML"?pA(u,D):A==="children"?Hg(u,D):SE(u,A,D,T)}switch(s){case"input":lb(u,h);break;case"textarea":hA(u,h);break;case"select":var R=u._wrapperState.wasMultiple;u._wrapperState.wasMultiple=!!h.multiple;var G=h.value;G!=null?Wp(u,!!h.multiple,G,!1):R!==!!h.multiple&&(h.defaultValue!=null?Wp(u,!!h.multiple,h.defaultValue,!0):Wp(u,!!h.multiple,h.multiple?[]:"",!1))}u[i_]=h}catch(ie){$r(t,t.return,ie)}}break;case 6:if(Na(e,t),xl(t),i&4){if(t.stateNode===null)throw Error(dt(162));u=t.stateNode,h=t.memoizedProps;try{u.nodeValue=h}catch(ie){$r(t,t.return,ie)}}break;case 3:if(Na(e,t),xl(t),i&4&&n!==null&&n.memoizedState.isDehydrated)try{Qg(e.containerInfo)}catch(ie){$r(t,t.return,ie)}break;case 4:Na(e,t),xl(t);break;case 13:Na(e,t),xl(t),u=t.child,u.flags&8192&&(h=u.memoizedState!==null,u.stateNode.isHidden=h,!h||u.alternate!==null&&u.alternate.memoizedState!==null||(rS=Zr())),i&4&&T2(t);break;case 22:if(A=n!==null&&n.memoizedState!==null,t.mode&1?(oo=(T=oo)||A,Na(e,t),oo=T):Na(e,t),xl(t),i&8192){if(T=t.memoizedState!==null,(t.stateNode.isHidden=T)&&!A&&t.mode&1)for(Lt=t,A=t.child;A!==null;){for(D=Lt=A;Lt!==null;){switch(R=Lt,G=R.child,R.tag){case 0:case 11:case 14:case 15:Xg(4,R,R.return);break;case 1:Gp(R,R.return);var $=R.stateNode;if(typeof $.componentWillUnmount=="function"){i=R,n=R.return;try{e=i,$.props=e.memoizedProps,$.state=e.memoizedState,$.componentWillUnmount()}catch(ie){$r(i,n,ie)}}break;case 5:Gp(R,R.return);break;case 22:if(R.memoizedState!==null){I2(D);continue}}G!==null?(G.return=R,Lt=G):I2(D)}A=A.sibling}e:for(A=null,D=t;;){if(D.tag===5){if(A===null){A=D;try{u=D.stateNode,T?(h=u.style,typeof h.setProperty=="function"?h.setProperty("display","none","important"):h.display="none"):(s=D.stateNode,w=D.memoizedProps.style,d=w!=null&&w.hasOwnProperty("display")?w.display:null,s.style.display=dA("display",d))}catch(ie){$r(t,t.return,ie)}}}else if(D.tag===6){if(A===null)try{D.stateNode.nodeValue=T?"":D.memoizedProps}catch(ie){$r(t,t.return,ie)}}else if((D.tag!==22&&D.tag!==23||D.memoizedState===null||D===t)&&D.child!==null){D.child.return=D,D=D.child;continue}if(D===t)break e;for(;D.sibling===null;){if(D.return===null||D.return===t)break e;A===D&&(A=null),D=D.return}A===D&&(A=null),D.sibling.return=D.return,D=D.sibling}}break;case 19:Na(e,t),xl(t),i&4&&T2(t);break;case 21:break;default:Na(e,t),xl(t)}}function xl(t){var e=t.flags;if(e&2){try{e:{for(var n=t.return;n!==null;){if(VP(n)){var i=n;break e}n=n.return}throw Error(dt(160))}switch(i.tag){case 5:var u=i.stateNode;i.flags&32&&(Hg(u,""),i.flags&=-33);var h=S2(t);Gb(t,h,u);break;case 3:case 4:var d=i.stateNode.containerInfo,s=S2(t);jb(t,s,d);break;default:throw Error(dt(161))}}catch(w){$r(t,t.return,w)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function bz(t,e,n){Lt=t,qP(t)}function qP(t,e,n){for(var i=(t.mode&1)!==0;Lt!==null;){var u=Lt,h=u.child;if(u.tag===22&&i){var d=u.memoizedState!==null||Dv;if(!d){var s=u.alternate,w=s!==null&&s.memoizedState!==null||oo;s=Dv;var T=oo;if(Dv=d,(oo=w)&&!T)for(Lt=u;Lt!==null;)d=Lt,w=d.child,d.tag===22&&d.memoizedState!==null?M2(u):w!==null?(w.return=d,Lt=w):M2(u);for(;h!==null;)Lt=h,qP(h),h=h.sibling;Lt=u,Dv=s,oo=T}C2(t)}else u.subtreeFlags&8772&&h!==null?(h.return=u,Lt=h):C2(t)}}function C2(t){for(;Lt!==null;){var e=Lt;if(e.flags&8772){var n=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:oo||dx(5,e);break;case 1:var i=e.stateNode;if(e.flags&4&&!oo)if(n===null)i.componentDidMount();else{var u=e.elementType===e.type?n.memoizedProps:ka(e.type,n.memoizedProps);i.componentDidUpdate(u,n.memoizedState,i.__reactInternalSnapshotBeforeUpdate)}var h=e.updateQueue;h!==null&&u2(e,h,i);break;case 3:var d=e.updateQueue;if(d!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}u2(e,d,n)}break;case 5:var s=e.stateNode;if(n===null&&e.flags&4){n=s;var w=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":w.autoFocus&&n.focus();break;case"img":w.src&&(n.src=w.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var T=e.alternate;if(T!==null){var A=T.memoizedState;if(A!==null){var D=A.dehydrated;D!==null&&Qg(D)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(dt(163))}oo||e.flags&512&&Vb(e)}catch(R){$r(e,e.return,R)}}if(e===t){Lt=null;break}if(n=e.sibling,n!==null){n.return=e.return,Lt=n;break}Lt=e.return}}function I2(t){for(;Lt!==null;){var e=Lt;if(e===t){Lt=null;break}var n=e.sibling;if(n!==null){n.return=e.return,Lt=n;break}Lt=e.return}}function M2(t){for(;Lt!==null;){var e=Lt;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{dx(4,e)}catch(w){$r(e,n,w)}break;case 1:var i=e.stateNode;if(typeof i.componentDidMount=="function"){var u=e.return;try{i.componentDidMount()}catch(w){$r(e,u,w)}}var h=e.return;try{Vb(e)}catch(w){$r(e,h,w)}break;case 5:var d=e.return;try{Vb(e)}catch(w){$r(e,d,w)}}}catch(w){$r(e,e.return,w)}if(e===t){Lt=null;break}var s=e.sibling;if(s!==null){s.return=e.return,Lt=s;break}Lt=e.return}}var Ez=Math.ceil,L0=ku.ReactCurrentDispatcher,tS=ku.ReactCurrentOwner,Hs=ku.ReactCurrentBatchConfig,Ln=0,Li=null,oi=null,Gi=0,cs=0,qp=Wc(0),gi=0,c_=null,sf=0,mx=0,nS=0,$g=null,Go=null,rS=0,ad=1/0,fu=null,D0=!1,qb=null,Lc=null,Rv=!1,Tc=null,R0=0,Zg=0,Xb=null,n0=-1,r0=0;function wo(){return Ln&6?Zr():n0!==-1?n0:n0=Zr()}function Dc(t){return t.mode&1?Ln&2&&Gi!==0?Gi&-Gi:sz.transition!==null?(r0===0&&(r0=IA()),r0):(t=Yn,t!==0||(t=window.event,t=t===void 0?16:NA(t.type)),t):1}function Ga(t,e,n,i){if(50<Zg)throw Zg=0,Xb=null,Error(dt(185));D_(t,n,i),(!(Ln&2)||t!==Li)&&(t===Li&&(!(Ln&2)&&(mx|=n),gi===4&&Ec(t,Gi)),Wo(t,i),n===1&&Ln===0&&!(e.mode&1)&&(ad=Zr()+500,hx&&Hc()))}function Wo(t,e){var n=t.callbackNode;sO(t,e);var i=g0(t,t===Li?Gi:0);if(i===0)n!==null&&zI(n),t.callbackNode=null,t.callbackPriority=0;else if(e=i&-i,t.callbackPriority!==e){if(n!=null&&zI(n),e===1)t.tag===0?oz(A2.bind(null,t)):QA(A2.bind(null,t)),tz(function(){!(Ln&6)&&Hc()}),n=null;else{switch(MA(i)){case 1:n=AE;break;case 4:n=TA;break;case 16:n=m0;break;case 536870912:n=CA;break;default:n=m0}n=JP(n,XP.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function XP(t,e){if(n0=-1,r0=0,Ln&6)throw Error(dt(327));var n=t.callbackNode;if(Qp()&&t.callbackNode!==n)return null;var i=g0(t,t===Li?Gi:0);if(i===0)return null;if(i&30||i&t.expiredLanes||e)e=N0(t,i);else{e=i;var u=Ln;Ln|=2;var h=ZP();(Li!==t||Gi!==e)&&(fu=null,ad=Zr()+500,Qh(t,e));do try{Cz();break}catch(s){$P(t,s)}while(1);jE(),L0.current=h,Ln=u,oi!==null?e=0:(Li=null,Gi=0,e=gi)}if(e!==0){if(e===2&&(u=yb(t),u!==0&&(i=u,e=$b(t,u))),e===1)throw n=c_,Qh(t,0),Ec(t,i),Wo(t,Zr()),n;if(e===6)Ec(t,i);else{if(u=t.current.alternate,!(i&30)&&!Sz(u)&&(e=N0(t,i),e===2&&(h=yb(t),h!==0&&(i=h,e=$b(t,h))),e===1))throw n=c_,Qh(t,0),Ec(t,i),Wo(t,Zr()),n;switch(t.finishedWork=u,t.finishedLanes=i,e){case 0:case 1:throw Error(dt(345));case 2:$h(t,Go,fu);break;case 3:if(Ec(t,i),(i&130023424)===i&&(e=rS+500-Zr(),10<e)){if(g0(t,0)!==0)break;if(u=t.suspendedLanes,(u&i)!==i){wo(),t.pingedLanes|=t.suspendedLanes&u;break}t.timeoutHandle=Cb($h.bind(null,t,Go,fu),e);break}$h(t,Go,fu);break;case 4:if(Ec(t,i),(i&4194240)===i)break;for(e=t.eventTimes,u=-1;0<i;){var d=31-ja(i);h=1<<d,d=e[d],d>u&&(u=d),i&=~h}if(i=u,i=Zr()-i,i=(120>i?120:480>i?480:1080>i?1080:1920>i?1920:3e3>i?3e3:4320>i?4320:1960*Ez(i/1960))-i,10<i){t.timeoutHandle=Cb($h.bind(null,t,Go,fu),i);break}$h(t,Go,fu);break;case 5:$h(t,Go,fu);break;default:throw Error(dt(329))}}}return Wo(t,Zr()),t.callbackNode===n?XP.bind(null,t):null}function $b(t,e){var n=$g;return t.current.memoizedState.isDehydrated&&(Qh(t,e).flags|=256),t=N0(t,e),t!==2&&(e=Go,Go=n,e!==null&&Zb(e)),t}function Zb(t){Go===null?Go=t:Go.push.apply(Go,t)}function Sz(t){for(var e=t;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var i=0;i<n.length;i++){var u=n[i],h=u.getSnapshot;u=u.value;try{if(!$a(h(),u))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Ec(t,e){for(e&=~nS,e&=~mx,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-ja(e),i=1<<n;t[n]=-1,e&=~i}}function A2(t){if(Ln&6)throw Error(dt(327));Qp();var e=g0(t,0);if(!(e&1))return Wo(t,Zr()),null;var n=N0(t,e);if(t.tag!==0&&n===2){var i=yb(t);i!==0&&(e=i,n=$b(t,i))}if(n===1)throw n=c_,Qh(t,0),Ec(t,e),Wo(t,Zr()),n;if(n===6)throw Error(dt(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,$h(t,Go,fu),Wo(t,Zr()),null}function iS(t,e){var n=Ln;Ln|=1;try{return t(e)}finally{Ln=n,Ln===0&&(ad=Zr()+500,hx&&Hc())}}function af(t){Tc!==null&&Tc.tag===0&&!(Ln&6)&&Qp();var e=Ln;Ln|=1;var n=Hs.transition,i=Yn;try{if(Hs.transition=null,Yn=1,t)return t()}finally{Yn=i,Hs.transition=n,Ln=e,!(Ln&6)&&Hc()}}function oS(){cs=qp.current,mr(qp)}function Qh(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,ez(n)),oi!==null)for(n=oi.return;n!==null;){var i=n;switch(BE(i),i.tag){case 1:i=i.type.childContextTypes,i!=null&&w0();break;case 3:od(),mr($o),mr(ao),WE();break;case 5:ZE(i);break;case 4:od();break;case 13:mr(kr);break;case 19:mr(kr);break;case 10:GE(i.type._context);break;case 22:case 23:oS()}n=n.return}if(Li=t,oi=t=Rc(t.current,null),Gi=cs=e,gi=0,c_=null,nS=mx=sf=0,Go=$g=null,Yh!==null){for(e=0;e<Yh.length;e++)if(n=Yh[e],i=n.interleaved,i!==null){n.interleaved=null;var u=i.next,h=n.pending;if(h!==null){var d=h.next;h.next=u,i.next=d}n.pending=i}Yh=null}return t}function $P(t,e){do{var n=oi;try{if(jE(),Qv.current=P0,A0){for(var i=Ur.memoizedState;i!==null;){var u=i.queue;u!==null&&(u.pending=null),i=i.next}A0=!1}if(of=0,Ci=mi=Ur=null,qg=!1,a_=0,tS.current=null,n===null||n.return===null){gi=1,c_=e,oi=null;break}e:{var h=t,d=n.return,s=n,w=e;if(e=Gi,s.flags|=32768,w!==null&&typeof w=="object"&&typeof w.then=="function"){var T=w,A=s,D=A.tag;if(!(A.mode&1)&&(D===0||D===11||D===15)){var R=A.alternate;R?(A.updateQueue=R.updateQueue,A.memoizedState=R.memoizedState,A.lanes=R.lanes):(A.updateQueue=null,A.memoizedState=null)}var G=g2(d);if(G!==null){G.flags&=-257,_2(G,d,s,h,e),G.mode&1&&m2(h,T,e),e=G,w=T;var $=e.updateQueue;if($===null){var ie=new Set;ie.add(w),e.updateQueue=ie}else $.add(w);break e}else{if(!(e&1)){m2(h,T,e),sS();break e}w=Error(dt(426))}}else if(br&&s.mode&1){var _e=g2(d);if(_e!==null){!(_e.flags&65536)&&(_e.flags|=256),_2(_e,d,s,h,e),UE(sd(w,s));break e}}h=w=sd(w,s),gi!==4&&(gi=2),$g===null?$g=[h]:$g.push(h),h=d;do{switch(h.tag){case 3:h.flags|=65536,e&=-e,h.lanes|=e;var Y=AP(h,w,e);l2(h,Y);break e;case 1:s=w;var B=h.type,q=h.stateNode;if(!(h.flags&128)&&(typeof B.getDerivedStateFromError=="function"||q!==null&&typeof q.componentDidCatch=="function"&&(Lc===null||!Lc.has(q)))){h.flags|=65536,e&=-e,h.lanes|=e;var oe=PP(h,s,e);l2(h,oe);break e}}h=h.return}while(h!==null)}HP(n)}catch(de){e=de,oi===n&&n!==null&&(oi=n=n.return);continue}break}while(1)}function ZP(){var t=L0.current;return L0.current=P0,t===null?P0:t}function sS(){(gi===0||gi===3||gi===2)&&(gi=4),Li===null||!(sf&268435455)&&!(mx&268435455)||Ec(Li,Gi)}function N0(t,e){var n=Ln;Ln|=2;var i=ZP();(Li!==t||Gi!==e)&&(fu=null,Qh(t,e));do try{Tz();break}catch(u){$P(t,u)}while(1);if(jE(),Ln=n,L0.current=i,oi!==null)throw Error(dt(261));return Li=null,Gi=0,gi}function Tz(){for(;oi!==null;)WP(oi)}function Cz(){for(;oi!==null&&!Kk();)WP(oi)}function WP(t){var e=KP(t.alternate,t,cs);t.memoizedProps=t.pendingProps,e===null?HP(t):oi=e,tS.current=null}function HP(t){var e=t;do{var n=e.alternate;if(t=e.return,e.flags&32768){if(n=vz(n,e),n!==null){n.flags&=32767,oi=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{gi=6,oi=null;return}}else if(n=yz(n,e,cs),n!==null){oi=n;return}if(e=e.sibling,e!==null){oi=e;return}oi=e=t}while(e!==null);gi===0&&(gi=5)}function $h(t,e,n){var i=Yn,u=Hs.transition;try{Hs.transition=null,Yn=1,Iz(t,e,n,i)}finally{Hs.transition=u,Yn=i}return null}function Iz(t,e,n,i){do Qp();while(Tc!==null);if(Ln&6)throw Error(dt(327));n=t.finishedWork;var u=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(dt(177));t.callbackNode=null,t.callbackPriority=0;var h=n.lanes|n.childLanes;if(aO(t,h),t===Li&&(oi=Li=null,Gi=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||Rv||(Rv=!0,JP(m0,function(){return Qp(),null})),h=(n.flags&15990)!==0,n.subtreeFlags&15990||h){h=Hs.transition,Hs.transition=null;var d=Yn;Yn=1;var s=Ln;Ln|=4,tS.current=null,wz(t,n),GP(n,t),ZO(Sb),_0=!!Eb,Sb=Eb=null,t.current=n,bz(n),Jk(),Ln=s,Yn=d,Hs.transition=h}else t.current=n;if(Rv&&(Rv=!1,Tc=t,R0=u),h=t.pendingLanes,h===0&&(Lc=null),tO(n.stateNode),Wo(t,Zr()),e!==null)for(i=t.onRecoverableError,n=0;n<e.length;n++)u=e[n],i(u.value,{componentStack:u.stack,digest:u.digest});if(D0)throw D0=!1,t=qb,qb=null,t;return R0&1&&t.tag!==0&&Qp(),h=t.pendingLanes,h&1?t===Xb?Zg++:(Zg=0,Xb=t):Zg=0,Hc(),null}function Qp(){if(Tc!==null){var t=MA(R0),e=Hs.transition,n=Yn;try{if(Hs.transition=null,Yn=16>t?16:t,Tc===null)var i=!1;else{if(t=Tc,Tc=null,R0=0,Ln&6)throw Error(dt(331));var u=Ln;for(Ln|=4,Lt=t.current;Lt!==null;){var h=Lt,d=h.child;if(Lt.flags&16){var s=h.deletions;if(s!==null){for(var w=0;w<s.length;w++){var T=s[w];for(Lt=T;Lt!==null;){var A=Lt;switch(A.tag){case 0:case 11:case 15:Xg(8,A,h)}var D=A.child;if(D!==null)D.return=A,Lt=D;else for(;Lt!==null;){A=Lt;var R=A.sibling,G=A.return;if(UP(A),A===T){Lt=null;break}if(R!==null){R.return=G,Lt=R;break}Lt=G}}}var $=h.alternate;if($!==null){var ie=$.child;if(ie!==null){$.child=null;do{var _e=ie.sibling;ie.sibling=null,ie=_e}while(ie!==null)}}Lt=h}}if(h.subtreeFlags&2064&&d!==null)d.return=h,Lt=d;else e:for(;Lt!==null;){if(h=Lt,h.flags&2048)switch(h.tag){case 0:case 11:case 15:Xg(9,h,h.return)}var Y=h.sibling;if(Y!==null){Y.return=h.return,Lt=Y;break e}Lt=h.return}}var B=t.current;for(Lt=B;Lt!==null;){d=Lt;var q=d.child;if(d.subtreeFlags&2064&&q!==null)q.return=d,Lt=q;else e:for(d=B;Lt!==null;){if(s=Lt,s.flags&2048)try{switch(s.tag){case 0:case 11:case 15:dx(9,s)}}catch(de){$r(s,s.return,de)}if(s===d){Lt=null;break e}var oe=s.sibling;if(oe!==null){oe.return=s.return,Lt=oe;break e}Lt=s.return}}if(Ln=u,Hc(),Pl&&typeof Pl.onPostCommitFiberRoot=="function")try{Pl.onPostCommitFiberRoot(sx,t)}catch{}i=!0}return i}finally{Yn=n,Hs.transition=e}}return!1}function P2(t,e,n){e=sd(n,e),e=AP(t,e,1),t=Pc(t,e,1),e=wo(),t!==null&&(D_(t,1,e),Wo(t,e))}function $r(t,e,n){if(t.tag===3)P2(t,t,n);else for(;e!==null;){if(e.tag===3){P2(e,t,n);break}else if(e.tag===1){var i=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof i.componentDidCatch=="function"&&(Lc===null||!Lc.has(i))){t=sd(n,t),t=PP(e,t,1),e=Pc(e,t,1),t=wo(),e!==null&&(D_(e,1,t),Wo(e,t));break}}e=e.return}}function Mz(t,e,n){var i=t.pingCache;i!==null&&i.delete(e),e=wo(),t.pingedLanes|=t.suspendedLanes&n,Li===t&&(Gi&n)===n&&(gi===4||gi===3&&(Gi&130023424)===Gi&&500>Zr()-rS?Qh(t,0):nS|=n),Wo(t,e)}function YP(t,e){e===0&&(t.mode&1?(e=Ev,Ev<<=1,!(Ev&130023424)&&(Ev=4194304)):e=1);var n=wo();t=bu(t,e),t!==null&&(D_(t,e,n),Wo(t,n))}function Az(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),YP(t,n)}function Pz(t,e){var n=0;switch(t.tag){case 13:var i=t.stateNode,u=t.memoizedState;u!==null&&(n=u.retryLane);break;case 19:i=t.stateNode;break;default:throw Error(dt(314))}i!==null&&i.delete(e),YP(t,n)}var KP;KP=function(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps||$o.current)qo=!0;else{if(!(t.lanes&n)&&!(e.flags&128))return qo=!1,_z(t,e,n);qo=!!(t.flags&131072)}else qo=!1,br&&e.flags&1048576&&eP(e,S0,e.index);switch(e.lanes=0,e.tag){case 2:var i=e.type;t0(t,e),t=e.pendingProps;var u=nd(e,ao.current);Jp(e,n),u=YE(null,e,i,t,u,n);var h=KE();return e.flags|=1,typeof u=="object"&&u!==null&&typeof u.render=="function"&&u.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,Zo(i)?(h=!0,b0(e)):h=!1,e.memoizedState=u.state!==null&&u.state!==void 0?u.state:null,XE(e),u.updater=fx,e.stateNode=u,u._reactInternals=e,Rb(e,i,t,n),e=Ob(null,e,i,!0,h,n)):(e.tag=0,br&&h&&FE(e),yo(null,e,u,n),e=e.child),e;case 16:i=e.elementType;e:{switch(t0(t,e),t=e.pendingProps,u=i._init,i=u(i._payload),e.type=i,u=e.tag=Dz(i),t=ka(i,t),u){case 0:e=kb(null,e,i,t,n);break e;case 1:e=x2(null,e,i,t,n);break e;case 11:e=y2(null,e,i,t,n);break e;case 14:e=v2(null,e,i,ka(i.type,t),n);break e}throw Error(dt(306,i,""))}return e;case 0:return i=e.type,u=e.pendingProps,u=e.elementType===i?u:ka(i,u),kb(t,e,i,u,n);case 1:return i=e.type,u=e.pendingProps,u=e.elementType===i?u:ka(i,u),x2(t,e,i,u,n);case 3:e:{if(NP(e),t===null)throw Error(dt(387));i=e.pendingProps,h=e.memoizedState,u=h.element,iP(t,e),I0(e,i,null,n);var d=e.memoizedState;if(i=d.element,h.isDehydrated)if(h={element:i,isDehydrated:!1,cache:d.cache,pendingSuspenseBoundaries:d.pendingSuspenseBoundaries,transitions:d.transitions},e.updateQueue.baseState=h,e.memoizedState=h,e.flags&256){u=sd(Error(dt(423)),e),e=w2(t,e,i,n,u);break e}else if(i!==u){u=sd(Error(dt(424)),e),e=w2(t,e,i,n,u);break e}else for(ps=Ac(e.stateNode.containerInfo.firstChild),ds=e,br=!0,za=null,n=lP(e,null,i,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(rd(),i===u){e=Eu(t,e,n);break e}yo(t,e,i,n)}e=e.child}return e;case 5:return uP(e),t===null&&Pb(e),i=e.type,u=e.pendingProps,h=t!==null?t.memoizedProps:null,d=u.children,Tb(i,u)?d=null:h!==null&&Tb(i,h)&&(e.flags|=32),RP(t,e),yo(t,e,d,n),e.child;case 6:return t===null&&Pb(e),null;case 13:return kP(t,e,n);case 4:return $E(e,e.stateNode.containerInfo),i=e.pendingProps,t===null?e.child=id(e,null,i,n):yo(t,e,i,n),e.child;case 11:return i=e.type,u=e.pendingProps,u=e.elementType===i?u:ka(i,u),y2(t,e,i,u,n);case 7:return yo(t,e,e.pendingProps,n),e.child;case 8:return yo(t,e,e.pendingProps.children,n),e.child;case 12:return yo(t,e,e.pendingProps.children,n),e.child;case 10:e:{if(i=e.type._context,u=e.pendingProps,h=e.memoizedProps,d=u.value,ur(T0,i._currentValue),i._currentValue=d,h!==null)if($a(h.value,d)){if(h.children===u.children&&!$o.current){e=Eu(t,e,n);break e}}else for(h=e.child,h!==null&&(h.return=e);h!==null;){var s=h.dependencies;if(s!==null){d=h.child;for(var w=s.firstContext;w!==null;){if(w.context===i){if(h.tag===1){w=_u(-1,n&-n),w.tag=2;var T=h.updateQueue;if(T!==null){T=T.shared;var A=T.pending;A===null?w.next=w:(w.next=A.next,A.next=w),T.pending=w}}h.lanes|=n,w=h.alternate,w!==null&&(w.lanes|=n),Lb(h.return,n,e),s.lanes|=n;break}w=w.next}}else if(h.tag===10)d=h.type===e.type?null:h.child;else if(h.tag===18){if(d=h.return,d===null)throw Error(dt(341));d.lanes|=n,s=d.alternate,s!==null&&(s.lanes|=n),Lb(d,n,e),d=h.sibling}else d=h.child;if(d!==null)d.return=h;else for(d=h;d!==null;){if(d===e){d=null;break}if(h=d.sibling,h!==null){h.return=d.return,d=h;break}d=d.return}h=d}yo(t,e,u.children,n),e=e.child}return e;case 9:return u=e.type,i=e.pendingProps.children,Jp(e,n),u=Js(u),i=i(u),e.flags|=1,yo(t,e,i,n),e.child;case 14:return i=e.type,u=ka(i,e.pendingProps),u=ka(i.type,u),v2(t,e,i,u,n);case 15:return LP(t,e,e.type,e.pendingProps,n);case 17:return i=e.type,u=e.pendingProps,u=e.elementType===i?u:ka(i,u),t0(t,e),e.tag=1,Zo(i)?(t=!0,b0(e)):t=!1,Jp(e,n),sP(e,i,u),Rb(e,i,u,n),Ob(null,e,i,!0,t,n);case 19:return OP(t,e,n);case 22:return DP(t,e,n)}throw Error(dt(156,e.tag))};function JP(t,e){return SA(t,e)}function Lz(t,e,n,i){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Ws(t,e,n,i){return new Lz(t,e,n,i)}function aS(t){return t=t.prototype,!(!t||!t.isReactComponent)}function Dz(t){if(typeof t=="function")return aS(t)?1:0;if(t!=null){if(t=t.$$typeof,t===CE)return 11;if(t===IE)return 14}return 2}function Rc(t,e){var n=t.alternate;return n===null?(n=Ws(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function i0(t,e,n,i,u,h){var d=2;if(i=t,typeof t=="function")aS(t)&&(d=1);else if(typeof t=="string")d=5;else e:switch(t){case Np:return ef(n.children,u,h,e);case TE:d=8,u|=8;break;case rb:return t=Ws(12,n,e,u|2),t.elementType=rb,t.lanes=h,t;case ib:return t=Ws(13,n,e,u),t.elementType=ib,t.lanes=h,t;case ob:return t=Ws(19,n,e,u),t.elementType=ob,t.lanes=h,t;case aA:return gx(n,u,h,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case oA:d=10;break e;case sA:d=9;break e;case CE:d=11;break e;case IE:d=14;break e;case xc:d=16,i=null;break e}throw Error(dt(130,t==null?t:typeof t,""))}return e=Ws(d,n,e,u),e.elementType=t,e.type=i,e.lanes=h,e}function ef(t,e,n,i){return t=Ws(7,t,i,e),t.lanes=n,t}function gx(t,e,n,i){return t=Ws(22,t,i,e),t.elementType=aA,t.lanes=n,t.stateNode={isHidden:!1},t}function Vw(t,e,n){return t=Ws(6,t,null,e),t.lanes=n,t}function jw(t,e,n){return e=Ws(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function Rz(t,e,n,i,u){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=bw(0),this.expirationTimes=bw(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=bw(0),this.identifierPrefix=i,this.onRecoverableError=u,this.mutableSourceEagerHydrationData=null}function lS(t,e,n,i,u,h,d,s,w){return t=new Rz(t,e,n,s,w),e===1?(e=1,h===!0&&(e|=8)):e=0,h=Ws(3,null,null,e),t.current=h,h.stateNode=t,h.memoizedState={element:i,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},XE(h),t}function Nz(t,e,n){var i=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Rp,key:i==null?null:""+i,children:t,containerInfo:e,implementation:n}}function QP(t){if(!t)return zc;t=t._reactInternals;e:{if(Sf(t)!==t||t.tag!==1)throw Error(dt(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(Zo(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(dt(171))}if(t.tag===1){var n=t.type;if(Zo(n))return JA(t,n,e)}return e}function eL(t,e,n,i,u,h,d,s,w){return t=lS(n,i,!0,t,u,h,d,s,w),t.context=QP(null),n=t.current,i=wo(),u=Dc(n),h=_u(i,u),h.callback=e??null,Pc(n,h,u),t.current.lanes=u,D_(t,u,i),Wo(t,i),t}function _x(t,e,n,i){var u=e.current,h=wo(),d=Dc(u);return n=QP(n),e.context===null?e.context=n:e.pendingContext=n,e=_u(h,d),e.payload={element:t},i=i===void 0?null:i,i!==null&&(e.callback=i),t=Pc(u,e,d),t!==null&&(Ga(t,u,d,h),Jv(t,u,d)),d}function k0(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function L2(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function uS(t,e){L2(t,e),(t=t.alternate)&&L2(t,e)}function kz(){return null}var tL=typeof reportError=="function"?reportError:function(t){console.error(t)};function cS(t){this._internalRoot=t}yx.prototype.render=cS.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(dt(409));_x(t,e,null,null)};yx.prototype.unmount=cS.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;af(function(){_x(null,t,null,null)}),e[wu]=null}};function yx(t){this._internalRoot=t}yx.prototype.unstable_scheduleHydration=function(t){if(t){var e=LA();t={blockedOn:null,target:t,priority:e};for(var n=0;n<bc.length&&e!==0&&e<bc[n].priority;n++);bc.splice(n,0,t),n===0&&RA(t)}};function hS(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function vx(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function D2(){}function Oz(t,e,n,i,u){if(u){if(typeof i=="function"){var h=i;i=function(){var T=k0(d);h.call(T)}}var d=eL(e,i,t,0,null,!1,!1,"",D2);return t._reactRootContainer=d,t[wu]=d.current,n_(t.nodeType===8?t.parentNode:t),af(),d}for(;u=t.lastChild;)t.removeChild(u);if(typeof i=="function"){var s=i;i=function(){var T=k0(w);s.call(T)}}var w=lS(t,0,!1,null,null,!1,!1,"",D2);return t._reactRootContainer=w,t[wu]=w.current,n_(t.nodeType===8?t.parentNode:t),af(function(){_x(e,w,n,i)}),w}function xx(t,e,n,i,u){var h=n._reactRootContainer;if(h){var d=h;if(typeof u=="function"){var s=u;u=function(){var w=k0(d);s.call(w)}}_x(e,d,t,u)}else d=Oz(n,e,t,u,i);return k0(d)}AA=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=Dg(e.pendingLanes);n!==0&&(PE(e,n|1),Wo(e,Zr()),!(Ln&6)&&(ad=Zr()+500,Hc()))}break;case 13:af(function(){var i=bu(t,1);if(i!==null){var u=wo();Ga(i,t,1,u)}}),uS(t,1)}};LE=function(t){if(t.tag===13){var e=bu(t,134217728);if(e!==null){var n=wo();Ga(e,t,134217728,n)}uS(t,134217728)}};PA=function(t){if(t.tag===13){var e=Dc(t),n=bu(t,e);if(n!==null){var i=wo();Ga(n,t,e,i)}uS(t,e)}};LA=function(){return Yn};DA=function(t,e){var n=Yn;try{return Yn=t,e()}finally{Yn=n}};mb=function(t,e,n){switch(e){case"input":if(lb(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var i=n[e];if(i!==t&&i.form===t.form){var u=cx(i);if(!u)throw Error(dt(90));uA(i),lb(i,u)}}}break;case"textarea":hA(t,n);break;case"select":e=n.value,e!=null&&Wp(t,!!n.multiple,e,!1)}};yA=iS;vA=af;var zz={usingClientEntryPoint:!1,Events:[N_,Fp,cx,gA,_A,iS]},Cg={findFiberByHostInstance:Hh,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},Fz={bundleType:Cg.bundleType,version:Cg.version,rendererPackageName:Cg.rendererPackageName,rendererConfig:Cg.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:ku.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=bA(t),t===null?null:t.stateNode},findFiberByHostInstance:Cg.findFiberByHostInstance||kz,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Nv=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Nv.isDisabled&&Nv.supportsFiber)try{sx=Nv.inject(Fz),Pl=Nv}catch{}}Is.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=zz;Is.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!hS(e))throw Error(dt(200));return Nz(t,e,null,n)};Is.createRoot=function(t,e){if(!hS(t))throw Error(dt(299));var n=!1,i="",u=tL;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(i=e.identifierPrefix),e.onRecoverableError!==void 0&&(u=e.onRecoverableError)),e=lS(t,1,!1,null,null,n,!1,i,u),t[wu]=e.current,n_(t.nodeType===8?t.parentNode:t),new cS(e)};Is.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(dt(188)):(t=Object.keys(t).join(","),Error(dt(268,t)));return t=bA(e),t=t===null?null:t.stateNode,t};Is.flushSync=function(t){return af(t)};Is.hydrate=function(t,e,n){if(!vx(e))throw Error(dt(200));return xx(null,t,e,!0,n)};Is.hydrateRoot=function(t,e,n){if(!hS(t))throw Error(dt(405));var i=n!=null&&n.hydratedSources||null,u=!1,h="",d=tL;if(n!=null&&(n.unstable_strictMode===!0&&(u=!0),n.identifierPrefix!==void 0&&(h=n.identifierPrefix),n.onRecoverableError!==void 0&&(d=n.onRecoverableError)),e=eL(e,null,t,1,n??null,u,!1,h,d),t[wu]=e.current,n_(t),i)for(t=0;t<i.length;t++)n=i[t],u=n._getVersion,u=u(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,u]:e.mutableSourceEagerHydrationData.push(n,u);return new yx(e)};Is.render=function(t,e,n){if(!vx(e))throw Error(dt(200));return xx(null,t,e,!1,n)};Is.unmountComponentAtNode=function(t){if(!vx(t))throw Error(dt(40));return t._reactRootContainer?(af(function(){xx(null,null,t,!1,function(){t._reactRootContainer=null,t[wu]=null})}),!0):!1};Is.unstable_batchedUpdates=iS;Is.unstable_renderSubtreeIntoContainer=function(t,e,n,i){if(!vx(n))throw Error(dt(200));if(t==null||t._reactInternals===void 0)throw Error(dt(38));return xx(t,e,n,!1,i)};Is.version="18.2.0-next-9e3b772b8-20220608";function nL(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(nL)}catch(t){console.error(t)}}nL(),eA.exports=Is;var Bz=eA.exports,R2=Bz;tb.createRoot=R2.createRoot,tb.hydrateRoot=R2.hydrateRoot;function o0(t,e){return t==null||e==null?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function Uz(t,e){return t==null||e==null?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function rL(t){let e,n,i;t.length!==2?(e=o0,n=(s,w)=>o0(t(s),w),i=(s,w)=>t(s)-w):(e=t===o0||t===Uz?t:Vz,n=t,i=t);function u(s,w,T=0,A=s.length){if(T<A){if(e(w,w)!==0)return A;do{const D=T+A>>>1;n(s[D],w)<0?T=D+1:A=D}while(T<A)}return T}function h(s,w,T=0,A=s.length){if(T<A){if(e(w,w)!==0)return A;do{const D=T+A>>>1;n(s[D],w)<=0?T=D+1:A=D}while(T<A)}return T}function d(s,w,T=0,A=s.length){const D=u(s,w,T,A-1);return D>T&&i(s[D-1],w)>-i(s[D],w)?D-1:D}return{left:u,center:d,right:h}}function Vz(){return 0}function jz(t){return t===null?NaN:+t}const Gz=rL(o0),qz=Gz.right;rL(jz).center;const Xz=qz;class N2 extends Map{constructor(e,n=Wz){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:n}}),e!=null)for(const[i,u]of e)this.set(i,u)}get(e){return super.get(k2(this,e))}has(e){return super.has(k2(this,e))}set(e,n){return super.set($z(this,e),n)}delete(e){return super.delete(Zz(this,e))}}function k2({_intern:t,_key:e},n){const i=e(n);return t.has(i)?t.get(i):n}function $z({_intern:t,_key:e},n){const i=e(n);return t.has(i)?t.get(i):(t.set(i,n),n)}function Zz({_intern:t,_key:e},n){const i=e(n);return t.has(i)&&(n=t.get(i),t.delete(i)),n}function Wz(t){return t!==null&&typeof t=="object"?t.valueOf():t}const Hz=Math.sqrt(50),Yz=Math.sqrt(10),Kz=Math.sqrt(2);function O0(t,e,n){const i=(e-t)/Math.max(0,n),u=Math.floor(Math.log10(i)),h=i/Math.pow(10,u),d=h>=Hz?10:h>=Yz?5:h>=Kz?2:1;let s,w,T;return u<0?(T=Math.pow(10,-u)/d,s=Math.round(t*T),w=Math.round(e*T),s/T<t&&++s,w/T>e&&--w,T=-T):(T=Math.pow(10,u)*d,s=Math.round(t/T),w=Math.round(e/T),s*T<t&&++s,w*T>e&&--w),w<s&&.5<=n&&n<2?O0(t,e,n*2):[s,w,T]}function Jz(t,e,n){if(e=+e,t=+t,n=+n,!(n>0))return[];if(t===e)return[t];const i=e<t,[u,h,d]=i?O0(e,t,n):O0(t,e,n);if(!(h>=u))return[];const s=h-u+1,w=new Array(s);if(i)if(d<0)for(let T=0;T<s;++T)w[T]=(h-T)/-d;else for(let T=0;T<s;++T)w[T]=(h-T)*d;else if(d<0)for(let T=0;T<s;++T)w[T]=(u+T)/-d;else for(let T=0;T<s;++T)w[T]=(u+T)*d;return w}function Wb(t,e,n){return e=+e,t=+t,n=+n,O0(t,e,n)[2]}function Qz(t,e,n){e=+e,t=+t,n=+n;const i=e<t,u=i?Wb(e,t,n):Wb(t,e,n);return(i?-1:1)*(u<0?1/-u:u)}function e3(t,e,n){t=+t,e=+e,n=(u=arguments.length)<2?(e=t,t=0,1):u<3?1:+n;for(var i=-1,u=Math.max(0,Math.ceil((e-t)/n))|0,h=new Array(u);++i<u;)h[i]=t+i*n;return h}function t3(t){return t}var Gw=1,qw=2,Hb=3,kv=4,O2=1e-6;function n3(t){return"translate("+t+",0)"}function r3(t){return"translate(0,"+t+")"}function i3(t){return e=>+t(e)}function o3(t,e){return e=Math.max(0,t.bandwidth()-e*2)/2,t.round()&&(e=Math.round(e)),n=>+t(n)+e}function s3(){return!this.__axis}function a3(t,e){var n=[],i=null,u=null,h=6,d=6,s=3,w=typeof window<"u"&&window.devicePixelRatio>1?0:.5,T=t===Gw||t===kv?-1:1,A=t===kv||t===qw?"x":"y",D=t===Gw||t===Hb?n3:r3;function R(G){var $=i??(e.ticks?e.ticks.apply(e,n):e.domain()),ie=u??(e.tickFormat?e.tickFormat.apply(e,n):t3),_e=Math.max(h,0)+s,Y=e.range(),B=+Y[0]+w,q=+Y[Y.length-1]+w,oe=(e.bandwidth?o3:i3)(e.copy(),w),de=G.selection?G.selection():G,we=de.selectAll(".domain").data([null]),Se=de.selectAll(".tick").data($,e).order(),Te=Se.exit(),xe=Se.enter().append("g").attr("class","tick"),et=Se.select("line"),We=Se.select("text");we=we.merge(we.enter().insert("path",".tick").attr("class","domain").attr("stroke","currentColor")),Se=Se.merge(xe),et=et.merge(xe.append("line").attr("stroke","currentColor").attr(A+"2",T*h)),We=We.merge(xe.append("text").attr("fill","currentColor").attr(A,T*_e).attr("dy",t===Gw?"0em":t===Hb?"0.71em":"0.32em")),G!==de&&(we=we.transition(G),Se=Se.transition(G),et=et.transition(G),We=We.transition(G),Te=Te.transition(G).attr("opacity",O2).attr("transform",function(He){return isFinite(He=oe(He))?D(He+w):this.getAttribute("transform")}),xe.attr("opacity",O2).attr("transform",function(He){var $e=this.parentNode.__axis;return D(($e&&isFinite($e=$e(He))?$e:oe(He))+w)})),Te.remove(),we.attr("d",t===kv||t===qw?d?"M"+T*d+","+B+"H"+w+"V"+q+"H"+T*d:"M"+w+","+B+"V"+q:d?"M"+B+","+T*d+"V"+w+"H"+q+"V"+T*d:"M"+B+","+w+"H"+q),Se.attr("opacity",1).attr("transform",function(He){return D(oe(He)+w)}),et.attr(A+"2",T*h),We.attr(A,T*_e).text(ie),de.filter(s3).attr("fill","none").attr("font-size",10).attr("font-family","sans-serif").attr("text-anchor",t===qw?"start":t===kv?"end":"middle"),de.each(function(){this.__axis=oe})}return R.scale=function(G){return arguments.length?(e=G,R):e},R.ticks=function(){return n=Array.from(arguments),R},R.tickArguments=function(G){return arguments.length?(n=G==null?[]:Array.from(G),R):n.slice()},R.tickValues=function(G){return arguments.length?(i=G==null?null:Array.from(G),R):i&&i.slice()},R.tickFormat=function(G){return arguments.length?(u=G,R):u},R.tickSize=function(G){return arguments.length?(h=d=+G,R):h},R.tickSizeInner=function(G){return arguments.length?(h=+G,R):h},R.tickSizeOuter=function(G){return arguments.length?(d=+G,R):d},R.tickPadding=function(G){return arguments.length?(s=+G,R):s},R.offset=function(G){return arguments.length?(w=+G,R):w},R}function iL(t){return a3(Hb,t)}var l3={value:()=>{}};function oL(){for(var t=0,e=arguments.length,n={},i;t<e;++t){if(!(i=arguments[t]+"")||i in n||/[\s.]/.test(i))throw new Error("illegal type: "+i);n[i]=[]}return new s0(n)}function s0(t){this._=t}function u3(t,e){return t.trim().split(/^|\s+/).map(function(n){var i="",u=n.indexOf(".");if(u>=0&&(i=n.slice(u+1),n=n.slice(0,u)),n&&!e.hasOwnProperty(n))throw new Error("unknown type: "+n);return{type:n,name:i}})}s0.prototype=oL.prototype={constructor:s0,on:function(t,e){var n=this._,i=u3(t+"",n),u,h=-1,d=i.length;if(arguments.length<2){for(;++h<d;)if((u=(t=i[h]).type)&&(u=c3(n[u],t.name)))return u;return}if(e!=null&&typeof e!="function")throw new Error("invalid callback: "+e);for(;++h<d;)if(u=(t=i[h]).type)n[u]=z2(n[u],t.name,e);else if(e==null)for(u in n)n[u]=z2(n[u],t.name,null);return this},copy:function(){var t={},e=this._;for(var n in e)t[n]=e[n].slice();return new s0(t)},call:function(t,e){if((u=arguments.length-2)>0)for(var n=new Array(u),i=0,u,h;i<u;++i)n[i]=arguments[i+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(h=this._[t],i=0,u=h.length;i<u;++i)h[i].value.apply(e,n)},apply:function(t,e,n){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var i=this._[t],u=0,h=i.length;u<h;++u)i[u].value.apply(e,n)}};function c3(t,e){for(var n=0,i=t.length,u;n<i;++n)if((u=t[n]).name===e)return u.value}function z2(t,e,n){for(var i=0,u=t.length;i<u;++i)if(t[i].name===e){t[i]=l3,t=t.slice(0,i).concat(t.slice(i+1));break}return n!=null&&t.push({name:e,value:n}),t}var Yb="http://www.w3.org/1999/xhtml";const F2={svg:"http://www.w3.org/2000/svg",xhtml:Yb,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function wx(t){var e=t+="",n=e.indexOf(":");return n>=0&&(e=t.slice(0,n))!=="xmlns"&&(t=t.slice(n+1)),F2.hasOwnProperty(e)?{space:F2[e],local:t}:t}function h3(t){return function(){var e=this.ownerDocument,n=this.namespaceURI;return n===Yb&&e.documentElement.namespaceURI===Yb?e.createElement(t):e.createElementNS(n,t)}}function f3(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function sL(t){var e=wx(t);return(e.local?f3:h3)(e)}function p3(){}function fS(t){return t==null?p3:function(){return this.querySelector(t)}}function d3(t){typeof t!="function"&&(t=fS(t));for(var e=this._groups,n=e.length,i=new Array(n),u=0;u<n;++u)for(var h=e[u],d=h.length,s=i[u]=new Array(d),w,T,A=0;A<d;++A)(w=h[A])&&(T=t.call(w,w.__data__,A,h))&&("__data__"in w&&(T.__data__=w.__data__),s[A]=T);return new ys(i,this._parents)}function m3(t){return t==null?[]:Array.isArray(t)?t:Array.from(t)}function g3(){return[]}function aL(t){return t==null?g3:function(){return this.querySelectorAll(t)}}function _3(t){return function(){return m3(t.apply(this,arguments))}}function y3(t){typeof t=="function"?t=_3(t):t=aL(t);for(var e=this._groups,n=e.length,i=[],u=[],h=0;h<n;++h)for(var d=e[h],s=d.length,w,T=0;T<s;++T)(w=d[T])&&(i.push(t.call(w,w.__data__,T,d)),u.push(w));return new ys(i,u)}function lL(t){return function(){return this.matches(t)}}function uL(t){return function(e){return e.matches(t)}}var v3=Array.prototype.find;function x3(t){return function(){return v3.call(this.children,t)}}function w3(){return this.firstElementChild}function b3(t){return this.select(t==null?w3:x3(typeof t=="function"?t:uL(t)))}var E3=Array.prototype.filter;function S3(){return Array.from(this.children)}function T3(t){return function(){return E3.call(this.children,t)}}function C3(t){return this.selectAll(t==null?S3:T3(typeof t=="function"?t:uL(t)))}function I3(t){typeof t!="function"&&(t=lL(t));for(var e=this._groups,n=e.length,i=new Array(n),u=0;u<n;++u)for(var h=e[u],d=h.length,s=i[u]=[],w,T=0;T<d;++T)(w=h[T])&&t.call(w,w.__data__,T,h)&&s.push(w);return new ys(i,this._parents)}function cL(t){return new Array(t.length)}function M3(){return new ys(this._enter||this._groups.map(cL),this._parents)}function z0(t,e){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=e}z0.prototype={constructor:z0,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,e){return this._parent.insertBefore(t,e)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}};function A3(t){return function(){return t}}function P3(t,e,n,i,u,h){for(var d=0,s,w=e.length,T=h.length;d<T;++d)(s=e[d])?(s.__data__=h[d],i[d]=s):n[d]=new z0(t,h[d]);for(;d<w;++d)(s=e[d])&&(u[d]=s)}function L3(t,e,n,i,u,h,d){var s,w,T=new Map,A=e.length,D=h.length,R=new Array(A),G;for(s=0;s<A;++s)(w=e[s])&&(R[s]=G=d.call(w,w.__data__,s,e)+"",T.has(G)?u[s]=w:T.set(G,w));for(s=0;s<D;++s)G=d.call(t,h[s],s,h)+"",(w=T.get(G))?(i[s]=w,w.__data__=h[s],T.delete(G)):n[s]=new z0(t,h[s]);for(s=0;s<A;++s)(w=e[s])&&T.get(R[s])===w&&(u[s]=w)}function D3(t){return t.__data__}function R3(t,e){if(!arguments.length)return Array.from(this,D3);var n=e?L3:P3,i=this._parents,u=this._groups;typeof t!="function"&&(t=A3(t));for(var h=u.length,d=new Array(h),s=new Array(h),w=new Array(h),T=0;T<h;++T){var A=i[T],D=u[T],R=D.length,G=N3(t.call(A,A&&A.__data__,T,i)),$=G.length,ie=s[T]=new Array($),_e=d[T]=new Array($),Y=w[T]=new Array(R);n(A,D,ie,_e,Y,G,e);for(var B=0,q=0,oe,de;B<$;++B)if(oe=ie[B]){for(B>=q&&(q=B+1);!(de=_e[q])&&++q<$;);oe._next=de||null}}return d=new ys(d,i),d._enter=s,d._exit=w,d}function N3(t){return typeof t=="object"&&"length"in t?t:Array.from(t)}function k3(){return new ys(this._exit||this._groups.map(cL),this._parents)}function O3(t,e,n){var i=this.enter(),u=this,h=this.exit();return typeof t=="function"?(i=t(i),i&&(i=i.selection())):i=i.append(t+""),e!=null&&(u=e(u),u&&(u=u.selection())),n==null?h.remove():n(h),i&&u?i.merge(u).order():u}function z3(t){for(var e=t.selection?t.selection():t,n=this._groups,i=e._groups,u=n.length,h=i.length,d=Math.min(u,h),s=new Array(u),w=0;w<d;++w)for(var T=n[w],A=i[w],D=T.length,R=s[w]=new Array(D),G,$=0;$<D;++$)(G=T[$]||A[$])&&(R[$]=G);for(;w<u;++w)s[w]=n[w];return new ys(s,this._parents)}function F3(){for(var t=this._groups,e=-1,n=t.length;++e<n;)for(var i=t[e],u=i.length-1,h=i[u],d;--u>=0;)(d=i[u])&&(h&&d.compareDocumentPosition(h)^4&&h.parentNode.insertBefore(d,h),h=d);return this}function B3(t){t||(t=U3);function e(D,R){return D&&R?t(D.__data__,R.__data__):!D-!R}for(var n=this._groups,i=n.length,u=new Array(i),h=0;h<i;++h){for(var d=n[h],s=d.length,w=u[h]=new Array(s),T,A=0;A<s;++A)(T=d[A])&&(w[A]=T);w.sort(e)}return new ys(u,this._parents).order()}function U3(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function V3(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this}function j3(){return Array.from(this)}function G3(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var i=t[e],u=0,h=i.length;u<h;++u){var d=i[u];if(d)return d}return null}function q3(){let t=0;for(const e of this)++t;return t}function X3(){return!this.node()}function $3(t){for(var e=this._groups,n=0,i=e.length;n<i;++n)for(var u=e[n],h=0,d=u.length,s;h<d;++h)(s=u[h])&&t.call(s,s.__data__,h,u);return this}function Z3(t){return function(){this.removeAttribute(t)}}function W3(t){return function(){this.removeAttributeNS(t.space,t.local)}}function H3(t,e){return function(){this.setAttribute(t,e)}}function Y3(t,e){return function(){this.setAttributeNS(t.space,t.local,e)}}function K3(t,e){return function(){var n=e.apply(this,arguments);n==null?this.removeAttribute(t):this.setAttribute(t,n)}}function J3(t,e){return function(){var n=e.apply(this,arguments);n==null?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,n)}}function Q3(t,e){var n=wx(t);if(arguments.length<2){var i=this.node();return n.local?i.getAttributeNS(n.space,n.local):i.getAttribute(n)}return this.each((e==null?n.local?W3:Z3:typeof e=="function"?n.local?J3:K3:n.local?Y3:H3)(n,e))}function hL(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}function eF(t){return function(){this.style.removeProperty(t)}}function tF(t,e,n){return function(){this.style.setProperty(t,e,n)}}function nF(t,e,n){return function(){var i=e.apply(this,arguments);i==null?this.style.removeProperty(t):this.style.setProperty(t,i,n)}}function rF(t,e,n){return arguments.length>1?this.each((e==null?eF:typeof e=="function"?nF:tF)(t,e,n??"")):ld(this.node(),t)}function ld(t,e){return t.style.getPropertyValue(e)||hL(t).getComputedStyle(t,null).getPropertyValue(e)}function iF(t){return function(){delete this[t]}}function oF(t,e){return function(){this[t]=e}}function sF(t,e){return function(){var n=e.apply(this,arguments);n==null?delete this[t]:this[t]=n}}function aF(t,e){return arguments.length>1?this.each((e==null?iF:typeof e=="function"?sF:oF)(t,e)):this.node()[t]}function fL(t){return t.trim().split(/^|\s+/)}function pS(t){return t.classList||new pL(t)}function pL(t){this._node=t,this._names=fL(t.getAttribute("class")||"")}pL.prototype={add:function(t){var e=this._names.indexOf(t);e<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var e=this._names.indexOf(t);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};function dL(t,e){for(var n=pS(t),i=-1,u=e.length;++i<u;)n.add(e[i])}function mL(t,e){for(var n=pS(t),i=-1,u=e.length;++i<u;)n.remove(e[i])}function lF(t){return function(){dL(this,t)}}function uF(t){return function(){mL(this,t)}}function cF(t,e){return function(){(e.apply(this,arguments)?dL:mL)(this,t)}}function hF(t,e){var n=fL(t+"");if(arguments.length<2){for(var i=pS(this.node()),u=-1,h=n.length;++u<h;)if(!i.contains(n[u]))return!1;return!0}return this.each((typeof e=="function"?cF:e?lF:uF)(n,e))}function fF(){this.textContent=""}function pF(t){return function(){this.textContent=t}}function dF(t){return function(){var e=t.apply(this,arguments);this.textContent=e??""}}function mF(t){return arguments.length?this.each(t==null?fF:(typeof t=="function"?dF:pF)(t)):this.node().textContent}function gF(){this.innerHTML=""}function _F(t){return function(){this.innerHTML=t}}function yF(t){return function(){var e=t.apply(this,arguments);this.innerHTML=e??""}}function vF(t){return arguments.length?this.each(t==null?gF:(typeof t=="function"?yF:_F)(t)):this.node().innerHTML}function xF(){this.nextSibling&&this.parentNode.appendChild(this)}function wF(){return this.each(xF)}function bF(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function EF(){return this.each(bF)}function SF(t){var e=typeof t=="function"?t:sL(t);return this.select(function(){return this.appendChild(e.apply(this,arguments))})}function TF(){return null}function CF(t,e){var n=typeof t=="function"?t:sL(t),i=e==null?TF:typeof e=="function"?e:fS(e);return this.select(function(){return this.insertBefore(n.apply(this,arguments),i.apply(this,arguments)||null)})}function IF(){var t=this.parentNode;t&&t.removeChild(this)}function MF(){return this.each(IF)}function AF(){var t=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function PF(){var t=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function LF(t){return this.select(t?PF:AF)}function DF(t){return arguments.length?this.property("__data__",t):this.node().__data__}function RF(t){return function(e){t.call(this,e,this.__data__)}}function NF(t){return t.trim().split(/^|\s+/).map(function(e){var n="",i=e.indexOf(".");return i>=0&&(n=e.slice(i+1),e=e.slice(0,i)),{type:e,name:n}})}function kF(t){return function(){var e=this.__on;if(e){for(var n=0,i=-1,u=e.length,h;n<u;++n)h=e[n],(!t.type||h.type===t.type)&&h.name===t.name?this.removeEventListener(h.type,h.listener,h.options):e[++i]=h;++i?e.length=i:delete this.__on}}}function OF(t,e,n){return function(){var i=this.__on,u,h=RF(e);if(i){for(var d=0,s=i.length;d<s;++d)if((u=i[d]).type===t.type&&u.name===t.name){this.removeEventListener(u.type,u.listener,u.options),this.addEventListener(u.type,u.listener=h,u.options=n),u.value=e;return}}this.addEventListener(t.type,h,n),u={type:t.type,name:t.name,value:e,listener:h,options:n},i?i.push(u):this.__on=[u]}}function zF(t,e,n){var i=NF(t+""),u,h=i.length,d;if(arguments.length<2){var s=this.node().__on;if(s){for(var w=0,T=s.length,A;w<T;++w)for(u=0,A=s[w];u<h;++u)if((d=i[u]).type===A.type&&d.name===A.name)return A.value}return}for(s=e?OF:kF,u=0;u<h;++u)this.each(s(i[u],e,n));return this}function gL(t,e,n){var i=hL(t),u=i.CustomEvent;typeof u=="function"?u=new u(e,n):(u=i.document.createEvent("Event"),n?(u.initEvent(e,n.bubbles,n.cancelable),u.detail=n.detail):u.initEvent(e,!1,!1)),t.dispatchEvent(u)}function FF(t,e){return function(){return gL(this,t,e)}}function BF(t,e){return function(){return gL(this,t,e.apply(this,arguments))}}function UF(t,e){return this.each((typeof e=="function"?BF:FF)(t,e))}function*VF(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var i=t[e],u=0,h=i.length,d;u<h;++u)(d=i[u])&&(yield d)}var _L=[null];function ys(t,e){this._groups=t,this._parents=e}function O_(){return new ys([[document.documentElement]],_L)}function jF(){return this}ys.prototype=O_.prototype={constructor:ys,select:d3,selectAll:y3,selectChild:b3,selectChildren:C3,filter:I3,data:R3,enter:M3,exit:k3,join:O3,merge:z3,selection:jF,order:F3,sort:B3,call:V3,nodes:j3,node:G3,size:q3,empty:X3,each:$3,attr:Q3,style:rF,property:aF,classed:hF,text:mF,html:vF,raise:wF,lower:EF,append:SF,insert:CF,remove:MF,clone:LF,datum:DF,on:zF,dispatch:UF,[Symbol.iterator]:VF};function dS(t){return typeof t=="string"?new ys([[document.querySelector(t)]],[document.documentElement]):new ys([[t]],_L)}function mS(t,e,n){t.prototype=e.prototype=n,n.constructor=t}function yL(t,e){var n=Object.create(t.prototype);for(var i in e)n[i]=e[i];return n}function z_(){}var h_=.7,F0=1/h_,ed="\\s*([+-]?\\d+)\\s*",f_="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Dl="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",GF=/^#([0-9a-f]{3,8})$/,qF=new RegExp(`^rgb\\(${ed},${ed},${ed}\\)$`),XF=new RegExp(`^rgb\\(${Dl},${Dl},${Dl}\\)$`),$F=new RegExp(`^rgba\\(${ed},${ed},${ed},${f_}\\)$`),ZF=new RegExp(`^rgba\\(${Dl},${Dl},${Dl},${f_}\\)$`),WF=new RegExp(`^hsl\\(${f_},${Dl},${Dl}\\)$`),HF=new RegExp(`^hsla\\(${f_},${Dl},${Dl},${f_}\\)$`),B2={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};mS(z_,lf,{copy(t){return Object.assign(new this.constructor,this,t)},displayable(){return this.rgb().displayable()},hex:U2,formatHex:U2,formatHex8:YF,formatHsl:KF,formatRgb:V2,toString:V2});function U2(){return this.rgb().formatHex()}function YF(){return this.rgb().formatHex8()}function KF(){return vL(this).formatHsl()}function V2(){return this.rgb().formatRgb()}function lf(t){var e,n;return t=(t+"").trim().toLowerCase(),(e=GF.exec(t))?(n=e[1].length,e=parseInt(e[1],16),n===6?j2(e):n===3?new Xo(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):n===8?Ov(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):n===4?Ov(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=qF.exec(t))?new Xo(e[1],e[2],e[3],1):(e=XF.exec(t))?new Xo(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=$F.exec(t))?Ov(e[1],e[2],e[3],e[4]):(e=ZF.exec(t))?Ov(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=WF.exec(t))?X2(e[1],e[2]/100,e[3]/100,1):(e=HF.exec(t))?X2(e[1],e[2]/100,e[3]/100,e[4]):B2.hasOwnProperty(t)?j2(B2[t]):t==="transparent"?new Xo(NaN,NaN,NaN,0):null}function j2(t){return new Xo(t>>16&255,t>>8&255,t&255,1)}function Ov(t,e,n,i){return i<=0&&(t=e=n=NaN),new Xo(t,e,n,i)}function JF(t){return t instanceof z_||(t=lf(t)),t?(t=t.rgb(),new Xo(t.r,t.g,t.b,t.opacity)):new Xo}function Kb(t,e,n,i){return arguments.length===1?JF(t):new Xo(t,e,n,i??1)}function Xo(t,e,n,i){this.r=+t,this.g=+e,this.b=+n,this.opacity=+i}mS(Xo,Kb,yL(z_,{brighter(t){return t=t==null?F0:Math.pow(F0,t),new Xo(this.r*t,this.g*t,this.b*t,this.opacity)},darker(t){return t=t==null?h_:Math.pow(h_,t),new Xo(this.r*t,this.g*t,this.b*t,this.opacity)},rgb(){return this},clamp(){return new Xo(tf(this.r),tf(this.g),tf(this.b),B0(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:G2,formatHex:G2,formatHex8:QF,formatRgb:q2,toString:q2}));function G2(){return`#${Jh(this.r)}${Jh(this.g)}${Jh(this.b)}`}function QF(){return`#${Jh(this.r)}${Jh(this.g)}${Jh(this.b)}${Jh((isNaN(this.opacity)?1:this.opacity)*255)}`}function q2(){const t=B0(this.opacity);return`${t===1?"rgb(":"rgba("}${tf(this.r)}, ${tf(this.g)}, ${tf(this.b)}${t===1?")":`, ${t})`}`}function B0(t){return isNaN(t)?1:Math.max(0,Math.min(1,t))}function tf(t){return Math.max(0,Math.min(255,Math.round(t)||0))}function Jh(t){return t=tf(t),(t<16?"0":"")+t.toString(16)}function X2(t,e,n,i){return i<=0?t=e=n=NaN:n<=0||n>=1?t=e=NaN:e<=0&&(t=NaN),new Ua(t,e,n,i)}function vL(t){if(t instanceof Ua)return new Ua(t.h,t.s,t.l,t.opacity);if(t instanceof z_||(t=lf(t)),!t)return new Ua;if(t instanceof Ua)return t;t=t.rgb();var e=t.r/255,n=t.g/255,i=t.b/255,u=Math.min(e,n,i),h=Math.max(e,n,i),d=NaN,s=h-u,w=(h+u)/2;return s?(e===h?d=(n-i)/s+(n<i)*6:n===h?d=(i-e)/s+2:d=(e-n)/s+4,s/=w<.5?h+u:2-h-u,d*=60):s=w>0&&w<1?0:d,new Ua(d,s,w,t.opacity)}function eB(t,e,n,i){return arguments.length===1?vL(t):new Ua(t,e,n,i??1)}function Ua(t,e,n,i){this.h=+t,this.s=+e,this.l=+n,this.opacity=+i}mS(Ua,eB,yL(z_,{brighter(t){return t=t==null?F0:Math.pow(F0,t),new Ua(this.h,this.s,this.l*t,this.opacity)},darker(t){return t=t==null?h_:Math.pow(h_,t),new Ua(this.h,this.s,this.l*t,this.opacity)},rgb(){var t=this.h%360+(this.h<0)*360,e=isNaN(t)||isNaN(this.s)?0:this.s,n=this.l,i=n+(n<.5?n:1-n)*e,u=2*n-i;return new Xo(Xw(t>=240?t-240:t+120,u,i),Xw(t,u,i),Xw(t<120?t+240:t-120,u,i),this.opacity)},clamp(){return new Ua($2(this.h),zv(this.s),zv(this.l),B0(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const t=B0(this.opacity);return`${t===1?"hsl(":"hsla("}${$2(this.h)}, ${zv(this.s)*100}%, ${zv(this.l)*100}%${t===1?")":`, ${t})`}`}}));function $2(t){return t=(t||0)%360,t<0?t+360:t}function zv(t){return Math.max(0,Math.min(1,t||0))}function Xw(t,e,n){return(t<60?e+(n-e)*t/60:t<180?n:t<240?e+(n-e)*(240-t)/60:e)*255}const gS=t=>()=>t;function tB(t,e){return function(n){return t+n*e}}function nB(t,e,n){return t=Math.pow(t,n),e=Math.pow(e,n)-t,n=1/n,function(i){return Math.pow(t+i*e,n)}}function rB(t){return(t=+t)==1?xL:function(e,n){return n-e?nB(e,n,t):gS(isNaN(e)?n:e)}}function xL(t,e){var n=e-t;return n?tB(t,n):gS(isNaN(t)?e:t)}const U0=function t(e){var n=rB(e);function i(u,h){var d=n((u=Kb(u)).r,(h=Kb(h)).r),s=n(u.g,h.g),w=n(u.b,h.b),T=xL(u.opacity,h.opacity);return function(A){return u.r=d(A),u.g=s(A),u.b=w(A),u.opacity=T(A),u+""}}return i.gamma=t,i}(1);function iB(t,e){e||(e=[]);var n=t?Math.min(e.length,t.length):0,i=e.slice(),u;return function(h){for(u=0;u<n;++u)i[u]=t[u]*(1-h)+e[u]*h;return i}}function oB(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function sB(t,e){var n=e?e.length:0,i=t?Math.min(n,t.length):0,u=new Array(i),h=new Array(n),d;for(d=0;d<i;++d)u[d]=_S(t[d],e[d]);for(;d<n;++d)h[d]=e[d];return function(s){for(d=0;d<i;++d)h[d]=u[d](s);return h}}function aB(t,e){var n=new Date;return t=+t,e=+e,function(i){return n.setTime(t*(1-i)+e*i),n}}function Fa(t,e){return t=+t,e=+e,function(n){return t*(1-n)+e*n}}function lB(t,e){var n={},i={},u;(t===null||typeof t!="object")&&(t={}),(e===null||typeof e!="object")&&(e={});for(u in e)u in t?n[u]=_S(t[u],e[u]):i[u]=e[u];return function(h){for(u in n)i[u]=n[u](h);return i}}var Jb=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,$w=new RegExp(Jb.source,"g");function uB(t){return function(){return t}}function cB(t){return function(e){return t(e)+""}}function wL(t,e){var n=Jb.lastIndex=$w.lastIndex=0,i,u,h,d=-1,s=[],w=[];for(t=t+"",e=e+"";(i=Jb.exec(t))&&(u=$w.exec(e));)(h=u.index)>n&&(h=e.slice(n,h),s[d]?s[d]+=h:s[++d]=h),(i=i[0])===(u=u[0])?s[d]?s[d]+=u:s[++d]=u:(s[++d]=null,w.push({i:d,x:Fa(i,u)})),n=$w.lastIndex;return n<e.length&&(h=e.slice(n),s[d]?s[d]+=h:s[++d]=h),s.length<2?w[0]?cB(w[0].x):uB(e):(e=w.length,function(T){for(var A=0,D;A<e;++A)s[(D=w[A]).i]=D.x(T);return s.join("")})}function _S(t,e){var n=typeof e,i;return e==null||n==="boolean"?gS(e):(n==="number"?Fa:n==="string"?(i=lf(e))?(e=i,U0):wL:e instanceof lf?U0:e instanceof Date?aB:oB(e)?iB:Array.isArray(e)?sB:typeof e.valueOf!="function"&&typeof e.toString!="function"||isNaN(e)?lB:Fa)(t,e)}function hB(t,e){return t=+t,e=+e,function(n){return Math.round(t*(1-n)+e*n)}}var Z2=180/Math.PI,Qb={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function bL(t,e,n,i,u,h){var d,s,w;return(d=Math.sqrt(t*t+e*e))&&(t/=d,e/=d),(w=t*n+e*i)&&(n-=t*w,i-=e*w),(s=Math.sqrt(n*n+i*i))&&(n/=s,i/=s,w/=s),t*i<e*n&&(t=-t,e=-e,w=-w,d=-d),{translateX:u,translateY:h,rotate:Math.atan2(e,t)*Z2,skewX:Math.atan(w)*Z2,scaleX:d,scaleY:s}}var Fv;function fB(t){const e=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(t+"");return e.isIdentity?Qb:bL(e.a,e.b,e.c,e.d,e.e,e.f)}function pB(t){return t==null||(Fv||(Fv=document.createElementNS("http://www.w3.org/2000/svg","g")),Fv.setAttribute("transform",t),!(t=Fv.transform.baseVal.consolidate()))?Qb:(t=t.matrix,bL(t.a,t.b,t.c,t.d,t.e,t.f))}function EL(t,e,n,i){function u(T){return T.length?T.pop()+" ":""}function h(T,A,D,R,G,$){if(T!==D||A!==R){var ie=G.push("translate(",null,e,null,n);$.push({i:ie-4,x:Fa(T,D)},{i:ie-2,x:Fa(A,R)})}else(D||R)&&G.push("translate("+D+e+R+n)}function d(T,A,D,R){T!==A?(T-A>180?A+=360:A-T>180&&(T+=360),R.push({i:D.push(u(D)+"rotate(",null,i)-2,x:Fa(T,A)})):A&&D.push(u(D)+"rotate("+A+i)}function s(T,A,D,R){T!==A?R.push({i:D.push(u(D)+"skewX(",null,i)-2,x:Fa(T,A)}):A&&D.push(u(D)+"skewX("+A+i)}function w(T,A,D,R,G,$){if(T!==D||A!==R){var ie=G.push(u(G)+"scale(",null,",",null,")");$.push({i:ie-4,x:Fa(T,D)},{i:ie-2,x:Fa(A,R)})}else(D!==1||R!==1)&&G.push(u(G)+"scale("+D+","+R+")")}return function(T,A){var D=[],R=[];return T=t(T),A=t(A),h(T.translateX,T.translateY,A.translateX,A.translateY,D,R),d(T.rotate,A.rotate,D,R),s(T.skewX,A.skewX,D,R),w(T.scaleX,T.scaleY,A.scaleX,A.scaleY,D,R),T=A=null,function(G){for(var $=-1,ie=R.length,_e;++$<ie;)D[(_e=R[$]).i]=_e.x(G);return D.join("")}}}var dB=EL(fB,"px, ","px)","deg)"),mB=EL(pB,", ",")",")"),ud=0,Ng=0,Ig=0,SL=1e3,V0,kg,j0=0,uf=0,bx=0,p_=typeof performance=="object"&&performance.now?performance:Date,TL=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function yS(){return uf||(TL(gB),uf=p_.now()+bx)}function gB(){uf=0}function G0(){this._call=this._time=this._next=null}G0.prototype=CL.prototype={constructor:G0,restart:function(t,e,n){if(typeof t!="function")throw new TypeError("callback is not a function");n=(n==null?yS():+n)+(e==null?0:+e),!this._next&&kg!==this&&(kg?kg._next=this:V0=this,kg=this),this._call=t,this._time=n,eE()},stop:function(){this._call&&(this._call=null,this._time=1/0,eE())}};function CL(t,e,n){var i=new G0;return i.restart(t,e,n),i}function _B(){yS(),++ud;for(var t=V0,e;t;)(e=uf-t._time)>=0&&t._call.call(void 0,e),t=t._next;--ud}function W2(){uf=(j0=p_.now())+bx,ud=Ng=0;try{_B()}finally{ud=0,vB(),uf=0}}function yB(){var t=p_.now(),e=t-j0;e>SL&&(bx-=e,j0=t)}function vB(){for(var t,e=V0,n,i=1/0;e;)e._call?(i>e._time&&(i=e._time),t=e,e=e._next):(n=e._next,e._next=null,e=t?t._next=n:V0=n);kg=t,eE(i)}function eE(t){if(!ud){Ng&&(Ng=clearTimeout(Ng));var e=t-uf;e>24?(t<1/0&&(Ng=setTimeout(W2,t-p_.now()-bx)),Ig&&(Ig=clearInterval(Ig))):(Ig||(j0=p_.now(),Ig=setInterval(yB,SL)),ud=1,TL(W2))}}function H2(t,e,n){var i=new G0;return e=e==null?0:+e,i.restart(u=>{i.stop(),t(u+e)},e,n),i}var xB=oL("start","end","cancel","interrupt"),wB=[],IL=0,Y2=1,tE=2,a0=3,K2=4,nE=5,l0=6;function Ex(t,e,n,i,u,h){var d=t.__transition;if(!d)t.__transition={};else if(n in d)return;bB(t,n,{name:e,index:i,group:u,on:xB,tween:wB,time:h.time,delay:h.delay,duration:h.duration,ease:h.ease,timer:null,state:IL})}function vS(t,e){var n=rl(t,e);if(n.state>IL)throw new Error("too late; already scheduled");return n}function Ul(t,e){var n=rl(t,e);if(n.state>a0)throw new Error("too late; already running");return n}function rl(t,e){var n=t.__transition;if(!n||!(n=n[e]))throw new Error("transition not found");return n}function bB(t,e,n){var i=t.__transition,u;i[e]=n,n.timer=CL(h,0,n.time);function h(T){n.state=Y2,n.timer.restart(d,n.delay,n.time),n.delay<=T&&d(T-n.delay)}function d(T){var A,D,R,G;if(n.state!==Y2)return w();for(A in i)if(G=i[A],G.name===n.name){if(G.state===a0)return H2(d);G.state===K2?(G.state=l0,G.timer.stop(),G.on.call("interrupt",t,t.__data__,G.index,G.group),delete i[A]):+A<e&&(G.state=l0,G.timer.stop(),G.on.call("cancel",t,t.__data__,G.index,G.group),delete i[A])}if(H2(function(){n.state===a0&&(n.state=K2,n.timer.restart(s,n.delay,n.time),s(T))}),n.state=tE,n.on.call("start",t,t.__data__,n.index,n.group),n.state===tE){for(n.state=a0,u=new Array(R=n.tween.length),A=0,D=-1;A<R;++A)(G=n.tween[A].value.call(t,t.__data__,n.index,n.group))&&(u[++D]=G);u.length=D+1}}function s(T){for(var A=T<n.duration?n.ease.call(null,T/n.duration):(n.timer.restart(w),n.state=nE,1),D=-1,R=u.length;++D<R;)u[D].call(t,A);n.state===nE&&(n.on.call("end",t,t.__data__,n.index,n.group),w())}function w(){n.state=l0,n.timer.stop(),delete i[e];for(var T in i)return;delete t.__transition}}function EB(t,e){var n=t.__transition,i,u,h=!0,d;if(n){e=e==null?null:e+"";for(d in n){if((i=n[d]).name!==e){h=!1;continue}u=i.state>tE&&i.state<nE,i.state=l0,i.timer.stop(),i.on.call(u?"interrupt":"cancel",t,t.__data__,i.index,i.group),delete n[d]}h&&delete t.__transition}}function SB(t){return this.each(function(){EB(this,t)})}function TB(t,e){var n,i;return function(){var u=Ul(this,t),h=u.tween;if(h!==n){i=n=h;for(var d=0,s=i.length;d<s;++d)if(i[d].name===e){i=i.slice(),i.splice(d,1);break}}u.tween=i}}function CB(t,e,n){var i,u;if(typeof n!="function")throw new Error;return function(){var h=Ul(this,t),d=h.tween;if(d!==i){u=(i=d).slice();for(var s={name:e,value:n},w=0,T=u.length;w<T;++w)if(u[w].name===e){u[w]=s;break}w===T&&u.push(s)}h.tween=u}}function IB(t,e){var n=this._id;if(t+="",arguments.length<2){for(var i=rl(this.node(),n).tween,u=0,h=i.length,d;u<h;++u)if((d=i[u]).name===t)return d.value;return null}return this.each((e==null?TB:CB)(n,t,e))}function xS(t,e,n){var i=t._id;return t.each(function(){var u=Ul(this,i);(u.value||(u.value={}))[e]=n.apply(this,arguments)}),function(u){return rl(u,i).value[e]}}function ML(t,e){var n;return(typeof e=="number"?Fa:e instanceof lf?U0:(n=lf(e))?(e=n,U0):wL)(t,e)}function MB(t){return function(){this.removeAttribute(t)}}function AB(t){return function(){this.removeAttributeNS(t.space,t.local)}}function PB(t,e,n){var i,u=n+"",h;return function(){var d=this.getAttribute(t);return d===u?null:d===i?h:h=e(i=d,n)}}function LB(t,e,n){var i,u=n+"",h;return function(){var d=this.getAttributeNS(t.space,t.local);return d===u?null:d===i?h:h=e(i=d,n)}}function DB(t,e,n){var i,u,h;return function(){var d,s=n(this),w;return s==null?void this.removeAttribute(t):(d=this.getAttribute(t),w=s+"",d===w?null:d===i&&w===u?h:(u=w,h=e(i=d,s)))}}function RB(t,e,n){var i,u,h;return function(){var d,s=n(this),w;return s==null?void this.removeAttributeNS(t.space,t.local):(d=this.getAttributeNS(t.space,t.local),w=s+"",d===w?null:d===i&&w===u?h:(u=w,h=e(i=d,s)))}}function NB(t,e){var n=wx(t),i=n==="transform"?mB:ML;return this.attrTween(t,typeof e=="function"?(n.local?RB:DB)(n,i,xS(this,"attr."+t,e)):e==null?(n.local?AB:MB)(n):(n.local?LB:PB)(n,i,e))}function kB(t,e){return function(n){this.setAttribute(t,e.call(this,n))}}function OB(t,e){return function(n){this.setAttributeNS(t.space,t.local,e.call(this,n))}}function zB(t,e){var n,i;function u(){var h=e.apply(this,arguments);return h!==i&&(n=(i=h)&&OB(t,h)),n}return u._value=e,u}function FB(t,e){var n,i;function u(){var h=e.apply(this,arguments);return h!==i&&(n=(i=h)&&kB(t,h)),n}return u._value=e,u}function BB(t,e){var n="attr."+t;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(e==null)return this.tween(n,null);if(typeof e!="function")throw new Error;var i=wx(t);return this.tween(n,(i.local?zB:FB)(i,e))}function UB(t,e){return function(){vS(this,t).delay=+e.apply(this,arguments)}}function VB(t,e){return e=+e,function(){vS(this,t).delay=e}}function jB(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?UB:VB)(e,t)):rl(this.node(),e).delay}function GB(t,e){return function(){Ul(this,t).duration=+e.apply(this,arguments)}}function qB(t,e){return e=+e,function(){Ul(this,t).duration=e}}function XB(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?GB:qB)(e,t)):rl(this.node(),e).duration}function $B(t,e){if(typeof e!="function")throw new Error;return function(){Ul(this,t).ease=e}}function ZB(t){var e=this._id;return arguments.length?this.each($B(e,t)):rl(this.node(),e).ease}function WB(t,e){return function(){var n=e.apply(this,arguments);if(typeof n!="function")throw new Error;Ul(this,t).ease=n}}function HB(t){if(typeof t!="function")throw new Error;return this.each(WB(this._id,t))}function YB(t){typeof t!="function"&&(t=lL(t));for(var e=this._groups,n=e.length,i=new Array(n),u=0;u<n;++u)for(var h=e[u],d=h.length,s=i[u]=[],w,T=0;T<d;++T)(w=h[T])&&t.call(w,w.__data__,T,h)&&s.push(w);return new Su(i,this._parents,this._name,this._id)}function KB(t){if(t._id!==this._id)throw new Error;for(var e=this._groups,n=t._groups,i=e.length,u=n.length,h=Math.min(i,u),d=new Array(i),s=0;s<h;++s)for(var w=e[s],T=n[s],A=w.length,D=d[s]=new Array(A),R,G=0;G<A;++G)(R=w[G]||T[G])&&(D[G]=R);for(;s<i;++s)d[s]=e[s];return new Su(d,this._parents,this._name,this._id)}function JB(t){return(t+"").trim().split(/^|\s+/).every(function(e){var n=e.indexOf(".");return n>=0&&(e=e.slice(0,n)),!e||e==="start"})}function QB(t,e,n){var i,u,h=JB(e)?vS:Ul;return function(){var d=h(this,t),s=d.on;s!==i&&(u=(i=s).copy()).on(e,n),d.on=u}}function e5(t,e){var n=this._id;return arguments.length<2?rl(this.node(),n).on.on(t):this.each(QB(n,t,e))}function t5(t){return function(){var e=this.parentNode;for(var n in this.__transition)if(+n!==t)return;e&&e.removeChild(this)}}function n5(){return this.on("end.remove",t5(this._id))}function r5(t){var e=this._name,n=this._id;typeof t!="function"&&(t=fS(t));for(var i=this._groups,u=i.length,h=new Array(u),d=0;d<u;++d)for(var s=i[d],w=s.length,T=h[d]=new Array(w),A,D,R=0;R<w;++R)(A=s[R])&&(D=t.call(A,A.__data__,R,s))&&("__data__"in A&&(D.__data__=A.__data__),T[R]=D,Ex(T[R],e,n,R,T,rl(A,n)));return new Su(h,this._parents,e,n)}function i5(t){var e=this._name,n=this._id;typeof t!="function"&&(t=aL(t));for(var i=this._groups,u=i.length,h=[],d=[],s=0;s<u;++s)for(var w=i[s],T=w.length,A,D=0;D<T;++D)if(A=w[D]){for(var R=t.call(A,A.__data__,D,w),G,$=rl(A,n),ie=0,_e=R.length;ie<_e;++ie)(G=R[ie])&&Ex(G,e,n,ie,R,$);h.push(R),d.push(A)}return new Su(h,d,e,n)}var o5=O_.prototype.constructor;function s5(){return new o5(this._groups,this._parents)}function a5(t,e){var n,i,u;return function(){var h=ld(this,t),d=(this.style.removeProperty(t),ld(this,t));return h===d?null:h===n&&d===i?u:u=e(n=h,i=d)}}function AL(t){return function(){this.style.removeProperty(t)}}function l5(t,e,n){var i,u=n+"",h;return function(){var d=ld(this,t);return d===u?null:d===i?h:h=e(i=d,n)}}function u5(t,e,n){var i,u,h;return function(){var d=ld(this,t),s=n(this),w=s+"";return s==null&&(w=s=(this.style.removeProperty(t),ld(this,t))),d===w?null:d===i&&w===u?h:(u=w,h=e(i=d,s))}}function c5(t,e){var n,i,u,h="style."+e,d="end."+h,s;return function(){var w=Ul(this,t),T=w.on,A=w.value[h]==null?s||(s=AL(e)):void 0;(T!==n||u!==A)&&(i=(n=T).copy()).on(d,u=A),w.on=i}}function h5(t,e,n){var i=(t+="")=="transform"?dB:ML;return e==null?this.styleTween(t,a5(t,i)).on("end.style."+t,AL(t)):typeof e=="function"?this.styleTween(t,u5(t,i,xS(this,"style."+t,e))).each(c5(this._id,t)):this.styleTween(t,l5(t,i,e),n).on("end.style."+t,null)}function f5(t,e,n){return function(i){this.style.setProperty(t,e.call(this,i),n)}}function p5(t,e,n){var i,u;function h(){var d=e.apply(this,arguments);return d!==u&&(i=(u=d)&&f5(t,d,n)),i}return h._value=e,h}function d5(t,e,n){var i="style."+(t+="");if(arguments.length<2)return(i=this.tween(i))&&i._value;if(e==null)return this.tween(i,null);if(typeof e!="function")throw new Error;return this.tween(i,p5(t,e,n??""))}function m5(t){return function(){this.textContent=t}}function g5(t){return function(){var e=t(this);this.textContent=e??""}}function _5(t){return this.tween("text",typeof t=="function"?g5(xS(this,"text",t)):m5(t==null?"":t+""))}function y5(t){return function(e){this.textContent=t.call(this,e)}}function v5(t){var e,n;function i(){var u=t.apply(this,arguments);return u!==n&&(e=(n=u)&&y5(u)),e}return i._value=t,i}function x5(t){var e="text";if(arguments.length<1)return(e=this.tween(e))&&e._value;if(t==null)return this.tween(e,null);if(typeof t!="function")throw new Error;return this.tween(e,v5(t))}function w5(){for(var t=this._name,e=this._id,n=PL(),i=this._groups,u=i.length,h=0;h<u;++h)for(var d=i[h],s=d.length,w,T=0;T<s;++T)if(w=d[T]){var A=rl(w,e);Ex(w,t,n,T,d,{time:A.time+A.delay+A.duration,delay:0,duration:A.duration,ease:A.ease})}return new Su(i,this._parents,t,n)}function b5(){var t,e,n=this,i=n._id,u=n.size();return new Promise(function(h,d){var s={value:d},w={value:function(){--u===0&&h()}};n.each(function(){var T=Ul(this,i),A=T.on;A!==t&&(e=(t=A).copy(),e._.cancel.push(s),e._.interrupt.push(s),e._.end.push(w)),T.on=e}),u===0&&h()})}var E5=0;function Su(t,e,n,i){this._groups=t,this._parents=e,this._name=n,this._id=i}function PL(){return++E5}var hu=O_.prototype;Su.prototype={constructor:Su,select:r5,selectAll:i5,selectChild:hu.selectChild,selectChildren:hu.selectChildren,filter:YB,merge:KB,selection:s5,transition:w5,call:hu.call,nodes:hu.nodes,node:hu.node,size:hu.size,empty:hu.empty,each:hu.each,on:e5,attr:NB,attrTween:BB,style:h5,styleTween:d5,text:_5,textTween:x5,remove:n5,tween:IB,delay:jB,duration:XB,ease:ZB,easeVarying:HB,end:b5,[Symbol.iterator]:hu[Symbol.iterator]};function S5(t){return((t*=2)<=1?t*t*t:(t-=2)*t*t+2)/2}var T5={time:null,delay:0,duration:250,ease:S5};function C5(t,e){for(var n;!(n=t.__transition)||!(n=n[e]);)if(!(t=t.parentNode))throw new Error(`transition ${e} not found`);return n}function I5(t){var e,n;t instanceof Su?(e=t._id,t=t._name):(e=PL(),(n=T5).time=yS(),t=t==null?null:t+"");for(var i=this._groups,u=i.length,h=0;h<u;++h)for(var d=i[h],s=d.length,w,T=0;T<s;++T)(w=d[T])&&Ex(w,t,e,T,d,n||C5(w,e));return new Su(i,this._parents,t,e)}O_.prototype.interrupt=SB;O_.prototype.transition=I5;const rE=Math.PI,iE=2*rE,Zh=1e-6,M5=iE-Zh;function LL(t){this._+=t[0];for(let e=1,n=t.length;e<n;++e)this._+=arguments[e]+t[e]}function A5(t){let e=Math.floor(t);if(!(e>=0))throw new Error(`invalid digits: ${t}`);if(e>15)return LL;const n=10**e;return function(i){this._+=i[0];for(let u=1,h=i.length;u<h;++u)this._+=Math.round(arguments[u]*n)/n+i[u]}}class P5{constructor(e){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=e==null?LL:A5(e)}moveTo(e,n){this._append`M${this._x0=this._x1=+e},${this._y0=this._y1=+n}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(e,n){this._append`L${this._x1=+e},${this._y1=+n}`}quadraticCurveTo(e,n,i,u){this._append`Q${+e},${+n},${this._x1=+i},${this._y1=+u}`}bezierCurveTo(e,n,i,u,h,d){this._append`C${+e},${+n},${+i},${+u},${this._x1=+h},${this._y1=+d}`}arcTo(e,n,i,u,h){if(e=+e,n=+n,i=+i,u=+u,h=+h,h<0)throw new Error(`negative radius: ${h}`);let d=this._x1,s=this._y1,w=i-e,T=u-n,A=d-e,D=s-n,R=A*A+D*D;if(this._x1===null)this._append`M${this._x1=e},${this._y1=n}`;else if(R>Zh)if(!(Math.abs(D*w-T*A)>Zh)||!h)this._append`L${this._x1=e},${this._y1=n}`;else{let G=i-d,$=u-s,ie=w*w+T*T,_e=G*G+$*$,Y=Math.sqrt(ie),B=Math.sqrt(R),q=h*Math.tan((rE-Math.acos((ie+R-_e)/(2*Y*B)))/2),oe=q/B,de=q/Y;Math.abs(oe-1)>Zh&&this._append`L${e+oe*A},${n+oe*D}`,this._append`A${h},${h},0,0,${+(D*G>A*$)},${this._x1=e+de*w},${this._y1=n+de*T}`}}arc(e,n,i,u,h,d){if(e=+e,n=+n,i=+i,d=!!d,i<0)throw new Error(`negative radius: ${i}`);let s=i*Math.cos(u),w=i*Math.sin(u),T=e+s,A=n+w,D=1^d,R=d?u-h:h-u;this._x1===null?this._append`M${T},${A}`:(Math.abs(this._x1-T)>Zh||Math.abs(this._y1-A)>Zh)&&this._append`L${T},${A}`,i&&(R<0&&(R=R%iE+iE),R>M5?this._append`A${i},${i},0,1,${D},${e-s},${n-w}A${i},${i},0,1,${D},${this._x1=T},${this._y1=A}`:R>Zh&&this._append`A${i},${i},0,${+(R>=rE)},${D},${this._x1=e+i*Math.cos(h)},${this._y1=n+i*Math.sin(h)}`)}rect(e,n,i,u){this._append`M${this._x0=this._x1=+e},${this._y0=this._y1=+n}h${i=+i}v${+u}h${-i}Z`}toString(){return this._}}var J2={},Zw={},Ww=34,Mg=10,Hw=13;function DL(t){return new Function("d","return {"+t.map(function(e,n){return JSON.stringify(e)+": d["+n+'] || ""'}).join(",")+"}")}function L5(t,e){var n=DL(t);return function(i,u){return e(n(i),u,t)}}function Q2(t){var e=Object.create(null),n=[];return t.forEach(function(i){for(var u in i)u in e||n.push(e[u]=u)}),n}function jo(t,e){var n=t+"",i=n.length;return i<e?new Array(e-i+1).join(0)+n:n}function D5(t){return t<0?"-"+jo(-t,6):t>9999?"+"+jo(t,6):jo(t,4)}function R5(t){var e=t.getUTCHours(),n=t.getUTCMinutes(),i=t.getUTCSeconds(),u=t.getUTCMilliseconds();return isNaN(t)?"Invalid Date":D5(t.getUTCFullYear())+"-"+jo(t.getUTCMonth()+1,2)+"-"+jo(t.getUTCDate(),2)+(u?"T"+jo(e,2)+":"+jo(n,2)+":"+jo(i,2)+"."+jo(u,3)+"Z":i?"T"+jo(e,2)+":"+jo(n,2)+":"+jo(i,2)+"Z":n||e?"T"+jo(e,2)+":"+jo(n,2)+"Z":"")}function N5(t){var e=new RegExp('["'+t+`
\r]`),n=t.charCodeAt(0);function i(D,R){var G,$,ie=u(D,function(_e,Y){if(G)return G(_e,Y-1);$=_e,G=R?L5(_e,R):DL(_e)});return ie.columns=$||[],ie}function u(D,R){var G=[],$=D.length,ie=0,_e=0,Y,B=$<=0,q=!1;D.charCodeAt($-1)===Mg&&--$,D.charCodeAt($-1)===Hw&&--$;function oe(){if(B)return Zw;if(q)return q=!1,J2;var we,Se=ie,Te;if(D.charCodeAt(Se)===Ww){for(;ie++<$&&D.charCodeAt(ie)!==Ww||D.charCodeAt(++ie)===Ww;);return(we=ie)>=$?B=!0:(Te=D.charCodeAt(ie++))===Mg?q=!0:Te===Hw&&(q=!0,D.charCodeAt(ie)===Mg&&++ie),D.slice(Se+1,we-1).replace(/""/g,'"')}for(;ie<$;){if((Te=D.charCodeAt(we=ie++))===Mg)q=!0;else if(Te===Hw)q=!0,D.charCodeAt(ie)===Mg&&++ie;else if(Te!==n)continue;return D.slice(Se,we)}return B=!0,D.slice(Se,$)}for(;(Y=oe())!==Zw;){for(var de=[];Y!==J2&&Y!==Zw;)de.push(Y),Y=oe();R&&(de=R(de,_e++))==null||G.push(de)}return G}function h(D,R){return D.map(function(G){return R.map(function($){return A(G[$])}).join(t)})}function d(D,R){return R==null&&(R=Q2(D)),[R.map(A).join(t)].concat(h(D,R)).join(`
`)}function s(D,R){return R==null&&(R=Q2(D)),h(D,R).join(`
`)}function w(D){return D.map(T).join(`
`)}function T(D){return D.map(A).join(t)}function A(D){return D==null?"":D instanceof Date?R5(D):e.test(D+="")?'"'+D.replace(/"/g,'""')+'"':D}return{parse:i,parseRows:u,format:d,formatBody:s,formatRows:w,formatRow:T,formatValue:A}}var k5=N5(","),O5=k5.parse;function eM(t){for(var e in t){var n=t[e].trim(),i,u;if(!n)n=null;else if(n==="true")n=!0;else if(n==="false")n=!1;else if(n==="NaN")n=NaN;else if(!isNaN(i=+n))n=i;else if(u=n.match(/^([-+]\d{2})?\d{4}(-\d{2}(-\d{2})?)?(T\d{2}:\d{2}(:\d{2}(\.\d{3})?)?(Z|[-+]\d{2}:\d{2})?)?$/))z5&&u[4]&&!u[7]&&(n=n.replace(/-/g,"/").replace(/T/," ")),n=new Date(n);else continue;t[e]=n}return t}const z5=new Date("2019-01-01T00:00").getHours()||new Date("2019-07-01T00:00").getHours();function F5(t){if(!t.ok)throw new Error(t.status+" "+t.statusText);return t.text()}function B5(t,e){return fetch(t,e).then(F5)}function U5(t){return function(e,n,i){return arguments.length===2&&typeof n=="function"&&(i=n,n=void 0),B5(e,n).then(function(u){return t(u,i)})}}var tM=U5(O5);function V5(t){return Math.abs(t=Math.round(t))>=1e21?t.toLocaleString("en").replace(/,/g,""):t.toString(10)}function q0(t,e){if((n=(t=e?t.toExponential(e-1):t.toExponential()).indexOf("e"))<0)return null;var n,i=t.slice(0,n);return[i.length>1?i[0]+i.slice(2):i,+t.slice(n+1)]}function cd(t){return t=q0(Math.abs(t)),t?t[1]:NaN}function j5(t,e){return function(n,i){for(var u=n.length,h=[],d=0,s=t[0],w=0;u>0&&s>0&&(w+s+1>i&&(s=Math.max(1,i-w)),h.push(n.substring(u-=s,u+s)),!((w+=s+1)>i));)s=t[d=(d+1)%t.length];return h.reverse().join(e)}}function G5(t){return function(e){return e.replace(/[0-9]/g,function(n){return t[+n]})}}var q5=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function X0(t){if(!(e=q5.exec(t)))throw new Error("invalid format: "+t);var e;return new wS({fill:e[1],align:e[2],sign:e[3],symbol:e[4],zero:e[5],width:e[6],comma:e[7],precision:e[8]&&e[8].slice(1),trim:e[9],type:e[10]})}X0.prototype=wS.prototype;function wS(t){this.fill=t.fill===void 0?" ":t.fill+"",this.align=t.align===void 0?">":t.align+"",this.sign=t.sign===void 0?"-":t.sign+"",this.symbol=t.symbol===void 0?"":t.symbol+"",this.zero=!!t.zero,this.width=t.width===void 0?void 0:+t.width,this.comma=!!t.comma,this.precision=t.precision===void 0?void 0:+t.precision,this.trim=!!t.trim,this.type=t.type===void 0?"":t.type+""}wS.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function X5(t){e:for(var e=t.length,n=1,i=-1,u;n<e;++n)switch(t[n]){case".":i=u=n;break;case"0":i===0&&(i=n),u=n;break;default:if(!+t[n])break e;i>0&&(i=0);break}return i>0?t.slice(0,i)+t.slice(u+1):t}var RL;function $5(t,e){var n=q0(t,e);if(!n)return t+"";var i=n[0],u=n[1],h=u-(RL=Math.max(-8,Math.min(8,Math.floor(u/3)))*3)+1,d=i.length;return h===d?i:h>d?i+new Array(h-d+1).join("0"):h>0?i.slice(0,h)+"."+i.slice(h):"0."+new Array(1-h).join("0")+q0(t,Math.max(0,e+h-1))[0]}function nM(t,e){var n=q0(t,e);if(!n)return t+"";var i=n[0],u=n[1];return u<0?"0."+new Array(-u).join("0")+i:i.length>u+1?i.slice(0,u+1)+"."+i.slice(u+1):i+new Array(u-i.length+2).join("0")}const rM={"%":(t,e)=>(t*100).toFixed(e),b:t=>Math.round(t).toString(2),c:t=>t+"",d:V5,e:(t,e)=>t.toExponential(e),f:(t,e)=>t.toFixed(e),g:(t,e)=>t.toPrecision(e),o:t=>Math.round(t).toString(8),p:(t,e)=>nM(t*100,e),r:nM,s:$5,X:t=>Math.round(t).toString(16).toUpperCase(),x:t=>Math.round(t).toString(16)};function iM(t){return t}var oM=Array.prototype.map,sM=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function Z5(t){var e=t.grouping===void 0||t.thousands===void 0?iM:j5(oM.call(t.grouping,Number),t.thousands+""),n=t.currency===void 0?"":t.currency[0]+"",i=t.currency===void 0?"":t.currency[1]+"",u=t.decimal===void 0?".":t.decimal+"",h=t.numerals===void 0?iM:G5(oM.call(t.numerals,String)),d=t.percent===void 0?"%":t.percent+"",s=t.minus===void 0?"−":t.minus+"",w=t.nan===void 0?"NaN":t.nan+"";function T(D){D=X0(D);var R=D.fill,G=D.align,$=D.sign,ie=D.symbol,_e=D.zero,Y=D.width,B=D.comma,q=D.precision,oe=D.trim,de=D.type;de==="n"?(B=!0,de="g"):rM[de]||(q===void 0&&(q=12),oe=!0,de="g"),(_e||R==="0"&&G==="=")&&(_e=!0,R="0",G="=");var we=ie==="$"?n:ie==="#"&&/[boxX]/.test(de)?"0"+de.toLowerCase():"",Se=ie==="$"?i:/[%p]/.test(de)?d:"",Te=rM[de],xe=/[defgprs%]/.test(de);q=q===void 0?6:/[gprs]/.test(de)?Math.max(1,Math.min(21,q)):Math.max(0,Math.min(20,q));function et(We){var He=we,$e=Se,ze,Pt,Bt;if(de==="c")$e=Te(We)+$e,We="";else{We=+We;var Zt=We<0||1/We<0;if(We=isNaN(We)?w:Te(Math.abs(We),q),oe&&(We=X5(We)),Zt&&+We==0&&$!=="+"&&(Zt=!1),He=(Zt?$==="("?$:s:$==="-"||$==="("?"":$)+He,$e=(de==="s"?sM[8+RL/3]:"")+$e+(Zt&&$==="("?")":""),xe){for(ze=-1,Pt=We.length;++ze<Pt;)if(Bt=We.charCodeAt(ze),48>Bt||Bt>57){$e=(Bt===46?u+We.slice(ze+1):We.slice(ze))+$e,We=We.slice(0,ze);break}}}B&&!_e&&(We=e(We,1/0));var qe=He.length+We.length+$e.length,Et=qe<Y?new Array(Y-qe+1).join(R):"";switch(B&&_e&&(We=e(Et+We,Et.length?Y-$e.length:1/0),Et=""),G){case"<":We=He+We+$e+Et;break;case"=":We=He+Et+We+$e;break;case"^":We=Et.slice(0,qe=Et.length>>1)+He+We+$e+Et.slice(qe);break;default:We=Et+He+We+$e;break}return h(We)}return et.toString=function(){return D+""},et}function A(D,R){var G=T((D=X0(D),D.type="f",D)),$=Math.max(-8,Math.min(8,Math.floor(cd(R)/3)))*3,ie=Math.pow(10,-$),_e=sM[8+$/3];return function(Y){return G(ie*Y)+_e}}return{format:T,formatPrefix:A}}var Bv,NL,kL;W5({thousands:",",grouping:[3],currency:["$",""]});function W5(t){return Bv=Z5(t),NL=Bv.format,kL=Bv.formatPrefix,Bv}function H5(t){return Math.max(0,-cd(Math.abs(t)))}function Y5(t,e){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(cd(e)/3)))*3-cd(Math.abs(t)))}function K5(t,e){return t=Math.abs(t),e=Math.abs(e)-t,Math.max(0,cd(e)-cd(t))+1}function bS(t,e){switch(arguments.length){case 0:break;case 1:this.range(t);break;default:this.range(e).domain(t);break}return this}const aM=Symbol("implicit");function ES(){var t=new N2,e=[],n=[],i=aM;function u(h){let d=t.get(h);if(d===void 0){if(i!==aM)return i;t.set(h,d=e.push(h)-1)}return n[d%n.length]}return u.domain=function(h){if(!arguments.length)return e.slice();e=[],t=new N2;for(const d of h)t.has(d)||t.set(d,e.push(d)-1);return u},u.range=function(h){return arguments.length?(n=Array.from(h),u):n.slice()},u.unknown=function(h){return arguments.length?(i=h,u):i},u.copy=function(){return ES(e,n).unknown(i)},bS.apply(u,arguments),u}function SS(){var t=ES().unknown(void 0),e=t.domain,n=t.range,i=0,u=1,h,d,s=!1,w=0,T=0,A=.5;delete t.unknown;function D(){var R=e().length,G=u<i,$=G?u:i,ie=G?i:u;h=(ie-$)/Math.max(1,R-w+T*2),s&&(h=Math.floor(h)),$+=(ie-$-h*(R-w))*A,d=h*(1-w),s&&($=Math.round($),d=Math.round(d));var _e=e3(R).map(function(Y){return $+h*Y});return n(G?_e.reverse():_e)}return t.domain=function(R){return arguments.length?(e(R),D()):e()},t.range=function(R){return arguments.length?([i,u]=R,i=+i,u=+u,D()):[i,u]},t.rangeRound=function(R){return[i,u]=R,i=+i,u=+u,s=!0,D()},t.bandwidth=function(){return d},t.step=function(){return h},t.round=function(R){return arguments.length?(s=!!R,D()):s},t.padding=function(R){return arguments.length?(w=Math.min(1,T=+R),D()):w},t.paddingInner=function(R){return arguments.length?(w=Math.min(1,R),D()):w},t.paddingOuter=function(R){return arguments.length?(T=+R,D()):T},t.align=function(R){return arguments.length?(A=Math.max(0,Math.min(1,R)),D()):A},t.copy=function(){return SS(e(),[i,u]).round(s).paddingInner(w).paddingOuter(T).align(A)},bS.apply(D(),arguments)}function J5(t){return function(){return t}}function Q5(t){return+t}var lM=[0,1];function Xp(t){return t}function oE(t,e){return(e-=t=+t)?function(n){return(n-t)/e}:J5(isNaN(e)?NaN:.5)}function e4(t,e){var n;return t>e&&(n=t,t=e,e=n),function(i){return Math.max(t,Math.min(e,i))}}function t4(t,e,n){var i=t[0],u=t[1],h=e[0],d=e[1];return u<i?(i=oE(u,i),h=n(d,h)):(i=oE(i,u),h=n(h,d)),function(s){return h(i(s))}}function n4(t,e,n){var i=Math.min(t.length,e.length)-1,u=new Array(i),h=new Array(i),d=-1;for(t[i]<t[0]&&(t=t.slice().reverse(),e=e.slice().reverse());++d<i;)u[d]=oE(t[d],t[d+1]),h[d]=n(e[d],e[d+1]);return function(s){var w=Xz(t,s,1,i)-1;return h[w](u[w](s))}}function r4(t,e){return e.domain(t.domain()).range(t.range()).interpolate(t.interpolate()).clamp(t.clamp()).unknown(t.unknown())}function i4(){var t=lM,e=lM,n=_S,i,u,h,d=Xp,s,w,T;function A(){var R=Math.min(t.length,e.length);return d!==Xp&&(d=e4(t[0],t[R-1])),s=R>2?n4:t4,w=T=null,D}function D(R){return R==null||isNaN(R=+R)?h:(w||(w=s(t.map(i),e,n)))(i(d(R)))}return D.invert=function(R){return d(u((T||(T=s(e,t.map(i),Fa)))(R)))},D.domain=function(R){return arguments.length?(t=Array.from(R,Q5),A()):t.slice()},D.range=function(R){return arguments.length?(e=Array.from(R),A()):e.slice()},D.rangeRound=function(R){return e=Array.from(R),n=hB,A()},D.clamp=function(R){return arguments.length?(d=R?!0:Xp,A()):d!==Xp},D.interpolate=function(R){return arguments.length?(n=R,A()):n},D.unknown=function(R){return arguments.length?(h=R,D):h},function(R,G){return i=R,u=G,A()}}function o4(){return i4()(Xp,Xp)}function s4(t,e,n,i){var u=Qz(t,e,n),h;switch(i=X0(i??",f"),i.type){case"s":{var d=Math.max(Math.abs(t),Math.abs(e));return i.precision==null&&!isNaN(h=Y5(u,d))&&(i.precision=h),kL(i,d)}case"":case"e":case"g":case"p":case"r":{i.precision==null&&!isNaN(h=K5(u,Math.max(Math.abs(t),Math.abs(e))))&&(i.precision=h-(i.type==="e"));break}case"f":case"%":{i.precision==null&&!isNaN(h=H5(u))&&(i.precision=h-(i.type==="%")*2);break}}return NL(i)}function a4(t){var e=t.domain;return t.ticks=function(n){var i=e();return Jz(i[0],i[i.length-1],n??10)},t.tickFormat=function(n,i){var u=e();return s4(u[0],u[u.length-1],n??10,i)},t.nice=function(n){n==null&&(n=10);var i=e(),u=0,h=i.length-1,d=i[u],s=i[h],w,T,A=10;for(s<d&&(T=d,d=s,s=T,T=u,u=h,h=T);A-- >0;){if(T=Wb(d,s,n),T===w)return i[u]=d,i[h]=s,e(i);if(T>0)d=Math.floor(d/T)*T,s=Math.ceil(s/T)*T;else if(T<0)d=Math.ceil(d*T)/T,s=Math.floor(s*T)/T;else break;w=T}return t},t}function TS(){var t=o4();return t.copy=function(){return r4(t,TS())},bS.apply(t,arguments),a4(t)}function vo(t){return function(){return t}}const uM=Math.abs,io=Math.atan2,qh=Math.cos,l4=Math.max,Yw=Math.min,wl=Math.sin,$p=Math.sqrt,Vo=1e-12,d_=Math.PI,$0=d_/2,u0=2*d_;function u4(t){return t>1?0:t<-1?d_:Math.acos(t)}function cM(t){return t>=1?$0:t<=-1?-$0:Math.asin(t)}function c4(t){let e=3;return t.digits=function(n){if(!arguments.length)return e;if(n==null)e=null;else{const i=Math.floor(n);if(!(i>=0))throw new RangeError(`invalid digits: ${n}`);e=i}return t},()=>new P5(e)}function h4(t){return t.innerRadius}function f4(t){return t.outerRadius}function p4(t){return t.startAngle}function d4(t){return t.endAngle}function m4(t){return t&&t.padAngle}function g4(t,e,n,i,u,h,d,s){var w=n-t,T=i-e,A=d-u,D=s-h,R=D*w-A*T;if(!(R*R<Vo))return R=(A*(e-h)-D*(t-u))/R,[t+R*w,e+R*T]}function Uv(t,e,n,i,u,h,d){var s=t-n,w=e-i,T=(d?h:-h)/$p(s*s+w*w),A=T*w,D=-T*s,R=t+A,G=e+D,$=n+A,ie=i+D,_e=(R+$)/2,Y=(G+ie)/2,B=$-R,q=ie-G,oe=B*B+q*q,de=u-h,we=R*ie-$*G,Se=(q<0?-1:1)*$p(l4(0,de*de*oe-we*we)),Te=(we*q-B*Se)/oe,xe=(-we*B-q*Se)/oe,et=(we*q+B*Se)/oe,We=(-we*B+q*Se)/oe,He=Te-_e,$e=xe-Y,ze=et-_e,Pt=We-Y;return He*He+$e*$e>ze*ze+Pt*Pt&&(Te=et,xe=We),{cx:Te,cy:xe,x01:-A,y01:-D,x11:Te*(u/de-1),y11:xe*(u/de-1)}}function _4(){var t=h4,e=f4,n=vo(0),i=null,u=p4,h=d4,d=m4,s=null,w=c4(T);function T(){var A,D,R=+t.apply(this,arguments),G=+e.apply(this,arguments),$=u.apply(this,arguments)-$0,ie=h.apply(this,arguments)-$0,_e=uM(ie-$),Y=ie>$;if(s||(s=A=w()),G<R&&(D=G,G=R,R=D),!(G>Vo))s.moveTo(0,0);else if(_e>u0-Vo)s.moveTo(G*qh($),G*wl($)),s.arc(0,0,G,$,ie,!Y),R>Vo&&(s.moveTo(R*qh(ie),R*wl(ie)),s.arc(0,0,R,ie,$,Y));else{var B=$,q=ie,oe=$,de=ie,we=_e,Se=_e,Te=d.apply(this,arguments)/2,xe=Te>Vo&&(i?+i.apply(this,arguments):$p(R*R+G*G)),et=Yw(uM(G-R)/2,+n.apply(this,arguments)),We=et,He=et,$e,ze;if(xe>Vo){var Pt=cM(xe/R*wl(Te)),Bt=cM(xe/G*wl(Te));(we-=Pt*2)>Vo?(Pt*=Y?1:-1,oe+=Pt,de-=Pt):(we=0,oe=de=($+ie)/2),(Se-=Bt*2)>Vo?(Bt*=Y?1:-1,B+=Bt,q-=Bt):(Se=0,B=q=($+ie)/2)}var Zt=G*qh(B),qe=G*wl(B),Et=R*qh(de),Ct=R*wl(de);if(et>Vo){var kt=G*qh(q),Vt=G*wl(q),hn=R*qh(oe),tr=R*wl(oe),Wn;if(_e<d_)if(Wn=g4(Zt,qe,hn,tr,kt,Vt,Et,Ct)){var Gr=Zt-Wn[0],Kr=qe-Wn[1],ol=kt-Wn[0],rs=Vt-Wn[1],fa=1/wl(u4((Gr*ol+Kr*rs)/($p(Gr*Gr+Kr*Kr)*$p(ol*ol+rs*rs)))/2),rn=$p(Wn[0]*Wn[0]+Wn[1]*Wn[1]);We=Yw(et,(R-rn)/(fa-1)),He=Yw(et,(G-rn)/(fa+1))}else We=He=0}Se>Vo?He>Vo?($e=Uv(hn,tr,Zt,qe,G,He,Y),ze=Uv(kt,Vt,Et,Ct,G,He,Y),s.moveTo($e.cx+$e.x01,$e.cy+$e.y01),He<et?s.arc($e.cx,$e.cy,He,io($e.y01,$e.x01),io(ze.y01,ze.x01),!Y):(s.arc($e.cx,$e.cy,He,io($e.y01,$e.x01),io($e.y11,$e.x11),!Y),s.arc(0,0,G,io($e.cy+$e.y11,$e.cx+$e.x11),io(ze.cy+ze.y11,ze.cx+ze.x11),!Y),s.arc(ze.cx,ze.cy,He,io(ze.y11,ze.x11),io(ze.y01,ze.x01),!Y))):(s.moveTo(Zt,qe),s.arc(0,0,G,B,q,!Y)):s.moveTo(Zt,qe),!(R>Vo)||!(we>Vo)?s.lineTo(Et,Ct):We>Vo?($e=Uv(Et,Ct,kt,Vt,R,-We,Y),ze=Uv(Zt,qe,hn,tr,R,-We,Y),s.lineTo($e.cx+$e.x01,$e.cy+$e.y01),We<et?s.arc($e.cx,$e.cy,We,io($e.y01,$e.x01),io(ze.y01,ze.x01),!Y):(s.arc($e.cx,$e.cy,We,io($e.y01,$e.x01),io($e.y11,$e.x11),!Y),s.arc(0,0,R,io($e.cy+$e.y11,$e.cx+$e.x11),io(ze.cy+ze.y11,ze.cx+ze.x11),Y),s.arc(ze.cx,ze.cy,We,io(ze.y11,ze.x11),io(ze.y01,ze.x01),!Y))):s.arc(0,0,R,de,oe,Y)}if(s.closePath(),A)return s=null,A+""||null}return T.centroid=function(){var A=(+t.apply(this,arguments)+ +e.apply(this,arguments))/2,D=(+u.apply(this,arguments)+ +h.apply(this,arguments))/2-d_/2;return[qh(D)*A,wl(D)*A]},T.innerRadius=function(A){return arguments.length?(t=typeof A=="function"?A:vo(+A),T):t},T.outerRadius=function(A){return arguments.length?(e=typeof A=="function"?A:vo(+A),T):e},T.cornerRadius=function(A){return arguments.length?(n=typeof A=="function"?A:vo(+A),T):n},T.padRadius=function(A){return arguments.length?(i=A==null?null:typeof A=="function"?A:vo(+A),T):i},T.startAngle=function(A){return arguments.length?(u=typeof A=="function"?A:vo(+A),T):u},T.endAngle=function(A){return arguments.length?(h=typeof A=="function"?A:vo(+A),T):h},T.padAngle=function(A){return arguments.length?(d=typeof A=="function"?A:vo(+A),T):d},T.context=function(A){return arguments.length?(s=A??null,T):s},T}function y4(t){return typeof t=="object"&&"length"in t?t:Array.from(t)}function v4(t,e){return e<t?-1:e>t?1:e>=t?0:NaN}function x4(t){return t}function w4(){var t=x4,e=v4,n=null,i=vo(0),u=vo(u0),h=vo(0);function d(s){var w,T=(s=y4(s)).length,A,D,R=0,G=new Array(T),$=new Array(T),ie=+i.apply(this,arguments),_e=Math.min(u0,Math.max(-u0,u.apply(this,arguments)-ie)),Y,B=Math.min(Math.abs(_e)/T,h.apply(this,arguments)),q=B*(_e<0?-1:1),oe;for(w=0;w<T;++w)(oe=$[G[w]=w]=+t(s[w],w,s))>0&&(R+=oe);for(e!=null?G.sort(function(de,we){return e($[de],$[we])}):n!=null&&G.sort(function(de,we){return n(s[de],s[we])}),w=0,D=R?(_e-T*q)/R:0;w<T;++w,ie=Y)A=G[w],oe=$[A],Y=ie+(oe>0?oe*D:0)+q,$[A]={data:s[A],index:w,value:oe,startAngle:ie,endAngle:Y,padAngle:B};return $}return d.value=function(s){return arguments.length?(t=typeof s=="function"?s:vo(+s),d):t},d.sortValues=function(s){return arguments.length?(e=s,n=null,d):e},d.sort=function(s){return arguments.length?(n=s,e=null,d):n},d.startAngle=function(s){return arguments.length?(i=typeof s=="function"?s:vo(+s),d):i},d.endAngle=function(s){return arguments.length?(u=typeof s=="function"?s:vo(+s),d):u},d.padAngle=function(s){return arguments.length?(h=typeof s=="function"?s:vo(+s),d):h},d}function Og(t,e,n){this.k=t,this.x=e,this.y=n}Og.prototype={constructor:Og,scale:function(t){return t===1?this:new Og(this.k*t,this.x,this.y)},translate:function(t,e){return t===0&e===0?this:new Og(this.k,this.x+this.k*t,this.y+this.k*e)},apply:function(t){return[t[0]*this.k+this.x,t[1]*this.k+this.y]},applyX:function(t){return t*this.k+this.x},applyY:function(t){return t*this.k+this.y},invert:function(t){return[(t[0]-this.x)/this.k,(t[1]-this.y)/this.k]},invertX:function(t){return(t-this.x)/this.k},invertY:function(t){return(t-this.y)/this.k},rescaleX:function(t){return t.copy().domain(t.range().map(this.invertX,this).map(t.invert,t))},rescaleY:function(t){return t.copy().domain(t.range().map(this.invertY,this).map(t.invert,t))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};Og.prototype;var OL={exports:{}};(function(t,e){(function(n,i){t.exports=i()})(GM,function(){var n,i,u;function h(s,w){if(!n)n=w;else if(!i)i=w;else{var T="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+n+")(sharedChunk); ("+i+")(sharedChunk); self.onerror = null;",A={};n(A),u=w(A),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(u.workerUrl=window.URL.createObjectURL(new Blob([T],{type:"text/javascript"})))}}h(["exports"],function(s){var w=typeof self<"u"?self:{},T="2.15.0";let A;const D={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(A==null){const o=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{A={}.API_URL_REGEX!=null?new RegExp({}.API_URL_REGEX):o}catch{A=o}}return A},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!D.API_URL)return null;try{const o=new URL(D.API_URL);return o.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":o.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},R={supported:!1,testSupport:function(o){!ie&&$&&(_e?Y(o):G=o)}};let G,$,ie=!1,_e=!1;function Y(o){const r=o.createTexture();o.bindTexture(o.TEXTURE_2D,r);try{if(o.texImage2D(o.TEXTURE_2D,0,o.RGBA,o.RGBA,o.UNSIGNED_BYTE,$),o.isContextLost())return;R.supported=!0}catch{}o.deleteTexture(r),ie=!0}w.document&&($=w.document.createElement("img"),$.onload=function(){G&&Y(G),G=null,_e=!0},$.onerror=function(){ie=!0,G=null},$.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const B="01";function q(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}var oe=de;function de(o,r,a,c){this.cx=3*o,this.bx=3*(a-o)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*r,this.by=3*(c-r)-this.cy,this.ay=1-this.cy-this.by,this.p1x=o,this.p1y=r,this.p2x=a,this.p2y=c}de.prototype={sampleCurveX:function(o){return((this.ax*o+this.bx)*o+this.cx)*o},sampleCurveY:function(o){return((this.ay*o+this.by)*o+this.cy)*o},sampleCurveDerivativeX:function(o){return(3*this.ax*o+2*this.bx)*o+this.cx},solveCurveX:function(o,r){if(r===void 0&&(r=1e-6),o<0)return 0;if(o>1)return 1;for(var a=o,c=0;c<8;c++){var p=this.sampleCurveX(a)-o;if(Math.abs(p)<r)return a;var g=this.sampleCurveDerivativeX(a);if(Math.abs(g)<1e-6)break;a-=p/g}var y=0,x=1;for(a=o,c=0;c<20&&(p=this.sampleCurveX(a),!(Math.abs(p-o)<r));c++)o>p?y=a:x=a,a=.5*(x-y)+y;return a},solve:function(o,r){return this.sampleCurveY(this.solveCurveX(o,r))}};var we=q(oe),Se=Te;function Te(o,r){this.x=o,this.y=r}Te.prototype={clone:function(){return new Te(this.x,this.y)},add:function(o){return this.clone()._add(o)},sub:function(o){return this.clone()._sub(o)},multByPoint:function(o){return this.clone()._multByPoint(o)},divByPoint:function(o){return this.clone()._divByPoint(o)},mult:function(o){return this.clone()._mult(o)},div:function(o){return this.clone()._div(o)},rotate:function(o){return this.clone()._rotate(o)},rotateAround:function(o,r){return this.clone()._rotateAround(o,r)},matMult:function(o){return this.clone()._matMult(o)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(o){return this.x===o.x&&this.y===o.y},dist:function(o){return Math.sqrt(this.distSqr(o))},distSqr:function(o){var r=o.x-this.x,a=o.y-this.y;return r*r+a*a},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(o){return Math.atan2(this.y-o.y,this.x-o.x)},angleWith:function(o){return this.angleWithSep(o.x,o.y)},angleWithSep:function(o,r){return Math.atan2(this.x*r-this.y*o,this.x*o+this.y*r)},_matMult:function(o){var r=o[2]*this.x+o[3]*this.y;return this.x=o[0]*this.x+o[1]*this.y,this.y=r,this},_add:function(o){return this.x+=o.x,this.y+=o.y,this},_sub:function(o){return this.x-=o.x,this.y-=o.y,this},_mult:function(o){return this.x*=o,this.y*=o,this},_div:function(o){return this.x/=o,this.y/=o,this},_multByPoint:function(o){return this.x*=o.x,this.y*=o.y,this},_divByPoint:function(o){return this.x/=o.x,this.y/=o.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var o=this.y;return this.y=this.x,this.x=-o,this},_rotate:function(o){var r=Math.cos(o),a=Math.sin(o),c=a*this.x+r*this.y;return this.x=r*this.x-a*this.y,this.y=c,this},_rotateAround:function(o,r){var a=Math.cos(o),c=Math.sin(o),p=r.y+c*(this.x-r.x)+a*(this.y-r.y);return this.x=r.x+a*(this.x-r.x)-c*(this.y-r.y),this.y=p,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Te.convert=function(o){return o instanceof Te?o:Array.isArray(o)?new Te(o[0],o[1]):o};var xe=q(Se);const et=Math.PI/180,We=180/Math.PI;function He(o){return o*et}function $e(o){return o*We}const ze=[[0,0],[1,0],[1,1],[0,1]];function Pt(o){if(o<=0)return 0;if(o>=1)return 1;const r=o*o,a=r*o;return 4*(o<.5?a:3*(o-r)+a-.75)}function Bt(o,r,a,c){const p=new we(o,r,a,c);return function(g){return p.solve(g)}}const Zt=Bt(.25,.1,.25,1);function qe(o,r,a){return Math.min(a,Math.max(r,o))}function Et(o,r,a){return(a=qe((a-o)/(r-o),0,1))*a*(3-2*a)}function Ct(o,r,a){const c=a-r,p=((o-r)%c+c)%c+r;return p===r?a:p}function kt(o,r,a){if(!o.length)return a(null,[]);let c=o.length;const p=new Array(o.length);let g=null;o.forEach((y,x)=>{r(y,(E,S)=>{E&&(g=E),p[x]=S,--c==0&&a(g,p)})})}function Vt(o){const r=[];for(const a in o)r.push(o[a]);return r}function hn(o,...r){for(const a of r)for(const c in a)o[c]=a[c];return o}let tr=1;function Wn(){return tr++}function Gr(){return function o(r){return r?(r^Math.random()*(16>>r/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,o)}()}function Kr(o){return o<=1?1:Math.pow(2,Math.ceil(Math.log(o)/Math.LN2))}function ol(o){return!!o&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(o)}function rs(o,r){o.forEach(a=>{r[a]&&(r[a]=r[a].bind(r))})}function fa(o,r){return o.indexOf(r,o.length-r.length)!==-1}function rn(o,r,a){const c={};for(const p in o)c[p]=r.call(a||this,o[p],p,o);return c}function Ou(o,r,a){const c={};for(const p in o)r.call(a||this,o[p],p,o)&&(c[p]=o[p]);return c}function fo(o){return Array.isArray(o)?o.map(fo):typeof o=="object"&&o?rn(o,fo):o}const Jc={};function nr(o){Jc[o]||(typeof console<"u"&&console.warn(o),Jc[o]=!0)}function Po(o,r,a){return(a.y-o.y)*(r.x-o.x)>(r.y-o.y)*(a.x-o.x)}function Pf(o){let r=0;for(let a,c,p=0,g=o.length,y=g-1;p<g;y=p++)a=o[p],c=o[y],r+=(c.x-a.x)*(a.y+c.y);return r}function pa(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function po(o){const r={};if(o.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(a,c,p,g)=>{const y=p||g;return r[c]=!y||y.toLowerCase(),""}),r["max-age"]){const a=parseInt(r["max-age"],10);isNaN(a)?delete r["max-age"]:r["max-age"]=a}return r}let Qc=null;function zu(o){if(Qc==null){const r=o.navigator?o.navigator.userAgent:null;Qc=!!o.safari||!(!r||!(/\b(iPad|iPhone|iPod)\b/.test(r)||r.match("Safari")&&!r.match("Chrome")))}return Qc}function eh(o){try{const r=w[o];return r.setItem("_mapbox_test_",1),r.removeItem("_mapbox_test_"),!0}catch{return!1}}function sl(o,r){return[o[4*r],o[4*r+1],o[4*r+2],o[4*r+3]]}const Fu="mapbox-tiles";let Lf=500,Df=50,Lo,al;function th(){try{return w.caches}catch{}}function Gl(){th()&&!Lo&&(Lo=w.caches.open(Fu))}function Bu(o){const r=o.indexOf("?");if(r<0)return o;const a=function(p){const g=p.indexOf("?");return g>0?p.slice(g+1).split("&"):[]}(o),c=a.filter(p=>{const g=p.split("=");return g[0]==="language"||g[0]==="worldview"});return c.length?`${o.slice(0,r)}?${c.join("&")}`:o.slice(0,r)}let nh=1/0;const ql={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(ql);class ll extends Error{constructor(r,a,c){a===401&&Pe(c)&&(r+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(r),this.status=a,this.url=c}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Xl=pa()?()=>self.worker&&self.worker.referrer:()=>(w.location.protocol==="blob:"?w.parent:w).location.href,$l=function(o,r){if(!(/^file:/.test(a=o.url)||/^file:/.test(Xl())&&!/^\w+:/.test(a))){if(w.fetch&&w.Request&&w.AbortController&&w.Request.prototype.hasOwnProperty("signal"))return function(c,p){const g=new w.AbortController,y=new w.Request(c.url,{method:c.method||"GET",body:c.body,credentials:c.credentials,headers:c.headers,referrer:Xl(),referrerPolicy:c.referrerPolicy,signal:g.signal});let x=!1,E=!1;const S=(M=y.url).indexOf("sku=")>0&&Pe(M);var M;c.type==="json"&&y.headers.set("Accept","application/json");const L=(z,F,j)=>{if(E)return;if(z&&z.message!=="SecurityError"&&nr(z.toString()),F&&j)return N(F);const H=Date.now();w.fetch(y).then(ne=>{if(ne.ok){const he=S?ne.clone():null;return N(ne,he,H)}return p(new ll(ne.statusText,ne.status,c.url))}).catch(ne=>{ne.name!=="AbortError"&&p(new Error(`${ne.message} ${c.url}`))})},N=(z,F,j)=>{(c.type==="arrayBuffer"?z.arrayBuffer():c.type==="json"?z.json():z.text()).then(H=>{E||(F&&j&&function(ne,he,re){if(Gl(),!Lo)return;const ue={status:he.status,statusText:he.statusText,headers:new w.Headers};he.headers.forEach((ke,De)=>ue.headers.set(De,ke));const pe=po(he.headers.get("Cache-Control")||"");if(pe["no-store"])return;pe["max-age"]&&ue.headers.set("Expires",new Date(re+1e3*pe["max-age"]).toUTCString());const fe=ue.headers.get("Expires");fe&&(new Date(fe).getTime()-re<42e4||function(ke,De){if(al===void 0)try{new Response(new ReadableStream),al=!0}catch{al=!1}al?De(ke.body):ke.blob().then(De)}(he,ke=>{const De=new w.Response(ke,ue);Gl(),Lo&&Lo.then(Xe=>Xe.put(Bu(ne.url),De)).catch(Xe=>nr(Xe.message))}))}(y,F,j),x=!0,p(null,H,z.headers.get("Cache-Control"),z.headers.get("Expires")))}).catch(H=>{E||p(new Error(H.message))})};return S?function(z,F){if(Gl(),!Lo)return F(null);const j=Bu(z.url);Lo.then(H=>{H.match(j).then(ne=>{const he=function(re){if(!re)return!1;const ue=new Date(re.headers.get("Expires")||0),pe=po(re.headers.get("Cache-Control")||"");return ue>Date.now()&&!pe["no-cache"]}(ne);H.delete(j),he&&H.put(j,ne.clone()),F(null,ne,he)}).catch(F)}).catch(F)}(y,L):L(null,null),{cancel:()=>{E=!0,x||g.abort()}}}(o,r);if(pa()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",o,r,void 0,!0)}var a;return function(c,p){const g=new w.XMLHttpRequest;g.open(c.method||"GET",c.url,!0),c.type==="arrayBuffer"&&(g.responseType="arraybuffer");for(const y in c.headers)g.setRequestHeader(y,c.headers[y]);return c.type==="json"&&(g.responseType="text",g.setRequestHeader("Accept","application/json")),g.withCredentials=c.credentials==="include",g.onerror=()=>{p(new Error(g.statusText))},g.onload=()=>{if((g.status>=200&&g.status<300||g.status===0)&&g.response!==null){let y=g.response;if(c.type==="json")try{y=JSON.parse(g.response)}catch(x){return p(x)}p(null,y,g.getResponseHeader("Cache-Control"),g.getResponseHeader("Expires"))}else p(new ll(g.statusText,g.status,c.url))},g.send(c.body),{cancel:()=>g.abort()}}(o,r)},Uu=function(o,r){return $l(hn(o,{type:"arrayBuffer"}),r)};function Rf(o){const r=w.document.createElement("a");return r.href=o,r.protocol===w.document.location.protocol&&r.host===w.document.location.host}const ce="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let X,Z;X=[],Z=0;const le=function(o,r){if(R.supported&&(o.headers||(o.headers={}),o.headers.accept="image/webp,*/*"),Z>=D.MAX_PARALLEL_IMAGE_REQUESTS){const g={requestParameters:o,callback:r,cancelled:!1,cancel(){this.cancelled=!0}};return X.push(g),g}Z++;let a=!1;const c=()=>{if(!a)for(a=!0,Z--;X.length&&Z<D.MAX_PARALLEL_IMAGE_REQUESTS;){const g=X.shift(),{requestParameters:y,callback:x,cancelled:E}=g;E||(g.cancel=le(y,x).cancel)}},p=Uu(o,(g,y,x,E)=>{c(),g?r(g):y&&(w.createImageBitmap?function(S,M){const L=new w.Blob([new Uint8Array(S)],{type:"image/png"});w.createImageBitmap(L).then(N=>{M(null,N)}).catch(N=>{M(new Error(`Could not load image because of ${N.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(y,(S,M)=>r(S,M,x,E)):function(S,M){const L=new w.Image,N=w.URL;L.onload=()=>{M(null,L),N.revokeObjectURL(L.src),L.onload=null,w.requestAnimationFrame(()=>{L.src=ce})},L.onerror=()=>M(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const z=new w.Blob([new Uint8Array(S)],{type:"image/png"});L.src=S.byteLength?N.createObjectURL(z):ce}(y,(S,M)=>r(S,M,x,E)))});return{cancel:()=>{p.cancel(),c()}}},me="NO_ACCESS_TOKEN";function Ee(o){return o.indexOf("mapbox:")===0}function Pe(o){return D.API_URL_REGEX.test(o)}function Ae(o){return D.API_CDN_URL_REGEX.test(o)}function be(o){return D.API_STYLE_REGEX.test(o)&&!Ue(o)}function Ue(o){return D.API_SPRITE_REGEX.test(o)}const ct=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function ft(o){const r=o.match(ct);if(!r)throw new Error("Unable to parse URL object");return{protocol:r[1],authority:r[2],path:r[3]||"/",params:r[4]?r[4].split("&"):[]}}function at(o){const r=o.params.length?`?${o.params.join("&")}`:"";return`${o.protocol}://${o.authority}${o.path}${r}`}const Wt="mapbox.eventData";function en(o){if(!o)return null;const r=o.split(".");if(!r||r.length!==3)return null;try{return JSON.parse(decodeURIComponent(w.atob(r[1]).split("").map(a=>"%"+("00"+a.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class Ht{constructor(r){this.type=r,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(r){const a=en(D.ACCESS_TOKEN);let c="";return c=a&&a.u?w.btoa(encodeURIComponent(a.u).replace(/%([0-9A-F]{2})/g,(p,g)=>String.fromCharCode(+("0x"+g)))):D.ACCESS_TOKEN||"",r?`${Wt}.${r}:${c}`:`${Wt}:${c}`}fetchEventData(){const r=eh("localStorage"),a=this.getStorageKey(),c=this.getStorageKey("uuid");if(r)try{const p=w.localStorage.getItem(a);p&&(this.eventData=JSON.parse(p));const g=w.localStorage.getItem(c);g&&(this.anonId=g)}catch{nr("Unable to read from LocalStorage")}}saveEventData(){const r=eh("localStorage"),a=this.getStorageKey(),c=this.getStorageKey("uuid");if(r)try{w.localStorage.setItem(c,this.anonId),Object.keys(this.eventData).length>=1&&w.localStorage.setItem(a,JSON.stringify(this.eventData))}catch{nr("Unable to write to LocalStorage")}}processRequests(r){}postEvent(r,a,c,p){if(!D.EVENTS_URL)return;const g=ft(D.EVENTS_URL);g.params.push(`access_token=${p||D.ACCESS_TOKEN||""}`);const y={event:this.type,created:new Date(r).toISOString()},x=a?hn(y,a):y,E={url:at(g),headers:{"Content-Type":"text/plain"},body:JSON.stringify([x])};this.pendingRequest=function(S,M){return $l(hn(S,{method:"POST"}),M)}(E,S=>{this.pendingRequest=null,c(S),this.saveEventData(),this.processRequests(p)})}queueRequest(r,a){this.queue.push(r),this.processRequests(a)}}const tn=new class extends Ht{constructor(o){super("appUserTurnstile"),this._customAccessToken=o}postTurnstileEvent(o,r){D.EVENTS_URL&&D.ACCESS_TOKEN&&Array.isArray(o)&&o.some(a=>Ee(a)||Pe(a))&&this.queueRequest(Date.now(),r)}processRequests(o){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const r=en(D.ACCESS_TOKEN),a=r?r.u:D.ACCESS_TOKEN;let c=a!==this.eventData.tokenU;ol(this.anonId)||(this.anonId=Gr(),c=!0);const p=this.queue.shift();if(this.eventData.lastSuccess){const g=new Date(this.eventData.lastSuccess),y=new Date(p),x=(p-this.eventData.lastSuccess)/864e5;c=c||x>=1||x<-1||g.getDate()!==y.getDate()}else c=!0;c?this.postEvent(p,{sdkIdentifier:"mapbox-gl-js",sdkVersion:T,skuId:B,"enabled.telemetry":!1,userId:this.anonId},g=>{g||(this.eventData.lastSuccess=p,this.eventData.tokenU=a)},o):this.processRequests()}},fn=tn.postTurnstileEvent.bind(tn),rr=new class extends Ht{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(o,r,a,c){this.skuToken=r,this.errorCb=c,D.EVENTS_URL&&(a||D.ACCESS_TOKEN?this.queueRequest({id:o,timestamp:Date.now()},a):this.errorCb(new Error(me)))}processRequests(o){if(this.pendingRequest||this.queue.length===0)return;const{id:r,timestamp:a}=this.queue.shift();r&&this.success[r]||(this.anonId||this.fetchEventData(),ol(this.anonId)||(this.anonId=Gr()),this.postEvent(a,{sdkIdentifier:"mapbox-gl-js",sdkVersion:T,skuId:B,skuToken:this.skuToken,userId:this.anonId},c=>{c?this.errorCb(c):r&&(this.success[r]=!0)},o))}},Cr=rr.postMapLoadEvent.bind(rr),wi=new class extends Ht{constructor(){super("gljs.performance")}postPerformanceEvent(o,r){D.EVENTS_URL&&(o||D.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:r},o)}processRequests(o){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:r,performanceData:a}=this.queue.shift(),c=function(p){const g=w.performance.getEntriesByType("resource"),y=w.performance.getEntriesByType("mark"),x=function(N){const z={};if(N){for(const F in N)if(F!=="other")for(const j of N[F]){const H=`${F}ResolveRangeMin`,ne=`${F}ResolveRangeMax`,he=`${F}RequestCount`,re=`${F}RequestCachedCount`;z[H]=Math.min(z[H]||1/0,j.startTime),z[ne]=Math.max(z[ne]||-1/0,j.responseEnd);const ue=pe=>{z[pe]===void 0&&(z[pe]=0),++z[pe]};j.transferSize!==void 0&&j.transferSize===0&&ue(re),ue(he)}}return z}(function(N,z){const F={};if(N)for(const j of N){const H=z(j);F[H]===void 0&&(F[H]=[]),F[H].push(j)}return F}(g,Z_)),E=w.devicePixelRatio,S=w.navigator.connection||w.navigator.mozConnection||w.navigator.webkitConnection,M={counters:[],metadata:[],attributes:[]},L=(N,z,F)=>{F!=null&&N.push({name:z,value:F.toString()})};for(const N in x)L(M.counters,N,x[N]);if(p.interactionRange[0]!==1/0&&p.interactionRange[1]!==-1/0&&(L(M.counters,"interactionRangeMin",p.interactionRange[0]),L(M.counters,"interactionRangeMax",p.interactionRange[1])),y)for(const N of Object.keys(Vu)){const z=Vu[N],F=y.find(j=>j.name===z);F&&L(M.counters,z,F.startTime)}return L(M.counters,"visibilityHidden",p.visibilityHidden),L(M.attributes,"style",function(N){if(N)for(const z of N){const F=z.name.split("?")[0];if(be(F)){const j=F.split("/").slice(-2);if(j.length===2)return`mapbox://styles/${j[0]}/${j[1]}`}}}(g)),L(M.attributes,"terrainEnabled",p.terrainEnabled?"true":"false"),L(M.attributes,"fogEnabled",p.fogEnabled?"true":"false"),L(M.attributes,"projection",p.projection),L(M.attributes,"zoom",p.zoom),L(M.metadata,"devicePixelRatio",E),L(M.metadata,"connectionEffectiveType",S?S.effectiveType:void 0),L(M.metadata,"navigatorUserAgent",w.navigator.userAgent),L(M.metadata,"screenWidth",w.screen.width),L(M.metadata,"screenHeight",w.screen.height),L(M.metadata,"windowWidth",w.innerWidth),L(M.metadata,"windowHeight",w.innerHeight),L(M.metadata,"mapWidth",p.width/E),L(M.metadata,"mapHeight",p.height/E),L(M.metadata,"webglRenderer",p.renderer),L(M.metadata,"webglVendor",p.vendor),L(M.metadata,"sdkVersion",T),L(M.metadata,"sdkIdentifier","mapbox-gl-js"),M}(a);for(const p of c.metadata);for(const p of c.counters);for(const p of c.attributes);this.postEvent(r,c,()=>{},o)}},qr=wi.postPerformanceEvent.bind(wi),Ls=new class extends Ht{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(o,r,a,c){if(!D.API_URL||!D.SESSION_PATH)return;const p=ft(D.API_URL+D.SESSION_PATH);p.params.push(`sku=${r||""}`),p.params.push(`access_token=${c||D.ACCESS_TOKEN||""}`);const g={url:at(p),headers:{"Content-Type":"text/plain"}};this.pendingRequest=function(y,x){return $l(hn(y,{method:"GET"}),x)}(g,y=>{this.pendingRequest=null,a(y),this.saveEventData(),this.processRequests(c)})}getSessionAPI(o,r,a,c){this.skuToken=r,this.errorCb=c,D.SESSION_PATH&&D.API_URL&&(a||D.ACCESS_TOKEN?this.queueRequest({id:o,timestamp:Date.now()},a):this.errorCb(new Error(me)))}processRequests(o){if(this.pendingRequest||this.queue.length===0)return;const{id:r,timestamp:a}=this.queue.shift();r&&this.success[r]||this.getSession(a,this.skuToken,c=>{c?this.errorCb(c):r&&(this.success[r]=!0)},o)}},Jr=Ls.getSessionAPI.bind(Ls),zi=new Set,Vu={create:"create",load:"load",fullLoad:"fullLoad"},Fx={mark(o){w.performance.mark(o)},measure(o,r,a){w.performance.measure(o,r,a)}};function Z_(o){const r=o.name.split("?")[0];return Ae(r)&&r.includes("mapbox-gl.js")?"javascript":Ae(r)&&r.includes("mapbox-gl.css")?"css":function(a){return D.API_FONTS_REGEX.test(a)}(r)?"fontRange":Ue(r)?"sprite":be(r)?"style":function(a){return D.API_TILEJSON_REGEX.test(a)}(r)?"tilejson":"other"}const Sn=w.performance;function jd(o){const r=o?o.url.toString():void 0;return Sn.getEntriesByName(r)}let rh,Gd,Nf,Ds;const da={now:()=>Nf!==void 0?Nf:w.performance.now(),setNow(o){Nf=o},restoreNow(){Nf=void 0},frame(o){const r=w.requestAnimationFrame(o);return{cancel:()=>w.cancelAnimationFrame(r)}},getImageData(o,r=0){const{width:a,height:c}=o;Ds||(Ds=w.document.createElement("canvas"));const p=Ds.getContext("2d",{willReadFrequently:!0});if(!p)throw new Error("failed to create canvas 2d context");return(a>Ds.width||c>Ds.height)&&(Ds.width=a,Ds.height=c),p.clearRect(-r,-r,a+2*r,c+2*r),p.drawImage(o,0,0,a,c),p.getImageData(-r,-r,a+2*r,c+2*r)},resolveURL:o=>(rh||(rh=w.document.createElement("a")),rh.href=o,rh.href),get devicePixelRatio(){return w.devicePixelRatio},get prefersReducedMotion(){return!!w.matchMedia&&(Gd==null&&(Gd=w.matchMedia("(prefers-reduced-motion: reduce)")),Gd.matches)}};function qd(o,r,a){a[o]&&a[o].indexOf(r)!==-1||(a[o]=a[o]||[],a[o].push(r))}function Xd(o,r,a){if(a&&a[o]){const c=a[o].indexOf(r);c!==-1&&a[o].splice(c,1)}}class Zl{constructor(r,a={}){hn(this,a),this.type=r}}class ma extends Zl{constructor(r,a={}){super("error",hn({error:r},a))}}class ih{on(r,a){return this._listeners=this._listeners||{},qd(r,a,this._listeners),this}off(r,a){return Xd(r,a,this._listeners),Xd(r,a,this._oneTimeListeners),this}once(r,a){return a?(this._oneTimeListeners=this._oneTimeListeners||{},qd(r,a,this._oneTimeListeners),this):new Promise(c=>this.once(r,c))}fire(r,a){typeof r=="string"&&(r=new Zl(r,a||{}));const c=r.type;if(this.listens(c)){r.target=this;const p=this._listeners&&this._listeners[c]?this._listeners[c].slice():[];for(const x of p)x.call(this,r);const g=this._oneTimeListeners&&this._oneTimeListeners[c]?this._oneTimeListeners[c].slice():[];for(const x of g)Xd(c,x,this._oneTimeListeners),x.call(this,r);const y=this._eventedParent;y&&(hn(r,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),y.fire(r))}else r instanceof ma&&console.error(r.error);return this}listens(r){return!!(this._listeners&&this._listeners[r]&&this._listeners[r].length>0||this._oneTimeListeners&&this._oneTimeListeners[r]&&this._oneTimeListeners[r].length>0||this._eventedParent&&this._eventedParent.listens(r))}setEventedParent(r,a){return this._eventedParent=r,this._eventedParentData=a,this}}var Ge=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{},"globe":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["source"]}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["fill-extrusion-edge-radius"]},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"requires":["fill-extrusion-edge-radius"],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":false,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"transition":false,"requires":[{"source":"geojson","has":{"lineMetrics":true}}],"property-type":"constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function ga(o,...r){for(const a of r)for(const c in a)o[c]=a[c];return o}function Ir(o){return o instanceof Number||o instanceof String||o instanceof Boolean?o.valueOf():o}function Qr(o){if(Array.isArray(o))return o.map(Qr);if(o instanceof Object&&!(o instanceof Number||o instanceof String||o instanceof Boolean)){const r={};for(const a in o)r[a]=Qr(o[a]);return r}return Ir(o)}class W_ extends Error{constructor(r,a){super(a),this.message=a,this.key=r}}var Rs=W_;class $d{constructor(r,a=[]){this.parent=r,this.bindings={};for(const[c,p]of a)this.bindings[c]=p}concat(r){return new $d(this,r)}get(r){if(this.bindings[r])return this.bindings[r];if(this.parent)return this.parent.get(r);throw new Error(`${r} not found in scope.`)}has(r){return!!this.bindings[r]||!!this.parent&&this.parent.has(r)}}var H_=$d;const ju={kind:"null"},vt={kind:"number"},cn={kind:"string"},on={kind:"boolean"},mo={kind:"color"},is={kind:"object"},sn={kind:"value"},go={kind:"collator"},oh={kind:"formatted"},Wl={kind:"resolvedImage"};function Do(o,r){return{kind:"array",itemType:o,N:r}}function Jn(o){if(o.kind==="array"){const r=Jn(o.itemType);return typeof o.N=="number"?`array<${r}, ${o.N}>`:o.itemType.kind==="value"?"array":`array<${r}>`}return o.kind}const Y_=[ju,vt,cn,on,mo,oh,is,Do(sn),Wl];function _a(o,r){if(r.kind==="error")return null;if(o.kind==="array"){if(r.kind==="array"&&(r.N===0&&r.itemType.kind==="value"||!_a(o.itemType,r.itemType))&&(typeof o.N!="number"||o.N===r.N))return null}else{if(o.kind===r.kind)return null;if(o.kind==="value"){for(const a of Y_)if(!_a(a,r))return null}}return`Expected ${Jn(o)} but found ${Jn(r)} instead.`}function sh(o,r){return r.some(a=>a.kind===o.kind)}function ah(o,r){return r.some(a=>a==="null"?o===null:a==="array"?Array.isArray(o):a==="object"?o&&!Array.isArray(o)&&typeof o=="object":a===typeof o)}var Zd,K_={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function lh(o){return(o=Math.round(o))<0?0:o>255?255:o}function uh(o){return lh(o[o.length-1]==="%"?parseFloat(o)/100*255:parseInt(o))}function kf(o){return(r=o[o.length-1]==="%"?parseFloat(o)/100:parseFloat(o))<0?0:r>1?1:r;var r}function Gu(o,r,a){return a<0?a+=1:a>1&&(a-=1),6*a<1?o+(r-o)*a*6:2*a<1?r:3*a<2?o+(r-o)*(2/3-a)*6:o}try{Zd={}.parseCSSColor=function(o){var r,a=o.replace(/ /g,"").toLowerCase();if(a in K_)return K_[a].slice();if(a[0]==="#")return a.length===4?(r=parseInt(a.substr(1),16))>=0&&r<=4095?[(3840&r)>>4|(3840&r)>>8,240&r|(240&r)>>4,15&r|(15&r)<<4,1]:null:a.length===7&&(r=parseInt(a.substr(1),16))>=0&&r<=16777215?[(16711680&r)>>16,(65280&r)>>8,255&r,1]:null;var c=a.indexOf("("),p=a.indexOf(")");if(c!==-1&&p+1===a.length){var g=a.substr(0,c),y=a.substr(c+1,p-(c+1)).split(","),x=1;switch(g){case"rgba":if(y.length!==4)return null;x=kf(y.pop());case"rgb":return y.length!==3?null:[uh(y[0]),uh(y[1]),uh(y[2]),x];case"hsla":if(y.length!==4)return null;x=kf(y.pop());case"hsl":if(y.length!==3)return null;var E=(parseFloat(y[0])%360+360)%360/360,S=kf(y[1]),M=kf(y[2]),L=M<=.5?M*(S+1):M+S-M*S,N=2*M-L;return[lh(255*Gu(N,L,E+1/3)),lh(255*Gu(N,L,E)),lh(255*Gu(N,L,E-1/3)),x];default:return null}}return null}}catch{}class Wi{constructor(r,a,c,p=1){this.r=r,this.g=a,this.b=c,this.a=p}static parse(r){if(!r)return;if(r instanceof Wi)return r;if(typeof r!="string")return;const a=Zd(r);return a?new Wi(a[0]/255*a[3],a[1]/255*a[3],a[2]/255*a[3],a[3]):void 0}toString(){const[r,a,c,p]=this.toArray();return`rgba(${Math.round(r)},${Math.round(a)},${Math.round(c)},${p})`}toArray(){const{r,g:a,b:c,a:p}=this;return p===0?[0,0,0,0]:[255*r/p,255*a/p,255*c/p,p]}toArray01(){const{r,g:a,b:c,a:p}=this;return p===0?[0,0,0,0]:[r/p,a/p,c/p,p]}toArray01PremultipliedAlpha(){const{r,g:a,b:c,a:p}=this;return[r,a,c,p]}}Wi.black=new Wi(0,0,0,1),Wi.white=new Wi(1,1,1,1),Wi.transparent=new Wi(0,0,0,0),Wi.red=new Wi(1,0,0,1),Wi.blue=new Wi(0,0,1,1);var xr=Wi;class Wd{constructor(r,a,c){this.sensitivity=r?a?"variant":"case":a?"accent":"base",this.locale=c,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(r,a){return this.collator.compare(r,a)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Hd{constructor(r,a,c,p,g){this.text=r.normalize?r.normalize():r,this.image=a,this.scale=c,this.fontStack=p,this.textColor=g}}class Hi{constructor(r){this.sections=r}static fromString(r){return new Hi([new Hd(r,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(r=>r.text.length!==0||r.image&&r.image.name.length!==0)}static factory(r){return r instanceof Hi?r:Hi.fromString(r)}toString(){return this.sections.length===0?"":this.sections.map(r=>r.text).join("")}serialize(){const r=["format"];for(const a of this.sections){if(a.image){r.push(["image",a.image.name]);continue}r.push(a.text);const c={};a.fontStack&&(c["text-font"]=["literal",a.fontStack.split(",")]),a.scale&&(c["font-scale"]=a.scale),a.textColor&&(c["text-color"]=["rgba"].concat(a.textColor.toArray())),r.push(c)}return r}}class Ro{constructor(r){this.name=r.name,this.available=r.available}toString(){return this.name}static fromString(r){return r?new Ro({name:r,available:!1}):null}serialize(){return["image",this.name]}}function J_(o,r,a,c){return typeof o=="number"&&o>=0&&o<=255&&typeof r=="number"&&r>=0&&r<=255&&typeof a=="number"&&a>=0&&a<=255?c===void 0||typeof c=="number"&&c>=0&&c<=1?null:`Invalid rgba value [${[o,r,a,c].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof c=="number"?[o,r,a,c]:[o,r,a]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function ch(o){if(o===null||typeof o=="string"||typeof o=="boolean"||typeof o=="number"||o instanceof xr||o instanceof Wd||o instanceof Hi||o instanceof Ro)return!0;if(Array.isArray(o)){for(const r of o)if(!ch(r))return!1;return!0}if(typeof o=="object"){for(const r in o)if(!ch(o[r]))return!1;return!0}return!1}function fr(o){if(o===null)return ju;if(typeof o=="string")return cn;if(typeof o=="boolean")return on;if(typeof o=="number")return vt;if(o instanceof xr)return mo;if(o instanceof Wd)return go;if(o instanceof Hi)return oh;if(o instanceof Ro)return Wl;if(Array.isArray(o)){const r=o.length;let a;for(const c of o){const p=fr(c);if(a){if(a===p)continue;a=sn;break}a=p}return Do(a||sn,r)}return is}function hh(o){const r=typeof o;return o===null?"":r==="string"||r==="number"||r==="boolean"?String(o):o instanceof xr||o instanceof Hi||o instanceof Ro?o.toString():JSON.stringify(o)}class Yd{constructor(r,a){this.type=r,this.value=a}static parse(r,a){if(r.length!==2)return a.error(`'literal' expression requires exactly one argument, but found ${r.length-1} instead.`);if(!ch(r[1]))return a.error("invalid value");const c=r[1];let p=fr(c);const g=a.expectedType;return p.kind!=="array"||p.N!==0||!g||g.kind!=="array"||typeof g.N=="number"&&g.N!==0||(p=g),new Yd(p,c)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof xr?["rgba"].concat(this.value.toArray()):this.value instanceof Hi?this.value.serialize():this.value}}var Hl=Yd,fi=class{constructor(o){this.name="ExpressionEvaluationError",this.message=o}toJSON(){return this.message}};const Kd={string:cn,number:vt,boolean:on,object:is};class Jd{constructor(r,a){this.type=r,this.args=a}static parse(r,a){if(r.length<2)return a.error("Expected at least one argument.");let c,p=1;const g=r[0];if(g==="array"){let x,E;if(r.length>2){const S=r[1];if(typeof S!="string"||!(S in Kd)||S==="object")return a.error('The item type argument of "array" must be one of string, number, boolean',1);x=Kd[S],p++}else x=sn;if(r.length>3){if(r[2]!==null&&(typeof r[2]!="number"||r[2]<0||r[2]!==Math.floor(r[2])))return a.error('The length argument to "array" must be a positive integer literal',2);E=r[2],p++}c=Do(x,E)}else c=Kd[g];const y=[];for(;p<r.length;p++){const x=a.parse(r[p],p,sn);if(!x)return null;y.push(x)}return new Jd(c,y)}evaluate(r){for(let a=0;a<this.args.length;a++){const c=this.args[a].evaluate(r);if(!_a(this.type,fr(c)))return c;if(a===this.args.length-1)throw new fi(`Expected value to be of type ${Jn(this.type)}, but found ${Jn(fr(c))} instead.`)}return null}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}serialize(){const r=this.type,a=[r.kind];if(r.kind==="array"){const c=r.itemType;if(c.kind==="string"||c.kind==="number"||c.kind==="boolean"){a.push(c.kind);const p=r.N;(typeof p=="number"||this.args.length>1)&&a.push(p)}}return a.concat(this.args.map(c=>c.serialize()))}}var ya=Jd;class ul{constructor(r){this.type=oh,this.sections=r}static parse(r,a){if(r.length<2)return a.error("Expected at least one argument.");const c=r[1];if(!Array.isArray(c)&&typeof c=="object")return a.error("First argument must be an image or text section.");const p=[];let g=!1;for(let y=1;y<=r.length-1;++y){const x=r[y];if(g&&typeof x=="object"&&!Array.isArray(x)){g=!1;let E=null;if(x["font-scale"]&&(E=a.parse(x["font-scale"],1,vt),!E))return null;let S=null;if(x["text-font"]&&(S=a.parse(x["text-font"],1,Do(cn)),!S))return null;let M=null;if(x["text-color"]&&(M=a.parse(x["text-color"],1,mo),!M))return null;const L=p[p.length-1];L.scale=E,L.font=S,L.textColor=M}else{const E=a.parse(r[y],1,sn);if(!E)return null;const S=E.type.kind;if(S!=="string"&&S!=="value"&&S!=="null"&&S!=="resolvedImage")return a.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");g=!0,p.push({content:E,scale:null,font:null,textColor:null})}}return new ul(p)}evaluate(r){return new Hi(this.sections.map(a=>{const c=a.content.evaluate(r);return fr(c)===Wl?new Hd("",c,null,null,null):new Hd(hh(c),null,a.scale?a.scale.evaluate(r):null,a.font?a.font.evaluate(r).join(","):null,a.textColor?a.textColor.evaluate(r):null)}))}eachChild(r){for(const a of this.sections)r(a.content),a.scale&&r(a.scale),a.font&&r(a.font),a.textColor&&r(a.textColor)}outputDefined(){return!1}serialize(){const r=["format"];for(const a of this.sections){r.push(a.content.serialize());const c={};a.scale&&(c["font-scale"]=a.scale.serialize()),a.font&&(c["text-font"]=a.font.serialize()),a.textColor&&(c["text-color"]=a.textColor.serialize()),r.push(c)}return r}}class Of{constructor(r){this.type=Wl,this.input=r}static parse(r,a){if(r.length!==2)return a.error("Expected two arguments.");const c=a.parse(r[1],1,cn);return c?new Of(c):a.error("No image name provided.")}evaluate(r){const a=this.input.evaluate(r),c=Ro.fromString(a);return c&&r.availableImages&&(c.available=r.availableImages.indexOf(a)>-1),c}eachChild(r){r(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const Bx={"to-boolean":on,"to-color":mo,"to-number":vt,"to-string":cn};class Qd{constructor(r,a){this.type=r,this.args=a}static parse(r,a){if(r.length<2)return a.error("Expected at least one argument.");const c=r[0];if((c==="to-boolean"||c==="to-string")&&r.length!==2)return a.error("Expected one argument.");const p=Bx[c],g=[];for(let y=1;y<r.length;y++){const x=a.parse(r[y],y,sn);if(!x)return null;g.push(x)}return new Qd(p,g)}evaluate(r){if(this.type.kind==="boolean")return!!this.args[0].evaluate(r);if(this.type.kind==="color"){let a,c;for(const p of this.args){if(a=p.evaluate(r),c=null,a instanceof xr)return a;if(typeof a=="string"){const g=r.parseColor(a);if(g)return g}else if(Array.isArray(a)&&(c=a.length<3||a.length>4?`Invalid rbga value ${JSON.stringify(a)}: expected an array containing either three or four numeric values.`:J_(a[0],a[1],a[2],a[3]),!c))return new xr(a[0]/255,a[1]/255,a[2]/255,a[3])}throw new fi(c||`Could not parse color from value '${typeof a=="string"?a:String(JSON.stringify(a))}'`)}if(this.type.kind==="number"){let a=null;for(const c of this.args){if(a=c.evaluate(r),a===null)return 0;const p=Number(a);if(!isNaN(p))return p}throw new fi(`Could not convert ${JSON.stringify(a)} to number.`)}return this.type.kind==="formatted"?Hi.fromString(hh(this.args[0].evaluate(r))):this.type.kind==="resolvedImage"?Ro.fromString(hh(this.args[0].evaluate(r))):hh(this.args[0].evaluate(r))}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}serialize(){if(this.type.kind==="formatted")return new ul([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Of(this.args[0]).serialize();const r=[`to-${this.type.kind}`];return this.eachChild(a=>{r.push(a.serialize())}),r}}var qu=Qd;const Ns=["Unknown","Point","LineString","Polygon"];var em=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Ns[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const o=this.featureDistanceData.center,r=this.featureDistanceData.scale,{x:a,y:c}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(a*r-o[0])+this.featureDistanceData.bearing[1]*(c*r-o[1])}return 0}parseColor(o){let r=this._parseColorCache[o];return r||(r=this._parseColorCache[o]=xr.parse(o)),r}};class Yl{constructor(r,a,c,p){this.name=r,this.type=a,this._evaluate=c,this.args=p}evaluate(r){return this._evaluate(r,this.args)}eachChild(r){this.args.forEach(r)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(r=>r.serialize()))}static parse(r,a){const c=r[0],p=Yl.definitions[c];if(!p)return a.error(`Unknown expression "${c}". If you wanted a literal array, use ["literal", [...]].`,0);const g=Array.isArray(p)?p[0]:p.type,y=Array.isArray(p)?[[p[1],p[2]]]:p.overloads,x=y.filter(([S])=>!Array.isArray(S)||S.length===r.length-1);let E=null;for(const[S,M]of x){E=new sm(a.registry,a.path,null,a.scope);const L=[];let N=!1;for(let z=1;z<r.length;z++){const F=r[z],j=Array.isArray(S)?S[z-1]:S.type,H=E.parse(F,1+L.length,j);if(!H){N=!0;break}L.push(H)}if(!N)if(Array.isArray(S)&&S.length!==L.length)E.error(`Expected ${S.length} arguments, but found ${L.length} instead.`);else{for(let z=0;z<L.length;z++){const F=Array.isArray(S)?S[z]:S.type,j=L[z];E.concat(z+1).checkSubtype(F,j.type)}if(E.errors.length===0)return new Yl(c,g,M,L)}}if(x.length===1)a.errors.push(...E.errors);else{const S=(x.length?x:y).map(([L])=>{return N=L,Array.isArray(N)?`(${N.map(Jn).join(", ")})`:`(${Jn(N.type)}...)`;var N}).join(" | "),M=[];for(let L=1;L<r.length;L++){const N=a.parse(r[L],1+M.length);if(!N)return null;M.push(Jn(N.type))}a.error(`Expected arguments of type ${S}, but found (${M.join(", ")}) instead.`)}return null}static register(r,a){Yl.definitions=a;for(const c in a)r[c]=Yl}}var va=Yl;class fh{constructor(r,a,c){this.type=go,this.locale=c,this.caseSensitive=r,this.diacriticSensitive=a}static parse(r,a){if(r.length!==2)return a.error("Expected one argument.");const c=r[1];if(typeof c!="object"||Array.isArray(c))return a.error("Collator options argument must be an object.");const p=a.parse(c["case-sensitive"]!==void 0&&c["case-sensitive"],1,on);if(!p)return null;const g=a.parse(c["diacritic-sensitive"]!==void 0&&c["diacritic-sensitive"],1,on);if(!g)return null;let y=null;return c.locale&&(y=a.parse(c.locale,1,cn),!y)?null:new fh(p,g,y)}evaluate(r){return new Wd(this.caseSensitive.evaluate(r),this.diacriticSensitive.evaluate(r),this.locale?this.locale.evaluate(r):null)}eachChild(r){r(this.caseSensitive),r(this.diacriticSensitive),this.locale&&r(this.locale)}outputDefined(){return!1}serialize(){const r={};return r["case-sensitive"]=this.caseSensitive.serialize(),r["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(r.locale=this.locale.serialize()),["collator",r]}}const xa=8192;function zf(o,r){o[0]=Math.min(o[0],r[0]),o[1]=Math.min(o[1],r[1]),o[2]=Math.max(o[2],r[0]),o[3]=Math.max(o[3],r[1])}function Xu(o,r){return!(o[0]<=r[0]||o[2]>=r[2]||o[1]<=r[1]||o[3]>=r[3])}function ph(o,r){const a=(180+o[0])/360,c=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+o[1]*Math.PI/360)))/360,p=Math.pow(2,r.z);return[Math.round(a*p*xa),Math.round(c*p*xa)]}function Q_(o,r,a){const c=o[0]-r[0],p=o[1]-r[1],g=o[0]-a[0],y=o[1]-a[1];return c*y-g*p==0&&c*g<=0&&p*y<=0}function Ff(o,r){let a=!1;for(let y=0,x=r.length;y<x;y++){const E=r[y];for(let S=0,M=E.length;S<M-1;S++){if(Q_(o,E[S],E[S+1]))return!1;(p=E[S])[1]>(c=o)[1]!=(g=E[S+1])[1]>c[1]&&c[0]<(g[0]-p[0])*(c[1]-p[1])/(g[1]-p[1])+p[0]&&(a=!a)}}var c,p,g;return a}function tm(o,r){for(let a=0;a<r.length;a++)if(Ff(o,r[a]))return!0;return!1}function nm(o,r,a,c){const p=c[0]-a[0],g=c[1]-a[1],y=(o[0]-a[0])*g-p*(o[1]-a[1]),x=(r[0]-a[0])*g-p*(r[1]-a[1]);return y>0&&x<0||y<0&&x>0}function $u(o,r,a){for(const S of a)for(let M=0;M<S.length-1;++M)if((x=[(y=S[M+1])[0]-(g=S[M])[0],y[1]-g[1]])[0]*(E=[(p=r)[0]-(c=o)[0],p[1]-c[1]])[1]-x[1]*E[0]!=0&&nm(c,p,g,y)&&nm(g,y,c,p))return!0;var c,p,g,y,x,E;return!1}function Tn(o,r){for(let a=0;a<o.length;++a)if(!Ff(o[a],r))return!1;for(let a=0;a<o.length-1;++a)if($u(o[a],o[a+1],r))return!1;return!0}function Ux(o,r){for(let a=0;a<r.length;a++)if(Tn(o,r[a]))return!0;return!1}function rm(o,r,a){const c=[];for(let p=0;p<o.length;p++){const g=[];for(let y=0;y<o[p].length;y++){const x=ph(o[p][y],a);zf(r,x),g.push(x)}c.push(g)}return c}function ey(o,r,a){const c=[];for(let p=0;p<o.length;p++){const g=rm(o[p],r,a);c.push(g)}return c}function im(o,r,a,c){if(o[0]<a[0]||o[0]>a[2]){const p=.5*c;let g=o[0]-a[0]>p?-c:a[0]-o[0]>p?c:0;g===0&&(g=o[0]-a[2]>p?-c:a[2]-o[0]>p?c:0),o[0]+=g}zf(r,o)}function ty(o,r,a,c){const p=Math.pow(2,c.z)*xa,g=[c.x*xa,c.y*xa],y=[];if(!o)return y;for(const x of o)for(const E of x){const S=[E.x+g[0],E.y+g[1]];im(S,r,a,p),y.push(S)}return y}function om(o,r,a,c){const p=Math.pow(2,c.z)*xa,g=[c.x*xa,c.y*xa],y=[];if(!o)return y;for(const E of o){const S=[];for(const M of E){const L=[M.x+g[0],M.y+g[1]];zf(r,L),S.push(L)}y.push(S)}if(r[2]-r[0]<=p/2){(x=r)[0]=x[1]=1/0,x[2]=x[3]=-1/0;for(const E of y)for(const S of E)im(S,r,a,p)}var x;return y}class Zu{constructor(r,a){this.type=on,this.geojson=r,this.geometries=a}static parse(r,a){if(r.length!==2)return a.error(`'within' expression requires exactly one argument, but found ${r.length-1} instead.`);if(ch(r[1])){const c=r[1];if(c.type==="FeatureCollection")for(let p=0;p<c.features.length;++p){const g=c.features[p].geometry.type;if(g==="Polygon"||g==="MultiPolygon")return new Zu(c,c.features[p].geometry)}else if(c.type==="Feature"){const p=c.geometry.type;if(p==="Polygon"||p==="MultiPolygon")return new Zu(c,c.geometry)}else if(c.type==="Polygon"||c.type==="MultiPolygon")return new Zu(c,c)}return a.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(r){if(r.geometry()!=null&&r.canonicalID()!=null){if(r.geometryType()==="Point")return function(a,c){const p=[1/0,1/0,-1/0,-1/0],g=[1/0,1/0,-1/0,-1/0],y=a.canonicalID();if(!y)return!1;if(c.type==="Polygon"){const x=rm(c.coordinates,g,y),E=ty(a.geometry(),p,g,y);if(!Xu(p,g))return!1;for(const S of E)if(!Ff(S,x))return!1}if(c.type==="MultiPolygon"){const x=ey(c.coordinates,g,y),E=ty(a.geometry(),p,g,y);if(!Xu(p,g))return!1;for(const S of E)if(!tm(S,x))return!1}return!0}(r,this.geometries);if(r.geometryType()==="LineString")return function(a,c){const p=[1/0,1/0,-1/0,-1/0],g=[1/0,1/0,-1/0,-1/0],y=a.canonicalID();if(!y)return!1;if(c.type==="Polygon"){const x=rm(c.coordinates,g,y),E=om(a.geometry(),p,g,y);if(!Xu(p,g))return!1;for(const S of E)if(!Tn(S,x))return!1}if(c.type==="MultiPolygon"){const x=ey(c.coordinates,g,y),E=om(a.geometry(),p,g,y);if(!Xu(p,g))return!1;for(const S of E)if(!Ux(S,x))return!1}return!0}(r,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var Bf=Zu;function Wu(o){if(o instanceof va&&(o.name==="get"&&o.args.length===1||o.name==="feature-state"||o.name==="has"&&o.args.length===1||o.name==="properties"||o.name==="geometry-type"||o.name==="id"||/^filter-/.test(o.name))||o instanceof Bf)return!1;let r=!0;return o.eachChild(a=>{r&&!Wu(a)&&(r=!1)}),r}function wa(o){if(o instanceof va&&o.name==="feature-state")return!1;let r=!0;return o.eachChild(a=>{r&&!wa(a)&&(r=!1)}),r}function Kl(o,r){if(o instanceof va&&r.indexOf(o.name)>=0)return!1;let a=!0;return o.eachChild(c=>{a&&!Kl(c,r)&&(a=!1)}),a}class Uf{constructor(r,a){this.type=a.type,this.name=r,this.boundExpression=a}static parse(r,a){if(r.length!==2||typeof r[1]!="string")return a.error("'var' expression requires exactly one string literal argument.");const c=r[1];return a.scope.has(c)?new Uf(c,a.scope.get(c)):a.error(`Unknown variable "${c}". Make sure "${c}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(r){return this.boundExpression.evaluate(r)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var ny=Uf;class dh{constructor(r,a=[],c,p=new H_,g=[]){this.registry=r,this.path=a,this.key=a.map(y=>`[${y}]`).join(""),this.scope=p,this.errors=g,this.expectedType=c}parse(r,a,c,p,g={}){return a?this.concat(a,c,p)._parse(r,g):this._parse(r,g)}_parse(r,a){function c(p,g,y){return y==="assert"?new ya(g,[p]):y==="coerce"?new qu(g,[p]):p}if(r!==null&&typeof r!="string"&&typeof r!="boolean"&&typeof r!="number"||(r=["literal",r]),Array.isArray(r)){if(r.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const p=r[0];if(typeof p!="string")return this.error(`Expression name must be a string, but found ${typeof p} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const g=this.registry[p];if(g){let y=g.parse(r,this);if(!y)return null;if(this.expectedType){const x=this.expectedType,E=y.type;if(x.kind!=="string"&&x.kind!=="number"&&x.kind!=="boolean"&&x.kind!=="object"&&x.kind!=="array"||E.kind!=="value")if(x.kind!=="color"&&x.kind!=="formatted"&&x.kind!=="resolvedImage"||E.kind!=="value"&&E.kind!=="string"){if(this.checkSubtype(x,E))return null}else y=c(y,x,a.typeAnnotation||"coerce");else y=c(y,x,a.typeAnnotation||"assert")}if(!(y instanceof Hl)&&y.type.kind!=="resolvedImage"&&am(y)){const x=new em;try{y=new Hl(y.type,y.evaluate(x))}catch(E){return this.error(E.message),null}}return y}return this.error(`Unknown expression "${p}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(r===void 0?"'undefined' value invalid. Use null instead.":typeof r=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof r} instead.`)}concat(r,a,c){const p=typeof r=="number"?this.path.concat(r):this.path,g=c?this.scope.concat(c):this.scope;return new dh(this.registry,p,a||null,g,this.errors)}error(r,...a){const c=`${this.key}${a.map(p=>`[${p}]`).join("")}`;this.errors.push(new Rs(c,r))}checkSubtype(r,a){const c=_a(r,a);return c&&this.error(c),c}}var sm=dh;function am(o){if(o instanceof ny)return am(o.boundExpression);if(o instanceof va&&o.name==="error"||o instanceof fh||o instanceof Bf)return!1;const r=o instanceof qu||o instanceof ya;let a=!0;return o.eachChild(c=>{a=r?a&&am(c):a&&c instanceof Hl}),!!a&&Wu(o)&&Kl(o,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function Vf(o,r){const a=o.length-1;let c,p,g=0,y=a,x=0;for(;g<=y;)if(x=Math.floor((g+y)/2),c=o[x],p=o[x+1],c<=r){if(x===a||r<p)return x;g=x+1}else{if(!(c>r))throw new fi("Input is not a number.");y=x-1}return 0}class jf{constructor(r,a,c){this.type=r,this.input=a,this.labels=[],this.outputs=[];for(const[p,g]of c)this.labels.push(p),this.outputs.push(g)}static parse(r,a){if(r.length-1<4)return a.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if((r.length-1)%2!=0)return a.error("Expected an even number of arguments.");const c=a.parse(r[1],1,vt);if(!c)return null;const p=[];let g=null;a.expectedType&&a.expectedType.kind!=="value"&&(g=a.expectedType);for(let y=1;y<r.length;y+=2){const x=y===1?-1/0:r[y],E=r[y+1],S=y,M=y+1;if(typeof x!="number")return a.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',S);if(p.length&&p[p.length-1][0]>=x)return a.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',S);const L=a.parse(E,M,g);if(!L)return null;g=g||L.type,p.push([x,L])}return new jf(g,c,p)}evaluate(r){const a=this.labels,c=this.outputs;if(a.length===1)return c[0].evaluate(r);const p=this.input.evaluate(r);if(p<=a[0])return c[0].evaluate(r);const g=a.length;return p>=a[g-1]?c[g-1].evaluate(r):c[Vf(a,p)].evaluate(r)}eachChild(r){r(this.input);for(const a of this.outputs)r(a)}outputDefined(){return this.outputs.every(r=>r.outputDefined())}serialize(){const r=["step",this.input.serialize()];for(let a=0;a<this.labels.length;a++)a>0&&r.push(this.labels[a]),r.push(this.outputs[a].serialize());return r}}var lm=jf;function mn(o,r,a){return o*(1-a)+r*a}var mh=Object.freeze({__proto__:null,array:function(o,r,a){return o.map((c,p)=>mn(c,r[p],a))},color:function(o,r,a){return new xr(mn(o.r,r.r,a),mn(o.g,r.g,a),mn(o.b,r.b,a),mn(o.a,r.a,a))},number:mn});const ry=.95047,um=1.08883,iy=4/29,Jl=6/29,cm=3*Jl*Jl,Vx=Jl*Jl*Jl,jx=Math.PI/180,Gx=180/Math.PI;function hm(o){return o>Vx?Math.pow(o,1/3):o/cm+iy}function fm(o){return o>Jl?o*o*o:cm*(o-iy)}function pm(o){return 255*(o<=.0031308?12.92*o:1.055*Math.pow(o,1/2.4)-.055)}function Gf(o){return(o/=255)<=.04045?o/12.92:Math.pow((o+.055)/1.055,2.4)}function oy(o){const r=Gf(o.r),a=Gf(o.g),c=Gf(o.b),p=hm((.4124564*r+.3575761*a+.1804375*c)/ry),g=hm((.2126729*r+.7151522*a+.072175*c)/1);return{l:116*g-16,a:500*(p-g),b:200*(g-hm((.0193339*r+.119192*a+.9503041*c)/um)),alpha:o.a}}function sy(o){let r=(o.l+16)/116,a=isNaN(o.a)?r:r+o.a/500,c=isNaN(o.b)?r:r-o.b/200;return r=1*fm(r),a=ry*fm(a),c=um*fm(c),new xr(pm(3.2404542*a-1.5371385*r-.4985314*c),pm(-.969266*a+1.8760108*r+.041556*c),pm(.0556434*a-.2040259*r+1.0572252*c),o.alpha)}function qx(o,r,a){const c=r-o;return o+a*(c>180||c<-180?c-360*Math.round(c/360):c)}const gh={forward:oy,reverse:sy,interpolate:function(o,r,a){return{l:mn(o.l,r.l,a),a:mn(o.a,r.a,a),b:mn(o.b,r.b,a),alpha:mn(o.alpha,r.alpha,a)}}},Hu={forward:function(o){const{l:r,a,b:c}=oy(o),p=Math.atan2(c,a)*Gx;return{h:p<0?p+360:p,c:Math.sqrt(a*a+c*c),l:r,alpha:o.a}},reverse:function(o){const r=o.h*jx,a=o.c;return sy({l:o.l,a:Math.cos(r)*a,b:Math.sin(r)*a,alpha:o.alpha})},interpolate:function(o,r,a){return{h:qx(o.h,r.h,a),c:mn(o.c,r.c,a),l:mn(o.l,r.l,a),alpha:mn(o.alpha,r.alpha,a)}}};var dm=Object.freeze({__proto__:null,hcl:Hu,lab:gh});class _h{constructor(r,a,c,p,g){this.type=r,this.operator=a,this.interpolation=c,this.input=p,this.labels=[],this.outputs=[];for(const[y,x]of g)this.labels.push(y),this.outputs.push(x)}static interpolationFactor(r,a,c,p){let g=0;if(r.name==="exponential")g=mm(a,r.base,c,p);else if(r.name==="linear")g=mm(a,1,c,p);else if(r.name==="cubic-bezier"){const y=r.controlPoints;g=new we(y[0],y[1],y[2],y[3]).solve(mm(a,1,c,p))}return g}static parse(r,a){let[c,p,g,...y]=r;if(!Array.isArray(p)||p.length===0)return a.error("Expected an interpolation type expression.",1);if(p[0]==="linear")p={name:"linear"};else if(p[0]==="exponential"){const S=p[1];if(typeof S!="number")return a.error("Exponential interpolation requires a numeric base.",1,1);p={name:"exponential",base:S}}else{if(p[0]!=="cubic-bezier")return a.error(`Unknown interpolation type ${String(p[0])}`,1,0);{const S=p.slice(1);if(S.length!==4||S.some(M=>typeof M!="number"||M<0||M>1))return a.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);p={name:"cubic-bezier",controlPoints:S}}}if(r.length-1<4)return a.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if((r.length-1)%2!=0)return a.error("Expected an even number of arguments.");if(g=a.parse(g,2,vt),!g)return null;const x=[];let E=null;c==="interpolate-hcl"||c==="interpolate-lab"?E=mo:a.expectedType&&a.expectedType.kind!=="value"&&(E=a.expectedType);for(let S=0;S<y.length;S+=2){const M=y[S],L=y[S+1],N=S+3,z=S+4;if(typeof M!="number")return a.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',N);if(x.length&&x[x.length-1][0]>=M)return a.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',N);const F=a.parse(L,z,E);if(!F)return null;E=E||F.type,x.push([M,F])}return E.kind==="number"||E.kind==="color"||E.kind==="array"&&E.itemType.kind==="number"&&typeof E.N=="number"?new _h(E,c,p,g,x):a.error(`Type ${Jn(E)} is not interpolatable.`)}evaluate(r){const a=this.labels,c=this.outputs;if(a.length===1)return c[0].evaluate(r);const p=this.input.evaluate(r);if(p<=a[0])return c[0].evaluate(r);const g=a.length;if(p>=a[g-1])return c[g-1].evaluate(r);const y=Vf(a,p),x=_h.interpolationFactor(this.interpolation,p,a[y],a[y+1]),E=c[y].evaluate(r),S=c[y+1].evaluate(r);return this.operator==="interpolate"?mh[this.type.kind.toLowerCase()](E,S,x):this.operator==="interpolate-hcl"?Hu.reverse(Hu.interpolate(Hu.forward(E),Hu.forward(S),x)):gh.reverse(gh.interpolate(gh.forward(E),gh.forward(S),x))}eachChild(r){r(this.input);for(const a of this.outputs)r(a)}outputDefined(){return this.outputs.every(r=>r.outputDefined())}serialize(){let r;r=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const a=[this.operator,r,this.input.serialize()];for(let c=0;c<this.labels.length;c++)a.push(this.labels[c],this.outputs[c].serialize());return a}}function mm(o,r,a,c){const p=c-a,g=o-a;return p===0?0:r===1?g/p:(Math.pow(r,g)-1)/(Math.pow(r,p)-1)}var ks=_h;class qf{constructor(r,a){this.type=r,this.args=a}static parse(r,a){if(r.length<2)return a.error("Expectected at least one argument.");let c=null;const p=a.expectedType;p&&p.kind!=="value"&&(c=p);const g=[];for(const x of r.slice(1)){const E=a.parse(x,1+g.length,c,void 0,{typeAnnotation:"omit"});if(!E)return null;c=c||E.type,g.push(E)}const y=p&&g.some(x=>_a(p,x.type));return new qf(y?sn:c,g)}evaluate(r){let a,c=null,p=0;for(const g of this.args){if(p++,c=g.evaluate(r),c&&c instanceof Ro&&!c.available&&(a||(a=c),c=null,p===this.args.length))return a;if(c!==null)break}return c}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}serialize(){const r=["coalesce"];return this.eachChild(a=>{r.push(a.serialize())}),r}}var gm=qf;class Xf{constructor(r,a){this.type=a.type,this.bindings=[].concat(r),this.result=a}evaluate(r){return this.result.evaluate(r)}eachChild(r){for(const a of this.bindings)r(a[1]);r(this.result)}static parse(r,a){if(r.length<4)return a.error(`Expected at least 3 arguments, but found ${r.length-1} instead.`);const c=[];for(let g=1;g<r.length-1;g+=2){const y=r[g];if(typeof y!="string")return a.error(`Expected string, but found ${typeof y} instead.`,g);if(/[^a-zA-Z0-9_]/.test(y))return a.error("Variable names must contain only alphanumeric characters or '_'.",g);const x=a.parse(r[g+1],g+1);if(!x)return null;c.push([y,x])}const p=a.parse(r[r.length-1],r.length-1,a.expectedType,c);return p?new Xf(c,p):null}outputDefined(){return this.result.outputDefined()}serialize(){const r=["let"];for(const[a,c]of this.bindings)r.push(a,c.serialize());return r.push(this.result.serialize()),r}}var ay=Xf;class _m{constructor(r,a,c){this.type=r,this.index=a,this.input=c}static parse(r,a){if(r.length!==3)return a.error(`Expected 2 arguments, but found ${r.length-1} instead.`);const c=a.parse(r[1],1,vt),p=a.parse(r[2],2,Do(a.expectedType||sn));return c&&p?new _m(p.type.itemType,c,p):null}evaluate(r){const a=this.index.evaluate(r),c=this.input.evaluate(r);if(a<0)throw new fi(`Array index out of bounds: ${a} < 0.`);if(a>=c.length)throw new fi(`Array index out of bounds: ${a} > ${c.length-1}.`);if(a!==Math.floor(a))throw new fi(`Array index must be an integer, but found ${a} instead.`);return c[a]}eachChild(r){r(this.index),r(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var Xx=_m;class ym{constructor(r,a){this.type=on,this.needle=r,this.haystack=a}static parse(r,a){if(r.length!==3)return a.error(`Expected 2 arguments, but found ${r.length-1} instead.`);const c=a.parse(r[1],1,sn),p=a.parse(r[2],2,sn);return c&&p?sh(c.type,[on,cn,vt,ju,sn])?new ym(c,p):a.error(`Expected first argument to be of type boolean, string, number or null, but found ${Jn(c.type)} instead`):null}evaluate(r){const a=this.needle.evaluate(r),c=this.haystack.evaluate(r);if(c==null)return!1;if(!ah(a,["boolean","string","number","null"]))throw new fi(`Expected first argument to be of type boolean, string, number or null, but found ${Jn(fr(a))} instead.`);if(!ah(c,["string","array"]))throw new fi(`Expected second argument to be of type array or string, but found ${Jn(fr(c))} instead.`);return c.indexOf(a)>=0}eachChild(r){r(this.needle),r(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var $f=ym;class yh{constructor(r,a,c){this.type=vt,this.needle=r,this.haystack=a,this.fromIndex=c}static parse(r,a){if(r.length<=2||r.length>=5)return a.error(`Expected 3 or 4 arguments, but found ${r.length-1} instead.`);const c=a.parse(r[1],1,sn),p=a.parse(r[2],2,sn);if(!c||!p)return null;if(!sh(c.type,[on,cn,vt,ju,sn]))return a.error(`Expected first argument to be of type boolean, string, number or null, but found ${Jn(c.type)} instead`);if(r.length===4){const g=a.parse(r[3],3,vt);return g?new yh(c,p,g):null}return new yh(c,p)}evaluate(r){const a=this.needle.evaluate(r),c=this.haystack.evaluate(r);if(!ah(a,["boolean","string","number","null"]))throw new fi(`Expected first argument to be of type boolean, string, number or null, but found ${Jn(fr(a))} instead.`);if(!ah(c,["string","array"]))throw new fi(`Expected second argument to be of type array or string, but found ${Jn(fr(c))} instead.`);if(this.fromIndex){const p=this.fromIndex.evaluate(r);return c.indexOf(a,p)}return c.indexOf(a)}eachChild(r){r(this.needle),r(this.haystack),this.fromIndex&&r(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const r=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),r]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var ly=yh;class vm{constructor(r,a,c,p,g,y){this.inputType=r,this.type=a,this.input=c,this.cases=p,this.outputs=g,this.otherwise=y}static parse(r,a){if(r.length<5)return a.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if(r.length%2!=1)return a.error("Expected an even number of arguments.");let c,p;a.expectedType&&a.expectedType.kind!=="value"&&(p=a.expectedType);const g={},y=[];for(let S=2;S<r.length-1;S+=2){let M=r[S];const L=r[S+1];Array.isArray(M)||(M=[M]);const N=a.concat(S);if(M.length===0)return N.error("Expected at least one branch label.");for(const F of M){if(typeof F!="number"&&typeof F!="string")return N.error("Branch labels must be numbers or strings.");if(typeof F=="number"&&Math.abs(F)>Number.MAX_SAFE_INTEGER)return N.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof F=="number"&&Math.floor(F)!==F)return N.error("Numeric branch labels must be integer values.");if(c){if(N.checkSubtype(c,fr(F)))return null}else c=fr(F);if(g[String(F)]!==void 0)return N.error("Branch labels must be unique.");g[String(F)]=y.length}const z=a.parse(L,S,p);if(!z)return null;p=p||z.type,y.push(z)}const x=a.parse(r[1],1,sn);if(!x)return null;const E=a.parse(r[r.length-1],r.length-1,p);return E?x.type.kind!=="value"&&a.concat(1).checkSubtype(c,x.type)?null:new vm(c,p,x,g,y,E):null}evaluate(r){const a=this.input.evaluate(r);return(fr(a)===this.inputType&&this.outputs[this.cases[a]]||this.otherwise).evaluate(r)}eachChild(r){r(this.input),this.outputs.forEach(r),r(this.otherwise)}outputDefined(){return this.outputs.every(r=>r.outputDefined())&&this.otherwise.outputDefined()}serialize(){const r=["match",this.input.serialize()],a=Object.keys(this.cases).sort(),c=[],p={};for(const y of a){const x=p[this.cases[y]];x===void 0?(p[this.cases[y]]=c.length,c.push([this.cases[y],[y]])):c[x][1].push(y)}const g=y=>this.inputType.kind==="number"?Number(y):y;for(const[y,x]of c)r.push(x.length===1?g(x[0]):x.map(g)),r.push(this.outputs[y].serialize());return r.push(this.otherwise.serialize()),r}}var $x=vm;class xm{constructor(r,a,c){this.type=r,this.branches=a,this.otherwise=c}static parse(r,a){if(r.length<4)return a.error(`Expected at least 3 arguments, but found only ${r.length-1}.`);if(r.length%2!=0)return a.error("Expected an odd number of arguments.");let c;a.expectedType&&a.expectedType.kind!=="value"&&(c=a.expectedType);const p=[];for(let y=1;y<r.length-1;y+=2){const x=a.parse(r[y],y,on);if(!x)return null;const E=a.parse(r[y+1],y+1,c);if(!E)return null;p.push([x,E]),c=c||E.type}const g=a.parse(r[r.length-1],r.length-1,c);return g?new xm(c,p,g):null}evaluate(r){for(const[a,c]of this.branches)if(a.evaluate(r))return c.evaluate(r);return this.otherwise.evaluate(r)}eachChild(r){for(const[a,c]of this.branches)r(a),r(c);r(this.otherwise)}outputDefined(){return this.branches.every(([r,a])=>a.outputDefined())&&this.otherwise.outputDefined()}serialize(){const r=["case"];return this.eachChild(a=>{r.push(a.serialize())}),r}}var uy=xm;class vh{constructor(r,a,c,p){this.type=r,this.input=a,this.beginIndex=c,this.endIndex=p}static parse(r,a){if(r.length<=2||r.length>=5)return a.error(`Expected 3 or 4 arguments, but found ${r.length-1} instead.`);const c=a.parse(r[1],1,sn),p=a.parse(r[2],2,vt);if(!c||!p)return null;if(!sh(c.type,[Do(sn),cn,sn]))return a.error(`Expected first argument to be of type array or string, but found ${Jn(c.type)} instead`);if(r.length===4){const g=a.parse(r[3],3,vt);return g?new vh(c.type,c,p,g):null}return new vh(c.type,c,p)}evaluate(r){const a=this.input.evaluate(r),c=this.beginIndex.evaluate(r);if(!ah(a,["string","array"]))throw new fi(`Expected first argument to be of type array or string, but found ${Jn(fr(a))} instead.`);if(this.endIndex){const p=this.endIndex.evaluate(r);return a.slice(c,p)}return a.slice(c)}eachChild(r){r(this.input),r(this.beginIndex),this.endIndex&&r(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const r=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),r]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var cy=vh;function Zf(o,r){return o==="=="||o==="!="?r.kind==="boolean"||r.kind==="string"||r.kind==="number"||r.kind==="null"||r.kind==="value":r.kind==="string"||r.kind==="number"||r.kind==="value"}function hy(o,r,a,c){return c.compare(r,a)===0}function Yu(o,r,a){const c=o!=="=="&&o!=="!=";return class zL{constructor(g,y,x){this.type=on,this.lhs=g,this.rhs=y,this.collator=x,this.hasUntypedArgument=g.type.kind==="value"||y.type.kind==="value"}static parse(g,y){if(g.length!==3&&g.length!==4)return y.error("Expected two or three arguments.");const x=g[0];let E=y.parse(g[1],1,sn);if(!E)return null;if(!Zf(x,E.type))return y.concat(1).error(`"${x}" comparisons are not supported for type '${Jn(E.type)}'.`);let S=y.parse(g[2],2,sn);if(!S)return null;if(!Zf(x,S.type))return y.concat(2).error(`"${x}" comparisons are not supported for type '${Jn(S.type)}'.`);if(E.type.kind!==S.type.kind&&E.type.kind!=="value"&&S.type.kind!=="value")return y.error(`Cannot compare types '${Jn(E.type)}' and '${Jn(S.type)}'.`);c&&(E.type.kind==="value"&&S.type.kind!=="value"?E=new ya(S.type,[E]):E.type.kind!=="value"&&S.type.kind==="value"&&(S=new ya(E.type,[S])));let M=null;if(g.length===4){if(E.type.kind!=="string"&&S.type.kind!=="string"&&E.type.kind!=="value"&&S.type.kind!=="value")return y.error("Cannot use collator to compare non-string types.");if(M=y.parse(g[3],3,go),!M)return null}return new zL(E,S,M)}evaluate(g){const y=this.lhs.evaluate(g),x=this.rhs.evaluate(g);if(c&&this.hasUntypedArgument){const E=fr(y),S=fr(x);if(E.kind!==S.kind||E.kind!=="string"&&E.kind!=="number")throw new fi(`Expected arguments for "${o}" to be (string, string) or (number, number), but found (${E.kind}, ${S.kind}) instead.`)}if(this.collator&&!c&&this.hasUntypedArgument){const E=fr(y),S=fr(x);if(E.kind!=="string"||S.kind!=="string")return r(g,y,x)}return this.collator?a(g,y,x,this.collator.evaluate(g)):r(g,y,x)}eachChild(g){g(this.lhs),g(this.rhs),this.collator&&g(this.collator)}outputDefined(){return!0}serialize(){const g=[o];return this.eachChild(y=>{g.push(y.serialize())}),g}}}const Zx=Yu("==",function(o,r,a){return r===a},hy),Wx=Yu("!=",function(o,r,a){return r!==a},function(o,r,a,c){return!hy(0,r,a,c)}),Hx=Yu("<",function(o,r,a){return r<a},function(o,r,a,c){return c.compare(r,a)<0}),Yx=Yu(">",function(o,r,a){return r>a},function(o,r,a,c){return c.compare(r,a)>0}),Kx=Yu("<=",function(o,r,a){return r<=a},function(o,r,a,c){return c.compare(r,a)<=0}),fy=Yu(">=",function(o,r,a){return r>=a},function(o,r,a,c){return c.compare(r,a)>=0});class Wf{constructor(r,a,c,p,g,y){this.type=cn,this.number=r,this.locale=a,this.currency=c,this.unit=p,this.minFractionDigits=g,this.maxFractionDigits=y}static parse(r,a){if(r.length!==3)return a.error("Expected two arguments.");const c=a.parse(r[1],1,vt);if(!c)return null;const p=r[2];if(typeof p!="object"||Array.isArray(p))return a.error("NumberFormat options argument must be an object.");let g=null;if(p.locale&&(g=a.parse(p.locale,1,cn),!g))return null;let y=null;if(p.currency&&(y=a.parse(p.currency,1,cn),!y))return null;let x=null;if(p.unit&&(x=a.parse(p.unit,1,cn),!x))return null;let E=null;if(p["min-fraction-digits"]&&(E=a.parse(p["min-fraction-digits"],1,vt),!E))return null;let S=null;return p["max-fraction-digits"]&&(S=a.parse(p["max-fraction-digits"],1,vt),!S)?null:new Wf(c,g,y,x,E,S)}evaluate(r){return new Intl.NumberFormat(this.locale?this.locale.evaluate(r):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(r):void 0,unit:this.unit?this.unit.evaluate(r):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(r):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(r):void 0}).format(this.number.evaluate(r))}eachChild(r){r(this.number),this.locale&&r(this.locale),this.currency&&r(this.currency),this.unit&&r(this.unit),this.minFractionDigits&&r(this.minFractionDigits),this.maxFractionDigits&&r(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const r={};return this.locale&&(r.locale=this.locale.serialize()),this.currency&&(r.currency=this.currency.serialize()),this.unit&&(r.unit=this.unit.serialize()),this.minFractionDigits&&(r["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(r["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),r]}}class Ku{constructor(r){this.type=vt,this.input=r}static parse(r,a){if(r.length!==2)return a.error(`Expected 1 argument, but found ${r.length-1} instead.`);const c=a.parse(r[1],1);return c?c.type.kind!=="array"&&c.type.kind!=="string"&&c.type.kind!=="value"?a.error(`Expected argument of type string or array, but found ${Jn(c.type)} instead.`):new Ku(c):null}evaluate(r){const a=this.input.evaluate(r);if(typeof a=="string"||Array.isArray(a))return a.length;throw new fi(`Expected value to be of type string or array, but found ${Jn(fr(a))} instead.`)}eachChild(r){r(this.input)}outputDefined(){return!1}serialize(){const r=["length"];return this.eachChild(a=>{r.push(a.serialize())}),r}}const py={"==":Zx,"!=":Wx,">":Yx,"<":Hx,">=":fy,"<=":Kx,array:ya,at:Xx,boolean:ya,case:uy,coalesce:gm,collator:fh,format:ul,image:Of,in:$f,"index-of":ly,interpolate:ks,"interpolate-hcl":ks,"interpolate-lab":ks,length:Ku,let:ay,literal:Hl,match:$x,number:ya,"number-format":Wf,object:ya,slice:cy,step:lm,string:ya,"to-boolean":qu,"to-color":qu,"to-number":qu,"to-string":qu,var:ny,within:Bf};function dy(o,[r,a,c,p]){r=r.evaluate(o),a=a.evaluate(o),c=c.evaluate(o);const g=p?p.evaluate(o):1,y=J_(r,a,c,g);if(y)throw new fi(y);return new xr(r/255*g,a/255*g,c/255*g,g)}function ba(o,r){return o in r}function Hf(o,r){const a=r[o];return a===void 0?null:a}function No(o){return{type:o}}va.register(py,{error:[{kind:"error"},[cn],(o,[r])=>{throw new fi(r.evaluate(o))}],typeof:[cn,[sn],(o,[r])=>Jn(fr(r.evaluate(o)))],"to-rgba":[Do(vt,4),[mo],(o,[r])=>r.evaluate(o).toArray()],rgb:[mo,[vt,vt,vt],dy],rgba:[mo,[vt,vt,vt,vt],dy],has:{type:on,overloads:[[[cn],(o,[r])=>ba(r.evaluate(o),o.properties())],[[cn,is],(o,[r,a])=>ba(r.evaluate(o),a.evaluate(o))]]},get:{type:sn,overloads:[[[cn],(o,[r])=>Hf(r.evaluate(o),o.properties())],[[cn,is],(o,[r,a])=>Hf(r.evaluate(o),a.evaluate(o))]]},"feature-state":[sn,[cn],(o,[r])=>Hf(r.evaluate(o),o.featureState||{})],properties:[is,[],o=>o.properties()],"geometry-type":[cn,[],o=>o.geometryType()],id:[sn,[],o=>o.id()],zoom:[vt,[],o=>o.globals.zoom],pitch:[vt,[],o=>o.globals.pitch||0],"distance-from-center":[vt,[],o=>o.distanceFromCenter()],"heatmap-density":[vt,[],o=>o.globals.heatmapDensity||0],"line-progress":[vt,[],o=>o.globals.lineProgress||0],"sky-radial-progress":[vt,[],o=>o.globals.skyRadialProgress||0],accumulated:[sn,[],o=>o.globals.accumulated===void 0?null:o.globals.accumulated],"+":[vt,No(vt),(o,r)=>{let a=0;for(const c of r)a+=c.evaluate(o);return a}],"*":[vt,No(vt),(o,r)=>{let a=1;for(const c of r)a*=c.evaluate(o);return a}],"-":{type:vt,overloads:[[[vt,vt],(o,[r,a])=>r.evaluate(o)-a.evaluate(o)],[[vt],(o,[r])=>-r.evaluate(o)]]},"/":[vt,[vt,vt],(o,[r,a])=>r.evaluate(o)/a.evaluate(o)],"%":[vt,[vt,vt],(o,[r,a])=>r.evaluate(o)%a.evaluate(o)],ln2:[vt,[],()=>Math.LN2],pi:[vt,[],()=>Math.PI],e:[vt,[],()=>Math.E],"^":[vt,[vt,vt],(o,[r,a])=>Math.pow(r.evaluate(o),a.evaluate(o))],sqrt:[vt,[vt],(o,[r])=>Math.sqrt(r.evaluate(o))],log10:[vt,[vt],(o,[r])=>Math.log(r.evaluate(o))/Math.LN10],ln:[vt,[vt],(o,[r])=>Math.log(r.evaluate(o))],log2:[vt,[vt],(o,[r])=>Math.log(r.evaluate(o))/Math.LN2],sin:[vt,[vt],(o,[r])=>Math.sin(r.evaluate(o))],cos:[vt,[vt],(o,[r])=>Math.cos(r.evaluate(o))],tan:[vt,[vt],(o,[r])=>Math.tan(r.evaluate(o))],asin:[vt,[vt],(o,[r])=>Math.asin(r.evaluate(o))],acos:[vt,[vt],(o,[r])=>Math.acos(r.evaluate(o))],atan:[vt,[vt],(o,[r])=>Math.atan(r.evaluate(o))],min:[vt,No(vt),(o,r)=>Math.min(...r.map(a=>a.evaluate(o)))],max:[vt,No(vt),(o,r)=>Math.max(...r.map(a=>a.evaluate(o)))],abs:[vt,[vt],(o,[r])=>Math.abs(r.evaluate(o))],round:[vt,[vt],(o,[r])=>{const a=r.evaluate(o);return a<0?-Math.round(-a):Math.round(a)}],floor:[vt,[vt],(o,[r])=>Math.floor(r.evaluate(o))],ceil:[vt,[vt],(o,[r])=>Math.ceil(r.evaluate(o))],"filter-==":[on,[cn,sn],(o,[r,a])=>o.properties()[r.value]===a.value],"filter-id-==":[on,[sn],(o,[r])=>o.id()===r.value],"filter-type-==":[on,[cn],(o,[r])=>o.geometryType()===r.value],"filter-<":[on,[cn,sn],(o,[r,a])=>{const c=o.properties()[r.value],p=a.value;return typeof c==typeof p&&c<p}],"filter-id-<":[on,[sn],(o,[r])=>{const a=o.id(),c=r.value;return typeof a==typeof c&&a<c}],"filter->":[on,[cn,sn],(o,[r,a])=>{const c=o.properties()[r.value],p=a.value;return typeof c==typeof p&&c>p}],"filter-id->":[on,[sn],(o,[r])=>{const a=o.id(),c=r.value;return typeof a==typeof c&&a>c}],"filter-<=":[on,[cn,sn],(o,[r,a])=>{const c=o.properties()[r.value],p=a.value;return typeof c==typeof p&&c<=p}],"filter-id-<=":[on,[sn],(o,[r])=>{const a=o.id(),c=r.value;return typeof a==typeof c&&a<=c}],"filter->=":[on,[cn,sn],(o,[r,a])=>{const c=o.properties()[r.value],p=a.value;return typeof c==typeof p&&c>=p}],"filter-id->=":[on,[sn],(o,[r])=>{const a=o.id(),c=r.value;return typeof a==typeof c&&a>=c}],"filter-has":[on,[sn],(o,[r])=>r.value in o.properties()],"filter-has-id":[on,[],o=>o.id()!==null&&o.id()!==void 0],"filter-type-in":[on,[Do(cn)],(o,[r])=>r.value.indexOf(o.geometryType())>=0],"filter-id-in":[on,[Do(sn)],(o,[r])=>r.value.indexOf(o.id())>=0],"filter-in-small":[on,[cn,Do(sn)],(o,[r,a])=>a.value.indexOf(o.properties()[r.value])>=0],"filter-in-large":[on,[cn,Do(sn)],(o,[r,a])=>function(c,p,g,y){for(;g<=y;){const x=g+y>>1;if(p[x]===c)return!0;p[x]>c?y=x-1:g=x+1}return!1}(o.properties()[r.value],a.value,0,a.value.length-1)],all:{type:on,overloads:[[[on,on],(o,[r,a])=>r.evaluate(o)&&a.evaluate(o)],[No(on),(o,r)=>{for(const a of r)if(!a.evaluate(o))return!1;return!0}]]},any:{type:on,overloads:[[[on,on],(o,[r,a])=>r.evaluate(o)||a.evaluate(o)],[No(on),(o,r)=>{for(const a of r)if(a.evaluate(o))return!0;return!1}]]},"!":[on,[on],(o,[r])=>!r.evaluate(o)],"is-supported-script":[on,[cn],(o,[r])=>{const a=o.globals&&o.globals.isSupportedScript;return!a||a(r.evaluate(o))}],upcase:[cn,[cn],(o,[r])=>r.evaluate(o).toUpperCase()],downcase:[cn,[cn],(o,[r])=>r.evaluate(o).toLowerCase()],concat:[cn,No(sn),(o,r)=>r.map(a=>hh(a.evaluate(o))).join("")],"resolved-locale":[cn,[go],(o,[r])=>r.evaluate(o).resolvedLocale()]});var xh=py;function my(o){return{result:"success",value:o}}function Ql(o){return{result:"error",value:o}}function Ju(o){return o["property-type"]==="data-driven"}function Yf(o){return!!o.expression&&o.expression.parameters.indexOf("zoom")>-1}function Kf(o){return!!o.expression&&o.expression.interpolated}function gn(o){return o instanceof Number?"number":o instanceof String?"string":o instanceof Boolean?"boolean":Array.isArray(o)?"array":o===null?"null":typeof o}function wh(o){return typeof o=="object"&&o!==null&&!Array.isArray(o)}function gy(o){return o}function Jf(o,r){const a=r.type==="color",c=o.stops&&typeof o.stops[0][0]=="object",p=c||!(c||o.property!==void 0),g=o.type||(Kf(r)?"exponential":"interval");if(a&&((o=ga({},o)).stops&&(o.stops=o.stops.map(S=>[S[0],xr.parse(S[1])])),o.default=xr.parse(o.default?o.default:r.default)),o.colorSpace&&o.colorSpace!=="rgb"&&!dm[o.colorSpace])throw new Error(`Unknown color space: ${o.colorSpace}`);let y,x,E;if(g==="exponential")y=Ea;else if(g==="interval")y=Qf;else if(g==="categorical"){y=_y,x=Object.create(null);for(const S of o.stops)x[S[0]]=S[1];E=typeof o.stops[0][0]}else{if(g!=="identity")throw new Error(`Unknown function type "${g}"`);y=yy}if(c){const S={},M=[];for(let z=0;z<o.stops.length;z++){const F=o.stops[z],j=F[0].zoom;S[j]===void 0&&(S[j]={zoom:j,type:o.type,property:o.property,default:o.default,stops:[]},M.push(j)),S[j].stops.push([F[0].value,F[1]])}const L=[];for(const z of M)L.push([S[z].zoom,Jf(S[z],r)]);const N={name:"linear"};return{kind:"composite",interpolationType:N,interpolationFactor:ks.interpolationFactor.bind(void 0,N),zoomStops:L.map(z=>z[0]),evaluate:({zoom:z},F)=>Ea({stops:L,base:o.base},r,z).evaluate(z,F)}}if(p){const S=g==="exponential"?{name:"exponential",base:o.base!==void 0?o.base:1}:null;return{kind:"camera",interpolationType:S,interpolationFactor:ks.interpolationFactor.bind(void 0,S),zoomStops:o.stops.map(M=>M[0]),evaluate:({zoom:M})=>y(o,r,M,x,E)}}return{kind:"source",evaluate(S,M){const L=M&&M.properties?M.properties[o.property]:void 0;return L===void 0?Qu(o.default,r.default):y(o,r,L,x,E)}}}function Qu(o,r,a){return o!==void 0?o:r!==void 0?r:a!==void 0?a:void 0}function _y(o,r,a,c,p){return Qu(typeof a===p?c[a]:void 0,o.default,r.default)}function Qf(o,r,a){if(gn(a)!=="number")return Qu(o.default,r.default);const c=o.stops.length;if(c===1||a<=o.stops[0][0])return o.stops[0][1];if(a>=o.stops[c-1][0])return o.stops[c-1][1];const p=Vf(o.stops.map(g=>g[0]),a);return o.stops[p][1]}function Ea(o,r,a){const c=o.base!==void 0?o.base:1;if(gn(a)!=="number")return Qu(o.default,r.default);const p=o.stops.length;if(p===1||a<=o.stops[0][0])return o.stops[0][1];if(a>=o.stops[p-1][0])return o.stops[p-1][1];const g=Vf(o.stops.map(M=>M[0]),a),y=function(M,L,N,z){const F=z-N,j=M-N;return F===0?0:L===1?j/F:(Math.pow(L,j)-1)/(Math.pow(L,F)-1)}(a,c,o.stops[g][0],o.stops[g+1][0]),x=o.stops[g][1],E=o.stops[g+1][1];let S=mh[r.type]||gy;if(o.colorSpace&&o.colorSpace!=="rgb"){const M=dm[o.colorSpace];S=(L,N)=>M.reverse(M.interpolate(M.forward(L),M.forward(N),y))}return typeof x.evaluate=="function"?{evaluate(...M){const L=x.evaluate.apply(void 0,M),N=E.evaluate.apply(void 0,M);if(L!==void 0&&N!==void 0)return S(L,N,y)}}:S(x,E,y)}function yy(o,r,a){return r.type==="color"?a=xr.parse(a):r.type==="formatted"?a=Hi.fromString(a.toString()):r.type==="resolvedImage"?a=Ro.fromString(a.toString()):gn(a)===r.type||r.type==="enum"&&r.values[a]||(a=void 0),Qu(a,o.default,r.default)}class ep{constructor(r,a){this.expression=r,this._warningHistory={},this._evaluator=new em,this._defaultValue=a?function(c){return c.type==="color"&&(wh(c.default)||Array.isArray(c.default))?new xr(0,0,0,0):c.type==="color"?xr.parse(c.default)||null:c.default===void 0?null:c.default}(a):null,this._enumValues=a&&a.type==="enum"?a.values:null}evaluateWithoutErrorHandling(r,a,c,p,g,y,x,E){return this._evaluator.globals=r,this._evaluator.feature=a,this._evaluator.featureState=c,this._evaluator.canonical=p||null,this._evaluator.availableImages=g||null,this._evaluator.formattedSection=y,this._evaluator.featureTileCoord=x||null,this._evaluator.featureDistanceData=E||null,this.expression.evaluate(this._evaluator)}evaluate(r,a,c,p,g,y,x,E){this._evaluator.globals=r,this._evaluator.feature=a||null,this._evaluator.featureState=c||null,this._evaluator.canonical=p||null,this._evaluator.availableImages=g||null,this._evaluator.formattedSection=y||null,this._evaluator.featureTileCoord=x||null,this._evaluator.featureDistanceData=E||null;try{const S=this.expression.evaluate(this._evaluator);if(S==null||typeof S=="number"&&S!=S)return this._defaultValue;if(this._enumValues&&!(S in this._enumValues))throw new fi(`Expected value to be one of ${Object.keys(this._enumValues).map(M=>JSON.stringify(M)).join(", ")}, but found ${JSON.stringify(S)} instead.`);return S}catch(S){return this._warningHistory[S.message]||(this._warningHistory[S.message]=!0,typeof console<"u"&&console.warn(S.message)),this._defaultValue}}}function ec(o){return Array.isArray(o)&&o.length>0&&typeof o[0]=="string"&&o[0]in xh}function tc(o,r){const a=new sm(xh,[],r?function(p){const g={color:mo,string:cn,number:vt,enum:cn,boolean:on,formatted:oh,resolvedImage:Wl};return p.type==="array"?Do(g[p.value]||sn,p.length):g[p.type]}(r):void 0),c=a.parse(o,void 0,void 0,void 0,r&&r.type==="string"?{typeAnnotation:"coerce"}:void 0);return c?my(new ep(c,r)):Ql(a.errors)}class wm{constructor(r,a){this.kind=r,this._styleExpression=a,this.isStateDependent=r!=="constant"&&!wa(a.expression)}evaluateWithoutErrorHandling(r,a,c,p,g,y){return this._styleExpression.evaluateWithoutErrorHandling(r,a,c,p,g,y)}evaluate(r,a,c,p,g,y){return this._styleExpression.evaluate(r,a,c,p,g,y)}}class bh{constructor(r,a,c,p){this.kind=r,this.zoomStops=c,this._styleExpression=a,this.isStateDependent=r!=="camera"&&!wa(a.expression),this.interpolationType=p}evaluateWithoutErrorHandling(r,a,c,p,g,y){return this._styleExpression.evaluateWithoutErrorHandling(r,a,c,p,g,y)}evaluate(r,a,c,p,g,y){return this._styleExpression.evaluate(r,a,c,p,g,y)}interpolationFactor(r,a,c){return this.interpolationType?ks.interpolationFactor(this.interpolationType,r,a,c):0}}function Eh(o,r){if((o=tc(o,r)).result==="error")return o;const a=o.value.expression,c=Wu(a);if(!c&&!Ju(r))return Ql([new Rs("","data expressions not supported")]);const p=Kl(a,["zoom","pitch","distance-from-center"]);if(!p&&!Yf(r))return Ql([new Rs("","zoom expressions not supported")]);const g=np(a);return g||p?g instanceof Rs?Ql([g]):g instanceof ks&&!Kf(r)?Ql([new Rs("",'"interpolate" expressions cannot be used with this property')]):my(g?new bh(c?"camera":"composite",o.value,g.labels,g instanceof ks?g.interpolation:void 0):new wm(c?"constant":"source",o.value)):Ql([new Rs("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class tp{constructor(r,a){this._parameters=r,this._specification=a,ga(this,Jf(this._parameters,this._specification))}static deserialize(r){return new tp(r._parameters,r._specification)}static serialize(r){return{_parameters:r._parameters,_specification:r._specification}}}function np(o){let r=null;if(o instanceof ay)r=np(o.result);else if(o instanceof gm){for(const a of o.args)if(r=np(a),r)break}else(o instanceof lm||o instanceof ks)&&o.input instanceof va&&o.input.name==="zoom"&&(r=o);return r instanceof Rs||o.eachChild(a=>{const c=np(a);c instanceof Rs?r=c:!r&&c?r=new Rs("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):r&&c&&r!==c&&(r=new Rs("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),r}class xt{constructor(r,a,c,p){this.message=(r?`${r}: `:"")+c,p&&(this.identifier=p),a!=null&&a.__line__&&(this.line=a.__line__)}}function os(o){const r=o.key,a=o.value,c=o.valueSpec||{},p=o.objectElementValidators||{},g=o.style,y=o.styleSpec;let x=[];const E=gn(a);if(E!=="object")return[new xt(r,a,`object expected, ${E} found`)];for(const S in a){const M=S.split(".")[0];let L;p[M]?L=p[M]:c[M]?L=bi:p["*"]?L=p["*"]:c["*"]&&(L=bi),L?x=x.concat(L({key:(r&&`${r}.`)+S,value:a[S],valueSpec:c[M]||c["*"],style:g,styleSpec:y,object:a,objectKey:S},a)):x.push(new xt(r,a[S],`unknown property "${S}"`))}for(const S in c)p[S]||c[S].required&&c[S].default===void 0&&a[S]===void 0&&x.push(new xt(r,a,`missing required property "${S}"`));return x}function vy(o){const r=o.value,a=o.valueSpec,c=o.style,p=o.styleSpec,g=o.key,y=o.arrayElementValidator||bi;if(gn(r)!=="array")return[new xt(g,r,`array expected, ${gn(r)} found`)];if(a.length&&r.length!==a.length)return[new xt(g,r,`array length ${a.length} expected, length ${r.length} found`)];if(a["min-length"]&&r.length<a["min-length"])return[new xt(g,r,`array length at least ${a["min-length"]} expected, length ${r.length} found`)];let x={type:a.value,values:a.values,minimum:a.minimum,maximum:a.maximum,function:void 0};p.$version<7&&(x.function=a.function),gn(a.value)==="object"&&(x=a.value);let E=[];for(let S=0;S<r.length;S++)E=E.concat(y({array:r,arrayIndex:S,value:r[S],valueSpec:x,style:c,styleSpec:p,key:`${g}[${S}]`}));return E}function Sh(o){const r=o.key,a=o.value,c=o.valueSpec;let p=gn(a);if(p==="number"&&a!=a&&(p="NaN"),p!=="number")return[new xt(r,a,`number expected, ${p} found`)];if("minimum"in c){let g=c.minimum;if(gn(c.minimum)==="array"&&(g=c.minimum[o.arrayIndex]),a<g)return[new xt(r,a,`${a} is less than the minimum value ${g}`)]}if("maximum"in c){let g=c.maximum;if(gn(c.maximum)==="array"&&(g=c.maximum[o.arrayIndex]),a>g)return[new xt(r,a,`${a} is greater than the maximum value ${g}`)]}return[]}function Th(o){const r=o.valueSpec,a=Ir(o.value.type);let c,p,g,y={};const x=a!=="categorical"&&o.value.property===void 0,E=!x,S=gn(o.value.stops)==="array"&&gn(o.value.stops[0])==="array"&&gn(o.value.stops[0][0])==="object",M=os({key:o.key,value:o.value,valueSpec:o.styleSpec.function,style:o.style,styleSpec:o.styleSpec,objectElementValidators:{stops:function(z){if(a==="identity")return[new xt(z.key,z.value,'identity function may not have a "stops" property')];let F=[];const j=z.value;return F=F.concat(vy({key:z.key,value:j,valueSpec:z.valueSpec,style:z.style,styleSpec:z.styleSpec,arrayElementValidator:L})),gn(j)==="array"&&j.length===0&&F.push(new xt(z.key,j,"array must have at least one stop")),F},default:function(z){return bi({key:z.key,value:z.value,valueSpec:r,style:z.style,styleSpec:z.styleSpec})}}});return a==="identity"&&x&&M.push(new xt(o.key,o.value,'missing required property "property"')),a==="identity"||o.value.stops||M.push(new xt(o.key,o.value,'missing required property "stops"')),a==="exponential"&&o.valueSpec.expression&&!Kf(o.valueSpec)&&M.push(new xt(o.key,o.value,"exponential functions not supported")),o.styleSpec.$version>=8&&(E&&!Ju(o.valueSpec)?M.push(new xt(o.key,o.value,"property functions not supported")):x&&!Yf(o.valueSpec)&&M.push(new xt(o.key,o.value,"zoom functions not supported"))),a!=="categorical"&&!S||o.value.property!==void 0||M.push(new xt(o.key,o.value,'"property" property is required')),M;function L(z){let F=[];const j=z.value,H=z.key;if(gn(j)!=="array")return[new xt(H,j,`array expected, ${gn(j)} found`)];if(j.length!==2)return[new xt(H,j,`array length 2 expected, length ${j.length} found`)];if(S){if(gn(j[0])!=="object")return[new xt(H,j,`object expected, ${gn(j[0])} found`)];if(j[0].zoom===void 0)return[new xt(H,j,"object stop key must have zoom")];if(j[0].value===void 0)return[new xt(H,j,"object stop key must have value")];const ne=Ir(j[0].zoom);if(typeof ne!="number")return[new xt(H,j[0].zoom,"stop zoom values must be numbers")];if(g&&g>ne)return[new xt(H,j[0].zoom,"stop zoom values must appear in ascending order")];ne!==g&&(g=ne,p=void 0,y={}),F=F.concat(os({key:`${H}[0]`,value:j[0],valueSpec:{zoom:{}},style:z.style,styleSpec:z.styleSpec,objectElementValidators:{zoom:Sh,value:N}}))}else F=F.concat(N({key:`${H}[0]`,value:j[0],valueSpec:{},style:z.style,styleSpec:z.styleSpec},j));return ec(Qr(j[1]))?F.concat([new xt(`${H}[1]`,j[1],"expressions are not allowed in function stops.")]):F.concat(bi({key:`${H}[1]`,value:j[1],valueSpec:r,style:z.style,styleSpec:z.styleSpec}))}function N(z,F){const j=gn(z.value),H=Ir(z.value),ne=z.value!==null?z.value:F;if(c){if(j!==c)return[new xt(z.key,ne,`${j} stop domain type must match previous stop domain type ${c}`)]}else c=j;if(j!=="number"&&j!=="string"&&j!=="boolean"&&typeof H!="number"&&typeof H!="string"&&typeof H!="boolean")return[new xt(z.key,ne,"stop domain value must be a number, string, or boolean")];if(j!=="number"&&a!=="categorical"){let he=`number expected, ${j} found`;return Ju(r)&&a===void 0&&(he+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new xt(z.key,ne,he)]}return a!=="categorical"||j!=="number"||typeof H=="number"&&isFinite(H)&&Math.floor(H)===H?a!=="categorical"&&j==="number"&&typeof H=="number"&&typeof p=="number"&&p!==void 0&&H<p?[new xt(z.key,ne,"stop domain values must appear in ascending order")]:(p=H,a==="categorical"&&H in y?[new xt(z.key,ne,"stop domain values must be unique")]:(y[H]=!0,[])):[new xt(z.key,ne,`integer expected, found ${String(H)}`)]}}function ei(o){const r=(o.expressionContext==="property"?Eh:tc)(Qr(o.value),o.valueSpec);if(r.result==="error")return r.value.map(c=>new xt(`${o.key}${c.key}`,o.value,c.message));const a=r.value.expression||r.value._styleExpression.expression;if(o.expressionContext==="property"&&o.propertyKey==="text-font"&&!a.outputDefined())return[new xt(o.key,o.value,`Invalid data expression for "${o.propertyKey}". Output values must be contained as literals within the expression.`)];if(o.expressionContext==="property"&&o.propertyType==="layout"&&!wa(a))return[new xt(o.key,o.value,'"feature-state" data expressions are not supported with layout properties.')];if(o.expressionContext==="filter")return Ch(a,o);if(o.expressionContext&&o.expressionContext.indexOf("cluster")===0){if(!Kl(a,["zoom","feature-state"]))return[new xt(o.key,o.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(o.expressionContext==="cluster-initial"&&!Wu(a))return[new xt(o.key,o.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Ch(o,r){const a=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(r.valueSpec&&r.valueSpec.expression)for(const p of r.valueSpec.expression.parameters)a.delete(p);if(a.size===0)return[];const c=[];return o instanceof va&&a.has(o.name)?[new xt(r.key,r.value,`["${o.name}"] expression is not supported in a filter for a ${r.object.type} layer with id: ${r.object.id}`)]:(o.eachChild(p=>{c.push(...Ch(p,r))}),c)}function rp(o){const r=o.key,a=o.value,c=o.valueSpec,p=[];return Array.isArray(c.values)?c.values.indexOf(Ir(a))===-1&&p.push(new xt(r,a,`expected one of [${c.values.join(", ")}], ${JSON.stringify(a)} found`)):Object.keys(c.values).indexOf(Ir(a))===-1&&p.push(new xt(r,a,`expected one of [${Object.keys(c.values).join(", ")}], ${JSON.stringify(a)} found`)),p}function bm(o){if(o===!0||o===!1)return!0;if(!Array.isArray(o)||o.length===0)return!1;switch(o[0]){case"has":return o.length>=2&&o[1]!=="$id"&&o[1]!=="$type";case"in":return o.length>=3&&(typeof o[1]!="string"||Array.isArray(o[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return o.length!==3||Array.isArray(o[1])||Array.isArray(o[2]);case"any":case"all":for(const r of o.slice(1))if(!bm(r)&&typeof r!="boolean")return!1;return!0;default:return!0}}function ip(o,r="fill"){if(o==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};bm(o)||(o=rc(o));const a=o;let c=!0;try{c=function(S){if(!nc(S))return S;let M=Qr(S);return op(M),M=xy(M),M}(a)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(a,null,2)}
        `)}const p=Ge[`filter_${r}`],g=tc(c,p);let y=null;if(g.result==="error")throw new Error(g.value.map(S=>`${S.key}: ${S.message}`).join(", "));y=(S,M,L)=>g.value.evaluate(S,M,{},L);let x=null,E=null;if(c!==a){const S=tc(a,p);if(S.result==="error")throw new Error(S.value.map(M=>`${M.key}: ${M.message}`).join(", "));x=(M,L,N,z,F)=>S.value.evaluate(M,L,{},N,void 0,void 0,z,F),E=!Wu(S.value.expression)}return{filter:y,dynamicFilter:x||void 0,needGeometry:wy(c),needFeature:!!E}}function xy(o){if(!Array.isArray(o))return o;const r=function(a){if(Em.has(a[0])){for(let c=1;c<a.length;c++)if(nc(a[c]))return!0}return a}(o);return r===!0?r:r.map(a=>xy(a))}function op(o){let r=!1;const a=[];if(o[0]==="case"){for(let c=1;c<o.length-1;c+=2)r=r||nc(o[c]),a.push(o[c+1]);a.push(o[o.length-1])}else if(o[0]==="match"){r=r||nc(o[1]);for(let c=2;c<o.length-1;c+=2)a.push(o[c+1]);a.push(o[o.length-1])}else if(o[0]==="step"){r=r||nc(o[1]);for(let c=1;c<o.length-1;c+=2)a.push(o[c+1])}r&&(o.length=0,o.push("any",...a));for(let c=1;c<o.length;c++)op(o[c])}function nc(o){if(!Array.isArray(o))return!1;if((r=o[0])==="pitch"||r==="distance-from-center")return!0;var r;for(let a=1;a<o.length;a++)if(nc(o[a]))return!0;return!1}const Em=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Jx(o,r){return o<r?-1:o>r?1:0}function wy(o){if(!Array.isArray(o))return!1;if(o[0]==="within")return!0;for(let r=1;r<o.length;r++)if(wy(o[r]))return!0;return!1}function rc(o){if(!o)return!0;const r=o[0];return o.length<=1?r!=="any":r==="=="?Sm(o[1],o[2],"=="):r==="!="?sp(Sm(o[1],o[2],"==")):r==="<"||r===">"||r==="<="||r===">="?Sm(o[1],o[2],r):r==="any"?(a=o.slice(1),["any"].concat(a.map(rc))):r==="all"?["all"].concat(o.slice(1).map(rc)):r==="none"?["all"].concat(o.slice(1).map(rc).map(sp)):r==="in"?Tm(o[1],o.slice(2)):r==="!in"?sp(Tm(o[1],o.slice(2))):r==="has"?Cm(o[1]):r==="!has"?sp(Cm(o[1])):r!=="within"||o;var a}function Sm(o,r,a){switch(o){case"$type":return[`filter-type-${a}`,r];case"$id":return[`filter-id-${a}`,r];default:return[`filter-${a}`,o,r]}}function Tm(o,r){if(r.length===0)return!1;switch(o){case"$type":return["filter-type-in",["literal",r]];case"$id":return["filter-id-in",["literal",r]];default:return r.length>200&&!r.some(a=>typeof a!=typeof r[0])?["filter-in-large",o,["literal",r.sort(Jx)]]:["filter-in-small",o,["literal",r]]}}function Cm(o){switch(o){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",o]}}function sp(o){return["!",o]}function Ih(o){return bm(Qr(o.value))?ei(ga({},o,{expressionContext:"filter",valueSpec:o.styleSpec[`filter_${o.layerType||"fill"}`]})):Mh(o)}function Mh(o){const r=o.value,a=o.key;if(gn(r)!=="array")return[new xt(a,r,`array expected, ${gn(r)} found`)];const c=o.styleSpec;let p,g=[];if(r.length<1)return[new xt(a,r,"filter array must have at least 1 element")];switch(g=g.concat(rp({key:`${a}[0]`,value:r[0],valueSpec:c.filter_operator,style:o.style,styleSpec:o.styleSpec})),Ir(r[0])){case"<":case"<=":case">":case">=":r.length>=2&&Ir(r[1])==="$type"&&g.push(new xt(a,r,`"$type" cannot be use with operator "${r[0]}"`));case"==":case"!=":r.length!==3&&g.push(new xt(a,r,`filter array for operator "${r[0]}" must have 3 elements`));case"in":case"!in":r.length>=2&&(p=gn(r[1]),p!=="string"&&g.push(new xt(`${a}[1]`,r[1],`string expected, ${p} found`)));for(let y=2;y<r.length;y++)p=gn(r[y]),Ir(r[1])==="$type"?g=g.concat(rp({key:`${a}[${y}]`,value:r[y],valueSpec:c.geometry_type,style:o.style,styleSpec:o.styleSpec})):p!=="string"&&p!=="number"&&p!=="boolean"&&g.push(new xt(`${a}[${y}]`,r[y],`string, number, or boolean expected, ${p} found`));break;case"any":case"all":case"none":for(let y=1;y<r.length;y++)g=g.concat(Mh({key:`${a}[${y}]`,value:r[y],style:o.style,styleSpec:o.styleSpec}));break;case"has":case"!has":p=gn(r[1]),r.length!==2?g.push(new xt(a,r,`filter array for "${r[0]}" operator must have 2 elements`)):p!=="string"&&g.push(new xt(`${a}[1]`,r[1],`string expected, ${p} found`));break;case"within":p=gn(r[1]),r.length!==2?g.push(new xt(a,r,`filter array for "${r[0]}" operator must have 2 elements`)):p!=="object"&&g.push(new xt(`${a}[1]`,r[1],`object expected, ${p} found`))}return g}function Im(o,r){const a=o.key,c=o.style,p=o.styleSpec,g=o.value,y=o.objectKey,x=p[`${r}_${o.layerType}`];if(!x)return[];const E=y.match(/^(.*)-transition$/);if(r==="paint"&&E&&x[E[1]]&&x[E[1]].transition)return bi({key:a,value:g,valueSpec:p.transition,style:c,styleSpec:p});const S=o.valueSpec||x[y];if(!S)return[new xt(a,g,`unknown property "${y}"`)];let M;if(gn(g)==="string"&&Ju(S)&&!S.tokens&&(M=/^{([^}]+)}$/.exec(g))){const N=`\`{ "type": "identity", "property": ${M?JSON.stringify(M[1]):'"_"'} }\``;return[new xt(a,g,`"${y}" does not support interpolation syntax
Use an identity property function instead: ${N}.`)]}const L=[];return o.layerType==="symbol"&&(y==="text-field"&&c&&!c.glyphs&&L.push(new xt(a,g,'use of "text-field" requires a style "glyphs" property')),y==="text-font"&&wh(Qr(g))&&Ir(g.type)==="identity"&&L.push(new xt(a,g,'"text-font" does not support identity functions'))),L.concat(bi({key:o.key,value:g,valueSpec:S,style:c,styleSpec:p,expressionContext:"property",propertyType:r,propertyKey:y}))}function by(o){return Im(o,"paint")}function Mm(o){return Im(o,"layout")}function Ey(o){let r=[];const a=o.value,c=o.key,p=o.style,g=o.styleSpec;a.type||a.ref||r.push(new xt(c,a,'either "type" or "ref" is required'));let y=Ir(a.type);const x=Ir(a.ref);if(a.id){const E=Ir(a.id);for(let S=0;S<o.arrayIndex;S++){const M=p.layers[S];Ir(M.id)===E&&r.push(new xt(c,a.id,`duplicate layer id "${a.id}", previously used at line ${M.id.__line__}`))}}if("ref"in a){let E;["type","source","source-layer","filter","layout"].forEach(S=>{S in a&&r.push(new xt(c,a[S],`"${S}" is prohibited for ref layers`))}),p.layers.forEach(S=>{Ir(S.id)===x&&(E=S)}),E?E.ref?r.push(new xt(c,a.ref,"ref cannot reference another ref layer")):y=Ir(E.type):typeof x=="string"&&r.push(new xt(c,a.ref,`ref layer "${x}" not found`))}else if(y!=="background"&&y!=="sky")if(a.source){const E=p.sources&&p.sources[a.source],S=E&&Ir(E.type);E?S==="vector"&&y==="raster"?r.push(new xt(c,a.source,`layer "${a.id}" requires a raster source`)):S==="raster"&&y!=="raster"?r.push(new xt(c,a.source,`layer "${a.id}" requires a vector source`)):S!=="vector"||a["source-layer"]?S==="raster-dem"&&y!=="hillshade"?r.push(new xt(c,a.source,"raster-dem source can only be used with layer type 'hillshade'.")):y!=="line"||!a.paint||!a.paint["line-gradient"]&&!a.paint["line-trim-offset"]||S==="geojson"&&E.lineMetrics||r.push(new xt(c,a,`layer "${a.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):r.push(new xt(c,a,`layer "${a.id}" must specify a "source-layer"`)):r.push(new xt(c,a.source,`source "${a.source}" not found`))}else r.push(new xt(c,a,'missing required property "source"'));return r=r.concat(os({key:c,value:a,valueSpec:g.layer,style:o.style,styleSpec:o.styleSpec,objectElementValidators:{"*":()=>[],type:()=>bi({key:`${c}.type`,value:a.type,valueSpec:g.layer.type,style:o.style,styleSpec:o.styleSpec,object:a,objectKey:"type"}),filter:E=>Ih(ga({layerType:y},E)),layout:E=>os({layer:a,key:E.key,value:E.value,valueSpec:{},style:E.style,styleSpec:E.styleSpec,objectElementValidators:{"*":S=>Mm(ga({layerType:y},S))}}),paint:E=>os({layer:a,key:E.key,value:E.value,valueSpec:{},style:E.style,styleSpec:E.styleSpec,objectElementValidators:{"*":S=>by(ga({layerType:y},S))}})}})),r}function cl(o){const r=o.value,a=o.key,c=gn(r);return c!=="string"?[new xt(a,r,`string expected, ${c} found`)]:[]}const Sy={promoteId:function({key:o,value:r}){if(gn(r)==="string")return cl({key:o,value:r});{const a=[];for(const c in r)a.push(...cl({key:`${o}.${c}`,value:r[c]}));return a}}};function Ty(o){const r=o.value,a=o.key,c=o.styleSpec,p=o.style;if(!r.type)return[new xt(a,r,'"type" is required')];const g=Ir(r.type);let y;switch(g){case"vector":case"raster":case"raster-dem":return y=os({key:a,value:r,valueSpec:c[`source_${g.replace("-","_")}`],style:o.style,styleSpec:c,objectElementValidators:Sy}),y;case"geojson":if(y=os({key:a,value:r,valueSpec:c.source_geojson,style:p,styleSpec:c,objectElementValidators:Sy}),r.cluster)for(const x in r.clusterProperties){const[E,S]=r.clusterProperties[x],M=typeof E=="string"?[E,["accumulated"],["get",x]]:E;y.push(...ei({key:`${a}.${x}.map`,value:S,expressionContext:"cluster-map"})),y.push(...ei({key:`${a}.${x}.reduce`,value:M,expressionContext:"cluster-reduce"}))}return y;case"video":return os({key:a,value:r,valueSpec:c.source_video,style:p,styleSpec:c});case"image":return os({key:a,value:r,valueSpec:c.source_image,style:p,styleSpec:c});case"canvas":return[new xt(a,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return rp({key:`${a}.type`,value:r.type,valueSpec:{values:Qx(c)},style:p,styleSpec:c})}}function Qx(o){return o.source.reduce((r,a)=>{const c=o[a];return c.type.type==="enum"&&(r=r.concat(Object.keys(c.type.values))),r},[])}function Cy(o){const r=o.value,a=o.styleSpec,c=a.light,p=o.style;let g=[];const y=gn(r);if(r===void 0)return g;if(y!=="object")return g=g.concat([new xt("light",r,`object expected, ${y} found`)]),g;for(const x in r){const E=x.match(/^(.*)-transition$/);g=g.concat(E&&c[E[1]]&&c[E[1]].transition?bi({key:x,value:r[x],valueSpec:a.transition,style:p,styleSpec:a}):c[x]?bi({key:x,value:r[x],valueSpec:c[x],style:p,styleSpec:a}):[new xt(x,r[x],`unknown property "${x}"`)])}return g}function Am(o){const r=o.value,a=o.key,c=o.style,p=o.styleSpec,g=p.terrain;let y=[];const x=gn(r);if(r===void 0)return y;if(x!=="object")return y=y.concat([new xt("terrain",r,`object expected, ${x} found`)]),y;for(const E in r){const S=E.match(/^(.*)-transition$/);y=y.concat(S&&g[S[1]]&&g[S[1]].transition?bi({key:E,value:r[E],valueSpec:p.transition,style:c,styleSpec:p}):g[E]?bi({key:E,value:r[E],valueSpec:g[E],style:c,styleSpec:p}):[new xt(E,r[E],`unknown property "${E}"`)])}if(r.source){const E=c.sources&&c.sources[r.source],S=E&&Ir(E.type);E?S!=="raster-dem"&&y.push(new xt(a,r.source,`terrain cannot be used with a source of type ${String(S)}, it only be used with a "raster-dem" source type`)):y.push(new xt(a,r.source,`source "${r.source}" not found`))}else y.push(new xt(a,r,'terrain is missing required property "source"'));return y}function Iy(o){const r=o.value,a=o.style,c=o.styleSpec,p=c.fog;let g=[];const y=gn(r);if(r===void 0)return g;if(y!=="object")return g=g.concat([new xt("fog",r,`object expected, ${y} found`)]),g;for(const x in r){const E=x.match(/^(.*)-transition$/);g=g.concat(E&&p[E[1]]&&p[E[1]].transition?bi({key:x,value:r[x],valueSpec:c.transition,style:a,styleSpec:c}):p[x]?bi({key:x,value:r[x],valueSpec:p[x],style:a,styleSpec:c}):[new xt(x,r[x],`unknown property "${x}"`)])}return g}const My={"*":()=>[],array:vy,boolean:function(o){const r=o.value,a=o.key,c=gn(r);return c!=="boolean"?[new xt(a,r,`boolean expected, ${c} found`)]:[]},number:Sh,color:function(o){const r=o.key,a=o.value,c=gn(a);return c!=="string"?[new xt(r,a,`color expected, ${c} found`)]:Zd(a)===null?[new xt(r,a,`color expected, "${a}" found`)]:[]},enum:rp,filter:Ih,function:Th,layer:Ey,object:os,source:Ty,light:Cy,terrain:Am,fog:Iy,string:cl,formatted:function(o){return cl(o).length===0?[]:ei(o)},resolvedImage:function(o){return cl(o).length===0?[]:ei(o)},projection:function(o){const r=o.value,a=o.styleSpec,c=a.projection,p=o.style;let g=[];const y=gn(r);if(y==="object")for(const x in r)g=g.concat(bi({key:x,value:r[x],valueSpec:c[x],style:p,styleSpec:a}));else y!=="string"&&(g=g.concat([new xt("projection",r,`object or string expected, ${y} found`)]));return g}};function bi(o){const r=o.value,a=o.valueSpec,c=o.styleSpec;return a.expression&&wh(Ir(r))?Th(o):a.expression&&ec(Qr(r))?ei(o):a.type&&My[a.type]?My[a.type](o):os(ga({},o,{valueSpec:a.type?c[a.type]:a}))}function e1(o){const r=o.value,a=o.key,c=cl(o);return c.length||(r.indexOf("{fontstack}")===-1&&c.push(new xt(a,r,'"glyphs" url must include a "{fontstack}" token')),r.indexOf("{range}")===-1&&c.push(new xt(a,r,'"glyphs" url must include a "{range}" token'))),c}function Ay(o,r=Ge){return ko(bi({key:"",value:o,valueSpec:r.$root,styleSpec:r,style:o,objectElementValidators:{glyphs:e1,"*":()=>[]}}))}const t1=o=>ko(by(o)),n1=o=>ko(Mm(o));function ko(o){return o.slice().sort((r,a)=>r.line&&a.line?r.line-a.line:0)}function Py(o,r){let a=!1;if(r&&r.length)for(const c of r)o.fire(new ma(new Error(c.message))),a=!0;return a}var r1=Os,ss=3;function Os(o,r,a){var c=this.cells=[];if(o instanceof ArrayBuffer){this.arrayBuffer=o;var p=new Int32Array(this.arrayBuffer);o=p[0],this.d=(r=p[1])+2*(a=p[2]);for(var g=0;g<this.d*this.d;g++){var y=p[ss+g],x=p[ss+g+1];c.push(y===x?null:p.subarray(y,x))}var E=p[ss+c.length+1];this.keys=p.subarray(p[ss+c.length],E),this.bboxes=p.subarray(E),this.insert=this._insertReadonly}else{this.d=r+2*a;for(var S=0;S<this.d*this.d;S++)c.push([]);this.keys=[],this.bboxes=[]}this.n=r,this.extent=o,this.padding=a,this.scale=r/o,this.uid=0;var M=a/r*o;this.min=-M,this.max=o+M}Os.prototype.insert=function(o,r,a,c,p){this._forEachCell(r,a,c,p,this._insertCell,this.uid++),this.keys.push(o),this.bboxes.push(r),this.bboxes.push(a),this.bboxes.push(c),this.bboxes.push(p)},Os.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Os.prototype._insertCell=function(o,r,a,c,p,g){this.cells[p].push(g)},Os.prototype.query=function(o,r,a,c,p){var g=this.min,y=this.max;if(o<=g&&r<=g&&y<=a&&y<=c&&!p)return Array.prototype.slice.call(this.keys);var x=[];return this._forEachCell(o,r,a,c,this._queryCell,x,{},p),x},Os.prototype._queryCell=function(o,r,a,c,p,g,y,x){var E=this.cells[p];if(E!==null)for(var S=this.keys,M=this.bboxes,L=0;L<E.length;L++){var N=E[L];if(y[N]===void 0){var z=4*N;(x?x(M[z+0],M[z+1],M[z+2],M[z+3]):o<=M[z+2]&&r<=M[z+3]&&a>=M[z+0]&&c>=M[z+1])?(y[N]=!0,g.push(S[N])):y[N]=!1}}},Os.prototype._forEachCell=function(o,r,a,c,p,g,y,x){for(var E=this._convertToCellCoord(o),S=this._convertToCellCoord(r),M=this._convertToCellCoord(a),L=this._convertToCellCoord(c),N=E;N<=M;N++)for(var z=S;z<=L;z++){var F=this.d*z+N;if((!x||x(this._convertFromCellCoord(N),this._convertFromCellCoord(z),this._convertFromCellCoord(N+1),this._convertFromCellCoord(z+1)))&&p.call(this,o,r,a,c,F,g,y,x))return}},Os.prototype._convertFromCellCoord=function(o){return(o-this.padding)/this.scale},Os.prototype._convertToCellCoord=function(o){return Math.max(0,Math.min(this.d-1,Math.floor(o*this.scale)+this.padding))},Os.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var o=this.cells,r=ss+this.cells.length+1+1,a=0,c=0;c<this.cells.length;c++)a+=this.cells[c].length;var p=new Int32Array(r+a+this.keys.length+this.bboxes.length);p[0]=this.extent,p[1]=this.n,p[2]=this.padding;for(var g=r,y=0;y<o.length;y++){var x=o[y];p[ss+y]=g,p.set(x,g),g+=x.length}return p[ss+o.length]=g,p.set(this.keys,g),p[ss+o.length+1]=g+=this.keys.length,p.set(this.bboxes,g),g+=this.bboxes.length,p.buffer};var eu=q(r1);const ap={};function bt(o,r,a={}){Object.defineProperty(o,"_classRegistryKey",{value:r,writeable:!1}),ap[r]={klass:o,omit:a.omit||[]}}bt(Object,"Object"),eu.serialize=function(o,r){const a=o.toArrayBuffer();return r&&r.push(a),{buffer:a}},eu.deserialize=function(o){return new eu(o.buffer)},Object.defineProperty(eu,"name",{value:"Grid"}),bt(eu,"Grid"),bt(xr,"Color"),bt(Error,"Error"),bt(ll,"AJAXError"),bt(Ro,"ResolvedImage"),bt(tp,"StylePropertyFunction"),bt(ep,"StyleExpression",{omit:["_evaluator"]}),bt(bh,"ZoomDependentExpression"),bt(wm,"ZoomConstantExpression"),bt(va,"CompoundExpression",{omit:["_evaluate"]});for(const o in xh)ap[xh[o]._classRegistryKey]||bt(xh[o],`Expression${o}`);function Pm(o){return o&&typeof ArrayBuffer<"u"&&(o instanceof ArrayBuffer||o.constructor&&o.constructor.name==="ArrayBuffer")}function Lm(o){return w.ImageBitmap&&o instanceof w.ImageBitmap}function ic(o,r){if(o==null||typeof o=="boolean"||typeof o=="number"||typeof o=="string"||o instanceof Boolean||o instanceof Number||o instanceof String||o instanceof Date||o instanceof RegExp)return o;if(Pm(o)||Lm(o))return r&&r.push(o),o;if(ArrayBuffer.isView(o)){const a=o;return r&&r.push(a.buffer),a}if(o instanceof w.ImageData)return r&&r.push(o.data.buffer),o;if(Array.isArray(o)){const a=[];for(const c of o)a.push(ic(c,r));return a}if(typeof o=="object"){const a=o.constructor,c=a._classRegistryKey;if(!c)throw new Error(`can't serialize object of unregistered class ${c}`);const p=a.serialize?a.serialize(o,r):{};if(!a.serialize){for(const g in o)o.hasOwnProperty(g)&&(ap[c].omit.indexOf(g)>=0||(p[g]=ic(o[g],r)));o instanceof Error&&(p.message=o.message)}if(p.$name)throw new Error("$name property is reserved for worker serialization logic.");return c!=="Object"&&(p.$name=c),p}throw new Error("can't serialize object of type "+typeof o)}function tu(o){if(o==null||typeof o=="boolean"||typeof o=="number"||typeof o=="string"||o instanceof Boolean||o instanceof Number||o instanceof String||o instanceof Date||o instanceof RegExp||Pm(o)||Lm(o)||ArrayBuffer.isView(o)||o instanceof w.ImageData)return o;if(Array.isArray(o))return o.map(tu);if(typeof o=="object"){const r=o.$name||"Object",{klass:a}=ap[r];if(!a)throw new Error(`can't deserialize unregistered class ${r}`);if(a.deserialize)return a.deserialize(o);const c=Object.create(a.prototype);for(const p of Object.keys(o))p!=="$name"&&(c[p]=tu(o[p]));return c}throw new Error("can't deserialize object of type "+typeof o)}const yt={"Latin-1 Supplement":o=>o>=128&&o<=255,Arabic:o=>o>=1536&&o<=1791,"Arabic Supplement":o=>o>=1872&&o<=1919,"Arabic Extended-A":o=>o>=2208&&o<=2303,"Hangul Jamo":o=>o>=4352&&o<=4607,"Unified Canadian Aboriginal Syllabics":o=>o>=5120&&o<=5759,Khmer:o=>o>=6016&&o<=6143,"Unified Canadian Aboriginal Syllabics Extended":o=>o>=6320&&o<=6399,"General Punctuation":o=>o>=8192&&o<=8303,"Letterlike Symbols":o=>o>=8448&&o<=8527,"Number Forms":o=>o>=8528&&o<=8591,"Miscellaneous Technical":o=>o>=8960&&o<=9215,"Control Pictures":o=>o>=9216&&o<=9279,"Optical Character Recognition":o=>o>=9280&&o<=9311,"Enclosed Alphanumerics":o=>o>=9312&&o<=9471,"Geometric Shapes":o=>o>=9632&&o<=9727,"Miscellaneous Symbols":o=>o>=9728&&o<=9983,"Miscellaneous Symbols and Arrows":o=>o>=11008&&o<=11263,"CJK Radicals Supplement":o=>o>=11904&&o<=12031,"Kangxi Radicals":o=>o>=12032&&o<=12255,"Ideographic Description Characters":o=>o>=12272&&o<=12287,"CJK Symbols and Punctuation":o=>o>=12288&&o<=12351,Hiragana:o=>o>=12352&&o<=12447,Katakana:o=>o>=12448&&o<=12543,Bopomofo:o=>o>=12544&&o<=12591,"Hangul Compatibility Jamo":o=>o>=12592&&o<=12687,Kanbun:o=>o>=12688&&o<=12703,"Bopomofo Extended":o=>o>=12704&&o<=12735,"CJK Strokes":o=>o>=12736&&o<=12783,"Katakana Phonetic Extensions":o=>o>=12784&&o<=12799,"Enclosed CJK Letters and Months":o=>o>=12800&&o<=13055,"CJK Compatibility":o=>o>=13056&&o<=13311,"CJK Unified Ideographs Extension A":o=>o>=13312&&o<=19903,"Yijing Hexagram Symbols":o=>o>=19904&&o<=19967,"CJK Unified Ideographs":o=>o>=19968&&o<=40959,"Yi Syllables":o=>o>=40960&&o<=42127,"Yi Radicals":o=>o>=42128&&o<=42191,"Hangul Jamo Extended-A":o=>o>=43360&&o<=43391,"Hangul Syllables":o=>o>=44032&&o<=55215,"Hangul Jamo Extended-B":o=>o>=55216&&o<=55295,"Private Use Area":o=>o>=57344&&o<=63743,"CJK Compatibility Ideographs":o=>o>=63744&&o<=64255,"Arabic Presentation Forms-A":o=>o>=64336&&o<=65023,"Vertical Forms":o=>o>=65040&&o<=65055,"CJK Compatibility Forms":o=>o>=65072&&o<=65103,"Small Form Variants":o=>o>=65104&&o<=65135,"Arabic Presentation Forms-B":o=>o>=65136&&o<=65279,"Halfwidth and Fullwidth Forms":o=>o>=65280&&o<=65519};function Dm(o){for(const r of o)if(Rm(r.charCodeAt(0)))return!0;return!1}function i1(o){for(const r of o)if(!Ly(r.charCodeAt(0)))return!1;return!0}function Ly(o){return!(yt.Arabic(o)||yt["Arabic Supplement"](o)||yt["Arabic Extended-A"](o)||yt["Arabic Presentation Forms-A"](o)||yt["Arabic Presentation Forms-B"](o))}function Rm(o){return!(o!==746&&o!==747&&(o<4352||!(yt["Bopomofo Extended"](o)||yt.Bopomofo(o)||yt["CJK Compatibility Forms"](o)&&!(o>=65097&&o<=65103)||yt["CJK Compatibility Ideographs"](o)||yt["CJK Compatibility"](o)||yt["CJK Radicals Supplement"](o)||yt["CJK Strokes"](o)||!(!yt["CJK Symbols and Punctuation"](o)||o>=12296&&o<=12305||o>=12308&&o<=12319||o===12336)||yt["CJK Unified Ideographs Extension A"](o)||yt["CJK Unified Ideographs"](o)||yt["Enclosed CJK Letters and Months"](o)||yt["Hangul Compatibility Jamo"](o)||yt["Hangul Jamo Extended-A"](o)||yt["Hangul Jamo Extended-B"](o)||yt["Hangul Jamo"](o)||yt["Hangul Syllables"](o)||yt.Hiragana(o)||yt["Ideographic Description Characters"](o)||yt.Kanbun(o)||yt["Kangxi Radicals"](o)||yt["Katakana Phonetic Extensions"](o)||yt.Katakana(o)&&o!==12540||!(!yt["Halfwidth and Fullwidth Forms"](o)||o===65288||o===65289||o===65293||o>=65306&&o<=65310||o===65339||o===65341||o===65343||o>=65371&&o<=65503||o===65507||o>=65512&&o<=65519)||!(!yt["Small Form Variants"](o)||o>=65112&&o<=65118||o>=65123&&o<=65126)||yt["Unified Canadian Aboriginal Syllabics"](o)||yt["Unified Canadian Aboriginal Syllabics Extended"](o)||yt["Vertical Forms"](o)||yt["Yijing Hexagram Symbols"](o)||yt["Yi Syllables"](o)||yt["Yi Radicals"](o))))}function Dy(o){return!(Rm(o)||function(r){return!!(yt["Latin-1 Supplement"](r)&&(r===167||r===169||r===174||r===177||r===188||r===189||r===190||r===215||r===247)||yt["General Punctuation"](r)&&(r===8214||r===8224||r===8225||r===8240||r===8241||r===8251||r===8252||r===8258||r===8263||r===8264||r===8265||r===8273)||yt["Letterlike Symbols"](r)||yt["Number Forms"](r)||yt["Miscellaneous Technical"](r)&&(r>=8960&&r<=8967||r>=8972&&r<=8991||r>=8996&&r<=9e3||r===9003||r>=9085&&r<=9114||r>=9150&&r<=9165||r===9167||r>=9169&&r<=9179||r>=9186&&r<=9215)||yt["Control Pictures"](r)&&r!==9251||yt["Optical Character Recognition"](r)||yt["Enclosed Alphanumerics"](r)||yt["Geometric Shapes"](r)||yt["Miscellaneous Symbols"](r)&&!(r>=9754&&r<=9759)||yt["Miscellaneous Symbols and Arrows"](r)&&(r>=11026&&r<=11055||r>=11088&&r<=11097||r>=11192&&r<=11243)||yt["CJK Symbols and Punctuation"](r)||yt.Katakana(r)||yt["Private Use Area"](r)||yt["CJK Compatibility Forms"](r)||yt["Small Form Variants"](r)||yt["Halfwidth and Fullwidth Forms"](r)||r===8734||r===8756||r===8757||r>=9984&&r<=10087||r>=10102&&r<=10131||r===65532||r===65533)}(o))}function Ry(o){return o>=1424&&o<=2303||yt["Arabic Presentation Forms-A"](o)||yt["Arabic Presentation Forms-B"](o)}function o1(o,r){return!(!r&&Ry(o)||o>=2304&&o<=3583||o>=3840&&o<=4255||yt.Khmer(o))}function s1(o){for(const r of o)if(Ry(r.charCodeAt(0)))return!0;return!1}const Nm="deferred",km="loading",Om="loaded";let oc=null,m="unavailable",l=null;const f=function(o){o&&typeof o=="string"&&o.indexOf("NetworkError")>-1&&(m="error"),oc&&oc(o)};function _(){v.fire(new Zl("pluginStateChange",{pluginStatus:m,pluginURL:l}))}const v=new ih,b=function(){return m},C=function(){if(m!==Nm||!l)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");m=km,_(),l&&Uu({url:l},o=>{o?f(o):(m=Om,_())})},I={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>m===Om||I.applyArabicShaping!=null,isLoading:()=>m===km,setState(o){m=o.pluginStatus,l=o.pluginURL},isParsed:()=>I.applyArabicShaping!=null&&I.processBidirectionalText!=null&&I.processStyledBidirectionalText!=null,getPluginURL:()=>l};class P{constructor(r,a){this.zoom=r,a?(this.now=a.now,this.fadeDuration=a.fadeDuration,this.transition=a.transition,this.pitch=a.pitch):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0)}isSupportedScript(r){return function(a,c){for(const p of a)if(!o1(p.charCodeAt(0),c))return!1;return!0}(r,I.isLoaded())}}class O{constructor(r,a){this.property=r,this.value=a,this.expression=function(c,p){if(wh(c))return new tp(c,p);if(ec(c)){const g=Eh(c,p);if(g.result==="error")throw new Error(g.value.map(y=>`${y.key}: ${y.message}`).join(", "));return g.value}{let g=c;return typeof c=="string"&&p.type==="color"&&(g=xr.parse(c)),{kind:"constant",evaluate:()=>g}}}(a===void 0?r.specification.default:a,r.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(r,a,c){return this.property.possiblyEvaluate(this,r,a,c)}}class k{constructor(r){this.property=r,this.value=new O(r,void 0)}transitioned(r,a){return new W(this.property,this.value,a,hn({},r.transition,this.transition),r.now)}untransitioned(){return new W(this.property,this.value,null,{},0)}}class U{constructor(r){this._properties=r,this._values=Object.create(r.defaultTransitionablePropertyValues)}getValue(r){return fo(this._values[r].value.value)}setValue(r,a){this._values.hasOwnProperty(r)||(this._values[r]=new k(this._values[r].property)),this._values[r].value=new O(this._values[r].property,a===null?void 0:fo(a))}getTransition(r){return fo(this._values[r].transition)}setTransition(r,a){this._values.hasOwnProperty(r)||(this._values[r]=new k(this._values[r].property)),this._values[r].transition=fo(a)||void 0}serialize(){const r={};for(const a of Object.keys(this._values)){const c=this.getValue(a);c!==void 0&&(r[a]=c);const p=this.getTransition(a);p!==void 0&&(r[`${a}-transition`]=p)}return r}transitioned(r,a){const c=new J(this._properties);for(const p of Object.keys(this._values))c._values[p]=this._values[p].transitioned(r,a._values[p]);return c}untransitioned(){const r=new J(this._properties);for(const a of Object.keys(this._values))r._values[a]=this._values[a].untransitioned();return r}}class W{constructor(r,a,c,p,g){const y=p.delay||0,x=p.duration||0;g=g||0,this.property=r,this.value=a,this.begin=g+y,this.end=this.begin+x,r.specification.transition&&(p.delay||p.duration)&&(this.prior=c)}possiblyEvaluate(r,a,c){const p=r.now||0,g=this.value.possiblyEvaluate(r,a,c),y=this.prior;if(y){if(p>this.end)return this.prior=null,g;if(this.value.isDataDriven())return this.prior=null,g;if(p<this.begin)return y.possiblyEvaluate(r,a,c);{const x=(p-this.begin)/(this.end-this.begin);return this.property.interpolate(y.possiblyEvaluate(r,a,c),g,Pt(x))}}return g}}class J{constructor(r){this._properties=r,this._values=Object.create(r.defaultTransitioningPropertyValues)}possiblyEvaluate(r,a,c){const p=new te(this._properties);for(const g of Object.keys(this._values))p._values[g]=this._values[g].possiblyEvaluate(r,a,c);return p}hasTransition(){for(const r of Object.keys(this._values))if(this._values[r].prior)return!0;return!1}}class ee{constructor(r){this._properties=r,this._values=Object.create(r.defaultPropertyValues)}getValue(r){return fo(this._values[r].value)}setValue(r,a){this._values[r]=new O(this._values[r].property,a===null?void 0:fo(a))}serialize(){const r={};for(const a of Object.keys(this._values)){const c=this.getValue(a);c!==void 0&&(r[a]=c)}return r}possiblyEvaluate(r,a,c){const p=new te(this._properties);for(const g of Object.keys(this._values))p._values[g]=this._values[g].possiblyEvaluate(r,a,c);return p}}class Q{constructor(r,a,c){this.property=r,this.value=a,this.parameters=c}isConstant(){return this.value.kind==="constant"}constantOr(r){return this.value.kind==="constant"?this.value.value:r}evaluate(r,a,c,p){return this.property.evaluate(this.value,this.parameters,r,a,c,p)}}class te{constructor(r){this._properties=r,this._values=Object.create(r.defaultPossiblyEvaluatedValues)}get(r){return this._values[r]}}class V{constructor(r){this.specification=r}possiblyEvaluate(r,a){return r.expression.evaluate(a)}interpolate(r,a,c){const p=mh[this.specification.type];return p?p(r,a,c):r}}class K{constructor(r,a){this.specification=r,this.overrides=a}possiblyEvaluate(r,a,c,p){return new Q(this,r.expression.kind==="constant"||r.expression.kind==="camera"?{kind:"constant",value:r.expression.evaluate(a,null,{},c,p)}:r.expression,a)}interpolate(r,a,c){if(r.value.kind!=="constant"||a.value.kind!=="constant")return r;if(r.value.value===void 0||a.value.value===void 0)return new Q(this,{kind:"constant",value:void 0},r.parameters);const p=mh[this.specification.type];return p?new Q(this,{kind:"constant",value:p(r.value.value,a.value.value,c)},r.parameters):r}evaluate(r,a,c,p,g,y){return r.kind==="constant"?r.value:r.evaluate(a,c,p,g,y)}}class se{constructor(r){this.specification=r}possiblyEvaluate(r,a,c,p){return!!r.expression.evaluate(a,null,{},c,p)}interpolate(){return!1}}class ae{constructor(r){this.properties=r,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const a=new P(0,{});for(const c in r){const p=r[c];p.specification.overridable&&this.overridableProperties.push(c);const g=this.defaultPropertyValues[c]=new O(p,void 0),y=this.defaultTransitionablePropertyValues[c]=new k(p);this.defaultTransitioningPropertyValues[c]=y.untransitioned(),this.defaultPossiblyEvaluatedValues[c]=g.possiblyEvaluate(a)}}}function ge(o,r){return 256*(o=qe(Math.floor(o),0,255))+qe(Math.floor(r),0,255)}bt(K,"DataDrivenProperty"),bt(V,"DataConstantProperty"),bt(se,"ColorRampProperty");const ve={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class ye{constructor(r,a){this._structArray=r,this._pos1=a*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Ie{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(r,a){return r._trim(),a&&(r.isTransferred=!0,a.push(r.arrayBuffer)),{length:r.length,arrayBuffer:r.arrayBuffer}}static deserialize(r){const a=Object.create(this.prototype);return a.arrayBuffer=r.arrayBuffer,a.length=r.length,a.capacity=r.arrayBuffer.byteLength/a.bytesPerElement,a._refreshViews(),a}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(r){this.reserve(r),this.length=r}reserve(r){if(r>this.capacity){this.capacity=Math.max(r,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const a=this.uint8;this._refreshViews(),a&&this.uint8.set(a)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Ce(o,r=1){let a=0,c=0;return{members:o.map(p=>{const g=ve[p.type].BYTES_PER_ELEMENT,y=a=Ne(a,Math.max(r,g)),x=p.components||1;return c=Math.max(c,g),a+=g*x,{name:p.name,type:p.type,components:x,offset:y}}),size:Ne(a,Math.max(c,r)),alignment:r}}function Ne(o,r){return Math.ceil(o/r)*r}class rt extends Ie{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,a){const c=this.length;return this.resize(c+1),this.emplace(c,r,a)}emplace(r,a,c){const p=2*r;return this.int16[p+0]=a,this.int16[p+1]=c,r}}rt.prototype.bytesPerElement=4,bt(rt,"StructArrayLayout2i4");class Le extends Ie{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,a,c){const p=this.length;return this.resize(p+1),this.emplace(p,r,a,c)}emplace(r,a,c,p){const g=3*r;return this.int16[g+0]=a,this.int16[g+1]=c,this.int16[g+2]=p,r}}Le.prototype.bytesPerElement=6,bt(Le,"StructArrayLayout3i6");class Ye extends Ie{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,a,c,p){const g=this.length;return this.resize(g+1),this.emplace(g,r,a,c,p)}emplace(r,a,c,p,g){const y=4*r;return this.int16[y+0]=a,this.int16[y+1]=c,this.int16[y+2]=p,this.int16[y+3]=g,r}}Ye.prototype.bytesPerElement=8,bt(Ye,"StructArrayLayout4i8");class Fe extends Ie{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,a,c,p,g,y,x){const E=this.length;return this.resize(E+1),this.emplace(E,r,a,c,p,g,y,x)}emplace(r,a,c,p,g,y,x,E){const S=6*r,M=12*r,L=3*r;return this.int16[S+0]=a,this.int16[S+1]=c,this.uint8[M+4]=p,this.uint8[M+5]=g,this.uint8[M+6]=y,this.uint8[M+7]=x,this.float32[L+2]=E,r}}Fe.prototype.bytesPerElement=12,bt(Fe,"StructArrayLayout2i4ub1f12");class nt extends Ie{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,a,c,p){const g=this.length;return this.resize(g+1),this.emplace(g,r,a,c,p)}emplace(r,a,c,p,g){const y=4*r;return this.float32[y+0]=a,this.float32[y+1]=c,this.float32[y+2]=p,this.float32[y+3]=g,r}}nt.prototype.bytesPerElement=16,bt(nt,"StructArrayLayout4f16");class Re extends Ie{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,a,c,p,g){const y=this.length;return this.resize(y+1),this.emplace(y,r,a,c,p,g)}emplace(r,a,c,p,g,y){const x=6*r,E=3*r;return this.uint16[x+0]=a,this.uint16[x+1]=c,this.uint16[x+2]=p,this.uint16[x+3]=g,this.float32[E+2]=y,r}}Re.prototype.bytesPerElement=12,bt(Re,"StructArrayLayout4ui1f12");class Ze extends Ie{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,a,c,p){const g=this.length;return this.resize(g+1),this.emplace(g,r,a,c,p)}emplace(r,a,c,p,g){const y=4*r;return this.uint16[y+0]=a,this.uint16[y+1]=c,this.uint16[y+2]=p,this.uint16[y+3]=g,r}}Ze.prototype.bytesPerElement=8,bt(Ze,"StructArrayLayout4ui8");class ot extends Ie{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,a,c,p,g,y){const x=this.length;return this.resize(x+1),this.emplace(x,r,a,c,p,g,y)}emplace(r,a,c,p,g,y,x){const E=6*r;return this.int16[E+0]=a,this.int16[E+1]=c,this.int16[E+2]=p,this.int16[E+3]=g,this.int16[E+4]=y,this.int16[E+5]=x,r}}ot.prototype.bytesPerElement=12,bt(ot,"StructArrayLayout6i12");class Qe extends Ie{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,a,c,p,g,y,x,E,S,M,L,N){const z=this.length;return this.resize(z+1),this.emplace(z,r,a,c,p,g,y,x,E,S,M,L,N)}emplace(r,a,c,p,g,y,x,E,S,M,L,N,z){const F=12*r;return this.int16[F+0]=a,this.int16[F+1]=c,this.int16[F+2]=p,this.int16[F+3]=g,this.uint16[F+4]=y,this.uint16[F+5]=x,this.uint16[F+6]=E,this.uint16[F+7]=S,this.int16[F+8]=M,this.int16[F+9]=L,this.int16[F+10]=N,this.int16[F+11]=z,r}}Qe.prototype.bytesPerElement=24,bt(Qe,"StructArrayLayout4i4ui4i24");class st extends Ie{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,a,c,p,g,y){const x=this.length;return this.resize(x+1),this.emplace(x,r,a,c,p,g,y)}emplace(r,a,c,p,g,y,x){const E=10*r,S=5*r;return this.int16[E+0]=a,this.int16[E+1]=c,this.int16[E+2]=p,this.float32[S+2]=g,this.float32[S+3]=y,this.float32[S+4]=x,r}}st.prototype.bytesPerElement=20,bt(st,"StructArrayLayout3i3f20");class Mt extends Ie{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(r){const a=this.length;return this.resize(a+1),this.emplace(a,r)}emplace(r,a){return this.uint32[1*r+0]=a,r}}Mt.prototype.bytesPerElement=4,bt(Mt,"StructArrayLayout1ul4");class jt extends Ie{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,a,c,p,g,y,x,E,S,M,L,N,z){const F=this.length;return this.resize(F+1),this.emplace(F,r,a,c,p,g,y,x,E,S,M,L,N,z)}emplace(r,a,c,p,g,y,x,E,S,M,L,N,z,F){const j=20*r,H=10*r;return this.int16[j+0]=a,this.int16[j+1]=c,this.int16[j+2]=p,this.int16[j+3]=g,this.int16[j+4]=y,this.float32[H+3]=x,this.float32[H+4]=E,this.float32[H+5]=S,this.float32[H+6]=M,this.int16[j+14]=L,this.uint32[H+8]=N,this.uint16[j+18]=z,this.uint16[j+19]=F,r}}jt.prototype.bytesPerElement=40,bt(jt,"StructArrayLayout5i4f1i1ul2ui40");class St extends Ie{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,a,c,p,g,y,x){const E=this.length;return this.resize(E+1),this.emplace(E,r,a,c,p,g,y,x)}emplace(r,a,c,p,g,y,x,E){const S=8*r;return this.int16[S+0]=a,this.int16[S+1]=c,this.int16[S+2]=p,this.int16[S+4]=g,this.int16[S+5]=y,this.int16[S+6]=x,this.int16[S+7]=E,r}}St.prototype.bytesPerElement=16,bt(St,"StructArrayLayout3i2i2i16");class Ot extends Ie{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,a,c,p,g){const y=this.length;return this.resize(y+1),this.emplace(y,r,a,c,p,g)}emplace(r,a,c,p,g,y){const x=4*r,E=8*r;return this.float32[x+0]=a,this.float32[x+1]=c,this.float32[x+2]=p,this.int16[E+6]=g,this.int16[E+7]=y,r}}Ot.prototype.bytesPerElement=16,bt(Ot,"StructArrayLayout2f1f2i16");class an extends Ie{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,a,c,p){const g=this.length;return this.resize(g+1),this.emplace(g,r,a,c,p)}emplace(r,a,c,p,g){const y=12*r,x=3*r;return this.uint8[y+0]=a,this.uint8[y+1]=c,this.float32[x+1]=p,this.float32[x+2]=g,r}}an.prototype.bytesPerElement=12,bt(an,"StructArrayLayout2ub2f12");class nn extends Ie{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,a,c){const p=this.length;return this.resize(p+1),this.emplace(p,r,a,c)}emplace(r,a,c,p){const g=3*r;return this.float32[g+0]=a,this.float32[g+1]=c,this.float32[g+2]=p,r}}nn.prototype.bytesPerElement=12,bt(nn,"StructArrayLayout3f12");class It extends Ie{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,a,c){const p=this.length;return this.resize(p+1),this.emplace(p,r,a,c)}emplace(r,a,c,p){const g=3*r;return this.uint16[g+0]=a,this.uint16[g+1]=c,this.uint16[g+2]=p,r}}It.prototype.bytesPerElement=6,bt(It,"StructArrayLayout3ui6");class In extends Ie{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(r,a,c,p,g,y,x,E,S,M,L,N,z,F,j,H,ne,he,re,ue,pe){const fe=this.length;return this.resize(fe+1),this.emplace(fe,r,a,c,p,g,y,x,E,S,M,L,N,z,F,j,H,ne,he,re,ue,pe)}emplace(r,a,c,p,g,y,x,E,S,M,L,N,z,F,j,H,ne,he,re,ue,pe,fe){const ke=30*r,De=15*r,Xe=60*r;return this.int16[ke+0]=a,this.int16[ke+1]=c,this.int16[ke+2]=p,this.float32[De+2]=g,this.float32[De+3]=y,this.uint16[ke+8]=x,this.uint16[ke+9]=E,this.uint32[De+5]=S,this.uint32[De+6]=M,this.uint32[De+7]=L,this.uint16[ke+16]=N,this.uint16[ke+17]=z,this.uint16[ke+18]=F,this.float32[De+10]=j,this.float32[De+11]=H,this.uint8[Xe+48]=ne,this.uint8[Xe+49]=he,this.uint8[Xe+50]=re,this.uint32[De+13]=ue,this.int16[ke+28]=pe,this.uint8[Xe+58]=fe,r}}In.prototype.bytesPerElement=60,bt(In,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Dn extends Ie{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(r,a,c,p,g,y,x,E,S,M,L,N,z,F,j,H,ne,he,re,ue,pe,fe,ke,De,Xe,it,Be,Ke,Je,tt){const lt=this.length;return this.resize(lt+1),this.emplace(lt,r,a,c,p,g,y,x,E,S,M,L,N,z,F,j,H,ne,he,re,ue,pe,fe,ke,De,Xe,it,Be,Ke,Je,tt)}emplace(r,a,c,p,g,y,x,E,S,M,L,N,z,F,j,H,ne,he,re,ue,pe,fe,ke,De,Xe,it,Be,Ke,Je,tt,lt){const je=38*r,mt=19*r;return this.int16[je+0]=a,this.int16[je+1]=c,this.int16[je+2]=p,this.float32[mt+2]=g,this.float32[mt+3]=y,this.int16[je+8]=x,this.int16[je+9]=E,this.int16[je+10]=S,this.int16[je+11]=M,this.int16[je+12]=L,this.int16[je+13]=N,this.uint16[je+14]=z,this.uint16[je+15]=F,this.uint16[je+16]=j,this.uint16[je+17]=H,this.uint16[je+18]=ne,this.uint16[je+19]=he,this.uint16[je+20]=re,this.uint16[je+21]=ue,this.uint16[je+22]=pe,this.uint16[je+23]=fe,this.uint16[je+24]=ke,this.uint16[je+25]=De,this.uint16[je+26]=Xe,this.uint16[je+27]=it,this.uint16[je+28]=Be,this.uint32[mt+15]=Ke,this.float32[mt+16]=Je,this.float32[mt+17]=tt,this.float32[mt+18]=lt,r}}Dn.prototype.bytesPerElement=76,bt(Dn,"StructArrayLayout3i2f6i15ui1ul3f76");class Rn extends Ie{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r){const a=this.length;return this.resize(a+1),this.emplace(a,r)}emplace(r,a){return this.float32[1*r+0]=a,r}}Rn.prototype.bytesPerElement=4,bt(Rn,"StructArrayLayout1f4");class Nn extends Ie{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,a,c,p,g){const y=this.length;return this.resize(y+1),this.emplace(y,r,a,c,p,g)}emplace(r,a,c,p,g,y){const x=5*r;return this.float32[x+0]=a,this.float32[x+1]=c,this.float32[x+2]=p,this.float32[x+3]=g,this.float32[x+4]=y,r}}Nn.prototype.bytesPerElement=20,bt(Nn,"StructArrayLayout5f20");class Ei extends Ie{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,a,c,p){const g=this.length;return this.resize(g+1),this.emplace(g,r,a,c,p)}emplace(r,a,c,p,g){const y=6*r;return this.uint32[3*r+0]=a,this.uint16[y+2]=c,this.uint16[y+3]=p,this.uint16[y+4]=g,r}}Ei.prototype.bytesPerElement=12,bt(Ei,"StructArrayLayout1ul3ui12");class ti extends Ie{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,a){const c=this.length;return this.resize(c+1),this.emplace(c,r,a)}emplace(r,a,c){const p=2*r;return this.uint16[p+0]=a,this.uint16[p+1]=c,r}}ti.prototype.bytesPerElement=4,bt(ti,"StructArrayLayout2ui4");class Oo extends Ie{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r){const a=this.length;return this.resize(a+1),this.emplace(a,r)}emplace(r,a){return this.uint16[1*r+0]=a,r}}Oo.prototype.bytesPerElement=2,bt(Oo,"StructArrayLayout1ui2");class zs extends Ie{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,a){const c=this.length;return this.resize(c+1),this.emplace(c,r,a)}emplace(r,a,c){const p=2*r;return this.float32[p+0]=a,this.float32[p+1]=c,r}}zs.prototype.bytesPerElement=8,bt(zs,"StructArrayLayout2f8");class Qn extends ye{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Qn.prototype.size=40;class kn extends jt{get(r){return new Qn(this,r)}}bt(kn,"CollisionBoxArray");class yn extends ye{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(r){this._structArray.uint8[this._pos1+49]=r}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(r){this._structArray.uint8[this._pos1+50]=r}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(r){this._structArray.uint32[this._pos4+13]=r}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(r){this._structArray.uint8[this._pos1+58]=r}}yn.prototype.size=60;class Mr extends In{get(r){return new yn(this,r)}}bt(Mr,"PlacedSymbolArray");class Fi extends ye{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(r){this._structArray.uint32[this._pos4+15]=r}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}Fi.prototype.size=76;class Hn extends Dn{get(r){return new Fi(this,r)}}bt(Hn,"SymbolInstanceArray");class Yi extends Rn{getoffsetX(r){return this.float32[1*r+0]}}bt(Yi,"GlyphOffsetArray");class lp extends rt{getx(r){return this.int16[2*r+0]}gety(r){return this.int16[2*r+1]}}bt(lp,"SymbolLineVertexArray");class nu extends ye{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}nu.prototype.size=12;class Ah extends Ei{get(r){return new nu(this,r)}}bt(Ah,"FeatureIndexArray");class Sa extends ti{geta_centroid_pos0(r){return this.uint16[2*r+0]}geta_centroid_pos1(r){return this.uint16[2*r+1]}}bt(Sa,"FillExtrusionCentroidArray");const hl=Ce([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),ru=Ce([{name:"a_dash",components:4,type:"Uint16"}]);var up={exports:{}},Ph={exports:{}};Ph.exports=function(o,r){var a,c,p,g,y,x,E,S;for(c=o.length-(a=3&o.length),p=r,y=3432918353,x=461845907,S=0;S<c;)E=255&o.charCodeAt(S)|(255&o.charCodeAt(++S))<<8|(255&o.charCodeAt(++S))<<16|(255&o.charCodeAt(++S))<<24,++S,p=27492+(65535&(g=5*(65535&(p=(p^=E=(65535&(E=(E=(65535&E)*y+(((E>>>16)*y&65535)<<16)&4294967295)<<15|E>>>17))*x+(((E>>>16)*x&65535)<<16)&4294967295)<<13|p>>>19))+((5*(p>>>16)&65535)<<16)&4294967295))+((58964+(g>>>16)&65535)<<16);switch(E=0,a){case 3:E^=(255&o.charCodeAt(S+2))<<16;case 2:E^=(255&o.charCodeAt(S+1))<<8;case 1:p^=E=(65535&(E=(E=(65535&(E^=255&o.charCodeAt(S)))*y+(((E>>>16)*y&65535)<<16)&4294967295)<<15|E>>>17))*x+(((E>>>16)*x&65535)<<16)&4294967295}return p^=o.length,p=2246822507*(65535&(p^=p>>>16))+((2246822507*(p>>>16)&65535)<<16)&4294967295,p=3266489909*(65535&(p^=p>>>13))+((3266489909*(p>>>16)&65535)<<16)&4294967295,(p^=p>>>16)>>>0};var zm=Ph.exports,HS={exports:{}};HS.exports=function(o,r){for(var a,c=o.length,p=r^c,g=0;c>=4;)a=1540483477*(65535&(a=255&o.charCodeAt(g)|(255&o.charCodeAt(++g))<<8|(255&o.charCodeAt(++g))<<16|(255&o.charCodeAt(++g))<<24))+((1540483477*(a>>>16)&65535)<<16),p=1540483477*(65535&p)+((1540483477*(p>>>16)&65535)<<16)^(a=1540483477*(65535&(a^=a>>>24))+((1540483477*(a>>>16)&65535)<<16)),c-=4,++g;switch(c){case 3:p^=(255&o.charCodeAt(g+2))<<16;case 2:p^=(255&o.charCodeAt(g+1))<<8;case 1:p=1540483477*(65535&(p^=255&o.charCodeAt(g)))+((1540483477*(p>>>16)&65535)<<16)}return p=1540483477*(65535&(p^=p>>>13))+((1540483477*(p>>>16)&65535)<<16),(p^=p>>>15)>>>0};var YS=zm,VD=HS.exports;up.exports=YS,up.exports.murmur3=YS,up.exports.murmur2=VD;var a1=q(up.exports);class Ny{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(r,a,c,p){this.ids.push(KS(r)),this.positions.push(a,c,p)}getPositions(r){const a=KS(r);let c=0,p=this.ids.length-1;for(;c<p;){const y=c+p>>1;this.ids[y]>=a?p=y:c=y+1}const g=[];for(;this.ids[c]===a;)g.push({index:this.positions[3*c],start:this.positions[3*c+1],end:this.positions[3*c+2]}),c++;return g}static serialize(r,a){const c=new Float64Array(r.ids),p=new Uint32Array(r.positions);return l1(c,p,0,c.length-1),a&&a.push(c.buffer,p.buffer),{ids:c,positions:p}}static deserialize(r){const a=new Ny;return a.ids=r.ids,a.positions=r.positions,a.indexed=!0,a}}function KS(o){const r=+o;return!isNaN(r)&&Number.MIN_SAFE_INTEGER<=r&&r<=Number.MAX_SAFE_INTEGER?r:a1(String(o))}function l1(o,r,a,c){for(;a<c;){const p=o[a+c>>1];let g=a-1,y=c+1;for(;;){do g++;while(o[g]<p);do y--;while(o[y]>p);if(g>=y)break;ky(o,g,y),ky(r,3*g,3*y),ky(r,3*g+1,3*y+1),ky(r,3*g+2,3*y+2)}y-a<c-y?(l1(o,r,a,y),a=y+1):(l1(o,r,y+1,c),c=y)}}function ky(o,r,a){const c=o[r];o[r]=o[a],o[a]=c}bt(Ny,"FeaturePositionMap");class iu{constructor(r){this.gl=r.gl,this.initialized=!1}fetchUniformLocation(r,a){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(r,a),this.initialized=!0),!!this.location}}class Oy extends iu{constructor(r){super(r),this.current=0}set(r,a,c){this.fetchUniformLocation(r,a)&&this.current!==c&&(this.current=c,this.gl.uniform1f(this.location,c))}}class JS extends iu{constructor(r){super(r),this.current=[0,0,0,0]}set(r,a,c){this.fetchUniformLocation(r,a)&&(c[0]===this.current[0]&&c[1]===this.current[1]&&c[2]===this.current[2]&&c[3]===this.current[3]||(this.current=c,this.gl.uniform4f(this.location,c[0],c[1],c[2],c[3])))}}class QS extends iu{constructor(r){super(r),this.current=xr.transparent}set(r,a,c){this.fetchUniformLocation(r,a)&&(c.r===this.current.r&&c.g===this.current.g&&c.b===this.current.b&&c.a===this.current.a||(this.current=c,this.gl.uniform4f(this.location,c.r,c.g,c.b,c.a)))}}const jD=new Float32Array(16),GD=new Float32Array(9),qD=new Float32Array(4);function u1(o){return[ge(255*o.r,255*o.g),ge(255*o.b,255*o.a)]}class Fm{constructor(r,a,c){this.value=r,this.uniformNames=a.map(p=>`u_${p}`),this.type=c}setUniform(r,a,c,p,g){a.set(r,g,p.constantOr(this.value))}getBinding(r,a){return this.type==="color"?new QS(r):new Oy(r)}}class cp{constructor(r,a){this.uniformNames=a.map(c=>`u_${c}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(r){this.pixelRatio=r.pixelRatio||1,this.pattern=r.tl.concat(r.br)}setUniform(r,a,c,p,g){const y=g==="u_pattern"||g==="u_dash"?this.pattern:g==="u_pixel_ratio"?this.pixelRatio:null;y&&a.set(r,g,y)}getBinding(r,a){return a==="u_pattern"||a==="u_dash"?new JS(r):new Oy(r)}}class ou{constructor(r,a,c,p){this.expression=r,this.type=c,this.maxValue=0,this.paintVertexAttributes=a.map(g=>({name:`a_${g}`,type:"Float32",components:c==="color"?2:1,offset:0})),this.paintVertexArray=new p}populatePaintArray(r,a,c,p,g,y){const x=this.paintVertexArray.length,E=this.expression.evaluate(new P(0),a,{},g,p,y);this.paintVertexArray.resize(r),this._setPaintValue(x,r,E)}updatePaintArray(r,a,c,p,g){const y=this.expression.evaluate({zoom:0},c,p,void 0,g);this._setPaintValue(r,a,y)}_setPaintValue(r,a,c){if(this.type==="color"){const p=u1(c);for(let g=r;g<a;g++)this.paintVertexArray.emplace(g,p[0],p[1])}else{for(let p=r;p<a;p++)this.paintVertexArray.emplace(p,c);this.maxValue=Math.max(this.maxValue,Math.abs(c))}}upload(r){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=r.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Ta{constructor(r,a,c,p,g,y){this.expression=r,this.uniformNames=a.map(x=>`u_${x}_t`),this.type=c,this.useIntegerZoom=p,this.zoom=g,this.maxValue=0,this.paintVertexAttributes=a.map(x=>({name:`a_${x}`,type:"Float32",components:c==="color"?4:2,offset:0})),this.paintVertexArray=new y}populatePaintArray(r,a,c,p,g,y){const x=this.expression.evaluate(new P(this.zoom),a,{},g,p,y),E=this.expression.evaluate(new P(this.zoom+1),a,{},g,p,y),S=this.paintVertexArray.length;this.paintVertexArray.resize(r),this._setPaintValue(S,r,x,E)}updatePaintArray(r,a,c,p,g){const y=this.expression.evaluate({zoom:this.zoom},c,p,void 0,g),x=this.expression.evaluate({zoom:this.zoom+1},c,p,void 0,g);this._setPaintValue(r,a,y,x)}_setPaintValue(r,a,c,p){if(this.type==="color"){const g=u1(c),y=u1(p);for(let x=r;x<a;x++)this.paintVertexArray.emplace(x,g[0],g[1],y[0],y[1])}else{for(let g=r;g<a;g++)this.paintVertexArray.emplace(g,c,p);this.maxValue=Math.max(this.maxValue,Math.abs(c),Math.abs(p))}}upload(r){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=r.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(r,a,c,p,g){const y=this.useIntegerZoom?Math.floor(c.zoom):c.zoom,x=qe(this.expression.interpolationFactor(y,this.zoom,this.zoom+1),0,1);a.set(r,g,x)}getBinding(r,a){return new Oy(r)}}class sc{constructor(r,a,c,p,g){this.expression=r,this.layerId=g,this.paintVertexAttributes=(c==="array"?ru:hl).members;for(let y=0;y<a.length;++y);this.paintVertexArray=new p}populatePaintArray(r,a,c){const p=this.paintVertexArray.length;this.paintVertexArray.resize(r),this._setPaintValues(p,r,a.patterns&&a.patterns[this.layerId],c)}updatePaintArray(r,a,c,p,g,y){this._setPaintValues(r,a,c.patterns&&c.patterns[this.layerId],y)}_setPaintValues(r,a,c,p){if(!p||!c)return;const g=p[c];if(!g)return;const{tl:y,br:x,pixelRatio:E}=g;for(let S=r;S<a;S++)this.paintVertexArray.emplace(S,y[0],y[1],x[0],x[1],E)}upload(r){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=r.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class ac{constructor(r,a,c=()=>!0){this.binders={},this._buffers=[];const p=[];for(const g in r.paint._values){if(!c(g))continue;const y=r.paint.get(g);if(!(y instanceof Q&&Ju(y.property.specification)))continue;const x=$D(g,r.type),E=y.value,S=y.property.specification.type,M=!!y.property.useIntegerZoom,L=g==="line-dasharray"||g.endsWith("pattern"),N=g==="line-dasharray"&&r.layout.get("line-cap").value.kind!=="constant";if(E.kind!=="constant"||N)if(E.kind==="source"||N||L){const z=eT(g,S,"source");this.binders[g]=L?new sc(E,x,S,z,r.id):new ou(E,x,S,z),p.push(`/a_${g}`)}else{const z=eT(g,S,"composite");this.binders[g]=new Ta(E,x,S,M,a,z),p.push(`/z_${g}`)}else this.binders[g]=L?new cp(E.value,x):new Fm(E.value,x,S),p.push(`/u_${g}`)}this.cacheKey=p.sort().join("")}getMaxValue(r){const a=this.binders[r];return a instanceof ou||a instanceof Ta?a.maxValue:0}populatePaintArrays(r,a,c,p,g,y){for(const x in this.binders){const E=this.binders[x];(E instanceof ou||E instanceof Ta||E instanceof sc)&&E.populatePaintArray(r,a,c,p,g,y)}}setConstantPatternPositions(r){for(const a in this.binders){const c=this.binders[a];c instanceof cp&&c.setConstantPatternPositions(r)}}updatePaintArrays(r,a,c,p,g,y){let x=!1;for(const E in r){const S=a.getPositions(E);for(const M of S){const L=c.feature(M.index);for(const N in this.binders){const z=this.binders[N];if((z instanceof ou||z instanceof Ta||z instanceof sc)&&z.expression.isStateDependent===!0){const F=p.paint.get(N);z.expression=F.value,z.updatePaintArray(M.start,M.end,L,r[E],g,y),x=!0}}}}return x}defines(){const r=[];for(const a in this.binders){const c=this.binders[a];(c instanceof Fm||c instanceof cp)&&r.push(...c.uniformNames.map(p=>`#define HAS_UNIFORM_${p}`))}return r}getBinderAttributes(){const r=[];for(const a in this.binders){const c=this.binders[a];if(c instanceof ou||c instanceof Ta||c instanceof sc)for(let p=0;p<c.paintVertexAttributes.length;p++)r.push(c.paintVertexAttributes[p].name)}return r}getBinderUniforms(){const r=[];for(const a in this.binders){const c=this.binders[a];if(c instanceof Fm||c instanceof cp||c instanceof Ta)for(const p of c.uniformNames)r.push(p)}return r}getPaintVertexBuffers(){return this._buffers}getUniforms(r){const a=[];for(const c in this.binders){const p=this.binders[c];if(p instanceof Fm||p instanceof cp||p instanceof Ta)for(const g of p.uniformNames)a.push({name:g,property:c,binding:p.getBinding(r,g)})}return a}setUniforms(r,a,c,p,g){for(const{name:y,property:x,binding:E}of c)this.binders[x].setUniform(r,E,g,p.get(x),y)}updatePaintBuffers(){this._buffers=[];for(const r in this.binders){const a=this.binders[r];(a instanceof ou||a instanceof Ta||a instanceof sc)&&a.paintVertexBuffer&&this._buffers.push(a.paintVertexBuffer)}}upload(r){for(const a in this.binders){const c=this.binders[a];(c instanceof ou||c instanceof Ta||c instanceof sc)&&c.upload(r)}this.updatePaintBuffers()}destroy(){for(const r in this.binders){const a=this.binders[r];(a instanceof ou||a instanceof Ta||a instanceof sc)&&a.destroy()}}}class Lh{constructor(r,a,c=()=>!0){this.programConfigurations={};for(const p of r)this.programConfigurations[p.id]=new ac(p,a,c);this.needsUpload=!1,this._featureMap=new Ny,this._bufferOffset=0}populatePaintArrays(r,a,c,p,g,y,x){for(const E in this.programConfigurations)this.programConfigurations[E].populatePaintArrays(r,a,p,g,y,x);a.id!==void 0&&this._featureMap.add(a.id,c,this._bufferOffset,r),this._bufferOffset=r,this.needsUpload=!0}updatePaintArrays(r,a,c,p,g){for(const y of c)this.needsUpload=this.programConfigurations[y.id].updatePaintArrays(r,this._featureMap,a,y,p,g)||this.needsUpload}get(r){return this.programConfigurations[r]}upload(r){if(this.needsUpload){for(const a in this.programConfigurations)this.programConfigurations[a].upload(r);this.needsUpload=!1}}destroy(){for(const r in this.programConfigurations)this.programConfigurations[r].destroy()}}const XD={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function $D(o,r){return XD[o]||[o.replace(`${r}-`,"").replace(/-/g,"_")]}const ZD={"line-pattern":{source:Re,composite:Re},"fill-pattern":{source:Re,composite:Re},"fill-extrusion-pattern":{source:Re,composite:Re},"line-dasharray":{source:Ze,composite:Ze}},WD={color:{source:zs,composite:nt},number:{source:Rn,composite:zs}};function eT(o,r,a){const c=ZD[o];return c&&c[a]||WD[r][a]}bt(Fm,"ConstantBinder"),bt(cp,"PatternConstantBinder"),bt(ou,"SourceExpressionBinder"),bt(sc,"PatternCompositeBinder"),bt(Ta,"CompositeExpressionBinder"),bt(ac,"ProgramConfiguration",{omit:["_buffers"]}),bt(Lh,"ProgramConfigurationSet");const tT="-transition";class Ca extends ih{constructor(r,a){if(super(),this.id=r.id,this.type=r.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,r.type!=="custom"&&(this.metadata=r.metadata,this.minzoom=r.minzoom,this.maxzoom=r.maxzoom,r.type!=="background"&&r.type!=="sky"&&(this.source=r.source,this.sourceLayer=r["source-layer"],this.filter=r.filter),a.layout&&(this._unevaluatedLayout=new ee(a.layout)),a.paint)){this._transitionablePaint=new U(a.paint);for(const c in r.paint)this.setPaintProperty(c,r.paint[c],{validate:!1});for(const c in r.layout)this.setLayoutProperty(c,r.layout[c],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new te(a.paint)}}getLayoutProperty(r){return r==="visibility"?this.visibility:this._unevaluatedLayout.getValue(r)}setLayoutProperty(r,a,c={}){a!=null&&this._validate(n1,`layers.${this.id}.layout.${r}`,r,a,c)||(r!=="visibility"?this._unevaluatedLayout.setValue(r,a):this.visibility=a)}getPaintProperty(r){return fa(r,tT)?this._transitionablePaint.getTransition(r.slice(0,-11)):this._transitionablePaint.getValue(r)}setPaintProperty(r,a,c={}){if(a!=null&&this._validate(t1,`layers.${this.id}.paint.${r}`,r,a,c))return!1;if(fa(r,tT))return this._transitionablePaint.setTransition(r.slice(0,-11),a||void 0),!1;{const p=this._transitionablePaint._values[r],g=p.value.isDataDriven(),y=p.value;this._transitionablePaint.setValue(r,a),this._handleSpecialPaintPropertyUpdate(r);const x=this._transitionablePaint._values[r].value,E=x.isDataDriven(),S=fa(r,"pattern")||r==="line-dasharray";return E||g||S||this._handleOverridablePaintPropertyUpdate(r,y,x)}}_handleSpecialPaintPropertyUpdate(r){}getProgramIds(){return null}getProgramConfiguration(r){return null}_handleOverridablePaintPropertyUpdate(r,a,c){return!1}isHidden(r){return!!(this.minzoom&&r<this.minzoom)||!!(this.maxzoom&&r>=this.maxzoom)||this.visibility==="none"}updateTransitions(r){this._transitioningPaint=this._transitionablePaint.transitioned(r,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(r,a){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(r,void 0,a)),this.paint=this._transitioningPaint.possiblyEvaluate(r,void 0,a)}serialize(){const r={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(r.layout=r.layout||{},r.layout.visibility=this.visibility),Ou(r,(a,c)=>!(a===void 0||c==="layout"&&!Object.keys(a).length||c==="paint"&&!Object.keys(a).length))}_validate(r,a,c,p,g={}){return(!g||g.validate!==!1)&&Py(this,r.call(Ay,{key:a,layerType:this.type,objectKey:c,value:p,styleSpec:Ge,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const r in this.paint._values){const a=this.paint.get(r);if(a instanceof Q&&Ju(a.property.specification)&&(a.value.kind==="source"||a.value.kind==="composite")&&a.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=ip(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const HD=Ce([{name:"a_pos",components:2,type:"Int16"}],4),YD=Ce([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Ar{constructor(r=[]){this.segments=r}prepareSegment(r,a,c,p){let g=this.segments[this.segments.length-1];return r>Ar.MAX_VERTEX_ARRAY_LENGTH&&nr(`Max vertices per segment is ${Ar.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${r}`),(!g||g.vertexLength+r>Ar.MAX_VERTEX_ARRAY_LENGTH||g.sortKey!==p)&&(g={vertexOffset:a.length,primitiveOffset:c.length,vertexLength:0,primitiveLength:0},p!==void 0&&(g.sortKey=p),this.segments.push(g)),g}get(){return this.segments}destroy(){for(const r of this.segments)for(const a in r.vaos)r.vaos[a].destroy()}static simpleSegment(r,a,c,p){return new Ar([{vertexOffset:r,primitiveOffset:a,vertexLength:c,primitiveLength:p,vaos:{},sortKey:0}])}}Ar.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,bt(Ar,"SegmentVector");var Rt=8192;class lc{constructor(r,a){r&&(a?this.setSouthWest(r).setNorthEast(a):r.length===4?this.setSouthWest([r[0],r[1]]).setNorthEast([r[2],r[3]]):this.setSouthWest(r[0]).setNorthEast(r[1]))}setNorthEast(r){return this._ne=r instanceof On?new On(r.lng,r.lat):On.convert(r),this}setSouthWest(r){return this._sw=r instanceof On?new On(r.lng,r.lat):On.convert(r),this}extend(r){const a=this._sw,c=this._ne;let p,g;if(r instanceof On)p=r,g=r;else{if(!(r instanceof lc))return Array.isArray(r)?r.length===4||r.every(Array.isArray)?this.extend(lc.convert(r)):this.extend(On.convert(r)):typeof r=="object"&&r!==null&&r.hasOwnProperty("lat")&&(r.hasOwnProperty("lon")||r.hasOwnProperty("lng"))?this.extend(On.convert(r)):this;if(p=r._sw,g=r._ne,!p||!g)return this}return a||c?(a.lng=Math.min(p.lng,a.lng),a.lat=Math.min(p.lat,a.lat),c.lng=Math.max(g.lng,c.lng),c.lat=Math.max(g.lat,c.lat)):(this._sw=new On(p.lng,p.lat),this._ne=new On(g.lng,g.lat)),this}getCenter(){return new On((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new On(this.getWest(),this.getNorth())}getSouthEast(){return new On(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(r){const{lng:a,lat:c}=On.convert(r);let p=this._sw.lng<=a&&a<=this._ne.lng;return this._sw.lng>this._ne.lng&&(p=this._sw.lng>=a&&a>=this._ne.lng),this._sw.lat<=c&&c<=this._ne.lat&&p}static convert(r){return!r||r instanceof lc?r:new lc(r)}}var zy=1e-6,zo=typeof Float32Array<"u"?Float32Array:Array;function nT(){var o=new zo(9);return zo!=Float32Array&&(o[1]=0,o[2]=0,o[3]=0,o[5]=0,o[6]=0,o[7]=0),o[0]=1,o[4]=1,o[8]=1,o}function rT(o,r,a){var c=r[0],p=r[1],g=r[2],y=r[3],x=r[4],E=r[5],S=r[6],M=r[7],L=r[8],N=a[0],z=a[1],F=a[2],j=a[3],H=a[4],ne=a[5],he=a[6],re=a[7],ue=a[8];return o[0]=N*c+z*y+F*S,o[1]=N*p+z*x+F*M,o[2]=N*g+z*E+F*L,o[3]=j*c+H*y+ne*S,o[4]=j*p+H*x+ne*M,o[5]=j*g+H*E+ne*L,o[6]=he*c+re*y+ue*S,o[7]=he*p+re*x+ue*M,o[8]=he*g+re*E+ue*L,o}function Ia(o){return o[0]=1,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=1,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=1,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o}function c1(o,r){var a=r[0],c=r[1],p=r[2],g=r[3],y=r[4],x=r[5],E=r[6],S=r[7],M=r[8],L=r[9],N=r[10],z=r[11],F=r[12],j=r[13],H=r[14],ne=r[15],he=a*x-c*y,re=a*E-p*y,ue=a*S-g*y,pe=c*E-p*x,fe=c*S-g*x,ke=p*S-g*E,De=M*j-L*F,Xe=M*H-N*F,it=M*ne-z*F,Be=L*H-N*j,Ke=L*ne-z*j,Je=N*ne-z*H,tt=he*Je-re*Ke+ue*Be+pe*it-fe*Xe+ke*De;return tt?(o[0]=(x*Je-E*Ke+S*Be)*(tt=1/tt),o[1]=(p*Ke-c*Je-g*Be)*tt,o[2]=(j*ke-H*fe+ne*pe)*tt,o[3]=(N*fe-L*ke-z*pe)*tt,o[4]=(E*it-y*Je-S*Xe)*tt,o[5]=(a*Je-p*it+g*Xe)*tt,o[6]=(H*ue-F*ke-ne*re)*tt,o[7]=(M*ke-N*ue+z*re)*tt,o[8]=(y*Ke-x*it+S*De)*tt,o[9]=(c*it-a*Ke-g*De)*tt,o[10]=(F*fe-j*ue+ne*he)*tt,o[11]=(L*ue-M*fe-z*he)*tt,o[12]=(x*Xe-y*Be-E*De)*tt,o[13]=(a*Be-c*Xe+p*De)*tt,o[14]=(j*re-F*pe-H*he)*tt,o[15]=(M*pe-L*re+N*he)*tt,o):null}function Dh(o,r,a){var c=r[0],p=r[1],g=r[2],y=r[3],x=r[4],E=r[5],S=r[6],M=r[7],L=r[8],N=r[9],z=r[10],F=r[11],j=r[12],H=r[13],ne=r[14],he=r[15],re=a[0],ue=a[1],pe=a[2],fe=a[3];return o[0]=re*c+ue*x+pe*L+fe*j,o[1]=re*p+ue*E+pe*N+fe*H,o[2]=re*g+ue*S+pe*z+fe*ne,o[3]=re*y+ue*M+pe*F+fe*he,o[4]=(re=a[4])*c+(ue=a[5])*x+(pe=a[6])*L+(fe=a[7])*j,o[5]=re*p+ue*E+pe*N+fe*H,o[6]=re*g+ue*S+pe*z+fe*ne,o[7]=re*y+ue*M+pe*F+fe*he,o[8]=(re=a[8])*c+(ue=a[9])*x+(pe=a[10])*L+(fe=a[11])*j,o[9]=re*p+ue*E+pe*N+fe*H,o[10]=re*g+ue*S+pe*z+fe*ne,o[11]=re*y+ue*M+pe*F+fe*he,o[12]=(re=a[12])*c+(ue=a[13])*x+(pe=a[14])*L+(fe=a[15])*j,o[13]=re*p+ue*E+pe*N+fe*H,o[14]=re*g+ue*S+pe*z+fe*ne,o[15]=re*y+ue*M+pe*F+fe*he,o}function Bm(o,r,a){var c,p,g,y,x,E,S,M,L,N,z,F,j=a[0],H=a[1],ne=a[2];return r===o?(o[12]=r[0]*j+r[4]*H+r[8]*ne+r[12],o[13]=r[1]*j+r[5]*H+r[9]*ne+r[13],o[14]=r[2]*j+r[6]*H+r[10]*ne+r[14],o[15]=r[3]*j+r[7]*H+r[11]*ne+r[15]):(p=r[1],g=r[2],y=r[3],x=r[4],E=r[5],S=r[6],M=r[7],L=r[8],N=r[9],z=r[10],F=r[11],o[0]=c=r[0],o[1]=p,o[2]=g,o[3]=y,o[4]=x,o[5]=E,o[6]=S,o[7]=M,o[8]=L,o[9]=N,o[10]=z,o[11]=F,o[12]=c*j+x*H+L*ne+r[12],o[13]=p*j+E*H+N*ne+r[13],o[14]=g*j+S*H+z*ne+r[14],o[15]=y*j+M*H+F*ne+r[15]),o}function Rh(o,r,a){var c=a[0],p=a[1],g=a[2];return o[0]=r[0]*c,o[1]=r[1]*c,o[2]=r[2]*c,o[3]=r[3]*c,o[4]=r[4]*p,o[5]=r[5]*p,o[6]=r[6]*p,o[7]=r[7]*p,o[8]=r[8]*g,o[9]=r[9]*g,o[10]=r[10]*g,o[11]=r[11]*g,o[12]=r[12],o[13]=r[13],o[14]=r[14],o[15]=r[15],o}function h1(o,r,a){var c=Math.sin(a),p=Math.cos(a),g=r[4],y=r[5],x=r[6],E=r[7],S=r[8],M=r[9],L=r[10],N=r[11];return r!==o&&(o[0]=r[0],o[1]=r[1],o[2]=r[2],o[3]=r[3],o[12]=r[12],o[13]=r[13],o[14]=r[14],o[15]=r[15]),o[4]=g*p+S*c,o[5]=y*p+M*c,o[6]=x*p+L*c,o[7]=E*p+N*c,o[8]=S*p-g*c,o[9]=M*p-y*c,o[10]=L*p-x*c,o[11]=N*p-E*c,o}function Fy(o,r,a){var c=Math.sin(a),p=Math.cos(a),g=r[0],y=r[1],x=r[2],E=r[3],S=r[8],M=r[9],L=r[10],N=r[11];return r!==o&&(o[4]=r[4],o[5]=r[5],o[6]=r[6],o[7]=r[7],o[12]=r[12],o[13]=r[13],o[14]=r[14],o[15]=r[15]),o[0]=g*p-S*c,o[1]=y*p-M*c,o[2]=x*p-L*c,o[3]=E*p-N*c,o[8]=g*c+S*p,o[9]=y*c+M*p,o[10]=x*c+L*p,o[11]=E*c+N*p,o}function iT(o,r){return o[0]=r[0],o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=r[1],o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=r[2],o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o}function oT(o,r,a){var c,p,g,y=a[0],x=a[1],E=a[2],S=Math.hypot(y,x,E);return S<zy?null:(y*=S=1/S,x*=S,E*=S,c=Math.sin(r),p=Math.cos(r),o[0]=y*y*(g=1-p)+p,o[1]=x*y*g+E*c,o[2]=E*y*g-x*c,o[3]=0,o[4]=y*x*g-E*c,o[5]=x*x*g+p,o[6]=E*x*g+y*c,o[7]=0,o[8]=y*E*g+x*c,o[9]=x*E*g-y*c,o[10]=E*E*g+p,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o)}Math.hypot||(Math.hypot=function(){for(var o=0,r=arguments.length;r--;)o+=arguments[r]*arguments[r];return Math.sqrt(o)});var KD=Dh;function f1(){var o=new zo(3);return zo!=Float32Array&&(o[0]=0,o[1]=0,o[2]=0),o}function sT(o){var r=new zo(3);return r[0]=o[0],r[1]=o[1],r[2]=o[2],r}function Um(o){return Math.hypot(o[0],o[1],o[2])}function hp(o,r,a){var c=new zo(3);return c[0]=o,c[1]=r,c[2]=a,c}function su(o,r,a){return o[0]=r[0]+a[0],o[1]=r[1]+a[1],o[2]=r[2]+a[2],o}function p1(o,r,a){return o[0]=r[0]-a[0],o[1]=r[1]-a[1],o[2]=r[2]-a[2],o}function aT(o,r,a){return o[0]=r[0]*a[0],o[1]=r[1]*a[1],o[2]=r[2]*a[2],o}function Vm(o,r,a){return o[0]=Math.min(r[0],a[0]),o[1]=Math.min(r[1],a[1]),o[2]=Math.min(r[2],a[2]),o}function jm(o,r,a){return o[0]=Math.max(r[0],a[0]),o[1]=Math.max(r[1],a[1]),o[2]=Math.max(r[2],a[2]),o}function as(o,r,a){return o[0]=r[0]*a,o[1]=r[1]*a,o[2]=r[2]*a,o}function Gm(o,r,a,c){return o[0]=r[0]+a[0]*c,o[1]=r[1]+a[1]*c,o[2]=r[2]+a[2]*c,o}function Ki(o,r){var a=r[0],c=r[1],p=r[2],g=a*a+c*c+p*p;return g>0&&(g=1/Math.sqrt(g)),o[0]=r[0]*g,o[1]=r[1]*g,o[2]=r[2]*g,o}function Fs(o,r){return o[0]*r[0]+o[1]*r[1]+o[2]*r[2]}function d1(o,r,a){var c=r[0],p=r[1],g=r[2],y=a[0],x=a[1],E=a[2];return o[0]=p*E-g*x,o[1]=g*y-c*E,o[2]=c*x-p*y,o}function wr(o,r,a){var c=r[0],p=r[1],g=r[2],y=a[3]*c+a[7]*p+a[11]*g+a[15];return o[0]=(a[0]*c+a[4]*p+a[8]*g+a[12])/(y=y||1),o[1]=(a[1]*c+a[5]*p+a[9]*g+a[13])/y,o[2]=(a[2]*c+a[6]*p+a[10]*g+a[14])/y,o}function lT(o,r,a){var c=a[0],p=a[1],g=a[2],y=r[0],x=r[1],E=r[2],S=p*E-g*x,M=g*y-c*E,L=c*x-p*y,N=p*L-g*M,z=g*S-c*L,F=c*M-p*S,j=2*a[3];return M*=j,L*=j,z*=2,F*=2,o[0]=y+(S*=j)+(N*=2),o[1]=x+M+z,o[2]=E+L+F,o}var qm,Ma=p1,JD=aT,QD=Um;function uT(o,r,a){return o[0]=r[0]*a,o[1]=r[1]*a,o[2]=r[2]*a,o[3]=r[3]*a,o}function cT(o,r){var a=r[0],c=r[1],p=r[2],g=r[3],y=a*a+c*c+p*p+g*g;return y>0&&(y=1/Math.sqrt(y)),o[0]=a*y,o[1]=c*y,o[2]=p*y,o[3]=g*y,o}function Nh(o,r,a){var c=r[0],p=r[1],g=r[2],y=r[3];return o[0]=a[0]*c+a[4]*p+a[8]*g+a[12]*y,o[1]=a[1]*c+a[5]*p+a[9]*g+a[13]*y,o[2]=a[2]*c+a[6]*p+a[10]*g+a[14]*y,o[3]=a[3]*c+a[7]*p+a[11]*g+a[15]*y,o}function hT(){var o=new zo(4);return zo!=Float32Array&&(o[0]=0,o[1]=0,o[2]=0),o[3]=1,o}function fT(o){return o[0]=0,o[1]=0,o[2]=0,o[3]=1,o}function pT(o,r,a){a*=.5;var c=r[0],p=r[1],g=r[2],y=r[3],x=Math.sin(a),E=Math.cos(a);return o[0]=c*E+y*x,o[1]=p*E+g*x,o[2]=g*E-p*x,o[3]=y*E-c*x,o}function dT(o,r,a){a*=.5;var c=r[0],p=r[1],g=r[2],y=r[3],x=Math.sin(a),E=Math.cos(a);return o[0]=c*E-g*x,o[1]=p*E+y*x,o[2]=g*E+c*x,o[3]=y*E-p*x,o}f1(),qm=new zo(4),zo!=Float32Array&&(qm[0]=0,qm[1]=0,qm[2]=0,qm[3]=0);var eR=cT;f1(),hp(1,0,0),hp(0,1,0),hT(),hT(),nT();const tR=Ce([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:mT}=tR,gT=Ce([{name:"a_pos_3",components:3,type:"Int16"}]);var Xm=Ce([{name:"a_pos",type:"Int16",components:2}]);class m1{constructor(r,a){this.pos=r,this.dir=a}intersectsPlane(r,a,c){const p=Fs(a,this.dir);if(Math.abs(p)<1e-6)return!1;const g=((r[0]-this.pos[0])*a[0]+(r[1]-this.pos[1])*a[1]+(r[2]-this.pos[2])*a[2])/p;return c[0]=this.pos[0]+this.dir[0]*g,c[1]=this.pos[1]+this.dir[1]*g,c[2]=this.pos[2]+this.dir[2]*g,!0}closestPointOnSphere(r,a,c){if(function(z,F){var j=z[0],H=z[1],ne=z[2],he=F[0],re=F[1],ue=F[2];return Math.abs(j-he)<=zy*Math.max(1,Math.abs(j),Math.abs(he))&&Math.abs(H-re)<=zy*Math.max(1,Math.abs(H),Math.abs(re))&&Math.abs(ne-ue)<=zy*Math.max(1,Math.abs(ne),Math.abs(ue))}(this.pos,r)||a===0)return c[0]=c[1]=c[2]=0,!1;const[p,g,y]=this.dir,x=this.pos[0]-r[0],E=this.pos[1]-r[1],S=this.pos[2]-r[2],M=p*p+g*g+y*y,L=2*(x*p+E*g+S*y),N=L*L-4*M*(x*x+E*E+S*S-a*a);if(N<0){const z=Math.max(-L/2,0),F=x+p*z,j=E+g*z,H=S+y*z,ne=Math.hypot(F,j,H);return c[0]=F*a/ne,c[1]=j*a/ne,c[2]=H*a/ne,!1}{const z=(-L-Math.sqrt(N))/(2*M);if(z<0){const F=Math.hypot(x,E,S);return c[0]=x*a/F,c[1]=E*a/F,c[2]=S*a/F,!1}return c[0]=x+p*z,c[1]=E+g*z,c[2]=S+y*z,!0}}}class g1{constructor(r,a,c,p,g){this.TL=r,this.TR=a,this.BR=c,this.BL=p,this.horizon=g}static fromInvProjectionMatrix(r,a,c){const p=[-1,1,1],g=[1,1,1],y=[1,-1,1],x=[-1,-1,1],E=wr(p,p,r),S=wr(g,g,r),M=wr(y,y,r),L=wr(x,x,r);return new g1(E,S,M,L,a/c)}}class _1{constructor(r,a){this.points=r,this.planes=a}static fromInvProjectionMatrix(r,a,c,p){const g=Math.pow(2,c),y=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(E=>{const S=Nh([],E,r),M=1/S[3]/a*g;return function(L,N,z){return L[0]=N[0]*z[0],L[1]=N[1]*z[1],L[2]=N[2]*z[2],L[3]=N[3]*z[3],L}(S,S,[M,M,p?1/S[3]:M,M])}),x=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(E=>{const S=Ki([],d1([],Ma([],y[E[0]],y[E[1]]),Ma([],y[E[2]],y[E[1]]))),M=-Fs(S,y[E[1]]);return S.concat(M)});return new _1(y,x)}}class Ji{static fromPoints(r){const a=[1/0,1/0,1/0],c=[-1/0,-1/0,-1/0];for(const p of r)Vm(a,a,p),jm(c,c,p);return new Ji(a,c)}static applyTransform(r,a){const c=r.getCorners();for(let p=0;p<c.length;++p)wr(c[p],c[p],a);return Ji.fromPoints(c)}constructor(r,a){this.min=r,this.max=a,this.center=as([],su([],this.min,this.max),.5)}quadrant(r){const a=[r%2==0,r<2],c=sT(this.min),p=sT(this.max);for(let g=0;g<a.length;g++)c[g]=a[g]?this.min[g]:this.center[g],p[g]=a[g]?this.center[g]:this.max[g];return p[2]=this.max[2],new Ji(c,p)}distanceX(r){return Math.max(Math.min(this.max[0],r[0]),this.min[0])-r[0]}distanceY(r){return Math.max(Math.min(this.max[1],r[1]),this.min[1])-r[1]}distanceZ(r){return Math.max(Math.min(this.max[2],r[2]),this.min[2])-r[2]}getCorners(){const r=this.min,a=this.max;return[[r[0],r[1],r[2]],[a[0],r[1],r[2]],[a[0],a[1],r[2]],[r[0],a[1],r[2]],[r[0],r[1],a[2]],[a[0],r[1],a[2]],[a[0],a[1],a[2]],[r[0],a[1],a[2]]]}intersects(r){const a=this.getCorners();let c=!0;for(let p=0;p<r.planes.length;p++){const g=r.planes[p];let y=0;for(let x=0;x<a.length;x++)y+=Fs(g,a[x])+g[3]>=0;if(y===0)return 0;y!==a.length&&(c=!1)}if(c)return 2;for(let p=0;p<3;p++){let g=Number.MAX_VALUE,y=-Number.MAX_VALUE;for(let x=0;x<r.points.length;x++){const E=r.points[x][p]-this.min[p];g=Math.min(g,E),y=Math.max(y,E)}if(y<0||g>this.max[p]-this.min[p])return 0}return 1}}const y1=5,_T=6,fl=Rt/Math.PI/2,nR=16383,kh=64,$m=[kh,32,16],Bs=-fl,Us=fl,rR=[new Ji([Bs,Bs,Bs],[Us,Us,Us]),new Ji([Bs,Bs,Bs],[0,0,Us]),new Ji([0,Bs,Bs],[Us,0,Us]),new Ji([Bs,0,Bs],[0,Us,Us]),new Ji([0,0,Bs],[Us,Us,Us])];function By(o){return o*fl/Hm}function yT(o,r,a,c=!0){const p=as([],o._camera.position,o.worldSize),g=[r,a,1,1];Nh(g,g,o.pixelMatrixInverse),uT(g,g,1/g[3]);const y=Ki([],Ma([],g,p)),x=o.globeMatrix,E=[x[12],x[13],x[14]],S=Ma([],E,p),M=Um(S),L=Ki([],S),N=o.worldSize/(2*Math.PI),z=Fs(L,y),F=Math.asin(N/M);if(F<Math.acos(z)){if(!c)return null;const it=[],Be=[];as(it,y,M/z),Ki(Be,Ma(Be,it,S)),Ki(y,su(y,S,as(y,Be,Math.tan(F)*M)))}const j=[];new m1(p,y).closestPointOnSphere(E,N,j);const H=Ki([],sl(x,0)),ne=Ki([],sl(x,1)),he=Ki([],sl(x,2)),re=Fs(H,j),ue=Fs(ne,j),pe=Fs(he,j),fe=$e(Math.asin(-ue/N));let ke=$e(Math.atan2(re,pe));ke=o.center.lng+function(it,Be){const Ke=(Be-it+180)%360-180;return Ke<-180?Ke+360:Ke}(o.center.lng,ke);const De=dl(ke),Xe=qe(ml(fe),0,1);return new mp(De,Xe)}class iR{constructor(r,a,c){this.a=Ma([],r,c),this.b=Ma([],a,c),this.center=c;const p=Ki([],this.a),g=Ki([],this.b);this.angle=Math.acos(Fs(p,g))}}function v1(o,r){if(o.angle===0)return null;let a;return a=o.a[r]===0?1/o.angle*.5*Math.PI:1/o.angle*Math.atan(o.b[r]/o.a[r]/Math.sin(o.angle)-1/Math.tan(o.angle)),a<0||a>1?null:function(c,p,g,y){const x=Math.sin(g);return c*(Math.sin((1-y)*g)/x)+p*(Math.sin(y*g)/x)}(o.a[r],o.b[r],o.angle,qe(a,0,1))+o.center[r]}function pl(o){if(o.z<=1)return rR[o.z+2*o.y+o.x];const r=x1(Uy(o));return Ji.fromPoints(r)}function Oh(o,r,a){return as(o,o,1-a),Gm(o,o,r,a)}function vT(o,r){const a=dp(r.zoom);if(a===0)return pl(o);const c=Uy(o),p=x1(c),g=dl(c.getWest())*r.worldSize,y=dl(c.getEast())*r.worldSize,x=ml(c.getNorth())*r.worldSize,E=ml(c.getSouth())*r.worldSize,S=[g,x,0],M=[y,x,0],L=[g,E,0],N=[y,E,0],z=c1([],r.globeMatrix);return wr(S,S,z),wr(M,M,z),wr(L,L,z),wr(N,N,z),p[0]=Oh(p[0],L,a),p[1]=Oh(p[1],N,a),p[2]=Oh(p[2],M,a),p[3]=Oh(p[3],S,a),Ji.fromPoints(p)}function xT(o,r,a){for(const c of o)wr(c,c,r),as(c,c,a)}function oR(o,r,a){const c=r/o.worldSize,p=o.globeMatrix;if(a.z<=1){const De=pl(a).getCorners();return xT(De,p,c),Ji.fromPoints(De)}const g=Uy(a),y=x1(g);xT(y,p,c);const x=Number.MAX_VALUE,E=[-x,-x,-x],S=[x,x,x];if(g.contains(o.center)){for(const it of y)Vm(S,S,it),jm(E,E,it);E[2]=0;const De=o.point,Xe=[De.x*c,De.y*c,0];return Vm(S,S,Xe),jm(E,E,Xe),new Ji(S,E)}const M=[p[12]*c,p[13]*c,p[14]*c],L=g.getCenter(),N=qe(o.center.lat,-Ti,Ti),z=qe(L.lat,-Ti,Ti),F=dl(o.center.lng),j=ml(N);let H=F-dl(L.lng);const ne=j-ml(z);H>.5?H-=1:H<-.5&&(H+=1);let he=0;Math.abs(H)>Math.abs(ne)?he=H>=0?1:3:(he=ne>=0?0:2,Gm(M,M,[p[4]*c,p[5]*c,p[6]*c],-Math.sin(He(ne>=0?g.getSouth():g.getNorth()))*fl));const re=y[he],ue=y[(he+1)%4],pe=new iR(re,ue,M),fe=[v1(pe,0)||re[0],v1(pe,1)||re[1],v1(pe,2)||re[2]],ke=dp(o.zoom);if(ke>0){const De=function({x:it,y:Be,z:Ke},Je,tt,lt,je){const mt=1/(1<<Ke);let Tt=it*mt,_t=Tt+mt,qt=Be*mt,ut=qt+mt,At=0;const Xt=(Tt+_t)/2-lt;return Xt>.5?At=-1:Xt<-.5&&(At=1),Tt=((Tt+At)*Je-(lt*=Je))*tt+lt,_t=((_t+At)*Je-lt)*tt+lt,qt=(qt*Je-(je*=Je))*tt+je,ut=(ut*Je-je)*tt+je,[[Tt,ut,0],[_t,ut,0],[_t,qt,0],[Tt,qt,0]]}(a,r,o._pixelsPerMercatorPixel,F,j);for(let it=0;it<y.length;it++)Oh(y[it],De[it],ke);const Xe=su([],De[he],De[(he+1)%4]);as(Xe,Xe,.5),Oh(fe,Xe,ke)}for(const De of y)Vm(S,S,De),jm(E,E,De);return S[2]=Math.min(re[2],ue[2]),Vm(S,S,fe),jm(E,E,fe),new Ji(S,E)}function Uy({x:o,y:r,z:a}){const c=1/(1<<a),p=new On(ls(o*c),Si((r+1)*c)),g=new On(ls((o+1)*c),Si(r*c));return new lc(p,g)}function x1(o){const r=He(o.getNorth()),a=He(o.getSouth()),c=Math.cos(r),p=Math.cos(a),g=Math.sin(r),y=Math.sin(a),x=o.getWest(),E=o.getEast();return[fp(p,y,x),fp(p,y,E),fp(c,g,E),fp(c,g,x)]}function fp(o,r,a,c=fl){return a=He(a),[o*Math.sin(a)*c,-r*c,o*Math.cos(a)*c]}function pp(o,r,a){return fp(Math.cos(He(o)),Math.sin(He(o)),r,a)}function Zm(o,r,a,c){const p=1<<a.z,g=(o/Rt+a.x)/p;return pp(Si((r/Rt+a.y)/p),ls(g),c)}function Vy({min:o,max:r}){return nR/Math.max(r[0]-o[0],r[1]-o[1],r[2]-o[2])}const wT=new Float64Array(16);function Wm(o){const r=Vy(o),a=iT(wT,[r,r,r]);return Bm(a,a,((c=[])[0]=-(p=o.min)[0],c[1]=-p[1],c[2]=-p[2],c));var c,p}function w1(o){const r=(c=o.min,(a=wT)[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=c[0],a[13]=c[1],a[14]=c[2],a[15]=1,a);var a,c;const p=1/Vy(o);return Rh(r,r,[p,p,p])}function bT(o,r,a,c,p){const g=function(E){const S=Rt/(2*Math.PI);return E/(2*Math.PI)/S}(a),y=[o,r,-a/(2*Math.PI)],x=Ia(new Float64Array(16));return Bm(x,x,y),Rh(x,x,[g,g,g]),h1(x,x,He(-p)),Fy(x,x,He(-c)),x}function dp(o){return Et(y1,_T,o)}function ET(o,r){const a=pp(r.lat,r.lng),c=function(F){const j=pp(F._center.lat,F._center.lng);let H=d1([],hp(0,1,0),j);const ne=oT([],-F.angle,j);H=wr(H,H,ne),oT(ne,-F._pitch,H);const he=Ki([],j);return as(he,he,By(F.cameraToCenterDistance/F.pixelsPerMeter)),wr(he,he,ne),su([],j,he)}(o);return y=(p=p1([],c,a))[0],x=p[1],E=p[2],S=(g=a)[0],M=g[1],L=g[2],z=(N=Math.sqrt(y*y+x*x+E*E)*Math.sqrt(S*S+M*M+L*L))&&Fs(p,g)/N,Math.acos(Math.min(Math.max(z,-1),1));var p,g,y,x,E,S,M,L,N,z}function b1(o,r){return ET(o,r)>Math.PI/2*1.01}const ST=He(85),sR=Math.cos(ST),aR=Math.sin(ST),Hm=63710088e-1,TT=2*Math.PI*Hm;class uc{constructor(r,a){if(isNaN(r)||isNaN(a))throw new Error(`Invalid LngLat object: (${r}, ${a})`);if(this.lng=+r,this.lat=+a,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new uc(Ct(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(r){const a=Math.PI/180,c=this.lat*a,p=r.lat*a,g=Math.sin(c)*Math.sin(p)+Math.cos(c)*Math.cos(p)*Math.cos((r.lng-this.lng)*a);return Hm*Math.acos(Math.min(g,1))}toBounds(r=0){const a=360*r/40075017,c=a/Math.cos(Math.PI/180*this.lat);return new lc(new uc(this.lng-c,this.lat-a),new uc(this.lng+c,this.lat+a))}toEcef(r){const a=By(r);return pp(this.lat,this.lng,fl+a)}static convert(r){if(r instanceof uc)return r;if(Array.isArray(r)&&(r.length===2||r.length===3))return new uc(Number(r[0]),Number(r[1]));if(!Array.isArray(r)&&typeof r=="object"&&r!==null)return new uc(Number("lng"in r?r.lng:r.lon),Number(r.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}var On=uc;function E1(o){return TT*Math.cos(o*Math.PI/180)}function dl(o){return(180+o)/360}function ml(o){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+o*Math.PI/360)))/360}function Aa(o,r){return o/E1(r)}function ls(o){return 360*o-180}function Si(o){return 360/Math.PI*Math.atan(Math.exp((180-360*o)*Math.PI/180))-90}function CT(o,r){return o*E1(Si(r))}const Ti=85.051129;function IT(o){return 1/Math.cos(o*Math.PI/180)}class mp{constructor(r,a,c=0){this.x=+r,this.y=+a,this.z=+c}static fromLngLat(r,a=0){const c=On.convert(r);return new mp(dl(c.lng),ml(c.lat),Aa(a,c.lat))}toLngLat(){return new On(ls(this.x),Si(this.y))}toAltitude(){return CT(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/TT*IT(Si(this.y))}}function S1(o,r,a,c,p,g,y,x,E){const S=(r+c)/2,M=(a+p)/2,L=new xe(S,M);x(L),function(N,z,F,j,H,ne){const he=F-H,re=j-ne;return Math.abs((j-z)*he-(F-N)*re)/Math.hypot(he,re)}(L.x,L.y,g.x,g.y,y.x,y.y)>=E?(S1(o,r,a,S,M,g,L,x,E),S1(o,S,M,c,p,L,y,x,E)):o.push(y)}function MT(o,r,a){let c=o[0],p=c.x,g=c.y;r(c);const y=[c];for(let x=1;x<o.length;x++){const E=o[x],{x:S,y:M}=E;r(E),S1(y,p,g,S,M,c,E,r,a),p=S,g=M,c=E}return y}function T1(o,r,a,c){if(c(r,a)){const p=r.add(a)._mult(.5);T1(o,r,p,c),T1(o,p,a,c)}else o.push(a)}function lR(o,r){let a=o[0];const c=[a];for(let p=1;p<o.length;p++){const g=o[p];T1(c,a,g,r),a=g}return c}const C1=Math.pow(2,14)-1,AT=-C1-1;function uR(o,r){const a=Math.round(o.x*r),c=Math.round(o.y*r);return o.x=qe(a,AT,C1),o.y=qe(c,AT,C1),(a<o.x||a>o.x+1||c<o.y||c>o.y+1)&&nr("Geometry exceeds allowed extent, reduce your vector tile buffer size"),o}function au(o,r,a){const c=o.loadGeometry(),p=o.extent,g=Rt/p;if(r&&a&&a.projection.isReprojectedInTileSpace){const y=1<<r.z,{scale:x,x:E,y:S,projection:M}=a,L=N=>{const z=ls((r.x+N.x/p)/y),F=Si((r.y+N.y/p)/y),j=M.project(z,F);N.x=(j.x*x-E)*p,N.y=(j.y*x-S)*p};for(let N=0;N<c.length;N++)if(o.type!==1)c[N]=MT(c[N],L,1);else{const z=[];for(const F of c[N])F.x<0||F.x>=p||F.y<0||F.y>=p||(L(F),z.push(F));c[N]=z}}for(const y of c)for(const x of y)uR(x,g);return c}function zh(o,r){return{type:o.type,id:o.id,properties:o.properties,geometry:r?au(o):[]}}function jy(o,r,a,c,p){o.emplaceBack(2*r+(c+1)/2,2*a+(p+1)/2)}function Gy(o,r,a){o.emplaceBack(r.x,r.y,r.z,a[0]*16384,a[1]*16384,a[2]*16384)}class I1{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(a=>a.id),this.index=r.index,this.hasPattern=!1,this.projection=r.projection,this.layoutVertexArray=new rt,this.indexArray=new It,this.segments=new Ar,this.programConfigurations=new Lh(r.layers,r.zoom),this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id)}populate(r,a,c,p){const g=this.layers[0],y=[];let x=null;g.type==="circle"&&(x=g.layout.get("circle-sort-key"));for(const{feature:S,id:M,index:L,sourceLayerIndex:N}of r){const z=this.layers[0]._featureFilter.needGeometry,F=zh(S,z);if(!this.layers[0]._featureFilter.filter(new P(this.zoom),F,c))continue;const j=x?x.evaluate(F,{},c):void 0,H={id:M,properties:S.properties,type:S.type,sourceLayerIndex:N,index:L,geometry:z?F.geometry:au(S,c,p),patterns:{},sortKey:j};y.push(H)}x&&y.sort((S,M)=>S.sortKey-M.sortKey);let E=null;p.projection.name==="globe"&&(this.globeExtVertexArray=new ot,E=p.projection);for(const S of y){const{geometry:M,index:L,sourceLayerIndex:N}=S,z=r[L].feature;this.addFeature(S,M,L,a.availableImages,c,E),a.featureIndex.insert(z,M,L,N,this.index)}}update(r,a,c,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,a,this.stateDependentLayers,c,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,HD.members),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=r.createVertexBuffer(this.globeExtVertexArray,YD.members))),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(r,a,c,p,g,y){for(const x of a)for(const E of x){const S=E.x,M=E.y;if(S<0||S>=Rt||M<0||M>=Rt)continue;if(y){const z=y.projectTilePoint(S,M,g),F=y.upVector(g,S,M),j=this.globeExtVertexArray;Gy(j,z,F),Gy(j,z,F),Gy(j,z,F),Gy(j,z,F)}const L=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,r.sortKey),N=L.vertexLength;jy(this.layoutVertexArray,S,M,-1,-1),jy(this.layoutVertexArray,S,M,1,-1),jy(this.layoutVertexArray,S,M,1,1),jy(this.layoutVertexArray,S,M,-1,1),this.indexArray.emplaceBack(N,N+1,N+2),this.indexArray.emplaceBack(N,N+2,N+3),L.vertexLength+=4,L.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,c,{},p,g)}}function PT(o,r){for(let a=0;a<o.length;a++)if(Fh(r,o[a]))return!0;for(let a=0;a<r.length;a++)if(Fh(o,r[a]))return!0;return!!M1(o,r)}function cR(o,r,a){return!!Fh(o,r)||!!A1(r,o,a)}function LT(o,r){if(o.length===1)return RT(r,o[0]);for(let a=0;a<r.length;a++){const c=r[a];for(let p=0;p<c.length;p++)if(Fh(o,c[p]))return!0}for(let a=0;a<o.length;a++)if(RT(r,o[a]))return!0;for(let a=0;a<r.length;a++)if(M1(o,r[a]))return!0;return!1}function hR(o,r,a){if(o.length>1){if(M1(o,r))return!0;for(let c=0;c<r.length;c++)if(A1(r[c],o,a))return!0}for(let c=0;c<o.length;c++)if(A1(o[c],r,a))return!0;return!1}function M1(o,r){if(o.length===0||r.length===0)return!1;for(let a=0;a<o.length-1;a++){const c=o[a],p=o[a+1];for(let g=0;g<r.length-1;g++)if(fR(c,p,r[g],r[g+1]))return!0}return!1}function fR(o,r,a,c){return Po(o,a,c)!==Po(r,a,c)&&Po(o,r,a)!==Po(o,r,c)}function A1(o,r,a){const c=a*a;if(r.length===1)return o.distSqr(r[0])<c;for(let p=1;p<r.length;p++)if(DT(o,r[p-1],r[p])<c)return!0;return!1}function DT(o,r,a){const c=r.distSqr(a);if(c===0)return o.distSqr(r);const p=((o.x-r.x)*(a.x-r.x)+(o.y-r.y)*(a.y-r.y))/c;return o.distSqr(p<0?r:p>1?a:a.sub(r)._mult(p)._add(r))}function RT(o,r){let a,c,p,g=!1;for(let y=0;y<o.length;y++){a=o[y];for(let x=0,E=a.length-1;x<a.length;E=x++)c=a[x],p=a[E],c.y>r.y!=p.y>r.y&&r.x<(p.x-c.x)*(r.y-c.y)/(p.y-c.y)+c.x&&(g=!g)}return g}function Fh(o,r){let a=!1;for(let c=0,p=o.length-1;c<o.length;p=c++){const g=o[c],y=o[p];g.y>r.y!=y.y>r.y&&r.x<(y.x-g.x)*(r.y-g.y)/(y.y-g.y)+g.x&&(a=!a)}return a}function NT(o,r,a,c,p){for(const y of o)if(r<=y.x&&a<=y.y&&c>=y.x&&p>=y.y)return!0;const g=[new xe(r,a),new xe(r,p),new xe(c,p),new xe(c,a)];if(o.length>2){for(const y of g)if(Fh(o,y))return!0}for(let y=0;y<o.length-1;y++)if(pR(o[y],o[y+1],g))return!0;return!1}function pR(o,r,a){const c=a[0],p=a[2];if(o.x<c.x&&r.x<c.x||o.x>p.x&&r.x>p.x||o.y<c.y&&r.y<c.y||o.y>p.y&&r.y>p.y)return!1;const g=Po(o,r,a[0]);return g!==Po(o,r,a[1])||g!==Po(o,r,a[2])||g!==Po(o,r,a[3])}function gp(o,r,a){const c=r.paint.get(o).value;return c.kind==="constant"?c.value:a.programConfigurations.get(r.id).getMaxValue(o)}function qy(o){return Math.sqrt(o[0]*o[0]+o[1]*o[1])}function kT(o,r,a,c,p){if(!r[0]&&!r[1])return o;const g=xe.convert(r)._mult(p);a==="viewport"&&g._rotate(-c);const y=[];for(let x=0;x<o.length;x++)y.push(o[x].sub(g));return y}function OT(o,r,a,c){const p=xe.convert(o)._mult(c);return r==="viewport"&&p._rotate(-a),p}bt(I1,"CircleBucket",{omit:["layers"]});const dR=new ae({"circle-sort-key":new K(Ge.layout_circle["circle-sort-key"])});var mR={paint:new ae({"circle-radius":new K(Ge.paint_circle["circle-radius"]),"circle-color":new K(Ge.paint_circle["circle-color"]),"circle-blur":new K(Ge.paint_circle["circle-blur"]),"circle-opacity":new K(Ge.paint_circle["circle-opacity"]),"circle-translate":new V(Ge.paint_circle["circle-translate"]),"circle-translate-anchor":new V(Ge.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new V(Ge.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new V(Ge.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new K(Ge.paint_circle["circle-stroke-width"]),"circle-stroke-color":new K(Ge.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new K(Ge.paint_circle["circle-stroke-opacity"])}),layout:dR};function zT(o,r,a,c,p,g,y,x,E){if(g&&o.queryGeometry.isAboveHorizon)return!1;g&&(E*=o.pixelToTileUnitsFactor);const S=o.tileID.canonical,M=a.projection.upVectorScale(S,a.center.lat,a.worldSize).metersToTile;for(const L of r)for(const N of L){const z=N.add(x),F=p&&a.elevation?a.elevation.exaggeration()*p.getElevationAt(z.x,z.y,!0):0,j=a.projection.projectTilePoint(z.x,z.y,S);if(F>0){const re=a.projection.upVector(S,z.x,z.y);j.x+=re[0]*M*F,j.y+=re[1]*M*F,j.z+=re[2]*M*F}const H=g?z:gR(j.x,j.y,j.z,c),ne=g?o.tilespaceRays.map(re=>yR(re,F)):o.queryGeometry.screenGeometry,he=Nh([],[j.x,j.y,j.z,1],c);if(!y&&g?E*=he[3]/a.cameraToCenterDistance:y&&!g&&(E*=a.cameraToCenterDistance/he[3]),g){const re=Si((N.y/Rt+S.y)/(1<<S.z));E/=a.projection.pixelsPerMeter(re,1)/Aa(1,re)}if(cR(ne,H,E))return!0}return!1}function gR(o,r,a,c){const p=Nh([],[o,r,a,1],c);return new xe(p[0]/p[3],p[1]/p[3])}const FT=hp(0,0,0),_R=hp(0,0,1);function yR(o,r){const a=f1();return FT[2]=r,o.intersectsPlane(FT,_R,a),new xe(a[0],a[1])}class BT extends I1{}function UT(o,{width:r,height:a},c,p){if(p){if(p instanceof Uint8ClampedArray)p=new Uint8Array(p.buffer);else if(p.length!==r*a*c)throw new RangeError("mismatched image size")}else p=new Uint8Array(r*a*c);return o.width=r,o.height=a,o.data=p,o}function VT(o,r,a){const{width:c,height:p}=r;c===o.width&&p===o.height||(P1(o,r,{x:0,y:0},{x:0,y:0},{width:Math.min(o.width,c),height:Math.min(o.height,p)},a),o.width=c,o.height=p,o.data=r.data)}function P1(o,r,a,c,p,g){if(p.width===0||p.height===0)return r;if(p.width>o.width||p.height>o.height||a.x>o.width-p.width||a.y>o.height-p.height)throw new RangeError("out of range source coordinates for image copy");if(p.width>r.width||p.height>r.height||c.x>r.width-p.width||c.y>r.height-p.height)throw new RangeError("out of range destination coordinates for image copy");const y=o.data,x=r.data;for(let E=0;E<p.height;E++){const S=((a.y+E)*o.width+a.x)*g,M=((c.y+E)*r.width+c.x)*g;for(let L=0;L<p.width*g;L++)x[M+L]=y[S+L]}return r}bt(BT,"HeatmapBucket",{omit:["layers"]});class lu{constructor(r,a){UT(this,r,1,a)}resize(r){VT(this,new lu(r),1)}clone(){return new lu({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(r,a,c,p,g){P1(r,a,c,p,g,1)}}class Fo{constructor(r,a){UT(this,r,4,a)}resize(r){VT(this,new Fo(r),4)}replace(r,a){a?this.data.set(r):this.data=r instanceof Uint8ClampedArray?new Uint8Array(r.buffer):r}clone(){return new Fo({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(r,a,c,p,g){P1(r,a,c,p,g,4)}}bt(lu,"AlphaImage"),bt(Fo,"RGBAImage");var vR={paint:new ae({"heatmap-radius":new K(Ge.paint_heatmap["heatmap-radius"]),"heatmap-weight":new K(Ge.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new V(Ge.paint_heatmap["heatmap-intensity"]),"heatmap-color":new se(Ge.paint_heatmap["heatmap-color"]),"heatmap-opacity":new V(Ge.paint_heatmap["heatmap-opacity"])})};function L1(o){const r={},a=o.resolution||256,c=o.clips?o.clips.length:1,p=o.image||new Fo({width:a,height:c}),g=(y,x,E)=>{r[o.evaluationKey]=E;const S=o.expression.evaluate(r);p.data[y+x+0]=Math.floor(255*S.r/S.a),p.data[y+x+1]=Math.floor(255*S.g/S.a),p.data[y+x+2]=Math.floor(255*S.b/S.a),p.data[y+x+3]=Math.floor(255*S.a)};if(o.clips)for(let y=0,x=0;y<c;++y,x+=4*a)for(let E=0,S=0;E<a;E++,S+=4){const M=E/(a-1),{start:L,end:N}=o.clips[y];g(x,S,L*(1-M)+N*M)}else for(let y=0,x=0;y<a;y++,x+=4)g(0,x,y/(a-1));return p}var xR={paint:new ae({"hillshade-illumination-direction":new V(Ge.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new V(Ge.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new V(Ge.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new V(Ge.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new V(Ge.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new V(Ge.paint_hillshade["hillshade-accent-color"])})};const wR=Ce([{name:"a_pos",components:2,type:"Int16"}],4),{members:bR}=wR;var D1={exports:{}};function Xy(o,r,a){a=a||2;var c,p,g,y,x,E,S,M=r&&r.length,L=M?r[0]*a:o.length,N=jT(o,0,L,a,!0),z=[];if(!N||N.next===N.prev)return z;if(M&&(N=function(j,H,ne,he){var re,ue,pe,fe=[];for(re=0,ue=H.length;re<ue;re++)(pe=jT(j,H[re]*he,re<ue-1?H[re+1]*he:j.length,he,!1))===pe.next&&(pe.steiner=!0),fe.push(PR(pe));for(fe.sort(IR),re=0;re<fe.length;re++)ne=MR(fe[re],ne);return ne}(o,r,N,a)),o.length>80*a){c=g=o[0],p=y=o[1];for(var F=a;F<L;F+=a)(x=o[F])<c&&(c=x),(E=o[F+1])<p&&(p=E),x>g&&(g=x),E>y&&(y=E);S=(S=Math.max(g-c,y-p))!==0?32767/S:0}return Ym(N,z,a,c,p,S,0),z}function jT(o,r,a,c,p){var g,y;if(p===k1(o,r,a,c)>0)for(g=r;g<a;g+=c)y=XT(g,o[g],o[g+1],y);else for(g=a-c;g>=r;g-=c)y=XT(g,o[g],o[g+1],y);return y&&$y(y,y.next)&&(Jm(y),y=y.next),y}function Bh(o,r){if(!o)return o;r||(r=o);var a,c=o;do if(a=!1,c.steiner||!$y(c,c.next)&&Pr(c.prev,c,c.next)!==0)c=c.next;else{if(Jm(c),(c=r=c.prev)===c.next)break;a=!0}while(a||c!==r);return r}function Ym(o,r,a,c,p,g,y){if(o){!y&&g&&function(M,L,N,z){var F=M;do F.z===0&&(F.z=R1(F.x,F.y,L,N,z)),F.prevZ=F.prev,F.nextZ=F.next,F=F.next;while(F!==M);F.prevZ.nextZ=null,F.prevZ=null,function(j){var H,ne,he,re,ue,pe,fe,ke,De=1;do{for(ne=j,j=null,ue=null,pe=0;ne;){for(pe++,he=ne,fe=0,H=0;H<De&&(fe++,he=he.nextZ);H++);for(ke=De;fe>0||ke>0&&he;)fe!==0&&(ke===0||!he||ne.z<=he.z)?(re=ne,ne=ne.nextZ,fe--):(re=he,he=he.nextZ,ke--),ue?ue.nextZ=re:j=re,re.prevZ=ue,ue=re;ne=he}ue.nextZ=null,De*=2}while(pe>1)}(F)}(o,c,p,g);for(var x,E,S=o;o.prev!==o.next;)if(x=o.prev,E=o.next,g?SR(o,c,p,g):ER(o))r.push(x.i/a|0),r.push(o.i/a|0),r.push(E.i/a|0),Jm(o),o=E.next,S=E.next;else if((o=E)===S){y?y===1?Ym(o=TR(Bh(o),r,a),r,a,c,p,g,2):y===2&&CR(o,r,a,c,p,g):Ym(Bh(o),r,a,c,p,g,1);break}}}function ER(o){var r=o.prev,a=o,c=o.next;if(Pr(r,a,c)>=0)return!1;for(var p=r.x,g=a.x,y=c.x,x=r.y,E=a.y,S=c.y,M=p<g?p<y?p:y:g<y?g:y,L=x<E?x<S?x:S:E<S?E:S,N=p>g?p>y?p:y:g>y?g:y,z=x>E?x>S?x:S:E>S?E:S,F=c.next;F!==r;){if(F.x>=M&&F.x<=N&&F.y>=L&&F.y<=z&&_p(p,x,g,E,y,S,F.x,F.y)&&Pr(F.prev,F,F.next)>=0)return!1;F=F.next}return!0}function SR(o,r,a,c){var p=o.prev,g=o,y=o.next;if(Pr(p,g,y)>=0)return!1;for(var x=p.x,E=g.x,S=y.x,M=p.y,L=g.y,N=y.y,z=x<E?x<S?x:S:E<S?E:S,F=M<L?M<N?M:N:L<N?L:N,j=x>E?x>S?x:S:E>S?E:S,H=M>L?M>N?M:N:L>N?L:N,ne=R1(z,F,r,a,c),he=R1(j,H,r,a,c),re=o.prevZ,ue=o.nextZ;re&&re.z>=ne&&ue&&ue.z<=he;){if(re.x>=z&&re.x<=j&&re.y>=F&&re.y<=H&&re!==p&&re!==y&&_p(x,M,E,L,S,N,re.x,re.y)&&Pr(re.prev,re,re.next)>=0||(re=re.prevZ,ue.x>=z&&ue.x<=j&&ue.y>=F&&ue.y<=H&&ue!==p&&ue!==y&&_p(x,M,E,L,S,N,ue.x,ue.y)&&Pr(ue.prev,ue,ue.next)>=0))return!1;ue=ue.nextZ}for(;re&&re.z>=ne;){if(re.x>=z&&re.x<=j&&re.y>=F&&re.y<=H&&re!==p&&re!==y&&_p(x,M,E,L,S,N,re.x,re.y)&&Pr(re.prev,re,re.next)>=0)return!1;re=re.prevZ}for(;ue&&ue.z<=he;){if(ue.x>=z&&ue.x<=j&&ue.y>=F&&ue.y<=H&&ue!==p&&ue!==y&&_p(x,M,E,L,S,N,ue.x,ue.y)&&Pr(ue.prev,ue,ue.next)>=0)return!1;ue=ue.nextZ}return!0}function TR(o,r,a){var c=o;do{var p=c.prev,g=c.next.next;!$y(p,g)&&GT(p,c,c.next,g)&&Km(p,g)&&Km(g,p)&&(r.push(p.i/a|0),r.push(c.i/a|0),r.push(g.i/a|0),Jm(c),Jm(c.next),c=o=g),c=c.next}while(c!==o);return Bh(c)}function CR(o,r,a,c,p,g){var y=o;do{for(var x=y.next.next;x!==y.prev;){if(y.i!==x.i&&LR(y,x)){var E=qT(y,x);return y=Bh(y,y.next),E=Bh(E,E.next),Ym(y,r,a,c,p,g,0),void Ym(E,r,a,c,p,g,0)}x=x.next}y=y.next}while(y!==o)}function IR(o,r){return o.x-r.x}function MR(o,r){var a=function(p,g){var y,x=g,E=p.x,S=p.y,M=-1/0;do{if(S<=x.y&&S>=x.next.y&&x.next.y!==x.y){var L=x.x+(S-x.y)*(x.next.x-x.x)/(x.next.y-x.y);if(L<=E&&L>M&&(M=L,y=x.x<x.next.x?x:x.next,L===E))return y}x=x.next}while(x!==g);if(!y)return null;var N,z=y,F=y.x,j=y.y,H=1/0;x=y;do E>=x.x&&x.x>=F&&E!==x.x&&_p(S<j?E:M,S,F,j,S<j?M:E,S,x.x,x.y)&&(N=Math.abs(S-x.y)/(E-x.x),Km(x,p)&&(N<H||N===H&&(x.x>y.x||x.x===y.x&&AR(y,x)))&&(y=x,H=N)),x=x.next;while(x!==z);return y}(o,r);if(!a)return r;var c=qT(a,o);return Bh(c,c.next),Bh(a,a.next)}function AR(o,r){return Pr(o.prev,o,r.prev)<0&&Pr(r.next,o,o.next)<0}function R1(o,r,a,c,p){return(o=1431655765&((o=858993459&((o=252645135&((o=16711935&((o=(o-a)*p|0)|o<<8))|o<<4))|o<<2))|o<<1))|(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=(r-c)*p|0)|r<<8))|r<<4))|r<<2))|r<<1))<<1}function PR(o){var r=o,a=o;do(r.x<a.x||r.x===a.x&&r.y<a.y)&&(a=r),r=r.next;while(r!==o);return a}function _p(o,r,a,c,p,g,y,x){return(p-y)*(r-x)>=(o-y)*(g-x)&&(o-y)*(c-x)>=(a-y)*(r-x)&&(a-y)*(g-x)>=(p-y)*(c-x)}function LR(o,r){return o.next.i!==r.i&&o.prev.i!==r.i&&!function(a,c){var p=a;do{if(p.i!==a.i&&p.next.i!==a.i&&p.i!==c.i&&p.next.i!==c.i&&GT(p,p.next,a,c))return!0;p=p.next}while(p!==a);return!1}(o,r)&&(Km(o,r)&&Km(r,o)&&function(a,c){var p=a,g=!1,y=(a.x+c.x)/2,x=(a.y+c.y)/2;do p.y>x!=p.next.y>x&&p.next.y!==p.y&&y<(p.next.x-p.x)*(x-p.y)/(p.next.y-p.y)+p.x&&(g=!g),p=p.next;while(p!==a);return g}(o,r)&&(Pr(o.prev,o,r.prev)||Pr(o,r.prev,r))||$y(o,r)&&Pr(o.prev,o,o.next)>0&&Pr(r.prev,r,r.next)>0)}function Pr(o,r,a){return(r.y-o.y)*(a.x-r.x)-(r.x-o.x)*(a.y-r.y)}function $y(o,r){return o.x===r.x&&o.y===r.y}function GT(o,r,a,c){var p=Wy(Pr(o,r,a)),g=Wy(Pr(o,r,c)),y=Wy(Pr(a,c,o)),x=Wy(Pr(a,c,r));return p!==g&&y!==x||!(p!==0||!Zy(o,a,r))||!(g!==0||!Zy(o,c,r))||!(y!==0||!Zy(a,o,c))||!(x!==0||!Zy(a,r,c))}function Zy(o,r,a){return r.x<=Math.max(o.x,a.x)&&r.x>=Math.min(o.x,a.x)&&r.y<=Math.max(o.y,a.y)&&r.y>=Math.min(o.y,a.y)}function Wy(o){return o>0?1:o<0?-1:0}function Km(o,r){return Pr(o.prev,o,o.next)<0?Pr(o,r,o.next)>=0&&Pr(o,o.prev,r)>=0:Pr(o,r,o.prev)<0||Pr(o,o.next,r)<0}function qT(o,r){var a=new N1(o.i,o.x,o.y),c=new N1(r.i,r.x,r.y),p=o.next,g=r.prev;return o.next=r,r.prev=o,a.next=p,p.prev=a,c.next=a,a.prev=c,g.next=c,c.prev=g,c}function XT(o,r,a,c){var p=new N1(o,r,a);return c?(p.next=c.next,p.prev=c,c.next.prev=p,c.next=p):(p.prev=p,p.next=p),p}function Jm(o){o.next.prev=o.prev,o.prev.next=o.next,o.prevZ&&(o.prevZ.nextZ=o.nextZ),o.nextZ&&(o.nextZ.prevZ=o.prevZ)}function N1(o,r,a){this.i=o,this.x=r,this.y=a,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function k1(o,r,a,c){for(var p=0,g=r,y=a-c;g<a;g+=c)p+=(o[y]-o[g])*(o[g+1]+o[y+1]),y=g;return p}D1.exports=Xy,D1.exports.default=Xy,Xy.deviation=function(o,r,a,c){var p=r&&r.length,g=Math.abs(k1(o,0,p?r[0]*a:o.length,a));if(p)for(var y=0,x=r.length;y<x;y++)g-=Math.abs(k1(o,r[y]*a,y<x-1?r[y+1]*a:o.length,a));var E=0;for(y=0;y<c.length;y+=3){var S=c[y]*a,M=c[y+1]*a,L=c[y+2]*a;E+=Math.abs((o[S]-o[L])*(o[M+1]-o[S+1])-(o[S]-o[M])*(o[L+1]-o[S+1]))}return g===0&&E===0?0:Math.abs((E-g)/g)},Xy.flatten=function(o){for(var r=o[0][0].length,a={vertices:[],holes:[],dimensions:r},c=0,p=0;p<o.length;p++){for(var g=0;g<o[p].length;g++)for(var y=0;y<r;y++)a.vertices.push(o[p][g][y]);p>0&&a.holes.push(c+=o[p-1].length)}return a};var O1=q(D1.exports);function DR(o,r,a,c,p){$T(o,r,a||0,c||o.length-1,p||RR)}function $T(o,r,a,c,p){for(;c>a;){if(c-a>600){var g=c-a+1,y=r-a+1,x=Math.log(g),E=.5*Math.exp(2*x/3),S=.5*Math.sqrt(x*E*(g-E)/g)*(y-g/2<0?-1:1);$T(o,r,Math.max(a,Math.floor(r-y*E/g+S)),Math.min(c,Math.floor(r+(g-y)*E/g+S)),p)}var M=o[r],L=a,N=c;for(Qm(o,a,r),p(o[c],M)>0&&Qm(o,a,c);L<N;){for(Qm(o,L,N),L++,N--;p(o[L],M)<0;)L++;for(;p(o[N],M)>0;)N--}p(o[a],M)===0?Qm(o,a,N):Qm(o,++N,c),N<=r&&(a=N+1),r<=N&&(c=N-1)}}function Qm(o,r,a){var c=o[r];o[r]=o[a],o[a]=c}function RR(o,r){return o<r?-1:o>r?1:0}function z1(o,r){const a=o.length;if(a<=1)return[o];const c=[];let p,g;for(let y=0;y<a;y++){const x=Pf(o[y]);x!==0&&(o[y].area=Math.abs(x),g===void 0&&(g=x<0),g===x<0?(p&&c.push(p),p=[o[y]]):p.push(o[y]))}if(p&&c.push(p),r>1)for(let y=0;y<c.length;y++)c[y].length<=r||(DR(c[y],r,1,c[y].length-1,NR),c[y]=c[y].slice(0,r));return c}function NR(o,r){return r.area-o.area}function F1(o,r,a){const c=a.patternDependencies;let p=!1;for(const g of r){const y=g.paint.get(`${o}-pattern`);y.isConstant()||(p=!0);const x=y.constantOr(null);x&&(p=!0,c[x]=!0)}return p}function B1(o,r,a,c,p){const g=p.patternDependencies;for(const y of r){const x=y.paint.get(`${o}-pattern`).value;if(x.kind!=="constant"){let E=x.evaluate({zoom:c},a,{},p.availableImages);E=E&&E.name?E.name:E,g[E]=!0,a.patterns[y.id]=E}}return a}class Hy{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(a=>a.id),this.index=r.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new rt,this.indexArray=new It,this.indexArray2=new ti,this.programConfigurations=new Lh(r.layers,r.zoom),this.segments=new Ar,this.segments2=new Ar,this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id),this.projection=r.projection}populate(r,a,c,p){this.hasPattern=F1("fill",this.layers,a);const g=this.layers[0].layout.get("fill-sort-key"),y=[];for(const{feature:x,id:E,index:S,sourceLayerIndex:M}of r){const L=this.layers[0]._featureFilter.needGeometry,N=zh(x,L);if(!this.layers[0]._featureFilter.filter(new P(this.zoom),N,c))continue;const z=g?g.evaluate(N,{},c,a.availableImages):void 0,F={id:E,properties:x.properties,type:x.type,sourceLayerIndex:M,index:S,geometry:L?N.geometry:au(x,c,p),patterns:{},sortKey:z};y.push(F)}g&&y.sort((x,E)=>x.sortKey-E.sortKey);for(const x of y){const{geometry:E,index:S,sourceLayerIndex:M}=x;if(this.hasPattern){const L=B1("fill",this.layers,x,this.zoom,a);this.patternFeatures.push(L)}else this.addFeature(x,E,S,c,{},a.availableImages);a.featureIndex.insert(r[S].feature,E,S,M,this.index)}}update(r,a,c,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,a,this.stateDependentLayers,c,p)}addFeatures(r,a,c,p,g){for(const y of this.patternFeatures)this.addFeature(y,y.geometry,y.index,a,c,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,bR),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.indexBuffer2=r.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(r,a,c,p,g,y=[]){for(const x of z1(a,500)){let E=0;for(const F of x)E+=F.length;const S=this.segments.prepareSegment(E,this.layoutVertexArray,this.indexArray),M=S.vertexLength,L=[],N=[];for(const F of x){if(F.length===0)continue;F!==x[0]&&N.push(L.length/2);const j=this.segments2.prepareSegment(F.length,this.layoutVertexArray,this.indexArray2),H=j.vertexLength;this.layoutVertexArray.emplaceBack(F[0].x,F[0].y),this.indexArray2.emplaceBack(H+F.length-1,H),L.push(F[0].x),L.push(F[0].y);for(let ne=1;ne<F.length;ne++)this.layoutVertexArray.emplaceBack(F[ne].x,F[ne].y),this.indexArray2.emplaceBack(H+ne-1,H+ne),L.push(F[ne].x),L.push(F[ne].y);j.vertexLength+=F.length,j.primitiveLength+=F.length}const z=O1(L,N);for(let F=0;F<z.length;F+=3)this.indexArray.emplaceBack(M+z[F],M+z[F+1],M+z[F+2]);S.vertexLength+=E,S.primitiveLength+=z.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,c,g,y,p)}}bt(Hy,"FillBucket",{omit:["layers","patternFeatures"]});const kR=new ae({"fill-sort-key":new K(Ge.layout_fill["fill-sort-key"])});var OR={paint:new ae({"fill-antialias":new V(Ge.paint_fill["fill-antialias"]),"fill-opacity":new K(Ge.paint_fill["fill-opacity"]),"fill-color":new K(Ge.paint_fill["fill-color"]),"fill-outline-color":new K(Ge.paint_fill["fill-outline-color"]),"fill-translate":new V(Ge.paint_fill["fill-translate"]),"fill-translate-anchor":new V(Ge.paint_fill["fill-translate-anchor"]),"fill-pattern":new K(Ge.paint_fill["fill-pattern"])}),layout:kR};const zR=Ce([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),FR=Ce([{name:"a_centroid_pos",components:2,type:"Uint16"}]),BR=Ce([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:UR}=zR;var Yy={},VR=Se,ZT=yp;function yp(o,r,a,c,p){this.properties={},this.extent=a,this.type=0,this._pbf=o,this._geometry=-1,this._keys=c,this._values=p,o.readFields(jR,this,r)}function jR(o,r,a){o==1?r.id=a.readVarint():o==2?function(c,p){for(var g=c.readVarint()+c.pos;c.pos<g;){var y=p._keys[c.readVarint()],x=p._values[c.readVarint()];p.properties[y]=x}}(a,r):o==3?r.type=a.readVarint():o==4&&(r._geometry=a.pos)}function GR(o){for(var r,a,c=0,p=0,g=o.length,y=g-1;p<g;y=p++)c+=((a=o[y]).x-(r=o[p]).x)*(r.y+a.y);return c}yp.types=["Unknown","Point","LineString","Polygon"],yp.prototype.loadGeometry=function(){var o=this._pbf;o.pos=this._geometry;for(var r,a=o.readVarint()+o.pos,c=1,p=0,g=0,y=0,x=[];o.pos<a;){if(p<=0){var E=o.readVarint();c=7&E,p=E>>3}if(p--,c===1||c===2)g+=o.readSVarint(),y+=o.readSVarint(),c===1&&(r&&x.push(r),r=[]),r.push(new VR(g,y));else{if(c!==7)throw new Error("unknown command "+c);r&&r.push(r[0].clone())}}return r&&x.push(r),x},yp.prototype.bbox=function(){var o=this._pbf;o.pos=this._geometry;for(var r=o.readVarint()+o.pos,a=1,c=0,p=0,g=0,y=1/0,x=-1/0,E=1/0,S=-1/0;o.pos<r;){if(c<=0){var M=o.readVarint();a=7&M,c=M>>3}if(c--,a===1||a===2)(p+=o.readSVarint())<y&&(y=p),p>x&&(x=p),(g+=o.readSVarint())<E&&(E=g),g>S&&(S=g);else if(a!==7)throw new Error("unknown command "+a)}return[y,E,x,S]},yp.prototype.toGeoJSON=function(o,r,a){var c,p,g=this.extent*Math.pow(2,a),y=this.extent*o,x=this.extent*r,E=this.loadGeometry(),S=yp.types[this.type];function M(z){for(var F=0;F<z.length;F++){var j=z[F];z[F]=[360*(j.x+y)/g-180,360/Math.PI*Math.atan(Math.exp((180-360*(j.y+x)/g)*Math.PI/180))-90]}}switch(this.type){case 1:var L=[];for(c=0;c<E.length;c++)L[c]=E[c][0];M(E=L);break;case 2:for(c=0;c<E.length;c++)M(E[c]);break;case 3:for(E=function(z){var F=z.length;if(F<=1)return[z];for(var j,H,ne=[],he=0;he<F;he++){var re=GR(z[he]);re!==0&&(H===void 0&&(H=re<0),H===re<0?(j&&ne.push(j),j=[z[he]]):j.push(z[he]))}return j&&ne.push(j),ne}(E),c=0;c<E.length;c++)for(p=0;p<E[c].length;p++)M(E[c][p])}E.length===1?E=E[0]:S="Multi"+S;var N={type:"Feature",geometry:{type:S,coordinates:E},properties:this.properties};return"id"in this&&(N.id=this.id),N};var qR=ZT,WT=HT;function HT(o,r){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=o,this._keys=[],this._values=[],this._features=[],o.readFields(XR,this,r),this.length=this._features.length}function XR(o,r,a){o===15?r.version=a.readVarint():o===1?r.name=a.readString():o===5?r.extent=a.readVarint():o===2?r._features.push(a.pos):o===3?r._keys.push(a.readString()):o===4&&r._values.push(function(c){for(var p=null,g=c.readVarint()+c.pos;c.pos<g;){var y=c.readVarint()>>3;p=y===1?c.readString():y===2?c.readFloat():y===3?c.readDouble():y===4?c.readVarint64():y===5?c.readVarint():y===6?c.readSVarint():y===7?c.readBoolean():null}return p}(a))}HT.prototype.feature=function(o){if(o<0||o>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[o];var r=this._pbf.readVarint()+this._pbf.pos;return new qR(this._pbf,r,this.extent,this._keys,this._values)};var $R=WT;function ZR(o,r,a){if(o===3){var c=new $R(a,a.readVarint()+a.pos);c.length&&(r[c.name]=c)}}var U1=Yy.VectorTile=function(o,r){this.layers=o.readFields(ZR,{},r)},Ky=Yy.VectorTileFeature=ZT;function Jy(o,r,a,c){const p=[],g=c===0?(y,x,E,S,M,L)=>{y.push(new xe(L,E+(L-x)/(S-x)*(M-E)))}:(y,x,E,S,M,L)=>{y.push(new xe(x+(L-E)/(M-E)*(S-x),L))};for(const y of o){const x=[];for(const E of y){if(E.length<=2)continue;const S=[];for(let N=0;N<E.length-1;N++){const z=E[N].x,F=E[N].y,j=E[N+1].x,H=E[N+1].y,ne=c===0?z:F,he=c===0?j:H;ne<r?he>r&&g(S,z,F,j,H,r):ne>a?he<a&&g(S,z,F,j,H,a):S.push(E[N]),he<r&&ne>=r&&g(S,z,F,j,H,r),he>a&&ne<=a&&g(S,z,F,j,H,a)}let M=E[E.length-1];const L=c===0?M.x:M.y;L>=r&&L<=a&&S.push(M),S.length&&(M=S[S.length-1],S[0].x===M.x&&S[0].y===M.y||S.push(S[0]),x.push(S))}x.length&&p.push(x)}return p}Yy.VectorTileLayer=WT;const WR=Ky.types,HR=Math.pow(2,13);function eg(o,r,a,c,p,g,y,x){o.emplaceBack((r<<1)+y,(a<<1)+g,(Math.floor(c*HR)<<1)+p,Math.round(x))}function tg(o,r,a){o.emplaceBack(r.x,r.y,r.z,a[0]*16384,a[1]*16384,a[2]*16384)}class YT{constructor(){this.acc=new xe(0,0),this.polyCount=[]}startRing(r){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new xe(r.x,r.y),this.max=new xe(r.x,r.y))}append(r,a){this.currentPolyCount.edges++,this.acc._add(r);const c=this.min,p=this.max;r.x<c.x?c.x=r.x:r.x>p.x&&(p.x=r.x),r.y<c.y?c.y=r.y:r.y>p.y&&(p.y=r.y),((r.x===0||r.x===Rt)&&r.x===a.x)!=((r.y===0||r.y===Rt)&&r.y===a.y)&&this.processBorderOverlap(r,a),a.x<0!=r.x<0&&this.addBorderIntersection(0,mn(a.y,r.y,(0-a.x)/(r.x-a.x))),a.x>Rt!=r.x>Rt&&this.addBorderIntersection(1,mn(a.y,r.y,(Rt-a.x)/(r.x-a.x))),a.y<0!=r.y<0&&this.addBorderIntersection(2,mn(a.x,r.x,(0-a.y)/(r.y-a.y))),a.y>Rt!=r.y>Rt&&this.addBorderIntersection(3,mn(a.x,r.x,(Rt-a.y)/(r.y-a.y)))}addBorderIntersection(r,a){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const c=this.borders[r];a<c[0]&&(c[0]=a),a>c[1]&&(c[1]=a)}processBorderOverlap(r,a){if(r.x===a.x){if(r.y===a.y)return;const c=r.x===0?0:1;this.addBorderIntersection(c,a.y),this.addBorderIntersection(c,r.y)}else{const c=r.y===0?2:3;this.addBorderIntersection(c,a.x),this.addBorderIntersection(c,r.x)}}centroid(){const r=this.polyCount.reduce((a,c)=>a+c.edges,0);return r!==0?this.acc.div(r)._round():new xe(0,0)}span(){return new xe(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((r,a)=>r+ +(a[0]!==Number.MAX_VALUE),0)}}class ng{constructor(r){this.zoom=r.zoom,this.canonical=r.canonical,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(a=>a.id),this.index=r.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=r.projection,this.layoutVertexArray=new Ye,this.centroidVertexArray=new Sa,this.indexArray=new It,this.programConfigurations=new Lh(r.layers,r.zoom),this.segments=new Ar,this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id),this.enableTerrain=r.enableTerrain}populate(r,a,c,p){this.features=[],this.hasPattern=F1("fill-extrusion",this.layers,a),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(g){const y=Math.exp(Math.PI*(1-g.y/(1<<g.z)*2));return 80150034*y/(y*y+1)/Rt/(1<<g.z)}(c),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:g,id:y,index:x,sourceLayerIndex:E}of r){const S=this.layers[0]._featureFilter.needGeometry,M=zh(g,S);if(!this.layers[0]._featureFilter.filter(new P(this.zoom),M,c))continue;const L={id:y,sourceLayerIndex:E,index:x,geometry:S?M.geometry:au(g,c,p),properties:g.properties,type:g.type,patterns:{}},N=this.layoutVertexArray.length;this.hasPattern?this.features.push(B1("fill-extrusion",this.layers,L,this.zoom,a)):this.addFeature(L,L.geometry,x,c,{},a.availableImages,p),a.featureIndex.insert(g,L.geometry,x,E,this.index,N)}this.sortBorders()}addFeatures(r,a,c,p,g){for(const y of this.features){const{geometry:x}=y;this.addFeature(y,x,y.index,a,c,p,g)}this.sortBorders()}update(r,a,c,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,a,this.stateDependentLayers,c,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,UR),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=r.createVertexBuffer(this.layoutVertexExtArray,BR.members,!0))),this.programConfigurations.upload(r),this.uploaded=!0}uploadCentroid(r){this.centroidVertexArray.length!==0&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=r.createVertexBuffer(this.centroidVertexArray,FR.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(r,a,c,p,g,y,x){const E=[new xe(0,0),new xe(Rt,Rt)],S=x.projection,M=S.name==="globe",L=this.enableTerrain&&!M?new YT:null,N=WR[r.type]==="Polygon";M&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new ot);const z=z1(a,500);for(let ne=z.length-1;ne>=0;ne--){const he=z[ne];(he.length===0||(F=he[0]).every(re=>re.x<=0)||F.every(re=>re.x>=Rt)||F.every(re=>re.y<=0)||F.every(re=>re.y>=Rt))&&z.splice(ne,1)}var F;let j;if(M)j=rC(z,E,p);else{j=[];for(const ne of z)j.push({polygon:ne,bounds:E})}const H=N?this.edgeRadius:0;for(const{polygon:ne,bounds:he}of j){let re=0,ue=0;for(const fe of ne)N&&!fe[0].equals(fe[fe.length-1])&&fe.push(fe[0]),ue+=N?fe.length-1:fe.length;const pe=this.segments.prepareSegment((N?5:4)*ue,this.layoutVertexArray,this.indexArray);if(N){const fe=[],ke=[];re=pe.vertexLength;for(const Xe of ne){let it,Be;Xe.length&&Xe!==ne[0]&&ke.push(fe.length/2),it=Xe[1].sub(Xe[0])._perp()._unit();for(let Ke=1;Ke<Xe.length;Ke++){const Je=Xe[Ke],tt=Xe[Ke===Xe.length-1?1:Ke+1];let{x:lt,y:je}=Je;if(H){Be=tt.sub(Je)._perp()._unit();const mt=it.add(Be)._unit(),Tt=H*Math.min(4,1/(it.x*mt.x+it.y*mt.y));lt+=Tt*mt.x,je+=Tt*mt.y,it=Be}eg(this.layoutVertexArray,lt,je,0,0,1,1,0),pe.vertexLength++,fe.push(Je.x,Je.y),M&&tg(this.layoutVertexExtArray,S.projectTilePoint(lt,je,p),S.upVector(p,lt,je))}}const De=O1(fe,ke);for(let Xe=0;Xe<De.length;Xe+=3)this.indexArray.emplaceBack(re+De[Xe],re+De[Xe+2],re+De[Xe+1]),pe.primitiveLength++}for(const fe of ne){L&&fe.length&&L.startRing(fe[0]);let ke,De,Xe,it=fe.length>4&&eC(fe[fe.length-2],fe[0],fe[1]),Be=H?YR(fe[fe.length-2],fe[0],fe[1],H):0;De=fe[1].sub(fe[0])._perp()._unit();let Ke=!0;for(let Je=1,tt=0;Je<fe.length;Je++){let lt=fe[Je-1],je=fe[Je];const mt=fe[Je===fe.length-1?1:Je+1];if(L&&N&&L.currentPolyCount.top++,QT(je,lt,he)){H&&(De=mt.sub(je)._perp()._unit(),Ke=!Ke);continue}L&&L.append(je,lt);const Tt=je.sub(lt)._perp(),_t=Tt.x/(Math.abs(Tt.x)+Math.abs(Tt.y)),qt=Tt.y>0?1:0,ut=lt.dist(je);if(tt+ut>32768&&(tt=0),H){Xe=mt.sub(je)._perp()._unit();let $t=JT(lt,je,mt,KT(De,Xe),H);isNaN($t)&&($t=0);const zt=je.sub(lt)._unit();lt=lt.add(zt.mult(Be))._round(),je=je.add(zt.mult(-$t))._round(),Be=$t,De=Xe}const At=pe.vertexLength,Xt=fe.length>4&&eC(lt,je,mt);let _n=tC(tt,it,Ke);if(eg(this.layoutVertexArray,lt.x,lt.y,_t,qt,0,0,_n),eg(this.layoutVertexArray,lt.x,lt.y,_t,qt,0,1,_n),tt+=ut,_n=tC(tt,Xt,!Ke),it=Xt,eg(this.layoutVertexArray,je.x,je.y,_t,qt,0,0,_n),eg(this.layoutVertexArray,je.x,je.y,_t,qt,0,1,_n),pe.vertexLength+=4,this.indexArray.emplaceBack(At+0,At+1,At+2),this.indexArray.emplaceBack(At+1,At+3,At+2),pe.primitiveLength+=2,H){const $t=re+(Je===1?fe.length-2:Je-2),zt=Je===1?re:$t+1;if(this.indexArray.emplaceBack(At+1,$t,At+3),this.indexArray.emplaceBack($t,zt,At+3),pe.primitiveLength+=2,ke===void 0&&(ke=At),!QT(mt,fe[Je],he)){const Zn=Je===fe.length-1?ke:pe.vertexLength;this.indexArray.emplaceBack(At+2,At+3,Zn),this.indexArray.emplaceBack(At+3,Zn+1,Zn),this.indexArray.emplaceBack(At+3,zt,Zn+1),pe.primitiveLength+=3}Ke=!Ke}if(M){const $t=this.layoutVertexExtArray,zt=S.projectTilePoint(lt.x,lt.y,p),Zn=S.projectTilePoint(je.x,je.y,p),Yt=S.upVector(p,lt.x,lt.y),Kt=S.upVector(p,je.x,je.y);tg($t,zt,Yt),tg($t,zt,Yt),tg($t,Zn,Kt),tg($t,Zn,Kt)}}N&&(re+=fe.length-1)}}if(L&&L.polyCount.length>0){if(L.borders){L.vertexArrayOffset=this.centroidVertexArray.length;const ne=L.borders,he=this.featuresOnBorder.push(L)-1;for(let re=0;re<4;re++)ne[re][0]!==Number.MAX_VALUE&&this.borders[re].push(he)}this.encodeCentroid(L.borders?void 0:L.centroid(),L)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,c,g,y,p)}sortBorders(){for(let r=0;r<4;r++)this.borders[r].sort((a,c)=>this.featuresOnBorder[a].borders[r][0]-this.featuresOnBorder[c].borders[r][0])}encodeCentroid(r,a,c=!0){let p,g;if(r)if(r.y!==0){const x=a.span()._mult(this.tileToMeter);p=(Math.max(r.x,1)<<3)+Math.min(7,Math.round(x.x/10)),g=(Math.max(r.y,1)<<3)+Math.min(7,Math.round(x.y/10))}else p=Math.ceil(7*(r.x+450)),g=0;else p=0,g=+c;let y=c?this.centroidVertexArray.length:a.vertexArrayOffset;for(const x of a.polyCount){c&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*x.edges+x.top);for(let E=0;E<x.top;E++)this.centroidVertexArray.emplace(y++,p,g);for(let E=0;E<2*x.edges;E++)this.centroidVertexArray.emplace(y++,0,g),this.centroidVertexArray.emplace(y++,p,g)}}}function KT(o,r){const a=o.add(r)._unit();return o.x*a.x+o.y*a.y}function YR(o,r,a,c){const p=r.sub(o)._perp()._unit(),g=a.sub(r)._perp()._unit();return JT(o,r,a,KT(p,g),c)}function JT(o,r,a,c,p){const g=Math.sqrt(1-c*c);return Math.min(o.dist(r)/3,r.dist(a)/3,p*g/c)}function QT(o,r,a){return o.x<a[0].x&&r.x<a[0].x||o.x>a[1].x&&r.x>a[1].x||o.y<a[0].y&&r.y<a[0].y||o.y>a[1].y&&r.y>a[1].y}function eC(o,r,a){if(o.x<0||o.x>=Rt||r.x<0||r.x>=Rt||a.x<0||a.x>=Rt)return!1;const c=a.sub(r),p=c.perp(),g=o.sub(r);return(c.x*g.x+c.y*g.y)/Math.sqrt((c.x*c.x+c.y*c.y)*(g.x*g.x+g.y*g.y))>-.866&&p.x*g.x+p.y*g.y<0}function tC(o,r,a){const c=r?2|o:-3&o;return a?1|c:-2&c}function nC(){const o=Math.PI/32,r=Math.tan(o),a=Hm;return a*Math.sqrt(1+2*r*r)-a}function rC(o,r,a){const c=1<<a.z,p=ls(a.x/c),g=ls((a.x+1)/c),y=Si(a.y/c),x=Si((a.y+1)/c);return function(E,S,M,L,N=0,z){const F=[];if(!E.length||!M||!L)return F;const j=(fe,ke)=>{for(const De of fe)F.push({polygon:De,bounds:ke})},H=Math.ceil(Math.log2(M)),ne=Math.ceil(Math.log2(L)),he=H-ne,re=[];for(let fe=0;fe<Math.abs(he);fe++)re.push(he>0?0:1);for(let fe=0;fe<Math.min(H,ne);fe++)re.push(0),re.push(1);let ue=E;if(ue=Jy(ue,S[0].y-N,S[1].y+N,1),ue=Jy(ue,S[0].x-N,S[1].x+N,0),!ue.length)return F;const pe=[];for(re.length?pe.push({polygons:ue,bounds:S,depth:0}):j(ue,S);pe.length;){const fe=pe.pop(),ke=fe.depth,De=re[ke],Xe=fe.bounds[0],it=fe.bounds[1],Be=De===0?Xe.x:Xe.y,Ke=De===0?it.x:it.y,Je=z?z(De,Be,Ke):.5*(Be+Ke),tt=Jy(fe.polygons,Be-N,Je+N,De),lt=Jy(fe.polygons,Je-N,Ke+N,De);if(tt.length){const je=[Xe,new xe(De===0?Je:it.x,De===1?Je:it.y)];re.length>ke+1?pe.push({polygons:tt,bounds:je,depth:ke+1}):j(tt,je)}if(lt.length){const je=[new xe(De===0?Je:Xe.x,De===1?Je:Xe.y),it];re.length>ke+1?pe.push({polygons:lt,bounds:je,depth:ke+1}):j(lt,je)}}return F}(o,r,Math.ceil((g-p)/11.25),Math.ceil((y-x)/11.25),1,(E,S,M)=>{if(E===0)return .5*(S+M);{const L=Si((a.y+S/Rt)/c);return(ml(.5*(Si((a.y+M/Rt)/c)+L))*c-a.y)*Rt}})}bt(ng,"FillExtrusionBucket",{omit:["layers","features"]}),bt(YT,"PartMetadata");const KR=new ae({"fill-extrusion-edge-radius":new V(Ge["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var JR={paint:new ae({"fill-extrusion-opacity":new V(Ge["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new K(Ge["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new V(Ge["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new V(Ge["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new K(Ge["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new K(Ge["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new K(Ge["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new V(Ge["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new V(Ge["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new V(Ge["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-rounded-roof":new V(Ge["paint_fill-extrusion"]["fill-extrusion-rounded-roof"])}),layout:KR};function iC(o,r,a){var c=2*Math.PI*6378137/256/Math.pow(2,a);return[o*c-2*Math.PI*6378137/2,r*c-2*Math.PI*6378137/2]}class Qy{constructor(r,a,c){this.z=r,this.x=a,this.y=c,this.key=rg(0,r,r,a,c)}equals(r){return this.z===r.z&&this.x===r.x&&this.y===r.y}url(r,a){const c=function(g,y,x){var E=iC(256*g,256*(y=Math.pow(2,x)-y-1),x),S=iC(256*(g+1),256*(y+1),x);return E[0]+","+E[1]+","+S[0]+","+S[1]}(this.x,this.y,this.z),p=function(g,y,x){let E,S="";for(let M=g;M>0;M--)E=1<<M-1,S+=(y&E?1:0)+(x&E?2:0);return S}(this.z,this.x,this.y);return r[(this.x+this.y)%r.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(a==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",p).replace("{bbox-epsg-3857}",c)}toString(){return`${this.z}/${this.x}/${this.y}`}}class oC{constructor(r,a){this.wrap=r,this.canonical=a,this.key=rg(r,a.z,a.z,a.x,a.y)}}class Qi{constructor(r,a,c,p,g){this.overscaledZ=r,this.wrap=a,this.canonical=new Qy(c,+p,+g),this.key=a===0&&r===c?this.canonical.key:rg(a,r,c,p,g)}equals(r){return this.overscaledZ===r.overscaledZ&&this.wrap===r.wrap&&this.canonical.equals(r.canonical)}scaledTo(r){const a=this.canonical.z-r;return r>this.canonical.z?new Qi(r,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Qi(r,this.wrap,r,this.canonical.x>>a,this.canonical.y>>a)}calculateScaledKey(r,a=!0){if(this.overscaledZ===r&&a)return this.key;if(r>this.canonical.z)return rg(this.wrap*+a,r,this.canonical.z,this.canonical.x,this.canonical.y);{const c=this.canonical.z-r;return rg(this.wrap*+a,r,r,this.canonical.x>>c,this.canonical.y>>c)}}isChildOf(r){if(r.wrap!==this.wrap)return!1;const a=this.canonical.z-r.canonical.z;return r.overscaledZ===0||r.overscaledZ<this.overscaledZ&&r.canonical.x===this.canonical.x>>a&&r.canonical.y===this.canonical.y>>a}children(r){if(this.overscaledZ>=r)return[new Qi(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const a=this.canonical.z+1,c=2*this.canonical.x,p=2*this.canonical.y;return[new Qi(a,this.wrap,a,c,p),new Qi(a,this.wrap,a,c+1,p),new Qi(a,this.wrap,a,c,p+1),new Qi(a,this.wrap,a,c+1,p+1)]}isLessThan(r){return this.wrap<r.wrap||!(this.wrap>r.wrap)&&(this.overscaledZ<r.overscaledZ||!(this.overscaledZ>r.overscaledZ)&&(this.canonical.x<r.canonical.x||!(this.canonical.x>r.canonical.x)&&this.canonical.y<r.canonical.y))}wrapped(){return new Qi(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(r){return new Qi(this.overscaledZ,r,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new oC(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function rg(o,r,a,c,p){const g=1<<Math.min(a,22);let y=g*(p%g)+c%g;return o&&a<22&&(y+=g*g*((o<0?-2*o-1:2*o)%(1<<2*(22-a)))),16*(32*y+a)+(r-a)}bt(Qy,"CanonicalTileID"),bt(Qi,"OverscaledTileID",{omit:["projMatrix"]});class vp extends xe{constructor(r,a,c){super(r,a),this.z=c}}function ig(o,r){return o.x*r.x+o.y*r.y}function sC(o,r){if(o.length===1){let a=0;const c=r[a++];let p;for(;!p||c.equals(p);)if(p=r[a++],!p)return 1/0;for(;a<r.length;a++){const g=r[a],y=o[0],x=p.sub(c),E=g.sub(c),S=y.sub(c),M=ig(x,x),L=ig(x,E),N=ig(E,E),z=ig(S,x),F=ig(S,E),j=M*N-L*L,H=(N*z-L*F)/j,ne=(M*F-L*z)/j,he=c.z*(1-H-ne)+p.z*H+g.z*ne;if(isFinite(he))return he}return 1/0}{let a=1/0;for(const c of r)a=Math.min(a,c.z);return a}}function aC(o,r,a,c,p,g,y,x){const E=y*p.getElevationAt(o,r,!0,!0),S=g[0]!==0,M=S?g[1]===0?y*(g[0]/7-450):y*function(L,N,z){const F=Math.floor(N[0]/8),j=Math.floor(N[1]/8),H=10*(N[0]-8*F),ne=10*(N[1]-8*j),he=L.getElevationAt(F,j,!0,!0),re=L.getMeterToDEM(z),ue=Math.floor(.5*(H*re-1)),pe=Math.floor(.5*(ne*re-1)),fe=L.tileCoordToPixel(F,j),ke=2*ue+1,De=2*pe+1,Xe=function(lt,je,mt,Tt,_t){return[lt.getElevationAtPixel(je,mt,!0),lt.getElevationAtPixel(je+_t,mt,!0),lt.getElevationAtPixel(je,mt+_t,!0),lt.getElevationAtPixel(je+Tt,mt+_t,!0)]}(L,fe.x-ue,fe.y-pe,ke,De),it=Math.abs(Xe[0]-Xe[1]),Be=Math.abs(Xe[2]-Xe[3]),Ke=Math.abs(Xe[0]-Xe[2])+Math.abs(Xe[1]-Xe[3]),Je=Math.min(.25,.5*re*(it+Be)/ke),tt=Math.min(.25,.5*re*Ke/De);return he+Math.max(Je*H,tt*ne)}(p,g,x):E;return{base:E+(a===0)?-1:a,top:S?Math.max(M+c,E+a+2):E+c}}const QR=Ce([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:eN}=QR,tN=Ce([{name:"a_packed",components:4,type:"Float32"}]),{members:nN}=tN,rN=Ky.types,iN=Math.cos(Math.PI/180*37.5);class ev{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(a=>a.id),this.index=r.index,this.projection=r.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(a=>{this.gradients[a.id]={}}),this.layoutVertexArray=new Fe,this.layoutVertexArray2=new nt,this.indexArray=new It,this.programConfigurations=new Lh(r.layers,r.zoom),this.segments=new Ar,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id)}populate(r,a,c,p){this.hasPattern=F1("line",this.layers,a);const g=this.layers[0].layout.get("line-sort-key"),y=[];for(const{feature:M,id:L,index:N,sourceLayerIndex:z}of r){const F=this.layers[0]._featureFilter.needGeometry,j=zh(M,F);if(!this.layers[0]._featureFilter.filter(new P(this.zoom),j,c))continue;const H=g?g.evaluate(j,{},c):void 0,ne={id:L,properties:M.properties,type:M.type,sourceLayerIndex:z,index:N,geometry:F?j.geometry:au(M,c,p),patterns:{},sortKey:H};y.push(ne)}g&&y.sort((M,L)=>M.sortKey-L.sortKey);const{lineAtlas:x,featureIndex:E}=a,S=this.addConstantDashes(x);for(const M of y){const{geometry:L,index:N,sourceLayerIndex:z}=M;if(S&&this.addFeatureDashes(M,x),this.hasPattern){const F=B1("line",this.layers,M,this.zoom,a);this.patternFeatures.push(F)}else this.addFeature(M,L,N,c,x.positions,a.availableImages);E.insert(r[N].feature,L,N,z,this.index)}}addConstantDashes(r){let a=!1;for(const c of this.layers){const p=c.paint.get("line-dasharray").value,g=c.layout.get("line-cap").value;if(p.kind!=="constant"||g.kind!=="constant")a=!0;else{const y=g.value,x=p.value;if(!x)continue;r.addDash(x,y)}}return a}addFeatureDashes(r,a){const c=this.zoom;for(const p of this.layers){const g=p.paint.get("line-dasharray").value,y=p.layout.get("line-cap").value;if(g.kind==="constant"&&y.kind==="constant")continue;let x,E;if(g.kind==="constant"){if(x=g.value,!x)continue}else x=g.evaluate({zoom:c},r);E=y.kind==="constant"?y.value:y.evaluate({zoom:c},r),a.addDash(x,E),r.patterns[p.id]=a.getKey(x,E)}}update(r,a,c,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,a,this.stateDependentLayers,c,p)}addFeatures(r,a,c,p,g){for(const y of this.patternFeatures)this.addFeature(y,y.geometry,y.index,a,c,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=r.createVertexBuffer(this.layoutVertexArray2,nN)),this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,eN),this.indexBuffer=r.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(r){if(r.properties&&r.properties.hasOwnProperty("mapbox_clip_start")&&r.properties.hasOwnProperty("mapbox_clip_end"))return{start:+r.properties.mapbox_clip_start,end:+r.properties.mapbox_clip_end}}addFeature(r,a,c,p,g,y){const x=this.layers[0].layout,E=x.get("line-join").evaluate(r,{}),S=x.get("line-cap").evaluate(r,{}),M=x.get("line-miter-limit"),L=x.get("line-round-limit");this.lineClips=this.lineFeatureClips(r);for(const N of a)this.addLine(N,r,E,S,M,L);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,c,g,y,p)}addLine(r,a,c,p,g,y){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let ne=0;ne<r.length-1;ne++)this.totalDistance+=r[ne].dist(r[ne+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const x=rN[a.type]==="Polygon";let E=r.length;for(;E>=2&&r[E-1].equals(r[E-2]);)E--;let S=0;for(;S<E-1&&r[S].equals(r[S+1]);)S++;if(E<(x?3:2))return;c==="bevel"&&(g=1.05);const M=this.overscaling<=16?15*Rt/(512*this.overscaling):0,L=this.segments.prepareSegment(10*E,this.layoutVertexArray,this.indexArray);let N,z,F,j,H;this.e1=this.e2=-1,x&&(N=r[E-2],H=r[S].sub(N)._unit()._perp());for(let ne=S;ne<E;ne++){if(F=ne===E-1?x?r[S+1]:void 0:r[ne+1],F&&r[ne].equals(F))continue;H&&(j=H),N&&(z=N),N=r[ne],H=F?F.sub(N)._unit()._perp():j,j=j||H;let he=j.add(H);he.x===0&&he.y===0||he._unit();const re=j.x*H.x+j.y*H.y,ue=he.x*H.x+he.y*H.y,pe=ue!==0?1/ue:1/0,fe=2*Math.sqrt(2-2*ue),ke=ue<iN&&z&&F,De=j.x*H.y-j.y*H.x>0;if(ke&&ne>S){const Be=N.dist(z);if(Be>2*M){const Ke=N.sub(N.sub(z)._mult(M/Be)._round());this.updateDistance(z,Ke),this.addCurrentVertex(Ke,j,0,0,L),z=Ke}}const Xe=z&&F;let it=Xe?c:x?"butt":p;if(Xe&&it==="round"&&(pe<y?it="miter":pe<=2&&(it="fakeround")),it==="miter"&&pe>g&&(it="bevel"),it==="bevel"&&(pe>2&&(it="flipbevel"),pe<g&&(it="miter")),z&&this.updateDistance(z,N),it==="miter")he._mult(pe),this.addCurrentVertex(N,he,0,0,L);else if(it==="flipbevel"){if(pe>100)he=H.mult(-1);else{const Be=pe*j.add(H).mag()/j.sub(H).mag();he._perp()._mult(Be*(De?-1:1))}this.addCurrentVertex(N,he,0,0,L),this.addCurrentVertex(N,he.mult(-1),0,0,L)}else if(it==="bevel"||it==="fakeround"){const Be=-Math.sqrt(pe*pe-1),Ke=De?Be:0,Je=De?0:Be;if(z&&this.addCurrentVertex(N,j,Ke,Je,L),it==="fakeround"){const tt=Math.round(180*fe/Math.PI/20);for(let lt=1;lt<tt;lt++){let je=lt/tt;if(je!==.5){const Tt=je-.5;je+=je*Tt*(je-1)*((1.0904+re*(re*(3.55645-1.43519*re)-3.2452))*Tt*Tt+(.848013+re*(.215638*re-1.06021)))}const mt=H.sub(j)._mult(je)._add(j)._unit()._mult(De?-1:1);this.addHalfVertex(N,mt.x,mt.y,!1,De,0,L)}}F&&this.addCurrentVertex(N,H,-Ke,-Je,L)}else if(it==="butt")this.addCurrentVertex(N,he,0,0,L);else if(it==="square"){const Be=z?1:-1;z||this.addCurrentVertex(N,he,Be,Be,L),this.addCurrentVertex(N,he,0,0,L),z&&this.addCurrentVertex(N,he,Be,Be,L)}else it==="round"&&(z&&(this.addCurrentVertex(N,j,0,0,L),this.addCurrentVertex(N,j,1,1,L,!0)),F&&(this.addCurrentVertex(N,H,-1,-1,L,!0),this.addCurrentVertex(N,H,0,0,L)));if(ke&&ne<E-1){const Be=N.dist(F);if(Be>2*M){const Ke=N.add(F.sub(N)._mult(M/Be)._round());this.updateDistance(N,Ke),this.addCurrentVertex(Ke,H,0,0,L),N=Ke}}}}addCurrentVertex(r,a,c,p,g,y=!1){const x=a.y*p-a.x,E=-a.y-a.x*p;this.addHalfVertex(r,a.x+a.y*c,a.y-a.x*c,y,!1,c,g),this.addHalfVertex(r,x,E,y,!0,-p,g)}addHalfVertex({x:r,y:a},c,p,g,y,x,E){this.layoutVertexArray.emplaceBack((r<<1)+(g?1:0),(a<<1)+(y?1:0),Math.round(63*c)+128,Math.round(63*p)+128,1+(x===0?0:x<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const S=E.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,S),E.primitiveLength++),y?this.e2=S:this.e1=S}updateScaledDistance(){if(this.lineClips){const r=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=r*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(r,a){this.distance+=r.dist(a),this.updateScaledDistance()}}bt(ev,"LineBucket",{omit:["layers","patternFeatures"]});const oN=new ae({"line-cap":new K(Ge.layout_line["line-cap"]),"line-join":new K(Ge.layout_line["line-join"]),"line-miter-limit":new V(Ge.layout_line["line-miter-limit"]),"line-round-limit":new V(Ge.layout_line["line-round-limit"]),"line-sort-key":new K(Ge.layout_line["line-sort-key"])});var lC={paint:new ae({"line-opacity":new K(Ge.paint_line["line-opacity"]),"line-color":new K(Ge.paint_line["line-color"]),"line-translate":new V(Ge.paint_line["line-translate"]),"line-translate-anchor":new V(Ge.paint_line["line-translate-anchor"]),"line-width":new K(Ge.paint_line["line-width"]),"line-gap-width":new K(Ge.paint_line["line-gap-width"]),"line-offset":new K(Ge.paint_line["line-offset"]),"line-blur":new K(Ge.paint_line["line-blur"]),"line-dasharray":new K(Ge.paint_line["line-dasharray"]),"line-pattern":new K(Ge.paint_line["line-pattern"]),"line-gradient":new se(Ge.paint_line["line-gradient"]),"line-trim-offset":new V(Ge.paint_line["line-trim-offset"])}),layout:oN};const uC=new class extends K{possiblyEvaluate(o,r){return r=new P(Math.floor(r.zoom),{now:r.now,fadeDuration:r.fadeDuration,transition:r.transition}),super.possiblyEvaluate(o,r)}evaluate(o,r,a,c){return r=hn({},r,{zoom:Math.floor(r.zoom)}),super.evaluate(o,r,a,c)}}(lC.paint.properties["line-width"].specification);function cC(o,r){return r>0?r+2*o:o}uC.useIntegerZoom=!0;const sN=Ce([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),aN=Ce([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),lN=Ce([{name:"a_projected_pos",components:4,type:"Float32"}],4);Ce([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const uN=Ce([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),cN=Ce([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);Ce([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const hC=Ce([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),hN=Ce([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Ce([{name:"triangle",components:3,type:"Uint16"}]),Ce([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Ce([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Ce([{type:"Float32",name:"offsetX"}]),Ce([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var pi=24;const Pa=128;function V1(o,r){const{expression:a}=r;if(a.kind==="constant")return{kind:"constant",layoutSize:a.evaluate(new P(o+1))};if(a.kind==="source")return{kind:"source"};{const{zoomStops:c,interpolationType:p}=a;let g=0;for(;g<c.length&&c[g]<=o;)g++;g=Math.max(0,g-1);let y=g;for(;y<c.length&&c[y]<o+1;)y++;y=Math.min(c.length-1,y);const x=c[g],E=c[y];return a.kind==="composite"?{kind:"composite",minZoom:x,maxZoom:E,interpolationType:p}:{kind:"camera",minZoom:x,maxZoom:E,minSize:a.evaluate(new P(x)),maxSize:a.evaluate(new P(E)),interpolationType:p}}}function tv(o,{uSize:r,uSizeT:a},{lowerSize:c,upperSize:p}){return o.kind==="source"?c/Pa:o.kind==="composite"?mn(c/Pa,p/Pa,a):r}function xp(o,r){let a=0,c=0;if(o.kind==="constant")c=o.layoutSize;else if(o.kind!=="source"){const{interpolationType:p,minZoom:g,maxZoom:y}=o,x=p?qe(ks.interpolationFactor(p,r,g,y),0,1):0;o.kind==="camera"?c=mn(o.minSize,o.maxSize,x):a=x}return{uSizeT:a,uSize:c}}var fN=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:Pa,evaluateSizeForFeature:tv,evaluateSizeForZoom:xp,getSizeData:V1});function pN(o,r,a){return o.sections.forEach(c=>{c.text=function(p,g,y){const x=g.layout.get("text-transform").evaluate(y,{});return x==="uppercase"?p=p.toLocaleUpperCase():x==="lowercase"&&(p=p.toLocaleLowerCase()),I.applyArabicShaping&&(p=I.applyArabicShaping(p)),p}(c.text,r,a)}),o}const og={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂","←":"↑","→":"↓"};function dN(o){return o==="︶"||o==="﹈"||o==="︸"||o==="﹄"||o==="﹂"||o==="︾"||o==="︼"||o==="︺"||o==="︘"||o==="﹀"||o==="︐"||o==="︓"||o==="︔"||o==="｀"||o==="￣"||o==="︑"||o==="︒"}function mN(o){return o==="︵"||o==="﹇"||o==="︷"||o==="﹃"||o==="﹁"||o==="︽"||o==="︻"||o==="︹"||o==="︗"||o==="︿"}var fC=Vn,pC=function(o,r,a,c,p){var g,y,x=8*p-c-1,E=(1<<x)-1,S=E>>1,M=-7,L=a?p-1:0,N=a?-1:1,z=o[r+L];for(L+=N,g=z&(1<<-M)-1,z>>=-M,M+=x;M>0;g=256*g+o[r+L],L+=N,M-=8);for(y=g&(1<<-M)-1,g>>=-M,M+=c;M>0;y=256*y+o[r+L],L+=N,M-=8);if(g===0)g=1-S;else{if(g===E)return y?NaN:1/0*(z?-1:1);y+=Math.pow(2,c),g-=S}return(z?-1:1)*y*Math.pow(2,g-c)},dC=function(o,r,a,c,p,g){var y,x,E,S=8*g-p-1,M=(1<<S)-1,L=M>>1,N=p===23?Math.pow(2,-24)-Math.pow(2,-77):0,z=c?0:g-1,F=c?1:-1,j=r<0||r===0&&1/r<0?1:0;for(r=Math.abs(r),isNaN(r)||r===1/0?(x=isNaN(r)?1:0,y=M):(y=Math.floor(Math.log(r)/Math.LN2),r*(E=Math.pow(2,-y))<1&&(y--,E*=2),(r+=y+L>=1?N/E:N*Math.pow(2,1-L))*E>=2&&(y++,E/=2),y+L>=M?(x=0,y=M):y+L>=1?(x=(r*E-1)*Math.pow(2,p),y+=L):(x=r*Math.pow(2,L-1)*Math.pow(2,p),y=0));p>=8;o[a+z]=255&x,z+=F,x/=256,p-=8);for(y=y<<p|x,S+=p;S>0;o[a+z]=255&y,z+=F,y/=256,S-=8);o[a+z-F]|=128*j};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */function Vn(o){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(o)?o:new Uint8Array(o||0),this.pos=0,this.type=0,this.length=this.buf.length}Vn.Varint=0,Vn.Fixed64=1,Vn.Bytes=2,Vn.Fixed32=5;var j1=4294967296,mC=1/j1,gC=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function uu(o){return o.type===Vn.Bytes?o.readVarint()+o.pos:o.pos+1}function wp(o,r,a){return a?4294967296*r+(o>>>0):4294967296*(r>>>0)+(o>>>0)}function _C(o,r,a){var c=r<=16383?1:r<=2097151?2:r<=268435455?3:Math.floor(Math.log(r)/(7*Math.LN2));a.realloc(c);for(var p=a.pos-1;p>=o;p--)a.buf[p+c]=a.buf[p]}function gN(o,r){for(var a=0;a<o.length;a++)r.writeVarint(o[a])}function _N(o,r){for(var a=0;a<o.length;a++)r.writeSVarint(o[a])}function yN(o,r){for(var a=0;a<o.length;a++)r.writeFloat(o[a])}function vN(o,r){for(var a=0;a<o.length;a++)r.writeDouble(o[a])}function xN(o,r){for(var a=0;a<o.length;a++)r.writeBoolean(o[a])}function wN(o,r){for(var a=0;a<o.length;a++)r.writeFixed32(o[a])}function bN(o,r){for(var a=0;a<o.length;a++)r.writeSFixed32(o[a])}function EN(o,r){for(var a=0;a<o.length;a++)r.writeFixed64(o[a])}function SN(o,r){for(var a=0;a<o.length;a++)r.writeSFixed64(o[a])}function nv(o,r){return(o[r]|o[r+1]<<8|o[r+2]<<16)+16777216*o[r+3]}function bp(o,r,a){o[a]=r,o[a+1]=r>>>8,o[a+2]=r>>>16,o[a+3]=r>>>24}function yC(o,r){return(o[r]|o[r+1]<<8|o[r+2]<<16)+(o[r+3]<<24)}Vn.prototype={destroy:function(){this.buf=null},readFields:function(o,r,a){for(a=a||this.length;this.pos<a;){var c=this.readVarint(),p=c>>3,g=this.pos;this.type=7&c,o(p,r,this),this.pos===g&&this.skip(c)}return r},readMessage:function(o,r){return this.readFields(o,r,this.readVarint()+this.pos)},readFixed32:function(){var o=nv(this.buf,this.pos);return this.pos+=4,o},readSFixed32:function(){var o=yC(this.buf,this.pos);return this.pos+=4,o},readFixed64:function(){var o=nv(this.buf,this.pos)+nv(this.buf,this.pos+4)*j1;return this.pos+=8,o},readSFixed64:function(){var o=nv(this.buf,this.pos)+yC(this.buf,this.pos+4)*j1;return this.pos+=8,o},readFloat:function(){var o=pC(this.buf,this.pos,!0,23,4);return this.pos+=4,o},readDouble:function(){var o=pC(this.buf,this.pos,!0,52,8);return this.pos+=8,o},readVarint:function(o){var r,a,c=this.buf;return r=127&(a=c[this.pos++]),a<128?r:(r|=(127&(a=c[this.pos++]))<<7,a<128?r:(r|=(127&(a=c[this.pos++]))<<14,a<128?r:(r|=(127&(a=c[this.pos++]))<<21,a<128?r:function(p,g,y){var x,E,S=y.buf;if(x=(112&(E=S[y.pos++]))>>4,E<128||(x|=(127&(E=S[y.pos++]))<<3,E<128)||(x|=(127&(E=S[y.pos++]))<<10,E<128)||(x|=(127&(E=S[y.pos++]))<<17,E<128)||(x|=(127&(E=S[y.pos++]))<<24,E<128)||(x|=(1&(E=S[y.pos++]))<<31,E<128))return wp(p,x,g);throw new Error("Expected varint not more than 10 bytes")}(r|=(15&(a=c[this.pos]))<<28,o,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var o=this.readVarint();return o%2==1?(o+1)/-2:o/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var o=this.readVarint()+this.pos,r=this.pos;return this.pos=o,o-r>=12&&gC?function(a,c,p){return gC.decode(a.subarray(c,p))}(this.buf,r,o):function(a,c,p){for(var g="",y=c;y<p;){var x,E,S,M=a[y],L=null,N=M>239?4:M>223?3:M>191?2:1;if(y+N>p)break;N===1?M<128&&(L=M):N===2?(192&(x=a[y+1]))==128&&(L=(31&M)<<6|63&x)<=127&&(L=null):N===3?(E=a[y+2],(192&(x=a[y+1]))==128&&(192&E)==128&&((L=(15&M)<<12|(63&x)<<6|63&E)<=2047||L>=55296&&L<=57343)&&(L=null)):N===4&&(E=a[y+2],S=a[y+3],(192&(x=a[y+1]))==128&&(192&E)==128&&(192&S)==128&&((L=(15&M)<<18|(63&x)<<12|(63&E)<<6|63&S)<=65535||L>=1114112)&&(L=null)),L===null?(L=65533,N=1):L>65535&&(L-=65536,g+=String.fromCharCode(L>>>10&1023|55296),L=56320|1023&L),g+=String.fromCharCode(L),y+=N}return g}(this.buf,r,o)},readBytes:function(){var o=this.readVarint()+this.pos,r=this.buf.subarray(this.pos,o);return this.pos=o,r},readPackedVarint:function(o,r){if(this.type!==Vn.Bytes)return o.push(this.readVarint(r));var a=uu(this);for(o=o||[];this.pos<a;)o.push(this.readVarint(r));return o},readPackedSVarint:function(o){if(this.type!==Vn.Bytes)return o.push(this.readSVarint());var r=uu(this);for(o=o||[];this.pos<r;)o.push(this.readSVarint());return o},readPackedBoolean:function(o){if(this.type!==Vn.Bytes)return o.push(this.readBoolean());var r=uu(this);for(o=o||[];this.pos<r;)o.push(this.readBoolean());return o},readPackedFloat:function(o){if(this.type!==Vn.Bytes)return o.push(this.readFloat());var r=uu(this);for(o=o||[];this.pos<r;)o.push(this.readFloat());return o},readPackedDouble:function(o){if(this.type!==Vn.Bytes)return o.push(this.readDouble());var r=uu(this);for(o=o||[];this.pos<r;)o.push(this.readDouble());return o},readPackedFixed32:function(o){if(this.type!==Vn.Bytes)return o.push(this.readFixed32());var r=uu(this);for(o=o||[];this.pos<r;)o.push(this.readFixed32());return o},readPackedSFixed32:function(o){if(this.type!==Vn.Bytes)return o.push(this.readSFixed32());var r=uu(this);for(o=o||[];this.pos<r;)o.push(this.readSFixed32());return o},readPackedFixed64:function(o){if(this.type!==Vn.Bytes)return o.push(this.readFixed64());var r=uu(this);for(o=o||[];this.pos<r;)o.push(this.readFixed64());return o},readPackedSFixed64:function(o){if(this.type!==Vn.Bytes)return o.push(this.readSFixed64());var r=uu(this);for(o=o||[];this.pos<r;)o.push(this.readSFixed64());return o},skip:function(o){var r=7&o;if(r===Vn.Varint)for(;this.buf[this.pos++]>127;);else if(r===Vn.Bytes)this.pos=this.readVarint()+this.pos;else if(r===Vn.Fixed32)this.pos+=4;else{if(r!==Vn.Fixed64)throw new Error("Unimplemented type: "+r);this.pos+=8}},writeTag:function(o,r){this.writeVarint(o<<3|r)},realloc:function(o){for(var r=this.length||16;r<this.pos+o;)r*=2;if(r!==this.length){var a=new Uint8Array(r);a.set(this.buf),this.buf=a,this.length=r}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(o){this.realloc(4),bp(this.buf,o,this.pos),this.pos+=4},writeSFixed32:function(o){this.realloc(4),bp(this.buf,o,this.pos),this.pos+=4},writeFixed64:function(o){this.realloc(8),bp(this.buf,-1&o,this.pos),bp(this.buf,Math.floor(o*mC),this.pos+4),this.pos+=8},writeSFixed64:function(o){this.realloc(8),bp(this.buf,-1&o,this.pos),bp(this.buf,Math.floor(o*mC),this.pos+4),this.pos+=8},writeVarint:function(o){(o=+o||0)>268435455||o<0?function(r,a){var c,p;if(r>=0?(c=r%4294967296|0,p=r/4294967296|0):(p=~(-r/4294967296),4294967295^(c=~(-r%4294967296))?c=c+1|0:(c=0,p=p+1|0)),r>=18446744073709552e3||r<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");a.realloc(10),function(g,y,x){x.buf[x.pos++]=127&g|128,g>>>=7,x.buf[x.pos++]=127&g|128,g>>>=7,x.buf[x.pos++]=127&g|128,g>>>=7,x.buf[x.pos++]=127&g|128,x.buf[x.pos]=127&(g>>>=7)}(c,0,a),function(g,y){var x=(7&g)<<4;y.buf[y.pos++]|=x|((g>>>=3)?128:0),g&&(y.buf[y.pos++]=127&g|((g>>>=7)?128:0),g&&(y.buf[y.pos++]=127&g|((g>>>=7)?128:0),g&&(y.buf[y.pos++]=127&g|((g>>>=7)?128:0),g&&(y.buf[y.pos++]=127&g|((g>>>=7)?128:0),g&&(y.buf[y.pos++]=127&g)))))}(p,a)}(o,this):(this.realloc(4),this.buf[this.pos++]=127&o|(o>127?128:0),o<=127||(this.buf[this.pos++]=127&(o>>>=7)|(o>127?128:0),o<=127||(this.buf[this.pos++]=127&(o>>>=7)|(o>127?128:0),o<=127||(this.buf[this.pos++]=o>>>7&127))))},writeSVarint:function(o){this.writeVarint(o<0?2*-o-1:2*o)},writeBoolean:function(o){this.writeVarint(!!o)},writeString:function(o){o=String(o),this.realloc(4*o.length),this.pos++;var r=this.pos;this.pos=function(c,p,g){for(var y,x,E=0;E<p.length;E++){if((y=p.charCodeAt(E))>55295&&y<57344){if(!x){y>56319||E+1===p.length?(c[g++]=239,c[g++]=191,c[g++]=189):x=y;continue}if(y<56320){c[g++]=239,c[g++]=191,c[g++]=189,x=y;continue}y=x-55296<<10|y-56320|65536,x=null}else x&&(c[g++]=239,c[g++]=191,c[g++]=189,x=null);y<128?c[g++]=y:(y<2048?c[g++]=y>>6|192:(y<65536?c[g++]=y>>12|224:(c[g++]=y>>18|240,c[g++]=y>>12&63|128),c[g++]=y>>6&63|128),c[g++]=63&y|128)}return g}(this.buf,o,this.pos);var a=this.pos-r;a>=128&&_C(r,a,this),this.pos=r-1,this.writeVarint(a),this.pos+=a},writeFloat:function(o){this.realloc(4),dC(this.buf,o,this.pos,!0,23,4),this.pos+=4},writeDouble:function(o){this.realloc(8),dC(this.buf,o,this.pos,!0,52,8),this.pos+=8},writeBytes:function(o){var r=o.length;this.writeVarint(r),this.realloc(r);for(var a=0;a<r;a++)this.buf[this.pos++]=o[a]},writeRawMessage:function(o,r){this.pos++;var a=this.pos;o(r,this);var c=this.pos-a;c>=128&&_C(a,c,this),this.pos=a-1,this.writeVarint(c),this.pos+=c},writeMessage:function(o,r,a){this.writeTag(o,Vn.Bytes),this.writeRawMessage(r,a)},writePackedVarint:function(o,r){r.length&&this.writeMessage(o,gN,r)},writePackedSVarint:function(o,r){r.length&&this.writeMessage(o,_N,r)},writePackedBoolean:function(o,r){r.length&&this.writeMessage(o,xN,r)},writePackedFloat:function(o,r){r.length&&this.writeMessage(o,yN,r)},writePackedDouble:function(o,r){r.length&&this.writeMessage(o,vN,r)},writePackedFixed32:function(o,r){r.length&&this.writeMessage(o,wN,r)},writePackedSFixed32:function(o,r){r.length&&this.writeMessage(o,bN,r)},writePackedFixed64:function(o,r){r.length&&this.writeMessage(o,EN,r)},writePackedSFixed64:function(o,r){r.length&&this.writeMessage(o,SN,r)},writeBytesField:function(o,r){this.writeTag(o,Vn.Bytes),this.writeBytes(r)},writeFixed32Field:function(o,r){this.writeTag(o,Vn.Fixed32),this.writeFixed32(r)},writeSFixed32Field:function(o,r){this.writeTag(o,Vn.Fixed32),this.writeSFixed32(r)},writeFixed64Field:function(o,r){this.writeTag(o,Vn.Fixed64),this.writeFixed64(r)},writeSFixed64Field:function(o,r){this.writeTag(o,Vn.Fixed64),this.writeSFixed64(r)},writeVarintField:function(o,r){this.writeTag(o,Vn.Varint),this.writeVarint(r)},writeSVarintField:function(o,r){this.writeTag(o,Vn.Varint),this.writeSVarint(r)},writeStringField:function(o,r){this.writeTag(o,Vn.Bytes),this.writeString(r)},writeFloatField:function(o,r){this.writeTag(o,Vn.Fixed32),this.writeFloat(r)},writeDoubleField:function(o,r){this.writeTag(o,Vn.Fixed64),this.writeDouble(r)},writeBooleanField:function(o,r){this.writeVarintField(o,!!r)}};var rv=q(fC);const G1=3;function TN(o,r,a){r.glyphs=[],o===1&&a.readMessage(CN,r)}function CN(o,r,a){if(o===3){const{id:c,bitmap:p,width:g,height:y,left:x,top:E,advance:S}=a.readMessage(IN,{});r.glyphs.push({id:c,bitmap:new lu({width:g+2*G1,height:y+2*G1},p),metrics:{width:g,height:y,left:x,top:E,advance:S}})}else o===4?r.ascender=a.readSVarint():o===5&&(r.descender=a.readSVarint())}function IN(o,r,a){o===1?r.id=a.readVarint():o===2?r.bitmap=a.readBytes():o===3?r.width=a.readVarint():o===4?r.height=a.readVarint():o===5?r.left=a.readSVarint():o===6?r.top=a.readSVarint():o===7&&(r.advance=a.readVarint())}const vC=G1;function q1(o){let r=0,a=0;for(const y of o)r+=y.w*y.h,a=Math.max(a,y.w);o.sort((y,x)=>x.h-y.h);const c=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(r/.95)),a),h:1/0}];let p=0,g=0;for(const y of o)for(let x=c.length-1;x>=0;x--){const E=c[x];if(!(y.w>E.w||y.h>E.h)){if(y.x=E.x,y.y=E.y,g=Math.max(g,y.y+y.h),p=Math.max(p,y.x+y.w),y.w===E.w&&y.h===E.h){const S=c.pop();x<c.length&&(c[x]=S)}else y.h===E.h?(E.x+=y.w,E.w-=y.w):y.w===E.w?(E.y+=y.h,E.h-=y.h):(c.push({x:E.x+y.w,y:E.y,w:E.w-y.w,h:y.h}),E.y+=y.h,E.h-=y.h);break}}return{w:p,h:g,fill:r/(p*g)||0}}const _o=1;class X1{constructor(r,{pixelRatio:a,version:c,stretchX:p,stretchY:g,content:y}){this.paddedRect=r,this.pixelRatio=a,this.stretchX=p,this.stretchY=g,this.content=y,this.version=c}get tl(){return[this.paddedRect.x+_o,this.paddedRect.y+_o]}get br(){return[this.paddedRect.x+this.paddedRect.w-_o,this.paddedRect.y+this.paddedRect.h-_o]}get displaySize(){return[(this.paddedRect.w-2*_o)/this.pixelRatio,(this.paddedRect.h-2*_o)/this.pixelRatio]}}class xC{constructor(r,a){const c={},p={};this.haveRenderCallbacks=[];const g=[];this.addImages(r,c,g),this.addImages(a,p,g);const{w:y,h:x}=q1(g),E=new Fo({width:y||1,height:x||1});for(const S in r){const M=r[S],L=c[S].paddedRect;Fo.copy(M.data,E,{x:0,y:0},{x:L.x+_o,y:L.y+_o},M.data)}for(const S in a){const M=a[S],L=p[S].paddedRect,N=L.x+_o,z=L.y+_o,F=M.data.width,j=M.data.height;Fo.copy(M.data,E,{x:0,y:0},{x:N,y:z},M.data),Fo.copy(M.data,E,{x:0,y:j-1},{x:N,y:z-1},{width:F,height:1}),Fo.copy(M.data,E,{x:0,y:0},{x:N,y:z+j},{width:F,height:1}),Fo.copy(M.data,E,{x:F-1,y:0},{x:N-1,y:z},{width:1,height:j}),Fo.copy(M.data,E,{x:0,y:0},{x:N+F,y:z},{width:1,height:j})}this.image=E,this.iconPositions=c,this.patternPositions=p}addImages(r,a,c){for(const p in r){const g=r[p],y={x:0,y:0,w:g.data.width+2*_o,h:g.data.height+2*_o};c.push(y),a[p]=new X1(y,g),g.hasRenderCallback&&this.haveRenderCallbacks.push(p)}}patchUpdatedImages(r,a){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(c=>r.hasImage(c)),r.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const c in r.updatedImages)this.patchUpdatedImage(this.iconPositions[c],r.getImage(c),a),this.patchUpdatedImage(this.patternPositions[c],r.getImage(c),a)}patchUpdatedImage(r,a,c){if(!r||!a||r.version===a.version)return;r.version=a.version;const[p,g]=r.tl;c.update(a.data,void 0,{x:p,y:g})}}bt(X1,"ImagePosition"),bt(xC,"ImageAtlas");const us={horizontal:1,vertical:2,horizontalOnly:3},wC=-17;class sg{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(r,a){const c=new sg;return c.scale=r||1,c.fontStack=a,c}static forImage(r){const a=new sg;return a.imageName=r,a}}class Ep{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(r,a){const c=new Ep;for(let p=0;p<r.sections.length;p++){const g=r.sections[p];g.image?c.addImageSection(g):c.addTextSection(g,a)}return c}length(){return this.text.length}getSection(r){return this.sections[this.sectionIndex[r]]}getSections(){return this.sections}getSectionIndex(r){return this.sectionIndex[r]}getCharCode(r){return this.text.charCodeAt(r)}verticalizePunctuation(r){this.text=function(a,c){let p="";for(let g=0;g<a.length;g++){const y=a.charCodeAt(g+1)||null,x=a.charCodeAt(g-1)||null;p+=!c&&(y&&Dy(y)&&!og[a[g+1]]||x&&Dy(x)&&!og[a[g-1]])||!og[a[g]]?a[g]:og[a[g]]}return p}(this.text,r)}trim(){let r=0;for(let c=0;c<this.text.length&&iv[this.text.charCodeAt(c)];c++)r++;let a=this.text.length;for(let c=this.text.length-1;c>=0&&c>=r&&iv[this.text.charCodeAt(c)];c--)a--;this.text=this.text.substring(r,a),this.sectionIndex=this.sectionIndex.slice(r,a)}substring(r,a){const c=new Ep;return c.text=this.text.substring(r,a),c.sectionIndex=this.sectionIndex.slice(r,a),c.sections=this.sections,c}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((r,a)=>Math.max(r,this.sections[a].scale),0)}addTextSection(r,a){this.text+=r.text,this.sections.push(sg.forText(r.scale,r.fontStack||a));const c=this.sections.length-1;for(let p=0;p<r.text.length;++p)this.sectionIndex.push(c)}addImageSection(r){const a=r.image?r.image.name:"";if(a.length===0)return void nr("Can't add FormattedSection with an empty image.");const c=this.getNextImageSectionCharCode();c?(this.text+=String.fromCharCode(c),this.sections.push(sg.forImage(a)),this.sectionIndex.push(this.sections.length-1)):nr("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function $1(o,r,a,c,p,g,y,x,E,S,M,L,N,z,F){const j=Ep.fromFeature(o,p);L===us.vertical&&j.verticalizePunctuation(N);let H=[];const ne=function(fe,ke,De,Xe,it,Be){if(!fe)return[];const Ke=[],Je=function(mt,Tt,_t,qt,ut,At){let Xt=0;for(let _n=0;_n<mt.length();_n++){const $t=mt.getSection(_n);Xt+=bC(mt.getCharCode(_n),$t,qt,ut,Tt,At)}return Xt/Math.max(1,Math.ceil(Xt/_t))}(fe,ke,De,Xe,it,Be),tt=fe.text.indexOf("​")>=0;let lt=0;for(let mt=0;mt<fe.length();mt++){const Tt=fe.getSection(mt),_t=fe.getCharCode(mt);if(iv[_t]||(lt+=bC(_t,Tt,Xe,it,ke,Be)),mt<fe.length()-1){const qt=!((je=_t)<11904||!(yt["Bopomofo Extended"](je)||yt.Bopomofo(je)||yt["CJK Compatibility Forms"](je)||yt["CJK Compatibility Ideographs"](je)||yt["CJK Compatibility"](je)||yt["CJK Radicals Supplement"](je)||yt["CJK Strokes"](je)||yt["CJK Symbols and Punctuation"](je)||yt["CJK Unified Ideographs Extension A"](je)||yt["CJK Unified Ideographs"](je)||yt["Enclosed CJK Letters and Months"](je)||yt["Halfwidth and Fullwidth Forms"](je)||yt.Hiragana(je)||yt["Ideographic Description Characters"](je)||yt["Kangxi Radicals"](je)||yt["Katakana Phonetic Extensions"](je)||yt.Katakana(je)||yt["Vertical Forms"](je)||yt["Yi Radicals"](je)||yt["Yi Syllables"](je)));(MN[_t]||qt||Tt.imageName)&&Ke.push(SC(mt+1,lt,Je,Ke,AN(_t,fe.getCharCode(mt+1),qt&&tt),!1))}}var je;return TC(SC(fe.length(),lt,Je,Ke,0,!0))}(j,S,g,r,c,z),{processBidirectionalText:he,processStyledBidirectionalText:re}=I;if(he&&j.sections.length===1){const fe=he(j.toString(),ne);for(const ke of fe){const De=new Ep;De.text=ke,De.sections=j.sections;for(let Xe=0;Xe<ke.length;Xe++)De.sectionIndex.push(0);H.push(De)}}else if(re){const fe=re(j.text,j.sectionIndex,ne);for(const ke of fe){const De=new Ep;De.text=ke[0],De.sectionIndex=ke[1],De.sections=j.sections,H.push(De)}}else H=function(fe,ke){const De=[],Xe=fe.text;let it=0;for(const Be of ke)De.push(fe.substring(it,Be)),it=Be;return it<Xe.length&&De.push(fe.substring(it,Xe.length)),De}(j,ne);const ue=[],pe={positionedLines:ue,text:j.toString(),top:M[1],bottom:M[1],left:M[0],right:M[0],writingMode:L,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(fe,ke,De,Xe,it,Be,Ke,Je,tt,lt,je,mt){let Tt=0,_t=0,qt=0;const ut=Je==="right"?1:Je==="left"?0:.5;let At=!1;for(const Yt of it){const Kt=Yt.getSections();for(const zn of Kt){if(zn.imageName)continue;const jn=ke[zn.fontStack];if(jn&&(At=jn.ascender!==void 0&&jn.descender!==void 0,!At))break}if(!At)break}let Xt=0;for(const Yt of it){Yt.trim();const Kt=Yt.getMaxScale(),zn=(Kt-1)*pi,jn={positionedGlyphs:[],lineOffset:0};fe.positionedLines[Xt]=jn;const Gn=jn.positionedGlyphs;let Fn=0;if(!Yt.length()){_t+=Be,++Xt;continue}let ir=0,pr=0;for(let Bn=0;Bn<Yt.length();Bn++){const Xr=Yt.getSection(Bn),Dr=Yt.getSectionIndex(Bn),ar=Yt.getCharCode(Bn);let vn=Xr.scale,Rr=null,qn=null,eo=null,Nr=pi,di=0;const ni=!(tt===us.horizontal||!je&&!Rm(ar)||je&&(iv[ar]||(_n=ar,yt.Arabic(_n)||yt["Arabic Supplement"](_n)||yt["Arabic Extended-A"](_n)||yt["Arabic Presentation Forms-A"](_n)||yt["Arabic Presentation Forms-B"](_n))));if(Xr.imageName){const to=Xe[Xr.imageName];if(!to)continue;eo=Xr.imageName,fe.iconsInText=fe.iconsInText||!0,qn=to.paddedRect;const ri=to.displaySize;vn=vn*pi/mt,Rr={width:ri[0],height:ri[1],left:_o,top:-vC,advance:ni?ri[1]:ri[0],localGlyph:!1},di=At?-Rr.height*vn:wC+Kt*pi-ri[1]*vn,Nr=Rr.advance;const Ra=(ni?ri[0]:ri[1])*vn-pi*Kt;Ra>0&&Ra>Fn&&(Fn=Ra)}else{const to=De[Xr.fontStack];if(!to)continue;to[ar]&&(qn=to[ar]);const ri=ke[Xr.fontStack];if(!ri)continue;const Ra=ri.glyphs[ar];if(!Ra)continue;if(Rr=Ra.metrics,Nr=ar!==8203?pi:0,At){const Pp=ri.ascender!==void 0?Math.abs(ri.ascender):0,gg=ri.descender!==void 0?Math.abs(ri.descender):0,_g=(Pp+gg)*vn;ir<_g&&(ir=_g,pr=(Pp-gg)/2*vn),di=-Pp*vn}else di=wC+(Kt-vn)*pi}ni?(fe.verticalizable=!0,Gn.push({glyph:ar,imageName:eo,x:Tt,y:_t+di,vertical:ni,scale:vn,localGlyph:Rr.localGlyph,fontStack:Xr.fontStack,sectionIndex:Dr,metrics:Rr,rect:qn}),Tt+=Nr*vn+lt):(Gn.push({glyph:ar,imageName:eo,x:Tt,y:_t+di,vertical:ni,scale:vn,localGlyph:Rr.localGlyph,fontStack:Xr.fontStack,sectionIndex:Dr,metrics:Rr,rect:qn}),Tt+=Rr.advance*vn+lt)}Gn.length!==0&&(qt=Math.max(Tt-lt,qt),At?CC(Gn,ut,Fn,pr,Be*Kt/2):CC(Gn,ut,Fn,0,Be/2)),Tt=0;const Lr=Be*Kt+Fn;jn.lineOffset=Math.max(Fn,zn),_t+=Lr,++Xt}var _n;const $t=_t,{horizontalAlign:zt,verticalAlign:Zn}=Z1(Ke);(function(Yt,Kt,zn,jn,Gn,Fn){const ir=(Kt-zn)*Gn,pr=-Fn*jn;for(const Lr of Yt)for(const Bn of Lr.positionedGlyphs)Bn.x+=ir,Bn.y+=pr})(fe.positionedLines,ut,zt,Zn,qt,$t),fe.top+=-Zn*$t,fe.bottom=fe.top+$t,fe.left+=-zt*qt,fe.right=fe.left+qt,fe.hasBaseline=At}(pe,r,a,c,H,y,x,E,L,S,N,F),!function(fe){for(const ke of fe)if(ke.positionedGlyphs.length!==0)return!1;return!0}(ue)&&pe}const iv={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},MN={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function bC(o,r,a,c,p,g){if(r.imageName){const y=c[r.imageName];return y?y.displaySize[0]*r.scale*pi/g+p:0}{const y=a[r.fontStack],x=y&&y.glyphs[o];return x?x.metrics.advance*r.scale+p:0}}function EC(o,r,a,c){const p=Math.pow(o-r,2);return c?o<r?p/2:2*p:p+Math.abs(a)*a}function AN(o,r,a){let c=0;return o===10&&(c-=1e4),a&&(c+=150),o!==40&&o!==65288||(c+=50),r!==41&&r!==65289||(c+=50),c}function SC(o,r,a,c,p,g){let y=null,x=EC(r,a,p,g);for(const E of c){const S=EC(r-E.x,a,p,g)+E.badness;S<=x&&(y=E,x=S)}return{index:o,x:r,priorBreak:y,badness:x}}function TC(o){return o?TC(o.priorBreak).concat(o.index):[]}function Z1(o){let r=.5,a=.5;switch(o){case"right":case"top-right":case"bottom-right":r=1;break;case"left":case"top-left":case"bottom-left":r=0}switch(o){case"bottom":case"bottom-right":case"bottom-left":a=1;break;case"top":case"top-right":case"top-left":a=0}return{horizontalAlign:r,verticalAlign:a}}function CC(o,r,a,c,p){if(!(r||a||c||p))return;const g=o.length-1,y=o[g],x=(y.x+y.metrics.advance*y.scale)*r;for(let E=0;E<=g;E++)o[E].x-=x,o[E].y+=a+c+p}function PN(o,r,a){const{horizontalAlign:c,verticalAlign:p}=Z1(a),g=r[0]-o.displaySize[0]*c,y=r[1]-o.displaySize[1]*p;return{image:o,top:y,bottom:y+o.displaySize[1],left:g,right:g+o.displaySize[0]}}function IC(o,r,a,c,p,g){const y=o.image;let x;if(y.content){const H=y.content,ne=y.pixelRatio||1;x=[H[0]/ne,H[1]/ne,y.displaySize[0]-H[2]/ne,y.displaySize[1]-H[3]/ne]}const E=r.left*g,S=r.right*g;let M,L,N,z;a==="width"||a==="both"?(z=p[0]+E-c[3],L=p[0]+S+c[1]):(z=p[0]+(E+S-y.displaySize[0])/2,L=z+y.displaySize[0]);const F=r.top*g,j=r.bottom*g;return a==="height"||a==="both"?(M=p[1]+F-c[0],N=p[1]+j+c[2]):(M=p[1]+(F+j-y.displaySize[1])/2,N=M+y.displaySize[1]),{image:y,top:M,right:L,bottom:N,left:z,collisionPadding:x}}class cu extends xe{constructor(r,a,c,p,g){super(r,a),this.angle=p,this.z=c,g!==void 0&&(this.segment=g)}clone(){return new cu(this.x,this.y,this.z,this.angle,this.segment)}}function MC(o,r,a,c,p){if(r.segment===void 0)return!0;let g=r,y=r.segment+1,x=0;for(;x>-a/2;){if(y--,y<0)return!1;x-=o[y].dist(g),g=o[y]}x+=o[y].dist(o[y+1]),y++;const E=[];let S=0;for(;x<a/2;){const M=o[y],L=o[y+1];if(!L)return!1;let N=o[y-1].angleTo(M)-M.angleTo(L);for(N=Math.abs((N+3*Math.PI)%(2*Math.PI)-Math.PI),E.push({distance:x,angleDelta:N}),S+=N;x-E[0].distance>c;)S-=E.shift().angleDelta;if(S>p)return!1;y++,x+=M.dist(L)}return!0}function AC(o){let r=0;for(let a=0;a<o.length-1;a++)r+=o[a].dist(o[a+1]);return r}function PC(o,r,a){return o?.6*r*a:0}function LC(o,r){return Math.max(o?o.right-o.left:0,r?r.right-r.left:0)}function LN(o,r,a,c,p,g){const y=PC(a,p,g),x=LC(a,c)*g;let E=0;const S=AC(o)/2;for(let M=0;M<o.length-1;M++){const L=o[M],N=o[M+1],z=L.dist(N);if(E+z>S){const F=(S-E)/z,j=mn(L.x,N.x,F),H=mn(L.y,N.y,F),ne=new cu(j,H,0,N.angleTo(L),M);return!y||MC(o,ne,x,y,r)?ne:void 0}E+=z}}function DN(o,r,a,c,p,g,y,x,E){const S=PC(c,g,y),M=LC(c,p),L=M*y,N=o[0].x===0||o[0].x===E||o[0].y===0||o[0].y===E;return r-L<r/4&&(r=L+r/4),DC(o,N?r/2*x%r:(M/2+2*g)*y*x%r,r,S,a,L,N,!1,E)}function DC(o,r,a,c,p,g,y,x,E){const S=g/2,M=AC(o);let L=0,N=r-a,z=[];for(let F=0;F<o.length-1;F++){const j=o[F],H=o[F+1],ne=j.dist(H),he=H.angleTo(j);for(;N+a<L+ne;){N+=a;const re=(N-L)/ne,ue=mn(j.x,H.x,re),pe=mn(j.y,H.y,re);if(ue>=0&&ue<E&&pe>=0&&pe<E&&N-S>=0&&N+S<=M){const fe=new cu(ue,pe,0,he,F);fe._round(),c&&!MC(o,fe,g,c,p)||z.push(fe)}}L+=ne}return x||z.length||y||(z=DC(o,L/2,a,c,p,g,y,!0,E)),z}function RC(o,r,a,c,p){const g=[];for(let y=0;y<o.length;y++){const x=o[y];let E;for(let S=0;S<x.length-1;S++){let M=x[S],L=x[S+1];M.x<r&&L.x<r||(M.x<r?M=new xe(r,M.y+(r-M.x)/(L.x-M.x)*(L.y-M.y))._round():L.x<r&&(L=new xe(r,M.y+(r-M.x)/(L.x-M.x)*(L.y-M.y))._round()),M.y<a&&L.y<a||(M.y<a?M=new xe(M.x+(a-M.y)/(L.y-M.y)*(L.x-M.x),a)._round():L.y<a&&(L=new xe(M.x+(a-M.y)/(L.y-M.y)*(L.x-M.x),a)._round()),M.x>=c&&L.x>=c||(M.x>=c?M=new xe(c,M.y+(c-M.x)/(L.x-M.x)*(L.y-M.y))._round():L.x>=c&&(L=new xe(c,M.y+(c-M.x)/(L.x-M.x)*(L.y-M.y))._round()),M.y>=p&&L.y>=p||(M.y>=p?M=new xe(M.x+(p-M.y)/(L.y-M.y)*(L.x-M.x),p)._round():L.y>=p&&(L=new xe(M.x+(p-M.y)/(L.y-M.y)*(L.x-M.x),p)._round()),E&&M.equals(E[E.length-1])||(E=[M],g.push(E)),E.push(L)))))}}return g}bt(cu,"Anchor");const ag=1e20;function NC(o,r,a,c,p,g,y,x,E){for(let S=r;S<r+c;S++)kC(o,a*g+S,g,p,y,x,E);for(let S=a;S<a+p;S++)kC(o,S*g+r,1,c,y,x,E)}function kC(o,r,a,c,p,g,y){g[0]=0,y[0]=-ag,y[1]=ag,p[0]=o[r];for(let x=1,E=0,S=0;x<c;x++){p[x]=o[r+x*a];const M=x*x;do{const L=g[E];S=(p[x]-p[L]+M-L*L)/(x-L)/2}while(S<=y[E]&&--E>-1);E++,g[E]=x,y[E]=S,y[E+1]=ag}for(let x=0,E=0;x<c;x++){for(;y[E+1]<x;)E++;const S=g[E],M=x-S;o[r+x*a]=p[S]+M*M}}const La=2,W1={none:0,ideographs:1,all:2};class Sp{constructor(r,a,c){this.requestManager=r,this.localGlyphMode=a,this.localFontFamily=c,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(r){this.url=r}getGlyphs(r,a){const c=[];for(const p in r)for(const g of r[p])c.push({stack:p,id:g});kt(c,({stack:p,id:g},y)=>{let x=this.entries[p];x||(x=this.entries[p]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let E=x.glyphs[g];if(E!==void 0)return void y(null,{stack:p,id:g,glyph:E});if(E=this._tinySDF(x,p,g),E)return x.glyphs[g]=E,void y(null,{stack:p,id:g,glyph:E});const S=Math.floor(g/256);if(256*S>65535)return void y(new Error("glyphs > 65535 not supported"));if(x.ranges[S])return void y(null,{stack:p,id:g,glyph:E});let M=x.requests[S];M||(M=x.requests[S]=[],Sp.loadGlyphRange(p,S,this.url,this.requestManager,(L,N)=>{if(N){x.ascender=N.ascender,x.descender=N.descender;for(const z in N.glyphs)this._doesCharSupportLocalGlyph(+z)||(x.glyphs[+z]=N.glyphs[+z]);x.ranges[S]=!0}for(const z of M)z(L,N);delete x.requests[S]})),M.push((L,N)=>{L?y(L):N&&y(null,{stack:p,id:g,glyph:N.glyphs[g]||null})})},(p,g)=>{if(p)a(p);else if(g){const y={};for(const{stack:x,id:E,glyph:S}of g)y[x]===void 0&&(y[x]={}),y[x].glyphs===void 0&&(y[x].glyphs={}),y[x].glyphs[E]=S&&{id:S.id,bitmap:S.bitmap.clone(),metrics:S.metrics},y[x].ascender=this.entries[x].ascender,y[x].descender=this.entries[x].descender;a(null,y)}})}_doesCharSupportLocalGlyph(r){return this.localGlyphMode!==W1.none&&(this.localGlyphMode===W1.all?!!this.localFontFamily:!!this.localFontFamily&&(yt["CJK Unified Ideographs"](r)||yt["Hangul Syllables"](r)||yt.Hiragana(r)||yt.Katakana(r)||yt["CJK Symbols and Punctuation"](r)))}_tinySDF(r,a,c){const p=this.localFontFamily;if(!p||!this._doesCharSupportLocalGlyph(c))return;let g=r.tinySDF;if(!g){let j="400";/bold/i.test(a)?j="900":/medium/i.test(a)?j="500":/light/i.test(a)&&(j="200"),g=r.tinySDF=new Sp.TinySDF({fontFamily:p,fontWeight:j,fontSize:24*La,buffer:3*La,radius:8*La}),g.fontWeight=j}if(this.localGlyphs[g.fontWeight][c])return this.localGlyphs[g.fontWeight][c];const y=String.fromCharCode(c),{data:x,width:E,height:S,glyphWidth:M,glyphHeight:L,glyphLeft:N,glyphTop:z,glyphAdvance:F}=g.draw(y);return this.localGlyphs[g.fontWeight][c]={id:c,bitmap:new lu({width:E,height:S},x),metrics:{width:M/La,height:L/La,left:N/La,top:z/La-27,advance:F/La,localGlyph:!0}}}}Sp.loadGlyphRange=function(o,r,a,c,p){const g=256*r,y=g+255,x=c.transformRequest(c.normalizeGlyphsURL(a).replace("{fontstack}",o).replace("{range}",`${g}-${y}`),ql.Glyphs);Uu(x,(E,S)=>{if(E)p(E);else if(S){const M={},L=function(N){return new rv(N).readFields(TN,{})}(S);for(const N of L.glyphs)M[N.id]=N;p(null,{glyphs:M,ascender:L.ascender,descender:L.descender})}})},Sp.TinySDF=class{constructor({fontSize:o=24,buffer:r=3,radius:a=8,cutoff:c=.25,fontFamily:p="sans-serif",fontWeight:g="normal",fontStyle:y="normal"}={}){this.buffer=r,this.cutoff=c,this.radius=a;const x=this.size=o+4*r,E=this._createCanvas(x),S=this.ctx=E.getContext("2d",{willReadFrequently:!0});S.font=`${y} ${g} ${o}px ${p}`,S.textBaseline="alphabetic",S.textAlign="left",S.fillStyle="black",this.gridOuter=new Float64Array(x*x),this.gridInner=new Float64Array(x*x),this.f=new Float64Array(x),this.z=new Float64Array(x+1),this.v=new Uint16Array(x)}_createCanvas(o){const r=document.createElement("canvas");return r.width=r.height=o,r}draw(o){const{width:r,actualBoundingBoxAscent:a,actualBoundingBoxDescent:c,actualBoundingBoxLeft:p,actualBoundingBoxRight:g}=this.ctx.measureText(o),y=Math.ceil(a),x=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(g-p))),E=Math.min(this.size-this.buffer,y+Math.ceil(c)),S=x+2*this.buffer,M=E+2*this.buffer,L=Math.max(S*M,0),N=new Uint8ClampedArray(L),z={data:N,width:S,height:M,glyphWidth:x,glyphHeight:E,glyphTop:y,glyphLeft:0,glyphAdvance:r};if(x===0||E===0)return z;const{ctx:F,buffer:j,gridInner:H,gridOuter:ne}=this;F.clearRect(j,j,x,E),F.fillText(o,j,j+y);const he=F.getImageData(j,j,x,E);ne.fill(ag,0,L),H.fill(0,0,L);for(let re=0;re<E;re++)for(let ue=0;ue<x;ue++){const pe=he.data[4*(re*x+ue)+3]/255;if(pe===0)continue;const fe=(re+j)*S+ue+j;if(pe===1)ne[fe]=0,H[fe]=ag;else{const ke=.5-pe;ne[fe]=ke>0?ke*ke:0,H[fe]=ke<0?ke*ke:0}}NC(ne,0,0,S,M,S,this.f,this.v,this.z),NC(H,j,j,x,E,S,this.f,this.v,this.z);for(let re=0;re<L;re++){const ue=Math.sqrt(ne[re])-Math.sqrt(H[re]);N[re]=Math.round(255-255*(ue/this.radius+this.cutoff))}return z}};const Tp=_o;function OC(o,r,a,c){const p=[],g=o.image,y=g.pixelRatio,x=g.paddedRect.w-2*Tp,E=g.paddedRect.h-2*Tp,S=o.right-o.left,M=o.bottom-o.top,L=g.stretchX||[[0,x]],N=g.stretchY||[[0,E]],z=(Be,Ke)=>Be+Ke[1]-Ke[0],F=L.reduce(z,0),j=N.reduce(z,0),H=x-F,ne=E-j;let he=0,re=F,ue=0,pe=j,fe=0,ke=H,De=0,Xe=ne;if(g.content&&c){const Be=g.content;he=ov(L,0,Be[0]),ue=ov(N,0,Be[1]),re=ov(L,Be[0],Be[2]),pe=ov(N,Be[1],Be[3]),fe=Be[0]-he,De=Be[1]-ue,ke=Be[2]-Be[0]-re,Xe=Be[3]-Be[1]-pe}const it=(Be,Ke,Je,tt)=>{const lt=sv(Be.stretch-he,re,S,o.left),je=av(Be.fixed-fe,ke,Be.stretch,F),mt=sv(Ke.stretch-ue,pe,M,o.top),Tt=av(Ke.fixed-De,Xe,Ke.stretch,j),_t=sv(Je.stretch-he,re,S,o.left),qt=av(Je.fixed-fe,ke,Je.stretch,F),ut=sv(tt.stretch-ue,pe,M,o.top),At=av(tt.fixed-De,Xe,tt.stretch,j),Xt=new xe(lt,mt),_n=new xe(_t,mt),$t=new xe(_t,ut),zt=new xe(lt,ut),Zn=new xe(je/y,Tt/y),Yt=new xe(qt/y,At/y),Kt=r*Math.PI/180;if(Kt){const Gn=Math.sin(Kt),Fn=Math.cos(Kt),ir=[Fn,-Gn,Gn,Fn];Xt._matMult(ir),_n._matMult(ir),zt._matMult(ir),$t._matMult(ir)}const zn=Be.stretch+Be.fixed,jn=Ke.stretch+Ke.fixed;return{tl:Xt,tr:_n,bl:zt,br:$t,tex:{x:g.paddedRect.x+Tp+zn,y:g.paddedRect.y+Tp+jn,w:Je.stretch+Je.fixed-zn,h:tt.stretch+tt.fixed-jn},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Zn,pixelOffsetBR:Yt,minFontScaleX:ke/y/S,minFontScaleY:Xe/y/M,isSDF:a}};if(c&&(g.stretchX||g.stretchY)){const Be=zC(L,H,F),Ke=zC(N,ne,j);for(let Je=0;Je<Be.length-1;Je++){const tt=Be[Je],lt=Be[Je+1];for(let je=0;je<Ke.length-1;je++)p.push(it(tt,Ke[je],lt,Ke[je+1]))}}else p.push(it({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:x+1},{fixed:0,stretch:E+1}));return p}function ov(o,r,a){let c=0;for(const p of o)c+=Math.max(r,Math.min(a,p[1]))-Math.max(r,Math.min(a,p[0]));return c}function zC(o,r,a){const c=[{fixed:-Tp,stretch:0}];for(const[p,g]of o){const y=c[c.length-1];c.push({fixed:p-y.stretch,stretch:y.stretch}),c.push({fixed:p-y.stretch,stretch:y.stretch+(g-p)})}return c.push({fixed:r+Tp,stretch:a}),c}function sv(o,r,a,c){return o/r*a+c}function av(o,r,a,c){return o-r*a/c}function RN(o,r,a,c){const p=r+o.positionedLines[c].lineOffset;return c===0?a+p/2:a+(p+(r+o.positionedLines[c-1].lineOffset))/2}class NN{constructor(r=[],a=kN){if(this.data=r,this.length=this.data.length,this.compare=a,this.length>0)for(let c=(this.length>>1)-1;c>=0;c--)this._down(c)}push(r){this.data.push(r),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const r=this.data[0],a=this.data.pop();return this.length--,this.length>0&&(this.data[0]=a,this._down(0)),r}peek(){return this.data[0]}_up(r){const{data:a,compare:c}=this,p=a[r];for(;r>0;){const g=r-1>>1,y=a[g];if(c(p,y)>=0)break;a[r]=y,r=g}a[r]=p}_down(r){const{data:a,compare:c}=this,p=this.length>>1,g=a[r];for(;r<p;){let y=1+(r<<1),x=a[y];const E=y+1;if(E<this.length&&c(a[E],x)<0&&(y=E,x=a[E]),c(x,g)>=0)break;a[r]=x,r=y}a[r]=g}}function kN(o,r){return o<r?-1:o>r?1:0}function ON(o,r=1,a=!1){let c=1/0,p=1/0,g=-1/0,y=-1/0;const x=o[0];for(let z=0;z<x.length;z++){const F=x[z];(!z||F.x<c)&&(c=F.x),(!z||F.y<p)&&(p=F.y),(!z||F.x>g)&&(g=F.x),(!z||F.y>y)&&(y=F.y)}const E=Math.min(g-c,y-p);let S=E/2;const M=new NN([],zN);if(E===0)return new xe(c,p);for(let z=c;z<g;z+=E)for(let F=p;F<y;F+=E)M.push(new Cp(z+S,F+S,S,o));let L=function(z){let F=0,j=0,H=0;const ne=z[0];for(let he=0,re=ne.length,ue=re-1;he<re;ue=he++){const pe=ne[he],fe=ne[ue],ke=pe.x*fe.y-fe.x*pe.y;j+=(pe.x+fe.x)*ke,H+=(pe.y+fe.y)*ke,F+=3*ke}return new Cp(j/F,H/F,0,z)}(o),N=M.length;for(;M.length;){const z=M.pop();(z.d>L.d||!L.d)&&(L=z,a&&console.log("found best %d after %d probes",Math.round(1e4*z.d)/1e4,N)),z.max-L.d<=r||(S=z.h/2,M.push(new Cp(z.p.x-S,z.p.y-S,S,o)),M.push(new Cp(z.p.x+S,z.p.y-S,S,o)),M.push(new Cp(z.p.x-S,z.p.y+S,S,o)),M.push(new Cp(z.p.x+S,z.p.y+S,S,o)),N+=4)}return a&&(console.log(`num probes: ${N}`),console.log(`best distance: ${L.d}`)),L.p}function zN(o,r){return r.max-o.max}class Cp{constructor(r,a,c,p){this.p=new xe(r,a),this.h=c,this.d=function(g,y){let x=!1,E=1/0;for(let S=0;S<y.length;S++){const M=y[S];for(let L=0,N=M.length,z=N-1;L<N;z=L++){const F=M[L],j=M[z];F.y>g.y!=j.y>g.y&&g.x<(j.x-F.x)*(g.y-F.y)/(j.y-F.y)+F.x&&(x=!x),E=Math.min(E,DT(g,F,j))}}return(x?1:-1)*Math.sqrt(E)}(this.p,p),this.max=this.d+this.h*Math.SQRT2}}const Ip=7,H1=Number.POSITIVE_INFINITY,FN=Math.sqrt(2);function FC(o,[r,a]){let c=0,p=0;if(a===H1){r<0&&(r=0);const g=r/FN;switch(o){case"top-right":case"top-left":p=g-Ip;break;case"bottom-right":case"bottom-left":p=-g+Ip;break;case"bottom":p=-r+Ip;break;case"top":p=r-Ip}switch(o){case"top-right":case"bottom-right":c=-g;break;case"top-left":case"bottom-left":c=g;break;case"left":c=r;break;case"right":c=-r}}else{switch(r=Math.abs(r),a=Math.abs(a),o){case"top-right":case"top-left":case"top":p=a-Ip;break;case"bottom-right":case"bottom-left":case"bottom":p=-a+Ip}switch(o){case"top-right":case"bottom-right":case"right":c=-r;break;case"top-left":case"bottom-left":case"left":c=r}}return[c,p]}function BN(o,r,a,c,p,g,y,x,E,S){o.createArrays(),o.tilePixelRatio=Rt/(512*o.overscaling),o.compareText={},o.iconsNeedLinear=!1;const M=o.layers[0].layout,L=o.layers[0]._unevaluatedLayout._values,N={};if(o.textSizeData.kind==="composite"){const{minZoom:j,maxZoom:H}=o.textSizeData;N.compositeTextSizes=[L["text-size"].possiblyEvaluate(new P(j),x),L["text-size"].possiblyEvaluate(new P(H),x)]}if(o.iconSizeData.kind==="composite"){const{minZoom:j,maxZoom:H}=o.iconSizeData;N.compositeIconSizes=[L["icon-size"].possiblyEvaluate(new P(j),x),L["icon-size"].possiblyEvaluate(new P(H),x)]}N.layoutTextSize=L["text-size"].possiblyEvaluate(new P(E+1),x),N.layoutIconSize=L["icon-size"].possiblyEvaluate(new P(E+1),x),N.textMaxSize=L["text-size"].possiblyEvaluate(new P(18),x);const z=M.get("text-rotation-alignment")==="map"&&M.get("symbol-placement")!=="point",F=M.get("text-size");for(const j of o.features){const H=M.get("text-font").evaluate(j,{},x).join(","),ne=F.evaluate(j,{},x),he=N.layoutTextSize.evaluate(j,{},x),re=(N.layoutIconSize.evaluate(j,{},x),{horizontal:{},vertical:void 0}),ue=j.text;let pe,fe=[0,0];if(ue){const Xe=ue.toString(),it=M.get("text-letter-spacing").evaluate(j,{},x)*pi,Be=M.get("text-line-height").evaluate(j,{},x)*pi,Ke=i1(Xe)?it:0,Je=M.get("text-anchor").evaluate(j,{},x),tt=M.get("text-variable-anchor");if(!tt){const _t=M.get("text-radial-offset").evaluate(j,{},x);fe=_t?FC(Je,[_t*pi,H1]):M.get("text-offset").evaluate(j,{},x).map(qt=>qt*pi)}let lt=z?"center":M.get("text-justify").evaluate(j,{},x);const je=M.get("symbol-placement")==="point",mt=je?M.get("text-max-width").evaluate(j,{},x)*pi:1/0,Tt=_t=>{o.allowVerticalPlacement&&Dm(Xe)&&(re.vertical=$1(ue,r,a,p,H,mt,Be,Je,_t,Ke,fe,us.vertical,!0,he,ne))};if(!z&&tt){const _t=lt==="auto"?tt.map(ut=>Y1(ut)):[lt];let qt=!1;for(let ut=0;ut<_t.length;ut++){const At=_t[ut];if(!re.horizontal[At])if(qt)re.horizontal[At]=re.horizontal[0];else{const Xt=$1(ue,r,a,p,H,mt,Be,"center",At,Ke,fe,us.horizontal,!1,he,ne);Xt&&(re.horizontal[At]=Xt,qt=Xt.positionedLines.length===1)}}Tt("left")}else{if(lt==="auto"&&(lt=Y1(Je)),je||M.get("text-writing-mode").indexOf("horizontal")>=0||!Dm(Xe)){const _t=$1(ue,r,a,p,H,mt,Be,Je,lt,Ke,fe,us.horizontal,!1,he,ne);_t&&(re.horizontal[lt]=_t)}Tt(je?"left":lt)}}let ke=!1;if(j.icon&&j.icon.name){const Xe=c[j.icon.name];Xe&&(pe=PN(p[j.icon.name],M.get("icon-offset").evaluate(j,{},x),M.get("icon-anchor").evaluate(j,{},x)),ke=Xe.sdf,o.sdfIcons===void 0?o.sdfIcons=Xe.sdf:o.sdfIcons!==Xe.sdf&&nr("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Xe.pixelRatio!==o.pixelRatio||M.get("icon-rotate").constantOr(1)!==0)&&(o.iconsNeedLinear=!0))}const De=UC(re.horizontal)||re.vertical;o.iconsInText||(o.iconsInText=!!De&&De.iconsInText),(De||pe)&&UN(o,j,re,pe,c,N,he,0,fe,ke,y,x,S)}g&&o.generateCollisionDebugBuffers(E,o.collisionBoxArray)}function Y1(o){switch(o){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function UN(o,r,a,c,p,g,y,x,E,S,M,L,N){let z=g.textMaxSize.evaluate(r,{},L);z===void 0&&(z=y);const F=o.layers[0].layout,j=F.get("icon-offset").evaluate(r,{},L),H=UC(a.horizontal)||a.vertical,ne=N.name==="globe",he=pi,re=y/he,ue=o.tilePixelRatio*z/he,pe=(Je=o.overscaling,o.zoom>18&&Je>2&&(Je>>=1),Math.max(Rt/(512*Je),1)*F.get("symbol-spacing")),fe=F.get("text-padding")*o.tilePixelRatio,ke=F.get("icon-padding")*o.tilePixelRatio,De=He(F.get("text-max-angle")),Xe=F.get("text-rotation-alignment")==="map"&&F.get("symbol-placement")!=="point",it=F.get("icon-rotation-alignment")==="map"&&F.get("symbol-placement")!=="point",Be=F.get("symbol-placement"),Ke=pe/2;var Je;const tt=F.get("icon-text-fit");let lt;c&&tt!=="none"&&(o.allowVerticalPlacement&&a.vertical&&(lt=IC(c,a.vertical,tt,F.get("icon-text-fit-padding"),j,re)),H&&(c=IC(c,H,tt,F.get("icon-text-fit-padding"),j,re)));const je=(mt,Tt,_t)=>{if(Tt.x<0||Tt.x>=Rt||Tt.y<0||Tt.y>=Rt)return;let qt=null;if(ne){const{x:ut,y:At,z:Xt}=N.projectTilePoint(Tt.x,Tt.y,_t);qt={anchor:new cu(ut,At,Xt,0,void 0),up:N.upVector(_t,Tt.x,Tt.y)}}(function(ut,At,Xt,_n,$t,zt,Zn,Yt,Kt,zn,jn,Gn,Fn,ir,pr,Lr,Bn,Xr,Dr,ar,vn,Rr,qn,eo,Nr){const di=ut.addToLineVertexArray(At,_n);let ni,to,ri,Ra,Pp,gg,_g,vI=0,xI=0,wI=0,bI=0,hw=-1,fw=-1;const vl={};let EI=a1("");const jh=Xt?Xt.anchor:At;let pw=0,dw=0;if(Kt._unevaluatedLayout.getValue("text-radial-offset")===void 0?[pw,dw]=Kt.layout.get("text-offset").evaluate(vn,{},Nr).map(Bo=>Bo*pi):(pw=Kt.layout.get("text-radial-offset").evaluate(vn,{},Nr)*pi,dw=H1),ut.allowVerticalPlacement&&$t.vertical){const Bo=$t.vertical;if(pr)gg=K1(Bo),Yt&&(_g=K1(Yt));else{const Uo=Kt.layout.get("text-rotate").evaluate(vn,{},Nr)+90;ri=lv(zn,jh,At,jn,Gn,Fn,Bo,ir,Uo,Lr),Yt&&(Ra=lv(zn,jh,At,jn,Gn,Fn,Yt,Xr,Uo))}}if(zt){const Bo=Kt.layout.get("icon-rotate").evaluate(vn,{},Nr),Uo=Kt.layout.get("icon-text-fit")!=="none",yg=OC(zt,Bo,qn,Uo),gw=Yt?OC(Yt,Bo,qn,Uo):void 0;to=lv(zn,jh,At,jn,Gn,Fn,zt,Xr,Bo),vI=4*yg.length;const SI=ut.iconSizeData;let Gh=null;SI.kind==="source"?(Gh=[Pa*Kt.layout.get("icon-size").evaluate(vn,{},Nr)],Gh[0]>cc&&nr(`${ut.layerIds[0]}: Value for "icon-size" is >= ${lg}. Reduce your "icon-size".`)):SI.kind==="composite"&&(Gh=[Pa*Rr.compositeIconSizes[0].evaluate(vn,{},Nr),Pa*Rr.compositeIconSizes[1].evaluate(vn,{},Nr)],(Gh[0]>cc||Gh[1]>cc)&&nr(`${ut.layerIds[0]}: Value for "icon-size" is >= ${lg}. Reduce your "icon-size".`)),ut.addSymbols(ut.icon,yg,Gh,ar,Dr,vn,!1,Xt,At,di.lineStartIndex,di.lineLength,-1,eo,Nr),hw=ut.icon.placedSymbolArray.length-1,gw&&(xI=4*gw.length,ut.addSymbols(ut.icon,gw,Gh,ar,Dr,vn,us.vertical,Xt,At,di.lineStartIndex,di.lineLength,-1,eo,Nr),fw=ut.icon.placedSymbolArray.length-1)}for(const Bo in $t.horizontal){const Uo=$t.horizontal[Bo];ni||(EI=a1(Uo.text),pr?Pp=K1(Uo):ni=lv(zn,jh,At,jn,Gn,Fn,Uo,ir,Kt.layout.get("text-rotate").evaluate(vn,{},Nr),Lr));const yg=Uo.positionedLines.length===1;if(wI+=BC(ut,Xt,At,Uo,Zn,Kt,pr,vn,Lr,di,$t.vertical?us.horizontal:us.horizontalOnly,yg?Object.keys($t.horizontal):[Bo],vl,hw,Rr,eo,Nr),yg)break}$t.vertical&&(bI+=BC(ut,Xt,At,$t.vertical,Zn,Kt,pr,vn,Lr,di,us.vertical,["vertical"],vl,fw,Rr,eo,Nr));let gc=-1;const mw=(Bo,Uo)=>Bo?Math.max(Bo,Uo):Uo;gc=mw(Pp,gc),gc=mw(gg,gc),gc=mw(_g,gc);const dk=gc>-1?1:0;ut.glyphOffsetArray.length>=fc.MAX_GLYPHS&&nr("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),vn.sortKey!==void 0&&ut.addToSortKeyRanges(ut.symbolInstances.length,vn.sortKey),ut.symbolInstances.emplaceBack(jh.x,jh.y,jh.z,At.x,At.y,vl.right>=0?vl.right:-1,vl.center>=0?vl.center:-1,vl.left>=0?vl.left:-1,vl.vertical>=0?vl.vertical:-1,hw,fw,EI,ni!==void 0?ni:ut.collisionBoxArray.length,ni!==void 0?ni+1:ut.collisionBoxArray.length,ri!==void 0?ri:ut.collisionBoxArray.length,ri!==void 0?ri+1:ut.collisionBoxArray.length,to!==void 0?to:ut.collisionBoxArray.length,to!==void 0?to+1:ut.collisionBoxArray.length,Ra||ut.collisionBoxArray.length,Ra?Ra+1:ut.collisionBoxArray.length,jn,wI,bI,vI,xI,dk,0,pw,dw,gc)})(o,Tt,qt,mt,a,c,p,lt,o.layers[0],o.collisionBoxArray,r.index,r.sourceLayerIndex,o.index,fe,Xe,E,0,ke,it,j,r,g,S,M,L)};if(Be==="line")for(const mt of RC(r.geometry,0,0,Rt,Rt)){const Tt=DN(mt,pe,De,a.vertical||H,c,he,ue,o.overscaling,Rt);for(const _t of Tt)H&&VN(o,H.text,Ke,_t)||je(mt,_t,L)}else if(Be==="line-center"){for(const mt of r.geometry)if(mt.length>1){const Tt=LN(mt,De,a.vertical||H,c,he,ue);Tt&&je(mt,Tt,L)}}else if(r.type==="Polygon")for(const mt of z1(r.geometry,0)){const Tt=ON(mt,16);je(mt[0],new cu(Tt.x,Tt.y,0,0,void 0),L)}else if(r.type==="LineString")for(const mt of r.geometry)je(mt,new cu(mt[0].x,mt[0].y,0,0,void 0),L);else if(r.type==="Point")for(const mt of r.geometry)for(const Tt of mt)je([Tt],new cu(Tt.x,Tt.y,0,0,void 0),L)}const lg=255,cc=lg*Pa;function BC(o,r,a,c,p,g,y,x,E,S,M,L,N,z,F,j,H){const ne=function(ue,pe,fe,ke,De,Xe,it,Be){const Ke=[];if(pe.positionedLines.length===0)return Ke;const Je=ke.layout.get("text-rotate").evaluate(Xe,{})*Math.PI/180,tt=function(_t){const qt=_t[0],ut=_t[1],At=qt*ut;return At>0?[qt,-ut]:At<0?[-qt,ut]:qt===0?[ut,qt]:[ut,-qt]}(fe);let lt=Math.abs(pe.top-pe.bottom);for(const _t of pe.positionedLines)lt-=_t.lineOffset;const je=pe.positionedLines.length,mt=lt/je;let Tt=pe.top-fe[1];for(let _t=0;_t<je;++_t){const qt=pe.positionedLines[_t];Tt=RN(pe,mt,Tt,_t);for(const ut of qt.positionedGlyphs){if(!ut.rect)continue;const At=ut.rect||{};let Xt=vC+1,_n=!0,$t=1,zt=0;if(ut.imageName){const qn=it[ut.imageName];if(!qn)continue;if(qn.sdf){nr("SDF images are not supported in formatted text and will be ignored.");continue}_n=!1,$t=qn.pixelRatio,Xt=_o/$t}const Zn=(De||Be)&&ut.vertical,Yt=ut.metrics.advance*ut.scale/2,Kt=ut.metrics,zn=ut.rect;if(zn===null)continue;Be&&pe.verticalizable&&(zt=ut.imageName?Yt-ut.metrics.width*ut.scale/2:0);const jn=De?[ut.x+Yt,ut.y]:[0,0];let Gn=[0,0],Fn=[0,0],ir=!1;De||(Zn?(Fn=[ut.x+Yt+tt[0],ut.y+tt[1]-zt],ir=!0):Gn=[ut.x+Yt+fe[0],ut.y+fe[1]-zt]);const pr=zn.w*ut.scale/($t*(ut.localGlyph?La:1)),Lr=zn.h*ut.scale/($t*(ut.localGlyph?La:1));let Bn,Xr,Dr,ar;if(Zn){const qn=ut.y-Tt,eo=new xe(-Yt,Yt-qn),Nr=-Math.PI/2,di=new xe(...Fn);Bn=new xe(-Yt+Gn[0],Gn[1]),Bn._rotateAround(Nr,eo)._add(di),Bn.x+=-qn+Yt,Bn.y-=(Kt.left-Xt)*ut.scale;const ni=ut.imageName?Kt.advance*ut.scale:pi*ut.scale,to=String.fromCharCode(ut.glyph);dN(to)?Bn.x+=(1-Xt)*ut.scale:mN(to)?Bn.x+=ni-Kt.height*ut.scale+(-Xt-1)*ut.scale:Bn.x+=ut.imageName||Kt.width+2*Xt===zn.w&&Kt.height+2*Xt===zn.h?(ni-Lr)/2:(ni-(Kt.height+2*Xt)*ut.scale)/2,Xr=new xe(Bn.x,Bn.y-pr),Dr=new xe(Bn.x+Lr,Bn.y),ar=new xe(Bn.x+Lr,Bn.y-pr)}else{const qn=(Kt.left-Xt)*ut.scale-Yt+Gn[0],eo=(-Kt.top-Xt)*ut.scale+Gn[1],Nr=qn+pr,di=eo+Lr;Bn=new xe(qn,eo),Xr=new xe(Nr,eo),Dr=new xe(qn,di),ar=new xe(Nr,di)}if(Je){let qn;qn=De?new xe(0,0):ir?new xe(tt[0],tt[1]):new xe(fe[0],fe[1]),Bn._rotateAround(Je,qn),Xr._rotateAround(Je,qn),Dr._rotateAround(Je,qn),ar._rotateAround(Je,qn)}const vn=new xe(0,0),Rr=new xe(0,0);Ke.push({tl:Bn,tr:Xr,bl:Dr,br:ar,tex:At,writingMode:pe.writingMode,glyphOffset:jn,sectionIndex:ut.sectionIndex,isSDF:_n,pixelOffsetTL:vn,pixelOffsetBR:Rr,minFontScaleX:0,minFontScaleY:0})}}return Ke}(0,c,E,g,y,x,p,o.allowVerticalPlacement),he=o.textSizeData;let re=null;he.kind==="source"?(re=[Pa*g.layout.get("text-size").evaluate(x,{},H)],re[0]>cc&&nr(`${o.layerIds[0]}: Value for "text-size" is >= ${lg}. Reduce your "text-size".`)):he.kind==="composite"&&(re=[Pa*F.compositeTextSizes[0].evaluate(x,{},H),Pa*F.compositeTextSizes[1].evaluate(x,{},H)],(re[0]>cc||re[1]>cc)&&nr(`${o.layerIds[0]}: Value for "text-size" is >= ${lg}. Reduce your "text-size".`)),o.addSymbols(o.text,ne,re,E,y,x,M,r,a,S.lineStartIndex,S.lineLength,z,j,H);for(const ue of L)N[ue]=o.text.placedSymbolArray.length-1;return 4*ne.length}function UC(o){for(const r in o)return o[r];return null}function lv(o,r,a,c,p,g,y,x,E,S){let M=y.top,L=y.bottom,N=y.left,z=y.right;const F=y.collisionPadding;if(F&&(N-=F[0],M-=F[1],z+=F[2],L+=F[3]),E){const j=new xe(N,M),H=new xe(z,M),ne=new xe(N,L),he=new xe(z,L),re=He(E);let ue=new xe(0,0);S&&(ue=new xe(S[0],S[1])),j._rotateAround(re,ue),H._rotateAround(re,ue),ne._rotateAround(re,ue),he._rotateAround(re,ue),N=Math.min(j.x,H.x,ne.x,he.x),z=Math.max(j.x,H.x,ne.x,he.x),M=Math.min(j.y,H.y,ne.y,he.y),L=Math.max(j.y,H.y,ne.y,he.y)}return o.emplaceBack(r.x,r.y,r.z,a.x,a.y,N,M,z,L,x,c,p,g),o.length-1}function K1(o){o.collisionPadding&&(o.top-=o.collisionPadding[1],o.bottom+=o.collisionPadding[3]);const r=o.bottom-o.top;return r>0?Math.max(10,r):null}function VN(o,r,a,c){const p=o.compareText;if(r in p){const g=p[r];for(let y=g.length-1;y>=0;y--)if(c.dist(g[y])<a)return!0}else p[r]=[];return p[r].push(c),!1}function VC(o,r){const a=o.fovAboveCenter,c=o.elevation?o.elevation.getMinElevationBelowMSL()*r:0,p=(o._camera.position[2]*o.worldSize-c)/Math.cos(o._pitch),g=Math.sin(a)*p/Math.sin(Math.max(Math.PI/2-o._pitch-a,.01)),y=Math.sin(o._pitch)*g+p;return Math.min(1.01*y,p*(1/o._horizonShift))}function Uh(o,r){if(!r.isReprojectedInTileSpace)return{scale:1<<o.z,x:o.x,y:o.y,x2:o.x+1,y2:o.y+1,projection:r};const a=Math.pow(2,-o.z),c=o.x*a,p=(o.x+1)*a,g=o.y*a,y=(o.y+1)*a,x=ls(c),E=ls(p),S=Si(g),M=Si(y),L=r.project(x,S),N=r.project(E,S),z=r.project(E,M),F=r.project(x,M);let j=Math.min(L.x,N.x,z.x,F.x),H=Math.min(L.y,N.y,z.y,F.y),ne=Math.max(L.x,N.x,z.x,F.x),he=Math.max(L.y,N.y,z.y,F.y);const re=a/16;function ue(fe,ke,De,Xe,it,Be){const Ke=(De+it)/2,Je=(Xe+Be)/2,tt=r.project(ls(Ke),Si(Je)),lt=Math.max(0,j-tt.x,H-tt.y,tt.x-ne,tt.y-he);j=Math.min(j,tt.x),ne=Math.max(ne,tt.x),H=Math.min(H,tt.y),he=Math.max(he,tt.y),lt>re&&(ue(fe,tt,De,Xe,Ke,Je),ue(tt,ke,Ke,Je,it,Be))}ue(L,N,c,g,p,g),ue(N,z,p,g,p,y),ue(z,F,p,y,c,y),ue(F,L,c,y,c,g),j-=re,H-=re,ne+=re,he+=re;const pe=1/Math.max(ne-j,he-H);return{scale:pe,x:j*pe,y:H*pe,x2:ne*pe,y2:he*pe,projection:r}}const jN=Ia(new Float32Array(16));class hc{constructor(r){this.spec=r,this.name=r.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(r,a){return{x:0,y:0,z:0}}unproject(r,a){return new On(0,0)}projectTilePoint(r,a,c){return{x:r,y:a,z:0}}locationPoint(r,a,c=!0){return r._coordinatePoint(r.locationCoordinate(a),c)}pixelsPerMeter(r,a){return Aa(1,r)*a}pixelSpaceConversion(r,a,c){return 1}farthestPixelDistance(r){return VC(r,r.pixelsPerMeter)}pointCoordinate(r,a,c,p){const g=r.horizonLineFromTop(!1),y=new xe(a,Math.max(g,c));return r.rayIntersectionCoordinate(r.pointRayIntersection(y,p))}pointCoordinate3D(r,a,c){const p=new xe(a,c);if(r.elevation)return r.elevation.pointCoordinate(p);{const g=this.pointCoordinate(r,p.x,p.y,0);return[g.x,g.y,g.z]}}isPointAboveHorizon(r,a){if(r.elevation)return!this.pointCoordinate3D(r,a.x,a.y);const c=r.horizonLineFromTop();return a.y<c}createInversionMatrix(r,a){return jN}createTileMatrix(r,a,c){let p,g,y;const x=c.canonical,E=Ia(new Float64Array(16));if(this.isReprojectedInTileSpace){const S=Uh(x,this);p=1,g=S.x+c.wrap*S.scale,y=S.y,Rh(E,E,[p/S.scale,p/S.scale,r.pixelsPerMeter/a])}else p=a/r.zoomScale(x.z),g=(x.x+Math.pow(2,x.z)*c.wrap)*p,y=x.y*p;return Bm(E,E,[g,y,0]),Rh(E,E,[p/Rt,p/Rt,1]),E}upVector(r,a,c){return[0,0,1]}upVectorScale(r,a,c){return{metersToTile:1}}}class GN extends hc{constructor(r){super(r),this.range=[4,7],this.center=r.center||[-96,37.5];const[a,c]=this.parallels=r.parallels||[29.5,45.5],p=Math.sin(He(a));this.n=(p+Math.sin(He(c)))/2,this.c=1+p*(2*this.n-p),this.r0=Math.sqrt(this.c)/this.n}project(r,a){const{n:c,c:p,r0:g}=this,y=He(r-this.center[0]),x=He(a),E=Math.sqrt(p-2*c*Math.sin(x))/c;return{x:E*Math.sin(y*c),y:E*Math.cos(y*c)-g,z:0}}unproject(r,a){const{n:c,c:p,r0:g}=this,y=g+a;let x=Math.atan2(r,Math.abs(y))*Math.sign(y);y*c<0&&(x-=Math.PI*Math.sign(r)*Math.sign(y));const E=He(this.center[0])*c;x=Ct(x,-Math.PI-E,Math.PI-E);const S=qe($e(x/c)+this.center[0],-180,180),M=Math.asin(qe((p-(r*r+y*y)*c*c)/(2*c),-1,1)),L=qe($e(M),-Ti,Ti);return new On(S,L)}}const ug=1.340264,cg=-.081106,hg=893e-6,fg=.003796,uv=Math.sqrt(3)/2;class qN extends hc{project(r,a){a=a/180*Math.PI,r=r/180*Math.PI;const c=Math.asin(uv*Math.sin(a)),p=c*c,g=p*p*p;return{x:.5*(r*Math.cos(c)/(uv*(ug+3*cg*p+g*(7*hg+9*fg*p)))/Math.PI+.5),y:1-.5*(c*(ug+cg*p+g*(hg+fg*p))/Math.PI+1),z:0}}unproject(r,a){r=(2*r-.5)*Math.PI;let c=a=(2*(1-a)-1)*Math.PI,p=c*c,g=p*p*p;for(let M,L,N,z=0;z<12&&(L=c*(ug+cg*p+g*(hg+fg*p))-a,N=ug+3*cg*p+g*(7*hg+9*fg*p),M=L/N,c=qe(c-M,-Math.PI/3,Math.PI/3),p=c*c,g=p*p*p,!(Math.abs(M)<1e-12));++z);const y=uv*r*(ug+3*cg*p+g*(7*hg+9*fg*p))/Math.cos(c),x=Math.asin(Math.sin(c)/uv),E=qe(180*y/Math.PI,-180,180),S=qe(180*x/Math.PI,-Ti,Ti);return new On(E,S)}}class XN extends hc{constructor(r){super(r),this.wrap=!0,this.supportsWorldCopies=!0}project(r,a){return{x:.5+r/360,y:.5-a/360,z:0}}unproject(r,a){const c=360*(r-.5),p=qe(360*(.5-a),-Ti,Ti);return new On(c,p)}}const Mp=Math.PI/2;function cv(o){return Math.tan((Mp+o)/2)}class $N extends hc{constructor(r){super(r),this.center=r.center||[0,30];const[a,c]=this.parallels=r.parallels||[30,30];let p=He(a),g=He(c);this.southernCenter=p+g<0,this.southernCenter&&(p=-p,g=-g);const y=Math.cos(p),x=cv(p);this.n=p===g?Math.sin(p):Math.log(y/Math.cos(g))/Math.log(cv(g)/x),this.f=y*Math.pow(cv(p),this.n)/this.n}project(r,a){a=He(a),this.southernCenter&&(a=-a),r=He(r-this.center[0]);const c=1e-6,{n:p,f:g}=this;g>0?a<-Mp+c&&(a=-Mp+c):a>Mp-c&&(a=Mp-c);const y=g/Math.pow(cv(a),p);let x=y*Math.sin(p*r),E=g-y*Math.cos(p*r);return x=.5*(x/Math.PI+.5),E=.5*(E/Math.PI+.5),{x,y:this.southernCenter?E:1-E,z:0}}unproject(r,a){r=(2*r-.5)*Math.PI,this.southernCenter&&(a=1-a),a=(2*(1-a)-.5)*Math.PI;const{n:c,f:p}=this,g=p-a,y=Math.sign(g),x=Math.sign(c)*Math.sqrt(r*r+g*g);let E=Math.atan2(r,Math.abs(g))*y;g*c<0&&(E-=Math.PI*Math.sign(r)*y);const S=qe($e(E/c)+this.center[0],-180,180),M=qe($e(2*Math.atan(Math.pow(p/x,1/c))-Mp),-Ti,Ti);return new On(S,this.southernCenter?-M:M)}}class jC extends hc{constructor(r){super(r),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(r,a){return{x:dl(r),y:ml(a),z:0}}unproject(r,a){const c=ls(r),p=Si(a);return new On(c,p)}}const GC=He(Ti);class ZN extends hc{project(r,a){const c=(a=He(a))*a,p=c*c;return{x:.5*((r=He(r))*(.8707-.131979*c+p*(p*(.003971*c-.001529*p)-.013791))/Math.PI+.5),y:1-.5*(a*(1.007226+c*(.015085+p*(.028874*c-.044475-.005916*p)))/Math.PI+1),z:0}}unproject(r,a){r=(2*r-.5)*Math.PI;let c=a=(2*(1-a)-1)*Math.PI,p=25,g=0,y=c*c;do{y=c*c;const S=y*y;g=(c*(1.007226+y*(.015085+S*(.028874*y-.044475-.005916*S)))-a)/(1.007226+y*(.045255+S*(.259866*y-.311325-.005916*11*S))),c=qe(c-g,-GC,GC)}while(Math.abs(g)>1e-6&&--p>0);y=c*c;const x=qe($e(r/(.8707+y*(y*(y*y*y*(.003971-.001529*y)-.013791)-.131979))),-180,180),E=$e(c);return new On(x,E)}}const qC=He(Ti);class WN extends hc{project(r,a){a=He(a),r=He(r);const c=Math.cos(a),p=2/Math.PI,g=Math.acos(c*Math.cos(r/2)),y=Math.sin(g)/g,x=.5*(r*p+2*c*Math.sin(r/2)/y)||0,E=.5*(a+Math.sin(a)/y)||0;return{x:.5*(x/Math.PI+.5),y:1-.5*(E/Math.PI+1),z:0}}unproject(r,a){let c=r=(2*r-.5)*Math.PI,p=a=(2*(1-a)-1)*Math.PI,g=25;const y=1e-6;let x=0,E=0;do{const S=Math.cos(p),M=Math.sin(p),L=2*M*S,N=M*M,z=S*S,F=Math.cos(c/2),j=Math.sin(c/2),H=2*F*j,ne=j*j,he=1-z*F*F,re=he?1/he:0,ue=he?Math.acos(S*F)*Math.sqrt(1/he):0,pe=.5*(2*ue*S*j+2*c/Math.PI)-r,fe=.5*(ue*M+p)-a,ke=.5*re*(z*ne+ue*S*F*N)+1/Math.PI,De=re*(H*L/4-ue*M*j),Xe=.125*re*(L*j-ue*M*z*H),it=.5*re*(N*F+ue*ne*S)+.5,Be=De*Xe-it*ke;x=(fe*De-pe*it)/Be,E=(pe*Xe-fe*ke)/Be,c=qe(c-x,-Math.PI,Math.PI),p=qe(p-E,-qC,qC)}while((Math.abs(x)>y||Math.abs(E)>y)&&--g>0);return new On($e(c),$e(p))}}class XC extends hc{constructor(r){super(r),this.center=r.center||[0,0],this.parallels=r.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(He(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(r,a){const{scale:c,cosPhi:p}=this;return{x:He(r)*p*c+.5,y:-Math.sin(He(a))/p*c+.5,z:0}}unproject(r,a){const{scale:c,cosPhi:p}=this,g=-(a-.5)/c,y=qe($e((r-.5)/c)/p,-180,180),x=Math.asin(qe(g*p,-1,1)),E=qe($e(x),-Ti,Ti);return new On(y,E)}}class HN extends jC{constructor(r){super(r),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(r,a,c){const p=Zm(r,a,c);return wr(p,p,Wm(pl(c))),{x:p[0],y:p[1],z:p[2]}}locationPoint(r,a){const c=pp(a.lat,a.lng),p=Ki([],c),g=r.elevation?r.elevation.getAtPointOrZero(r.locationCoordinate(a),r._centerAltitude):r._centerAltitude;Gm(c,c,p,Aa(1,0)*Rt*g);const y=Ia(new Float64Array(16));return Dh(y,r.pixelMatrix,r.globeMatrix),wr(c,c,y),new xe(c[0],c[1])}pixelsPerMeter(r,a){return Aa(1,0)*a}pixelSpaceConversion(r,a,c){const p=Aa(1,r)*a,g=mn(Aa(1,45)*a,p,c);return this.pixelsPerMeter(r,a)/g}createTileMatrix(r,a,c){const p=w1(pl(c.canonical));return Dh(new Float64Array(16),r.globeMatrix,p)}createInversionMatrix(r,a){const{center:c}=r,p=Wm(pl(a));return Fy(p,p,He(c.lng)),h1(p,p,He(c.lat)),Rh(p,p,[r._pixelsPerMercatorPixel,r._pixelsPerMercatorPixel,1]),Float32Array.from(p)}pointCoordinate(r,a,c,p){return yT(r,a,c,!0)||new mp(0,0)}pointCoordinate3D(r,a,c){const p=this.pointCoordinate(r,a,c,0);return[p.x,p.y,p.z]}isPointAboveHorizon(r,a){return!yT(r,a.x,a.y,!1)}farthestPixelDistance(r){const a=function(p,g){const y=p.cameraToCenterDistance,x=p._centerAltitude*g,E=p._camera,S=p._camera.forward(),M=su([],as([],S,-y),[0,0,x]),L=p.worldSize/(2*Math.PI),N=[0,0,-L],z=p.width/p.height,F=Math.tan(p.fovAboveCenter),j=as([],E.up(),F),H=as([],E.right(),F*z),ne=Ki([],su([],su([],S,j),H)),he=[];let re;if(new m1(M,ne).closestPointOnSphere(N,L,he)){const ue=su([],he,N),pe=Ma([],ue,M);re=Math.cos(p.fovAboveCenter)*Um(pe)}else{const ue=Ma([],M,N),pe=Ma([],N,M);Ki(pe,pe);const fe=Um(ue)-L;re=Math.sqrt(fe*(fe+2*L));const ke=Math.acos(re/(L+fe))-Math.acos(Fs(S,pe));re*=Math.cos(ke)}return 1.01*re}(r,this.pixelsPerMeter(r.center.lat,r.worldSize)),c=dp(r.zoom);if(c>0){const p=VC(r,Aa(1,r.center.lat)*r.worldSize),g=r.worldSize/(2*Math.PI),y=Math.max(r.width,r.height)/r.worldSize*Math.PI;return mn(a,p+g*(1-Math.cos(y)),Math.pow(c,10))}return a}upVector(r,a,c){return Zm(a,c,r,1)}upVectorScale(r){return{metersToTile:By(Vy(pl(r)))}}}function $C(o){const r=o.parallels,a=!!r&&Math.abs(r[0]+r[1])<.01;switch(o.name){case"mercator":return new jC(o);case"equirectangular":return new XN(o);case"naturalEarth":return new ZN(o);case"equalEarth":return new qN(o);case"winkelTripel":return new WN(o);case"albers":return a?new XC(o):new GN(o);case"lambertConformalConic":return a?new XC(o):new $N(o);case"globe":return new HN(o)}throw new Error(`Invalid projection name: ${o.name}`)}const YN=Ky.types,KN=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function hv(o,r,a,c,p,g,y,x,E,S,M,L,N){const z=x?Math.min(cc,Math.round(x[0])):0,F=x?Math.min(cc,Math.round(x[1])):0;o.emplaceBack(r,a,Math.round(32*c),Math.round(32*p),g,y,(z<<1)+(E?1:0),F,16*S,16*M,256*L,256*N)}function fv(o,r,a,c,p,g,y){o.emplaceBack(r,a,c,p,g,y)}function pv(o,r,a,c,p){o.emplaceBack(r,a,c,p),o.emplaceBack(r,a,c,p),o.emplaceBack(r,a,c,p),o.emplaceBack(r,a,c,p)}function JN(o){for(const r of o.sections)if(s1(r.text))return!0;return!1}class J1{constructor(r){this.layoutVertexArray=new Qe,this.indexArray=new It,this.programConfigurations=r,this.segments=new Ar,this.dynamicLayoutVertexArray=new nt,this.opacityVertexArray=new Mt,this.placedSymbolArray=new Mr,this.globeExtVertexArray=new st}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(r,a,c,p){this.isEmpty()||(c&&(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,sN.members),this.indexBuffer=r.createIndexBuffer(this.indexArray,a),this.dynamicLayoutVertexBuffer=r.createVertexBuffer(this.dynamicLayoutVertexArray,lN.members,!0),this.opacityVertexBuffer=r.createVertexBuffer(this.opacityVertexArray,KN,!0),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=r.createVertexBuffer(this.globeExtVertexArray,aN.members,!0)),this.opacityVertexBuffer.itemSize=1),(c||p)&&this.programConfigurations.upload(r))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}}bt(J1,"SymbolBuffers");class Q1{constructor(r,a,c){this.layoutVertexArray=new r,this.layoutAttributes=a,this.indexArray=new c,this.segments=new Ar,this.collisionVertexArray=new an,this.collisionVertexArrayExt=new nn}upload(r){this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=r.createVertexBuffer(this.collisionVertexArray,uN.members,!0),this.collisionVertexBufferExt=r.createVertexBuffer(this.collisionVertexArrayExt,cN.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}bt(Q1,"CollisionBuffers");class fc{constructor(r){this.collisionBoxArray=r.collisionBoxArray,this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(y=>y.id),this.index=r.index,this.pixelRatio=r.pixelRatio,this.sourceLayerIndex=r.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Ia([]),this.placementViewportMatrix=Ia([]);const a=this.layers[0]._unevaluatedLayout._values;this.textSizeData=V1(this.zoom,a["text-size"]),this.iconSizeData=V1(this.zoom,a["icon-size"]);const c=this.layers[0].layout,p=c.get("symbol-sort-key"),g=c.get("symbol-z-order");this.canOverlap=c.get("text-allow-overlap")||c.get("icon-allow-overlap")||c.get("text-ignore-placement")||c.get("icon-ignore-placement"),this.sortFeaturesByKey=g!=="viewport-y"&&p.constantOr(1)!==void 0,this.sortFeaturesByY=(g==="viewport-y"||g==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=c.get("text-writing-mode").map(y=>us[y]),this.stateDependentLayerIds=this.layers.filter(y=>y.isStateDependent()).map(y=>y.id),this.sourceID=r.sourceID,this.projection=r.projection}createArrays(){this.text=new J1(new Lh(this.layers,this.zoom,r=>/^text/.test(r))),this.icon=new J1(new Lh(this.layers,this.zoom,r=>/^icon/.test(r))),this.glyphOffsetArray=new Yi,this.lineVertexArray=new lp,this.symbolInstances=new Hn}calculateGlyphDependencies(r,a,c,p,g){for(let y=0;y<r.length;y++)if(a[r.charCodeAt(y)]=!0,p&&g){const x=og[r.charAt(y)];x&&(a[x.charCodeAt(0)]=!0)}}populate(r,a,c,p){const g=this.layers[0],y=g.layout,x=this.projection.name==="globe",E=y.get("text-font"),S=y.get("text-field"),M=y.get("icon-image"),L=(S.value.kind!=="constant"||S.value.value instanceof Hi&&!S.value.value.isEmpty()||S.value.value.toString().length>0)&&(E.value.kind!=="constant"||E.value.value.length>0),N=M.value.kind!=="constant"||!!M.value.value||Object.keys(M.parameters).length>0,z=y.get("symbol-sort-key");if(this.features=[],!L&&!N)return;const F=a.iconDependencies,j=a.glyphDependencies,H=a.availableImages,ne=new P(this.zoom);for(const{feature:he,id:re,index:ue,sourceLayerIndex:pe}of r){const fe=g._featureFilter.needGeometry,ke=zh(he,fe);if(!g._featureFilter.filter(ne,ke,c))continue;if(fe||(ke.geometry=au(he,c,p)),x&&he.type!==1&&c.z<=5){const Be=ke.geometry,Ke=.98078528056,Je=(tt,lt)=>Fs(Zm(tt.x,tt.y,c,1),Zm(lt.x,lt.y,c,1))<Ke;for(let tt=0;tt<Be.length;tt++)Be[tt]=lR(Be[tt],Je)}let De,Xe;if(L){const Be=g.getValueAndResolveTokens("text-field",ke,c,H),Ke=Hi.factory(Be);JN(Ke)&&(this.hasRTLText=!0),(!this.hasRTLText||b()==="unavailable"||this.hasRTLText&&I.isParsed())&&(De=pN(Ke,g,ke))}if(N){const Be=g.getValueAndResolveTokens("icon-image",ke,c,H);Xe=Be instanceof Ro?Be:Ro.fromString(Be)}if(!De&&!Xe)continue;const it=this.sortFeaturesByKey?z.evaluate(ke,{},c):void 0;if(this.features.push({id:re,text:De,icon:Xe,index:ue,sourceLayerIndex:pe,geometry:ke.geometry,properties:he.properties,type:YN[he.type],sortKey:it}),Xe&&(F[Xe.name]=!0),De){const Be=E.evaluate(ke,{},c).join(","),Ke=y.get("text-rotation-alignment")==="map"&&y.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(us.vertical)>=0;for(const Je of De.sections)if(Je.image)F[Je.image.name]=!0;else{const tt=Dm(De.toString()),lt=Je.fontStack||Be,je=j[lt]=j[lt]||{};this.calculateGlyphDependencies(Je.text,je,Ke,this.allowVerticalPlacement,tt)}}}y.get("symbol-placement")==="line"&&(this.features=function(he){const re={},ue={},pe=[];let fe=0;function ke(Be){pe.push(he[Be]),fe++}function De(Be,Ke,Je){const tt=ue[Be];return delete ue[Be],ue[Ke]=tt,pe[tt].geometry[0].pop(),pe[tt].geometry[0]=pe[tt].geometry[0].concat(Je[0]),tt}function Xe(Be,Ke,Je){const tt=re[Ke];return delete re[Ke],re[Be]=tt,pe[tt].geometry[0].shift(),pe[tt].geometry[0]=Je[0].concat(pe[tt].geometry[0]),tt}function it(Be,Ke,Je){const tt=Je?Ke[0][Ke[0].length-1]:Ke[0][0];return`${Be}:${tt.x}:${tt.y}`}for(let Be=0;Be<he.length;Be++){const Ke=he[Be],Je=Ke.geometry,tt=Ke.text?Ke.text.toString():null;if(!tt){ke(Be);continue}const lt=it(tt,Je),je=it(tt,Je,!0);if(lt in ue&&je in re&&ue[lt]!==re[je]){const mt=Xe(lt,je,Je),Tt=De(lt,je,pe[mt].geometry);delete re[lt],delete ue[je],ue[it(tt,pe[Tt].geometry,!0)]=Tt,pe[mt].geometry=null}else lt in ue?De(lt,je,Je):je in re?Xe(lt,je,Je):(ke(Be),re[lt]=fe-1,ue[je]=fe-1)}return pe.filter(Be=>Be.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((he,re)=>he.sortKey-re.sortKey)}update(r,a,c,p){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(r,a,this.layers,c,p),this.icon.programConfigurations.updatePaintArrays(r,a,this.layers,c,p))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(r){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(r),this.iconCollisionBox.upload(r)),this.text.upload(r,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(r,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=$C(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(r,a){const c=this.lineVertexArray.length;if(r.segment!==void 0)for(const{x:p,y:g}of a)this.lineVertexArray.emplaceBack(p,g);return{lineStartIndex:c,lineLength:this.lineVertexArray.length-c}}addSymbols(r,a,c,p,g,y,x,E,S,M,L,N,z,F){const j=r.indexArray,H=r.layoutVertexArray,ne=r.globeExtVertexArray,he=r.segments.prepareSegment(4*a.length,H,j,this.canOverlap?y.sortKey:void 0),re=this.glyphOffsetArray.length,ue=he.vertexLength,pe=this.allowVerticalPlacement&&x===us.vertical?Math.PI/2:0,fe=y.text&&y.text.sections;for(let De=0;De<a.length;De++){const{tl:Xe,tr:it,bl:Be,br:Ke,tex:Je,pixelOffsetTL:tt,pixelOffsetBR:lt,minFontScaleX:je,minFontScaleY:mt,glyphOffset:Tt,isSDF:_t,sectionIndex:qt}=a[De],ut=he.vertexLength,At=Tt[1];if(hv(H,S.x,S.y,Xe.x,At+Xe.y,Je.x,Je.y,c,_t,tt.x,tt.y,je,mt),hv(H,S.x,S.y,it.x,At+it.y,Je.x+Je.w,Je.y,c,_t,lt.x,tt.y,je,mt),hv(H,S.x,S.y,Be.x,At+Be.y,Je.x,Je.y+Je.h,c,_t,tt.x,lt.y,je,mt),hv(H,S.x,S.y,Ke.x,At+Ke.y,Je.x+Je.w,Je.y+Je.h,c,_t,lt.x,lt.y,je,mt),E){const{x:Xt,y:_n,z:$t}=E.anchor,[zt,Zn,Yt]=E.up;fv(ne,Xt,_n,$t,zt,Zn,Yt),fv(ne,Xt,_n,$t,zt,Zn,Yt),fv(ne,Xt,_n,$t,zt,Zn,Yt),fv(ne,Xt,_n,$t,zt,Zn,Yt),pv(r.dynamicLayoutVertexArray,Xt,_n,$t,pe)}else pv(r.dynamicLayoutVertexArray,S.x,S.y,S.z,pe);j.emplaceBack(ut,ut+1,ut+2),j.emplaceBack(ut+1,ut+2,ut+3),he.vertexLength+=4,he.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Tt[0]),De!==a.length-1&&qt===a[De+1].sectionIndex||r.programConfigurations.populatePaintArrays(H.length,y,y.index,{},z,F,fe&&fe[qt])}const ke=E?E.anchor:S;r.placedSymbolArray.emplaceBack(ke.x,ke.y,ke.z,S.x,S.y,re,this.glyphOffsetArray.length-re,ue,M,L,S.segment,c?c[0]:0,c?c[1]:0,p[0],p[1],x,0,!1,0,N,0)}_commitLayoutVertex(r,a,c,p,g,y,x){r.emplaceBack(a,c,p,g,y,Math.round(x.x),Math.round(x.y))}_addCollisionDebugVertices(r,a,c,p,g,y,x){const E=c.segments.prepareSegment(4,c.layoutVertexArray,c.indexArray),S=E.vertexLength,M=x.tileAnchorX,L=x.tileAnchorY;for(let z=0;z<4;z++)c.collisionVertexArray.emplaceBack(0,0,0,0);c.collisionVertexArrayExt.emplaceBack(a,-r.padding,-r.padding),c.collisionVertexArrayExt.emplaceBack(a,r.padding,-r.padding),c.collisionVertexArrayExt.emplaceBack(a,r.padding,r.padding),c.collisionVertexArrayExt.emplaceBack(a,-r.padding,r.padding),this._commitLayoutVertex(c.layoutVertexArray,p,g,y,M,L,new xe(r.x1,r.y1)),this._commitLayoutVertex(c.layoutVertexArray,p,g,y,M,L,new xe(r.x2,r.y1)),this._commitLayoutVertex(c.layoutVertexArray,p,g,y,M,L,new xe(r.x2,r.y2)),this._commitLayoutVertex(c.layoutVertexArray,p,g,y,M,L,new xe(r.x1,r.y2)),E.vertexLength+=4;const N=c.indexArray;N.emplaceBack(S,S+1),N.emplaceBack(S+1,S+2),N.emplaceBack(S+2,S+3),N.emplaceBack(S+3,S),E.primitiveLength+=4}_addTextDebugCollisionBoxes(r,a,c,p,g,y){for(let x=p;x<g;x++){const E=c.get(x),S=this.getSymbolInstanceTextSize(r,y,a,x);this._addCollisionDebugVertices(E,S,this.textCollisionBox,E.projectedAnchorX,E.projectedAnchorY,E.projectedAnchorZ,y)}}_addIconDebugCollisionBoxes(r,a,c,p,g,y){for(let x=p;x<g;x++){const E=c.get(x),S=this.getSymbolInstanceIconSize(r,a,y.placedIconSymbolIndex);this._addCollisionDebugVertices(E,S,this.iconCollisionBox,E.projectedAnchorX,E.projectedAnchorY,E.projectedAnchorZ,y)}}generateCollisionDebugBuffers(r,a){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Q1(St,hC.members,ti),this.iconCollisionBox=new Q1(St,hC.members,ti);const c=xp(this.iconSizeData,r),p=xp(this.textSizeData,r);for(let g=0;g<this.symbolInstances.length;g++){const y=this.symbolInstances.get(g);this._addTextDebugCollisionBoxes(p,r,a,y.textBoxStartIndex,y.textBoxEndIndex,y),this._addTextDebugCollisionBoxes(p,r,a,y.verticalTextBoxStartIndex,y.verticalTextBoxEndIndex,y),this._addIconDebugCollisionBoxes(c,r,a,y.iconBoxStartIndex,y.iconBoxEndIndex,y),this._addIconDebugCollisionBoxes(c,r,a,y.verticalIconBoxStartIndex,y.verticalIconBoxEndIndex,y)}}getSymbolInstanceTextSize(r,a,c,p){const g=this.text.placedSymbolArray.get(a.rightJustifiedTextSymbolIndex>=0?a.rightJustifiedTextSymbolIndex:a.centerJustifiedTextSymbolIndex>=0?a.centerJustifiedTextSymbolIndex:a.leftJustifiedTextSymbolIndex>=0?a.leftJustifiedTextSymbolIndex:a.verticalPlacedTextSymbolIndex>=0?a.verticalPlacedTextSymbolIndex:p),y=tv(this.textSizeData,r,g)/pi;return this.tilePixelRatio*y}getSymbolInstanceIconSize(r,a,c){const p=this.icon.placedSymbolArray.get(c),g=tv(this.iconSizeData,r,p);return this.tilePixelRatio*g}_commitDebugCollisionVertexUpdate(r,a,c){r.emplaceBack(a,-c,-c),r.emplaceBack(a,c,-c),r.emplaceBack(a,c,c),r.emplaceBack(a,-c,c)}_updateTextDebugCollisionBoxes(r,a,c,p,g,y){for(let x=p;x<g;x++){const E=c.get(x),S=this.getSymbolInstanceTextSize(r,y,a,x);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,S,E.padding)}}_updateIconDebugCollisionBoxes(r,a,c,p,g,y){for(let x=p;x<g;x++){const E=c.get(x),S=this.getSymbolInstanceIconSize(r,a,y);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,S,E.padding)}}updateCollisionDebugBuffers(r,a){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const c=xp(this.iconSizeData,r),p=xp(this.textSizeData,r);for(let g=0;g<this.symbolInstances.length;g++){const y=this.symbolInstances.get(g);this._updateTextDebugCollisionBoxes(p,r,a,y.textBoxStartIndex,y.textBoxEndIndex,y),this._updateTextDebugCollisionBoxes(p,r,a,y.verticalTextBoxStartIndex,y.verticalTextBoxEndIndex,y),this._updateIconDebugCollisionBoxes(c,r,a,y.iconBoxStartIndex,y.iconBoxEndIndex,y.placedIconSymbolIndex),this._updateIconDebugCollisionBoxes(c,r,a,y.verticalIconBoxStartIndex,y.verticalIconBoxEndIndex,y.placedIconSymbolIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(r,a,c,p,g,y,x,E,S){const M={};if(a<c){const{x1:L,y1:N,x2:z,y2:F,padding:j,projectedAnchorX:H,projectedAnchorY:ne,projectedAnchorZ:he,tileAnchorX:re,tileAnchorY:ue,featureIndex:pe}=r.get(a);M.textBox={x1:L,y1:N,x2:z,y2:F,padding:j,projectedAnchorX:H,projectedAnchorY:ne,projectedAnchorZ:he,tileAnchorX:re,tileAnchorY:ue},M.textFeatureIndex=pe}if(p<g){const{x1:L,y1:N,x2:z,y2:F,padding:j,projectedAnchorX:H,projectedAnchorY:ne,projectedAnchorZ:he,tileAnchorX:re,tileAnchorY:ue,featureIndex:pe}=r.get(p);M.verticalTextBox={x1:L,y1:N,x2:z,y2:F,padding:j,projectedAnchorX:H,projectedAnchorY:ne,projectedAnchorZ:he,tileAnchorX:re,tileAnchorY:ue},M.verticalTextFeatureIndex=pe}if(y<x){const{x1:L,y1:N,x2:z,y2:F,padding:j,projectedAnchorX:H,projectedAnchorY:ne,projectedAnchorZ:he,tileAnchorX:re,tileAnchorY:ue,featureIndex:pe}=r.get(y);M.iconBox={x1:L,y1:N,x2:z,y2:F,padding:j,projectedAnchorX:H,projectedAnchorY:ne,projectedAnchorZ:he,tileAnchorX:re,tileAnchorY:ue},M.iconFeatureIndex=pe}if(E<S){const{x1:L,y1:N,x2:z,y2:F,padding:j,projectedAnchorX:H,projectedAnchorY:ne,projectedAnchorZ:he,tileAnchorX:re,tileAnchorY:ue,featureIndex:pe}=r.get(E);M.verticalIconBox={x1:L,y1:N,x2:z,y2:F,padding:j,projectedAnchorX:H,projectedAnchorY:ne,projectedAnchorZ:he,tileAnchorX:re,tileAnchorY:ue},M.verticalIconFeatureIndex=pe}return M}deserializeCollisionBoxes(r){this.collisionArrays=[];for(let a=0;a<this.symbolInstances.length;a++){const c=this.symbolInstances.get(a);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(r,c.textBoxStartIndex,c.textBoxEndIndex,c.verticalTextBoxStartIndex,c.verticalTextBoxEndIndex,c.iconBoxStartIndex,c.iconBoxEndIndex,c.verticalIconBoxStartIndex,c.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(r,a){const c=r.placedSymbolArray.get(a),p=c.vertexStartIndex+4*c.numGlyphs;for(let g=c.vertexStartIndex;g<p;g+=4)r.indexArray.emplaceBack(g,g+1,g+2),r.indexArray.emplaceBack(g+1,g+2,g+3)}getSortedSymbolIndexes(r){if(this.sortedAngle===r&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const a=Math.sin(r),c=Math.cos(r),p=[],g=[],y=[];for(let x=0;x<this.symbolInstances.length;++x){y.push(x);const E=this.symbolInstances.get(x);p.push(0|Math.round(a*E.tileAnchorX+c*E.tileAnchorY)),g.push(E.featureIndex)}return y.sort((x,E)=>p[x]-p[E]||g[E]-g[x]),y}addToSortKeyRanges(r,a){const c=this.sortKeyRanges[this.sortKeyRanges.length-1];c&&c.sortKey===a?c.symbolInstanceEnd=r+1:this.sortKeyRanges.push({sortKey:a,symbolInstanceStart:r,symbolInstanceEnd:r+1})}sortFeatures(r){if(this.sortFeaturesByY&&this.sortedAngle!==r&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(r),this.sortedAngle=r,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const a of this.symbolInstanceIndexes){const c=this.symbolInstances.get(a);this.featureSortOrder.push(c.featureIndex);const{rightJustifiedTextSymbolIndex:p,centerJustifiedTextSymbolIndex:g,leftJustifiedTextSymbolIndex:y,verticalPlacedTextSymbolIndex:x,placedIconSymbolIndex:E,verticalPlacedIconSymbolIndex:S}=c;p>=0&&this.addIndicesForPlacedSymbol(this.text,p),g>=0&&g!==p&&this.addIndicesForPlacedSymbol(this.text,g),y>=0&&y!==g&&y!==p&&this.addIndicesForPlacedSymbol(this.text,y),x>=0&&this.addIndicesForPlacedSymbol(this.text,x),E>=0&&this.addIndicesForPlacedSymbol(this.icon,E),S>=0&&this.addIndicesForPlacedSymbol(this.icon,S)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}bt(fc,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),fc.MAX_GLYPHS=65535,fc.addDynamicAttributes=pv;const QN=new ae({"symbol-placement":new V(Ge.layout_symbol["symbol-placement"]),"symbol-spacing":new V(Ge.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new V(Ge.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new K(Ge.layout_symbol["symbol-sort-key"]),"symbol-z-order":new V(Ge.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new V(Ge.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new V(Ge.layout_symbol["icon-ignore-placement"]),"icon-optional":new V(Ge.layout_symbol["icon-optional"]),"icon-rotation-alignment":new V(Ge.layout_symbol["icon-rotation-alignment"]),"icon-size":new K(Ge.layout_symbol["icon-size"]),"icon-text-fit":new V(Ge.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new V(Ge.layout_symbol["icon-text-fit-padding"]),"icon-image":new K(Ge.layout_symbol["icon-image"]),"icon-rotate":new K(Ge.layout_symbol["icon-rotate"]),"icon-padding":new V(Ge.layout_symbol["icon-padding"]),"icon-keep-upright":new V(Ge.layout_symbol["icon-keep-upright"]),"icon-offset":new K(Ge.layout_symbol["icon-offset"]),"icon-anchor":new K(Ge.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new V(Ge.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new V(Ge.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new V(Ge.layout_symbol["text-rotation-alignment"]),"text-field":new K(Ge.layout_symbol["text-field"]),"text-font":new K(Ge.layout_symbol["text-font"]),"text-size":new K(Ge.layout_symbol["text-size"]),"text-max-width":new K(Ge.layout_symbol["text-max-width"]),"text-line-height":new K(Ge.layout_symbol["text-line-height"]),"text-letter-spacing":new K(Ge.layout_symbol["text-letter-spacing"]),"text-justify":new K(Ge.layout_symbol["text-justify"]),"text-radial-offset":new K(Ge.layout_symbol["text-radial-offset"]),"text-variable-anchor":new V(Ge.layout_symbol["text-variable-anchor"]),"text-anchor":new K(Ge.layout_symbol["text-anchor"]),"text-max-angle":new V(Ge.layout_symbol["text-max-angle"]),"text-writing-mode":new V(Ge.layout_symbol["text-writing-mode"]),"text-rotate":new K(Ge.layout_symbol["text-rotate"]),"text-padding":new V(Ge.layout_symbol["text-padding"]),"text-keep-upright":new V(Ge.layout_symbol["text-keep-upright"]),"text-transform":new K(Ge.layout_symbol["text-transform"]),"text-offset":new K(Ge.layout_symbol["text-offset"]),"text-allow-overlap":new V(Ge.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new V(Ge.layout_symbol["text-ignore-placement"]),"text-optional":new V(Ge.layout_symbol["text-optional"])});var ew={paint:new ae({"icon-opacity":new K(Ge.paint_symbol["icon-opacity"]),"icon-color":new K(Ge.paint_symbol["icon-color"]),"icon-halo-color":new K(Ge.paint_symbol["icon-halo-color"]),"icon-halo-width":new K(Ge.paint_symbol["icon-halo-width"]),"icon-halo-blur":new K(Ge.paint_symbol["icon-halo-blur"]),"icon-translate":new V(Ge.paint_symbol["icon-translate"]),"icon-translate-anchor":new V(Ge.paint_symbol["icon-translate-anchor"]),"text-opacity":new K(Ge.paint_symbol["text-opacity"]),"text-color":new K(Ge.paint_symbol["text-color"],{runtimeType:mo,getOverride:o=>o.textColor,hasOverride:o=>!!o.textColor}),"text-halo-color":new K(Ge.paint_symbol["text-halo-color"]),"text-halo-width":new K(Ge.paint_symbol["text-halo-width"]),"text-halo-blur":new K(Ge.paint_symbol["text-halo-blur"]),"text-translate":new V(Ge.paint_symbol["text-translate"]),"text-translate-anchor":new V(Ge.paint_symbol["text-translate-anchor"])}),layout:QN};class ZC{constructor(r){this.type=r.property.overrides?r.property.overrides.runtimeType:ju,this.defaultValue=r}evaluate(r){if(r.formattedSection){const a=this.defaultValue.property.overrides;if(a&&a.hasOverride(r.formattedSection))return a.getOverride(r.formattedSection)}return r.feature&&r.featureState?this.defaultValue.evaluate(r.feature,r.featureState):this.defaultValue.property.specification.default}eachChild(r){this.defaultValue.isConstant()||r(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}bt(ZC,"FormatSectionOverride",{omit:["defaultValue"]});class dv extends Ca{constructor(r){super(r,ew)}recalculate(r,a){super.recalculate(r,a),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const c=this.layout.get("text-writing-mode");if(c){const p=[];for(const g of c)p.indexOf(g)<0&&p.push(g);this.layout._values["text-writing-mode"]=p}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(r,a,c,p){const g=this.layout.get(r).evaluate(a,{},c,p),y=this._unevaluatedLayout._values[r];return y.isDataDriven()||ec(y.value)||!g?g:function(x,E){return E.replace(/{([^{}]+)}/g,(S,M)=>M in x?String(x[M]):"")}(a.properties,g)}createBucket(r){return new fc(r)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const r of ew.paint.overridableProperties){if(!dv.hasPaintOverride(this.layout,r))continue;const a=this.paint.get(r),c=new ZC(a),p=new ep(c,a.property.specification);let g=null;g=a.value.kind==="constant"||a.value.kind==="source"?new wm("source",p):new bh("composite",p,a.value.zoomStops,a.value._interpolationType),this.paint._values[r]=new Q(a.property,g,a.parameters)}}_handleOverridablePaintPropertyUpdate(r,a,c){return!(!this.layout||a.isDataDriven()||c.isDataDriven())&&dv.hasPaintOverride(this.layout,r)}static hasPaintOverride(r,a){const c=r.get("text-field"),p=ew.paint.properties[a];let g=!1;const y=x=>{for(const E of x)if(p.overrides&&p.overrides.hasOverride(E))return void(g=!0)};if(c.value.kind==="constant"&&c.value.value instanceof Hi)y(c.value.value.sections);else if(c.value.kind==="source"){const x=S=>{g||(S instanceof Hl&&fr(S.value)===oh?y(S.value.sections):S instanceof ul?y(S.sections):S.eachChild(x))},E=c.value;E._styleExpression&&x(E._styleExpression.expression)}return g}getProgramConfiguration(r){return new ac(this,r)}}var ek={paint:new ae({"background-color":new V(Ge.paint_background["background-color"]),"background-pattern":new V(Ge.paint_background["background-pattern"]),"background-opacity":new V(Ge.paint_background["background-opacity"])})},tk={paint:new ae({"raster-opacity":new V(Ge.paint_raster["raster-opacity"]),"raster-hue-rotate":new V(Ge.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new V(Ge.paint_raster["raster-brightness-min"]),"raster-brightness-max":new V(Ge.paint_raster["raster-brightness-max"]),"raster-saturation":new V(Ge.paint_raster["raster-saturation"]),"raster-contrast":new V(Ge.paint_raster["raster-contrast"]),"raster-resampling":new V(Ge.paint_raster["raster-resampling"]),"raster-fade-duration":new V(Ge.paint_raster["raster-fade-duration"])})};class nk extends Ca{constructor(r){super(r,{}),this.implementation=r}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isLayerDraped(){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(r){this.implementation.onAdd&&this.implementation.onAdd(r,r.painter.context.gl)}onRemove(r){this.implementation.onRemove&&this.implementation.onRemove(r,r.painter.context.gl)}}var rk={paint:new ae({"sky-type":new V(Ge.paint_sky["sky-type"]),"sky-atmosphere-sun":new V(Ge.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new V(Ge.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new V(Ge.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new V(Ge.paint_sky["sky-gradient-radius"]),"sky-gradient":new se(Ge.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new V(Ge.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new V(Ge.paint_sky["sky-atmosphere-color"]),"sky-opacity":new V(Ge.paint_sky["sky-opacity"])})};function tw(o,r,a){const c=[0,0,1],p=fT([]);return dT(p,p,a?-He(o)+Math.PI:He(o)),pT(p,p,-He(r)),lT(c,c,p),Ki(c,c)}const ik={circle:class extends Ca{constructor(o){super(o,mR)}createBucket(o){return new I1(o)}queryRadius(o){const r=o;return gp("circle-radius",this,r)+gp("circle-stroke-width",this,r)+qy(this.paint.get("circle-translate"))}queryIntersectsFeature(o,r,a,c,p,g,y,x){const E=OT(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),g.angle,o.pixelToTileUnitsFactor),S=this.paint.get("circle-radius").evaluate(r,a)+this.paint.get("circle-stroke-width").evaluate(r,a);return zT(o,c,g,y,x,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",E,S)}getProgramIds(){return["circle"]}getProgramConfiguration(o){return new ac(this,o)}},heatmap:class extends Ca{createBucket(o){return new BT(o)}constructor(o){super(o,vR),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(o){o==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=L1({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(o){return gp("heatmap-radius",this,o)}queryIntersectsFeature(o,r,a,c,p,g,y,x){const E=this.paint.get("heatmap-radius").evaluate(r,a);return zT(o,c,g,y,x,!0,!0,new xe(0,0),E)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(o){return new ac(this,o)}},hillshade:class extends Ca{constructor(o){super(o,xR)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends Ca{constructor(o){super(o,OR)}getProgramIds(){const o=this.paint.get("fill-pattern"),r=o&&o.constantOr(1),a=[r?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&a.push(r&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),a}getProgramConfiguration(o){return new ac(this,o)}recalculate(o,r){super.recalculate(o,r);const a=this.paint._values["fill-outline-color"];a.value.kind==="constant"&&a.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(o){return new Hy(o)}queryRadius(){return qy(this.paint.get("fill-translate"))}queryIntersectsFeature(o,r,a,c,p,g){return!o.queryGeometry.isAboveHorizon&&LT(kT(o.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),g.angle,o.pixelToTileUnitsFactor),c)}isTileClipped(){return!0}},"fill-extrusion":class extends Ca{constructor(o){super(o,JR)}createBucket(o){return new ng(o)}queryRadius(){return qy(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(o){return new ac(this,o)}queryIntersectsFeature(o,r,a,c,p,g,y,x,E){const S=OT(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),g.angle,o.pixelToTileUnitsFactor),M=this.paint.get("fill-extrusion-height").evaluate(r,a),L=this.paint.get("fill-extrusion-base").evaluate(r,a),N=[0,0],z=x&&g.elevation,F=g.elevation?g.elevation.exaggeration():1,j=o.tile.getBucket(this);if(z&&j instanceof ng){const ue=j.centroidVertexArray,pe=E+1;pe<ue.length&&(N[0]=ue.geta_centroid_pos0(pe),N[1]=ue.geta_centroid_pos1(pe))}if(N[0]===0&&N[1]===1)return!1;g.projection.name==="globe"&&(c=rC([c],[new xe(0,0),new xe(Rt,Rt)],o.tileID.canonical).map(ue=>ue.polygon).flat());const H=z?x:null,[ne,he]=function(ue,pe,fe,ke,De,Xe,it,Be,Ke,Je,tt){return ue.projection.name==="globe"?function(lt,je,mt,Tt,_t,qt,ut,At,Xt,_n,$t){const zt=[],Zn=[],Yt=lt.projection.upVectorScale($t,lt.center.lat,lt.worldSize).metersToTile,Kt=[0,0,0,1],zn=[0,0,0,1],jn=(Fn,ir,pr,Lr)=>{Fn[0]=ir,Fn[1]=pr,Fn[2]=Lr,Fn[3]=1},Gn=nC();mt>0&&(mt+=Gn),Tt+=Gn;for(const Fn of je){const ir=[],pr=[];for(const Lr of Fn){const Bn=Lr.x+_t.x,Xr=Lr.y+_t.y,Dr=lt.projection.projectTilePoint(Bn,Xr,$t),ar=lt.projection.upVector($t,Lr.x,Lr.y);let vn=mt,Rr=Tt;if(ut){const qn=aC(Bn,Xr,mt,Tt,ut,At,Xt,_n);vn+=qn.base,Rr+=qn.top}mt!==0?jn(Kt,Dr.x+ar[0]*Yt*vn,Dr.y+ar[1]*Yt*vn,Dr.z+ar[2]*Yt*vn):jn(Kt,Dr.x,Dr.y,Dr.z),jn(zn,Dr.x+ar[0]*Yt*Rr,Dr.y+ar[1]*Yt*Rr,Dr.z+ar[2]*Yt*Rr),wr(Kt,Kt,qt),wr(zn,zn,qt),ir.push(new vp(Kt[0],Kt[1],Kt[2])),pr.push(new vp(zn[0],zn[1],zn[2]))}zt.push(ir),Zn.push(pr)}return[zt,Zn]}(ue,pe,fe,ke,De,Xe,it,Be,Ke,Je,tt):it?function(lt,je,mt,Tt,_t,qt,ut,At,Xt){const _n=[],$t=[],zt=[0,0,0,1];for(const Zn of lt){const Yt=[],Kt=[];for(const zn of Zn){const jn=zn.x+Tt.x,Gn=zn.y+Tt.y,Fn=aC(jn,Gn,je,mt,qt,ut,At,Xt);zt[0]=jn,zt[1]=Gn,zt[2]=Fn.base,zt[3]=1,Nh(zt,zt,_t),zt[3]=Math.max(zt[3],1e-5);const ir=new vp(zt[0]/zt[3],zt[1]/zt[3],zt[2]/zt[3]);zt[0]=jn,zt[1]=Gn,zt[2]=Fn.top,zt[3]=1,Nh(zt,zt,_t),zt[3]=Math.max(zt[3],1e-5);const pr=new vp(zt[0]/zt[3],zt[1]/zt[3],zt[2]/zt[3]);Yt.push(ir),Kt.push(pr)}_n.push(Yt),$t.push(Kt)}return[_n,$t]}(pe,fe,ke,De,Xe,it,Be,Ke,Je):function(lt,je,mt,Tt,_t){const qt=[],ut=[],At=_t[8]*je,Xt=_t[9]*je,_n=_t[10]*je,$t=_t[11]*je,zt=_t[8]*mt,Zn=_t[9]*mt,Yt=_t[10]*mt,Kt=_t[11]*mt;for(const zn of lt){const jn=[],Gn=[];for(const Fn of zn){const ir=Fn.x+Tt.x,pr=Fn.y+Tt.y,Lr=_t[0]*ir+_t[4]*pr+_t[12],Bn=_t[1]*ir+_t[5]*pr+_t[13],Xr=_t[2]*ir+_t[6]*pr+_t[14],Dr=_t[3]*ir+_t[7]*pr+_t[15],ar=Lr+At,vn=Bn+Xt,Rr=Xr+_n,qn=Math.max(Dr+$t,1e-5),eo=Lr+zt,Nr=Bn+Zn,di=Xr+Yt,ni=Math.max(Dr+Kt,1e-5);jn.push(new vp(ar/qn,vn/qn,Rr/qn)),Gn.push(new vp(eo/ni,Nr/ni,di/ni))}qt.push(jn),ut.push(Gn)}return[qt,ut]}(pe,fe,ke,De,Xe)}(g,c,L,M,S,y,H,N,F,g.center.lat,o.tileID.canonical),re=o.queryGeometry;return function(ue,pe,fe){let ke=1/0;LT(fe,pe)&&(ke=sC(fe,pe[0]));for(let De=0;De<pe.length;De++){const Xe=pe[De],it=ue[De];for(let Be=0;Be<Xe.length-1;Be++){const Ke=Xe[Be],Je=[Ke,Xe[Be+1],it[Be+1],it[Be],Ke];PT(fe,Je)&&(ke=Math.min(ke,sC(fe,Je)))}}return ke!==1/0&&ke}(ne,he,re.isPointQuery()?re.screenBounds:re.screenGeometry)}},line:class extends Ca{constructor(o){super(o,lC),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(o){if(o==="line-gradient"){const r=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=r._styleExpression&&r._styleExpression.expression instanceof lm,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(o,r){super.recalculate(o,r),this.paint._values["line-floorwidth"]=uC.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,o)}createBucket(o){return new ev(o)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(o){return new ac(this,o)}queryRadius(o){const r=o,a=cC(gp("line-width",this,r),gp("line-gap-width",this,r)),c=gp("line-offset",this,r);return a/2+Math.abs(c)+qy(this.paint.get("line-translate"))}queryIntersectsFeature(o,r,a,c,p,g){if(o.queryGeometry.isAboveHorizon)return!1;const y=kT(o.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),g.angle,o.pixelToTileUnitsFactor),x=o.pixelToTileUnitsFactor/2*cC(this.paint.get("line-width").evaluate(r,a),this.paint.get("line-gap-width").evaluate(r,a)),E=this.paint.get("line-offset").evaluate(r,a);return E&&(c=function(S,M){const L=[],N=new xe(0,0);for(let z=0;z<S.length;z++){const F=S[z],j=[];for(let H=0;H<F.length;H++){const ne=F[H],he=F[H+1],re=H===0?N:ne.sub(F[H-1])._unit()._perp(),ue=H===F.length-1?N:he.sub(ne)._unit()._perp(),pe=re._add(ue)._unit();pe._mult(1/(pe.x*ue.x+pe.y*ue.y)),j.push(pe._mult(M)._add(ne))}L.push(j)}return L}(c,E*o.pixelToTileUnitsFactor)),function(S,M,L){for(let N=0;N<M.length;N++){const z=M[N];if(S.length>=3){for(let F=0;F<z.length;F++)if(Fh(S,z[F]))return!0}if(hR(S,z,L))return!0}return!1}(y,c,x)}isTileClipped(){return!0}},symbol:dv,background:class extends Ca{constructor(o){super(o,ek)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends Ca{constructor(o){super(o,tk)}getProgramIds(){return["raster"]}},sky:class extends Ca{constructor(o){super(o,rk),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(o){o==="sky-gradient"?this._updateColorRamp():o!=="sky-atmosphere-sun"&&o!=="sky-atmosphere-halo-color"&&o!=="sky-atmosphere-color"&&o!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=L1({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(o){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const r=o.style.light.properties.get("position");return this._lightPosition.azimuthal!==r.azimuthal||this._lightPosition.polar!==r.polar}return!1}getCenter(o,r){if(this.paint.get("sky-type")==="atmosphere"){const c=this.paint.get("sky-atmosphere-sun"),p=!c,g=o.style.light,y=g.properties.get("position");return p&&g.properties.get("anchor")==="viewport"&&nr("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),p?tw(y.azimuthal,90-y.polar,r):tw(c[0],90-c[1],r)}const a=this.paint.get("sky-gradient-center");return tw(a[0],90-a[1],r)}is3D(){return!1}isSky(){return!0}markSkyboxValid(o){this._skyboxInvalidated=!1,this._lightPosition=o.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const o=this.paint.get("sky-type");return o==="atmosphere"?["skyboxCapture","skybox"]:o==="gradient"?["skyboxGradient"]:null}}};class pg{constructor(r,a,c,p){this.context=r,this.format=c,this.texture=r.gl.createTexture(),this.update(a,p)}update(r,a,c){const{width:p,height:g}=r,{context:y}=this,{gl:x}=y,{HTMLImageElement:E,HTMLCanvasElement:S,HTMLVideoElement:M,ImageData:L,ImageBitmap:N}=w;if(x.bindTexture(x.TEXTURE_2D,this.texture),y.pixelStoreUnpackFlipY.set(!1),y.pixelStoreUnpack.set(1),y.pixelStoreUnpackPremultiplyAlpha.set(this.format===x.RGBA&&(!a||a.premultiply!==!1)),c||this.size&&this.size[0]===p&&this.size[1]===g){const{x:z,y:F}=c||{x:0,y:0};r instanceof E||r instanceof S||r instanceof M||r instanceof L||N&&r instanceof N?x.texSubImage2D(x.TEXTURE_2D,0,z,F,x.RGBA,x.UNSIGNED_BYTE,r):x.texSubImage2D(x.TEXTURE_2D,0,z,F,p,g,x.RGBA,x.UNSIGNED_BYTE,r.data)}else this.size=[p,g],r instanceof E||r instanceof S||r instanceof M||r instanceof L||N&&r instanceof N?x.texImage2D(x.TEXTURE_2D,0,this.format,this.format,x.UNSIGNED_BYTE,r):x.texImage2D(x.TEXTURE_2D,0,this.format,p,g,0,this.format,x.UNSIGNED_BYTE,r.data);this.useMipmap=!!(a&&a.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&x.generateMipmap(x.TEXTURE_2D)}bind(r,a){const{context:c}=this,{gl:p}=c;p.bindTexture(p.TEXTURE_2D,this.texture),r!==this.filter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,r),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,this.useMipmap?r===p.NEAREST?p.NEAREST_MIPMAP_NEAREST:p.LINEAR_MIPMAP_NEAREST:r),this.filter=r),a!==this.wrap&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,a),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,a),this.wrap=a)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:r}=this.context;r.deleteTexture(this.texture),this.texture=null}}class ok{constructor(r){this._callback=r,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class sk{constructor(){this.tasks={},this.taskQueue=[],rs(["process"],this),this.invoker=new ok(this.process),this.nextId=0}add(r,a){const c=this.nextId++,p=function({type:g,isSymbolTile:y,zoom:x}){return x=x||0,g==="message"?0:g!=="maybePrepare"||y?g!=="parseTile"||y?g==="parseTile"&&y?300-x:g==="maybePrepare"&&y?400-x:500:200-x:100-x}(a);if(p===0){pa();try{r()}finally{}return{cancel:()=>{}}}return this.tasks[c]={fn:r,metadata:a,priority:p,id:c},this.taskQueue.push(c),this.invoker.trigger(),{cancel:()=>{delete this.tasks[c]}}}process(){pa();try{if(this.taskQueue=this.taskQueue.filter(c=>!!this.tasks[c]),!this.taskQueue.length)return;const r=this.pick();if(r===null)return;const a=this.tasks[r];if(delete this.tasks[r],this.taskQueue.length&&this.invoker.trigger(),!a)return;a.fn()}finally{}}pick(){let r=null,a=1/0;for(let p=0;p<this.taskQueue.length;p++){const g=this.tasks[this.taskQueue[p]];g.priority<a&&(a=g.priority,r=p)}if(r===null)return null;const c=this.taskQueue[r];return this.taskQueue.splice(r,1),c}remove(){this.invoker.remove()}}class WC{constructor(r){this._stringToNumber={},this._numberToString=[];for(let a=0;a<r.length;a++){const c=r[a];this._stringToNumber[c]=a,this._numberToString[a]=c}}encode(r){return this._stringToNumber[r]}decode(r){return this._numberToString[r]}}const ak=["tile","layer","source","sourceLayer","state"];class HC{constructor(r,a,c,p,g){this.type="Feature",this._vectorTileFeature=r,this._z=a,this._x=c,this._y=p,this.properties=r.properties,this.id=g}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(r){this._geometry=r}toJSON(){const r={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};this.id!==void 0&&(r.id=this.id);for(const a of ak)this[a]!==void 0&&(r[a]=this[a]);return r}}const Vs=32,gl=33,pc=new Uint16Array(8184);for(let o=0;o<2046;o++){let r=o+2,a=0,c=0,p=0,g=0,y=0,x=0;for(1&r?p=g=y=Vs:a=c=x=Vs;(r>>=1)>1;){const S=a+p>>1,M=c+g>>1;1&r?(p=a,g=c,a=y,c=x):(a=p,c=g,p=y,g=x),y=S,x=M}const E=4*o;pc[E+0]=a,pc[E+1]=c,pc[E+2]=p,pc[E+3]=g}const _l=new Uint16Array(2178),dc=new Uint8Array(1089),mv=new Uint16Array(1089);function YC(o){return o===0?-.03125:o===32?.03125:0}var KC=Ce([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const JC={type:2,extent:Rt,loadGeometry:()=>[[new xe(0,0),new xe(Rt+1,0),new xe(Rt+1,Rt+1),new xe(0,Rt+1),new xe(0,0)]]};class nw{constructor(r,a,c,p,g){this.tileID=r,this.uid=Wn(),this.uses=0,this.tileSize=a,this.tileZoom=c,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=g,this.expiredRequestCount=0,this.state="loading",p&&p.transform&&(this.projection=p.transform.projection)}registerFadeDuration(r){const a=r+this.timeAdded;a<da.now()||this.fadeEndTime&&a<this.fadeEndTime||(this.fadeEndTime=a)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=Uh(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(r,a,c){if(this.unloadVectorData(),this.state="loaded",r){r.featureIndex&&(this.latestFeatureIndex=r.featureIndex,r.rawTileData?(this.latestRawTileData=r.rawTileData,this.latestFeatureIndex.rawTileData=r.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=r.collisionBoxArray,this.buckets=function(p,g){const y={};if(!g)return y;for(const x of p){const E=x.layerIds.map(S=>g.getLayer(S)).filter(Boolean);if(E.length!==0){x.layers=E,x.stateDependentLayerIds&&(x.stateDependentLayers=x.stateDependentLayerIds.map(S=>E.filter(M=>M.id===S)[0]));for(const S of E)y[S.id]=x}}return y}(r.buckets,a.style),this.hasSymbolBuckets=!1;for(const p in this.buckets){const g=this.buckets[p];if(g instanceof fc){if(this.hasSymbolBuckets=!0,!c)break;g.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const p in this.buckets){const g=this.buckets[p];if(g instanceof fc&&g.hasRTLText){this.hasRTLText=!0,I.isLoading()||I.isLoaded()||b()!=="deferred"||C();break}}this.queryPadding=0;for(const p in this.buckets){const g=this.buckets[p];this.queryPadding=Math.max(this.queryPadding,a.style.getLayer(p).queryRadius(g))}r.imageAtlas&&(this.imageAtlas=r.imageAtlas),r.glyphAtlasImage&&(this.glyphAtlasImage=r.glyphAtlasImage),r.lineAtlas&&(this.lineAtlas=r.lineAtlas)}else this.collisionBoxArray=new kn}unloadVectorData(){if(this.hasData()){for(const r in this.buckets)this.buckets[r].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(r){return this.buckets[r.id]}upload(r){for(const c in this.buckets){const p=this.buckets[c];p.uploadPending()&&p.upload(r)}const a=r.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new pg(r,this.imageAtlas.image,a.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new pg(r,this.glyphAtlasImage,a.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new pg(r,this.lineAtlas.image,a.ALPHA),this.lineAtlas.uploaded=!0)}prepare(r){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(r,this.imageAtlasTexture)}queryRenderedFeatures(r,a,c,p,g,y,x,E){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:p,pixelPosMatrix:x,transform:y,params:g,tileTransform:this.tileTransform},r,a,c):{}}querySourceFeatures(r,a){const c=this.latestFeatureIndex;if(!c||!c.rawTileData)return;const p=c.loadVTLayers(),g=a?a.sourceLayer:"",y=p._geojsonTileLayer||p[g];if(!y)return;const x=ip(a&&a.filter),{z:E,x:S,y:M}=this.tileID.canonical,L={z:E,x:S,y:M};for(let N=0;N<y.length;N++){const z=y.feature(N);if(x.needGeometry){const H=zh(z,!0);if(!x.filter(new P(this.tileID.overscaledZ),H,this.tileID.canonical))continue}else if(!x.filter(new P(this.tileID.overscaledZ),z))continue;const F=c.getId(z,g),j=new HC(z,E,S,M,F);j.tile=L,r.push(j)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(r){const a=this.expirationTime;if(r.cacheControl){const c=po(r.cacheControl);c["max-age"]&&(this.expirationTime=Date.now()+1e3*c["max-age"])}else r.expires&&(this.expirationTime=new Date(r.expires).getTime());if(this.expirationTime){const c=Date.now();let p=!1;if(this.expirationTime>c)p=!1;else if(a)if(this.expirationTime<a)p=!0;else{const g=this.expirationTime-a;g?this.expirationTime=c+Math.max(g,3e4):p=!0}else p=!0;p?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(r,a){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(r).length===0||!a)return;const c=this.latestFeatureIndex.loadVTLayers(),p=a.style.listImages();for(const g in this.buckets){if(!a.style.hasLayer(g))continue;const y=this.buckets[g],x=y.layers[0].sourceLayer||"_geojsonTileLayer",E=c[x],S=r[x];if(!E||!S||Object.keys(S).length===0)continue;if(y.update(S,E,p,this.imageAtlas&&this.imageAtlas.patternPositions||{}),y instanceof ev||y instanceof Hy){const L=a.style._getSourceCache(y.layers[0].source);a._terrain&&a._terrain.enabled&&L&&y.programConfigurations.needsUpload&&a._terrain._clearRenderCacheForTile(L.id,this.tileID)}const M=a&&a.style&&a.style.getLayer(g);M&&(this.queryPadding=Math.max(this.queryPadding,M.queryRadius(y)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<da.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(r){this.symbolFadeHoldUntil=da.now()+r}setTexture(r,a){const c=a.context,p=c.gl;this.texture=this.texture||a.getTileTexture(r.width),this.texture?this.texture.update(r,{useMipmap:!0}):(this.texture=new pg(c,r,p.RGBA,{useMipmap:!0}),this.texture.bind(p.LINEAR,p.CLAMP_TO_EDGE))}setDependencies(r,a){const c={};for(const p of a)c[p]=!0;this.dependencies[r]=c}hasDependency(r,a){for(const c of r){const p=this.dependencies[c];if(p){for(const g of a)if(p[g])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(r,a){if(!a||a.name==="mercator"||this._tileDebugBuffer)return;const c=au(JC,this.tileID.canonical,this.tileTransform)[0],p=new rt,g=new Oo;for(let y=0;y<c.length;y++){const{x,y:E}=c[y];p.emplaceBack(x,E),g.emplaceBack(y)}g.emplaceBack(0),this._tileDebugIndexBuffer=r.createIndexBuffer(g),this._tileDebugBuffer=r.createVertexBuffer(p,Xm.members),this._tileDebugSegments=Ar.simpleSegment(0,0,p.length,g.length)}_makeTileBoundsBuffers(r,a){if(this._tileBoundsBuffer||!a||a.name==="mercator")return;const c=au(JC,this.tileID.canonical,this.tileTransform)[0];let p,g;if(this.isRaster){const y=function(x,E){const S=Uh(x,E),M=Math.pow(2,x.z);for(let H=0;H<gl;H++)for(let ne=0;ne<gl;ne++){const he=ls((x.x+(ne+YC(ne))/Vs)/M),re=Si((x.y+(H+YC(H))/Vs)/M),ue=E.project(he,re),pe=H*gl+ne;_l[2*pe+0]=Math.round((ue.x*S.scale-S.x)*Rt),_l[2*pe+1]=Math.round((ue.y*S.scale-S.y)*Rt)}dc.fill(0),mv.fill(0);for(let H=2045;H>=0;H--){const ne=4*H,he=pc[ne+0],re=pc[ne+1],ue=pc[ne+2],pe=pc[ne+3],fe=he+ue>>1,ke=re+pe>>1,De=fe+ke-re,Xe=ke+he-fe,it=re*gl+he,Be=pe*gl+ue,Ke=ke*gl+fe,Je=Math.hypot((_l[2*it+0]+_l[2*Be+0])/2-_l[2*Ke+0],(_l[2*it+1]+_l[2*Be+1])/2-_l[2*Ke+1])>=16;dc[Ke]=dc[Ke]||(Je?1:0),H<1022&&(dc[Ke]=dc[Ke]||dc[(re+Xe>>1)*gl+(he+De>>1)]||dc[(pe+Xe>>1)*gl+(ue+De>>1)])}const L=new Ye,N=new It;let z=0;function F(H,ne){const he=ne*gl+H;return mv[he]===0&&(L.emplaceBack(_l[2*he+0],_l[2*he+1],H*Rt/Vs,ne*Rt/Vs),mv[he]=++z),mv[he]-1}function j(H,ne,he,re,ue,pe){const fe=H+he>>1,ke=ne+re>>1;if(Math.abs(H-ue)+Math.abs(ne-pe)>1&&dc[ke*gl+fe])j(ue,pe,H,ne,fe,ke),j(he,re,ue,pe,fe,ke);else{const De=F(H,ne),Xe=F(he,re),it=F(ue,pe);N.emplaceBack(De,Xe,it)}}return j(0,0,Vs,Vs,Vs,0),j(Vs,Vs,0,0,0,Vs),{vertices:L,indices:N}}(this.tileID.canonical,a);p=y.vertices,g=y.indices}else{p=new Ye,g=new It;for(const{x,y:E}of c)p.emplaceBack(x,E,0,0);const y=O1(p.int16,void 0,4);for(let x=0;x<y.length;x+=3)g.emplaceBack(y[x],y[x+1],y[x+2])}this._tileBoundsBuffer=r.createVertexBuffer(p,KC.members),this._tileBoundsIndexBuffer=r.createIndexBuffer(g),this._tileBoundsSegments=Ar.simpleSegment(0,0,p.length,g.length)}_makeGlobeTileDebugBuffers(r,a){const c=a.projection;if(!c||c.name!=="globe"||a.freezeTileCoverage)return;const p=this.tileID.canonical,g=Wm(vT(p,a)),y=dp(a.zoom);let x;y>0&&(x=c1(new Float64Array(16),a.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(r,p,a,g,x,y),this._makeGlobeTileDebugTextBuffer(r,p,a,g,x,y)}_globePoint(r,a,c,p,g,y,x){let E=Zm(r,a,c);if(y){const S=1<<c.z,M=dl(p.center.lng),L=ml(p.center.lat),N=(c.x+.5)/S-M;let z=0;N>.5?z=-1:N<-.5&&(z=1);let F=(r/Rt+c.x)/S+z,j=(a/Rt+c.y)/S;F=(F-M)*p._pixelsPerMercatorPixel+M,j=(j-L)*p._pixelsPerMercatorPixel+L;const H=[F*p.worldSize,j*p.worldSize,0];wr(H,H,y),E=Oh(E,H,x)}return wr(E,E,g)}_makeGlobeTileDebugBorderBuffer(r,a,c,p,g,y){const x=new rt,E=new Oo,S=new Le,M=(N,z,F,j,H)=>{const ne=(F-N)/(H-1),he=(j-z)/(H-1),re=x.length;for(let ue=0;ue<H;ue++){const pe=N+ue*ne,fe=z+ue*he;x.emplaceBack(pe,fe);const ke=this._globePoint(pe,fe,a,c,p,g,y);S.emplaceBack(ke[0],ke[1],ke[2]),E.emplaceBack(re+ue)}},L=Rt;M(0,0,L,0,16),M(L,0,L,L,16),M(L,L,0,L,16),M(0,L,0,0,16),this._tileDebugIndexBuffer=r.createIndexBuffer(E),this._tileDebugBuffer=r.createVertexBuffer(x,Xm.members),this._globeTileDebugBorderBuffer=r.createVertexBuffer(S,gT.members),this._tileDebugSegments=Ar.simpleSegment(0,0,x.length,E.length)}_makeGlobeTileDebugTextBuffer(r,a,c,p,g,y){const x=Rt/4,E=new rt,S=new It,M=new Le,L=25;S.reserve(32),E.reserve(L),M.reserve(L);const N=(z,F)=>L*z+F;for(let z=0;z<L;z++){const F=z*x;for(let j=0;j<L;j++){const H=j*x;E.emplaceBack(H,F);const ne=this._globePoint(H,F,a,c,p,g,y);M.emplaceBack(ne[0],ne[1],ne[2])}}for(let z=0;z<4;z++)for(let F=0;F<4;F++){const j=N(z,F),H=N(z,F+1),ne=N(z+1,F),he=N(z+1,F+1);S.emplaceBack(j,H,ne),S.emplaceBack(ne,H,he)}this._tileDebugTextIndexBuffer=r.createIndexBuffer(S),this._tileDebugTextBuffer=r.createVertexBuffer(E,Xm.members),this._globeTileDebugTextBuffer=r.createVertexBuffer(M,gT.members),this._tileDebugTextSegments=Ar.simpleSegment(0,0,L,32)}}class lk{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(r,a,c){const p=String(a);if(this.stateChanges[r]=this.stateChanges[r]||{},this.stateChanges[r][p]=this.stateChanges[r][p]||{},hn(this.stateChanges[r][p],c),this.deletedStates[r]===null){this.deletedStates[r]={};for(const g in this.state[r])g!==p&&(this.deletedStates[r][g]=null)}else if(this.deletedStates[r]&&this.deletedStates[r][p]===null){this.deletedStates[r][p]={};for(const g in this.state[r][p])c[g]||(this.deletedStates[r][p][g]=null)}else for(const g in c)this.deletedStates[r]&&this.deletedStates[r][p]&&this.deletedStates[r][p][g]===null&&delete this.deletedStates[r][p][g]}removeFeatureState(r,a,c){if(this.deletedStates[r]===null)return;const p=String(a);if(this.deletedStates[r]=this.deletedStates[r]||{},c&&a!==void 0)this.deletedStates[r][p]!==null&&(this.deletedStates[r][p]=this.deletedStates[r][p]||{},this.deletedStates[r][p][c]=null);else if(a!==void 0)if(this.stateChanges[r]&&this.stateChanges[r][p])for(c in this.deletedStates[r][p]={},this.stateChanges[r][p])this.deletedStates[r][p][c]=null;else this.deletedStates[r][p]=null;else this.deletedStates[r]=null}getState(r,a){const c=String(a),p=hn({},(this.state[r]||{})[c],(this.stateChanges[r]||{})[c]);if(this.deletedStates[r]===null)return{};if(this.deletedStates[r]){const g=this.deletedStates[r][a];if(g===null)return{};for(const y in g)delete p[y]}return p}initializeTileState(r,a){r.setFeatureState(this.state,a)}coalesceChanges(r,a){const c={};for(const p in this.stateChanges){this.state[p]=this.state[p]||{};const g={};for(const y in this.stateChanges[p])this.state[p][y]||(this.state[p][y]={}),hn(this.state[p][y],this.stateChanges[p][y]),g[y]=this.state[p][y];c[p]=g}for(const p in this.deletedStates){this.state[p]=this.state[p]||{};const g={};if(this.deletedStates[p]===null)for(const y in this.state[p])g[y]={},this.state[p][y]={};else for(const y in this.deletedStates[p]){if(this.deletedStates[p][y]===null)this.state[p][y]={};else if(this.state[p][y])for(const x of Object.keys(this.deletedStates[p][y]))delete this.state[p][y][x];g[y]=this.state[p][y]}c[p]=c[p]||{},hn(c[p],g)}if(this.stateChanges={},this.deletedStates={},Object.keys(c).length!==0)for(const p in r)r[p].setFeatureState(c,a)}}class QC{constructor(r){this.size=r,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(r,a){const c=this.toIdx(r,a);return{min:this.minimums[c],max:this.maximums[c]}}isLeaf(r,a){return this.leaves[this.toIdx(r,a)]}toIdx(r,a){return a*this.size+r}}function eI(o,r,a,c){let p=0,g=Number.MAX_VALUE;for(let y=0;y<3;y++)if(Math.abs(c[y])<1e-15){if(a[y]<o[y]||a[y]>r[y])return null}else{const x=1/c[y];let E=(o[y]-a[y])*x,S=(r[y]-a[y])*x;if(E>S){const M=E;E=S,S=M}if(E>p&&(p=E),S<g&&(g=S),p>g)return null}return p}function tI(o,r,a,c,p,g,y,x,E,S,M){const L=c-o,N=p-r,z=g-a,F=y-o,j=x-r,H=E-a,ne=M[1]*H-M[2]*j,he=M[2]*F-M[0]*H,re=M[0]*j-M[1]*F,ue=L*ne+N*he+z*re;if(Math.abs(ue)<1e-15)return null;const pe=1/ue,fe=S[0]-o,ke=S[1]-r,De=S[2]-a,Xe=(fe*ne+ke*he+De*re)*pe;if(Xe<0||Xe>1)return null;const it=ke*z-De*N,Be=De*L-fe*z,Ke=fe*N-ke*L,Je=(M[0]*it+M[1]*Be+M[2]*Ke)*pe;return Je<0||Xe+Je>1?null:(F*it+j*Be+H*Ke)*pe}function nI(o,r,a){return(o-r)/(a-r)}function rI(o,r,a,c,p,g,y,x,E){const S=1<<a,M=g-c,L=y-p,N=(o+1)/S*M+c,z=(r+0)/S*L+p,F=(r+1)/S*L+p;x[0]=(o+0)/S*M+c,x[1]=z,E[0]=N,E[1]=F}class iI{constructor(r){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=r,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const a=function(g){const y=Math.ceil(Math.log2(g.dim/8)),x=[];let E=Math.ceil(Math.pow(2,y));const S=1/E,M=(z,F,j,H,ne)=>{const he=H?1:0,re=(z+1)*j-he,ue=F*j,pe=(F+1)*j-he;ne[0]=z*j,ne[1]=ue,ne[2]=re,ne[3]=pe};let L=new QC(E);const N=[];for(let z=0;z<E*E;z++){M(z%E,Math.floor(z/E),S,!1,N);const F=mc(N[0],N[1],g),j=mc(N[2],N[1],g),H=mc(N[2],N[3],g),ne=mc(N[0],N[3],g);L.minimums.push(Math.min(F,j,H,ne)),L.maximums.push(Math.max(F,j,H,ne)),L.leaves.push(1)}for(x.push(L),E/=2;E>=1;E/=2){const z=x[x.length-1];L=new QC(E);for(let F=0;F<E*E;F++){M(F%E,Math.floor(F/E),2,!0,N);const j=z.getElevation(N[0],N[1]),H=z.getElevation(N[2],N[1]),ne=z.getElevation(N[2],N[3]),he=z.getElevation(N[0],N[3]),re=z.isLeaf(N[0],N[1]),ue=z.isLeaf(N[2],N[1]),pe=z.isLeaf(N[2],N[3]),fe=z.isLeaf(N[0],N[3]),ke=Math.min(j.min,H.min,ne.min,he.min),De=Math.max(j.max,H.max,ne.max,he.max),Xe=re&&ue&&pe&&fe;L.maximums.push(De),L.minimums.push(ke),L.leaves.push(De-ke<=5&&Xe?1:0)}x.push(L)}return x}(this.dem),c=a.length-1,p=a[c];this._addNode(p.minimums[0],p.maximums[0],p.leaves[0]),this._construct(a,0,0,c,0)}raycastRoot(r,a,c,p,g,y,x=1){return eI([r,a,-100],[c,p,this.maximums[0]*x],g,y)}raycast(r,a,c,p,g,y,x=1){if(!this.nodeCount)return null;const E=this.raycastRoot(r,a,c,p,g,y,x);if(E==null)return null;const S=[],M=[],L=[],N=[],z=[{idx:0,t:E,nodex:0,nodey:0,depth:0}];for(;z.length>0;){const{idx:F,t:j,nodex:H,nodey:ne,depth:he}=z.pop();if(this.leaves[F]){rI(H,ne,he,r,a,c,p,L,N);const ue=1<<he,pe=(H+0)/ue,fe=(H+1)/ue,ke=(ne+0)/ue,De=(ne+1)/ue,Xe=mc(pe,ke,this.dem)*x,it=mc(fe,ke,this.dem)*x,Be=mc(fe,De,this.dem)*x,Ke=mc(pe,De,this.dem)*x,Je=tI(L[0],L[1],Xe,N[0],L[1],it,N[0],N[1],Be,g,y),tt=tI(N[0],N[1],Be,L[0],N[1],Ke,L[0],L[1],Xe,g,y),lt=Math.min(Je!==null?Je:Number.MAX_VALUE,tt!==null?tt:Number.MAX_VALUE);if(lt!==Number.MAX_VALUE)return lt;{const je=Gm([],g,y,j);if(oI(Xe,it,Ke,Be,nI(je[0],L[0],N[0]),nI(je[1],L[1],N[1]))>=je[2])return j}continue}let re=0;for(let ue=0;ue<this._siblingOffset.length;ue++){rI((H<<1)+this._siblingOffset[ue][0],(ne<<1)+this._siblingOffset[ue][1],he+1,r,a,c,p,L,N),L[2]=-100,N[2]=this.maximums[this.childOffsets[F]+ue]*x;const pe=eI(L,N,g,y);if(pe!=null){const fe=pe;S[ue]=fe;let ke=!1;for(let De=0;De<re&&!ke;De++)fe>=S[M[De]]&&(M.splice(De,0,ue),ke=!0);ke||(M[re]=ue),re++}}for(let ue=0;ue<re;ue++){const pe=M[ue];z.push({idx:this.childOffsets[F]+pe,t:S[pe],nodex:(H<<1)+this._siblingOffset[pe][0],nodey:(ne<<1)+this._siblingOffset[pe][1],depth:he+1})}}return null}_addNode(r,a,c){return this.minimums.push(r),this.maximums.push(a),this.leaves.push(c),this.childOffsets.push(0),this.nodeCount++}_construct(r,a,c,p,g){if(r[p].isLeaf(a,c)===1)return;this.childOffsets[g]||(this.childOffsets[g]=this.nodeCount);const y=p-1,x=r[y];let E=0,S=0;for(let M=0;M<this._siblingOffset.length;M++){const L=2*a+this._siblingOffset[M][0],N=2*c+this._siblingOffset[M][1],z=x.getElevation(L,N),F=x.isLeaf(L,N),j=this._addNode(z.min,z.max,F);F&&(E|=1<<M),S||(S=j)}for(let M=0;M<this._siblingOffset.length;M++)E&1<<M||this._construct(r,2*a+this._siblingOffset[M][0],2*c+this._siblingOffset[M][1],y,S+M)}}function oI(o,r,a,c,p,g){return mn(mn(o,a,g),mn(r,c,g),p)}function mc(o,r,a){const c=a.dim,p=qe(o*c-.5,0,c-1),g=qe(r*c-.5,0,c-1),y=Math.floor(p),x=Math.floor(g),E=Math.min(y+1,c-1),S=Math.min(x+1,c-1);return oI(a.get(y,x),a.get(E,x),a.get(y,S),a.get(E,S),p-y,g-x)}const sI={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function uk(o,r,a){return(256*o*256+256*r+a)/10-1e4}function ck(o,r,a){return 256*o+r+a/256-32768}class gv{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(r,a,c,p=!1,g=!1){if(this.uid=r,a.height!==a.width)throw new RangeError("DEM tiles must be square");if(c&&c!=="mapbox"&&c!=="terrarium")return nr(`"${c}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=a.height;const y=this.dim=a.height-2,x=new Uint32Array(a.data.buffer);if(this.pixels=new Uint8Array(a.data.buffer),this.encoding=c||"mapbox",this.borderReady=p,!p){for(let E=0;E<y;E++)x[this._idx(-1,E)]=x[this._idx(0,E)],x[this._idx(y,E)]=x[this._idx(y-1,E)],x[this._idx(E,-1)]=x[this._idx(E,0)],x[this._idx(E,y)]=x[this._idx(E,y-1)];x[this._idx(-1,-1)]=x[this._idx(0,0)],x[this._idx(y,-1)]=x[this._idx(y-1,0)],x[this._idx(-1,y)]=x[this._idx(0,y-1)],x[this._idx(y,y)]=x[this._idx(y-1,y-1)],g&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new iI(this)}get(r,a,c=!1){c&&(r=qe(r,-1,this.dim),a=qe(a,-1,this.dim));const p=4*this._idx(r,a);return(this.encoding==="terrarium"?ck:uk)(this.pixels[p],this.pixels[p+1],this.pixels[p+2])}static getUnpackVector(r){return sI[r]}get unpackVector(){return sI[this.encoding]}_idx(r,a){if(r<-1||r>=this.dim+1||a<-1||a>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(a+1)*this.stride+(r+1)}static pack(r,a){const c=[0,0,0,0],p=gv.getUnpackVector(a);let g=Math.floor((r+p[3])/p[2]);return c[2]=g%256,g=Math.floor(g/256),c[1]=g%256,g=Math.floor(g/256),c[0]=g,c}getPixels(){return new Fo({width:this.stride,height:this.stride},this.pixels)}backfillBorder(r,a,c){if(this.dim!==r.dim)throw new Error("dem dimension mismatch");let p=a*this.dim,g=a*this.dim+this.dim,y=c*this.dim,x=c*this.dim+this.dim;switch(a){case-1:p=g-1;break;case 1:g=p+1}switch(c){case-1:y=x-1;break;case 1:x=y+1}const E=-a*this.dim,S=-c*this.dim;for(let M=y;M<x;M++)for(let L=p;L<g;L++){const N=4*this._idx(L,M),z=4*this._idx(L+E,M+S);this.pixels[N+0]=r.pixels[z+0],this.pixels[N+1]=r.pixels[z+1],this.pixels[N+2]=r.pixels[z+2],this.pixels[N+3]=r.pixels[z+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}bt(gv,"DEMData"),bt(iI,"DemMinMaxQuadTree",{omit:["dem"]});class hk{constructor(r,a){this.max=r,this.onRemove=a,this.reset()}reset(){for(const r in this.data)for(const a of this.data[r])a.timeout&&clearTimeout(a.timeout),this.onRemove(a.value);return this.data={},this.order=[],this}add(r,a,c){const p=r.wrapped().key;this.data[p]===void 0&&(this.data[p]=[]);const g={value:a,timeout:void 0};if(c!==void 0&&(g.timeout=setTimeout(()=>{this.remove(r,g)},c)),this.data[p].push(g),this.order.push(p),this.order.length>this.max){const y=this._getAndRemoveByKey(this.order[0]);y&&this.onRemove(y)}return this}has(r){return r.wrapped().key in this.data}getAndRemove(r){return this.has(r)?this._getAndRemoveByKey(r.wrapped().key):null}_getAndRemoveByKey(r){const a=this.data[r].shift();return a.timeout&&clearTimeout(a.timeout),this.data[r].length===0&&delete this.data[r],this.order.splice(this.order.indexOf(r),1),a.value}getByKey(r){const a=this.data[r];return a?a[0].value:null}get(r){return this.has(r)?this.data[r.wrapped().key][0].value:null}remove(r,a){if(!this.has(r))return this;const c=r.wrapped().key,p=a===void 0?0:this.data[c].indexOf(a),g=this.data[c][p];return this.data[c].splice(p,1),g.timeout&&clearTimeout(g.timeout),this.data[c].length===0&&delete this.data[c],this.onRemove(g.value),this.order.splice(this.order.indexOf(c),1),this}setMaxSize(r){for(this.max=r;this.order.length>this.max;){const a=this._getAndRemoveByKey(this.order[0]);a&&this.onRemove(a)}return this}filter(r){const a=[];for(const c in this.data)for(const p of this.data[c])r(p.value)||a.push(p);for(const c of a)this.remove(c.value.tileID,c)}}class Ap{constructor(r,a,c){this.func=r,this.mask=a,this.range=c}}Ap.ReadOnly=!1,Ap.ReadWrite=!0,Ap.disabled=new Ap(519,Ap.ReadOnly,[0,1]);const rw=7680;class iw{constructor(r,a,c,p,g,y){this.test=r,this.ref=a,this.mask=c,this.fail=p,this.depthFail=g,this.pass=y}}iw.disabled=new iw({func:519,mask:0},0,0,rw,rw,rw);class yl{constructor(r,a,c){this.blendFunction=r,this.blendColor=a,this.mask=c}}yl.Replace=[1,0],yl.disabled=new yl(yl.Replace,xr.transparent,[!1,!1,!1,!1]),yl.unblended=new yl(yl.Replace,xr.transparent,[!0,!0,!0,!0]),yl.alphaBlended=new yl([1,771],xr.transparent,[!0,!0,!0,!0]);const ow=1029,sw=2305;class Da{constructor(r,a,c){this.enable=r,this.mode=a,this.frontFace=c}}Da.disabled=new Da(!1,ow,sw),Da.backCCW=new Da(!0,ow,sw),Da.backCW=new Da(!0,ow,2304),Da.frontCW=new Da(!0,1028,2304),Da.frontCCW=new Da(!0,1028,sw);class Vh extends ih{constructor(r,a,c){super(),this.id=r,this._onlySymbols=c,a.on("data",p=>{p.dataType==="source"&&p.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&p.dataType==="source"&&p.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),a.on("error",()=>{this._sourceErrored=!0}),this._source=a,this._tiles={},this._cache=new hk(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=a.minTileCacheSize,this._maxTileCacheSize=a.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new lk,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(r){this.map=r,this._minTileCacheSize=this._minTileCacheSize===void 0&&r?r._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&r?r._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const r in this._tiles){const a=this._tiles[r];if(a.state!=="loaded"&&a.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const r=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,r&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(r,a){return r.isSymbolTile=this._onlySymbols,this._source.loadTile(r,a)}_unloadTile(r){if(this._source.unloadTile)return this._source.unloadTile(r,()=>{})}_abortTile(r){if(this._source.abortTile)return this._source.abortTile(r,()=>{})}serialize(){return this._source.serialize()}prepare(r){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const a in this._tiles){const c=this._tiles[a];c.upload(r),c.prepare(this.map.style.imageManager)}}getIds(){return Vt(this._tiles).map(r=>r.tileID).sort(aI).map(r=>r.key)}getRenderableIds(r){const a=[];for(const c in this._tiles)this._isIdRenderable(+c,r)&&a.push(this._tiles[c]);return r?a.sort((c,p)=>{const g=c.tileID,y=p.tileID,x=new xe(g.canonical.x,g.canonical.y)._rotate(this.transform.angle),E=new xe(y.canonical.x,y.canonical.y)._rotate(this.transform.angle);return g.overscaledZ-y.overscaledZ||E.y-x.y||E.x-x.x}).map(c=>c.tileID.key):a.map(c=>c.tileID).sort(aI).map(c=>c.key)}hasRenderableParent(r){const a=this.findLoadedParent(r,0);return!!a&&this._isIdRenderable(a.tileID.key)}_isIdRenderable(r,a){return this._tiles[r]&&this._tiles[r].hasData()&&!this._coveredTiles[r]&&(a||!this._tiles[r].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const r in this._tiles)this._tiles[r].state!=="errored"&&this._reloadTile(+r,"reloading")}}_reloadTile(r,a){const c=this._tiles[r];c&&(c.state!=="loading"&&(c.state=a),this._loadTile(c,this._tileLoaded.bind(this,c,r,a)))}_tileLoaded(r,a,c,p){if(p)if(r.state="errored",p.status!==404)this._source.fire(new ma(p,{tile:r}));else if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const g=this.map.painter.terrain;this.update(this.transform,g.getScaledDemTileSize(),!0),g.resetTileLookupCache(this.id)}else this.update(this.transform);else r.timeAdded=da.now(),c==="expired"&&(r.refreshedUponExpiration=!0),this._setTileReloadTimer(a,r),this._source.type==="raster-dem"&&r.dem&&this._backfillDEM(r),this._state.initializeTileState(r,this.map?this.map.painter:null),this._source.fire(new Zl("data",{dataType:"source",tile:r,coord:r.tileID,sourceCacheId:this.id}))}_backfillDEM(r){const a=this.getRenderableIds();for(let p=0;p<a.length;p++){const g=a[p];if(r.neighboringTiles&&r.neighboringTiles[g]){const y=this.getTileByID(g);c(r,y),c(y,r)}}function c(p,g){if(!p.dem||p.dem.borderReady)return;p.needsHillshadePrepare=!0,p.needsDEMTextureUpload=!0;let y=g.tileID.canonical.x-p.tileID.canonical.x;const x=g.tileID.canonical.y-p.tileID.canonical.y,E=Math.pow(2,p.tileID.canonical.z),S=g.tileID.key;y===0&&x===0||Math.abs(x)>1||(Math.abs(y)>1&&(Math.abs(y+E)===1?y+=E:Math.abs(y-E)===1&&(y-=E)),g.dem&&p.dem&&(p.dem.backfillBorder(g.dem,y,x),p.neighboringTiles&&p.neighboringTiles[S]&&(p.neighboringTiles[S].backfilled=!0)))}}getTile(r){return this.getTileByID(r.key)}getTileByID(r){return this._tiles[r]}_retainLoadedChildren(r,a,c,p){for(const g in this._tiles){let y=this._tiles[g];if(p[g]||!y.hasData()||y.tileID.overscaledZ<=a||y.tileID.overscaledZ>c)continue;let x=y.tileID;for(;y&&y.tileID.overscaledZ>a+1;){const S=y.tileID.scaledTo(y.tileID.overscaledZ-1);y=this._tiles[S.key],y&&y.hasData()&&(x=S)}let E=x;for(;E.overscaledZ>a;)if(E=E.scaledTo(E.overscaledZ-1),r[E.key]){p[x.key]=x;break}}}findLoadedParent(r,a){if(r.key in this._loadedParentTiles){const c=this._loadedParentTiles[r.key];return c&&c.tileID.overscaledZ>=a?c:null}for(let c=r.overscaledZ-1;c>=a;c--){const p=r.scaledTo(c),g=this._getLoadedTile(p);if(g)return g}}_getLoadedTile(r){const a=this._tiles[r.key];return a&&a.hasData()?a:this._cache.getByKey(this._source.reparseOverscaled?r.wrapped().key:r.canonical.key)}updateCacheSize(r,a){a=a||this._source.tileSize;const c=Math.ceil(r.width/a)+1,p=Math.ceil(r.height/a)+1,g=Math.floor(c*p*5),y=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,g):g,x=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,y):y;this._cache.setMaxSize(x)}handleWrapJump(r){const a=Math.round((r-(this._prevLng===void 0?r:this._prevLng))/360);if(this._prevLng=r,a){const c={};for(const p in this._tiles){const g=this._tiles[p];g.tileID=g.tileID.unwrapTo(g.tileID.wrap+a),c[g.tileID.key]=g}this._tiles=c;for(const p in this._timers)clearTimeout(this._timers[p]),delete this._timers[p];for(const p in this._tiles)this._setTileReloadTimer(+p,this._tiles[p])}}update(r,a,c){if(this.transform=r,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!c)return;let p;this.updateCacheSize(r,a),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?p=r.getVisibleUnwrappedCoordinates(this._source.tileID).map(x=>new Qi(x.canonical.z,x.wrap,x.canonical.z,x.canonical.x,x.canonical.y)):(p=r.coveringTiles({tileSize:a||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!c,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(p=p.filter(x=>this._source.hasTile(x)))):p=[];const g=this._updateRetainedTiles(p);if(lI(this._source.type)&&p.length!==0){const x={},E={},S=Object.keys(g);for(const L of S){const N=g[L],z=this._tiles[L];if(!z||z.fadeEndTime&&z.fadeEndTime<=da.now())continue;const F=this.findLoadedParent(N,Math.max(N.overscaledZ-Vh.maxOverzooming,this._source.minzoom));F&&(this._addTile(F.tileID),x[F.tileID.key]=F.tileID),E[L]=N}const M=p[p.length-1].overscaledZ;for(const L in this._tiles){const N=this._tiles[L];if(g[L]||!N.hasData())continue;let z=N.tileID;for(;z.overscaledZ>M;){z=z.scaledTo(z.overscaledZ-1);const F=this._tiles[z.key];if(F&&F.hasData()&&E[z.key]){g[L]=N.tileID;break}}}for(const L in x)g[L]||(this._coveredTiles[L]=!0,g[L]=x[L])}for(const x in g)this._tiles[x].clearFadeHold();const y=function(x,E){const S=[];for(const M in x)M in E||S.push(M);return S}(this._tiles,g);for(const x of y){const E=this._tiles[x];E.hasSymbolBuckets&&!E.holdingForFade()?E.setHoldDuration(this.map._fadeDuration):E.hasSymbolBuckets&&!E.symbolFadeFinished()||this._removeTile(+x)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const r in this._tiles)this._tiles[r].holdingForFade()&&this._removeTile(+r)}_updateRetainedTiles(r){const a={};if(r.length===0)return a;const c={},p=r.reduce((S,M)=>Math.min(S,M.overscaledZ),1/0),g=r[0].overscaledZ,y=Math.max(g-Vh.maxOverzooming,this._source.minzoom),x=Math.max(g+Vh.maxUnderzooming,this._source.minzoom),E={};for(const S of r){const M=this._addTile(S);a[S.key]=S,M.hasData()||p<this._source.maxzoom&&(E[S.key]=S)}this._retainLoadedChildren(E,p,x,a);for(const S of r){let M=this._tiles[S.key];if(M.hasData())continue;if(S.canonical.z>=this._source.maxzoom){const N=S.children(this._source.maxzoom)[0],z=this.getTile(N);if(z&&z.hasData()){a[N.key]=N;continue}}else{const N=S.children(this._source.maxzoom);if(a[N[0].key]&&a[N[1].key]&&a[N[2].key]&&a[N[3].key])continue}let L=M.wasRequested();for(let N=S.overscaledZ-1;N>=y;--N){const z=S.scaledTo(N);if(c[z.key]||(c[z.key]=!0,M=this.getTile(z),!M&&L&&(M=this._addTile(z)),M&&(a[z.key]=z,L=M.wasRequested(),M.hasData())))break}}return a}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const r in this._tiles){const a=[];let c,p=this._tiles[r].tileID;for(;p.overscaledZ>0;){if(p.key in this._loadedParentTiles){c=this._loadedParentTiles[p.key];break}a.push(p.key);const g=p.scaledTo(p.overscaledZ-1);if(c=this._getLoadedTile(g),c)break;p=g}for(const g of a)this._loadedParentTiles[g]=c}}_addTile(r){let a=this._tiles[r.key];if(a)return a;a=this._cache.getAndRemove(r),a&&(this._setTileReloadTimer(r.key,a),a.tileID=r,this._state.initializeTileState(a,this.map?this.map.painter:null),this._cacheTimers[r.key]&&(clearTimeout(this._cacheTimers[r.key]),delete this._cacheTimers[r.key],this._setTileReloadTimer(r.key,a)));const c=!!a;if(!c){const p=this.map?this.map.painter:null;a=new nw(r,this._source.tileSize*r.overscaleFactor(),this.transform.tileZoom,p,this._isRaster),this._loadTile(a,this._tileLoaded.bind(this,a,r.key,a.state))}return a?(a.uses++,this._tiles[r.key]=a,c||this._source.fire(new Zl("dataloading",{tile:a,coord:a.tileID,dataType:"source"})),a):null}_setTileReloadTimer(r,a){r in this._timers&&(clearTimeout(this._timers[r]),delete this._timers[r]);const c=a.getExpiryTimeout();c&&(this._timers[r]=setTimeout(()=>{this._reloadTile(r,"expired"),delete this._timers[r]},c))}_removeTile(r){const a=this._tiles[r];a&&(a.uses--,delete this._tiles[r],this._timers[r]&&(clearTimeout(this._timers[r]),delete this._timers[r]),a.uses>0||(a.hasData()&&a.state!=="reloading"?this._cache.add(a.tileID,a,a.getExpiryTimeout()):(a.aborted=!0,this._abortTile(a),this._unloadTile(a))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const r in this._tiles)this._removeTile(+r);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(r,a,c){const p=[],g=this.transform;if(!g)return p;const y=g.projection.name==="globe",x=dl(g.center.lng);for(const E in this._tiles){const S=this._tiles[E];if(c&&S.clearQueryDebugViz(),S.holdingForFade())continue;let M;if(y){const L=S.tileID.canonical;if(L.z===0){const N=[Math.abs(qe(x,...dg(L,-1))-x),Math.abs(qe(x,...dg(L,1))-x)];M=[0,2*N.indexOf(Math.min(...N))-1]}else{const N=[Math.abs(qe(x,...dg(L,-1))-x),Math.abs(qe(x,...dg(L,0))-x),Math.abs(qe(x,...dg(L,1))-x)];M=[N.indexOf(Math.min(...N))-1]}}else M=[0];for(const L of M){const N=r.containsTile(S,g,a,L);N&&p.push(N)}}return p}getVisibleCoordinates(r){const a=this.getRenderableIds(r).map(c=>this._tiles[c].tileID);for(const c of a)c.projMatrix=this.transform.calculateProjMatrix(c.toUnwrapped());return a}hasTransition(){if(this._source.hasTransition())return!0;if(lI(this._source.type))for(const r in this._tiles){const a=this._tiles[r];if(a.fadeEndTime!==void 0&&a.fadeEndTime>=da.now())return!0}return!1}setFeatureState(r,a,c){this._state.updateState(r=r||"_geojsonTileLayer",a,c)}removeFeatureState(r,a,c){this._state.removeFeatureState(r=r||"_geojsonTileLayer",a,c)}getFeatureState(r,a){return this._state.getState(r=r||"_geojsonTileLayer",a)}setDependencies(r,a,c){const p=this._tiles[r];p&&p.setDependencies(a,c)}reloadTilesForDependencies(r,a){for(const c in this._tiles)this._tiles[c].hasDependency(r,a)&&this._reloadTile(+c,"reloading");this._cache.filter(c=>!c.hasDependency(r,a))}_preloadTiles(r,a){if(!this._sourceLoaded){const x=()=>{this._sourceLoaded&&(this._source.off("data",x),this._preloadTiles(r,a))};return void this._source.on("data",x)}const c=new Map,p=Array.isArray(r)?r:[r],g=this.map.painter.terrain,y=this.usedForTerrain&&g?g.getScaledDemTileSize():this._source.tileSize;for(const x of p){const E=x.coveringTiles({tileSize:y,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const S of E)c.set(S.key,S);this.usedForTerrain&&x.updateElevation(!1)}kt(Array.from(c.values()),(x,E)=>{const S=new nw(x,this._source.tileSize*x.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(S,M=>{this._source.type==="raster-dem"&&S.dem&&this._backfillDEM(S),E(M,S)})},a)}}function aI(o,r){const a=Math.abs(2*o.wrap)-+(o.wrap<0),c=Math.abs(2*r.wrap)-+(r.wrap<0);return o.overscaledZ-r.overscaledZ||c-a||r.canonical.y-o.canonical.y||r.canonical.x-o.canonical.x}function lI(o){return o==="raster"||o==="image"||o==="video"||o==="custom"}function dg(o,r){const a=1<<o.z;return[o.x/a+r,(o.x+1)/a+r]}Vh.maxOverzooming=10,Vh.maxUnderzooming=3;class _v{constructor(r,a,c){this._demTile=r,this._dem=this._demTile.dem,this._scale=a,this._offset=c}static create(r,a,c){const p=c||r.findDEMTileFor(a);if(!p||!p.dem)return;const g=p.dem,y=p.tileID,x=1<<a.canonical.z-y.canonical.z;return new _v(p,p.tileSize/Rt/x,[(a.canonical.x/x-y.canonical.x)*g.dim,(a.canonical.y/x-y.canonical.y)*g.dim])}tileCoordToPixel(r,a){const c=a*this._scale+this._offset[1],p=Math.floor(r*this._scale+this._offset[0]),g=Math.floor(c);return new xe(p,g)}getElevationAt(r,a,c,p){const g=r*this._scale+this._offset[0],y=a*this._scale+this._offset[1],x=Math.floor(g),E=Math.floor(y),S=this._dem;return p=!!p,c?mn(mn(S.get(x,E,p),S.get(x,E+1,p),y-E),mn(S.get(x+1,E,p),S.get(x+1,E+1,p),y-E),g-x):S.get(x,E,p)}getElevationAtPixel(r,a,c){return this._dem.get(r,a,!!c)}getMeterToDEM(r){return(1<<this._demTile.tileID.canonical.z)*Aa(1,r)*this._dem.stride}}class uI{constructor(r,a){this.tileID=r,this.x=r.canonical.x,this.y=r.canonical.y,this.z=r.canonical.z,this.grid=new eu(Rt,16,0),this.featureIndexArray=new Ah,this.promoteId=a}insert(r,a,c,p,g,y=0){const x=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(c,p,g,y);const E=this.grid;for(let S=0;S<a.length;S++){const M=a[S],L=[1/0,1/0,-1/0,-1/0];for(let N=0;N<M.length;N++){const z=M[N];L[0]=Math.min(L[0],z.x),L[1]=Math.min(L[1],z.y),L[2]=Math.max(L[2],z.x),L[3]=Math.max(L[3],z.y)}L[0]<Rt&&L[1]<Rt&&L[2]>=0&&L[3]>=0&&E.insert(x,L[0],L[1],L[2],L[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new U1(new rv(this.rawTileData)).layers,this.sourceLayerCoder=new WC(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const r in this.vtLayers)this.vtFeatures[r]=[]}return this.vtLayers}query(r,a,c,p){this.loadVTLayers();const g=r.params||{},y=ip(g.filter),x=r.tileResult,E=r.transform,S=x.bufferedTilespaceBounds,M=this.grid.query(S.min.x,S.min.y,S.max.x,S.max.y,(F,j,H,ne)=>NT(x.bufferedTilespaceGeometry,F,j,H,ne));M.sort(fk);let L=null;E.elevation&&M.length>0&&(L=_v.create(E.elevation,this.tileID));const N={};let z;for(let F=0;F<M.length;F++){const j=M[F];if(j===z)continue;z=j;const H=this.featureIndexArray.get(j);let ne=null;this.loadMatchingFeature(N,H,y,g.layers,g.availableImages,a,c,p,(he,re,ue,pe=0)=>(ne||(ne=au(he,this.tileID.canonical,r.tileTransform)),re.queryIntersectsFeature(x,he,ue,ne,this.z,r.transform,r.pixelPosMatrix,L,pe)))}return N}loadMatchingFeature(r,a,c,p,g,y,x,E,S){const{featureIndex:M,bucketIndex:L,sourceLayerIndex:N,layoutVertexArrayOffset:z}=a,F=this.bucketLayerIDs[L];if(p&&!function(he,re){for(let ue=0;ue<he.length;ue++)if(re.indexOf(he[ue])>=0)return!0;return!1}(p,F))return;const j=this.sourceLayerCoder.decode(N),H=this.vtLayers[j].feature(M);if(c.needGeometry){const he=zh(H,!0);if(!c.filter(new P(this.tileID.overscaledZ),he,this.tileID.canonical))return}else if(!c.filter(new P(this.tileID.overscaledZ),H))return;const ne=this.getId(H,j);for(let he=0;he<F.length;he++){const re=F[he];if(p&&p.indexOf(re)<0)continue;const ue=y[re];if(!ue)continue;let pe={};ne!==void 0&&E&&(pe=E.getState(ue.sourceLayer||"_geojsonTileLayer",ne));const fe=hn({},x[re]);fe.paint=cI(fe.paint,ue.paint,H,pe,g),fe.layout=cI(fe.layout,ue.layout,H,pe,g);const ke=!S||S(H,ue,pe,z);if(!ke)continue;const De=new HC(H,this.z,this.x,this.y,ne);De.layer=fe;let Xe=r[re];Xe===void 0&&(Xe=r[re]=[]),Xe.push({featureIndex:M,feature:De,intersectionZ:ke})}}lookupSymbolFeatures(r,a,c,p,g,y,x,E){const S={};this.loadVTLayers();const M=ip(g);for(const L of r)this.loadMatchingFeature(S,{bucketIndex:c,sourceLayerIndex:p,featureIndex:L,layoutVertexArrayOffset:0},M,y,x,E,a);return S}loadFeature(r){const{featureIndex:a,sourceLayerIndex:c}=r;this.loadVTLayers();const p=this.sourceLayerCoder.decode(c),g=this.vtFeatures[p];if(g[a])return g[a];const y=this.vtLayers[p].feature(a);return g[a]=y,y}hasLayer(r){for(const a of this.bucketLayerIDs)for(const c of a)if(r===c)return!0;return!1}getId(r,a){let c=r.id;if(this.promoteId){const p=typeof this.promoteId=="string"?this.promoteId:this.promoteId[a];p!=null&&(c=r.properties[p]),typeof c=="boolean"&&(c=Number(c))}return c}}function cI(o,r,a,c,p){return rn(o,(g,y)=>{const x=r instanceof te?r.get(y):null;return x&&x.evaluate?x.evaluate(a,c,p):x})}function fk(o,r){return r-o}bt(uI,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class hI{constructor(r,a){this.width=r,this.height=a,this.nextRow=0,this.image=new lu({width:r,height:a}),this.positions={},this.uploaded=!1}getDash(r,a){const c=this.getKey(r,a);return this.positions[c]}trim(){const r=this.width,a=this.height=Kr(this.nextRow);this.image.resize({width:r,height:a})}getKey(r,a){return r.join(",")+a}getDashRanges(r,a,c){const p=[];let g=r.length%2==1?-r[r.length-1]*c:0,y=r[0]*c,x=!0;p.push({left:g,right:y,isDash:x,zeroLength:r[0]===0});let E=r[0];for(let S=1;S<r.length;S++){x=!x;const M=r[S];g=E*c,E+=M,y=E*c,p.push({left:g,right:y,isDash:x,zeroLength:M===0})}return p}addRoundDash(r,a,c){const p=a/2;for(let g=-c;g<=c;g++){const y=this.width*(this.nextRow+c+g);let x=0,E=r[x];for(let S=0;S<this.width;S++){S/E.right>1&&(E=r[++x]);const M=Math.abs(S-E.left),L=Math.abs(S-E.right),N=Math.min(M,L);let z;const F=g/c*(p+1);if(E.isDash){const j=p-Math.abs(F);z=Math.sqrt(N*N+j*j)}else z=p-Math.sqrt(N*N+F*F);this.image.data[y+S]=Math.max(0,Math.min(255,z+128))}}}addRegularDash(r,a){for(let E=r.length-1;E>=0;--E){const S=r[E],M=r[E+1];S.zeroLength?r.splice(E,1):M&&M.isDash===S.isDash&&(M.left=S.left,r.splice(E,1))}const c=r[0],p=r[r.length-1];c.isDash===p.isDash&&(c.left=p.left-this.width,p.right=c.right+this.width);const g=this.width*this.nextRow;let y=0,x=r[y];for(let E=0;E<this.width;E++){E/x.right>1&&(x=r[++y]);const S=Math.abs(E-x.left),M=Math.abs(E-x.right),L=Math.min(S,M);this.image.data[g+E]=Math.max(0,Math.min(255,(x.isDash?L:-L)+a+128))}}addDash(r,a){const c=this.getKey(r,a);if(this.positions[c])return this.positions[c];const p=a==="round",g=p?7:0,y=2*g+1;if(this.nextRow+y>this.height)return nr("LineAtlas out of space"),null;r.length===0&&r.push(1);let x=0;for(let M=0;M<r.length;M++)r[M]<0&&(nr("Negative value is found in line dasharray, replacing values with 0"),r[M]=0),x+=r[M];if(x!==0){const M=this.width/x,L=this.getDashRanges(r,this.width,M);p?this.addRoundDash(L,M,g):this.addRegularDash(L,a==="square"?.5*M:0)}const E=this.nextRow+g;this.nextRow+=y;const S={tl:[E,g],br:[x,0]};return this.positions[c]=S,S}}bt(hI,"LineAtlas");const fI=1*La;class pI{constructor(r){const a={},c=[];for(const x in r){const E=r[x],S=a[x]={};for(const M in E.glyphs){const L=E.glyphs[+M];if(!L||L.bitmap.width===0||L.bitmap.height===0)continue;const N=L.metrics.localGlyph?fI:1,z={x:0,y:0,w:L.bitmap.width+2*N,h:L.bitmap.height+2*N};c.push(z),S[M]=z}}const{w:p,h:g}=q1(c),y=new lu({width:p||1,height:g||1});for(const x in r){const E=r[x];for(const S in E.glyphs){const M=E.glyphs[+S];if(!M||M.bitmap.width===0||M.bitmap.height===0)continue;const L=a[x][S],N=M.metrics.localGlyph?fI:1;lu.copy(M.bitmap,y,{x:0,y:0},{x:L.x+N,y:L.y+N},M.bitmap)}}this.image=y,this.positions=a}}bt(pI,"GlyphAtlas");class pk{constructor(r){this.tileID=new Qi(r.tileID.overscaledZ,r.tileID.wrap,r.tileID.canonical.z,r.tileID.canonical.x,r.tileID.canonical.y),this.tileZoom=r.tileZoom,this.uid=r.uid,this.zoom=r.zoom,this.canonical=r.tileID.canonical,this.pixelRatio=r.pixelRatio,this.tileSize=r.tileSize,this.source=r.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=r.showCollisionBoxes,this.collectResourceTiming=!!r.collectResourceTiming,this.returnDependencies=!!r.returnDependencies,this.promoteId=r.promoteId,this.enableTerrain=!!r.enableTerrain,this.isSymbolTile=r.isSymbolTile,this.tileTransform=Uh(r.tileID.canonical,r.projection),this.projection=r.projection}parse(r,a,c,p,g){this.status="parsing",this.data=r,this.collisionBoxArray=new kn;const y=new WC(Object.keys(r.layers).sort()),x=new uI(this.tileID,this.promoteId);x.bucketLayerIDs=[];const E={},S=new hI(256,256),M={featureIndex:x,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:S,availableImages:c},L=a.familiesBySource[this.source];for(const pe in L){const fe=r.layers[pe];if(!fe)continue;let ke=!1,De=!1;for(const Be of L[pe])Be[0].type==="symbol"?ke=!0:De=!0;if(this.isSymbolTile===!0&&!ke||this.isSymbolTile===!1&&!De)continue;fe.version===1&&nr(`Vector tile source "${this.source}" layer "${pe}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Xe=y.encode(pe),it=[];for(let Be=0;Be<fe.length;Be++){const Ke=fe.feature(Be),Je=x.getId(Ke,pe);it.push({feature:Ke,id:Je,index:Be,sourceLayerIndex:Xe})}for(const Be of L[pe]){const Ke=Be[0];this.isSymbolTile!==void 0&&Ke.type==="symbol"!==this.isSymbolTile||Ke.minzoom&&this.zoom<Math.floor(Ke.minzoom)||Ke.maxzoom&&this.zoom>=Ke.maxzoom||Ke.visibility!=="none"&&(aw(Be,this.zoom,c),(E[Ke.id]=Ke.createBucket({index:x.bucketLayerIDs.length,layers:Be,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Xe,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.spec,availableImages:c})).populate(it,M,this.tileID.canonical,this.tileTransform),x.bucketLayerIDs.push(Be.map(Je=>Je.id)))}}let N,z,F,j;S.trim();const H={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},ne=()=>{if(N)return g(N);if(z&&F&&j){const pe=new pI(z),fe=new xC(F,j);for(const ke in E){const De=E[ke];De instanceof fc?(aw(De.layers,this.zoom,c),BN(De,z,pe.positions,F,fe.iconPositions,this.showCollisionBoxes,c,this.tileID.canonical,this.tileZoom,this.projection)):De.hasPattern&&(De instanceof ev||De instanceof Hy||De instanceof ng)&&(aw(De.layers,this.zoom,c),De.addFeatures(M,this.tileID.canonical,fe.patternPositions,c,this.tileTransform))}this.status="done",g(null,{buckets:Vt(E).filter(ke=>!ke.isEmpty()),featureIndex:x,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:pe.image,lineAtlas:S,imageAtlas:fe,glyphMap:this.returnDependencies?z:null,iconMap:this.returnDependencies?F:null,glyphPositions:this.returnDependencies?pe.positions:null})}},he=rn(M.glyphDependencies,pe=>Object.keys(pe).map(Number));Object.keys(he).length?p.send("getGlyphs",{uid:this.uid,stacks:he},(pe,fe)=>{N||(N=pe,z=fe,ne())},void 0,!1,H):z={};const re=Object.keys(M.iconDependencies);re.length?p.send("getImages",{icons:re,source:this.source,tileID:this.tileID,type:"icons"},(pe,fe)=>{N||(N=pe,F=fe,ne())},void 0,!1,H):F={};const ue=Object.keys(M.patternDependencies);ue.length?p.send("getImages",{icons:ue,source:this.source,tileID:this.tileID,type:"patterns"},(pe,fe)=>{N||(N=pe,j=fe,ne())},void 0,!1,H):j={},ne()}}function aw(o,r,a){const c=new P(r);for(const p of o)p.recalculate(c,a)}class dI{constructor(r){this.entries={},this.scheduler=r}request(r,a,c,p){const g=this.entries[r]=this.entries[r]||{callbacks:[]};if(g.result){const[y,x]=g.result;return this.scheduler?this.scheduler.add(()=>{p(y,x)},a):p(y,x),()=>{}}return g.callbacks.push(p),g.cancel||(g.cancel=c((y,x)=>{g.result=[y,x];for(const E of g.callbacks)this.scheduler?this.scheduler.add(()=>{E(y,x)},a):E(y,x);setTimeout(()=>delete this.entries[r],3e3)})),()=>{g.result||(g.callbacks=g.callbacks.filter(y=>y!==p),g.callbacks.length||(g.cancel(),delete this.entries[r]))}}}function mI(o,r,a){const c=JSON.stringify(o.request);return o.data&&(this.deduped.entries[c]={result:[null,o.data]}),this.deduped.request(c,{type:"parseTile",isSymbolTile:o.isSymbolTile,zoom:o.tileZoom},p=>{const g=Uu(o.request,(y,x,E,S)=>{y?p(y):x&&p(null,{vectorTile:a?void 0:new U1(new rv(x)),rawData:x,cacheControl:E,expires:S})});return()=>{g.cancel(),p()}},r)}const gI=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class lw{static from(r){if(!(r instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[a,c]=new Uint8Array(r,0,2);if(a!==219)throw new Error("Data does not appear to be in a KDBush format.");const p=c>>4;if(p!==1)throw new Error(`Got v${p} data when expected v1.`);const g=gI[15&c];if(!g)throw new Error("Unrecognized array type.");const[y]=new Uint16Array(r,2,1),[x]=new Uint32Array(r,4,1);return new lw(x,y,g,r)}constructor(r,a=64,c=Float64Array,p){if(isNaN(r)||r<0)throw new Error(`Unpexpected numItems value: ${r}.`);this.numItems=+r,this.nodeSize=Math.min(Math.max(+a,2),65535),this.ArrayType=c,this.IndexArrayType=r<65536?Uint16Array:Uint32Array;const g=gI.indexOf(this.ArrayType),y=2*r*this.ArrayType.BYTES_PER_ELEMENT,x=r*this.IndexArrayType.BYTES_PER_ELEMENT,E=(8-x%8)%8;if(g<0)throw new Error(`Unexpected typed array class: ${c}.`);p&&p instanceof ArrayBuffer?(this.data=p,this.ids=new this.IndexArrayType(this.data,8,r),this.coords=new this.ArrayType(this.data,8+x+E,2*r),this._pos=2*r,this._finished=!0):(this.data=new ArrayBuffer(8+y+x+E),this.ids=new this.IndexArrayType(this.data,8,r),this.coords=new this.ArrayType(this.data,8+x+E,2*r),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+g]),new Uint16Array(this.data,2,1)[0]=a,new Uint32Array(this.data,4,1)[0]=r)}add(r,a){const c=this._pos>>1;return this.ids[c]=c,this.coords[this._pos++]=r,this.coords[this._pos++]=a,c}finish(){const r=this._pos>>1;if(r!==this.numItems)throw new Error(`Added ${r} items when expected ${this.numItems}.`);return uw(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(r,a,c,p){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:g,coords:y,nodeSize:x}=this,E=[0,g.length-1,0],S=[];for(;E.length;){const M=E.pop()||0,L=E.pop()||0,N=E.pop()||0;if(L-N<=x){for(let H=N;H<=L;H++){const ne=y[2*H],he=y[2*H+1];ne>=r&&ne<=c&&he>=a&&he<=p&&S.push(g[H])}continue}const z=N+L>>1,F=y[2*z],j=y[2*z+1];F>=r&&F<=c&&j>=a&&j<=p&&S.push(g[z]),(M===0?r<=F:a<=j)&&(E.push(N),E.push(z-1),E.push(1-M)),(M===0?c>=F:p>=j)&&(E.push(z+1),E.push(L),E.push(1-M))}return S}within(r,a,c){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:p,coords:g,nodeSize:y}=this,x=[0,p.length-1,0],E=[],S=c*c;for(;x.length;){const M=x.pop()||0,L=x.pop()||0,N=x.pop()||0;if(L-N<=y){for(let H=N;H<=L;H++)yI(g[2*H],g[2*H+1],r,a)<=S&&E.push(p[H]);continue}const z=N+L>>1,F=g[2*z],j=g[2*z+1];yI(F,j,r,a)<=S&&E.push(p[z]),(M===0?r-c<=F:a-c<=j)&&(x.push(N),x.push(z-1),x.push(1-M)),(M===0?r+c>=F:a+c>=j)&&(x.push(z+1),x.push(L),x.push(1-M))}return E}}function uw(o,r,a,c,p,g){if(p-c<=a)return;const y=c+p>>1;_I(o,r,y,c,p,g),uw(o,r,a,c,y-1,1-g),uw(o,r,a,y+1,p,1-g)}function _I(o,r,a,c,p,g){for(;p>c;){if(p-c>600){const S=p-c+1,M=a-c+1,L=Math.log(S),N=.5*Math.exp(2*L/3),z=.5*Math.sqrt(L*N*(S-N)/S)*(M-S/2<0?-1:1);_I(o,r,a,Math.max(c,Math.floor(a-M*N/S+z)),Math.min(p,Math.floor(a+(S-M)*N/S+z)),g)}const y=r[2*a+g];let x=c,E=p;for(mg(o,r,c,a),r[2*p+g]>y&&mg(o,r,c,p);x<E;){for(mg(o,r,x,E),x++,E--;r[2*x+g]<y;)x++;for(;r[2*E+g]>y;)E--}r[2*c+g]===y?mg(o,r,c,E):(E++,mg(o,r,E,p)),E<=a&&(c=E+1),a<=E&&(p=E-1)}}function mg(o,r,a,c){cw(o,a,c),cw(r,2*a,2*c),cw(r,2*a+1,2*c+1)}function cw(o,r,a){const c=o[r];o[r]=o[a],o[a]=c}function yI(o,r,a,c){const p=o-a,g=r-c;return p*p+g*g}s.ARRAY_TYPE=zo,s.AUTH_ERR_MSG=me,s.Aabb=Ji,s.Actor=class{constructor(o,r,a){this.target=o,this.parent=r,this.mapId=a,this.callbacks={},this.cancelCallbacks={},rs(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=pa()?o:w,this.scheduler=new sk}send(o,r,a,c,p=!1,g){const y=Math.round(1e18*Math.random()).toString(36).substring(0,10);a&&(a.metadata=g,this.callbacks[y]=a);const x=zu(this.globalScope)?void 0:[];return this.target.postMessage({id:y,type:o,hasCallback:!!a,targetMapId:c,mustQueue:p,sourceMapId:this.mapId,data:ic(r,x)},x),{cancel:()=>{a&&delete this.callbacks[y],this.target.postMessage({id:y,type:"<cancel>",targetMapId:c,sourceMapId:this.mapId})}}}receive(o){const r=o.data,a=r.id;if(a&&(!r.targetMapId||this.mapId===r.targetMapId))if(r.type==="<cancel>"){const c=this.cancelCallbacks[a];delete this.cancelCallbacks[a],c&&c.cancel()}else if(r.mustQueue||pa()){const c=this.callbacks[a];this.cancelCallbacks[a]=this.scheduler.add(()=>this.processTask(a,r),c&&c.metadata||{type:"message"})}else this.processTask(a,r)}processTask(o,r){if(r.type==="<response>"){const a=this.callbacks[o];delete this.callbacks[o],a&&(r.error?a(tu(r.error)):a(null,tu(r.data)))}else{const a=zu(this.globalScope)?void 0:[],c=r.hasCallback?(g,y)=>{delete this.cancelCallbacks[o],this.target.postMessage({id:o,type:"<response>",sourceMapId:this.mapId,error:g?ic(g):null,data:ic(y,a)},a)}:g=>{},p=tu(r.data);if(this.parent[r.type])this.parent[r.type](r.sourceMapId,p,c);else if(this.parent.getWorkerSource){const g=r.type.split(".");this.parent.getWorkerSource(r.sourceMapId,g[0],p.source)[g[1]](p,c)}else c(new Error(`Could not find function ${r.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},s.CanonicalTileID=Qy,s.Color=xr,s.ColorMode=yl,s.CullFaceMode=Da,s.DEMData=gv,s.DataConstantProperty=V,s.DedupedRequest=dI,s.DepthMode=Ap,s.EXTENT=Rt,s.Elevation=class{isDataAvailableAtPoint(o){const r=this._source();if(this.isUsingMockSource()||!r||o.y<0||o.y>1)return!1;const a=r.getSource().maxzoom,c=1<<a,p=Math.floor(o.x),g=Math.floor((o.x-p)*c),y=Math.floor(o.y*c),x=this.findDEMTileFor(new Qi(a,p,a,g,y));return!(!x||!x.dem)}getAtPointOrZero(o,r=0){return this.getAtPoint(o,r)||0}getAtPoint(o,r,a=!0){if(this.isUsingMockSource())return null;r==null&&(r=null);const c=this._source();if(!c||o.y<0||o.y>1)return r;const p=c.getSource().maxzoom,g=1<<p,y=Math.floor(o.x),x=o.x-y,E=new Qi(p,y,p,Math.floor(x*g),Math.floor(o.y*g)),S=this.findDEMTileFor(E);if(!S||!S.dem)return r;const M=S.dem,L=1<<S.tileID.canonical.z,N=(x*L-S.tileID.canonical.x)*M.dim,z=(o.y*L-S.tileID.canonical.y)*M.dim,F=Math.floor(N),j=Math.floor(z);return(a?this.exaggeration():1)*mn(mn(M.get(F,j),M.get(F,j+1),z-j),mn(M.get(F+1,j),M.get(F+1,j+1),z-j),N-F)}getAtTileOffset(o,r,a){const c=1<<o.canonical.z;return this.getAtPointOrZero(new mp(o.wrap+(o.canonical.x+r/Rt)/c,(o.canonical.y+a/Rt)/c))}getAtTileOffsetFunc(o,r,a,c){return p=>{const g=this.getAtTileOffset(o,p.x,p.y),y=c.upVector(o.canonical,p.x,p.y);return as(y,y,g*c.upVectorScale(o.canonical,r,a).metersToTile),y}}getForTilePoints(o,r,a,c){if(this.isUsingMockSource())return!1;const p=_v.create(this,o,c);return!!p&&(r.forEach(g=>{g[2]=this.exaggeration()*p.getElevationAt(g[0],g[1],a)}),!0)}getMinMaxForTile(o){if(this.isUsingMockSource())return null;const r=this.findDEMTileFor(o);if(!r||!r.dem)return null;const a=r.dem.tree,c=r.tileID,p=1<<o.canonical.z-c.canonical.z;let g=o.canonical.x/p-c.canonical.x,y=o.canonical.y/p-c.canonical.y,x=0;for(let E=0;E<o.canonical.z-c.canonical.z&&!a.leaves[x];E++){g*=2,y*=2;const S=2*Math.floor(y)+Math.floor(g);x=a.childOffsets[x]+S,g%=1,y%=1}return{min:this.exaggeration()*a.minimums[x],max:this.exaggeration()*a.maximums[x]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(o,r,a){throw new Error("Pure virtual method called.")}pointCoordinate(o){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(o){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},s.ErrorEvent=ma,s.EvaluationParameters=P,s.Event=Zl,s.Evented=ih,s.FillExtrusionBucket=ng,s.Frustum=_1,s.FrustumCorners=g1,s.GLOBE_RADIUS=fl,s.GLOBE_SCALE_MATCH_LATITUDE=45,s.GLOBE_ZOOM_THRESHOLD_MAX=_T,s.GLOBE_ZOOM_THRESHOLD_MIN=y1,s.GlobeSharedBuffers=class{constructor(o){this._createGrid(o),this._createPoles(o)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const o of this._poleSegments)o.destroy();for(const o of this._gridSegments)o.withSkirts.destroy(),o.withoutSkirts.destroy();if(this._wireframeIndexBuffer){this._wireframeIndexBuffer.destroy();for(const o of this._wireframeSegments)o.destroy()}}_fillGridMeshWithLods(o,r){const a=new rt,c=new It,p=[],g=o+1+2,y=r[0]+1,x=r[0]+1+(1+r.length),E=(S,M,L)=>{let N=S===g-1?S-2:S===0?S:S-1;return N+=L?24575:0,[N,M]};for(let S=0;S<g;++S)a.emplaceBack(...E(S,0,!0));for(let S=0;S<y;++S)for(let M=0;M<g;++M)a.emplaceBack(...E(M,S,(M===0||M===g-1)&&!0));for(let S=0;S<r.length;++S){const M=r[S];for(let L=0;L<g;++L)a.emplaceBack(...E(L,M,!0))}for(let S=0;S<r.length;++S){const M=c.length,L=r[S]+1+2,N=new It;for(let j=0;j<L-1;j++){const H=j===L-2,ne=H?g*(x-r.length+S-j):g;for(let he=0;he<g-1;he++){const re=j*g+he;j===0||H||he===0||he===g-2?(N.emplaceBack(re+1,re,re+ne),N.emplaceBack(re+ne,re+ne+1,re+1)):(c.emplaceBack(re+1,re,re+ne),c.emplaceBack(re+ne,re+ne+1,re+1))}}const z=Ar.simpleSegment(0,M,a.length,c.length-M);for(let j=0;j<N.uint16.length;j+=3)c.emplaceBack(N.uint16[j],N.uint16[j+1],N.uint16[j+2]);const F=Ar.simpleSegment(0,M,a.length,c.length-M);p.push({withoutSkirts:z,withSkirts:F})}return{vertices:a,indices:c,segments:p}}_createGrid(o){const r=this._fillGridMeshWithLods(kh,$m);this._gridSegments=r.segments,this._gridBuffer=o.createVertexBuffer(r.vertices,Xm.members),this._gridIndexBuffer=o.createIndexBuffer(r.indices,!0)}_createPoles(o){const r=new It;for(let p=0;p<=kh;p++)r.emplaceBack(0,p+1,p+2);this._poleIndexBuffer=o.createIndexBuffer(r,!0);const a=new Nn,c=new Nn;this._poleSegments=[];for(let p=0,g=0;p<y1;p++){const y=360/(1<<p);a.emplaceBack(0,-fl,0,.5,0),c.emplaceBack(0,-fl,0,.5,1);for(let x=0;x<=kh;x++){const E=x/kh,S=mn(0,y,E),[M,L,N]=fp(sR,aR,S,fl);a.emplaceBack(M,L,N,E,0),c.emplaceBack(M,L,N,E,1)}this._poleSegments.push(Ar.simpleSegment(g,0,66,64)),g+=66}this._poleNorthVertexBuffer=o.createVertexBuffer(a,mT,!1),this._poleSouthVertexBuffer=o.createVertexBuffer(c,mT,!1)}getGridBuffers(o,r){return[this._gridBuffer,this._gridIndexBuffer,r?this._gridSegments[o].withSkirts:this._gridSegments[o].withoutSkirts]}getPoleBuffers(o){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[o]]}getWirefameBuffers(o,r){if(!this._wireframeSegments){const a=new ti,c=kh,p=c+1+2,g=1;this._wireframeSegments=[];for(let y=0,x=0;y<$m.length;y++){const E=$m[y];for(let M=g;M<E+g;M++)for(let L=g;L<c+g;L++){const N=M*p+L;a.emplaceBack(N,N+1),a.emplaceBack(N,N+p),a.emplaceBack(N,N+p+1)}const S=E*c*3;this._wireframeSegments.push(Ar.simpleSegment(0,x,(E+1)*p,S)),x+=S}this._wireframeIndexBuffer=o.createIndexBuffer(a)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments[r]]}},s.GlyphManager=Sp,s.ImagePosition=X1,s.KDBush=lw,s.LivePerformanceUtils=Fx,s.LngLat=On,s.LngLatBounds=lc,s.LocalGlyphMode=W1,s.MAX_MERCATOR_LATITUDE=Ti,s.MercatorCoordinate=mp,s.ONE_EM=pi,s.OverscaledTileID=Qi,s.PerformanceMarkers=Vu,s.Point=xe,s.Properties=ae,s.RGBAImage=Fo,s.Ray=m1,s.RequestManager=class{constructor(o,r,a){this._transformRequestFn=o,this._customAccessToken=r,this._silenceAuthErrors=!!a,this._createSkuToken()}_createSkuToken(){const o=function(){let r="";for(let a=0;a<10;a++)r+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",B,r].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=o.token,this._skuTokenExpiresAt=o.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(o,r){return this._transformRequestFn&&this._transformRequestFn(o,r)||{url:o}}normalizeStyleURL(o,r){if(!Ee(o))return o;const a=ft(o);return a.path=`/styles/v1${a.path}`,this._makeAPIURL(a,this._customAccessToken||r)}normalizeGlyphsURL(o,r){if(!Ee(o))return o;const a=ft(o);return a.path=`/fonts/v1${a.path}`,this._makeAPIURL(a,this._customAccessToken||r)}normalizeSourceURL(o,r,a,c){if(!Ee(o))return o;const p=ft(o);return p.path=`/v4/${p.authority}.json`,p.params.push("secure"),a&&p.params.push(`language=${a}`),c&&p.params.push(`worldview=${c}`),this._makeAPIURL(p,this._customAccessToken||r)}normalizeSpriteURL(o,r,a,c){const p=ft(o);return Ee(o)?(p.path=`/styles/v1${p.path}/sprite${r}${a}`,this._makeAPIURL(p,this._customAccessToken||c)):(p.path+=`${r}${a}`,at(p))}normalizeTileURL(o,r,a){if(this._isSkuTokenExpired()&&this._createSkuToken(),o&&!Ee(o))return o;const c=ft(o);c.path=c.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${r||a&&c.authority!=="raster"&&a===512?"@2x":""}${R.supported?".webp":"$1"}`),c.authority==="raster"?c.path=`/${D.RASTER_URL_PREFIX}${c.path}`:(c.path=c.path.replace(/^.+\/v4\//,"/"),c.path=`/${D.TILE_URL_VERSION}${c.path}`);const p=this._customAccessToken||function(g){for(const y of g){const x=y.match(/^access_token=(.*)$/);if(x)return x[1]}return null}(c.params)||D.ACCESS_TOKEN;return D.REQUIRE_ACCESS_TOKEN&&p&&this._skuToken&&c.params.push(`sku=${this._skuToken}`),this._makeAPIURL(c,p)}canonicalizeTileURL(o,r){const a=ft(o);if(!a.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!a.path.match(/\.[\w]+$/))return o;let c="mapbox://";a.path.match(/^\/raster\/v1\//)?c+=`raster/${a.path.replace(`/${D.RASTER_URL_PREFIX}/`,"")}`:c+=`tiles/${a.path.replace(`/${D.TILE_URL_VERSION}/`,"")}`;let p=a.params;return r&&(p=p.filter(g=>!g.match(/^access_token=/))),p.length&&(c+=`?${p.join("&")}`),c}canonicalizeTileset(o,r){const a=!!r&&Ee(r),c=[];for(const p of o.tiles||[])Pe(p)?c.push(this.canonicalizeTileURL(p,a)):c.push(p);return c}_makeAPIURL(o,r){const a="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",c=ft(D.API_URL);if(o.protocol=c.protocol,o.authority=c.authority,o.protocol==="http"){const p=o.params.indexOf("secure");p>=0&&o.params.splice(p,1)}if(c.path!=="/"&&(o.path=`${c.path}${o.path}`),!D.REQUIRE_ACCESS_TOKEN)return at(o);if(r=r||D.ACCESS_TOKEN,!this._silenceAuthErrors){if(!r)throw new Error(`An API access token is required to use Mapbox GL. ${a}`);if(r[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${a}`)}return o.params=o.params.filter(p=>p.indexOf("access_token")===-1),o.params.push(`access_token=${r||""}`),at(o)}},s.ResourceType=ql,s.SegmentVector=Ar,s.SourceCache=Vh,s.StencilMode=iw,s.StructArrayLayout1ui2=Oo,s.StructArrayLayout2f1f2i16=Ot,s.StructArrayLayout2i4=rt,s.StructArrayLayout2ui4=ti,s.StructArrayLayout3f12=nn,s.StructArrayLayout3ui6=It,s.StructArrayLayout4i8=Ye,s.StructArrayLayout5f20=Nn,s.Texture=pg,s.Tile=nw,s.Transitionable=U,s.Uniform1f=Oy,s.Uniform1i=class extends iu{constructor(o){super(o),this.current=0}set(o,r,a){this.fetchUniformLocation(o,r)&&this.current!==a&&(this.current=a,this.gl.uniform1i(this.location,a))}},s.Uniform2f=class extends iu{constructor(o){super(o),this.current=[0,0]}set(o,r,a){this.fetchUniformLocation(o,r)&&(a[0]===this.current[0]&&a[1]===this.current[1]||(this.current=a,this.gl.uniform2f(this.location,a[0],a[1])))}},s.Uniform3f=class extends iu{constructor(o){super(o),this.current=[0,0,0]}set(o,r,a){this.fetchUniformLocation(o,r)&&(a[0]===this.current[0]&&a[1]===this.current[1]&&a[2]===this.current[2]||(this.current=a,this.gl.uniform3f(this.location,a[0],a[1],a[2])))}},s.Uniform4f=JS,s.UniformColor=QS,s.UniformMatrix2f=class extends iu{constructor(o){super(o),this.current=qD}set(o,r,a){if(this.fetchUniformLocation(o,r)){for(let c=0;c<4;c++)if(a[c]!==this.current[c]){this.current=a,this.gl.uniformMatrix2fv(this.location,!1,a);break}}}},s.UniformMatrix3f=class extends iu{constructor(o){super(o),this.current=GD}set(o,r,a){if(this.fetchUniformLocation(o,r)){for(let c=0;c<9;c++)if(a[c]!==this.current[c]){this.current=a,this.gl.uniformMatrix3fv(this.location,!1,a);break}}}},s.UniformMatrix4f=class extends iu{constructor(o){super(o),this.current=jD}set(o,r,a){if(this.fetchUniformLocation(o,r)){if(a[12]!==this.current[12]||a[0]!==this.current[0])return this.current=a,void this.gl.uniformMatrix4fv(this.location,!1,a);for(let c=1;c<16;c++)if(a[c]!==this.current[c]){this.current=a,this.gl.uniformMatrix4fv(this.location,!1,a);break}}}},s.UnwrappedTileID=oC,s.ValidationError=xt,s.VectorTileFeature=Ky,s.VectorTileWorkerSource=class extends ih{constructor(o,r,a,c,p){super(),this.actor=o,this.layerIndex=r,this.availableImages=a,this.loadVectorData=p||mI,this.loading={},this.loaded={},this.deduped=new dI(o.scheduler),this.isSpriteLoaded=c,this.scheduler=o.scheduler}loadTile(o,r){const a=o.uid,c=o&&o.request,p=c&&c.collectResourceTiming,g=this.loading[a]=new pk(o);g.abort=this.loadVectorData(o,(y,x)=>{const E=!this.loading[a];if(delete this.loading[a],E||y||!x)return g.status="done",E||(this.loaded[a]=g),r(y);const S=x.rawData,M={};x.expires&&(M.expires=x.expires),x.cacheControl&&(M.cacheControl=x.cacheControl),g.vectorTile=x.vectorTile||new U1(new rv(S));const L=()=>{g.parse(g.vectorTile,this.layerIndex,this.availableImages,this.actor,(N,z)=>{if(N||!z)return r(N);const F={};if(p){const j=jd(c);j.length>0&&(F.resourceTiming=JSON.parse(JSON.stringify(j)))}r(null,hn({rawTileData:S.slice(0)},z,M,F))})};this.isSpriteLoaded?L():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(L,{type:"parseTile",isSymbolTile:o.isSymbolTile,zoom:o.tileZoom}):L()}),this.loaded=this.loaded||{},this.loaded[a]=g})}reloadTile(o,r){const a=this.loaded,c=o.uid,p=this;if(a&&a[c]){const g=a[c];g.showCollisionBoxes=o.showCollisionBoxes,g.enableTerrain=!!o.enableTerrain,g.projection=o.projection,g.tileTransform=Uh(o.tileID.canonical,o.projection);const y=(x,E)=>{const S=g.reloadCallback;S&&(delete g.reloadCallback,g.parse(g.vectorTile,p.layerIndex,this.availableImages,p.actor,S)),r(x,E)};g.status==="parsing"?g.reloadCallback=y:g.status==="done"&&(g.vectorTile?g.parse(g.vectorTile,this.layerIndex,this.availableImages,this.actor,y):y())}}abortTile(o,r){const a=o.uid,c=this.loading[a];c&&(c.abort&&c.abort(),delete this.loading[a]),r()}removeTile(o,r){const a=this.loaded,c=o.uid;a&&a[c]&&delete a[c],r()}},s.WritingMode=us,s.ZoomDependentExpression=bh,s.add=su,s.addDynamicAttributes=pv,s.adjoint=function(o,r){var a=r[0],c=r[1],p=r[2],g=r[3],y=r[4],x=r[5],E=r[6],S=r[7],M=r[8];return o[0]=y*M-x*S,o[1]=p*S-c*M,o[2]=c*x-p*y,o[3]=x*E-g*M,o[4]=a*M-p*E,o[5]=p*g-a*x,o[6]=g*S-y*E,o[7]=c*E-a*S,o[8]=a*y-c*g,o},s.asyncAll=kt,s.bezier=Bt,s.bindAll=rs,s.boundsAttributes=KC,s.bufferConvexPolygon=function(o,r){const a=[];for(let c=0;c<o.length;c++){const p=Ct(c-1,-1,o.length-1),g=Ct(c+1,-1,o.length-1),y=o[c],x=o[g],E=o[p].sub(y).unit(),S=x.sub(y).unit(),M=S.angleWithSep(E.x,E.y),L=E.add(S).unit().mult(-1*r/Math.sin(M/2));a.push(y.add(L))}return a},s.cacheEntryPossiblyAdded=function(o){nh++,nh>Df&&(o.getActor().send("enforceCacheSizeLimit",Lf),nh=0)},s.calculateGlobeLabelMatrix=function(o,r){const{x:a,y:c}=o.point,p=bT(a,c,o.worldSize/o._pixelsPerMercatorPixel,0,0);return Dh(p,p,w1(pl(r)))},s.calculateGlobeMatrix=function(o){const{x:r,y:a}=o.point,{lng:c,lat:p}=o._center;return bT(r,a,o.worldSize,c,p)},s.calculateGlobeMercatorMatrix=function(o){const r=o.pixelsPerMeter,a=r/Aa(1,o.center.lat),c=Ia(new Float64Array(16));return Bm(c,c,[o.point.x,o.point.y,0]),Rh(c,c,[a,a,r]),Float32Array.from(c)},s.circumferenceAtLatitude=E1,s.clamp=qe,s.clearTileCache=function(o){if(!th())return;const r=w.caches.delete(Fu);o&&r.catch(o).then(()=>o())},s.clipLine=RC,s.clone=function(o){var r=new zo(16);return r[0]=o[0],r[1]=o[1],r[2]=o[2],r[3]=o[3],r[4]=o[4],r[5]=o[5],r[6]=o[6],r[7]=o[7],r[8]=o[8],r[9]=o[9],r[10]=o[10],r[11]=o[11],r[12]=o[12],r[13]=o[13],r[14]=o[14],r[15]=o[15],r},s.clone$1=fo,s.collisionCircleLayout=hN,s.config=D,s.conjugate=function(o,r){return o[0]=-r[0],o[1]=-r[1],o[2]=-r[2],o[3]=r[3],o},s.create=function(){var o=new zo(16);return zo!=Float32Array&&(o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[11]=0,o[12]=0,o[13]=0,o[14]=0),o[0]=1,o[5]=1,o[10]=1,o[15]=1,o},s.create$1=nT,s.createExpression=tc,s.createLayout=Ce,s.createStyleLayer=function(o){return o.type==="custom"?new nk(o):new ik[o.type](o)},s.cross=d1,s.degToRad=He,s.distance=function(o,r){return Math.hypot(r[0]-o[0],r[1]-o[1],r[2]-o[2])},s.div=function(o,r,a){return o[0]=r[0]/a[0],o[1]=r[1]/a[1],o[2]=r[2]/a[2],o},s.dot=Fs,s.earthRadius=Hm,s.ease=Zt,s.easeCubicInOut=Pt,s.ecefToLatLng=function([o,r,a]){const c=Math.hypot(o,r,a),p=Math.atan2(o,a),g=.5*Math.PI-Math.acos(-r/c);return new On($e(p),$e(g))},s.emitValidationErrors=Py,s.endsWith=fa,s.enforceCacheSizeLimit=function(o){Gl(),Lo&&Lo.then(r=>{r.keys().then(a=>{for(let c=0;c<a.length-o;c++)r.delete(a[c])})})},s.evaluateSizeForFeature=tv,s.evaluateSizeForZoom=xp,s.evaluateVariableOffset=FC,s.evented=v,s.exactEquals=function(o,r){return o[0]===r[0]&&o[1]===r[1]&&o[2]===r[2]&&o[3]===r[3]},s.exactEquals$1=function(o,r){return o[0]===r[0]&&o[1]===r[1]&&o[2]===r[2]},s.exported=da,s.exported$1=R,s.extend=hn,s.extend$1=ga,s.fillExtrusionHeightLift=nC,s.filterObject=Ou,s.fromMat4=function(o,r){return o[0]=r[0],o[1]=r[1],o[2]=r[2],o[3]=r[4],o[4]=r[5],o[5]=r[6],o[6]=r[8],o[7]=r[9],o[8]=r[10],o},s.fromQuat=function(o,r){var a=r[0],c=r[1],p=r[2],g=r[3],y=a+a,x=c+c,E=p+p,S=a*y,M=c*y,L=c*x,N=p*y,z=p*x,F=p*E,j=g*y,H=g*x,ne=g*E;return o[0]=1-L-F,o[1]=M+ne,o[2]=N-H,o[3]=0,o[4]=M-ne,o[5]=1-S-F,o[6]=z+j,o[7]=0,o[8]=N+H,o[9]=z-j,o[10]=1-S-L,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o},s.fromRotation=function(o,r){var a=Math.sin(r),c=Math.cos(r);return o[0]=c,o[1]=a,o[2]=0,o[3]=-a,o[4]=c,o[5]=0,o[6]=0,o[7]=0,o[8]=1,o},s.fromScaling=iT,s.furthestTileCorner=function(o){const r=Math.round((o+45+360)%360/90)%4;return ze[r]},s.getAABBPointSquareDist=function(o,r,a){let c=0;for(let p=0;p<2;++p){const g=a?a[p]:0;o[p]>g&&(c+=(o[p]-g)*(o[p]-g)),r[p]<g&&(c+=(g-r[p])*(g-r[p]))}return c},s.getAnchorAlignment=Z1,s.getAnchorJustification=Y1,s.getBounds=function(o){let r=1/0,a=1/0,c=-1/0,p=-1/0;for(const g of o)r=Math.min(r,g.x),a=Math.min(a,g.y),c=Math.max(c,g.x),p=Math.max(p,g.y);return{min:new xe(r,a),max:new xe(c,p)}},s.getColumn=sl,s.getDefaultExportFromCjs=q,s.getGridMatrix=function(o,r,a,c){const p=r.getNorth(),g=r.getSouth(),y=r.getWest(),x=r.getEast(),E=1<<o.z,S=x-y,M=p-g,L=S/kh,N=-M/$m[a],z=[0,L,0,N,0,0,p,y,0];if(o.z>0){const F=180/c;rT(z,z,[F/S+1,0,0,0,F/M+1,0,-.5*F/L,.5*F/N,1])}return z[2]=E,z[5]=o.x,z[8]=o.y,z},s.getImage=le,s.getJSON=function(o,r){return $l(hn(o,{type:"json"}),r)},s.getLatitudinalLod=function(o){const r=Ti-5;o=qe(o,-r,r)/r*90;const a=Math.pow(Math.abs(Math.sin(He(o))),3);return Math.round(a*($m.length-1))},s.getMapSessionAPI=Jr,s.getPerformanceMeasurement=jd,s.getProjection=$C,s.getRTLTextPluginStatus=b,s.getReferrer=Xl,s.getTilePoint=function(o,{x:r,y:a},c=0){return new xe(((r-c)*o.scale-o.x)*Rt,(a*o.scale-o.y)*Rt)},s.getTileVec3=function(o,r,a=0){return hp(((r.x-a)*o.scale-o.x)*Rt,(r.y*o.scale-o.y)*Rt,CT(r.z,r.y))},s.getVideo=function(o,r){const a=w.document.createElement("video");a.muted=!0,a.onloadstart=function(){r(null,a)};for(let c=0;c<o.length;c++){const p=w.document.createElement("source");Rf(o[c])||(a.crossOrigin="Anonymous"),p.src=o[c],a.appendChild(p)}return{cancel:()=>{}}},s.globeCenterToScreenPoint=function(o){const r=[0,0,0],a=Ia(new Float64Array(16));return Dh(a,o.pixelMatrix,o.globeMatrix),wr(r,r,a),new xe(r[0],r[1])},s.globeDenormalizeECEF=w1,s.globeECEFOrigin=function(o,r){const a=[0,0,0];return wr(a,a,Wm(pl(r.canonical))),wr(a,a,o),a},s.globeMetersToEcef=By,s.globeNormalizeECEF=Wm,s.globePixelsToTileUnits=function(o,r){return Rt/(512*Math.pow(2,o))*Vy(pl(r))},s.globePoleMatrixForTile=function(o,r,a){const c=Ia(new Float64Array(16)),p=(r/(1<<o)-.5)*Math.PI*2;return Fy(c,a.globeMatrix,p),Float32Array.from(c)},s.globeTileBounds=pl,s.globeTiltAtLngLat=ET,s.globeToMercatorTransition=dp,s.globeUseCustomAntiAliasing=function(o,r,a){const c=dp(a.zoom),p=o.style.map._antialias,g=!!r.extStandardDerivatives,y=r.extStandardDerivativesForceOff||o.terrain&&o.terrain.exaggeration()>0;return c===0&&!p&&!y&&g},s.identity=Ia,s.identity$1=fT,s.invert=c1,s.isFullscreen=function(){return!!w.document.fullscreenElement||!!w.document.webkitFullscreenElement},s.isLngLatBehindGlobe=b1,s.isMapAuthenticated=function(o){return zi.has(o)},s.isMapboxURL=Ee,s.isSafariWithAntialiasingBug=function(o){const r=o.navigator?o.navigator.userAgent:null;return!!zu(o)&&r&&(r.match("Version/15.4")||r.match("Version/15.5")||r.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},s.latFromMercatorY=Si,s.latLngToECEF=pp,s.len=QD,s.length=Um,s.length$1=function(o){return Math.hypot(o[0],o[1],o[2],o[3])},s.lngFromMercatorX=ls,s.loadVectorTile=mI,s.makeRequest=$l,s.mapValue=function(o,r,a,c,p){return qe((o-r)/(a-r)*(p-c)+c,c,p)},s.mercatorScale=IT,s.mercatorXfromLng=dl,s.mercatorYfromLat=ml,s.mercatorZfromAltitude=Aa,s.mul=KD,s.mul$1=JD,s.multiply=Dh,s.multiply$1=rT,s.multiply$2=aT,s.nextPowerOfTwo=Kr,s.normalize=Ki,s.normalize$1=eR,s.normalize$2=cT,s.number=mn,s.ortho=function(o,r,a,c,p,g,y){var x=1/(r-a),E=1/(c-p),S=1/(g-y);return o[0]=-2*x,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=-2*E,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=2*S,o[11]=0,o[12]=(r+a)*x,o[13]=(p+c)*E,o[14]=(y+g)*S,o[15]=1,o},s.pbf=fC,s.perspective=function(o,r,a,c,p){var g,y=1/Math.tan(r/2);return o[0]=y/a,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=y,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[11]=-1,o[12]=0,o[13]=0,o[15]=0,p!=null&&p!==1/0?(o[10]=(p+c)*(g=1/(c-p)),o[14]=2*p*c*g):(o[10]=-1,o[14]=-2*c),o},s.pick=function(o,r){const a={};for(let c=0;c<r.length;c++){const p=r[c];p in o&&(a[p]=o[p])}return a},s.plugin=I,s.pointGeometry=Se,s.polesInViewport=function(o){const r=Ia(new Float64Array(16));Dh(r,o.pixelMatrix,o.globeMatrix);const a=[0,Bs,0],c=[0,Us,0];return wr(a,a,r),wr(c,c,r),[a[0]>0&&a[0]<=o.width&&a[1]>0&&a[1]<=o.height&&!b1(o,new On(o.center.lat,90)),c[0]>0&&c[0]<=o.width&&c[1]>0&&c[1]<=o.height&&!b1(o,new On(o.center.lat,-90))]},s.polygonContainsPoint=Fh,s.polygonIntersectsBox=NT,s.polygonIntersectsPolygon=PT,s.polygonizeBounds=function(o,r,a=0,c=!0){const p=new xe(a,a),g=o.sub(p),y=r.add(p),x=[g,new xe(y.x,g.y),y,new xe(g.x,y.y)];return c&&x.push(g.clone()),x},s.posAttributes=Xm,s.postMapLoadEvent=Cr,s.postPerformanceEvent=qr,s.postTurnstileEvent=fn,s.potpack=q1,s.prevPowerOfTwo=function(o){return o<=1?1:Math.pow(2,Math.floor(Math.log(o)/Math.LN2))},s.radToDeg=$e,s.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],s.registerForPluginStateChange=function(o){return o({pluginStatus:m,pluginURL:l}),v.on("pluginStateChange",o),o},s.removeAuthState=function(o){zi.delete(o)},s.renderColorRamp=L1,s.resample=MT,s.rotateX=h1,s.rotateX$1=pT,s.rotateY=Fy,s.rotateY$1=dT,s.rotateZ=function(o,r,a){var c=Math.sin(a),p=Math.cos(a),g=r[0],y=r[1],x=r[2],E=r[3],S=r[4],M=r[5],L=r[6],N=r[7];return r!==o&&(o[8]=r[8],o[9]=r[9],o[10]=r[10],o[11]=r[11],o[12]=r[12],o[13]=r[13],o[14]=r[14],o[15]=r[15]),o[0]=g*p+S*c,o[1]=y*p+M*c,o[2]=x*p+L*c,o[3]=E*p+N*c,o[4]=S*p-g*c,o[5]=M*p-y*c,o[6]=L*p-x*c,o[7]=N*p-E*c,o},s.rotateZ$1=function(o,r,a){a*=.5;var c=r[0],p=r[1],g=r[2],y=r[3],x=Math.sin(a),E=Math.cos(a);return o[0]=c*E+p*x,o[1]=p*E-c*x,o[2]=g*E+y*x,o[3]=y*E-g*x,o},s.scale=Rh,s.scale$1=uT,s.scale$2=as,s.scaleAndAdd=Gm,s.set=function(o,r,a,c){return o[0]=r,o[1]=a,o[2]=c,o},s.setCacheLimits=function(o,r){Lf=o,Df=r},s.setColumn=function(o,r,a){o[4*r+0]=a[0],o[4*r+1]=a[1],o[4*r+2]=a[2],o[4*r+3]=a[3]},s.setRTLTextPlugin=function(o,r,a=!1){if(m===Nm||m===km||m===Om)throw new Error("setRTLTextPlugin cannot be called multiple times.");l=da.resolveURL(o),m=Nm,oc=r,_(),a||C()},s.smoothstep=Et,s.spec=Ge,s.squaredLength=function(o){var r=o[0],a=o[1],c=o[2];return r*r+a*a+c*c},s.storeAuthState=function(o,r){r?zi.add(o):zi.delete(o)},s.sub=Ma,s.subtract=p1,s.symbolSize=fN,s.tileAABB=function(o,r,a,c,p,g,y,x,E){if(E.name==="globe")return oR(o,r,new Qy(a,c,p));const S=Uh({z:a,x:c,y:p},E);return new Ji([(g+S.x/S.scale)*r,r*(S.y/S.scale),y],[(g+S.x2/S.scale)*r,r*(S.y2/S.scale),x])},s.tileCornersToBounds=Uy,s.tileTransform=Uh,s.transformMat3=function(o,r,a){var c=r[0],p=r[1],g=r[2];return o[0]=c*a[0]+p*a[3]+g*a[6],o[1]=c*a[1]+p*a[4]+g*a[7],o[2]=c*a[2]+p*a[5]+g*a[8],o},s.transformMat4=wr,s.transformMat4$1=Nh,s.transformQuat=lT,s.transitionTileAABBinECEF=vT,s.translate=Bm,s.transpose=function(o,r){if(o===r){var a=r[1],c=r[2],p=r[5];o[1]=r[3],o[2]=r[6],o[3]=a,o[5]=r[7],o[6]=c,o[7]=p}else o[0]=r[0],o[1]=r[3],o[2]=r[6],o[3]=r[1],o[4]=r[4],o[5]=r[7],o[6]=r[2],o[7]=r[5],o[8]=r[8];return o},s.triggerPluginCompletionEvent=f,s.uniqueId=Wn,s.updateGlobeVertexNormal=function(o,r,a,c,p){const g=5*r+2;o.float32[g+0]=a,o.float32[g+1]=c,o.float32[g+2]=p},s.validateCustomStyleLayer=function(o){const r=[],a=o.id;return a===void 0&&r.push({message:`layers.${a}: missing required property "id"`}),o.render===void 0&&r.push({message:`layers.${a}: missing required method "render"`}),o.renderingMode&&o.renderingMode!=="2d"&&o.renderingMode!=="3d"&&r.push({message:`layers.${a}: property "renderingMode" must be either "2d" or "3d"`}),r},s.validateFilter=o=>ko(Ih(o)),s.validateFog=o=>ko(Iy(o)),s.validateLayer=o=>ko(Ey(o)),s.validateLight=o=>ko(Cy(o)),s.validateSource=o=>ko(Ty(o)),s.validateStyle=Ay,s.validateTerrain=o=>ko(Am(o)),s.values=Vt,s.vectorTile=Yy,s.version=T,s.warnOnce=nr,s.window=w,s.wrap=Ct}),h(["./shared"],function(s){function w(ce){if(typeof ce=="number"||typeof ce=="boolean"||typeof ce=="string"||ce==null)return JSON.stringify(ce);if(Array.isArray(ce)){let Z="[";for(const le of ce)Z+=`${w(le)},`;return`${Z}]`}let X="{";for(const Z of Object.keys(ce).sort())X+=`${Z}:${w(ce[Z])},`;return`${X}}`}function T(ce){let X="";for(const Z of s.refProperties)X+=`/${w(ce[Z])}`;return X}class A{constructor(X){this.keyCache={},X&&this.replace(X)}replace(X){this._layerConfigs={},this._layers={},this.update(X,[])}update(X,Z){for(const me of X)this._layerConfigs[me.id]=me,(this._layers[me.id]=s.createStyleLayer(me)).compileFilter(),this.keyCache[me.id]&&delete this.keyCache[me.id];for(const me of Z)delete this.keyCache[me],delete this._layerConfigs[me],delete this._layers[me];this.familiesBySource={};const le=function(me,Ee){const Pe={};for(let be=0;be<me.length;be++){const Ue=Ee&&Ee[me[be].id]||T(me[be]);Ee&&(Ee[me[be].id]=Ue);let ct=Pe[Ue];ct||(ct=Pe[Ue]=[]),ct.push(me[be])}const Ae=[];for(const be in Pe)Ae.push(Pe[be]);return Ae}(s.values(this._layerConfigs),this.keyCache);for(const me of le){const Ee=me.map(ft=>this._layers[ft.id]),Pe=Ee[0];if(Pe.visibility==="none")continue;const Ae=Pe.source||"";let be=this.familiesBySource[Ae];be||(be=this.familiesBySource[Ae]={});const Ue=Pe.sourceLayer||"_geojsonTileLayer";let ct=be[Ue];ct||(ct=be[Ue]=[]),ct.push(Ee)}}}class D{loadTile(X,Z){const{uid:le,encoding:me,rawImageData:Ee,padding:Pe,buildQuadTree:Ae}=X,be=s.window.ImageBitmap&&Ee instanceof s.window.ImageBitmap?this.getImageData(Ee,Pe):Ee;Z(null,new s.DEMData(le,be,me,Pe<1,Ae))}getImageData(X,Z){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(X.width,X.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=X.width,this.offscreenCanvas.height=X.height,this.offscreenCanvasContext.drawImage(X,0,0,X.width,X.height);const le=this.offscreenCanvasContext.getImageData(-Z,-Z,X.width+2*Z,X.height+2*Z);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),le}}function R(ce,X){if(ce.length!==0){G(ce[0],X);for(var Z=1;Z<ce.length;Z++)G(ce[Z],!X)}}function G(ce,X){for(var Z=0,le=0,me=0,Ee=ce.length,Pe=Ee-1;me<Ee;Pe=me++){var Ae=(ce[me][0]-ce[Pe][0])*(ce[Pe][1]+ce[me][1]),be=Z+Ae;le+=Math.abs(Z)>=Math.abs(Ae)?Z-be+Ae:Ae-be+Z,Z=be}Z+le>=0!=!!X&&ce.reverse()}var $=s.getDefaultExportFromCjs(function ce(X,Z){var le,me=X&&X.type;if(me==="FeatureCollection")for(le=0;le<X.features.length;le++)ce(X.features[le],Z);else if(me==="GeometryCollection")for(le=0;le<X.geometries.length;le++)ce(X.geometries[le],Z);else if(me==="Feature")ce(X.geometry,Z);else if(me==="Polygon")R(X.coordinates,Z);else if(me==="MultiPolygon")for(le=0;le<X.coordinates.length;le++)R(X.coordinates[le],Z);return X});const ie=s.VectorTileFeature.prototype.toGeoJSON;var _e={exports:{}},Y=s.pointGeometry,B=s.vectorTile.VectorTileFeature,q=oe;function oe(ce,X){this.options=X||{},this.features=ce,this.length=ce.length}function de(ce,X){this.id=typeof ce.id=="number"?ce.id:void 0,this.type=ce.type,this.rawGeometry=ce.type===1?[ce.geometry]:ce.geometry,this.properties=ce.tags,this.extent=X||4096}oe.prototype.feature=function(ce){return new de(this.features[ce],this.options.extent)},de.prototype.loadGeometry=function(){var ce=this.rawGeometry;this.geometry=[];for(var X=0;X<ce.length;X++){for(var Z=ce[X],le=[],me=0;me<Z.length;me++)le.push(new Y(Z[me][0],Z[me][1]));this.geometry.push(le)}return this.geometry},de.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var ce=this.geometry,X=1/0,Z=-1/0,le=1/0,me=-1/0,Ee=0;Ee<ce.length;Ee++)for(var Pe=ce[Ee],Ae=0;Ae<Pe.length;Ae++){var be=Pe[Ae];X=Math.min(X,be.x),Z=Math.max(Z,be.x),le=Math.min(le,be.y),me=Math.max(me,be.y)}return[X,le,Z,me]},de.prototype.toGeoJSON=B.prototype.toGeoJSON;var we=s.pbf,Se=q;function Te(ce){var X=new we;return function(Z,le){for(var me in Z.layers)le.writeMessage(3,xe,Z.layers[me])}(ce,X),X.finish()}function xe(ce,X){var Z;X.writeVarintField(15,ce.version||1),X.writeStringField(1,ce.name||""),X.writeVarintField(5,ce.extent||4096);var le={keys:[],values:[],keycache:{},valuecache:{}};for(Z=0;Z<ce.length;Z++)le.feature=ce.feature(Z),X.writeMessage(2,et,le);var me=le.keys;for(Z=0;Z<me.length;Z++)X.writeStringField(3,me[Z]);var Ee=le.values;for(Z=0;Z<Ee.length;Z++)X.writeMessage(4,Pt,Ee[Z])}function et(ce,X){var Z=ce.feature;Z.id!==void 0&&X.writeVarintField(1,Z.id),X.writeMessage(2,We,ce),X.writeVarintField(3,Z.type),X.writeMessage(4,ze,Z)}function We(ce,X){var Z=ce.feature,le=ce.keys,me=ce.values,Ee=ce.keycache,Pe=ce.valuecache;for(var Ae in Z.properties){var be=Z.properties[Ae],Ue=Ee[Ae];if(be!==null){Ue===void 0&&(le.push(Ae),Ee[Ae]=Ue=le.length-1),X.writeVarint(Ue);var ct=typeof be;ct!=="string"&&ct!=="boolean"&&ct!=="number"&&(be=JSON.stringify(be));var ft=ct+":"+be,at=Pe[ft];at===void 0&&(me.push(be),Pe[ft]=at=me.length-1),X.writeVarint(at)}}}function He(ce,X){return(X<<3)+(7&ce)}function $e(ce){return ce<<1^ce>>31}function ze(ce,X){for(var Z=ce.loadGeometry(),le=ce.type,me=0,Ee=0,Pe=Z.length,Ae=0;Ae<Pe;Ae++){var be=Z[Ae],Ue=1;le===1&&(Ue=be.length),X.writeVarint(He(1,Ue));for(var ct=le===3?be.length-1:be.length,ft=0;ft<ct;ft++){ft===1&&le!==1&&X.writeVarint(He(2,ct-1));var at=be[ft].x-me,Wt=be[ft].y-Ee;X.writeVarint($e(at)),X.writeVarint($e(Wt)),me+=at,Ee+=Wt}le===3&&X.writeVarint(He(7,1))}}function Pt(ce,X){var Z=typeof ce;Z==="string"?X.writeStringField(1,ce):Z==="boolean"?X.writeBooleanField(7,ce):Z==="number"&&(ce%1!=0?X.writeDoubleField(3,ce):ce<0?X.writeSVarintField(6,ce):X.writeVarintField(5,ce))}_e.exports=Te,_e.exports.fromVectorTileJs=Te,_e.exports.fromGeojsonVt=function(ce,X){X=X||{};var Z={};for(var le in ce)Z[le]=new Se(ce[le].features,X),Z[le].name=le,Z[le].version=X.version,Z[le].extent=X.extent;return Te({layers:Z})},_e.exports.GeoJSONWrapper=Se;var Bt=s.getDefaultExportFromCjs(_e.exports);const Zt={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ce=>ce},qe=Math.fround||(Et=new Float32Array(1),ce=>(Et[0]=+ce,Et[0]));var Et;const Ct=3,kt=5,Vt=6;class hn{constructor(X){this.options=Object.assign(Object.create(Zt),X),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(X){const{log:Z,minZoom:le,maxZoom:me}=this.options;Z&&console.time("total time");const Ee=`prepare ${X.length} points`;Z&&console.time(Ee),this.points=X;const Pe=[];for(let be=0;be<X.length;be++){const Ue=X[be];if(!Ue.geometry)continue;const[ct,ft]=Ue.geometry.coordinates,at=qe(Gr(ct)),Wt=qe(Kr(ft));Pe.push(at,Wt,1/0,be,-1,1),this.options.reduce&&Pe.push(0)}let Ae=this.trees[me+1]=this._createTree(Pe);Z&&console.timeEnd(Ee);for(let be=me;be>=le;be--){const Ue=+Date.now();Ae=this.trees[be]=this._createTree(this._cluster(Ae,be)),Z&&console.log("z%d: %d clusters in %dms",be,Ae.numItems,+Date.now()-Ue)}return Z&&console.timeEnd("total time"),this}getClusters(X,Z){let le=((X[0]+180)%360+360)%360-180;const me=Math.max(-90,Math.min(90,X[1]));let Ee=X[2]===180?180:((X[2]+180)%360+360)%360-180;const Pe=Math.max(-90,Math.min(90,X[3]));if(X[2]-X[0]>=360)le=-180,Ee=180;else if(le>Ee){const ft=this.getClusters([le,me,180,Pe],Z),at=this.getClusters([-180,me,Ee,Pe],Z);return ft.concat(at)}const Ae=this.trees[this._limitZoom(Z)],be=Ae.range(Gr(le),Kr(Pe),Gr(Ee),Kr(me)),Ue=Ae.data,ct=[];for(const ft of be){const at=this.stride*ft;ct.push(Ue[at+kt]>1?tr(Ue,at,this.clusterProps):this.points[Ue[at+Ct]])}return ct}getChildren(X){const Z=this._getOriginId(X),le=this._getOriginZoom(X),me="No cluster with the specified id.",Ee=this.trees[le];if(!Ee)throw new Error(me);const Pe=Ee.data;if(Z*this.stride>=Pe.length)throw new Error(me);const Ae=this.options.radius/(this.options.extent*Math.pow(2,le-1)),be=Ee.within(Pe[Z*this.stride],Pe[Z*this.stride+1],Ae),Ue=[];for(const ct of be){const ft=ct*this.stride;Pe[ft+4]===X&&Ue.push(Pe[ft+kt]>1?tr(Pe,ft,this.clusterProps):this.points[Pe[ft+Ct]])}if(Ue.length===0)throw new Error(me);return Ue}getLeaves(X,Z,le){const me=[];return this._appendLeaves(me,X,Z=Z||10,le=le||0,0),me}getTile(X,Z,le){const me=this.trees[this._limitZoom(X)],Ee=Math.pow(2,X),{extent:Pe,radius:Ae}=this.options,be=Ae/Pe,Ue=(le-be)/Ee,ct=(le+1+be)/Ee,ft={features:[]};return this._addTileFeatures(me.range((Z-be)/Ee,Ue,(Z+1+be)/Ee,ct),me.data,Z,le,Ee,ft),Z===0&&this._addTileFeatures(me.range(1-be/Ee,Ue,1,ct),me.data,Ee,le,Ee,ft),Z===Ee-1&&this._addTileFeatures(me.range(0,Ue,be/Ee,ct),me.data,-1,le,Ee,ft),ft.features.length?ft:null}getClusterExpansionZoom(X){let Z=this._getOriginZoom(X)-1;for(;Z<=this.options.maxZoom;){const le=this.getChildren(X);if(Z++,le.length!==1)break;X=le[0].properties.cluster_id}return Z}_appendLeaves(X,Z,le,me,Ee){const Pe=this.getChildren(Z);for(const Ae of Pe){const be=Ae.properties;if(be&&be.cluster?Ee+be.point_count<=me?Ee+=be.point_count:Ee=this._appendLeaves(X,be.cluster_id,le,me,Ee):Ee<me?Ee++:X.push(Ae),X.length===le)break}return Ee}_createTree(X){const Z=new s.KDBush(X.length/this.stride|0,this.options.nodeSize,Float32Array);for(let le=0;le<X.length;le+=this.stride)Z.add(X[le],X[le+1]);return Z.finish(),Z.data=X,Z}_addTileFeatures(X,Z,le,me,Ee,Pe){for(const Ae of X){const be=Ae*this.stride,Ue=Z[be+kt]>1;let ct,ft,at;if(Ue)ct=Wn(Z,be,this.clusterProps),ft=Z[be],at=Z[be+1];else{const Ht=this.points[Z[be+Ct]];ct=Ht.properties;const[tn,fn]=Ht.geometry.coordinates;ft=Gr(tn),at=Kr(fn)}const Wt={type:1,geometry:[[Math.round(this.options.extent*(ft*Ee-le)),Math.round(this.options.extent*(at*Ee-me))]],tags:ct};let en;en=Ue||this.options.generateId?Z[be+Ct]:this.points[Z[be+Ct]].id,en!==void 0&&(Wt.id=en),Pe.features.push(Wt)}}_limitZoom(X){return Math.max(this.options.minZoom,Math.min(Math.floor(+X),this.options.maxZoom+1))}_cluster(X,Z){const{radius:le,extent:me,reduce:Ee,minPoints:Pe}=this.options,Ae=le/(me*Math.pow(2,Z)),be=X.data,Ue=[],ct=this.stride;for(let ft=0;ft<be.length;ft+=ct){if(be[ft+2]<=Z)continue;be[ft+2]=Z;const at=be[ft],Wt=be[ft+1],en=X.within(be[ft],be[ft+1],Ae),Ht=be[ft+kt];let tn=Ht;for(const fn of en){const rr=fn*ct;be[rr+2]>Z&&(tn+=be[rr+kt])}if(tn>Ht&&tn>=Pe){let fn,rr=at*Ht,Cr=Wt*Ht,wi=-1;const qr=((ft/ct|0)<<5)+(Z+1)+this.points.length;for(const Ls of en){const Jr=Ls*ct;if(be[Jr+2]<=Z)continue;be[Jr+2]=Z;const zi=be[Jr+kt];rr+=be[Jr]*zi,Cr+=be[Jr+1]*zi,be[Jr+4]=qr,Ee&&(fn||(fn=this._map(be,ft,!0),wi=this.clusterProps.length,this.clusterProps.push(fn)),Ee(fn,this._map(be,Jr)))}be[ft+4]=qr,Ue.push(rr/tn,Cr/tn,1/0,qr,-1,tn),Ee&&Ue.push(wi)}else{for(let fn=0;fn<ct;fn++)Ue.push(be[ft+fn]);if(tn>1)for(const fn of en){const rr=fn*ct;if(!(be[rr+2]<=Z)){be[rr+2]=Z;for(let Cr=0;Cr<ct;Cr++)Ue.push(be[rr+Cr])}}}}return Ue}_getOriginId(X){return X-this.points.length>>5}_getOriginZoom(X){return(X-this.points.length)%32}_map(X,Z,le){if(X[Z+kt]>1){const Pe=this.clusterProps[X[Z+Vt]];return le?Object.assign({},Pe):Pe}const me=this.points[X[Z+Ct]].properties,Ee=this.options.map(me);return le&&Ee===me?Object.assign({},Ee):Ee}}function tr(ce,X,Z){return{type:"Feature",id:ce[X+Ct],properties:Wn(ce,X,Z),geometry:{type:"Point",coordinates:[(le=ce[X],360*(le-.5)),ol(ce[X+1])]}};var le}function Wn(ce,X,Z){const le=ce[X+kt],me=le>=1e4?`${Math.round(le/1e3)}k`:le>=1e3?Math.round(le/100)/10+"k":le,Ee=ce[X+Vt],Pe=Ee===-1?{}:Object.assign({},Z[Ee]);return Object.assign(Pe,{cluster:!0,cluster_id:ce[X+Ct],point_count:le,point_count_abbreviated:me})}function Gr(ce){return ce/360+.5}function Kr(ce){const X=Math.sin(ce*Math.PI/180),Z=.5-.25*Math.log((1+X)/(1-X))/Math.PI;return Z<0?0:Z>1?1:Z}function ol(ce){const X=(180-360*ce)*Math.PI/180;return 360*Math.atan(Math.exp(X))/Math.PI-90}function rs(ce,X,Z,le){for(var me,Ee=le,Pe=Z-X>>1,Ae=Z-X,be=ce[X],Ue=ce[X+1],ct=ce[Z],ft=ce[Z+1],at=X+3;at<Z;at+=3){var Wt=fa(ce[at],ce[at+1],be,Ue,ct,ft);if(Wt>Ee)me=at,Ee=Wt;else if(Wt===Ee){var en=Math.abs(at-Pe);en<Ae&&(me=at,Ae=en)}}Ee>le&&(me-X>3&&rs(ce,X,me,le),ce[me+2]=Ee,Z-me>3&&rs(ce,me,Z,le))}function fa(ce,X,Z,le,me,Ee){var Pe=me-Z,Ae=Ee-le;if(Pe!==0||Ae!==0){var be=((ce-Z)*Pe+(X-le)*Ae)/(Pe*Pe+Ae*Ae);be>1?(Z=me,le=Ee):be>0&&(Z+=Pe*be,le+=Ae*be)}return(Pe=ce-Z)*Pe+(Ae=X-le)*Ae}function rn(ce,X,Z,le){var me={id:ce===void 0?null:ce,type:X,geometry:Z,tags:le,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Ee){var Pe=Ee.geometry,Ae=Ee.type;if(Ae==="Point"||Ae==="MultiPoint"||Ae==="LineString")Ou(Ee,Pe);else if(Ae==="Polygon"||Ae==="MultiLineString")for(var be=0;be<Pe.length;be++)Ou(Ee,Pe[be]);else if(Ae==="MultiPolygon")for(be=0;be<Pe.length;be++)for(var Ue=0;Ue<Pe[be].length;Ue++)Ou(Ee,Pe[be][Ue])}(me),me}function Ou(ce,X){for(var Z=0;Z<X.length;Z+=3)ce.minX=Math.min(ce.minX,X[Z]),ce.minY=Math.min(ce.minY,X[Z+1]),ce.maxX=Math.max(ce.maxX,X[Z]),ce.maxY=Math.max(ce.maxY,X[Z+1])}function fo(ce,X,Z,le){if(X.geometry){var me=X.geometry.coordinates,Ee=X.geometry.type,Pe=Math.pow(Z.tolerance/((1<<Z.maxZoom)*Z.extent),2),Ae=[],be=X.id;if(Z.promoteId?be=X.properties[Z.promoteId]:Z.generateId&&(be=le||0),Ee==="Point")Jc(me,Ae);else if(Ee==="MultiPoint")for(var Ue=0;Ue<me.length;Ue++)Jc(me[Ue],Ae);else if(Ee==="LineString")nr(me,Ae,Pe,!1);else if(Ee==="MultiLineString"){if(Z.lineMetrics){for(Ue=0;Ue<me.length;Ue++)nr(me[Ue],Ae=[],Pe,!1),ce.push(rn(be,"LineString",Ae,X.properties));return}Po(me,Ae,Pe,!1)}else if(Ee==="Polygon")Po(me,Ae,Pe,!0);else{if(Ee!=="MultiPolygon"){if(Ee==="GeometryCollection"){for(Ue=0;Ue<X.geometry.geometries.length;Ue++)fo(ce,{id:be,geometry:X.geometry.geometries[Ue],properties:X.properties},Z,le);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Ue=0;Ue<me.length;Ue++){var ct=[];Po(me[Ue],ct,Pe,!0),Ae.push(ct)}}ce.push(rn(be,Ee,Ae,X.properties))}}function Jc(ce,X){X.push(Pf(ce[0])),X.push(pa(ce[1])),X.push(0)}function nr(ce,X,Z,le){for(var me,Ee,Pe=0,Ae=0;Ae<ce.length;Ae++){var be=Pf(ce[Ae][0]),Ue=pa(ce[Ae][1]);X.push(be),X.push(Ue),X.push(0),Ae>0&&(Pe+=le?(me*Ue-be*Ee)/2:Math.sqrt(Math.pow(be-me,2)+Math.pow(Ue-Ee,2))),me=be,Ee=Ue}var ct=X.length-3;X[2]=1,rs(X,0,ct,Z),X[ct+2]=1,X.size=Math.abs(Pe),X.start=0,X.end=X.size}function Po(ce,X,Z,le){for(var me=0;me<ce.length;me++){var Ee=[];nr(ce[me],Ee,Z,le),X.push(Ee)}}function Pf(ce){return ce/360+.5}function pa(ce){var X=Math.sin(ce*Math.PI/180),Z=.5-.25*Math.log((1+X)/(1-X))/Math.PI;return Z<0?0:Z>1?1:Z}function po(ce,X,Z,le,me,Ee,Pe,Ae){if(le/=X,Ee>=(Z/=X)&&Pe<le)return ce;if(Pe<Z||Ee>=le)return null;for(var be=[],Ue=0;Ue<ce.length;Ue++){var ct=ce[Ue],ft=ct.geometry,at=ct.type,Wt=me===0?ct.minX:ct.minY,en=me===0?ct.maxX:ct.maxY;if(Wt>=Z&&en<le)be.push(ct);else if(!(en<Z||Wt>=le)){var Ht=[];if(at==="Point"||at==="MultiPoint")Qc(ft,Ht,Z,le,me);else if(at==="LineString")zu(ft,Ht,Z,le,me,!1,Ae.lineMetrics);else if(at==="MultiLineString")sl(ft,Ht,Z,le,me,!1);else if(at==="Polygon")sl(ft,Ht,Z,le,me,!0);else if(at==="MultiPolygon")for(var tn=0;tn<ft.length;tn++){var fn=[];sl(ft[tn],fn,Z,le,me,!0),fn.length&&Ht.push(fn)}if(Ht.length){if(Ae.lineMetrics&&at==="LineString"){for(tn=0;tn<Ht.length;tn++)be.push(rn(ct.id,at,Ht[tn],ct.tags));continue}at!=="LineString"&&at!=="MultiLineString"||(Ht.length===1?(at="LineString",Ht=Ht[0]):at="MultiLineString"),at!=="Point"&&at!=="MultiPoint"||(at=Ht.length===3?"Point":"MultiPoint"),be.push(rn(ct.id,at,Ht,ct.tags))}}}return be.length?be:null}function Qc(ce,X,Z,le,me){for(var Ee=0;Ee<ce.length;Ee+=3){var Pe=ce[Ee+me];Pe>=Z&&Pe<=le&&(X.push(ce[Ee]),X.push(ce[Ee+1]),X.push(ce[Ee+2]))}}function zu(ce,X,Z,le,me,Ee,Pe){for(var Ae,be,Ue=eh(ce),ct=me===0?Lf:Df,ft=ce.start,at=0;at<ce.length-3;at+=3){var Wt=ce[at],en=ce[at+1],Ht=ce[at+2],tn=ce[at+3],fn=ce[at+4],rr=me===0?Wt:en,Cr=me===0?tn:fn,wi=!1;Pe&&(Ae=Math.sqrt(Math.pow(Wt-tn,2)+Math.pow(en-fn,2))),rr<Z?Cr>Z&&(be=ct(Ue,Wt,en,tn,fn,Z),Pe&&(Ue.start=ft+Ae*be)):rr>le?Cr<le&&(be=ct(Ue,Wt,en,tn,fn,le),Pe&&(Ue.start=ft+Ae*be)):Fu(Ue,Wt,en,Ht),Cr<Z&&rr>=Z&&(be=ct(Ue,Wt,en,tn,fn,Z),wi=!0),Cr>le&&rr<=le&&(be=ct(Ue,Wt,en,tn,fn,le),wi=!0),!Ee&&wi&&(Pe&&(Ue.end=ft+Ae*be),X.push(Ue),Ue=eh(ce)),Pe&&(ft+=Ae)}var qr=ce.length-3;Wt=ce[qr],en=ce[qr+1],Ht=ce[qr+2],(rr=me===0?Wt:en)>=Z&&rr<=le&&Fu(Ue,Wt,en,Ht),qr=Ue.length-3,Ee&&qr>=3&&(Ue[qr]!==Ue[0]||Ue[qr+1]!==Ue[1])&&Fu(Ue,Ue[0],Ue[1],Ue[2]),Ue.length&&X.push(Ue)}function eh(ce){var X=[];return X.size=ce.size,X.start=ce.start,X.end=ce.end,X}function sl(ce,X,Z,le,me,Ee){for(var Pe=0;Pe<ce.length;Pe++)zu(ce[Pe],X,Z,le,me,Ee,!1)}function Fu(ce,X,Z,le){ce.push(X),ce.push(Z),ce.push(le)}function Lf(ce,X,Z,le,me,Ee){var Pe=(Ee-X)/(le-X);return ce.push(Ee),ce.push(Z+(me-Z)*Pe),ce.push(1),Pe}function Df(ce,X,Z,le,me,Ee){var Pe=(Ee-Z)/(me-Z);return ce.push(X+(le-X)*Pe),ce.push(Ee),ce.push(1),Pe}function Lo(ce,X){for(var Z=[],le=0;le<ce.length;le++){var me,Ee=ce[le],Pe=Ee.type;if(Pe==="Point"||Pe==="MultiPoint"||Pe==="LineString")me=al(Ee.geometry,X);else if(Pe==="MultiLineString"||Pe==="Polygon"){me=[];for(var Ae=0;Ae<Ee.geometry.length;Ae++)me.push(al(Ee.geometry[Ae],X))}else if(Pe==="MultiPolygon")for(me=[],Ae=0;Ae<Ee.geometry.length;Ae++){for(var be=[],Ue=0;Ue<Ee.geometry[Ae].length;Ue++)be.push(al(Ee.geometry[Ae][Ue],X));me.push(be)}Z.push(rn(Ee.id,Pe,me,Ee.tags))}return Z}function al(ce,X){var Z=[];Z.size=ce.size,ce.start!==void 0&&(Z.start=ce.start,Z.end=ce.end);for(var le=0;le<ce.length;le+=3)Z.push(ce[le]+X,ce[le+1],ce[le+2]);return Z}function th(ce,X){if(ce.transformed)return ce;var Z,le,me,Ee=1<<ce.z,Pe=ce.x,Ae=ce.y;for(Z=0;Z<ce.features.length;Z++){var be=ce.features[Z],Ue=be.geometry,ct=be.type;if(be.geometry=[],ct===1)for(le=0;le<Ue.length;le+=2)be.geometry.push(Gl(Ue[le],Ue[le+1],X,Ee,Pe,Ae));else for(le=0;le<Ue.length;le++){var ft=[];for(me=0;me<Ue[le].length;me+=2)ft.push(Gl(Ue[le][me],Ue[le][me+1],X,Ee,Pe,Ae));be.geometry.push(ft)}}return ce.transformed=!0,ce}function Gl(ce,X,Z,le,me,Ee){return[Math.round(Z*(ce*le-me)),Math.round(Z*(X*le-Ee))]}function Bu(ce,X,Z,le,me){for(var Ee=X===me.maxZoom?0:me.tolerance/((1<<X)*me.extent),Pe={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:Z,y:le,z:X,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Ae=0;Ae<ce.length;Ae++){Pe.numFeatures++,nh(Pe,ce[Ae],Ee,me);var be=ce[Ae].minX,Ue=ce[Ae].minY,ct=ce[Ae].maxX,ft=ce[Ae].maxY;be<Pe.minX&&(Pe.minX=be),Ue<Pe.minY&&(Pe.minY=Ue),ct>Pe.maxX&&(Pe.maxX=ct),ft>Pe.maxY&&(Pe.maxY=ft)}return Pe}function nh(ce,X,Z,le){var me=X.geometry,Ee=X.type,Pe=[];if(Ee==="Point"||Ee==="MultiPoint")for(var Ae=0;Ae<me.length;Ae+=3)Pe.push(me[Ae]),Pe.push(me[Ae+1]),ce.numPoints++,ce.numSimplified++;else if(Ee==="LineString")ql(Pe,me,ce,Z,!1,!1);else if(Ee==="MultiLineString"||Ee==="Polygon")for(Ae=0;Ae<me.length;Ae++)ql(Pe,me[Ae],ce,Z,Ee==="Polygon",Ae===0);else if(Ee==="MultiPolygon")for(var be=0;be<me.length;be++){var Ue=me[be];for(Ae=0;Ae<Ue.length;Ae++)ql(Pe,Ue[Ae],ce,Z,!0,Ae===0)}if(Pe.length){var ct=X.tags||null;if(Ee==="LineString"&&le.lineMetrics){for(var ft in ct={},X.tags)ct[ft]=X.tags[ft];ct.mapbox_clip_start=me.start/me.size,ct.mapbox_clip_end=me.end/me.size}var at={geometry:Pe,type:Ee==="Polygon"||Ee==="MultiPolygon"?3:Ee==="LineString"||Ee==="MultiLineString"?2:1,tags:ct};X.id!==null&&(at.id=X.id),ce.features.push(at)}}function ql(ce,X,Z,le,me,Ee){var Pe=le*le;if(le>0&&X.size<(me?Pe:le))Z.numPoints+=X.length/3;else{for(var Ae=[],be=0;be<X.length;be+=3)(le===0||X[be+2]>Pe)&&(Z.numSimplified++,Ae.push(X[be]),Ae.push(X[be+1])),Z.numPoints++;me&&function(Ue,ct){for(var ft=0,at=0,Wt=Ue.length,en=Wt-2;at<Wt;en=at,at+=2)ft+=(Ue[at]-Ue[en])*(Ue[at+1]+Ue[en+1]);if(ft>0===ct)for(at=0,Wt=Ue.length;at<Wt/2;at+=2){var Ht=Ue[at],tn=Ue[at+1];Ue[at]=Ue[Wt-2-at],Ue[at+1]=Ue[Wt-1-at],Ue[Wt-2-at]=Ht,Ue[Wt-1-at]=tn}}(Ae,Ee),ce.push(Ae)}}function ll(ce,X){var Z=(X=this.options=function(me,Ee){for(var Pe in Ee)me[Pe]=Ee[Pe];return me}(Object.create(this.options),X)).debug;if(Z&&console.time("preprocess data"),X.maxZoom<0||X.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(X.promoteId&&X.generateId)throw new Error("promoteId and generateId cannot be used together.");var le=function(me,Ee){var Pe=[];if(me.type==="FeatureCollection")for(var Ae=0;Ae<me.features.length;Ae++)fo(Pe,me.features[Ae],Ee,Ae);else fo(Pe,me.type==="Feature"?me:{geometry:me},Ee);return Pe}(ce,X);this.tiles={},this.tileCoords=[],Z&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",X.indexMaxZoom,X.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),le=function(me,Ee){var Pe=Ee.buffer/Ee.extent,Ae=me,be=po(me,1,-1-Pe,Pe,0,-1,2,Ee),Ue=po(me,1,1-Pe,2+Pe,0,-1,2,Ee);return(be||Ue)&&(Ae=po(me,1,-Pe,1+Pe,0,-1,2,Ee)||[],be&&(Ae=Lo(be,1).concat(Ae)),Ue&&(Ae=Ae.concat(Lo(Ue,-1)))),Ae}(le,X),le.length&&this.splitTile(le,0,0,0),Z&&(le.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Xl(ce,X,Z){return 32*((1<<ce)*Z+X)+ce}function $l(ce,X){const Z=ce.tileID.canonical;if(!this._geoJSONIndex)return X(null,null);const le=this._geoJSONIndex.getTile(Z.z,Z.x,Z.y);if(!le)return X(null,null);const me=new class{constructor(Pe){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=s.EXTENT,this.length=Pe.length,this._features=Pe}feature(Pe){return new class{constructor(Ae){this._feature=Ae,this.extent=s.EXTENT,this.type=Ae.type,this.properties=Ae.tags,"id"in Ae&&!isNaN(Ae.id)&&(this.id=parseInt(Ae.id,10))}loadGeometry(){if(this._feature.type===1){const Ae=[];for(const be of this._feature.geometry)Ae.push([new s.Point(be[0],be[1])]);return Ae}{const Ae=[];for(const be of this._feature.geometry){const Ue=[];for(const ct of be)Ue.push(new s.Point(ct[0],ct[1]));Ae.push(Ue)}return Ae}}toGeoJSON(Ae,be,Ue){return ie.call(this,Ae,be,Ue)}}(this._features[Pe])}}(le.features);let Ee=Bt(me);Ee.byteOffset===0&&Ee.byteLength===Ee.buffer.byteLength||(Ee=new Uint8Array(Ee)),X(null,{vectorTile:me,rawData:Ee.buffer})}ll.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},ll.prototype.splitTile=function(ce,X,Z,le,me,Ee,Pe){for(var Ae=[ce,X,Z,le],be=this.options,Ue=be.debug;Ae.length;){le=Ae.pop(),Z=Ae.pop(),X=Ae.pop(),ce=Ae.pop();var ct=1<<X,ft=Xl(X,Z,le),at=this.tiles[ft];if(!at&&(Ue>1&&console.time("creation"),at=this.tiles[ft]=Bu(ce,X,Z,le,be),this.tileCoords.push({z:X,x:Z,y:le}),Ue)){Ue>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",X,Z,le,at.numFeatures,at.numPoints,at.numSimplified),console.timeEnd("creation"));var Wt="z"+X;this.stats[Wt]=(this.stats[Wt]||0)+1,this.total++}if(at.source=ce,me){if(X===be.maxZoom||X===me)continue;var en=1<<me-X;if(Z!==Math.floor(Ee/en)||le!==Math.floor(Pe/en))continue}else if(X===be.indexMaxZoom||at.numPoints<=be.indexMaxPoints)continue;if(at.source=null,ce.length!==0){Ue>1&&console.time("clipping");var Ht,tn,fn,rr,Cr,wi,qr=.5*be.buffer/be.extent,Ls=.5-qr,Jr=.5+qr,zi=1+qr;Ht=tn=fn=rr=null,Cr=po(ce,ct,Z-qr,Z+Jr,0,at.minX,at.maxX,be),wi=po(ce,ct,Z+Ls,Z+zi,0,at.minX,at.maxX,be),ce=null,Cr&&(Ht=po(Cr,ct,le-qr,le+Jr,1,at.minY,at.maxY,be),tn=po(Cr,ct,le+Ls,le+zi,1,at.minY,at.maxY,be),Cr=null),wi&&(fn=po(wi,ct,le-qr,le+Jr,1,at.minY,at.maxY,be),rr=po(wi,ct,le+Ls,le+zi,1,at.minY,at.maxY,be),wi=null),Ue>1&&console.timeEnd("clipping"),Ae.push(Ht||[],X+1,2*Z,2*le),Ae.push(tn||[],X+1,2*Z,2*le+1),Ae.push(fn||[],X+1,2*Z+1,2*le),Ae.push(rr||[],X+1,2*Z+1,2*le+1)}}},ll.prototype.getTile=function(ce,X,Z){var le=this.options,me=le.extent,Ee=le.debug;if(ce<0||ce>24)return null;var Pe=1<<ce,Ae=Xl(ce,X=(X%Pe+Pe)%Pe,Z);if(this.tiles[Ae])return th(this.tiles[Ae],me);Ee>1&&console.log("drilling down to z%d-%d-%d",ce,X,Z);for(var be,Ue=ce,ct=X,ft=Z;!be&&Ue>0;)Ue--,ct=Math.floor(ct/2),ft=Math.floor(ft/2),be=this.tiles[Xl(Ue,ct,ft)];return be&&be.source?(Ee>1&&console.log("found parent tile z%d-%d-%d",Ue,ct,ft),Ee>1&&console.time("drilling down"),this.splitTile(be.source,Ue,ct,ft,ce,X,Z),Ee>1&&console.timeEnd("drilling down"),this.tiles[Ae]?th(this.tiles[Ae],me):null):null};class Uu extends s.VectorTileWorkerSource{constructor(X,Z,le,me,Ee){super(X,Z,le,me,$l),Ee&&(this.loadGeoJSON=Ee)}loadData(X,Z){const le=X&&X.request,me=le&&le.collectResourceTiming;this.loadGeoJSON(X,(Ee,Pe)=>{if(Ee||!Pe)return Z(Ee);if(typeof Pe!="object")return Z(new Error(`Input data given to '${X.source}' is not a valid GeoJSON object.`));{$(Pe,!0);try{if(X.filter){const be=s.createExpression(X.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(be.result==="error")throw new Error(be.value.map(ct=>`${ct.key}: ${ct.message}`).join(", "));Pe={type:"FeatureCollection",features:Pe.features.filter(ct=>be.value.evaluate({zoom:0},ct))}}this._geoJSONIndex=X.cluster?new hn(function({superclusterOptions:be,clusterProperties:Ue}){if(!Ue||!be)return be;const ct={},ft={},at={accumulated:null,zoom:0},Wt={properties:null},en=Object.keys(Ue);for(const Ht of en){const[tn,fn]=Ue[Ht],rr=s.createExpression(fn),Cr=s.createExpression(typeof tn=="string"?[tn,["accumulated"],["get",Ht]]:tn);ct[Ht]=rr.value,ft[Ht]=Cr.value}return be.map=Ht=>{Wt.properties=Ht;const tn={};for(const fn of en)tn[fn]=ct[fn].evaluate(at,Wt);return tn},be.reduce=(Ht,tn)=>{Wt.properties=tn;for(const fn of en)at.accumulated=Ht[fn],Ht[fn]=ft[fn].evaluate(at,Wt)},be}(X)).load(Pe.features):function(be,Ue){return new ll(be,Ue)}(Pe,X.geojsonVtOptions)}catch(be){return Z(be)}this.loaded={};const Ae={};if(me){const be=s.getPerformanceMeasurement(le);be&&(Ae.resourceTiming={},Ae.resourceTiming[X.source]=JSON.parse(JSON.stringify(be)))}Z(null,Ae)}})}reloadTile(X,Z){const le=this.loaded;return le&&le[X.uid]?super.reloadTile(X,Z):this.loadTile(X,Z)}loadGeoJSON(X,Z){if(X.request)s.getJSON(X.request,Z);else{if(typeof X.data!="string")return Z(new Error(`Input data given to '${X.source}' is not a valid GeoJSON object.`));try{return Z(null,JSON.parse(X.data))}catch{return Z(new Error(`Input data given to '${X.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(X,Z){try{Z(null,this._geoJSONIndex.getClusterExpansionZoom(X.clusterId))}catch(le){Z(le)}}getClusterChildren(X,Z){try{Z(null,this._geoJSONIndex.getChildren(X.clusterId))}catch(le){Z(le)}}getClusterLeaves(X,Z){try{Z(null,this._geoJSONIndex.getLeaves(X.clusterId,X.limit,X.offset))}catch(le){Z(le)}}}class Rf{constructor(X){this.self=X,this.actor=new s.Actor(X,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=s.getProjection({name:"mercator"}),this.workerSourceTypes={vector:s.VectorTileWorkerSource,geojson:Uu},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(Z,le)=>{if(this.workerSourceTypes[Z])throw new Error(`Worker source with name "${Z}" already registered.`);this.workerSourceTypes[Z]=le},this.self.registerRTLTextPlugin=Z=>{if(s.plugin.isParsed())throw new Error("RTL text plugin already registered.");s.plugin.applyArabicShaping=Z.applyArabicShaping,s.plugin.processBidirectionalText=Z.processBidirectionalText,s.plugin.processStyledBidirectionalText=Z.processStyledBidirectionalText}}clearCaches(X,Z,le){delete this.layerIndexes[X],delete this.availableImages[X],delete this.workerSources[X],delete this.demWorkerSources[X],le()}checkIfReady(X,Z,le){le()}setReferrer(X,Z){this.referrer=Z}spriteLoaded(X,Z){this.isSpriteLoaded[X]=Z;for(const le in this.workerSources[X]){const me=this.workerSources[X][le];for(const Ee in me)me[Ee]instanceof s.VectorTileWorkerSource&&(me[Ee].isSpriteLoaded=Z,me[Ee].fire(new s.Event("isSpriteLoaded")))}}setImages(X,Z,le){this.availableImages[X]=Z;for(const me in this.workerSources[X]){const Ee=this.workerSources[X][me];for(const Pe in Ee)Ee[Pe].availableImages=Z}le()}enableTerrain(X,Z,le){this.terrain=Z,le()}setProjection(X,Z){this.projections[X]=s.getProjection(Z)}setLayers(X,Z,le){this.getLayerIndex(X).replace(Z),le()}updateLayers(X,Z,le){this.getLayerIndex(X).update(Z.layers,Z.removedIds),le()}loadTile(X,Z,le){const me=this.enableTerrain?s.extend({enableTerrain:this.terrain},Z):Z;me.projection=this.projections[X]||this.defaultProjection,this.getWorkerSource(X,Z.type,Z.source).loadTile(me,le)}loadDEMTile(X,Z,le){const me=this.enableTerrain?s.extend({buildQuadTree:this.terrain},Z):Z;this.getDEMWorkerSource(X,Z.source).loadTile(me,le)}reloadTile(X,Z,le){const me=this.enableTerrain?s.extend({enableTerrain:this.terrain},Z):Z;me.projection=this.projections[X]||this.defaultProjection,this.getWorkerSource(X,Z.type,Z.source).reloadTile(me,le)}abortTile(X,Z,le){this.getWorkerSource(X,Z.type,Z.source).abortTile(Z,le)}removeTile(X,Z,le){this.getWorkerSource(X,Z.type,Z.source).removeTile(Z,le)}removeSource(X,Z,le){if(!this.workerSources[X]||!this.workerSources[X][Z.type]||!this.workerSources[X][Z.type][Z.source])return;const me=this.workerSources[X][Z.type][Z.source];delete this.workerSources[X][Z.type][Z.source],me.removeSource!==void 0?me.removeSource(Z,le):le()}loadWorkerSource(X,Z,le){try{this.self.importScripts(Z.url),le()}catch(me){le(me.toString())}}syncRTLPluginState(X,Z,le){try{s.plugin.setState(Z);const me=s.plugin.getPluginURL();if(s.plugin.isLoaded()&&!s.plugin.isParsed()&&me!=null){this.self.importScripts(me);const Ee=s.plugin.isParsed();le(Ee?void 0:new Error(`RTL Text Plugin failed to import scripts from ${me}`),Ee)}}catch(me){le(me.toString())}}getAvailableImages(X){let Z=this.availableImages[X];return Z||(Z=[]),Z}getLayerIndex(X){let Z=this.layerIndexes[X];return Z||(Z=this.layerIndexes[X]=new A),Z}getWorkerSource(X,Z,le){if(this.workerSources[X]||(this.workerSources[X]={}),this.workerSources[X][Z]||(this.workerSources[X][Z]={}),!this.workerSources[X][Z][le]){const me={send:(Ee,Pe,Ae,be,Ue,ct)=>{this.actor.send(Ee,Pe,Ae,X,Ue,ct)},scheduler:this.actor.scheduler};this.workerSources[X][Z][le]=new this.workerSourceTypes[Z](me,this.getLayerIndex(X),this.getAvailableImages(X),this.isSpriteLoaded[X])}return this.workerSources[X][Z][le]}getDEMWorkerSource(X,Z){return this.demWorkerSources[X]||(this.demWorkerSources[X]={}),this.demWorkerSources[X][Z]||(this.demWorkerSources[X][Z]=new D),this.demWorkerSources[X][Z]}enforceCacheSizeLimit(X,Z){s.enforceCacheSizeLimit(Z)}getWorkerPerformanceMetrics(X,Z,le){le(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new Rf(self)),Rf}),h(["./shared"],function(s){function w(m,l){if(Array.isArray(m)){if(!Array.isArray(l)||m.length!==l.length)return!1;for(let f=0;f<m.length;f++)if(!w(m[f],l[f]))return!1;return!0}if(typeof m=="object"&&m!==null&&l!==null){if(typeof l!="object"||Object.keys(m).length!==Object.keys(l).length)return!1;for(const f in m)if(!w(m[f],l[f]))return!1;return!0}return m===l}var T=A;function A(m){return!function(l){return typeof window>"u"||typeof document>"u"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var _,v,b=new Blob([""],{type:"text/javascript"}),C=URL.createObjectURL(b);try{v=new Worker(C),_=!0}catch{_=!1}return v&&v.terminate(),URL.revokeObjectURL(C),_}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var _=document.createElement("canvas");_.width=_.height=1;var v=_.getContext("2d");if(!v)return!1;var b=v.getImageData(0,0,1,1);return b&&b.width===_.width}()?(D[f=l&&l.failIfMajorPerformanceCaveat]===void 0&&(D[f]=function(_){var v,b=function(C){var I=document.createElement("canvas"),P=Object.create(A.webGLContextAttributes);return P.failIfMajorPerformanceCaveat=C,I.getContext("webgl",P)||I.getContext("experimental-webgl",P)}(_);if(!b)return!1;try{v=b.createShader(b.VERTEX_SHADER)}catch{return!1}return!(!v||b.isContextLost())&&(b.shaderSource(v,"void main() {}"),b.compileShader(v),b.getShaderParameter(v,b.COMPILE_STATUS)===!0)}(f)),D[f]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var f}(m)}var D={};function R(m,l,f){const _=s.window.document.createElement(m);return l!==void 0&&(_.className=l),f&&f.appendChild(_),_}function G(m,l,f){const _=s.window.document.createElementNS("http://www.w3.org/2000/svg",m);for(const v of Object.keys(l))_.setAttributeNS(null,v,l[v]);return f&&f.appendChild(_),_}A.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const $=s.window.document&&s.window.document.documentElement.style,ie=$&&$.userSelect!==void 0?"userSelect":"WebkitUserSelect";let _e;function Y(){$&&ie&&(_e=$[ie],$[ie]="none")}function B(){$&&ie&&($[ie]=_e)}function q(m){m.preventDefault(),m.stopPropagation(),s.window.removeEventListener("click",q,!0)}function oe(){s.window.addEventListener("click",q,!0),s.window.setTimeout(()=>{s.window.removeEventListener("click",q,!0)},0)}function de(m,l){const f=m.getBoundingClientRect();return Te(m,f,l)}function we(m,l){const f=m.getBoundingClientRect(),_=[];for(let v=0;v<l.length;v++)_.push(Te(m,f,l[v]));return _}function Se(m){return s.window.InstallTrigger!==void 0&&m.button===2&&m.ctrlKey&&s.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:m.button}function Te(m,l,f){const _=m.offsetWidth===l.width?1:m.offsetWidth/l.width;return new s.Point((f.clientX-l.left)*_,(f.clientY-l.top)*_)}function xe(m,l){var f=l[0],_=l[1],v=l[2],b=l[3],C=f*b-v*_;return C?(m[0]=b*(C=1/C),m[1]=-_*C,m[2]=-v*C,m[3]=f*C,m):null}function et(m){const{userImage:l}=m;return!!(l&&l.render&&l.render())&&(m.data.replace(new Uint8Array(l.data.buffer)),!0)}class We extends s.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new s.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(l){if(this.loaded!==l&&(this.loaded=l,l)){for(const{ids:f,callback:_}of this.requestors)this._notify(f,_);this.requestors=[]}}hasImage(l){return!!this.getImage(l)}getImage(l){return this.images[l]}addImage(l,f){this._validate(l,f)&&(this.images[l]=f)}_validate(l,f){let _=!0;return this._validateStretch(f.stretchX,f.data&&f.data.width)||(this.fire(new s.ErrorEvent(new Error(`Image "${l}" has invalid "stretchX" value`))),_=!1),this._validateStretch(f.stretchY,f.data&&f.data.height)||(this.fire(new s.ErrorEvent(new Error(`Image "${l}" has invalid "stretchY" value`))),_=!1),this._validateContent(f.content,f)||(this.fire(new s.ErrorEvent(new Error(`Image "${l}" has invalid "content" value`))),_=!1),_}_validateStretch(l,f){if(!l)return!0;let _=0;for(const v of l){if(v[0]<_||v[1]<v[0]||f<v[1])return!1;_=v[1]}return!0}_validateContent(l,f){return!(l&&(l.length!==4||l[0]<0||f.data.width<l[0]||l[1]<0||f.data.height<l[1]||l[2]<0||f.data.width<l[2]||l[3]<0||f.data.height<l[3]||l[2]<l[0]||l[3]<l[1]))}updateImage(l,f){f.version=this.images[l].version+1,this.images[l]=f,this.updatedImages[l]=!0}removeImage(l){const f=this.images[l];delete this.images[l],delete this.patterns[l],f.userImage&&f.userImage.onRemove&&f.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(l,f){let _=!0;if(!this.isLoaded())for(const v of l)this.images[v]||(_=!1);this.isLoaded()||_?this._notify(l,f):this.requestors.push({ids:l,callback:f})}_notify(l,f){const _={};for(const v of l){this.images[v]||this.fire(new s.Event("styleimagemissing",{id:v}));const b=this.images[v];b?_[v]={data:b.data.clone(),pixelRatio:b.pixelRatio,sdf:b.sdf,version:b.version,stretchX:b.stretchX,stretchY:b.stretchY,content:b.content,hasRenderCallback:!!(b.userImage&&b.userImage.render)}:s.warnOnce(`Image "${v}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}f(null,_)}getPixelSize(){const{width:l,height:f}=this.atlasImage;return{width:l,height:f}}getPattern(l){const f=this.patterns[l],_=this.getImage(l);if(!_)return null;if(f&&f.position.version===_.version)return f.position;if(f)f.position.version=_.version;else{const v={w:_.data.width+2,h:_.data.height+2,x:0,y:0},b=new s.ImagePosition(v,_);this.patterns[l]={bin:v,position:b}}return this._updatePatternAtlas(),this.patterns[l].position}bind(l){const f=l.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new s.Texture(l,this.atlasImage,f.RGBA),this.atlasTexture&&this.atlasTexture.bind(f.LINEAR,f.CLAMP_TO_EDGE)}_updatePatternAtlas(){const l=[];for(const b in this.patterns)l.push(this.patterns[b].bin);const{w:f,h:_}=s.potpack(l),v=this.atlasImage;v.resize({width:f||1,height:_||1});for(const b in this.patterns){const{bin:C}=this.patterns[b],I=C.x+1,P=C.y+1,O=this.images[b].data,k=O.width,U=O.height;s.RGBAImage.copy(O,v,{x:0,y:0},{x:I,y:P},{width:k,height:U}),s.RGBAImage.copy(O,v,{x:0,y:U-1},{x:I,y:P-1},{width:k,height:1}),s.RGBAImage.copy(O,v,{x:0,y:0},{x:I,y:P+U},{width:k,height:1}),s.RGBAImage.copy(O,v,{x:k-1,y:0},{x:I-1,y:P},{width:1,height:U}),s.RGBAImage.copy(O,v,{x:0,y:0},{x:I+k,y:P},{width:1,height:U})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(l){for(const f of l){if(this.callbackDispatchedThisFrame[f])continue;this.callbackDispatchedThisFrame[f]=!0;const _=this.images[f];et(_)&&this.updateImage(f,_)}}}const He=new s.Properties({anchor:new s.DataConstantProperty(s.spec.light.anchor),position:new class{constructor(){this.specification=s.spec.light.position}possiblyEvaluate(m,l){return function([f,_,v]){const b=s.degToRad(_+90),C=s.degToRad(v);return{x:f*Math.cos(b)*Math.sin(C),y:f*Math.sin(b)*Math.sin(C),z:f*Math.cos(C),azimuthal:_,polar:v}}(m.expression.evaluate(l))}interpolate(m,l,f){return{x:s.number(m.x,l.x,f),y:s.number(m.y,l.y,f),z:s.number(m.z,l.z,f),azimuthal:s.number(m.azimuthal,l.azimuthal,f),polar:s.number(m.polar,l.polar,f)}}},color:new s.DataConstantProperty(s.spec.light.color),intensity:new s.DataConstantProperty(s.spec.light.intensity)});class $e extends s.Evented{constructor(l){super(),this._transitionable=new s.Transitionable(He),this.setLight(l),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(l,f={}){if(!this._validate(s.validateLight,l,f))for(const _ in l){const v=l[_];s.endsWith(_,"-transition")?this._transitionable.setTransition(_.slice(0,-11),v):this._transitionable.setValue(_,v)}}updateTransitions(l){this._transitioning=this._transitionable.transitioned(l,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(l){this.properties=this._transitioning.possiblyEvaluate(l)}_validate(l,f,_){return(!_||_.validate!==!1)&&s.emitValidationErrors(this,l.call(s.validateStyle,s.extend({value:f,style:{glyphs:!0,sprite:!0},styleSpec:s.spec})))}}const ze=new s.Properties({source:new s.DataConstantProperty(s.spec.terrain.source),exaggeration:new s.DataConstantProperty(s.spec.terrain.exaggeration)});let Pt=class extends s.Evented{constructor(m,l){super(),this._transitionable=new s.Transitionable(ze),this.set(m),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=l}get(){return this._transitionable.serialize()}set(m){for(const l in m){const f=m[l];s.endsWith(l,"-transition")?this._transitionable.setTransition(l.slice(0,-11),f):this._transitionable.setValue(l,f)}}updateTransitions(m){this._transitioning=this._transitionable.transitioned(m,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(m){this.properties=this._transitioning.possiblyEvaluate(m)}};function Bt(m,l,f,_){const v=s.smoothstep(45,65,f),[b,C]=Zt(m,_),I=s.length(l);let P=1-Math.min(1,Math.exp((I-b)/(C-b)*-6));return P*=P*P,P=Math.min(1,1.00747*P),P*v*m.alpha}function Zt(m,l){const f=.5/Math.tan(.5*l);return[m.range[0]+f,m.range[1]+f]}const qe=new s.Properties({range:new s.DataConstantProperty(s.spec.fog.range),color:new s.DataConstantProperty(s.spec.fog.color),"high-color":new s.DataConstantProperty(s.spec.fog["high-color"]),"space-color":new s.DataConstantProperty(s.spec.fog["space-color"]),"horizon-blend":new s.DataConstantProperty(s.spec.fog["horizon-blend"]),"star-intensity":new s.DataConstantProperty(s.spec.fog["star-intensity"])});class Et extends s.Evented{constructor(l,f){super(),this._transitionable=new s.Transitionable(qe),this.set(l),this._transitioning=this._transitionable.untransitioned(),this._transform=f}get state(){const l=this._transform,f=l.projection.name==="globe",_=s.globeToMercatorTransition(l.zoom),v=this.properties.get("range"),b=[.5,3];return{range:f?[s.number(b[0],v[0],_),s.number(b[1],v[1],_)]:v,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(l,f={}){if(!this._validate(s.validateFog,l,f)){for(const _ of Object.keys(s.spec.fog))l&&l[_]===void 0&&(l[_]=s.spec.fog[_].default);for(const _ in l){const v=l[_];s.endsWith(_,"-transition")?this._transitionable.setTransition(_.slice(0,-11),v):this._transitionable.setValue(_,v)}}}getOpacity(l){if(!this._transform.projection.supportsFog)return 0;const f=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:s.smoothstep(45,65,l))*f.a}getOpacityAtLatLng(l,f){return this._transform.projection.supportsFog?function(_,v,b){const C=s.MercatorCoordinate.fromLngLat(v),I=b.elevation?b.elevation.getAtPointOrZero(C):0,P=[C.x,C.y,I];return s.transformMat4(P,P,b.mercatorFogMatrix),Bt(_,P,b.pitch,b._fov)}(this.state,l,f):0}getFovAdjustedRange(l){return this._transform.projection.supportsFog?Zt(this.state,l):[0,1]}updateTransitions(l){this._transitioning=this._transitionable.transitioned(l,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(l){this.properties=this._transitioning.possiblyEvaluate(l)}_validate(l,f,_){return(!_||_.validate!==!1)&&s.emitValidationErrors(this,l.call(s.validateStyle,s.extend({value:f,style:{glyphs:!0,sprite:!0},styleSpec:s.spec})))}}class Ct{constructor(l,f){this.workerPool=l,this.actors=[],this.currentActor=0,this.id=s.uniqueId();const _=this.workerPool.acquire(this.id);for(let v=0;v<_.length;v++){const b=new Ct.Actor(_[v],f,this.id);b.name=`Worker ${v}`,this.actors.push(b)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(l,f,_){s.asyncAll(this.actors,(v,b)=>{v.send(l,f,b)},_=_||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(l=>{l.remove()}),this.actors=[],this.workerPool.release(this.id)}}function kt(m,l,f){return l*(s.EXTENT/(m.tileSize*Math.pow(2,f-m.tileID.overscaledZ)))}Ct.Actor=s.Actor;class Vt{constructor(l,f,_,v){this.screenBounds=l,this.cameraPoint=f,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=_,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,v)}static createFromScreenPoints(l,f){let _,v;if(l instanceof s.Point||typeof l[0]=="number"){const b=s.Point.convert(l);_=[b],v=f.isPointAboveHorizon(b)}else{const b=s.Point.convert(l[0]),C=s.Point.convert(l[1]);_=[b,C],v=s.polygonizeBounds(b,C).every(I=>f.isPointAboveHorizon(I))}return new Vt(_,f.getCameraPoint(),v,f)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(l){return s.polygonizeBounds(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],l)}bufferedCameraGeometry(l){const f=this.screenBounds[0],_=this.screenBounds.length===1?this.screenBounds[0].add(new s.Point(1,1)):this.screenBounds[1],v=s.polygonizeBounds(f,_,0,!1);return this.cameraPoint.y>_.y&&(this.cameraPoint.x>f.x&&this.cameraPoint.x<_.x?v.splice(3,0,this.cameraPoint):this.cameraPoint.x>=_.x?v[2]=this.cameraPoint:this.cameraPoint.x<=f.x&&(v[3]=this.cameraPoint)),s.bufferConvexPolygon(v,l)}bufferedCameraGeometryGlobe(l){const f=this.screenBounds[0],_=this.screenBounds.length===1?this.screenBounds[0].add(new s.Point(1,1)):this.screenBounds[1],v=s.polygonizeBounds(f,_,l),b=this.cameraPoint.clone();switch(3*((b.y>f.y)+(b.y>_.y))+((b.x>f.x)+(b.x>_.x))){case 0:v[0]=b,v[4]=b.clone();break;case 1:v.splice(1,0,b);break;case 2:v[1]=b;break;case 3:v.splice(4,0,b);break;case 5:v.splice(2,0,b);break;case 6:v[3]=b;break;case 7:v.splice(3,0,b);break;case 8:v[2]=b}return v}containsTile(l,f,_,v=0){const b=l.queryPadding/f._pixelsPerMercatorPixel+1,C=_?this._bufferedCameraMercator(b,f):this._bufferedScreenMercator(b,f);let I=l.tileID.wrap+(C.unwrapped?v:0);const P=C.polygon.map(te=>s.getTilePoint(l.tileTransform,te,I));if(!s.polygonIntersectsBox(P,0,0,s.EXTENT,s.EXTENT))return;I=l.tileID.wrap+(this.screenGeometryMercator.unwrapped?v:0);const O=this.screenGeometryMercator.polygon.map(te=>s.getTileVec3(l.tileTransform,te,I)),k=O.map(te=>new s.Point(te[0],te[1])),U=f.getFreeCameraOptions().position||new s.MercatorCoordinate(0,0,0),W=s.getTileVec3(l.tileTransform,U,I),J=O.map(te=>{const V=s.sub(te,te,W);return s.normalize(V,V),new s.Ray(W,V)}),ee=kt(l,1,f.zoom)*f._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:k,tilespaceRays:J,bufferedTilespaceGeometry:P,bufferedTilespaceBounds:(Q=s.getBounds(P),Q.min.x=s.clamp(Q.min.x,0,s.EXTENT),Q.min.y=s.clamp(Q.min.y,0,s.EXTENT),Q.max.x=s.clamp(Q.max.x,0,s.EXTENT),Q.max.y=s.clamp(Q.max.y,0,s.EXTENT),Q),tile:l,tileID:l.tileID,pixelToTileUnitsFactor:ee};var Q}_bufferedScreenMercator(l,f){const _=Wn(l);if(this._screenRaycastCache[_])return this._screenRaycastCache[_];{let v;return v=f.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(l),f):{polygon:this.bufferedScreenGeometry(l).map(b=>f.pointCoordinate3D(b)),unwrapped:!0},this._screenRaycastCache[_]=v,v}}_bufferedCameraMercator(l,f){const _=Wn(l);if(this._cameraRaycastCache[_])return this._cameraRaycastCache[_];{let v;return v=f.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(l),f):{polygon:this.bufferedCameraGeometry(l).map(b=>f.pointCoordinate3D(b)),unwrapped:!0},this._cameraRaycastCache[_]=v,v}}_projectAndResample(l,f){const _=function(b,C){const I=s.multiply([],C.pixelMatrix,C.globeMatrix),P=[0,-s.GLOBE_RADIUS,0,1],O=[0,s.GLOBE_RADIUS,0,1],k=[0,0,0,1];s.transformMat4$1(P,P,I),s.transformMat4$1(O,O,I),s.transformMat4$1(k,k,I);const U=new s.Point(P[0]/P[3],P[1]/P[3]),W=new s.Point(O[0]/O[3],O[1]/O[3]),J=s.polygonContainsPoint(b,U)&&P[3]<k[3],ee=s.polygonContainsPoint(b,W)&&O[3]<k[3];if(!J&&!ee)return null;const Q=function(ye,Ie,Ce){for(let Ne=1;Ne<ye.length;Ne++){const rt=tr(Ie.pointCoordinate3D(ye[Ne-1]).x),Le=tr(Ie.pointCoordinate3D(ye[Ne]).x);if(Ce<0){if(rt<Le)return{idx:Ne,t:-rt/(Le-1-rt)}}else if(Le<rt)return{idx:Ne,t:(1-rt)/(Le+1-rt)}}return null}(b,C,J?-1:1);if(!Q)return null;const{idx:te,t:V}=Q;let K=te>1?hn(b.slice(0,te),C):[],se=te<b.length?hn(b.slice(te),C):[];K=K.map(ye=>new s.Point(tr(ye.x),ye.y)),se=se.map(ye=>new s.Point(tr(ye.x),ye.y));const ae=[...K];ae.length===0&&ae.push(se[se.length-1]);const ge=s.number(ae[ae.length-1].y,(se.length===0?K[0]:se[0]).y,V);let ve;return ve=J?[new s.Point(0,ge),new s.Point(0,0),new s.Point(1,0),new s.Point(1,ge)]:[new s.Point(1,ge),new s.Point(1,1),new s.Point(0,1),new s.Point(0,ge)],ae.push(...ve),se.length===0?ae.push(K[0]):ae.push(...se),{polygon:ae.map(ye=>new s.MercatorCoordinate(ye.x,ye.y)),unwrapped:!1}}(l,f);if(_)return _;const v=function(b,C){let I=!1,P=-1/0,O=0;for(let U=0;U<b.length-1;U++)b[U].x>P&&(P=b[U].x,O=U);for(let U=0;U<b.length-1;U++){const W=(O+U)%(b.length-1),J=b[W],ee=b[W+1];Math.abs(J.x-ee.x)>.5&&(J.x<ee.x?(J.x+=1,W===0&&(b[b.length-1].x+=1)):(ee.x+=1,W+1===b.length-1&&(b[0].x+=1)),I=!0)}const k=s.mercatorXfromLng(C.center.lng);return I&&k<Math.abs(k-1)&&b.forEach(U=>{U.x-=1}),{polygon:b,unwrapped:I}}(hn(l,f).map(b=>new s.Point(tr(b.x),b.y)),f);return{polygon:v.polygon.map(b=>new s.MercatorCoordinate(b.x,b.y)),unwrapped:v.unwrapped}}}function hn(m,l){return s.resample(m,f=>{const _=l.pointCoordinate3D(f);f.x=_.x,f.y=_.y},1/256)}function tr(m){return m<0?1+m%1:m%1}function Wn(m){return 100*m|0}function Gr(m,l,f,_,v){const b=function(C,I){if(C)return v(C);if(I){m.url&&I.tiles&&m.tiles&&delete m.tiles;const P=s.pick(s.extend(I,m),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);I.vector_layers&&(P.vectorLayers=I.vector_layers,P.vectorLayerIds=P.vectorLayers.map(O=>O.id)),P.tiles=l.canonicalizeTileset(P,m.url),v(null,P)}};return m.url?s.getJSON(l.transformRequest(l.normalizeSourceURL(m.url,null,f,_),s.ResourceType.Source),b):s.exported.frame(()=>b(null,m))}class Kr{constructor(l,f,_){this.bounds=s.LngLatBounds.convert(this.validateBounds(l)),this.minzoom=f||0,this.maxzoom=_||24}validateBounds(l){return Array.isArray(l)&&l.length===4?[Math.max(-180,l[0]),Math.max(-90,l[1]),Math.min(180,l[2]),Math.min(90,l[3])]:[-180,-90,180,90]}contains(l){const f=Math.pow(2,l.z),_=Math.floor(s.mercatorXfromLng(this.bounds.getWest())*f),v=Math.floor(s.mercatorYfromLat(this.bounds.getNorth())*f),b=Math.ceil(s.mercatorXfromLng(this.bounds.getEast())*f),C=Math.ceil(s.mercatorYfromLat(this.bounds.getSouth())*f);return l.x>=_&&l.x<b&&l.y>=v&&l.y<C}}class ol{constructor(l,f,_){this.context=l;const v=l.gl;this.buffer=v.createBuffer(),this.dynamicDraw=!!_,this.context.unbindVAO(),l.bindElementBuffer.set(this.buffer),v.bufferData(v.ELEMENT_ARRAY_BUFFER,f.arrayBuffer,this.dynamicDraw?v.DYNAMIC_DRAW:v.STATIC_DRAW),this.dynamicDraw||f.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(l){const f=this.context.gl;this.context.unbindVAO(),this.bind(),f.bufferSubData(f.ELEMENT_ARRAY_BUFFER,0,l.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const rs={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class fa{constructor(l,f,_,v){this.length=f.length,this.attributes=_,this.itemSize=f.bytesPerElement,this.dynamicDraw=v,this.context=l;const b=l.gl;this.buffer=b.createBuffer(),l.bindVertexBuffer.set(this.buffer),b.bufferData(b.ARRAY_BUFFER,f.arrayBuffer,this.dynamicDraw?b.DYNAMIC_DRAW:b.STATIC_DRAW),this.dynamicDraw||f.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(l){const f=this.context.gl;this.bind(),f.bufferSubData(f.ARRAY_BUFFER,0,l.arrayBuffer)}enableAttributes(l,f){for(let _=0;_<this.attributes.length;_++){const v=f.attributes[this.attributes[_].name];v!==void 0&&l.enableVertexAttribArray(v)}}setVertexAttribPointers(l,f,_){for(let v=0;v<this.attributes.length;v++){const b=this.attributes[v],C=f.attributes[b.name];C!==void 0&&l.vertexAttribPointer(C,b.components,l[rs[b.type]],!1,this.itemSize,b.offset+this.itemSize*(_||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class rn{constructor(l){this.gl=l.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(l){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Ou extends rn{getDefault(){return s.Color.transparent}set(l){const f=this.current;(l.r!==f.r||l.g!==f.g||l.b!==f.b||l.a!==f.a||this.dirty)&&(this.gl.clearColor(l.r,l.g,l.b,l.a),this.current=l,this.dirty=!1)}}class fo extends rn{getDefault(){return 1}set(l){(l!==this.current||this.dirty)&&(this.gl.clearDepth(l),this.current=l,this.dirty=!1)}}class Jc extends rn{getDefault(){return 0}set(l){(l!==this.current||this.dirty)&&(this.gl.clearStencil(l),this.current=l,this.dirty=!1)}}class nr extends rn{getDefault(){return[!0,!0,!0,!0]}set(l){const f=this.current;(l[0]!==f[0]||l[1]!==f[1]||l[2]!==f[2]||l[3]!==f[3]||this.dirty)&&(this.gl.colorMask(l[0],l[1],l[2],l[3]),this.current=l,this.dirty=!1)}}class Po extends rn{getDefault(){return!0}set(l){(l!==this.current||this.dirty)&&(this.gl.depthMask(l),this.current=l,this.dirty=!1)}}class Pf extends rn{getDefault(){return 255}set(l){(l!==this.current||this.dirty)&&(this.gl.stencilMask(l),this.current=l,this.dirty=!1)}}class pa extends rn{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(l){const f=this.current;(l.func!==f.func||l.ref!==f.ref||l.mask!==f.mask||this.dirty)&&(this.gl.stencilFunc(l.func,l.ref,l.mask),this.current=l,this.dirty=!1)}}class po extends rn{getDefault(){const l=this.gl;return[l.KEEP,l.KEEP,l.KEEP]}set(l){const f=this.current;(l[0]!==f[0]||l[1]!==f[1]||l[2]!==f[2]||this.dirty)&&(this.gl.stencilOp(l[0],l[1],l[2]),this.current=l,this.dirty=!1)}}class Qc extends rn{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const f=this.gl;l?f.enable(f.STENCIL_TEST):f.disable(f.STENCIL_TEST),this.current=l,this.dirty=!1}}class zu extends rn{getDefault(){return[0,1]}set(l){const f=this.current;(l[0]!==f[0]||l[1]!==f[1]||this.dirty)&&(this.gl.depthRange(l[0],l[1]),this.current=l,this.dirty=!1)}}class eh extends rn{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const f=this.gl;l?f.enable(f.DEPTH_TEST):f.disable(f.DEPTH_TEST),this.current=l,this.dirty=!1}}class sl extends rn{getDefault(){return this.gl.LESS}set(l){(l!==this.current||this.dirty)&&(this.gl.depthFunc(l),this.current=l,this.dirty=!1)}}class Fu extends rn{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const f=this.gl;l?f.enable(f.BLEND):f.disable(f.BLEND),this.current=l,this.dirty=!1}}class Lf extends rn{getDefault(){const l=this.gl;return[l.ONE,l.ZERO]}set(l){const f=this.current;(l[0]!==f[0]||l[1]!==f[1]||this.dirty)&&(this.gl.blendFunc(l[0],l[1]),this.current=l,this.dirty=!1)}}class Df extends rn{getDefault(){return s.Color.transparent}set(l){const f=this.current;(l.r!==f.r||l.g!==f.g||l.b!==f.b||l.a!==f.a||this.dirty)&&(this.gl.blendColor(l.r,l.g,l.b,l.a),this.current=l,this.dirty=!1)}}class Lo extends rn{getDefault(){return this.gl.FUNC_ADD}set(l){(l!==this.current||this.dirty)&&(this.gl.blendEquation(l),this.current=l,this.dirty=!1)}}class al extends rn{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const f=this.gl;l?f.enable(f.CULL_FACE):f.disable(f.CULL_FACE),this.current=l,this.dirty=!1}}class th extends rn{getDefault(){return this.gl.BACK}set(l){(l!==this.current||this.dirty)&&(this.gl.cullFace(l),this.current=l,this.dirty=!1)}}class Gl extends rn{getDefault(){return this.gl.CCW}set(l){(l!==this.current||this.dirty)&&(this.gl.frontFace(l),this.current=l,this.dirty=!1)}}let Bu,nh=class extends rn{getDefault(){return null}set(m){(m!==this.current||this.dirty)&&(this.gl.useProgram(m),this.current=m,this.dirty=!1)}};class ql extends rn{getDefault(){return this.gl.TEXTURE0}set(l){(l!==this.current||this.dirty)&&(this.gl.activeTexture(l),this.current=l,this.dirty=!1)}}class ll extends rn{getDefault(){const l=this.gl;return[0,0,l.drawingBufferWidth,l.drawingBufferHeight]}set(l){const f=this.current;(l[0]!==f[0]||l[1]!==f[1]||l[2]!==f[2]||l[3]!==f[3]||this.dirty)&&(this.gl.viewport(l[0],l[1],l[2],l[3]),this.current=l,this.dirty=!1)}}class Xl extends rn{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const f=this.gl;f.bindFramebuffer(f.FRAMEBUFFER,l),this.current=l,this.dirty=!1}}class $l extends rn{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const f=this.gl;f.bindRenderbuffer(f.RENDERBUFFER,l),this.current=l,this.dirty=!1}}class Uu extends rn{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const f=this.gl;f.bindTexture(f.TEXTURE_2D,l),this.current=l,this.dirty=!1}}class Rf extends rn{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const f=this.gl;f.bindBuffer(f.ARRAY_BUFFER,l),this.current=l,this.dirty=!1}}class ce extends rn{getDefault(){return null}set(l){const f=this.gl;f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,l),this.current=l,this.dirty=!1}}class X extends rn{constructor(l){super(l),this.vao=l.extVertexArrayObject}getDefault(){return null}set(l){this.vao&&(l!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(l),this.current=l,this.dirty=!1)}}class Z extends rn{getDefault(){return 4}set(l){if(l===this.current&&!this.dirty)return;const f=this.gl;f.pixelStorei(f.UNPACK_ALIGNMENT,l),this.current=l,this.dirty=!1}}class le extends rn{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const f=this.gl;f.pixelStorei(f.UNPACK_PREMULTIPLY_ALPHA_WEBGL,l),this.current=l,this.dirty=!1}}class me extends rn{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const f=this.gl;f.pixelStorei(f.UNPACK_FLIP_Y_WEBGL,l),this.current=l,this.dirty=!1}}class Ee extends rn{constructor(l,f){super(l),this.context=l,this.parent=f}getDefault(){return null}}class Pe extends Ee{setDirty(){this.dirty=!0}set(l){if(l===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const f=this.gl;f.framebufferTexture2D(f.FRAMEBUFFER,f.COLOR_ATTACHMENT0,f.TEXTURE_2D,l,0),this.current=l,this.dirty=!1}}class Ae extends Ee{attachment(){return this.gl.DEPTH_ATTACHMENT}set(l){if(l===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const f=this.gl;f.framebufferRenderbuffer(f.FRAMEBUFFER,this.attachment(),f.RENDERBUFFER,l),this.current=l,this.dirty=!1}}class be extends Ae{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class Ue{constructor(l,f,_,v){this.context=l,this.width=f,this.height=_;const b=this.framebuffer=l.gl.createFramebuffer();this.colorAttachment=new Pe(l,b),v&&(this.depthAttachment=new Ae(l,b))}destroy(){const l=this.context.gl,f=this.colorAttachment.get();if(f&&l.deleteTexture(f),this.depthAttachment){const _=this.depthAttachment.get();_&&l.deleteRenderbuffer(_)}l.deleteFramebuffer(this.framebuffer)}}class ct{constructor(l,f=!1){if(this.gl=l,this.isWebGL2=f,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),f){const _=l;this.extVertexArrayObject={createVertexArrayOES:_.createVertexArray.bind(l),deleteVertexArrayOES:_.deleteVertexArray.bind(l),bindVertexArrayOES:_.bindVertexArray.bind(l)}}this.clearColor=new Ou(this),this.clearDepth=new fo(this),this.clearStencil=new Jc(this),this.colorMask=new nr(this),this.depthMask=new Po(this),this.stencilMask=new Pf(this),this.stencilFunc=new pa(this),this.stencilOp=new po(this),this.stencilTest=new Qc(this),this.depthRange=new zu(this),this.depthTest=new eh(this),this.depthFunc=new sl(this),this.blend=new Fu(this),this.blendFunc=new Lf(this),this.blendColor=new Df(this),this.blendEquation=new Lo(this),this.cullFace=new al(this),this.cullFaceSide=new th(this),this.frontFace=new Gl(this),this.program=new nh(this),this.activeTexture=new ql(this),this.viewport=new ll(this),this.bindFramebuffer=new Xl(this),this.bindRenderbuffer=new $l(this),this.bindTexture=new Uu(this),this.bindVertexBuffer=new Rf(this),this.bindElementBuffer=new ce(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new X(this),this.pixelStoreUnpack=new Z(this),this.pixelStoreUnpackPremultiplyAlpha=new le(this),this.pixelStoreUnpackFlipY=new me(this),this.extTextureFilterAnisotropic=l.getExtension("EXT_texture_filter_anisotropic")||l.getExtension("MOZ_EXT_texture_filter_anisotropic")||l.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=l.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extDebugRendererInfo=l.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=l.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=l.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),f||(this.extTextureHalfFloat=l.getExtension("OES_texture_half_float")),(f||this.extTextureHalfFloat&&l.getExtension("OES_texture_half_float_linear"))&&(this.extRenderToTextureHalfFloat=l.getExtension("EXT_color_buffer_half_float")),this.extStandardDerivatives=f||l.getExtension("OES_standard_derivatives"),this.extTimerQuery=l.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=l.getParameter(l.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(l,f){return new ol(this,l,f)}createVertexBuffer(l,f,_){return new fa(this,l,f,_)}createRenderbuffer(l,f,_){const v=this.gl,b=v.createRenderbuffer();return this.bindRenderbuffer.set(b),v.renderbufferStorage(v.RENDERBUFFER,l,f,_),this.bindRenderbuffer.set(null),b}createFramebuffer(l,f,_){return new Ue(this,l,f,_)}clear({color:l,depth:f,stencil:_}){const v=this.gl;let b=0;l&&(b|=v.COLOR_BUFFER_BIT,this.clearColor.set(l),this.colorMask.set([!0,!0,!0,!0])),f!==void 0&&(b|=v.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(f),this.depthMask.set(!0)),_!==void 0&&(b|=v.STENCIL_BUFFER_BIT,this.clearStencil.set(_),this.stencilMask.set(255)),v.clear(b)}setCullFace(l){l.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(l.mode),this.frontFace.set(l.frontFace))}setDepthMode(l){l.func!==this.gl.ALWAYS||l.mask?(this.depthTest.set(!0),this.depthFunc.set(l.func),this.depthMask.set(l.mask),this.depthRange.set(l.range)):this.depthTest.set(!1)}setStencilMode(l){l.test.func!==this.gl.ALWAYS||l.mask?(this.stencilTest.set(!0),this.stencilMask.set(l.mask),this.stencilOp.set([l.fail,l.depthFail,l.pass]),this.stencilFunc.set({func:l.test.func,ref:l.ref,mask:l.test.mask})):this.stencilTest.set(!1)}setColorMode(l){w(l.blendFunction,s.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(l.blendFunction),this.blendColor.set(l.blendColor)),this.colorMask.set(l.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class ft extends s.Evented{constructor(l,f,_,v){if(super(),this.id=l,this.dispatcher=_,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,s.extend(this,s.pick(f,["url","scheme","tileSize","promoteId"])),this._options=s.extend({type:"vector"},f),this._collectResourceTiming=f.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(v),this._tileWorkers={},this._deduped=new s.DedupedRequest}load(l){this._loaded=!1,this.fire(new s.Event("dataloading",{dataType:"source"}));const f=Array.isArray(this.map._language)?this.map._language.join():this.map._language,_=this.map._worldview;this._tileJSONRequest=Gr(this._options,this.map._requestManager,f,_,(v,b)=>{this._tileJSONRequest=null,this._loaded=!0,v?(f&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${f}`),_&&_.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${_}`),this.fire(new s.ErrorEvent(v))):b&&(s.extend(this,b),b.bounds&&(this.tileBounds=new Kr(b.bounds,this.minzoom,this.maxzoom)),s.postTurnstileEvent(b.tiles,this.map._requestManager._customAccessToken),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"content"}))),l&&l(v)})}loaded(){return this._loaded}hasTile(l){return!this.tileBounds||this.tileBounds.contains(l.canonical)}onAdd(l){this.map=l,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(l){return this._options.tiles=l,this.reload(),this}setUrl(l){return this.url=l,this._options.url=l,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return s.extend({},this._options)}loadTile(l,f){const _=this.map._requestManager.normalizeTileURL(l.tileID.canonical.url(this.tiles,this.scheme)),v={request:this.map._requestManager.transformRequest(_,s.ResourceType.Tile),data:void 0,uid:l.uid,tileID:l.tileID,tileZoom:l.tileZoom,zoom:l.tileID.overscaledZ,tileSize:this.tileSize*l.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:s.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:l.isSymbolTile};if(v.request.collectResourceTiming=this._collectResourceTiming,l.actor&&l.state!=="expired")l.state==="loading"?l.reloadCallback=f:l.request=l.actor.send("reloadTile",v,b.bind(this));else if(l.actor=this._tileWorkers[_]=this._tileWorkers[_]||this.dispatcher.getActor(),this.dispatcher.ready)l.request=l.actor.send("loadTile",v,b.bind(this),void 0,!0);else{const C=s.loadVectorTile.call({deduped:this._deduped},v,(I,P)=>{I||!P?b.call(this,I):(v.data={cacheControl:P.cacheControl,expires:P.expires,rawData:P.rawData.slice(0)},l.actor&&l.actor.send("loadTile",v,b.bind(this),void 0,!0))},!0);l.request={cancel:C}}function b(C,I){return delete l.request,l.aborted?f(null):C&&C.status!==404?f(C):(I&&I.resourceTiming&&(l.resourceTiming=I.resourceTiming),this.map._refreshExpiredTiles&&I&&l.setExpiryData(I),l.loadVectorData(I,this.map.painter),s.cacheEntryPossiblyAdded(this.dispatcher),f(null),void(l.reloadCallback&&(this.loadTile(l,l.reloadCallback),l.reloadCallback=null)))}}abortTile(l){l.request&&(l.request.cancel(),delete l.request),l.actor&&l.actor.send("abortTile",{uid:l.uid,type:this.type,source:this.id})}unloadTile(l){l.unloadVectorData(),l.actor&&l.actor.send("removeTile",{uid:l.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class at extends s.Evented{constructor(l,f,_,v){super(),this.id=l,this.dispatcher=_,this.setEventedParent(v),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=s.extend({type:"raster"},f),s.extend(this,s.pick(f,["url","scheme","tileSize"]))}load(l){this._loaded=!1,this.fire(new s.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Gr(this._options,this.map._requestManager,null,null,(f,_)=>{this._tileJSONRequest=null,this._loaded=!0,f?this.fire(new s.ErrorEvent(f)):_&&(s.extend(this,_),_.bounds&&(this.tileBounds=new Kr(_.bounds,this.minzoom,this.maxzoom)),s.postTurnstileEvent(_.tiles),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"content"}))),l&&l(f)})}loaded(){return this._loaded}onAdd(l){this.map=l,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(l){return this._options.tiles=l,this.reload(),this}setUrl(l){return this.url=l,this._options.url=l,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return s.extend({},this._options)}hasTile(l){return!this.tileBounds||this.tileBounds.contains(l.canonical)}loadTile(l,f){const _=s.exported.devicePixelRatio>=2,v=this.map._requestManager.normalizeTileURL(l.tileID.canonical.url(this.tiles,this.scheme),_,this.tileSize);l.request=s.getImage(this.map._requestManager.transformRequest(v,s.ResourceType.Tile),(b,C,I,P)=>(delete l.request,l.aborted?(l.state="unloaded",f(null)):b?(l.state="errored",f(b)):C?(this.map._refreshExpiredTiles&&l.setExpiryData({cacheControl:I,expires:P}),l.setTexture(C,this.map.painter),l.state="loaded",s.cacheEntryPossiblyAdded(this.dispatcher),void f(null)):f(null)))}static loadTileData(l,f,_){l.setTexture(f,_)}static unloadTileData(l,f){l.texture&&f.saveTileTexture(l.texture)}abortTile(l,f){l.request&&(l.request.cancel(),delete l.request),f()}unloadTile(l,f){l.texture&&this.map.painter.saveTileTexture(l.texture),f()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function Wt(m,l,f,_,v,b,C,I){const P=[m,f,v,l,_,b,1,1,1],O=[C,I,1],k=s.adjoint([],P),[U,W,J]=s.transformMat3(O,O,s.transpose(k,k));return s.multiply$1(P,[U,0,0,0,W,0,0,0,J],P)}class en extends s.Evented{constructor(l,f,_,v){super(),this.id=l,this.dispatcher=_,this.coordinates=f.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(v),this.options=f,this._dirty=!1}load(l,f){this._loaded=f||!1,this.fire(new s.Event("dataloading",{dataType:"source"})),this.url=this.options.url,this._imageRequest=s.getImage(this.map._requestManager.transformRequest(this.url,s.ResourceType.Image),(_,v)=>{if(this._imageRequest=null,this._loaded=!0,_)this.fire(new s.ErrorEvent(_));else if(v){const{HTMLImageElement:b}=s.window;this.image=v instanceof b?s.exported.getImageData(v):v,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,l&&(this.coordinates=l),this._finishLoading()}})}loaded(){return this._loaded}updateImage(l){return this.image&&l.url?(this._imageRequest&&l.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=l.url,this.load(l.coordinates,this._loaded),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(l){this.map=l,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),this.texture&&this.texture.destroy()}setCoordinates(l){this.coordinates=l,this._boundsArray=void 0;const f=l.map(s.MercatorCoordinate.fromLngLat);return this.tileID=function(_){let v=1/0,b=1/0,C=-1/0,I=-1/0;for(const U of _)v=Math.min(v,U.x),b=Math.min(b,U.y),C=Math.max(C,U.x),I=Math.max(I,U.y);const P=Math.max(C-v,I-b),O=Math.max(0,Math.floor(-Math.log(P)/Math.LN2)),k=Math.pow(2,O);return new s.CanonicalTileID(O,Math.floor((v+C)/2*k),Math.floor((b+I)/2*k))}(f),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new s.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(l){for(const P in this.tiles){const O=this.tiles[P];O.state!=="loaded"&&(O.state="loaded",O.texture=this.texture)}if(this._boundsArray)return;const f=s.tileTransform(this.tileID,this.map.transform.projection),[_,v,b,C]=this.coordinates.map(P=>{const O=f.projection.project(P[0],P[1]);return s.getTilePoint(f,O)._round()});this.perspectiveTransform=function(P,O,k,U,W,J,ee,Q,te,V){const K=Wt(0,0,P,0,0,O,P,O),se=Wt(k,U,W,J,ee,Q,te,V);return s.multiply$1(se,s.adjoint(K,K),se),[se[6]/se[8]*P/s.EXTENT,se[7]/se[8]*O/s.EXTENT]}(this.width,this.height,_.x,_.y,v.x,v.y,C.x,C.y,b.x,b.y);const I=this._boundsArray=new s.StructArrayLayout4i8;I.emplaceBack(_.x,_.y,0,0),I.emplaceBack(v.x,v.y,s.EXTENT,0),I.emplaceBack(C.x,C.y,0,s.EXTENT),I.emplaceBack(b.x,b.y,s.EXTENT,s.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=l.createVertexBuffer(I,s.boundsAttributes.members),this.boundsSegments=s.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const l=this.map.painter.context,f=l.gl;this._dirty&&(this.texture?this.texture.update(this.image):(this.texture=new s.Texture(l,this.image,f.RGBA),this.texture.bind(f.LINEAR,f.CLAMP_TO_EDGE)),this._dirty=!1),this._prepareData(l)}loadTile(l,f){this.tileID&&this.tileID.equals(l.tileID.canonical)?(this.tiles[String(l.tileID.wrap)]=l,l.buckets={},f(null)):(l.state="errored",f(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const Ht={vector:ft,raster:at,"raster-dem":class extends at{constructor(m,l,f,_){super(m,l,f,_),this.type="raster-dem",this.maxzoom=22,this._options=s.extend({type:"raster-dem"},l),this.encoding=l.encoding||"mapbox"}loadTile(m,l){const f=this.map._requestManager.normalizeTileURL(m.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function _(v,b){v&&(m.state="errored",l(v)),b&&(m.dem=b,m.dem.onDeserialize(),m.needsHillshadePrepare=!0,m.needsDEMTextureUpload=!0,m.state="loaded",l(null))}m.request=s.getImage(this.map._requestManager.transformRequest(f,s.ResourceType.Tile),(function(v,b,C,I){if(delete m.request,m.aborted)m.state="unloaded",l(null);else if(v)m.state="errored",l(v);else if(b){this.map._refreshExpiredTiles&&m.setExpiryData({cacheControl:C,expires:I});const P=s.window.ImageBitmap&&b instanceof s.window.ImageBitmap&&(Bu==null&&(Bu=s.window.OffscreenCanvas&&new s.window.OffscreenCanvas(1,1).getContext("2d")&&typeof s.window.createImageBitmap=="function"),Bu),O=1-(b.width-s.prevPowerOfTwo(b.width))/2;O<1||m.neighboringTiles||(m.neighboringTiles=this._getNeighboringTiles(m.tileID));const k=P?b:s.exported.getImageData(b,O),U={uid:m.uid,coord:m.tileID,source:this.id,rawImageData:k,encoding:this.encoding,padding:O};m.actor&&m.state!=="expired"||(m.actor=this.dispatcher.getActor(),m.actor.send("loadDEMTile",U,_.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(m){const l=m.canonical,f=Math.pow(2,l.z),_=(l.x-1+f)%f,v=l.x===0?m.wrap-1:m.wrap,b=(l.x+1+f)%f,C=l.x+1===f?m.wrap+1:m.wrap,I={};return I[new s.OverscaledTileID(m.overscaledZ,v,l.z,_,l.y).key]={backfilled:!1},I[new s.OverscaledTileID(m.overscaledZ,C,l.z,b,l.y).key]={backfilled:!1},l.y>0&&(I[new s.OverscaledTileID(m.overscaledZ,v,l.z,_,l.y-1).key]={backfilled:!1},I[new s.OverscaledTileID(m.overscaledZ,m.wrap,l.z,l.x,l.y-1).key]={backfilled:!1},I[new s.OverscaledTileID(m.overscaledZ,C,l.z,b,l.y-1).key]={backfilled:!1}),l.y+1<f&&(I[new s.OverscaledTileID(m.overscaledZ,v,l.z,_,l.y+1).key]={backfilled:!1},I[new s.OverscaledTileID(m.overscaledZ,m.wrap,l.z,l.x,l.y+1).key]={backfilled:!1},I[new s.OverscaledTileID(m.overscaledZ,C,l.z,b,l.y+1).key]={backfilled:!1}),I}unloadTile(m){m.demTexture&&this.map.painter.saveTileTexture(m.demTexture),m.fbo&&(m.fbo.destroy(),delete m.fbo),m.dem&&delete m.dem,delete m.neighboringTiles,m.state="unloaded"}},geojson:class extends s.Evented{constructor(m,l,f,_){super(),this.id=m,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=f.getActor(),this.setEventedParent(_),this._data=l.data,this._options=s.extend({},l),this._collectResourceTiming=l.collectResourceTiming,l.maxzoom!==void 0&&(this.maxzoom=l.maxzoom),l.type&&(this.type=l.type),l.attribution&&(this.attribution=l.attribution),this.promoteId=l.promoteId;const v=s.EXTENT/this.tileSize;this.workerOptions=s.extend({source:this.id,cluster:l.cluster||!1,geojsonVtOptions:{buffer:(l.buffer!==void 0?l.buffer:128)*v,tolerance:(l.tolerance!==void 0?l.tolerance:.375)*v,extent:s.EXTENT,maxZoom:this.maxzoom,lineMetrics:l.lineMetrics||!1,generateId:l.generateId||!1},superclusterOptions:{maxZoom:l.clusterMaxZoom!==void 0?l.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,l.clusterMinPoints||2),extent:s.EXTENT,radius:(l.clusterRadius!==void 0?l.clusterRadius:50)*v,log:!1,generateId:l.generateId||!1},clusterProperties:l.clusterProperties,filter:l.filter},l.workerOptions)}onAdd(m){this.map=m,this.setData(this._data)}setData(m){return this._data=m,this._updateWorkerData(),this}getClusterExpansionZoom(m,l){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:m,source:this.id},l),this}getClusterChildren(m,l){return this.actor.send("geojson.getClusterChildren",{clusterId:m,source:this.id},l),this}getClusterLeaves(m,l,f,_){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:m,limit:l,offset:f},_),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new s.Event("dataloading",{dataType:"source"})),this._loaded=!1;const m=s.extend({},this.workerOptions),l=this._data;typeof l=="string"?(m.request=this.map._requestManager.transformRequest(s.exported.resolveURL(l),s.ResourceType.Source),m.request.collectResourceTiming=this._collectResourceTiming):m.data=JSON.stringify(l),this._pendingLoad=this.actor.send(`${this.type}.loadData`,m,(f,_)=>{if(this._loaded=!0,this._pendingLoad=null,f)this.fire(new s.ErrorEvent(f));else{const v={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&_&&_.resourceTiming&&_.resourceTiming[this.id]&&(v.resourceTiming=_.resourceTiming[this.id]),this.fire(new s.Event("data",v)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(m,l){const f=m.actor?"reloadTile":"loadTile";m.actor=this.actor,m.request=this.actor.send(f,{type:this.type,uid:m.uid,tileID:m.tileID,tileZoom:m.tileZoom,zoom:m.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:s.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(_,v)=>(delete m.request,m.unloadVectorData(),m.aborted?l(null):_?l(_):(m.loadVectorData(v,this.map.painter,f==="reloadTile"),l(null))),void 0,f==="loadTile")}abortTile(m){m.request&&(m.request.cancel(),delete m.request),m.aborted=!0}unloadTile(m){m.unloadVectorData(),this.actor.send("removeTile",{uid:m.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return s.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends en{constructor(m,l,f,_){super(m,l,f,_),this.roundZoom=!0,this.type="video",this.options=l}load(){this._loaded=!1;const m=this.options;this.urls=[];for(const l of m.urls)this.urls.push(this.map._requestManager.transformRequest(l,s.ResourceType.Source).url);s.getVideo(this.urls,(l,f)=>{this._loaded=!0,l?this.fire(new s.ErrorEvent(l)):f&&(this.video=f,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(m){if(this.video){const l=this.video.seekable;m<l.start(0)||m>l.end(0)?this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${l.start(0)} and ${l.end(0)}-second mark.`))):this.video.currentTime=m}}getVideo(){return this.video}onAdd(m){this.map||(this.map=m,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const m=this.map.painter.context,l=m.gl;this.texture?this.video.paused||(this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE),l.texSubImage2D(l.TEXTURE_2D,0,0,0,l.RGBA,l.UNSIGNED_BYTE,this.video)):(this.texture=new s.Texture(m,this.video,l.RGBA),this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(m)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:en,canvas:class extends en{constructor(m,l,f,_){super(m,l,f,_),l.coordinates?Array.isArray(l.coordinates)&&l.coordinates.length===4&&!l.coordinates.some(v=>!Array.isArray(v)||v.length!==2||v.some(b=>typeof b!="number"))||this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${m}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${m}`,null,'missing required property "coordinates"'))),l.animate&&typeof l.animate!="boolean"&&this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${m}`,null,'optional "animate" property must be a boolean value'))),l.canvas?typeof l.canvas=="string"||l.canvas instanceof s.window.HTMLCanvasElement||this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${m}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${m}`,null,'missing required property "canvas"'))),this.options=l,this.animate=l.animate===void 0||l.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof s.window.HTMLCanvasElement?this.options.canvas:s.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new s.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(m){this.map=m,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let m=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,m=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,m=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const l=this.map.painter.context;this.texture?(m||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new s.Texture(l,this.canvas,l.gl.RGBA,{premultiply:!0}),this._prepareData(l)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const m of[this.canvas.width,this.canvas.height])if(isNaN(m)||m<=0)return!0;return!1}},custom:class extends s.Evented{constructor(m,l,f,_){super(),this.id=m,this.type="custom",this._dataType="raster",this._dispatcher=f,this._implementation=l,this.setEventedParent(_),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new s.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new s.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Kr(this._implementation.bounds,this.minzoom,this.maxzoom)),l.update=this._update.bind(this),l.clearTiles=this._clearTiles.bind(this),l.coveringTiles=this._coveringTiles.bind(this),s.extend(this,s.pick(l,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return s.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new s.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(m){this._map=m,this._loaded=!1,this.fire(new s.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(m),this.load()}onRemove(m){this._implementation.onRemove&&this._implementation.onRemove(m)}hasTile(m){if(this._implementation.hasTile){const{x:l,y:f,z:_}=m.canonical;return this._implementation.hasTile({x:l,y:f,z:_})}return!this.tileBounds||this.tileBounds.contains(m.canonical)}loadTile(m,l){const{x:f,y:_,z:v}=m.tileID.canonical,b=new s.window.AbortController;m.request=Promise.resolve(this._implementation.loadTile({x:f,y:_,z:v},{signal:b.signal})).then((function(C){return delete m.request,m.aborted?(m.state="unloaded",l(null)):C===void 0?(m.state="errored",l(null)):C===null?(this.loadTileData(m,{width:this.tileSize,height:this.tileSize,data:null}),m.state="loaded",l(null)):function(I){return I instanceof s.window.ImageData||I instanceof s.window.HTMLCanvasElement||I instanceof s.window.ImageBitmap||I instanceof s.window.HTMLImageElement}(C)?(this.loadTileData(m,C),m.state="loaded",void l(null)):(m.state="errored",l(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(C=>{C.code!==20&&(m.state="errored",l(C))}),m.request.cancel=()=>b.abort()}loadTileData(m,l){at.loadTileData(m,l,this._map.painter)}unloadTileData(m){at.unloadTileData(m,this._map.painter)}unloadTile(m,l){if(this.unloadTileData(m),this._implementation.unloadTile){const{x:f,y:_,z:v}=m.tileID.canonical;this._implementation.unloadTile({x:f,y:_,z:v})}l()}abortTile(m,l){m.request&&m.request.cancel&&(m.request.cancel(),delete m.request),l()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(m=>({x:m.canonical.x,y:m.canonical.y,z:m.canonical.z}))}_clearTiles(){this._map.style._clearSource(this.id)}_update(){this.fire(new s.Event("data",{dataType:"source",sourceDataType:"content"}))}}},tn=function(m,l,f,_){const v=new Ht[l.type](m,l,f,_);if(v.id!==m)throw new Error(`Expected Source id to be ${m} instead of ${v.id}`);return s.bindAll(["load","abort","unload","serialize","prepare"],v),v};function fn(m,l){const f=s.identity([]);return s.scale(f,f,[.5*m.width,.5*-m.height,1]),s.translate(f,f,[1,-1,0]),s.multiply(f,f,m.calculateProjMatrix(l.toUnwrapped())),Float32Array.from(f)}function rr(m,l,f,_,v,b,C,I=!1){const P=m.tilesIn(_,C,I);P.sort(wi);const O=[];for(const U of P)O.push({wrappedTileID:U.tile.tileID.wrapped().key,queryResults:U.tile.queryRenderedFeatures(l,f,m._state,U,v,b,fn(m.transform,U.tile.tileID),I)});const k=function(U){const W={},J={};for(const ee of U){const Q=ee.queryResults,te=ee.wrappedTileID,V=J[te]=J[te]||{};for(const K in Q){const se=Q[K],ae=V[K]=V[K]||{},ge=W[K]=W[K]||[];for(const ve of se)ae[ve.featureIndex]||(ae[ve.featureIndex]=!0,ge.push(ve))}}return W}(O);for(const U in k)k[U].forEach(W=>{const J=W.feature,ee=J.layer;ee&&ee.type!=="background"&&ee.type!=="sky"&&(J.source=ee.source,ee["source-layer"]&&(J.sourceLayer=ee["source-layer"]),J.state=J.id!==void 0?m.getFeatureState(ee["source-layer"],J.id):{})});return k}function Cr(m,l){const f=m.getRenderableIds().map(b=>m.getTileByID(b)),_=[],v={};for(let b=0;b<f.length;b++){const C=f[b],I=C.tileID.canonical.key;v[I]||(v[I]=!0,C.querySourceFeatures(_,l))}return _}function wi(m,l){const f=m.tileID,_=l.tileID;return f.overscaledZ-_.overscaledZ||f.canonical.y-_.canonical.y||f.wrap-_.wrap||f.canonical.x-_.canonical.x}function qr(){return oc.workerClass!=null?new oc.workerClass:new s.window.Worker(oc.workerUrl)}const Ls="mapboxgl_preloaded_worker_pool";class Jr{constructor(){this.active={}}acquire(l){if(!this.workers)for(this.workers=[];this.workers.length<Jr.workerCount;)this.workers.push(new qr);return this.active[l]=!0,this.workers.slice()}release(l){delete this.active[l],this.numActive()===0&&(this.workers.forEach(f=>{f.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Ls]}numActive(){return Object.keys(this.active).length}}let zi;function Vu(){return zi||(zi=new Jr),zi}function Fx(m,l){const f={};for(const _ in m)_!=="ref"&&(f[_]=m[_]);return s.refProperties.forEach(_=>{_ in l&&(f[_]=l[_])}),f}function Z_(m){m=m.slice();const l=Object.create(null);for(let f=0;f<m.length;f++)l[m[f].id]=m[f];for(let f=0;f<m.length;f++)"ref"in m[f]&&(m[f]=Fx(m[f],l[m[f].ref]));return m}Jr.workerCount=2;const Sn={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function jd(m,l,f){f.push({command:Sn.addSource,args:[m,l[m]]})}function rh(m,l,f){l.push({command:Sn.removeSource,args:[m]}),f[m]=!0}function Gd(m,l,f,_){rh(m,f,_),jd(m,l,f)}function Nf(m,l,f){let _;for(_ in m[f])if(m[f].hasOwnProperty(_)&&_!=="data"&&!w(m[f][_],l[f][_]))return!1;for(_ in l[f])if(l[f].hasOwnProperty(_)&&_!=="data"&&!w(m[f][_],l[f][_]))return!1;return!0}function Ds(m,l,f,_,v,b){let C;for(C in l=l||{},m=m||{})m.hasOwnProperty(C)&&(w(m[C],l[C])||f.push({command:b,args:[_,C,l[C],v]}));for(C in l)l.hasOwnProperty(C)&&!m.hasOwnProperty(C)&&(w(m[C],l[C])||f.push({command:b,args:[_,C,l[C],v]}))}function da(m){return m.id}function qd(m,l){return m[l.id]=l,m}class Xd{constructor(l,f){this.reset(l,f)}reset(l,f){this.points=l||[],this._distances=[0];for(let _=1;_<this.points.length;_++)this._distances[_]=this._distances[_-1]+this.points[_].dist(this.points[_-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(f||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(l){if(this.points.length===1)return this.points[0];l=s.clamp(l,0,1);let f=1,_=this._distances[f];const v=l*this.paddedLength+this.padding;for(;_<v&&f<this._distances.length;)_=this._distances[++f];const b=f-1,C=this._distances[b],I=_-C,P=I>0?(v-C)/I:0;return this.points[b].mult(1-P).add(this.points[f].mult(P))}}class Zl{constructor(l,f,_){const v=this.boxCells=[],b=this.circleCells=[];this.xCellCount=Math.ceil(l/_),this.yCellCount=Math.ceil(f/_);for(let C=0;C<this.xCellCount*this.yCellCount;C++)v.push([]),b.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=l,this.height=f,this.xScale=this.xCellCount/l,this.yScale=this.yCellCount/f,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(l,f,_,v,b){this._forEachCell(f,_,v,b,this._insertBoxCell,this.boxUid++),this.boxKeys.push(l),this.bboxes.push(f),this.bboxes.push(_),this.bboxes.push(v),this.bboxes.push(b)}insertCircle(l,f,_,v){this._forEachCell(f-v,_-v,f+v,_+v,this._insertCircleCell,this.circleUid++),this.circleKeys.push(l),this.circles.push(f),this.circles.push(_),this.circles.push(v)}_insertBoxCell(l,f,_,v,b,C){this.boxCells[b].push(C)}_insertCircleCell(l,f,_,v,b,C){this.circleCells[b].push(C)}_query(l,f,_,v,b,C){if(_<0||l>this.width||v<0||f>this.height)return!b&&[];const I=[];if(l<=0&&f<=0&&this.width<=_&&this.height<=v){if(b)return!0;for(let P=0;P<this.boxKeys.length;P++)I.push({key:this.boxKeys[P],x1:this.bboxes[4*P],y1:this.bboxes[4*P+1],x2:this.bboxes[4*P+2],y2:this.bboxes[4*P+3]});for(let P=0;P<this.circleKeys.length;P++){const O=this.circles[3*P],k=this.circles[3*P+1],U=this.circles[3*P+2];I.push({key:this.circleKeys[P],x1:O-U,y1:k-U,x2:O+U,y2:k+U})}return C?I.filter(C):I}return this._forEachCell(l,f,_,v,this._queryCell,I,{hitTest:b,seenUids:{box:{},circle:{}}},C),b?I.length>0:I}_queryCircle(l,f,_,v,b){const C=l-_,I=l+_,P=f-_,O=f+_;if(I<0||C>this.width||O<0||P>this.height)return!v&&[];const k=[];return this._forEachCell(C,P,I,O,this._queryCellCircle,k,{hitTest:v,circle:{x:l,y:f,radius:_},seenUids:{box:{},circle:{}}},b),v?k.length>0:k}query(l,f,_,v,b){return this._query(l,f,_,v,!1,b)}hitTest(l,f,_,v,b){return this._query(l,f,_,v,!0,b)}hitTestCircle(l,f,_,v){return this._queryCircle(l,f,_,!0,v)}_queryCell(l,f,_,v,b,C,I,P){const O=I.seenUids,k=this.boxCells[b];if(k!==null){const W=this.bboxes;for(const J of k)if(!O.box[J]){O.box[J]=!0;const ee=4*J;if(l<=W[ee+2]&&f<=W[ee+3]&&_>=W[ee+0]&&v>=W[ee+1]&&(!P||P(this.boxKeys[J]))){if(I.hitTest)return C.push(!0),!0;C.push({key:this.boxKeys[J],x1:W[ee],y1:W[ee+1],x2:W[ee+2],y2:W[ee+3]})}}}const U=this.circleCells[b];if(U!==null){const W=this.circles;for(const J of U)if(!O.circle[J]){O.circle[J]=!0;const ee=3*J;if(this._circleAndRectCollide(W[ee],W[ee+1],W[ee+2],l,f,_,v)&&(!P||P(this.circleKeys[J]))){if(I.hitTest)return C.push(!0),!0;{const Q=W[ee],te=W[ee+1],V=W[ee+2];C.push({key:this.circleKeys[J],x1:Q-V,y1:te-V,x2:Q+V,y2:te+V})}}}}}_queryCellCircle(l,f,_,v,b,C,I,P){const O=I.circle,k=I.seenUids,U=this.boxCells[b];if(U!==null){const J=this.bboxes;for(const ee of U)if(!k.box[ee]){k.box[ee]=!0;const Q=4*ee;if(this._circleAndRectCollide(O.x,O.y,O.radius,J[Q+0],J[Q+1],J[Q+2],J[Q+3])&&(!P||P(this.boxKeys[ee])))return C.push(!0),!0}}const W=this.circleCells[b];if(W!==null){const J=this.circles;for(const ee of W)if(!k.circle[ee]){k.circle[ee]=!0;const Q=3*ee;if(this._circlesCollide(J[Q],J[Q+1],J[Q+2],O.x,O.y,O.radius)&&(!P||P(this.circleKeys[ee])))return C.push(!0),!0}}}_forEachCell(l,f,_,v,b,C,I,P){const O=this._convertToXCellCoord(l),k=this._convertToYCellCoord(f),U=this._convertToXCellCoord(_),W=this._convertToYCellCoord(v);for(let J=O;J<=U;J++)for(let ee=k;ee<=W;ee++)if(b.call(this,l,f,_,v,this.xCellCount*ee+J,C,I,P))return}_convertToXCellCoord(l){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(l*this.xScale)))}_convertToYCellCoord(l){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(l*this.yScale)))}_circlesCollide(l,f,_,v,b,C){const I=v-l,P=b-f,O=_+C;return O*O>I*I+P*P}_circleAndRectCollide(l,f,_,v,b,C,I){const P=(C-v)/2,O=Math.abs(l-(v+P));if(O>P+_)return!1;const k=(I-b)/2,U=Math.abs(f-(b+k));if(U>k+_)return!1;if(O<=P||U<=k)return!0;const W=O-P,J=U-k;return W*W+J*J<=_*_}}const ma={unknown:0,flipRequired:1,flipNotRequired:2},ih=Math.tan(85*Math.PI/180);function Ge(m,l,f,_,v,b,C){const I=s.create();if(f)if(b.name==="globe"){const P=s.calculateGlobeLabelMatrix(v,l);s.multiply(I,I,P)}else{const P=xe([],C);I[0]=P[0],I[1]=P[1],I[4]=P[2],I[5]=P[3],_||s.rotateZ(I,I,v.angle)}else s.multiply(I,v.labelPlaneMatrix,m);return I}function ga(m,l,f,_,v,b,C){const I=Ge(m,l,f,_,v,b,C);return b.name==="globe"&&f||(I[2]=I[6]=I[10]=I[14]=0),I}function Ir(m,l,f,_,v,b,C){if(f){if(b.name==="globe"){const I=Ge(m,l,f,_,v,b,C);return s.invert(I,I),s.multiply(I,m,I),I}{const I=s.clone(m),P=s.identity([]);return P[0]=C[0],P[1]=C[1],P[4]=C[2],P[5]=C[3],s.multiply(I,I,P),_||s.rotateZ(I,I,-v.angle),I}}return v.glCoordMatrix}function Qr(m,l,f,_){const v=[m,l,f,1];f?s.transformMat4$1(v,v,_):sn(v,v,_);const b=v[3];return v[0]/=b,v[1]/=b,v[2]/=b,v}function W_(m,l){return Math.min(.5+m/l*.5,1.5)}function Rs(m,l){const f=m[0]/m[3],_=m[1]/m[3];return f>=-l[0]&&f<=l[0]&&_>=-l[1]&&_<=l[1]}function $d(m,l,f,_,v,b,C,I,P,O){const k=f.transform,U=_?m.textSizeData:m.iconSizeData,W=s.evaluateSizeForZoom(U,f.transform.zoom),J=k.projection.name==="globe",ee=[256/f.width*2+1,256/f.height*2+1],Q=_?m.text.dynamicLayoutVertexArray:m.icon.dynamicLayoutVertexArray;Q.clear();let te=null;J&&(te=_?m.text.globeExtVertexArray:m.icon.globeExtVertexArray);const V=m.lineVertexArray,K=_?m.text.placedSymbolArray:m.icon.placedSymbolArray,se=f.transform.width/f.transform.height;let ae,ge=!1;for(let ve=0;ve<K.length;ve++){const ye=K.get(ve),{numGlyphs:Ie,writingMode:Ce}=ye;if(Ce!==s.WritingMode.vertical||ge||ae===s.WritingMode.horizontal||(ge=!0),ae=Ce,(ye.hidden||Ce===s.WritingMode.vertical)&&!ge){is(Ie,Q);continue}ge=!1;const Ne=new s.Point(ye.tileAnchorX,ye.tileAnchorY);let{x:rt,y:Le,z:Ye}=k.projection.projectTilePoint(Ne.x,Ne.y,O.canonical);if(P){const[jt,St,Ot]=P(Ne);rt+=jt,Le+=St,Ye+=Ot}const Fe=[rt,Le,Ye,1];if(s.transformMat4$1(Fe,Fe,l),!Rs(Fe,ee)){is(Ie,Q);continue}const nt=W_(f.transform.cameraToCenterDistance,Fe[3]),Re=s.evaluateSizeForFeature(U,W,ye),Ze=C?Re/nt:Re*nt,ot=Qr(rt,Le,Ye,v);if(ot[3]<=0){is(Ie,Q);continue}let Qe={};const st=C?null:P,Mt=vt(ye,Ze,!1,I,l,v,b,m.glyphOffsetArray,V,Q,te,ot,Ne,Qe,se,st,k.projection,O,C);ge=Mt.useVertical,st&&Mt.needsFlipping&&(Qe={}),(Mt.notEnoughRoom||ge||Mt.needsFlipping&&vt(ye,Ze,!0,I,l,v,b,m.glyphOffsetArray,V,Q,te,ot,Ne,Qe,se,st,k.projection,O,C).notEnoughRoom)&&is(Ie,Q)}_?(m.text.dynamicLayoutVertexBuffer.updateData(Q),te&&m.text.globeExtVertexBuffer.updateData(te)):(m.icon.dynamicLayoutVertexBuffer.updateData(Q),te&&m.icon.globeExtVertexBuffer.updateData(te))}function H_(m,l,f,_,v,b,C,I,P,O,k,U,W,J,ee,Q){const{lineStartIndex:te,glyphStartIndex:V,segment:K}=I,se=V+I.numGlyphs,ae=te+I.lineLength,ge=l.getoffsetX(V),ve=l.getoffsetX(se-1),ye=mo(m*ge,f,_,v,b,C,K,te,ae,P,O,k,U,W,!0,J,ee,Q);if(!ye)return null;const Ie=mo(m*ve,f,_,v,b,C,K,te,ae,P,O,k,U,W,!0,J,ee,Q);return Ie?{first:ye,last:Ie}:null}function ju(m,l,f,_){return m===s.WritingMode.horizontal&&Math.abs(_)>Math.abs(f)?{useVertical:!0}:m===s.WritingMode.vertical?_>0?{needsFlipping:!0}:null:l!==ma.unknown&&function(v,b){return v===0||Math.abs(b/v)>ih}(f,_)?l===ma.flipRequired?{needsFlipping:!0}:null:f<0?{needsFlipping:!0}:null}function vt(m,l,f,_,v,b,C,I,P,O,k,U,W,J,ee,Q,te,V,K){const se=l/24,ae=m.lineOffsetX*se,ge=m.lineOffsetY*se,{lineStartIndex:ve,glyphStartIndex:ye,numGlyphs:Ie,segment:Ce,writingMode:Ne,flipState:rt}=m,Le=ve+m.lineLength,Ye=Fe=>{if(k){const[ot,Qe,st]=Fe.up,Mt=O.length;s.updateGlobeVertexNormal(k,Mt+0,ot,Qe,st),s.updateGlobeVertexNormal(k,Mt+1,ot,Qe,st),s.updateGlobeVertexNormal(k,Mt+2,ot,Qe,st),s.updateGlobeVertexNormal(k,Mt+3,ot,Qe,st)}const[nt,Re,Ze]=Fe.point;s.addDynamicAttributes(O,nt,Re,Ze,Fe.angle)};if(Ie>1){const Fe=H_(se,I,ae,ge,f,U,W,m,P,b,J,Q,!1,te,V,K);if(!Fe)return{notEnoughRoom:!0};if(_&&!f){let[nt,Re,Ze]=Fe.first.point,[ot,Qe,st]=Fe.last.point;[nt,Re]=Qr(nt,Re,Ze,C),[ot,Qe]=Qr(ot,Qe,st,C);const Mt=ju(Ne,rt,(ot-nt)*ee,Qe-Re);if(m.flipState=Mt&&Mt.needsFlipping?ma.flipRequired:ma.flipNotRequired,Mt)return Mt}Ye(Fe.first);for(let nt=ye+1;nt<ye+Ie-1;nt++){const Re=mo(se*I.getoffsetX(nt),ae,ge,f,U,W,Ce,ve,Le,P,b,J,Q,!1,!1,te,V,K);if(!Re)return O.length-=4*(nt-ye),{notEnoughRoom:!0};Ye(Re)}Ye(Fe.last)}else{if(_&&!f){const nt=Qr(W.x,W.y,0,v),Re=ve+Ce+1,Ze=new s.Point(P.getx(Re),P.gety(Re)),ot=Qr(Ze.x,Ze.y,0,v),Qe=ot[3]>0?ot:on(W,Ze,nt,1,v,void 0,te,V.canonical),st=ju(Ne,rt,(Qe[0]-nt[0])*ee,Qe[1]-nt[1]);if(m.flipState=st&&st.needsFlipping?ma.flipRequired:ma.flipNotRequired,st)return st}const Fe=mo(se*I.getoffsetX(ye),ae,ge,f,U,W,Ce,ve,Le,P,b,J,Q,!1,!1,te,V,K);if(!Fe)return{notEnoughRoom:!0};Ye(Fe)}return{}}function cn(m,l,f,_,v){const{x:b,y:C,z:I}=_.projectTilePoint(m.x,m.y,l);if(!v)return Qr(b,C,I,f);const[P,O,k]=v(m);return Qr(b+P,C+O,I+k,f)}function on(m,l,f,_,v,b,C,I){const P=cn(m.sub(l)._unit()._add(m),I,v,C,b);return s.sub(P,f,P),s.normalize(P,P),s.scaleAndAdd(P,f,P,_)}function mo(m,l,f,_,v,b,C,I,P,O,k,U,W,J,ee,Q,te,V){const K=_?m-l:m+l;let se=K>0?1:-1,ae=0;_&&(se*=-1,ae=Math.PI),se<0&&(ae+=Math.PI);let ge=I+C+(se>0?0:1)|0,ve=v,ye=v,Ie=0,Ce=0;const Ne=Math.abs(K),rt=[],Le=[];let Ye=b,Fe=Ye;const nt=()=>on(Fe,Ye,ye,Ne-Ie+1,k,W,Q,te.canonical);for(;Ie+Ce<=Ne;){if(ge+=se,ge<I||ge>=P)return null;if(ye=ve,Fe=Ye,rt.push(ye),J&&Le.push(Fe),Ye=new s.Point(O.getx(ge),O.gety(ge)),ve=U[ge],!ve){const Ot=cn(Ye,te.canonical,k,Q,W);ve=Ot[3]>0?U[ge]=Ot:nt()}Ie+=Ce,Ce=s.distance(ye,ve)}ee&&W&&(U[ge]&&(ve=nt(),Ce=s.distance(ye,ve)),U[ge]=ve);const Re=(Ne-Ie)/Ce,Ze=Ye.sub(Fe)._mult(Re)._add(Fe),ot=s.sub([],ve,ye),Qe=s.scaleAndAdd([],ye,ot,Re);let st=[0,0,1],Mt=ot[0],jt=ot[1];if(V&&(st=Q.upVector(te.canonical,Ze.x,Ze.y),st[0]!==0||st[1]!==0||st[2]!==1)){const Ot=[st[2],0,-st[0]],an=s.cross([],st,Ot);s.normalize(Ot,Ot),s.normalize(an,an),Mt=s.dot(ot,Ot),jt=s.dot(ot,an)}if(f){const Ot=s.cross([],st,ot);s.normalize(Ot,Ot),s.scaleAndAdd(Qe,Qe,Ot,f*se)}const St=ae+Math.atan2(jt,Mt);return rt.push(Qe),J&&Le.push(Ze),{point:Qe,angle:St,path:rt,tilePath:Le,up:st}}function is(m,l){const f=l.length,_=f+4*m;l.resize(_),l.float32.fill(-1/0,4*f,4*_)}function sn(m,l,f){const _=l[0],v=l[1];return m[0]=f[0]*_+f[4]*v+f[12],m[1]=f[1]*_+f[5]*v+f[13],m[3]=f[3]*_+f[7]*v+f[15],m}const go=100;class oh{constructor(l,f,_=new Zl(l.width+200,l.height+200,25),v=new Zl(l.width+200,l.height+200,25)){this.transform=l,this.grid=_,this.ignoredGrid=v,this.pitchfactor=Math.cos(l._pitch)*l.cameraToCenterDistance,this.screenRightBoundary=l.width+go,this.screenBottomBoundary=l.height+go,this.gridRightBoundary=l.width+200,this.gridBottomBoundary=l.height+200,this.fogState=f}placeCollisionBox(l,f,_,v,b,C,I,P){let O=_.projectedAnchorX,k=_.projectedAnchorY,U=_.projectedAnchorZ;const W=_.elevation,J=_.tileID,ee=l.getProjection();if(W&&J){const[ve,ye,Ie]=ee.upVector(J.canonical,_.tileAnchorX,_.tileAnchorY),Ce=ee.upVectorScale(J.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;O+=ve*W*Ce,k+=ye*W*Ce,U+=Ie*W*Ce}const Q=this.projectAndGetPerspectiveRatio(I,O,k,U,_.tileID,ee.name==="globe"||!!W||this.transform.pitch>0,ee),te=C*Q.perspectiveRatio,V=(_.x1*f+v.x-_.padding)*te+Q.point.x,K=(_.y1*f+v.y-_.padding)*te+Q.point.y,se=(_.x2*f+v.x+_.padding)*te+Q.point.x,ae=(_.y2*f+v.y+_.padding)*te+Q.point.y,ge=Q.perspectiveRatio<=.55||Q.occluded;return!this.isInsideGrid(V,K,se,ae)||!b&&this.grid.hitTest(V,K,se,ae,P)||ge?{box:[],offscreen:!1,occluded:Q.occluded}:{box:[V,K,se,ae],offscreen:this.isOffscreen(V,K,se,ae),occluded:!1}}placeCollisionCircles(l,f,_,v,b,C,I,P,O,k,U,W,J,ee,Q){const te=[],V=this.transform.elevation,K=l.getProjection(),se=V?V.getAtTileOffsetFunc(Q,this.transform.center.lat,this.transform.worldSize,K):null,ae=new s.Point(_.tileAnchorX,_.tileAnchorY);let{x:ge,y:ve,z:ye}=K.projectTilePoint(ae.x,ae.y,Q.canonical);if(se){const[Ze,ot,Qe]=se(ae);ge+=Ze,ve+=ot,ye+=Qe}const Ie=K.name==="globe",Ce=this.projectAndGetPerspectiveRatio(I,ge,ve,ye,Q,Ie||!!V||this.transform.pitch>0,K),{perspectiveRatio:Ne}=Ce,rt=(U?C/Ne:C*Ne)/s.ONE_EM,Le=Qr(ge,ve,ye,P),Ye=Ce.signedDistanceFromCamera>0?H_(rt,b,_.lineOffsetX*rt,_.lineOffsetY*rt,!1,Le,ae,_,v,P,{},V&&!U?se:null,U&&!!V,K,Q,U):null;let Fe=!1,nt=!1,Re=!0;if(Ye&&!Ce.occluded){const Ze=.5*J*Ne+ee,ot=new s.Point(-100,-100),Qe=new s.Point(this.screenRightBoundary,this.screenBottomBoundary),st=new Xd,{first:Mt,last:jt}=Ye,St=Mt.path.length;let Ot=[];for(let It=St-1;It>=1;It--)Ot.push(Mt.path[It]);for(let It=1;It<jt.path.length;It++)Ot.push(jt.path[It]);const an=2.5*Ze;O&&(Ot=Ot.map(([It,In,Dn],Rn)=>(se&&!Ie&&(Dn=se(Rn<St-1?Mt.tilePath[St-1-Rn]:jt.tilePath[Rn-St+2])[2]),Qr(It,In,Dn,O))),Ot.some(It=>It[3]<=0)&&(Ot=[]));let nn=[];if(Ot.length>0){let It=1/0,In=-1/0,Dn=1/0,Rn=-1/0;for(const Nn of Ot)It=Math.min(It,Nn[0]),Dn=Math.min(Dn,Nn[1]),In=Math.max(In,Nn[0]),Rn=Math.max(Rn,Nn[1]);In>=ot.x&&It<=Qe.x&&Rn>=ot.y&&Dn<=Qe.y&&(nn=[Ot.map(Nn=>new s.Point(Nn[0],Nn[1]))],(It<ot.x||In>Qe.x||Dn<ot.y||Rn>Qe.y)&&(nn=s.clipLine(nn,ot.x,ot.y,Qe.x,Qe.y)))}for(const It of nn){st.reset(It,.25*Ze);let In=0;In=st.length<=.5*Ze?1:Math.ceil(st.paddedLength/an)+1;for(let Dn=0;Dn<In;Dn++){const Rn=Dn/Math.max(In-1,1),Nn=st.lerp(Rn),Ei=Nn.x+go,ti=Nn.y+go;te.push(Ei,ti,Ze,0);const Oo=Ei-Ze,zs=ti-Ze,Qn=Ei+Ze,kn=ti+Ze;if(Re=Re&&this.isOffscreen(Oo,zs,Qn,kn),nt=nt||this.isInsideGrid(Oo,zs,Qn,kn),!f&&this.grid.hitTestCircle(Ei,ti,Ze,W)&&(Fe=!0,!k))return{circles:[],offscreen:!1,collisionDetected:Fe,occluded:!1}}}}return{circles:!k&&Fe||!nt?[]:te,offscreen:Re,collisionDetected:Fe,occluded:Ce.occluded}}queryRenderedSymbols(l){if(l.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const f=[];let _=1/0,v=1/0,b=-1/0,C=-1/0;for(const k of l){const U=new s.Point(k.x+go,k.y+go);_=Math.min(_,U.x),v=Math.min(v,U.y),b=Math.max(b,U.x),C=Math.max(C,U.y),f.push(U)}const I=this.grid.query(_,v,b,C).concat(this.ignoredGrid.query(_,v,b,C)),P={},O={};for(const k of I){const U=k.key;if(P[U.bucketInstanceId]===void 0&&(P[U.bucketInstanceId]={}),P[U.bucketInstanceId][U.featureIndex])continue;const W=[new s.Point(k.x1,k.y1),new s.Point(k.x2,k.y1),new s.Point(k.x2,k.y2),new s.Point(k.x1,k.y2)];s.polygonIntersectsPolygon(f,W)&&(P[U.bucketInstanceId][U.featureIndex]=!0,O[U.bucketInstanceId]===void 0&&(O[U.bucketInstanceId]=[]),O[U.bucketInstanceId].push(U.featureIndex))}return O}insertCollisionBox(l,f,_,v,b){(f?this.ignoredGrid:this.grid).insert({bucketInstanceId:_,featureIndex:v,collisionGroupID:b},l[0],l[1],l[2],l[3])}insertCollisionCircles(l,f,_,v,b){const C=f?this.ignoredGrid:this.grid,I={bucketInstanceId:_,featureIndex:v,collisionGroupID:b};for(let P=0;P<l.length;P+=4)C.insertCircle(I,l[P],l[P+1],l[P+2])}projectAndGetPerspectiveRatio(l,f,_,v,b,C,I){const P=[f,_,v,1];let O=!1;v||this.transform.pitch>0?(s.transformMat4$1(P,P,l),this.fogState&&b&&I.name!=="globe"&&(O=function(W,J,ee,Q,te,V){const K=V.calculateFogTileMatrix(te),se=[J,ee,Q];return s.transformMat4(se,se,K),Bt(W,se,V.pitch,V._fov)}(this.fogState,f,_,v,b.toUnwrapped(),this.transform)>.9)):sn(P,P,l);const k=P[3];return{point:new s.Point((P[0]/k+1)/2*this.transform.width+go,(-P[1]/k+1)/2*this.transform.height+go),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(I)/k*.5,1.5),signedDistanceFromCamera:k,occluded:C&&P[2]>k||O}}isOffscreen(l,f,_,v){return _<go||l>=this.screenRightBoundary||v<go||f>this.screenBottomBoundary}isInsideGrid(l,f,_,v){return _>=0&&l<this.gridRightBoundary&&v>=0&&f<this.gridBottomBoundary}getViewportMatrix(){const l=s.identity([]);return s.translate(l,l,[-100,-100,0]),l}}function Wl(m,l,f){const _=l.createTileMatrix(m,m.worldSize,f.toUnwrapped());return s.multiply(new Float32Array(16),m.projMatrix,_)}function Do(m,l,f){if(l.projection.name===f.projection.name)return m.projMatrix;const _=f.clone();return _.setProjection(l.projection),Wl(_,l.getProjection(),m)}function Jn(m,l,f){return l.name===f.projection.name?m.projMatrix:Wl(f,l,m)}class Y_{constructor(l,f,_,v){this.opacity=l?Math.max(0,Math.min(1,l.opacity+(l.placed?f:-f))):v&&_?1:0,this.placed=_}isHidden(){return this.opacity===0&&!this.placed}}class _a{constructor(l,f,_,v,b,C=!1){this.text=new Y_(l?l.text:null,f,_,b),this.icon=new Y_(l?l.icon:null,f,v,b),this.clipped=C}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class sh{constructor(l,f,_,v=!1){this.text=l,this.icon=f,this.skipFade=_,this.clipped=v}}class ah{constructor(){this.invProjMatrix=s.create(),this.viewportMatrix=s.create(),this.circles=[]}}class Zd{constructor(l,f,_,v,b){this.bucketInstanceId=l,this.featureIndex=f,this.sourceLayerIndex=_,this.bucketIndex=v,this.tileID=b}}class K_{constructor(l){this.crossSourceCollisions=l,this.maxGroupID=0,this.collisionGroups={}}get(l){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[l]){const f=++this.maxGroupID;this.collisionGroups[l]={ID:f,predicate:_=>_.collisionGroupID===f}}return this.collisionGroups[l]}}function lh(m,l,f,_,v){const{horizontalAlign:b,verticalAlign:C}=s.getAnchorAlignment(m),I=-(b-.5)*l,P=-(C-.5)*f,O=s.evaluateVariableOffset(m,_);return new s.Point(I+O[0]*v,P+O[1]*v)}function uh(m,l,f,_,v){const b=new s.Point(m,l);return f&&b._rotate(_?v:-v),b}class kf{constructor(l,f,_,v,b){this.transform=l.clone(),this.projection=l.projection.name,this.collisionIndex=new oh(this.transform,b),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=f,this.retainedQueryData={},this.collisionGroups=new K_(_),this.collisionCircleArrays={},this.prevPlacement=v,v&&(v.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(l,f,_,v){const b=_.getBucket(f),C=_.latestFeatureIndex;if(!b||!C||f.id!==b.layerIds[0])return;const I=b.layers[0].layout,P=_.collisionBoxArray,O=Math.pow(2,this.transform.zoom-_.tileID.overscaledZ),k=_.tileSize/s.EXTENT,U=_.tileID.toUnwrapped();this.transform.setProjection(b.projection);const W=(J=_.tileID,ee=b.getProjection(),Q=this.transform,ee.name===this.projection?Q.calculateProjMatrix(J.toUnwrapped()):Wl(Q,ee,J));var J,ee,Q;const te=I.get("text-pitch-alignment")==="map",V=I.get("text-rotation-alignment")==="map";f.compileFilter();const K=f.dynamicFilter(),se=f.dynamicFilterNeedsFeature(),ae=this.transform.calculatePixelsToTileUnitsMatrix(_),ge=ga(W,_.tileID.canonical,te,V,this.transform,b.getProjection(),ae);let ve=null;if(te){const Ce=Ir(W,_.tileID.canonical,te,V,this.transform,b.getProjection(),ae);ve=s.multiply([],this.transform.labelPlaneMatrix,Ce)}let ye=null;K&&_.latestFeatureIndex&&(ye={unwrappedTileID:U,dynamicFilter:K,dynamicFilterNeedsFeature:se,featureIndex:_.latestFeatureIndex}),this.retainedQueryData[b.bucketInstanceId]=new Zd(b.bucketInstanceId,C,b.sourceLayerIndex,b.index,_.tileID);const Ie={bucket:b,layout:I,posMatrix:W,textLabelPlaneMatrix:ge,labelToScreenMatrix:ve,clippingData:ye,scale:O,textPixelRatio:k,holdingForFade:_.holdingForFade(),collisionBoxArray:P,partiallyEvaluatedTextSize:s.evaluateSizeForZoom(b.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:s.evaluateSizeForZoom(b.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(b.sourceID)};if(v)for(const Ce of b.sortKeyRanges){const{sortKey:Ne,symbolInstanceStart:rt,symbolInstanceEnd:Le}=Ce;l.push({sortKey:Ne,symbolInstanceStart:rt,symbolInstanceEnd:Le,parameters:Ie})}else l.push({symbolInstanceStart:0,symbolInstanceEnd:b.symbolInstances.length,parameters:Ie})}attemptAnchorPlacement(l,f,_,v,b,C,I,P,O,k,U,W,J,ee,Q,te,V,K){const{textOffset0:se,textOffset1:ae,crossTileID:ge}=W,ve=[se,ae],ye=lh(l,_,v,ve,b),Ie=this.collisionIndex.placeCollisionBox(ee,b,f,uh(ye.x,ye.y,C,I,this.transform.angle),U,P,O,k.predicate);if(te){const Ce=ee.getSymbolInstanceIconSize(K,this.transform.zoom,W.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(ee,Ce,te,uh(ye.x,ye.y,C,I,this.transform.angle),U,P,O,k.predicate).box.length===0)return}if(Ie.box.length>0){let Ce;return this.prevPlacement&&this.prevPlacement.variableOffsets[ge]&&this.prevPlacement.placements[ge]&&this.prevPlacement.placements[ge].text&&(Ce=this.prevPlacement.variableOffsets[ge].anchor),this.variableOffsets[ge]={textOffset:ve,width:_,height:v,anchor:l,textScale:b,prevAnchor:Ce},this.markUsedJustification(ee,l,W,Q),ee.allowVerticalPlacement&&(this.markUsedOrientation(ee,Q,W),this.placedOrientations[ge]=Q),{shift:ye,placedGlyphBoxes:Ie}}}placeLayerBucketPart(l,f,_,v){const{bucket:b,layout:C,posMatrix:I,textLabelPlaneMatrix:P,labelToScreenMatrix:O,clippingData:k,textPixelRatio:U,holdingForFade:W,collisionBoxArray:J,partiallyEvaluatedTextSize:ee,partiallyEvaluatedIconSize:Q,collisionGroup:te}=l.parameters,V=C.get("text-optional"),K=C.get("icon-optional"),se=C.get("text-allow-overlap"),ae=C.get("icon-allow-overlap"),ge=C.get("text-rotation-alignment")==="map",ve=C.get("text-pitch-alignment")==="map",ye=C.get("icon-text-fit")!=="none",Ie=C.get("symbol-z-order")==="viewport-y";this.transform.setProjection(b.projection);let Ce=se&&(ae||!b.hasIconData()||K),Ne=ae&&(se||!b.hasTextData()||V);!b.collisionArrays&&J&&b.deserializeCollisionBoxes(J),_&&v&&b.updateCollisionDebugBuffers(this.transform.zoom,J);const rt=(Le,Ye,Fe)=>{const{crossTileID:nt,numVerticalGlyphVertices:Re}=Le;if(k){const Qn={zoom:this.transform.zoom,pitch:this.transform.pitch};let kn=null;if(k.dynamicFilterNeedsFeature){const yn=this.retainedQueryData[b.bucketInstanceId];kn=k.featureIndex.loadFeature({featureIndex:Le.featureIndex,bucketIndex:yn.bucketIndex,sourceLayerIndex:yn.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,k.dynamicFilter)(Qn,kn,this.retainedQueryData[b.bucketInstanceId].tileID.canonical,new s.Point(Le.tileAnchorX,Le.tileAnchorY),this.transform.calculateDistanceTileData(k.unwrappedTileID)))return this.placements[nt]=new sh(!1,!1,!1,!0),void f.add(nt)}if(f.has(nt))return;if(W)return void(this.placements[nt]=new sh(!1,!1,!1));let Ze=!1,ot=!1,Qe=!0,st=!1,Mt=!1,jt=null,St={box:null,offscreen:null,occluded:null},Ot={box:null,offscreen:null,occluded:null},an=null,nn=null,It=null,In=0,Dn=0,Rn=0;Fe.textFeatureIndex?In=Fe.textFeatureIndex:Le.useRuntimeCollisionCircles&&(In=Le.featureIndex),Fe.verticalTextFeatureIndex&&(Dn=Fe.verticalTextFeatureIndex);const Nn=Qn=>{Qn.tileID=this.retainedQueryData[b.bucketInstanceId].tileID;const kn=this.transform.elevation;(kn||Qn.elevation)&&(Qn.elevation=kn?kn.getAtTileOffset(Qn.tileID,Qn.tileAnchorX,Qn.tileAnchorY):0)},Ei=Fe.textBox;if(Ei){Nn(Ei);const Qn=yn=>{let Mr=s.WritingMode.horizontal;if(b.allowVerticalPlacement&&!yn&&this.prevPlacement){const Fi=this.prevPlacement.placedOrientations[nt];Fi&&(this.placedOrientations[nt]=Fi,Mr=Fi,this.markUsedOrientation(b,Mr,Le))}return Mr},kn=(yn,Mr)=>{if(b.allowVerticalPlacement&&Re>0&&Fe.verticalTextBox){for(const Fi of b.writingModes)if(Fi===s.WritingMode.vertical?(St=Mr(),Ot=St):St=yn(),St&&St.box&&St.box.length)break}else St=yn()};if(C.get("text-variable-anchor")){let yn=C.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[nt]){const Hn=this.prevPlacement.variableOffsets[nt];yn.indexOf(Hn.anchor)>0&&(yn=yn.filter(Yi=>Yi!==Hn.anchor),yn.unshift(Hn.anchor))}const Mr=(Hn,Yi,lp)=>{const nu=b.getSymbolInstanceTextSize(ee,Le,this.transform.zoom,Ye),Ah=(Hn.x2-Hn.x1)*nu+2*Hn.padding,Sa=(Hn.y2-Hn.y1)*nu+2*Hn.padding,hl=ye&&!ae?Yi:null;hl&&Nn(hl);let ru={box:[],offscreen:!1,occluded:!1};const up=se?2*yn.length:yn.length;for(let Ph=0;Ph<up;++Ph){const zm=this.attemptAnchorPlacement(yn[Ph%yn.length],Hn,Ah,Sa,nu,ge,ve,U,I,te,Ph>=yn.length,Le,Ye,b,lp,hl,ee,Q);if(zm&&(ru=zm.placedGlyphBoxes,ru&&ru.box&&ru.box.length)){Ze=!0,jt=zm.shift;break}}return ru};kn(()=>Mr(Ei,Fe.iconBox,s.WritingMode.horizontal),()=>{const Hn=Fe.verticalTextBox;return Hn&&Nn(Hn),b.allowVerticalPlacement&&!(St&&St.box&&St.box.length)&&Re>0&&Hn?Mr(Hn,Fe.verticalIconBox,s.WritingMode.vertical):{box:null,offscreen:null,occluded:null}}),St&&(Ze=St.box,Qe=St.offscreen,st=St.occluded);const Fi=Qn(!(!St||!St.box));if(!Ze&&this.prevPlacement){const Hn=this.prevPlacement.variableOffsets[nt];Hn&&(this.variableOffsets[nt]=Hn,this.markUsedJustification(b,Hn.anchor,Le,Fi))}}else{const yn=(Mr,Fi)=>{const Hn=b.getSymbolInstanceTextSize(ee,Le,this.transform.zoom,Ye),Yi=this.collisionIndex.placeCollisionBox(b,Hn,Mr,new s.Point(0,0),se,U,I,te.predicate);return Yi&&Yi.box&&Yi.box.length&&(this.markUsedOrientation(b,Fi,Le),this.placedOrientations[nt]=Fi),Yi};kn(()=>yn(Ei,s.WritingMode.horizontal),()=>{const Mr=Fe.verticalTextBox;return b.allowVerticalPlacement&&Re>0&&Mr?(Nn(Mr),yn(Mr,s.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}}),Qn(!!(St&&St.box&&St.box.length))}}if(an=St,Ze=an&&an.box&&an.box.length>0,Qe=an&&an.offscreen,st=an&&an.occluded,Le.useRuntimeCollisionCircles){const Qn=b.text.placedSymbolArray.get(Le.centerJustifiedTextSymbolIndex>=0?Le.centerJustifiedTextSymbolIndex:Le.verticalPlacedTextSymbolIndex),kn=s.evaluateSizeForFeature(b.textSizeData,ee,Qn),yn=C.get("text-padding");nn=this.collisionIndex.placeCollisionCircles(b,se,Qn,b.lineVertexArray,b.glyphOffsetArray,kn,I,P,O,_,ve,te.predicate,Le.collisionCircleDiameter*kn/s.ONE_EM,yn,this.retainedQueryData[b.bucketInstanceId].tileID),Ze=se||nn.circles.length>0&&!nn.collisionDetected,Qe=Qe&&nn.offscreen,st=nn.occluded}if(Fe.iconFeatureIndex&&(Rn=Fe.iconFeatureIndex),Fe.iconBox){const Qn=kn=>{Nn(kn);const yn=ye&&jt?uh(jt.x,jt.y,ge,ve,this.transform.angle):new s.Point(0,0),Mr=b.getSymbolInstanceIconSize(Q,this.transform.zoom,Le.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(b,Mr,kn,yn,ae,U,I,te.predicate)};Ot&&Ot.box&&Ot.box.length&&Fe.verticalIconBox?(It=Qn(Fe.verticalIconBox),ot=It.box.length>0):(It=Qn(Fe.iconBox),ot=It.box.length>0),Qe=Qe&&It.offscreen,Mt=It.occluded}const ti=V||Le.numHorizontalGlyphVertices===0&&Re===0,Oo=K||Le.numIconVertices===0;if(ti||Oo?Oo?ti||(ot=ot&&Ze):Ze=ot&&Ze:ot=Ze=ot&&Ze,Ze&&an&&an.box&&this.collisionIndex.insertCollisionBox(an.box,C.get("text-ignore-placement"),b.bucketInstanceId,Ot&&Ot.box&&Dn?Dn:In,te.ID),ot&&It&&this.collisionIndex.insertCollisionBox(It.box,C.get("icon-ignore-placement"),b.bucketInstanceId,Rn,te.ID),nn&&(Ze&&this.collisionIndex.insertCollisionCircles(nn.circles,C.get("text-ignore-placement"),b.bucketInstanceId,In,te.ID),_)){const Qn=b.bucketInstanceId;let kn=this.collisionCircleArrays[Qn];kn===void 0&&(kn=this.collisionCircleArrays[Qn]=new ah);for(let yn=0;yn<nn.circles.length;yn+=4)kn.circles.push(nn.circles[yn+0]),kn.circles.push(nn.circles[yn+1]),kn.circles.push(nn.circles[yn+2]),kn.circles.push(nn.collisionDetected?1:0)}const zs=b.projection.name!=="globe";Ce=Ce&&(zs||!st),Ne=Ne&&(zs||!Mt),this.placements[nt]=new sh(Ze||Ce,ot||Ne,Qe||b.justReloaded),f.add(nt)};if(Ie){const Le=b.getSortedSymbolIndexes(this.transform.angle);for(let Ye=Le.length-1;Ye>=0;--Ye){const Fe=Le[Ye];rt(b.symbolInstances.get(Fe),Fe,b.collisionArrays[Fe])}}else for(let Le=l.symbolInstanceStart;Le<l.symbolInstanceEnd;Le++)rt(b.symbolInstances.get(Le),Le,b.collisionArrays[Le]);if(_&&b.bucketInstanceId in this.collisionCircleArrays){const Le=this.collisionCircleArrays[b.bucketInstanceId];s.invert(Le.invProjMatrix,I),Le.viewportMatrix=this.collisionIndex.getViewportMatrix()}b.justReloaded=!1}markUsedJustification(l,f,_,v){const{leftJustifiedTextSymbolIndex:b,centerJustifiedTextSymbolIndex:C,rightJustifiedTextSymbolIndex:I,verticalPlacedTextSymbolIndex:P,crossTileID:O}=_,k=s.getAnchorJustification(f),U=v===s.WritingMode.vertical?P:k==="left"?b:k==="center"?C:k==="right"?I:-1;b>=0&&(l.text.placedSymbolArray.get(b).crossTileID=U>=0&&b!==U?0:O),C>=0&&(l.text.placedSymbolArray.get(C).crossTileID=U>=0&&C!==U?0:O),I>=0&&(l.text.placedSymbolArray.get(I).crossTileID=U>=0&&I!==U?0:O),P>=0&&(l.text.placedSymbolArray.get(P).crossTileID=U>=0&&P!==U?0:O)}markUsedOrientation(l,f,_){const v=f===s.WritingMode.horizontal||f===s.WritingMode.horizontalOnly?f:0,b=f===s.WritingMode.vertical?f:0,{leftJustifiedTextSymbolIndex:C,centerJustifiedTextSymbolIndex:I,rightJustifiedTextSymbolIndex:P,verticalPlacedTextSymbolIndex:O}=_,k=l.text.placedSymbolArray;C>=0&&(k.get(C).placedOrientation=v),I>=0&&(k.get(I).placedOrientation=v),P>=0&&(k.get(P).placedOrientation=v),O>=0&&(k.get(O).placedOrientation=b)}commit(l){this.commitTime=l,this.zoomAtLastRecencyCheck=this.transform.zoom;const f=this.prevPlacement;let _=!1;this.prevZoomAdjustment=f?f.zoomAdjustment(this.transform.zoom):0;const v=f?f.symbolFadeChange(l):1,b=f?f.opacities:{},C=f?f.variableOffsets:{},I=f?f.placedOrientations:{};for(const P in this.placements){const O=this.placements[P],k=b[P];k?(this.opacities[P]=new _a(k,v,O.text,O.icon,null,O.clipped),_=_||O.text!==k.text.placed||O.icon!==k.icon.placed):(this.opacities[P]=new _a(null,v,O.text,O.icon,O.skipFade,O.clipped),_=_||O.text||O.icon)}for(const P in b){const O=b[P];if(!this.opacities[P]){const k=new _a(O,v,!1,!1);k.isHidden()||(this.opacities[P]=k,_=_||O.text.placed||O.icon.placed)}}for(const P in C)this.variableOffsets[P]||!this.opacities[P]||this.opacities[P].isHidden()||(this.variableOffsets[P]=C[P]);for(const P in I)this.placedOrientations[P]||!this.opacities[P]||this.opacities[P].isHidden()||(this.placedOrientations[P]=I[P]);_?this.lastPlacementChangeTime=l:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=f?f.lastPlacementChangeTime:l)}updateLayerOpacities(l,f){const _=new Set;for(const v of f){const b=v.getBucket(l);b&&v.latestFeatureIndex&&l.id===b.layerIds[0]&&this.updateBucketOpacities(b,_,v.collisionBoxArray)}}updateBucketOpacities(l,f,_){l.hasTextData()&&l.text.opacityVertexArray.clear(),l.hasIconData()&&l.icon.opacityVertexArray.clear(),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexArray.clear(),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexArray.clear();const v=l.layers[0].layout,b=!!l.layers[0].dynamicFilter(),C=new _a(null,0,!1,!1,!0),I=v.get("text-allow-overlap"),P=v.get("icon-allow-overlap"),O=v.get("text-variable-anchor"),k=v.get("text-rotation-alignment")==="map",U=v.get("text-pitch-alignment")==="map",W=v.get("icon-text-fit")!=="none",J=new _a(null,0,I&&(P||!l.hasIconData()||v.get("icon-optional")),P&&(I||!l.hasTextData()||v.get("text-optional")),!0);!l.collisionArrays&&_&&(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData())&&l.deserializeCollisionBoxes(_);const ee=(te,V,K)=>{for(let se=0;se<V/4;se++)te.opacityVertexArray.emplaceBack(K)};let Q=0;for(let te=0;te<l.symbolInstances.length;te++){const V=l.symbolInstances.get(te),{numHorizontalGlyphVertices:K,numVerticalGlyphVertices:se,crossTileID:ae,numIconVertices:ge}=V,ve=f.has(ae);let ye=this.opacities[ae];ve?ye=C:ye||(ye=J,this.opacities[ae]=ye),f.add(ae);const Ie=K>0||se>0,Ce=ge>0,Ne=this.placedOrientations[ae],rt=Ne===s.WritingMode.vertical,Le=Ne===s.WritingMode.horizontal||Ne===s.WritingMode.horizontalOnly;if(!Ie&&!Ce||ye.isHidden()||Q++,Ie){const Ye=ch(ye.text);ee(l.text,K,rt?fr:Ye),ee(l.text,se,Le?fr:Ye);const Fe=ye.text.isHidden(),{leftJustifiedTextSymbolIndex:nt,centerJustifiedTextSymbolIndex:Re,rightJustifiedTextSymbolIndex:Ze,verticalPlacedTextSymbolIndex:ot}=V,Qe=l.text.placedSymbolArray,st=Fe||rt?1:0;nt>=0&&(Qe.get(nt).hidden=st),Re>=0&&(Qe.get(Re).hidden=st),Ze>=0&&(Qe.get(Ze).hidden=st),ot>=0&&(Qe.get(ot).hidden=Fe||Le?1:0);const Mt=this.variableOffsets[ae];Mt&&this.markUsedJustification(l,Mt.anchor,V,Ne);const jt=this.placedOrientations[ae];jt&&(this.markUsedJustification(l,"left",V,jt),this.markUsedOrientation(l,jt,V))}if(Ce){const Ye=ch(ye.icon),{placedIconSymbolIndex:Fe,verticalPlacedIconSymbolIndex:nt}=V,Re=l.icon.placedSymbolArray,Ze=ye.icon.isHidden()?1:0;Fe>=0&&(ee(l.icon,ge,rt?fr:Ye),Re.get(Fe).hidden=Ze),nt>=0&&(ee(l.icon,V.numVerticalIconVertices,Le?fr:Ye),Re.get(nt).hidden=Ze)}if(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData()){const Ye=l.collisionArrays[te];if(Ye){let Fe=new s.Point(0,0),nt=!0;if(Ye.textBox||Ye.verticalTextBox){if(O){const Ze=this.variableOffsets[ae];Ze?(Fe=lh(Ze.anchor,Ze.width,Ze.height,Ze.textOffset,Ze.textScale),k&&Fe._rotate(U?this.transform.angle:-this.transform.angle)):nt=!1}b&&(nt=!ye.clipped),Ye.textBox&&Gu(l.textCollisionBox.collisionVertexArray,ye.text.placed,!nt||rt,Fe.x,Fe.y),Ye.verticalTextBox&&Gu(l.textCollisionBox.collisionVertexArray,ye.text.placed,!nt||Le,Fe.x,Fe.y)}const Re=nt&&!!(!Le&&Ye.verticalIconBox);Ye.iconBox&&Gu(l.iconCollisionBox.collisionVertexArray,ye.icon.placed,Re,W?Fe.x:0,W?Fe.y:0),Ye.verticalIconBox&&Gu(l.iconCollisionBox.collisionVertexArray,ye.icon.placed,!Re,W?Fe.x:0,W?Fe.y:0)}}}if(l.fullyClipped=Q===0,l.sortFeatures(this.transform.angle),this.retainedQueryData[l.bucketInstanceId]&&(this.retainedQueryData[l.bucketInstanceId].featureSortOrder=l.featureSortOrder),l.hasTextData()&&l.text.opacityVertexBuffer&&l.text.opacityVertexBuffer.updateData(l.text.opacityVertexArray),l.hasIconData()&&l.icon.opacityVertexBuffer&&l.icon.opacityVertexBuffer.updateData(l.icon.opacityVertexArray),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexBuffer&&l.iconCollisionBox.collisionVertexBuffer.updateData(l.iconCollisionBox.collisionVertexArray),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexBuffer&&l.textCollisionBox.collisionVertexBuffer.updateData(l.textCollisionBox.collisionVertexArray),l.bucketInstanceId in this.collisionCircleArrays){const te=this.collisionCircleArrays[l.bucketInstanceId];l.placementInvProjMatrix=te.invProjMatrix,l.placementViewportMatrix=te.viewportMatrix,l.collisionCircleArray=te.circles,delete this.collisionCircleArrays[l.bucketInstanceId]}}symbolFadeChange(l){return this.fadeDuration===0?1:(l-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(l){return Math.max(0,(this.transform.zoom-l)/1.5)}hasTransitions(l){return this.stale||l-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(l,f){const _=this.zoomAtLastRecencyCheck===f?1-this.zoomAdjustment(f):1;return this.zoomAtLastRecencyCheck=f,this.commitTime+this.fadeDuration*_>l}setStale(){this.stale=!0}}function Gu(m,l,f,_,v){m.emplaceBack(l?1:0,f?1:0,_||0,v||0),m.emplaceBack(l?1:0,f?1:0,_||0,v||0),m.emplaceBack(l?1:0,f?1:0,_||0,v||0),m.emplaceBack(l?1:0,f?1:0,_||0,v||0)}const Wi=Math.pow(2,25),xr=Math.pow(2,24),Wd=Math.pow(2,17),Hd=Math.pow(2,16),Hi=Math.pow(2,9),Ro=Math.pow(2,8),J_=Math.pow(2,1);function ch(m){if(m.opacity===0&&!m.placed)return 0;if(m.opacity===1&&m.placed)return 4294967295;const l=m.placed?1:0,f=Math.floor(127*m.opacity);return f*Wi+l*xr+f*Wd+l*Hd+f*Hi+l*Ro+f*J_+l}const fr=0;class hh{constructor(l){this._sortAcrossTiles=l.layout.get("symbol-z-order")!=="viewport-y"&&l.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(l,f,_,v,b){const C=this._bucketParts;for(;this._currentTileIndex<l.length;)if(f.getBucketParts(C,v,l[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,b())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,C.sort((I,P)=>I.sortKey-P.sortKey));this._currentPartIndex<C.length;){const I=C[this._currentPartIndex];if(f.placeLayerBucketPart(I,this._seenCrossTileIDs,_,I.symbolInstanceStart===0),this._currentPartIndex++,b())return!0}return!1}}class Yd{constructor(l,f,_,v,b,C,I,P){this.placement=new kf(l,b,C,I,P),this._currentPlacementIndex=f.length-1,this._forceFullPlacement=_,this._showCollisionBoxes=v,this._done=!1}isDone(){return this._done}continuePlacement(l,f,_){const v=s.exported.now(),b=()=>{const C=s.exported.now()-v;return!this._forceFullPlacement&&C>2};for(;this._currentPlacementIndex>=0;){const C=f[l[this._currentPlacementIndex]],I=this.placement.collisionIndex.transform.zoom;if(C.type==="symbol"&&(!C.minzoom||C.minzoom<=I)&&(!C.maxzoom||C.maxzoom>I)){if(this._inProgressLayer||(this._inProgressLayer=new hh(C)),this._inProgressLayer.continuePlacement(_[C.source],this.placement,this._showCollisionBoxes,C,b))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(l){return this.placement.commit(l),this.placement}}const Hl=512/s.EXTENT/2;class fi{constructor(l,f,_){this.tileID=l,this.bucketInstanceId=_,this.index=new s.KDBush(f.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const v=l.canonical.x*s.EXTENT,b=l.canonical.y*s.EXTENT;for(let C=0;C<f.length;C++){const{key:I,crossTileID:P,tileAnchorX:O,tileAnchorY:k}=f.get(C),U=Math.floor((v+O)*Hl),W=Math.floor((b+k)*Hl);this.index.add(U,W),this.keys.push(I),this.crossTileIDs.push(P)}this.index.finish()}findMatches(l,f,_){const v=this.tileID.canonical.z<f.canonical.z?1:Math.pow(2,this.tileID.canonical.z-f.canonical.z),b=Hl/Math.pow(2,f.canonical.z-this.tileID.canonical.z),C=f.canonical.x*s.EXTENT,I=f.canonical.y*s.EXTENT;for(let P=0;P<l.length;P++){const O=l.get(P);if(O.crossTileID)continue;const{key:k,tileAnchorX:U,tileAnchorY:W}=O,J=Math.floor((C+U)*b),ee=Math.floor((I+W)*b),Q=this.index.range(J-v,ee-v,J+v,ee+v);for(const te of Q){const V=this.crossTileIDs[te];if(this.keys[te]===k&&!_.has(V)){_.add(V),O.crossTileID=V;break}}}}}class Kd{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Jd{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(l){const f=Math.round((l-this.lng)/360);if(f!==0)for(const _ in this.indexes){const v=this.indexes[_],b={};for(const C in v){const I=v[C];I.tileID=I.tileID.unwrapTo(I.tileID.wrap+f),b[I.tileID.key]=I}this.indexes[_]=b}this.lng=l}addBucket(l,f,_){if(this.indexes[l.overscaledZ]&&this.indexes[l.overscaledZ][l.key]){if(this.indexes[l.overscaledZ][l.key].bucketInstanceId===f.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(l.overscaledZ,this.indexes[l.overscaledZ][l.key])}for(let b=0;b<f.symbolInstances.length;b++)f.symbolInstances.get(b).crossTileID=0;this.usedCrossTileIDs[l.overscaledZ]||(this.usedCrossTileIDs[l.overscaledZ]=new Set);const v=this.usedCrossTileIDs[l.overscaledZ];for(const b in this.indexes){const C=this.indexes[b];if(Number(b)>l.overscaledZ)for(const I in C){const P=C[I];P.tileID.isChildOf(l)&&P.findMatches(f.symbolInstances,l,v)}else{const I=C[l.scaledTo(Number(b)).key];I&&I.findMatches(f.symbolInstances,l,v)}}for(let b=0;b<f.symbolInstances.length;b++){const C=f.symbolInstances.get(b);C.crossTileID||(C.crossTileID=_.generate(),v.add(C.crossTileID))}return this.indexes[l.overscaledZ]===void 0&&(this.indexes[l.overscaledZ]={}),this.indexes[l.overscaledZ][l.key]=new fi(l,f.symbolInstances,f.bucketInstanceId),!0}removeBucketCrossTileIDs(l,f){for(const _ of f.crossTileIDs)this.usedCrossTileIDs[l].delete(_)}removeStaleBuckets(l){let f=!1;for(const _ in this.indexes){const v=this.indexes[_];for(const b in v)l[v[b].bucketInstanceId]||(this.removeBucketCrossTileIDs(_,v[b]),delete v[b],f=!0)}return f}}class ya{constructor(){this.layerIndexes={},this.crossTileIDs=new Kd,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(l,f,_,v){let b=this.layerIndexes[l.id];b===void 0&&(b=this.layerIndexes[l.id]=new Jd);let C=!1;const I={};v.name!=="globe"&&b.handleWrapJump(_);for(const P of f){const O=P.getBucket(l);O&&l.id===O.layerIds[0]&&(O.bucketInstanceId||(O.bucketInstanceId=++this.maxBucketInstanceId),b.addBucket(P.tileID,O,this.crossTileIDs)&&(C=!0),I[O.bucketInstanceId]=!0)}return b.removeStaleBuckets(I)&&(C=!0),C}pruneUnusedLayers(l){const f={};l.forEach(_=>{f[_]=!0});for(const _ in this.layerIndexes)f[_]||delete this.layerIndexes[_]}}const ul=(m,l)=>s.emitValidationErrors(m,l&&l.filter(f=>f.identifier!=="source.canvas")),Of=s.pick(Sn,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),Bx=s.pick(Sn,["setCenter","setZoom","setBearing","setPitch"]),Qd={version:8,layers:[],sources:{}},qu={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class Ns extends s.Evented{constructor(l,f={}){super(),this.map=l,this.dispatcher=new Ct(Vu(),this),this.imageManager=new We,this.imageManager.setEventedParent(this),this.glyphManager=new s.GlyphManager(l._requestManager,f.localFontFamily?s.LocalGlyphMode.all:f.localIdeographFontFamily?s.LocalGlyphMode.ideographs:s.LocalGlyphMode.none,f.localFontFamily||f.localIdeographFontFamily),this.crossTileSymbolIndex=new ya,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",s.getReferrer());const _=this;this._rtlTextPluginCallback=Ns.registerForPluginStateChange(v=>{_.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:v.pluginStatus,pluginURL:v.pluginURL},(b,C)=>{if(s.triggerPluginCompletionEvent(b),C&&C.every(I=>I))for(const I in _._sourceCaches){const P=_._sourceCaches[I],O=P.getSource().type;O!=="vector"&&O!=="geojson"||P.reload()}})}),this.on("data",v=>{if(v.dataType!=="source"||v.sourceDataType!=="metadata")return;const b=this.getSource(v.sourceId);if(b&&b.vectorLayerIds)for(const C in this._layers){const I=this._layers[C];I.source===b.id&&this._validateLayer(I)}})}loadURL(l,f={}){this.fire(new s.Event("dataloading",{dataType:"style"}));const _=typeof f.validate=="boolean"?f.validate:!s.isMapboxURL(l);l=this.map._requestManager.normalizeStyleURL(l,f.accessToken);const v=this.map._requestManager.transformRequest(l,s.ResourceType.Style);this._request=s.getJSON(v,(b,C)=>{this._request=null,b?this.fire(new s.ErrorEvent(b)):C&&this._load(C,_)})}loadJSON(l,f={}){this.fire(new s.Event("dataloading",{dataType:"style"})),this._request=s.exported.frame(()=>{this._request=null,this._load(l,f.validate!==!1)})}loadEmpty(){this.fire(new s.Event("dataloading",{dataType:"style"})),this._load(Qd,!1)}_updateLayerCount(l,f){const _=f?1:-1;l.is3D()&&(this._num3DLayers+=_),l.type==="circle"&&(this._numCircleLayers+=_),l.type==="symbol"&&(this._numSymbolLayers+=_)}_load(l,f){if(f&&ul(this,s.validateStyle(l)))return;this._loaded=!0,this.stylesheet=s.clone$1(l),this._updateMapProjection();for(const v in l.sources)this.addSource(v,l.sources[v],{validate:!1});this._changed=!1,l.sprite?this._loadSprite(l.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(l.glyphs);const _=Z_(this.stylesheet.layers);this._order=_.map(v=>v.id),this._layers={},this._serializedLayers={};for(const v of _){const b=s.createStyleLayer(v);b.setEventedParent(this,{layer:{id:b.id}}),this._layers[b.id]=b,this._serializedLayers[b.id]=b.serialize(),this._updateLayerCount(b,!0)}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new $e(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new s.Event("data",{dataType:"style"})),this.fire(new s.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}setProjection(l){l?this.stylesheet.projection=l:delete this.stylesheet.projection,this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.stylesheet.projection)}_loadSprite(l){this._spriteRequest=function(f,_,v){let b,C,I;const P=s.exported.devicePixelRatio>1?"@2x":"";let O=s.getJSON(_.transformRequest(_.normalizeSpriteURL(f,P,".json"),s.ResourceType.SpriteJSON),(W,J)=>{O=null,I||(I=W,b=J,U())}),k=s.getImage(_.transformRequest(_.normalizeSpriteURL(f,P,".png"),s.ResourceType.SpriteImage),(W,J)=>{k=null,I||(I=W,C=J,U())});function U(){if(I)v(I);else if(b&&C){const W=s.exported.getImageData(C),J={};for(const ee in b){const{width:Q,height:te,x:V,y:K,sdf:se,pixelRatio:ae,stretchX:ge,stretchY:ve,content:ye}=b[ee],Ie=new s.RGBAImage({width:Q,height:te});s.RGBAImage.copy(W,Ie,{x:V,y:K},{x:0,y:0},{width:Q,height:te}),J[ee]={data:Ie,pixelRatio:ae,sdf:se,stretchX:ge,stretchY:ve,content:ye}}v(null,J)}}return{cancel(){O&&(O.cancel(),O=null),k&&(k.cancel(),k=null)}}}(l,this.map._requestManager,(f,_)=>{if(this._spriteRequest=null,f)this.fire(new s.ErrorEvent(f));else if(_)for(const v in _)this.imageManager.addImage(v,_[v]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new s.Event("data",{dataType:"style"}))})}_validateLayer(l){const f=this.getSource(l.source);if(!f)return;const _=l.sourceLayer;_&&(f.type==="geojson"||f.vectorLayerIds&&f.vectorLayerIds.indexOf(_)===-1)&&this.fire(new s.ErrorEvent(new Error(`Source layer "${_}" does not exist on source "${f.id}" as specified by style layer "${l.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const l in this._sourceCaches)if(!this._sourceCaches[l].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(l){const f=[];for(const _ of l){const v=this._layers[_];v.type!=="custom"&&f.push(v.serialize())}return f}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const l in this._sourceCaches)if(this._sourceCaches[l].hasTransition())return!0;for(const l in this._layers)if(this._layers[l].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(l){return!!this.terrain&&(typeof l.isLayerDraped=="function"?l.isLayerDraped():qu[l.type])}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(l){if(!this._loaded)return;const f=this._changed;if(this._changed){const v=Object.keys(this._updatedLayers),b=Object.keys(this._removedLayers);(v.length||b.length)&&this._updateWorkerLayers(v,b);for(const C in this._updatedSources){const I=this._updatedSources[C];I==="reload"?this._reloadSource(C):I==="clear"&&this._clearSource(C)}this._updateTilesForChangedImages();for(const C in this._updatedPaintProps)this._layers[C].updateTransitions(l);this.light.updateTransitions(l),this.fog&&this.fog.updateTransitions(l),this._resetUpdates()}const _={};for(const v in this._sourceCaches){const b=this._sourceCaches[v];_[v]=b.used,b.used=!1}for(const v of this._order){const b=this._layers[v];if(b.recalculate(l,this._availableImages),!b.isHidden(l.zoom)){const I=this._getLayerSourceCache(b);I&&(I.used=!0)}const C=this.map.painter;if(C){const I=b.getProgramIds();if(!I)continue;const P=b.getProgramConfiguration(l.zoom);for(const O of I)C.useProgram(O,P)}}for(const v in _){const b=this._sourceCaches[v];_[v]!==b.used&&b.getSource().fire(new s.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:b.getSource().id}))}this.light.recalculate(l),this.terrain&&this.terrain.recalculate(l),this.fog&&this.fog.recalculate(l),this.z=l.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),f&&this.fire(new s.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const l=Object.keys(this._changedImages);if(l.length){for(const f in this._sourceCaches)this._sourceCaches[f].reloadTilesForDependencies(["icons","patterns"],l);this._changedImages={}}}_updateWorkerLayers(l,f){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(l),removedIds:f})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(l){if(this._checkLoaded(),ul(this,s.validateStyle(l)))return!1;(l=s.clone$1(l)).layers=Z_(l.layers);const f=function(v,b){if(!v)return[{command:Sn.setStyle,args:[b]}];let C=[];try{if(!w(v.version,b.version))return[{command:Sn.setStyle,args:[b]}];w(v.center,b.center)||C.push({command:Sn.setCenter,args:[b.center]}),w(v.zoom,b.zoom)||C.push({command:Sn.setZoom,args:[b.zoom]}),w(v.bearing,b.bearing)||C.push({command:Sn.setBearing,args:[b.bearing]}),w(v.pitch,b.pitch)||C.push({command:Sn.setPitch,args:[b.pitch]}),w(v.sprite,b.sprite)||C.push({command:Sn.setSprite,args:[b.sprite]}),w(v.glyphs,b.glyphs)||C.push({command:Sn.setGlyphs,args:[b.glyphs]}),w(v.transition,b.transition)||C.push({command:Sn.setTransition,args:[b.transition]}),w(v.light,b.light)||C.push({command:Sn.setLight,args:[b.light]}),w(v.fog,b.fog)||C.push({command:Sn.setFog,args:[b.fog]}),w(v.projection,b.projection)||C.push({command:Sn.setProjection,args:[b.projection]});const I={},P=[];(function(U,W,J,ee){let Q;for(Q in W=W||{},U=U||{})U.hasOwnProperty(Q)&&(W.hasOwnProperty(Q)||rh(Q,J,ee));for(Q in W){if(!W.hasOwnProperty(Q))continue;const te=W[Q];U.hasOwnProperty(Q)?w(U[Q],te)||(U[Q].type==="geojson"&&te.type==="geojson"&&Nf(U,W,Q)?J.push({command:Sn.setGeoJSONSourceData,args:[Q,te.data]}):Gd(Q,W,J,ee)):jd(Q,W,J)}})(v.sources,b.sources,P,I);const O=[];v.layers&&v.layers.forEach(U=>{U.source&&I[U.source]?C.push({command:Sn.removeLayer,args:[U.id]}):O.push(U)});let k=v.terrain;k&&I[k.source]&&(C.push({command:Sn.setTerrain,args:[void 0]}),k=void 0),C=C.concat(P),w(k,b.terrain)||C.push({command:Sn.setTerrain,args:[b.terrain]}),function(U,W,J){W=W||[];const ee=(U=U||[]).map(da),Q=W.map(da),te=U.reduce(qd,{}),V=W.reduce(qd,{}),K=ee.slice(),se=Object.create(null);let ae,ge,ve,ye,Ie,Ce,Ne;for(ae=0,ge=0;ae<ee.length;ae++)ve=ee[ae],V.hasOwnProperty(ve)?ge++:(J.push({command:Sn.removeLayer,args:[ve]}),K.splice(K.indexOf(ve,ge),1));for(ae=0,ge=0;ae<Q.length;ae++)ve=Q[Q.length-1-ae],K[K.length-1-ae]!==ve&&(te.hasOwnProperty(ve)?(J.push({command:Sn.removeLayer,args:[ve]}),K.splice(K.lastIndexOf(ve,K.length-ge),1)):ge++,Ce=K[K.length-ae],J.push({command:Sn.addLayer,args:[V[ve],Ce]}),K.splice(K.length-ae,0,ve),se[ve]=!0);for(ae=0;ae<Q.length;ae++)if(ve=Q[ae],ye=te[ve],Ie=V[ve],!se[ve]&&!w(ye,Ie))if(w(ye.source,Ie.source)&&w(ye["source-layer"],Ie["source-layer"])&&w(ye.type,Ie.type)){for(Ne in Ds(ye.layout,Ie.layout,J,ve,null,Sn.setLayoutProperty),Ds(ye.paint,Ie.paint,J,ve,null,Sn.setPaintProperty),w(ye.filter,Ie.filter)||J.push({command:Sn.setFilter,args:[ve,Ie.filter]}),w(ye.minzoom,Ie.minzoom)&&w(ye.maxzoom,Ie.maxzoom)||J.push({command:Sn.setLayerZoomRange,args:[ve,Ie.minzoom,Ie.maxzoom]}),ye)ye.hasOwnProperty(Ne)&&Ne!=="layout"&&Ne!=="paint"&&Ne!=="filter"&&Ne!=="metadata"&&Ne!=="minzoom"&&Ne!=="maxzoom"&&(Ne.indexOf("paint.")===0?Ds(ye[Ne],Ie[Ne],J,ve,Ne.slice(6),Sn.setPaintProperty):w(ye[Ne],Ie[Ne])||J.push({command:Sn.setLayerProperty,args:[ve,Ne,Ie[Ne]]}));for(Ne in Ie)Ie.hasOwnProperty(Ne)&&!ye.hasOwnProperty(Ne)&&Ne!=="layout"&&Ne!=="paint"&&Ne!=="filter"&&Ne!=="metadata"&&Ne!=="minzoom"&&Ne!=="maxzoom"&&(Ne.indexOf("paint.")===0?Ds(ye[Ne],Ie[Ne],J,ve,Ne.slice(6),Sn.setPaintProperty):w(ye[Ne],Ie[Ne])||J.push({command:Sn.setLayerProperty,args:[ve,Ne,Ie[Ne]]}))}else J.push({command:Sn.removeLayer,args:[ve]}),Ce=K[K.lastIndexOf(ve)+1],J.push({command:Sn.addLayer,args:[Ie,Ce]})}(O,b.layers,C)}catch(I){console.warn("Unable to compute style diff:",I),C=[{command:Sn.setStyle,args:[b]}]}return C}(this.serialize(),l).filter(v=>!(v.command in Bx));if(f.length===0)return!1;const _=f.filter(v=>!(v.command in Of));if(_.length>0)throw new Error(`Unimplemented: ${_.map(v=>v.command).join(", ")}.`);return f.forEach(v=>{v.command!=="setTransition"&&v.command!=="setProjection"&&this[v.command].apply(this,v.args)}),this.stylesheet=l,this._updateMapProjection(),!0}addImage(l,f){return this.getImage(l)?this.fire(new s.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(l,f),this._afterImageUpdated(l),this)}updateImage(l,f){this.imageManager.updateImage(l,f)}getImage(l){return this.imageManager.getImage(l)}removeImage(l){return this.getImage(l)?(this.imageManager.removeImage(l),this._afterImageUpdated(l),this):this.fire(new s.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(l){this._availableImages=this.imageManager.listImages(),this._changedImages[l]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new s.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(l,f,_={}){if(this._checkLoaded(),this.getSource(l)!==void 0)throw new Error("There is already a source with this ID");if(!f.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(f).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(f.type)>=0&&this._validate(s.validateSource,`sources.${l}`,f,null,_))return;this.map&&this.map._collectResourceTiming&&(f.collectResourceTiming=!0);const v=tn(l,f,this.dispatcher,this);v.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(l),source:v.serialize(),sourceId:l}));const b=C=>{const I=(C?"symbol:":"other:")+l,P=this._sourceCaches[I]=new s.SourceCache(I,v,C);(C?this._symbolSourceCaches:this._otherSourceCaches)[l]=P,P.style=this,P.onAdd(this.map)};b(!1),f.type!=="vector"&&f.type!=="geojson"||b(!0),v.onAdd&&v.onAdd(this.map),this._changed=!0}removeSource(l){this._checkLoaded();const f=this.getSource(l);if(!f)throw new Error("There is no source with this ID");for(const v in this._layers)if(this._layers[v].source===l)return this.fire(new s.ErrorEvent(new Error(`Source "${l}" cannot be removed while layer "${v}" is using it.`)));if(this.terrain&&this.terrain.get().source===l)return this.fire(new s.ErrorEvent(new Error(`Source "${l}" cannot be removed while terrain is using it.`)));const _=this._getSourceCaches(l);for(const v of _)delete this._sourceCaches[v.id],delete this._updatedSources[v.id],v.fire(new s.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:v.getSource().id})),v.setEventedParent(null),v.clearTiles();return delete this._otherSourceCaches[l],delete this._symbolSourceCaches[l],f.setEventedParent(null),f.onRemove&&f.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(l,f){this._checkLoaded(),this.getSource(l).setData(f),this._changed=!0}getSource(l){const f=this._getSourceCache(l);return f&&f.getSource()}_getSources(){const l=[];for(const f in this._otherSourceCaches){const _=this._getSourceCache(f);_&&l.push(_.getSource())}return l}addLayer(l,f,_={}){this._checkLoaded();const v=l.id;if(this.getLayer(v))return void this.fire(new s.ErrorEvent(new Error(`Layer with id "${v}" already exists on this map`)));let b;if(l.type==="custom"){if(ul(this,s.validateCustomStyleLayer(l)))return;b=s.createStyleLayer(l)}else{if(typeof l.source=="object"&&(this.addSource(v,l.source),l=s.clone$1(l),l=s.extend(l,{source:v})),this._validate(s.validateLayer,`layers.${v}`,l,{arrayIndex:-1},_))return;b=s.createStyleLayer(l),this._validateLayer(b),b.setEventedParent(this,{layer:{id:v}}),this._serializedLayers[b.id]=b.serialize(),this._updateLayerCount(b,!0)}const C=f?this._order.indexOf(f):this._order.length;if(f&&C===-1)return void this.fire(new s.ErrorEvent(new Error(`Layer with id "${f}" does not exist on this map.`)));this._order.splice(C,0,v),this._layerOrderChanged=!0,this._layers[v]=b;const I=this._getLayerSourceCache(b);if(this._removedLayers[v]&&b.source&&I&&b.type!=="custom"){const P=this._removedLayers[v];delete this._removedLayers[v],P.type!==b.type?this._updatedSources[b.source]="clear":(this._updatedSources[b.source]="reload",I.pause())}this._updateLayer(b),b.onAdd&&b.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(l,f){if(this._checkLoaded(),this._changed=!0,!this._layers[l])return void this.fire(new s.ErrorEvent(new Error(`The layer '${l}' does not exist in the map's style and cannot be moved.`)));if(l===f)return;const _=this._order.indexOf(l);this._order.splice(_,1);const v=f?this._order.indexOf(f):this._order.length;f&&v===-1?this.fire(new s.ErrorEvent(new Error(`Layer with id "${f}" does not exist on this map.`))):(this._order.splice(v,0,l),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(l){this._checkLoaded();const f=this._layers[l];if(!f)return void this.fire(new s.ErrorEvent(new Error(`The layer '${l}' does not exist in the map's style and cannot be removed.`)));f.setEventedParent(null),this._updateLayerCount(f,!1);const _=this._order.indexOf(l);this._order.splice(_,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[l]=f,delete this._layers[l],delete this._serializedLayers[l],delete this._updatedLayers[l],delete this._updatedPaintProps[l],f.onRemove&&f.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(l){return this._layers[l]}hasLayer(l){return l in this._layers}hasLayerType(l){for(const f in this._layers)if(this._layers[f].type===l)return!0;return!1}setLayerZoomRange(l,f,_){this._checkLoaded();const v=this.getLayer(l);v?v.minzoom===f&&v.maxzoom===_||(f!=null&&(v.minzoom=f),_!=null&&(v.maxzoom=_),this._updateLayer(v)):this.fire(new s.ErrorEvent(new Error(`The layer '${l}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(l,f,_={}){this._checkLoaded();const v=this.getLayer(l);if(v){if(!w(v.filter,f))return f==null?(v.filter=void 0,void this._updateLayer(v)):void(this._validate(s.validateFilter,`layers.${v.id}.filter`,f,{layerType:v.type},_)||(v.filter=s.clone$1(f),this._updateLayer(v)))}else this.fire(new s.ErrorEvent(new Error(`The layer '${l}' does not exist in the map's style and cannot be filtered.`)))}getFilter(l){const f=this.getLayer(l);return f&&s.clone$1(f.filter)}setLayoutProperty(l,f,_,v={}){this._checkLoaded();const b=this.getLayer(l);b?w(b.getLayoutProperty(f),_)||(b.setLayoutProperty(f,_,v),this._updateLayer(b)):this.fire(new s.ErrorEvent(new Error(`The layer '${l}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(l,f){const _=this.getLayer(l);if(_)return _.getLayoutProperty(f);this.fire(new s.ErrorEvent(new Error(`The layer '${l}' does not exist in the map's style.`)))}setPaintProperty(l,f,_,v={}){this._checkLoaded();const b=this.getLayer(l);b?w(b.getPaintProperty(f),_)||(b.setPaintProperty(f,_,v)&&this._updateLayer(b),this._changed=!0,this._updatedPaintProps[l]=!0):this.fire(new s.ErrorEvent(new Error(`The layer '${l}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(l,f){const _=this.getLayer(l);return _&&_.getPaintProperty(f)}setFeatureState(l,f){this._checkLoaded();const _=l.source,v=l.sourceLayer,b=this.getSource(_);if(!b)return void this.fire(new s.ErrorEvent(new Error(`The source '${_}' does not exist in the map's style.`)));const C=b.type;if(C==="geojson"&&v)return void this.fire(new s.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(C==="vector"&&!v)return void this.fire(new s.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));l.id===void 0&&this.fire(new s.ErrorEvent(new Error("The feature id parameter must be provided.")));const I=this._getSourceCaches(_);for(const P of I)P.setFeatureState(v,l.id,f)}removeFeatureState(l,f){this._checkLoaded();const _=l.source,v=this.getSource(_);if(!v)return void this.fire(new s.ErrorEvent(new Error(`The source '${_}' does not exist in the map's style.`)));const b=v.type,C=b==="vector"?l.sourceLayer:void 0;if(b==="vector"&&!C)return void this.fire(new s.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(f&&typeof l.id!="string"&&typeof l.id!="number")return void this.fire(new s.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const I=this._getSourceCaches(_);for(const P of I)P.removeFeatureState(C,l.id,f)}getFeatureState(l){this._checkLoaded();const f=l.source,_=l.sourceLayer,v=this.getSource(f);if(v){if(v.type!=="vector"||_)return l.id===void 0&&this.fire(new s.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(f)[0].getFeatureState(_,l.id);this.fire(new s.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new s.ErrorEvent(new Error(`The source '${f}' does not exist in the map's style.`)))}getTransition(){return s.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const l={};for(const f in this._sourceCaches){const _=this._sourceCaches[f].getSource();l[_.id]||(l[_.id]=_.serialize())}return s.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.getTerrain()||void 0,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:l,layers:this._serializeLayers(this._order)},f=>f!==void 0)}_updateLayer(l){this._updatedLayers[l.id]=!0;const f=this._getLayerSourceCache(l);l.source&&!this._updatedSources[l.source]&&f&&f.getSource().type!=="raster"&&(this._updatedSources[l.source]="reload",f.pause()),this._changed=!0,l.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(l){const f=C=>this._layers[C].type==="fill-extrusion",_={},v=[];for(let C=this._order.length-1;C>=0;C--){const I=this._order[C];if(f(I)){_[I]=C;for(const P of l){const O=P[I];if(O)for(const k of O)v.push(k)}}}v.sort((C,I)=>I.intersectionZ-C.intersectionZ);const b=[];for(let C=this._order.length-1;C>=0;C--){const I=this._order[C];if(f(I))for(let P=v.length-1;P>=0;P--){const O=v[P].feature;if(_[O.layer.id]<C)break;b.push(O),v.pop()}else for(const P of l){const O=P[I];if(O)for(const k of O)b.push(k.feature)}}return b}queryRenderedFeatures(l,f,_){f&&f.filter&&this._validate(s.validateFilter,"queryRenderedFeatures.filter",f.filter,null,f);const v={};if(f&&f.layers){if(!Array.isArray(f.layers))return this.fire(new s.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const P of f.layers){const O=this._layers[P];if(!O)return this.fire(new s.ErrorEvent(new Error(`The layer '${P}' does not exist in the map's style and cannot be queried for features.`))),[];v[O.source]=!0}}const b=[];f.availableImages=this._availableImages;const C=f&&f.layers?f.layers.some(P=>{const O=this.getLayer(P);return O&&O.is3D()}):this.has3DLayers(),I=Vt.createFromScreenPoints(l,_);for(const P in this._sourceCaches){const O=this._sourceCaches[P].getSource().id;f.layers&&!v[O]||b.push(rr(this._sourceCaches[P],this._layers,this._serializedLayers,I,f,_,C,!!this.map._showQueryGeometry))}return this.placement&&b.push(function(P,O,k,U,W,J,ee){const Q={},te=J.queryRenderedSymbols(U),V=[];for(const K of Object.keys(te).map(Number))V.push(ee[K]);V.sort(wi);for(const K of V){const se=K.featureIndex.lookupSymbolFeatures(te[K.bucketInstanceId],O,K.bucketIndex,K.sourceLayerIndex,W.filter,W.layers,W.availableImages,P);for(const ae in se){const ge=Q[ae]=Q[ae]||[],ve=se[ae];ve.sort((ye,Ie)=>{const Ce=K.featureSortOrder;if(Ce){const Ne=Ce.indexOf(ye.featureIndex);return Ce.indexOf(Ie.featureIndex)-Ne}return Ie.featureIndex-ye.featureIndex});for(const ye of ve)ge.push(ye)}}for(const K in Q)Q[K].forEach(se=>{const ae=se.feature,ge=k(P[K]);if(!ge)return;const ve=ge.getFeatureState(ae.layer["source-layer"],ae.id);ae.source=ae.layer.source,ae.layer["source-layer"]&&(ae.sourceLayer=ae.layer["source-layer"]),ae.state=ve});return Q}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),I.screenGeometry,f,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(b)}querySourceFeatures(l,f){f&&f.filter&&this._validate(s.validateFilter,"querySourceFeatures.filter",f.filter,null,f);const _=this._getSourceCaches(l);let v=[];for(const b of _)v=v.concat(Cr(b,f));return v}addSourceType(l,f,_){return Ns.getSourceType(l)?_(new Error(`A source type called "${l}" already exists.`)):(Ns.setSourceType(l,f),f.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:l,url:f.workerSourceURL},_):_(null,null))}getLight(){return this.light.getLight()}setLight(l,f={}){this._checkLoaded();const _=this.light.getLight();let v=!1;for(const C in l)if(!w(l[C],_[C])){v=!0;break}if(!v)return;const b=this._setTransitionParameters({duration:300,delay:0});this.light.setLight(l,f),this.light.updateTransitions(b)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(l,f=1){if(this._checkLoaded(),!l)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);let _=l;if(f===1){if(typeof _.source=="object"){const v="terrain-dem-src";this.addSource(v,_.source),_=s.clone$1(_),_=s.extend(_,{source:v})}if(this._validate(s.validateTerrain,"terrain",_))return}if(!this.terrain||this.terrain&&f!==this.terrain.drapeRenderMode){if(!_)return;this._createTerrain(_,f)}else{const v=this.terrain,b=v.get();for(const C of Object.keys(s.spec.terrain))!_.hasOwnProperty(C)&&s.spec.terrain[C].default&&(_[C]=s.spec.terrain[C].default);for(const C in _)if(!w(_[C],b[C])){v.set(_),this.stylesheet.terrain=_;const I=this._setTransitionParameters({duration:0});v.updateTransitions(I);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(l){const f=this.fog=new Et(l,this.map.transform);this.stylesheet.fog=l;const _=this._setTransitionParameters({duration:0});f.updateTransitions(_)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const l of this.map._markers)l._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(l){if(this._checkLoaded(),!l)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const f=this.fog,_=f.get();Object.keys(l).length===0&&f.set(l);for(const v in l)if(!w(l[v],_[v])){f.set(l),this.stylesheet.fog=l;const b=this._setTransitionParameters({duration:0});f.updateTransitions(b);break}}else this._createFog(l);this._markersNeedUpdate=!0}_setTransitionParameters(l){return{now:s.exported.now(),transition:s.extend(l,this.stylesheet.transition)}}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const l=this._order.filter(_=>this.isLayerDraped(this._layers[_])),f=this._order.filter(_=>!this.isLayerDraped(this._layers[_]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...l),this._drapedFirstOrder.push(...f)}_createTerrain(l,f){const _=this.terrain=new Pt(l,f);this.stylesheet.terrain=l,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const v=this._setTransitionParameters({duration:0});_.updateTransitions(v)}_force3DLayerUpdate(){for(const l in this._layers){const f=this._layers[l];f.type==="fill-extrusion"&&this._updateLayer(f)}}_forceSymbolLayerUpdate(){for(const l in this._layers){const f=this._layers[l];f.type==="symbol"&&this._updateLayer(f)}}_validate(l,f,_,v,b={}){return(!b||b.validate!==!1)&&ul(this,l.call(s.validateStyle,s.extend({key:f,style:this.serialize(),value:_,styleSpec:s.spec},v)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),s.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const l in this._layers)this._layers[l].setEventedParent(null);for(const l in this._sourceCaches)this._sourceCaches[l].clearTiles(),this._sourceCaches[l].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(l){const f=this._getSourceCaches(l);for(const _ of f)_.clearTiles()}_reloadSource(l){const f=this._getSourceCaches(l);for(const _ of f)_.resume(),_.reload()}_reloadSources(){for(const l of this._getSources())l.reload&&l.reload()}_updateSources(l){for(const f in this._sourceCaches)this._sourceCaches[f].update(l)}_generateCollisionBoxes(){for(const l in this._sourceCaches){const f=this._sourceCaches[l];f.resume(),f.reload()}}_updatePlacement(l,f,_,v,b=!1){let C=!1,I=!1;const P={};for(const O of this._order){const k=this._layers[O];if(k.type!=="symbol")continue;if(!P[k.source]){const W=this._getLayerSourceCache(k);if(!W)continue;P[k.source]=W.getRenderableIds(!0).map(J=>W.getTileByID(J)).sort((J,ee)=>ee.tileID.overscaledZ-J.tileID.overscaledZ||(J.tileID.isLessThan(ee.tileID)?-1:1))}const U=this.crossTileSymbolIndex.addLayer(k,P[k.source],l.center.lng,l.projection);C=C||U}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),b=b||this._layerOrderChanged||_===0,this._layerOrderChanged&&this.fire(new s.Event("neworder")),(b||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(s.exported.now(),l.zoom))&&(this.pauseablePlacement=new Yd(l,this._order,b,f,_,v,this.placement,this.fog&&l.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,P),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(s.exported.now()),I=!0),C&&this.pauseablePlacement.placement.setStale()),I||C)for(const O of this._order){const k=this._layers[O];k.type==="symbol"&&this.placement.updateLayerOpacities(k,P[k.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(s.exported.now())}_releaseSymbolFadeTiles(){for(const l in this._sourceCaches)this._sourceCaches[l].releaseSymbolFadeTiles()}getImages(l,f,_){this.imageManager.getImages(f.icons,_),this._updateTilesForChangedImages();const v=b=>{b&&b.setDependencies(f.tileID.key,f.type,f.icons)};v(this._otherSourceCaches[f.source]),v(this._symbolSourceCaches[f.source])}getGlyphs(l,f,_){this.glyphManager.getGlyphs(f.stacks,_)}getResource(l,f,_){return s.makeRequest(f,_)}_getSourceCache(l){return this._otherSourceCaches[l]}_getLayerSourceCache(l){return l.type==="symbol"?this._symbolSourceCaches[l.source]:this._otherSourceCaches[l.source]}_getSourceCaches(l){const f=[];return this._otherSourceCaches[l]&&f.push(this._otherSourceCaches[l]),this._symbolSourceCaches[l]&&f.push(this._symbolSourceCaches[l]),f}_isSourceCacheLoaded(l){const f=this._getSourceCaches(l);return f.length===0?(this.fire(new s.ErrorEvent(new Error(`There is no source with ID '${l}'`))),!1):f.every(_=>_.loaded())}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Ns.getSourceType=function(m){return Ht[m]},Ns.setSourceType=function(m,l){Ht[m]=l},Ns.registerForPluginStateChange=s.registerForPluginStateChange;var em=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#define EXTENT 8192.0
#define HALF_PI PI/2.0
#define QUARTER_PI PI/4.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0`,Yl="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",va=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}
#ifdef TERRAIN
#ifdef TERRAIN_DEM_FLOAT_FORMAT
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;
#else
uniform sampler2D u_dem;uniform sampler2D u_dem_prev;
#endif
uniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));
#ifdef TERRAIN_DEM_NEAREST_FILTER
return u_exaggeration*tl;
#endif
float tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(
unpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))
);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
float tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;
#else
vec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);
#endif
return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }
#endif`,fh=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,xa=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`;let zf={},Xu={};const ph=[];$u(em,ph),$u(va,ph),$u(fh,ph),$u(xa,ph),zf=Tn("",va),Xu=Tn(xa,fh);const Q_=Tn(`
#if __VERSION__ >=300
#define varying in
#define gl_FragColor glFragColor
#define texture2D texture
#define textureCube texture
out vec4 glFragColor;
#endif
highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}`,`
#if __VERSION__ >=300
#define attribute in
#define varying out
#define texture2D texture
#endif
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered.`),Ff=em,tm=`
#ifdef GL_ES
precision mediump float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`;var nm={background:Tn(`uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
varying vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform vec4 u_color;varying vec4 v_color;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting(u_color);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:Tn(`uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:Tn(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
gl_FragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:Tn("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Tn(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:Tn(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Tn("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:Tn("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}",`attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:Tn("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}",`attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;
#endif
varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:Tn(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:Tn(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:Tn(`uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;varying vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;varying vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:Tn(`uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:Tn(`varying vec4 v_color;
#ifdef RENDER_SHADOWS
varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef ZERO_ROOF_RADIUS
varying vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
varying highp vec3 v_normal;
#endif
void main() {
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
vec3 normal=v_normal;
#endif
float z;vec4 color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);color=mix(v_color,v_roof_color,z);
#else
color=v_color;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);color.rgb=color.rgb*shade;
#endif
#ifdef RENDER_SHADOWS
#ifdef ZERO_ROOF_RADIUS
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#endif
color.xyz=shadowed_color_normal(color.xyz,normalize(normal),v_pos_light_view_0,v_pos_light_view_1,v_depth);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec4 v_color;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;
#endif
#ifdef ZERO_ROOF_RADIUS
varying vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
varying highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
v_normal=normal;
#endif
base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele;vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
v_pos_light_view_0=u_light_matrix_0*vec4(pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1);v_depth=gl_Position.w;
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}v_color=vec4(0.0,0.0,0.0,1.0);
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting(color,NdotL);
#else
v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));
#endif
v_color*=u_opacity;
#ifdef ZERO_ROOF_RADIUS
v_roof_color=vec4(0.0,0.0,0.0,1.0);
#ifdef LIGHTING_3D_MODE
v_roof_color=apply_lighting(color,calculate_NdotL(vec3(0.0,0.0,1.0)));
#else
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));
#endif
v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionPattern:Tn(`uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
varying float v_NdotL;
#endif
varying vec2 v_pos;varying vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,v_NdotL)*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec2 v_pos;varying vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
varying float v_NdotL;
#endif
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_NdotL=NdotL;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),hillshadePrepare:Tn(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
return texture2D(u_image,coord).a/4.0;
#else
vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;
#endif
}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Tn(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
gl_FragColor=apply_lighting(gl_FragColor);
#endif
#ifdef FOG
gl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:Tn(`uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;varying vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
uniform float u_border_width;uniform vec4 u_border_color;float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture2D(u_dash_image,v_tex).a;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture2D(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trimmed=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);trimmed=0.0;}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef RENDER_LINE_ALPHA_DISCARD
if (alpha < u_alpha_discard_threshold) {discard;}
#endif
#ifdef RENDER_LINE_BORDER
float edgeBlur=(u_border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);
#ifdef RENDER_LINE_BORDER_AUTO
float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}
#else
out_color.rgb=mix(u_border_color.rgb*u_border_color.a*trimmed,out_color.rgb,smoothAlpha);
#endif
}
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define EXTRUDE_SCALE 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
attribute highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
attribute float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;varying vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:Tn(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x=mod(v_linesofar/pattern_size.x*aspect,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec4 color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
color=apply_lighting(color);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:Tn(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply(out_color,v_fog_pos));
#endif
gl_FragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),symbolIcon:Tn(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}`),symbolSDF:Tn(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}`),symbolTextAndIcon:Tn(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}`),terrainRaster:Tn(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;
#endif
void main() {vec4 color=texture2D(u_image0,v_pos0);
#ifdef RENDER_SHADOWS
color.xyz=shadowed_color(color.xyz,v_pos_light_view_0,v_pos_light_view_1,v_depth);
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;
#endif
const float wireframeOffset=0.00015;void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;
#ifdef TERRAIN_WIREFRAME
elevation+=wireframeOffset;
#endif
v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;
#endif
}`),terrainDepth:Tn(`#ifdef GL_ES
precision highp float;
#endif
varying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}`,"uniform mat4 u_matrix;attribute vec2 a_pos;varying float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:Tn(`
varying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,Yl),skyboxGradient:Tn(`varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,Yl),skyboxCapture:Tn(`
varying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;
#ifdef GL_ES
precision highp float;
#endif
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}`,"attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Tn(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);color=vec4(raster.rgb*antialias,raster.a*antialias);
#else
color=texture2D(u_image0,v_pos0);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
attribute vec3 a_globe_pos;attribute vec2 a_uv;
#else
attribute vec2 a_pos;
#endif
varying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);
#ifdef TERRAIN_WIREFRAME
height+=wireframeOffset;
#endif
globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:Tn(`uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec3 u_start_color;uniform vec4 u_color;uniform vec4 u_space_color;uniform vec4 u_high_color;uniform float u_star_intensity;uniform float u_star_size;uniform float u_star_density;uniform float u_horizon_angle;uniform mat4 u_rotation_matrix;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;highp float random(highp vec3 p) {p=fract(p*vec3(23.2342,97.1231,91.2342));p+=dot(p.zxy,p.yxz+123.1234);return fract(p.x*p.y);}float stars(vec3 p,float scale,vec2 offset) {vec2 uv_scale=(u_viewport/u_star_size)*scale;vec3 position=vec3(p.xy*uv_scale+offset*u_viewport,p.z);vec3 q=fract(position)-0.5;vec3 id=floor(position);float random_visibility=step(random(id),u_star_density);float circle=smoothstep(0.5+u_star_intensity,0.5,length(q));return circle*random_visibility;}void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {discard;return;}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(dot(dir,horizon_dir)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;float closest_point_to_center=length(closest_point-u_globe_pos);float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c =mix(color_stop_2,c2,t);float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);vec2 uv=gl_FragCoord.xy/u_viewport-0.5;float aspect_ratio=u_viewport.x/u_viewport.y;vec4 uv_dir=vec4(normalize(vec3(uv.x*aspect_ratio,uv.y,1.0)),1.0);uv_dir=u_rotation_matrix*uv_dir;vec3 n=abs(uv_dir.xyz);vec2 uv_remap=(n.x > n.y && n.x > n.z) ? uv_dir.yz/uv_dir.x:
(n.y > n.x && n.y > n.z) ? uv_dir.zx/uv_dir.y:
uv_dir.xy/uv_dir.z;uv_remap.x/=aspect_ratio;vec3 D=vec3(uv_remap,1.0);highp float star_field=0.0;if (u_star_intensity > 0.0) {star_field+=stars(D,1.2,vec2(0.0,0.0));star_field+=stars(D,1.0,vec2(1.0,0.0));star_field+=stars(D,0.8,vec2(0.0,1.0));star_field+=stars(D,0.6,vec2(1.0,1.0));star_field*=(1.0-pow(t,0.25+(1.0-u_high_color.a)*0.75));c+=star_field*alpha_2;}c=dither(c,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=vec4(c,a);}`,`attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`)};function $u(m,l){const f=m.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let _ of f)if(_=_.trim(),_[0]==="#"&&_.includes("if")&&!_.includes("endif")){_=_.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const v=_.split(" ");for(const b of v)l.includes(b)||l.push(b)}}function Tn(m,l){const f=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,_=l.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),v={},b=[...ph];return $u(m,b),$u(l,b),{fragmentSource:m=m.replace(f,(C,I,P,O,k)=>(v[k]=!0,I==="define"?`
#ifndef HAS_UNIFORM_u_${k}
varying ${P} ${O} ${k};
#else
uniform ${P} ${O} u_${k};
#endif
`:`
#ifdef HAS_UNIFORM_u_${k}
    ${P} ${O} ${k} = u_${k};
#endif
`)),vertexSource:l=l.replace(f,(C,I,P,O,k)=>{const U=O==="float"?"vec2":"vec4",W=k.match(/color/)?"color":U;return v[k]?I==="define"?`
#ifndef HAS_UNIFORM_u_${k}
uniform lowp float u_${k}_t;
attribute ${P} ${U} a_${k};
varying ${P} ${O} ${k};
#else
uniform ${P} ${O} u_${k};
#endif
`:W==="vec4"?`
#ifndef HAS_UNIFORM_u_${k}
    ${k} = a_${k};
#else
    ${P} ${O} ${k} = u_${k};
#endif
`:`
#ifndef HAS_UNIFORM_u_${k}
    ${k} = unpack_mix_${W}(a_${k}, u_${k}_t);
#else
    ${P} ${O} ${k} = u_${k};
#endif
`:I==="define"?`
#ifndef HAS_UNIFORM_u_${k}
uniform lowp float u_${k}_t;
attribute ${P} ${U} a_${k};
#else
uniform ${P} ${O} u_${k};
#endif
`:W==="vec4"?`
#ifndef HAS_UNIFORM_u_${k}
    ${P} ${O} ${k} = a_${k};
#else
    ${P} ${O} ${k} = u_${k};
#endif
`:`
#ifndef HAS_UNIFORM_u_${k}
    ${P} ${O} ${k} = unpack_mix_${W}(a_${k}, u_${k}_t);
#else
    ${P} ${O} ${k} = u_${k};
#endif
`}),staticAttributes:_,usedDefines:b}}class Ux{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(l,f,_,v,b,C,I){this.context=l;let P=this.boundPaintVertexBuffers.length!==v.length;for(let k=0;!P&&k<v.length;k++)this.boundPaintVertexBuffers[k]!==v[k]&&(P=!0);let O=this.boundDynamicVertexBuffers.length!==I.length;for(let k=0;!O&&k<I.length;k++)this.boundDynamicVertexBuffers[k]!==I[k]&&(O=!0);if(!l.extVertexArrayObject||!this.vao||this.boundProgram!==f||this.boundLayoutVertexBuffer!==_||P||O||this.boundIndexBuffer!==b||this.boundVertexOffset!==C)this.freshBind(f,_,v,b,C,I);else{l.bindVertexArrayOES.set(this.vao);for(const k of I)k&&k.bind();b&&b.dynamicDraw&&b.bind()}}freshBind(l,f,_,v,b,C){let I;const P=l.numAttributes,O=this.context,k=O.gl;if(O.extVertexArrayObject)this.vao&&this.destroy(),this.vao=O.extVertexArrayObject.createVertexArrayOES(),O.bindVertexArrayOES.set(this.vao),I=0,this.boundProgram=l,this.boundLayoutVertexBuffer=f,this.boundPaintVertexBuffers=_,this.boundIndexBuffer=v,this.boundVertexOffset=b,this.boundDynamicVertexBuffers=C;else{I=O.currentNumAttributes||0;for(let U=P;U<I;U++)k.disableVertexAttribArray(U)}f.enableAttributes(k,l),f.bind(),f.setVertexAttribPointers(k,l,b);for(const U of _)U.enableAttributes(k,l),U.bind(),U.setVertexAttribPointers(k,l,b);for(const U of C)U&&(U.enableAttributes(k,l),U.bind(),U.setVertexAttribPointers(k,l,b));v&&v.bind(),O.currentNumAttributes=P}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function rm(m,l){const f=Math.pow(2,l.canonical.z),_=l.canonical.y;return[new s.MercatorCoordinate(0,_/f).toLngLat().lat,new s.MercatorCoordinate(0,(_+1)/f).toLngLat().lat]}function ey(m,l,f,_,v,b,C){const I=m.context,P=I.gl,O=f.fbo;if(!O)return;m.prepareDrawTile();const k=m.useProgram("hillshade");I.activeTexture.set(P.TEXTURE0),P.bindTexture(P.TEXTURE_2D,O.colorAttachment.get());const U=((Q,te,V,K)=>{const se=V.paint.get("hillshade-shadow-color"),ae=V.paint.get("hillshade-highlight-color"),ge=V.paint.get("hillshade-accent-color");let ve=V.paint.get("hillshade-illumination-direction")*(Math.PI/180);V.paint.get("hillshade-illumination-anchor")==="viewport"&&(ve-=Q.transform.angle);const ye=!Q.options.moving;return{u_matrix:K||Q.transform.calculateProjMatrix(te.tileID.toUnwrapped(),ye),u_image:0,u_latrange:rm(0,te.tileID),u_light:[V.paint.get("hillshade-exaggeration"),ve],u_shadow:se,u_highlight:ae,u_accent:ge}})(m,f,_,m.terrain?l.projMatrix:null);m.prepareDrawProgram(I,k,l.toUnwrapped());const{tileBoundsBuffer:W,tileBoundsIndexBuffer:J,tileBoundsSegments:ee}=m.getTileBoundsBuffers(f);k.draw(I,P.TRIANGLES,v,b,C,s.CullFaceMode.disabled,U,_.id,W,J,ee)}function im(m,l,f){if(!l.needsDEMTextureUpload)return;const _=m.context,v=_.gl;_.pixelStoreUnpackPremultiplyAlpha.set(!1),l.demTexture=l.demTexture||m.getTileTexture(f.stride);const b=f.getPixels();l.demTexture?l.demTexture.update(b,{premultiply:!1}):l.demTexture=new s.Texture(_,b,v.RGBA,{premultiply:!1}),l.needsDEMTextureUpload=!1}function ty(m,l,f,_,v,b){const C=m.context,I=C.gl;if(!l.dem)return;const P=l.dem;if(C.activeTexture.set(I.TEXTURE1),im(m,l,P),!l.demTexture)return;l.demTexture.bind(I.NEAREST,I.CLAMP_TO_EDGE);const O=P.dim;C.activeTexture.set(I.TEXTURE0);let k=l.fbo;if(!k){const ee=new s.Texture(C,{width:O,height:O,data:null},I.RGBA);ee.bind(I.LINEAR,I.CLAMP_TO_EDGE),k=l.fbo=C.createFramebuffer(O,O,!0),k.colorAttachment.set(ee.texture)}C.bindFramebuffer.set(k.framebuffer),C.viewport.set([0,0,O,O]);const{tileBoundsBuffer:U,tileBoundsIndexBuffer:W,tileBoundsSegments:J}=m.getMercatorTileBoundsBuffers();m.useProgram("hillshadePrepare").draw(C,I.TRIANGLES,_,v,b,s.CullFaceMode.disabled,((ee,Q)=>{const te=Q.stride,V=s.create();return s.ortho(V,0,s.EXTENT,-s.EXTENT,0,0,1),s.translate(V,V,[0,-s.EXTENT,0]),{u_matrix:V,u_image:1,u_dimension:[te,te],u_zoom:ee.overscaledZ,u_unpack:Q.unpackVector}})(l.tileID,P),f.id,U,W,J),l.needsHillshadePrepare=!1}const om=m=>({u_matrix:new s.UniformMatrix4f(m),u_image0:new s.Uniform1i(m),u_skirt_height:new s.Uniform1f(m)}),Zu=(m,l)=>({u_matrix:m,u_image0:0,u_skirt_height:l}),Bf=(m,l,f,_,v,b,C,I,P,O,k,U,W,J,ee)=>({u_proj_matrix:Float32Array.from(m),u_globe_matrix:l,u_normalize_matrix:Float32Array.from(_),u_merc_matrix:f,u_zoom_transition:v,u_merc_center:b,u_image0:0,u_frustum_tl:C,u_frustum_tr:I,u_frustum_br:P,u_frustum_bl:O,u_globe_pos:k,u_globe_radius:U,u_viewport:W,u_grid_matrix:ee?Float32Array.from(ee):new Float32Array(9),u_skirt_height:J});function Wu(m,l){return m!=null&&l!=null&&!(!m.hasData()||!l.hasData())&&m.demTexture!=null&&l.demTexture!=null&&m.tileID.key!==l.tileID.key}const wa=new class{constructor(){this.operations={}}newMorphing(m,l,f,_,v){if(m in this.operations){const b=this.operations[m];b.to.tileID.key!==f.tileID.key&&(b.queued=f)}else this.operations[m]={startTime:_,phase:0,duration:v,from:l,to:f,queued:null}}getMorphValuesForProxy(m){if(!(m in this.operations))return null;const l=this.operations[m];return{from:l.from,to:l.to,phase:l.phase}}update(m){for(const l in this.operations){const f=this.operations[l];for(f.phase=(m-f.startTime)/f.duration;f.phase>=1||!this._validOp(f);)if(!this._nextOp(f,m)){delete this.operations[l];break}}}_nextOp(m,l){return!!m.queued&&(m.from=m.to,m.to=m.queued,m.queued=null,m.phase=0,m.startTime=l,!0)}_validOp(m){return m.from.hasData()&&m.to.hasData()}},Kl={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function Uf(m){return 6*Math.pow(1.5,22-m)}function ny(m,l){const f=1<<m.z;return!l&&(m.x===0||m.x===f-1)||m.y===0||m.y===f-1}const dh=m=>({u_matrix:m});function sm(m,l,f,_,v){if(v>0){const b=s.exported.now(),C=(b-m.timeAdded)/v,I=l?(b-l.timeAdded)/v:-1,P=f.getSource(),O=_.coveringZoomLevel({tileSize:P.tileSize,roundZoom:P.roundZoom}),k=!l||Math.abs(l.tileID.overscaledZ-O)>Math.abs(m.tileID.overscaledZ-O),U=k&&m.refreshedUponExpiration?1:s.clamp(k?C:1-I,0,1);return m.refreshedUponExpiration&&C>=1&&(m.refreshedUponExpiration=!1),l?{opacity:1,mix:1-U}:{opacity:U,mix:0}}return{opacity:1,mix:0}}class am extends s.SourceCache{constructor(l){const f={type:"raster-dem",maxzoom:l.transform.maxZoom},_=new Ct(Vu(),null),v=tn("mock-dem",f,_,l.style);super("mock-dem",v,!1),v.setEventedParent(this),this._sourceLoaded=!0}_loadTile(l,f){l.state="loaded",f(null)}}class Vf extends s.SourceCache{constructor(l){const f=tn("proxy",{type:"geojson",maxzoom:l.transform.maxZoom},new Ct(Vu(),null),l.style);super("proxy",f,!1),f.setEventedParent(this),this.map=this.getSource().map=l,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(l,f,_){if(l.freezeTileCoverage)return;this.transform=l;const v=l.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((b,C)=>{if(b[C.key]="",!this._tiles[C.key]){const I=new s.Tile(C,this._source.tileSize*C.overscaleFactor(),l.tileZoom);I.state="loaded",this._tiles[C.key]=I}return b},{});for(const b in this._tiles)b in v||(this.freeFBO(b),this._tiles[b].unloadVectorData(),delete this._tiles[b])}freeFBO(l){const f=this.proxyCachedFBO[l];if(f!==void 0){const _=Object.values(f);this.renderCachePool.push(..._),delete this.proxyCachedFBO[l]}}deallocRenderCache(){this.renderCache.forEach(l=>l.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class jf extends s.OverscaledTileID{constructor(l,f,_){super(l.overscaledZ,l.wrap,l.canonical.z,l.canonical.x,l.canonical.y),this.proxyTileKey=f,this.projMatrix=_}}class lm extends s.Elevation{constructor(l,f){super(),this.painter=l,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[_,v,b]=function(P){const O=new s.StructArrayLayout2i4,k=new s.StructArrayLayout3ui6,U=131;O.reserve(17161),k.reserve(33800);const W=s.EXTENT/128,J=s.EXTENT+W/2,ee=J+W;for(let te=-W;te<ee;te+=W)for(let V=-W;V<ee;V+=W){const K=V<0||V>J||te<0||te>J?24575:0,se=s.clamp(Math.round(V),0,s.EXTENT),ae=s.clamp(Math.round(te),0,s.EXTENT);O.emplaceBack(se+K,ae)}const Q=(te,V)=>{const K=V*U+te;k.emplaceBack(K+1,K,K+U),k.emplaceBack(K+U,K+U+1,K+1)};for(let te=1;te<129;te++)for(let V=1;V<129;V++)Q(V,te);return[0,129].forEach(te=>{for(let V=0;V<130;V++)Q(V,te),Q(te,V)}),[O,k,32768]}(),C=l.context;this.gridBuffer=C.createVertexBuffer(_,s.posAttributes.members),this.gridIndexBuffer=C.createIndexBuffer(v),this.gridSegments=s.SegmentVector.simpleSegment(0,0,_.length,v.length),this.gridNoSkirtSegments=s.SegmentVector.simpleSegment(0,0,_.length,b),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Vf(f.map),this.orthoMatrix=s.create(),s.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,s.EXTENT,0,s.EXTENT,0,1);const I=C.gl;this._overlapStencilMode=new s.StencilMode({func:I.GEQUAL,mask:255},0,255,I.KEEP,I.KEEP,I.REPLACE),this._previousZoom=l.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=f,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new am(f.map)}set style(l){l.on("data",this._onStyleDataEvent.bind(this)),l.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=l,this._checkRenderCacheEfficiency(),this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(l,f,_){if(l&&l.terrain){this._style!==l&&(this.style=l),this.enabled=!0;const v=l.terrain.properties;this.sourceCache=l.terrain.drapeRenderMode===0?this._mockSourceCache:l._getSourceCache(v.get("source")),this._exaggeration=v.get("exaggeration");const b=()=>{this.sourceCache.used&&s.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const C=this.getScaledDemTileSize();this.sourceCache.update(f,C,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,b(),this._initializing=!0),b(),f.updateElevation(!0,_),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(f),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(l){this._findCoveringTileCache[l]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const l=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||l.efficiency!==100&&s.warnOnce(`Terrain render cache efficiency is not optimal (${l.efficiency}%) and performance
                may be affected negatively, consider placing all background, fill and line layers before layer
                with id '${l.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(l){l.coord&&l.dataType==="source"?this._clearRenderCacheForTile(l.sourceCacheId,l.coord):l.dataType==="style"&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const l in this._style._sourceCaches)this._style._sourceCaches[l].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(l=>l.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const l=2*this.proxySourceCache.getSource().tileSize;return[l,l]}set useVertexMorphing(l){this._useVertexMorphing=l}updateTileBinding(l){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const f=this.proxySourceCache,_=this.painter.transform;this._initializing&&(this._initializing=_._centerAltitude===0&&this.getAtPointOrZero(s.MercatorCoordinate.fromLngLat(_.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const v=this.proxyCoords=f.getIds().map(P=>{const O=f.getTileByID(P).tileID;return O.projMatrix=_.calculateProjMatrix(O.toUnwrapped()),O});(function(P,O){const k=O.transform.pointCoordinate(O.transform.getCameraPoint()),U=new s.Point(k.x,k.y);P.sort((W,J)=>{if(J.overscaledZ-W.overscaledZ)return J.overscaledZ-W.overscaledZ;const ee=new s.Point(W.canonical.x+(1<<W.canonical.z)*W.wrap,W.canonical.y),Q=new s.Point(J.canonical.x+(1<<J.canonical.z)*J.wrap,J.canonical.y),te=U.mult(1<<W.canonical.z);return te.x-=.5,te.y-=.5,te.distSqr(ee)-te.distSqr(Q)})})(v,this.painter),this._previousZoom=_.zoom;const b=this.proxyToSource||{};this.proxyToSource={},v.forEach(P=>{this.proxyToSource[P.key]={}}),this.terrainTileForTile={};const C=this._style._sourceCaches;for(const P in C){const O=C[P];if(!O.used||(O!==this.sourceCache&&this.resetTileLookupCache(O.id),this._setupProxiedCoordsForOrtho(O,l[P],b),O.usedForTerrain))continue;const k=l[P];O.getSource().reparseOverscaled&&this._assignTerrainTiles(k)}this.proxiedCoords[f.id]=v.map(P=>new jf(P,P.key,this.orthoMatrix)),this._assignTerrainTiles(v),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(b),this.renderingToTexture=!1,this._updateTimestamp=s.exported.now();const I={};this._visibleDemTiles=[];for(const P of this.proxyCoords){const O=this.terrainTileForTile[P.key];if(!O)continue;const k=O.tileID.key;k in I||(this._visibleDemTiles.push(O),I[k]=k)}}_assignTerrainTiles(l){this._initializing||l.forEach(f=>{if(this.terrainTileForTile[f.key])return;const _=this._findTileCoveringTileID(f,this.sourceCache);_&&(this.terrainTileForTile[f.key]=_)})}_prepareDEMTextures(){const l=this.painter.context,f=l.gl;for(const _ in this.terrainTileForTile){const v=this.terrainTileForTile[_],b=v.dem;!b||v.demTexture&&!v.needsDEMTextureUpload||(l.activeTexture.set(f.TEXTURE1),im(this.painter,v,b))}}_prepareDemTileUniforms(l,f,_,v){if(!f||f.demTexture==null)return!1;const b=l.tileID.canonical,C=Math.pow(2,f.tileID.canonical.z-b.z),I=v||"";return _[`u_dem_tl${I}`]=[b.x*C%1,b.y*C%1],_[`u_dem_scale${I}`]=C,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const l=this.painter.context,f=l.gl;if(!this._emptyDepthBufferTexture){const _=new s.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new s.Texture(l,_,f.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let l=0;const f=this._visibleDemTiles.reduce((_,v)=>{if(!v.dem)return _;const b=v.dem.tree.minimums[0];return b>0&&l++,_+b},0);return l?f/l:0}_updateEmptyDEMTexture(){const l=this.painter.context,f=l.gl;l.activeTexture.set(f.TEXTURE2);const _=this._getLoadedAreaMinimum(),v=new s.RGBAImage({width:1,height:1},new Uint8Array(s.DEMData.pack(_,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let b=this._emptyDEMTexture;return b?b.update(v,{premultiply:!1}):b=this._emptyDEMTexture=new s.Texture(l,v,f.RGBA,{premultiply:!1}),b}setupElevationDraw(l,f,_){const v=this.painter.context,b=v.gl,C=(I=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:s.DEMData.getUnpackVector(I),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0});var I;C.u_dem_size=this.sourceCache.getSource().tileSize,C.u_exaggeration=this.exaggeration();let P=null,O=null,k=1;if(_&&_.morphing&&this._useVertexMorphing){const U=_.morphing.srcDemTile,W=_.morphing.dstDemTile;k=_.morphing.phase,U&&W&&(this._prepareDemTileUniforms(l,U,C,"_prev")&&(O=U),this._prepareDemTileUniforms(l,W,C)&&(P=W))}if(O&&P?(v.activeTexture.set(b.TEXTURE2),P.demTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE,b.NEAREST),v.activeTexture.set(b.TEXTURE4),O.demTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE,b.NEAREST),C.u_dem_lerp=k):(P=this.terrainTileForTile[l.tileID.key],v.activeTexture.set(b.TEXTURE2),(this._prepareDemTileUniforms(l,P,C)?P.demTexture:this.emptyDEMTexture).bind(b.NEAREST,b.CLAMP_TO_EDGE)),v.activeTexture.set(b.TEXTURE3),_&&_.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE),this._depthFBO&&(C.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE),C.u_depth_size_inv=[1,1]),_&&_.useMeterToDem&&P){const U=(1<<P.tileID.canonical.z)*s.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;C.u_meter_to_dem=U}if(_&&_.labelPlaneMatrixInv&&(C.u_label_plane_matrix_inv=_.labelPlaneMatrixInv),f.setTerrainUniformValues(v,C),this.painter.transform.projection.name==="globe"){const U=this.globeUniformValues(this.painter.transform,l.tileID.canonical,_&&_.useDenormalizedUpVectorScale);f.setGlobeUniformValues(v,U)}}globeUniformValues(l,f,_){const v=l.projection;return{u_tile_tl_up:v.upVector(f,0,0),u_tile_tr_up:v.upVector(f,s.EXTENT,0),u_tile_br_up:v.upVector(f,s.EXTENT,s.EXTENT),u_tile_bl_up:v.upVector(f,0,s.EXTENT),u_tile_up_scale:_?s.globeMetersToEcef(1):v.upVectorScale(f,l.center.lat,l.worldSize).metersToTile}}renderToBackBuffer(l){const f=this.painter,_=this.painter.context;l.length!==0&&(_.bindFramebuffer.set(null),_.viewport.set([0,0,f.width,f.height]),f.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(v,b,C,I,P){if(v.transform.projection.name==="globe")(function(O,k,U,W,J){const ee=O.context,Q=ee.gl;let te,V;const K=O.options.showTerrainWireframe?2:0,se=O.transform,ae=s.globeUseCustomAntiAliasing(O,ee,se),ge=(nt,Re)=>{if(V===nt)return;const Ze=[Kl[nt],"PROJECTION_GLOBE_VIEW"];ae&&Ze.push("CUSTOM_ANTIALIASING"),Re&&Ze.push(Kl[K]),te=O.useProgram("globeRaster",null,Ze),V=nt},ve=O.colorModeForRenderPass(),ye=new s.DepthMode(Q.LEQUAL,s.DepthMode.ReadWrite,O.depthRangeFor3D);wa.update(J);const Ie=s.calculateGlobeMercatorMatrix(se),Ce=[s.mercatorXfromLng(se.center.lng),s.mercatorYfromLat(se.center.lat)],Ne=K?[!1,!0]:[!1],rt=O.globeSharedBuffers,Le=[se.width*s.exported.devicePixelRatio,se.height*s.exported.devicePixelRatio],Ye=Float32Array.from(se.globeMatrix),Fe={useDenormalizedUpVectorScale:!0};if(Ne.forEach(nt=>{const Re=O.transform,Ze=Uf(Re.zoom)*k.exaggeration();V=-1;const ot=nt?Q.LINES:Q.TRIANGLES;for(const Qe of W){const st=U.getTile(Qe),Mt=s.StencilMode.disabled,jt=k.prevTerrainTileForTile[Qe.key],St=k.terrainTileForTile[Qe.key];Wu(jt,St)&&wa.newMorphing(Qe.key,jt,St,J,250),ee.activeTexture.set(Q.TEXTURE0),st.texture.bind(Q.LINEAR,Q.CLAMP_TO_EDGE);const Ot=wa.getMorphValuesForProxy(Qe.key),an=Ot?1:0;Ot&&s.extend$1(Fe,{morphing:{srcDemTile:Ot.from,dstDemTile:Ot.to,phase:s.easeCubicInOut(Ot.phase)}});const nn=s.tileCornersToBounds(Qe.canonical),It=s.getLatitudinalLod(nn.getCenter().lat),In=s.getGridMatrix(Qe.canonical,nn,It,Re.worldSize/Re._pixelsPerMercatorPixel),Dn=s.globeNormalizeECEF(s.globeTileBounds(Qe.canonical)),Rn=Bf(Re.projMatrix,Ye,Ie,Dn,s.globeToMercatorTransition(Re.zoom),Ce,Re.frustumCorners.TL,Re.frustumCorners.TR,Re.frustumCorners.BR,Re.frustumCorners.BL,Re.globeCenterInViewSpace,Re.globeRadius,Le,Ze,In);if(ge(an,nt),k.setupElevationDraw(st,te,Fe),O.prepareDrawProgram(ee,te,Qe.toUnwrapped()),rt){const[Nn,Ei,ti]=nt?rt.getWirefameBuffers(O.context,It):rt.getGridBuffers(It,Ze!==0);te.draw(ee,ot,ye,Mt,ve,s.CullFaceMode.backCCW,Rn,"globe_raster",Nn,Ei,ti)}}}),rt){const nt=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];ae&&nt.push("CUSTOM_ANTIALIASING"),te=O.useProgram("globeRaster",null,nt);for(const Re of W){const{x:Ze,y:ot,z:Qe}=Re.canonical,st=ot===0,Mt=ot===(1<<Qe)-1,[jt,St,Ot,an]=rt.getPoleBuffers(Qe);if(an&&(st||Mt)){const nn=U.getTile(Re);ee.activeTexture.set(Q.TEXTURE0),nn.texture.bind(Q.LINEAR,Q.CLAMP_TO_EDGE);let It=s.globePoleMatrixForTile(Qe,Ze,se);const In=s.globeNormalizeECEF(s.globeTileBounds(Re.canonical)),Dn=(Rn,Nn)=>Rn.draw(ee,Q.TRIANGLES,ye,s.StencilMode.disabled,ve,s.CullFaceMode.disabled,Bf(se.projMatrix,It,It,In,0,Ce,se.frustumCorners.TL,se.frustumCorners.TR,se.frustumCorners.BR,se.frustumCorners.BL,se.globeCenterInViewSpace,se.globeRadius,Le,0),"globe_pole_raster",Nn,Ot,an);k.setupElevationDraw(nn,te,Fe),O.prepareDrawProgram(ee,te,Re.toUnwrapped()),st&&Dn(te,jt),Mt&&(It=s.scale(s.create(),It,[1,-1,1]),Dn(te,St))}}}})(v,b,C,I,P);else{const O=v.context,k=O.gl;let U,W;const J=v.options.showTerrainWireframe?2:0,ee=(se,ae)=>{if(W===se)return;const ge=[Kl[se]];ae&&ge.push(Kl[J]),U=v.useProgram("terrainRaster",null,ge),W=se},Q=v.colorModeForRenderPass(),te=new s.DepthMode(k.LEQUAL,s.DepthMode.ReadWrite,v.depthRangeFor3D);wa.update(P);const V=v.transform,K=Uf(V.zoom)*b.exaggeration();(J?[!1,!0]:[!1]).forEach(se=>{W=-1;const ae=se?k.LINES:k.TRIANGLES,[ge,ve]=se?b.getWirefameBuffer():[b.gridIndexBuffer,b.gridSegments];for(const ye of I){const Ie=C.getTile(ye),Ce=s.StencilMode.disabled,Ne=b.prevTerrainTileForTile[ye.key],rt=b.terrainTileForTile[ye.key];Wu(Ne,rt)&&wa.newMorphing(ye.key,Ne,rt,P,250),O.activeTexture.set(k.TEXTURE0),Ie.texture.bind(k.LINEAR,k.CLAMP_TO_EDGE,k.LINEAR_MIPMAP_NEAREST);const Le=wa.getMorphValuesForProxy(ye.key),Ye=Le?1:0;let Fe;Le&&(Fe={morphing:{srcDemTile:Le.from,dstDemTile:Le.to,phase:s.easeCubicInOut(Le.phase)}});const nt=Zu(ye.projMatrix,ny(ye.canonical,V.renderWorldCopies)?K/10:K);ee(Ye,se),b.setupElevationDraw(Ie,U,Fe),v.prepareDrawProgram(O,U,ye.toUnwrapped()),U.draw(O,ae,te,Ce,Q,s.CullFaceMode.backCCW,nt,"terrain_raster",b.gridBuffer,ge,ve)}})}}(f,this,this.proxySourceCache,l,this._updateTimestamp),this.renderingToTexture=!0,f.gpuTimingDeferredRenderEnd(),l.splice(0,l.length))}renderBatch(l){if(this._drapedRenderBatches.length===0)return l+1;this.renderingToTexture=!0;const f=this.painter,_=this.painter.context,v=this.proxySourceCache,b=this.proxiedCoords[v.id],C=this._drapedRenderBatches.shift(),I=[],P=f.style.order;let O=0;for(const k of b){const U=v.getTileByID(k.proxyTileKey),W=v.proxyCachedFBO[k.key]?v.proxyCachedFBO[k.key][l]:void 0,J=W!==void 0?v.renderCache[W]:this.pool[O++],ee=W!==void 0;if(U.texture=J.tex,ee&&!J.dirty){I.push(U.tileID);continue}let Q;_.bindFramebuffer.set(J.fb.framebuffer),this.renderedToTile=!1,J.dirty&&(_.clear({color:s.Color.transparent,stencil:0}),J.dirty=!1);for(let te=C.start;te<=C.end;++te){const V=f.style._layers[P[te]];if(V.isHidden(f.transform.zoom))continue;const K=f.style._getLayerSourceCache(V),se=K?this.proxyToSource[k.key][K.id]:[k];if(!se)continue;const ae=se;_.viewport.set([0,0,J.fb.width,J.fb.height]),Q!==(K?K.id:null)&&(this._setupStencil(J,se,V,K),Q=K?K.id:null),f.renderLayer(f,K,V,ae)}this.renderedToTile?(J.dirty=!0,I.push(U.tileID)):ee||--O,O===5&&(O=0,this.renderToBackBuffer(I))}return this.renderToBackBuffer(I),this.renderingToTexture=!1,_.bindFramebuffer.set(null),_.viewport.set([0,0,f.width,f.height]),C.end+1}postRender(){}renderCacheEfficiency(l){const f=l.order.length;if(f===0)return{efficiency:100};let _,v=0,b=0,C=!1;for(let I=0;I<f;++I){const P=l._layers[l.order[I]];this._style.isLayerDraped(P)?(C&&++v,++b):C||(C=!0,_=P.id)}return b===0?{efficiency:100}:{efficiency:100*(1-v/b),firstUndrapedLayer:_}}getMinElevationBelowMSL(){let l=0;return this._visibleDemTiles.filter(f=>f.dem).forEach(f=>{l=Math.min(l,f.dem.tree.minimums[0])}),l===0?l:(l-30)*this._exaggeration}raycast(l,f,_){if(!this._visibleDemTiles)return null;const v=this._visibleDemTiles.filter(b=>b.dem).map(b=>{const C=b.tileID,I=1<<C.overscaledZ,{x:P,y:O}=C.canonical,k=P/I,U=(P+1)/I,W=O/I,J=(O+1)/I;return{minx:k,miny:W,maxx:U,maxy:J,t:b.dem.tree.raycastRoot(k,W,U,J,l,f,_),tile:b}});v.sort((b,C)=>(b.t!==null?b.t:Number.MAX_VALUE)-(C.t!==null?C.t:Number.MAX_VALUE));for(const b of v){if(b.t==null)return null;const C=b.tile.dem.tree.raycast(b.minx,b.miny,b.maxx,b.maxy,l,f,_);if(C!=null)return C}return null}_createFBO(){const l=this.painter.context,f=l.gl,_=this.drapeBufferSize;l.activeTexture.set(f.TEXTURE0);const v=new s.Texture(l,{width:_[0],height:_[1],data:null},f.RGBA);v.bind(f.LINEAR,f.CLAMP_TO_EDGE);const b=l.createFramebuffer(_[0],_[1],!1);return b.colorAttachment.set(v.texture),b.depthAttachment=new be(l,b.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=l.createRenderbuffer(l.gl.DEPTH_STENCIL,_[0],_[1]),this._stencilRef=0,b.depthAttachment.set(this._sharedDepthStencil),l.clear({stencil:0})):b.depthAttachment.set(this._sharedDepthStencil),l.extTextureFilterAnisotropic&&!l.extTextureFilterAnisotropicForceOff&&f.texParameterf(f.TEXTURE_2D,l.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,l.extTextureFilterAnisotropicMax),{fb:b,tex:v,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const l in this._style._sourceCaches)if(this._style._sourceCaches[l].hasTransition())return!0;return this._style.order.some(l=>{const f=this._style._layers[l],_=f.isHidden(this.painter.transform.zoom);return f.type==="custom"?!_&&f.shouldRedrape():!_&&f.hasTransition()})}_clearLineLayersFromRenderCache(){let l=!1;for(const _ of this._style._getSources())if(_ instanceof ft){l=!0;break}if(!l)return;const f={};for(let _=0;_<this._style.order.length;++_){const v=this._style._layers[this._style.order[_]],b=this._style._getLayerSourceCache(v);if(b&&!f[b.id]&&!v.isHidden(this.painter.transform.zoom)&&v.type==="line"&&v.widthExpression()instanceof s.ZoomDependentExpression){f[b.id]=!0;for(const C of this.proxyCoords){const I=this.proxyToSource[C.key][b.id];if(I)for(const P of I)this._clearRenderCacheForTile(b.id,P)}}}}_clearRasterLayersFromRenderCache(){let l=!1;for(const _ in this._style._sourceCaches)if(this._style._sourceCaches[_]._source instanceof at){l=!0;break}if(!l)return;const f={};for(let _=0;_<this._style.order.length;++_){const v=this._style._layers[this._style.order[_]],b=this._style._getLayerSourceCache(v);if(!b||f[b.id]||v.isHidden(this.painter.transform.zoom)||v.type!=="raster")continue;const C=v.paint.get("raster-fade-duration");for(const I of this.proxyCoords){const P=this.proxyToSource[I.key][b.id];if(P)for(const O of P){const k=sm(b.getTile(O),b.findLoadedParent(O,0),b,this.painter.transform,C);(k.opacity!==1||k.mix!==0)&&this._clearRenderCacheForTile(b.id,O)}}}}_setupDrapedRenderBatches(){const l=this._style.order,f=l.length;if(f===0)return;const _=[];let v,b=0,C=this._style._layers[l[b]];for(;!this._style.isLayerDraped(C)&&C.isHidden(this.painter.transform.zoom)&&++b<f;)C=this._style._layers[l[b]];for(;b<f;++b){const I=this._style._layers[l[b]];I.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(I)?v===void 0&&(v=b):v!==void 0&&(_.push({start:v,end:b-1}),v=void 0))}v!==void 0&&_.push({start:v,end:b-1}),this._drapedRenderBatches=_}_setupRenderCache(l){const f=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,f.renderCache.length>f.renderCachePool.length){const C=Object.values(f.proxyCachedFBO);f.proxyCachedFBO={};for(let I=0;I<C.length;++I){const P=Object.values(C[I]);f.renderCachePool.push(...P)}}return}this._clearRasterLayersFromRenderCache();const _=this.proxyCoords,v=this._tilesDirty;for(let C=_.length-1;C>=0;C--){const I=_[C];if(f.getTileByID(I.key),f.proxyCachedFBO[I.key]!==void 0){const P=l[I.key],O=this.proxyToSource[I.key];let k=0;for(const U in O){const W=O[U],J=P[U];if(!J||J.length!==W.length||W.some((ee,Q)=>ee!==J[Q]||v[U]&&v[U].hasOwnProperty(ee.key))){k=-1;break}++k}for(const U in f.proxyCachedFBO[I.key])f.renderCache[f.proxyCachedFBO[I.key][U]].dirty=k<0||k!==Object.values(P).length}}const b=[...this._drapedRenderBatches];b.sort((C,I)=>I.end-I.start-(C.end-C.start));for(const C of b)for(const I of _){if(f.proxyCachedFBO[I.key])continue;let P=f.renderCachePool.pop();P===void 0&&f.renderCache.length<50&&(P=f.renderCache.length,f.renderCache.push(this._createFBO())),P!==void 0&&(f.proxyCachedFBO[I.key]={},f.proxyCachedFBO[I.key][C.start]=P,f.renderCache[P].dirty=!0)}this._tilesDirty={}}_setupStencil(l,f,_,v){if(!v||!this._sourceTilesOverlap[v.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const b=this.painter.context,C=b.gl;if(f.length<=1)return void(this._overlapStencilType=!1);let I;if(_.isTileClipped())I=f.length,this._overlapStencilMode.test={func:C.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(f[0].overscaledZ>f[f.length-1].overscaledZ))return void(this._overlapStencilType=!1);I=1,this._overlapStencilMode.test={func:C.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+I>255&&(b.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=I,this._overlapStencilMode.ref=this._stencilRef,_.isTileClipped()&&this._renderTileClippingMasks(f,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(l){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[l.key]),this._overlapStencilMode):s.StencilMode.disabled}_renderTileClippingMasks(l,f){const _=this.painter,v=this.painter.context,b=v.gl;_._tileClippingMaskIDs={},v.setColorMode(s.ColorMode.disabled),v.setDepthMode(s.DepthMode.disabled);const C=_.useProgram("clippingMask");for(const I of l){const P=_._tileClippingMaskIDs[I.key]=--f;C.draw(v,b.TRIANGLES,s.DepthMode.disabled,new s.StencilMode({func:b.ALWAYS,mask:0},P,255,b.KEEP,b.KEEP,b.REPLACE),s.ColorMode.disabled,s.CullFaceMode.disabled,dh(I.projMatrix),"$clipping",_.tileExtentBuffer,_.quadTriangleIndexBuffer,_.tileExtentSegments)}}pointCoordinate(l){const f=this.painter.transform;if(l.x<0||l.x>f.width||l.y<0||l.y>f.height)return null;const _=[l.x,l.y,1,1];s.transformMat4$1(_,_,f.pixelMatrixInverse),s.scale$1(_,_,1/_[3]),_[0]/=f.worldSize,_[1]/=f.worldSize;const v=f._camera.position,b=s.mercatorZfromAltitude(1,f.center.lat),C=[v[0],v[1],v[2]/b,0],I=s.subtract([],_.slice(0,3),C);s.normalize(I,I);const P=this.raycast(C,I,this._exaggeration);return P!==null&&P?(s.scaleAndAdd(C,C,I,P),C[3]=C[2],C[2]*=b,C):null}drawDepth(){const l=this.painter,f=l.context,_=this.proxySourceCache,v=Math.ceil(l.width),b=Math.ceil(l.height);if(!this._depthFBO||this._depthFBO.width===v&&this._depthFBO.height===b||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const C=f.gl,I=f.createFramebuffer(v,b,!0);f.activeTexture.set(C.TEXTURE0);const P=new s.Texture(f,{width:v,height:b,data:null},C.RGBA);P.bind(C.NEAREST,C.CLAMP_TO_EDGE),I.colorAttachment.set(P.texture);const O=f.createRenderbuffer(f.gl.DEPTH_COMPONENT16,v,b);I.depthAttachment.set(O),this._depthFBO=I,this._depthTexture=P}f.bindFramebuffer.set(this._depthFBO.framebuffer),f.viewport.set([0,0,v,b]),function(C,I,P,O){if(C.transform.projection.name==="globe")return;const k=C.context,U=k.gl;k.clear({depth:1});const W=C.useProgram("terrainDepth"),J=new s.DepthMode(U.LESS,s.DepthMode.ReadWrite,C.depthRangeFor3D);for(const ee of O){const Q=P.getTile(ee),te=Zu(ee.projMatrix,0);I.setupElevationDraw(Q,W),W.draw(k,U.TRIANGLES,J,s.StencilMode.disabled,s.ColorMode.unblended,s.CullFaceMode.backCCW,te,"terrain_depth",I.gridBuffer,I.gridIndexBuffer,I.gridNoSkirtSegments)}}(l,this,_,this.proxyCoords)}_setupProxiedCoordsForOrtho(l,f,_){if(l.getSource()instanceof en)return this._setupProxiedCoordsForImageSource(l,f,_);this._findCoveringTileCache[l.id]=this._findCoveringTileCache[l.id]||{};const v=this.proxiedCoords[l.id]=[],b=this.proxyCoords;for(let I=0;I<b.length;I++){const P=b[I],O=this._findTileCoveringTileID(P,l);if(O){const k=this._createProxiedId(P,O,_[P.key]&&_[P.key][l.id]);v.push(k),this.proxyToSource[P.key][l.id]=[k]}}let C=!1;for(let I=0;I<f.length;I++){const P=l.getTile(f[I]);if(!P||!P.hasData())continue;const O=this._findTileCoveringTileID(P.tileID,this.proxySourceCache);if(O&&O.tileID.canonical.z!==P.tileID.canonical.z){const k=this.proxyToSource[O.tileID.key][l.id],U=this._createProxiedId(O.tileID,P,_[O.tileID.key]&&_[O.tileID.key][l.id]);k?k.splice(k.length-1,0,U):this.proxyToSource[O.tileID.key][l.id]=[U],v.push(U),C=!0}}this._sourceTilesOverlap[l.id]=C}_setupProxiedCoordsForImageSource(l,f,_){if(!l.getSource().loaded())return;const v=this.proxiedCoords[l.id]=[],b=this.proxyCoords,C=l.getSource(),I=new s.Point(C.tileID.x,C.tileID.y)._div(1<<C.tileID.z),P=C.coordinates.map(s.MercatorCoordinate.fromLngLat).reduce((k,U)=>(k.min.x=Math.min(k.min.x,U.x-I.x),k.min.y=Math.min(k.min.y,U.y-I.y),k.max.x=Math.max(k.max.x,U.x-I.x),k.max.y=Math.max(k.max.y,U.y-I.y),k),{min:new s.Point(Number.MAX_VALUE,Number.MAX_VALUE),max:new s.Point(-Number.MAX_VALUE,-Number.MAX_VALUE)}),O=(k,U)=>{const W=k.wrap+k.canonical.x/(1<<k.canonical.z),J=k.canonical.y/(1<<k.canonical.z),ee=s.EXTENT/(1<<k.canonical.z),Q=U.wrap+U.canonical.x/(1<<U.canonical.z),te=U.canonical.y/(1<<U.canonical.z);return W+ee<Q+P.min.x||W>Q+P.max.x||J+ee<te+P.min.y||J>te+P.max.y};for(let k=0;k<b.length;k++){const U=b[k];for(let W=0;W<f.length;W++){const J=l.getTile(f[W]);if(!J||!J.hasData()||O(U,J.tileID))continue;const ee=this._createProxiedId(U,J,_[U.key]&&_[U.key][l.id]),Q=this.proxyToSource[U.key][l.id];Q?Q.push(ee):this.proxyToSource[U.key][l.id]=[ee],v.push(ee)}}}_createProxiedId(l,f,_){let v=this.orthoMatrix;if(_){const b=_.find(C=>C.key===f.tileID.key);if(b)return b}if(f.tileID.key!==l.key){const b=l.canonical.z-f.tileID.canonical.z;let C,I,P;v=s.create();const O=f.tileID.wrap-l.wrap<<l.overscaledZ;b>0?(C=s.EXTENT>>b,I=C*((f.tileID.canonical.x<<b)-l.canonical.x+O),P=C*((f.tileID.canonical.y<<b)-l.canonical.y)):(C=s.EXTENT<<-b,I=s.EXTENT*(f.tileID.canonical.x-(l.canonical.x+O<<-b)),P=s.EXTENT*(f.tileID.canonical.y-(l.canonical.y<<-b))),s.ortho(v,0,C,0,C,0,1),s.translate(v,v,[I,P,0])}return new jf(f.tileID,l.key,v)}_findTileCoveringTileID(l,f){let _=f.getTile(l);if(_&&_.hasData())return _;const v=this._findCoveringTileCache[f.id],b=v[l.key];if(_=b?f.getTileByID(b):null,_&&_.hasData()||b===null)return _;let C=_?_.tileID:l,I=C.overscaledZ;const P=f.getSource().minzoom,O=[];if(!b){const U=f.getSource().maxzoom;if(l.canonical.z>=U){const W=l.canonical.z-U;f.getSource().reparseOverscaled?(I=Math.max(l.canonical.z+2,f.transform.tileZoom),C=new s.OverscaledTileID(I,l.wrap,U,l.canonical.x>>W,l.canonical.y>>W)):W!==0&&(I=U,C=new s.OverscaledTileID(I,l.wrap,U,l.canonical.x>>W,l.canonical.y>>W))}C.key!==l.key&&(O.push(C.key),_=f.getTile(C))}const k=U=>{O.forEach(W=>{v[W]=U}),O.length=0};for(I-=1;I>=P&&(!_||!_.hasData());I--){_&&k(_.tileID.key);const U=C.calculateScaledKey(I);if(_=f.getTileByID(U),_&&_.hasData())break;const W=v[U];if(W===null)break;W===void 0?O.push(U):_=f.getTileByID(W)}return k(_?_.tileID.key:null),_&&_.hasData()?_:null}findDEMTileFor(l){return this.enabled?this._findTileCoveringTileID(l,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(l,f){let _=this._tilesDirty[l];_||(_=this._tilesDirty[l]={}),_[f.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const l=function(f){let _=0;const v=new s.StructArrayLayout2ui4,b=131;for(let C=1;C<129;C++){for(let I=1;I<129;I++)_=C*b+I,v.emplaceBack(_,_+1),v.emplaceBack(_,_+b),v.emplaceBack(_+1,_+b),C===128&&v.emplaceBack(_+b,_+b+1);v.emplaceBack(_+1,_+1+b)}return v}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(l),this.wireframeSegments=s.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,l.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}class mn{static cacheKey(l,f,_,v){let b=`${f}${v?v.cacheKey:""}`;for(const C of _)l.usedDefines.includes(C)&&(b+=`/${C}`);return b}constructor(l,f,_,v,b,C){const I=l.gl;this.program=I.createProgram();const P=function(V){const K=[];for(let se=0;se<V.length;se++){if(V[se]===null)continue;const ae=V[se].split(" ");K.push(ae.pop())}return K}(_.staticAttributes),O=v?v.getBinderAttributes():[],k=P.concat(O);let U=v?v.defines():[];U=U.concat(C.map(V=>`#define ${V}`));const W=l.isWebGL2?`#version 300 es
`:"",J=W+U.concat(l.extStandardDerivatives&&W.length===0?`#extension GL_OES_standard_derivatives : enable
`.concat(tm):tm,tm,Ff,Q_.fragmentSource,Xu.fragmentSource,_.fragmentSource).join(`
`),ee=W+U.concat(`
#ifdef GL_ES
precision highp float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`,Ff,Q_.vertexSource,Xu.vertexSource,zf.vertexSource,_.vertexSource).join(`
`),Q=I.createShader(I.FRAGMENT_SHADER);if(I.isContextLost())return void(this.failedToCreate=!0);I.shaderSource(Q,J),I.compileShader(Q),I.attachShader(this.program,Q);const te=I.createShader(I.VERTEX_SHADER);if(I.isContextLost())this.failedToCreate=!0;else{I.shaderSource(te,ee),I.compileShader(te),I.attachShader(this.program,te),this.attributes={},this.numAttributes=k.length;for(let V=0;V<this.numAttributes;V++)k[V]&&(I.bindAttribLocation(this.program,V,k[V]),this.attributes[k[V]]=V);I.linkProgram(this.program),I.deleteShader(te),I.deleteShader(Q),this.fixedUniforms=b(l),this.binderUniforms=v?v.getUniforms(l):[],C.includes("TERRAIN")&&(this.terrainUniforms=(V=>({u_dem:new s.Uniform1i(V),u_dem_prev:new s.Uniform1i(V),u_dem_unpack:new s.Uniform4f(V),u_dem_tl:new s.Uniform2f(V),u_dem_scale:new s.Uniform1f(V),u_dem_tl_prev:new s.Uniform2f(V),u_dem_scale_prev:new s.Uniform1f(V),u_dem_size:new s.Uniform1f(V),u_dem_lerp:new s.Uniform1f(V),u_exaggeration:new s.Uniform1f(V),u_depth:new s.Uniform1i(V),u_depth_size_inv:new s.Uniform2f(V),u_meter_to_dem:new s.Uniform1f(V),u_label_plane_matrix_inv:new s.UniformMatrix4f(V)}))(l)),C.includes("GLOBE")&&(this.globeUniforms=(V=>({u_tile_tl_up:new s.Uniform3f(V),u_tile_tr_up:new s.Uniform3f(V),u_tile_br_up:new s.Uniform3f(V),u_tile_bl_up:new s.Uniform3f(V),u_tile_up_scale:new s.Uniform1f(V)}))(l)),C.includes("FOG")&&(this.fogUniforms=(V=>({u_fog_matrix:new s.UniformMatrix4f(V),u_fog_range:new s.Uniform2f(V),u_fog_color:new s.Uniform4f(V),u_fog_horizon_blend:new s.Uniform1f(V),u_fog_temporal_offset:new s.Uniform1f(V),u_frustum_tl:new s.Uniform3f(V),u_frustum_tr:new s.Uniform3f(V),u_frustum_br:new s.Uniform3f(V),u_frustum_bl:new s.Uniform3f(V),u_globe_pos:new s.Uniform3f(V),u_globe_radius:new s.Uniform1f(V),u_globe_transition:new s.Uniform1f(V),u_is_globe:new s.Uniform1i(V),u_viewport:new s.Uniform2f(V)}))(l))}}setTerrainUniformValues(l,f){if(!this.terrainUniforms)return;const _=this.terrainUniforms;if(!this.failedToCreate){l.program.set(this.program);for(const v in f)_[v]&&_[v].set(this.program,v,f[v])}}setGlobeUniformValues(l,f){if(!this.globeUniforms)return;const _=this.globeUniforms;if(!this.failedToCreate){l.program.set(this.program);for(const v in f)_[v]&&_[v].set(this.program,v,f[v])}}setFogUniformValues(l,f){if(!this.fogUniforms)return;const _=this.fogUniforms;if(!this.failedToCreate){l.program.set(this.program);for(const v in f)_[v].set(this.program,v,f[v])}}draw(l,f,_,v,b,C,I,P,O,k,U,W,J,ee,Q){const te=l.gl;if(this.failedToCreate)return;l.program.set(this.program),l.setDepthMode(_),l.setStencilMode(v),l.setColorMode(b),l.setCullFace(C);for(const K of Object.keys(this.fixedUniforms))this.fixedUniforms[K].set(this.program,K,I[K]);ee&&ee.setUniforms(this.program,l,this.binderUniforms,W,{zoom:J});const V={[te.LINES]:2,[te.TRIANGLES]:3,[te.LINE_STRIP]:1}[f];for(const K of U.get()){const se=K.vaos||(K.vaos={});(se[P]||(se[P]=new Ux)).bind(l,this,O,ee?ee.getPaintVertexBuffers():[],k,K.vertexOffset,Q||[]),te.drawElements(f,K.primitiveLength*V,te.UNSIGNED_SHORT,K.primitiveOffset*V*2)}}}function mh(m,l){const f=Math.pow(2,l.tileID.overscaledZ),_=l.tileSize*Math.pow(2,m.transform.tileZoom)/f,v=_*(l.tileID.canonical.x+l.tileID.wrap*f),b=_*l.tileID.canonical.y;return{u_image:0,u_texsize:l.imageAtlasTexture.size,u_tile_units_to_pixels:1/kt(l,1,m.transform.tileZoom),u_pixel_coord_upper:[v>>16,b>>16],u_pixel_coord_lower:[65535&v,65535&b]}}const ry=s.create(),um=(m,l,f,_,v,b,C,I,P,O,k)=>{const U=l.style.light,W=U.properties.get("position"),J=[W.x,W.y,W.z],ee=s.create$1();U.properties.get("anchor")==="viewport"&&(s.fromRotation(ee,-l.transform.angle),s.transformMat3(J,J,ee));const Q=U.properties.get("color"),te=l.transform,V={u_matrix:m,u_lightpos:J,u_lightintensity:U.properties.get("intensity"),u_lightcolor:[Q.r,Q.g,Q.b],u_vertical_gradient:+f,u_opacity:_,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:ry,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:v,u_edge_radius:b};return te.projection.name==="globe"&&(V.u_tile_id=[C.canonical.x,C.canonical.y,1<<C.canonical.z],V.u_zoom_transition=P,V.u_inv_rot_matrix=k,V.u_merc_center=O,V.u_up_dir=te.projection.upVector(new s.CanonicalTileID(0,0,0),O[0]*s.EXTENT,O[1]*s.EXTENT),V.u_height_lift=I),V},iy=(m,l,f,_,v,b,C,I,P,O,k,U)=>{const W=um(m,l,f,_,v,b,C,P,O,k,U),J={u_height_factor:-Math.pow(2,C.overscaledZ)/I.tileSize/8};return s.extend(W,mh(l,I),J)},Jl=m=>({u_matrix:m}),cm=(m,l,f)=>s.extend(Jl(m),mh(l,f)),Vx=(m,l)=>({u_matrix:m,u_world:l}),jx=(m,l,f,_)=>s.extend(cm(m,l,f),{u_world:_}),Gx=s.create(),hm=(m,l,f,_,v,b)=>{const C=m.transform,I=C.projection.name==="globe";let P;if(b.paint.get("circle-pitch-alignment")==="map")if(I){const k=s.globePixelsToTileUnits(C.zoom,l.canonical)*C._pixelsPerMercatorPixel;P=Float32Array.from([k,0,0,k])}else P=C.calculatePixelsToTileUnitsMatrix(f);else P=new Float32Array([C.pixelsToGLUnits[0],0,0,C.pixelsToGLUnits[1]]);const O={u_camera_to_center_distance:C.cameraToCenterDistance,u_matrix:m.translatePosMatrix(l.projMatrix,f,b.paint.get("circle-translate"),b.paint.get("circle-translate-anchor")),u_device_pixel_ratio:s.exported.devicePixelRatio,u_extrude_scale:P,u_inv_rot_matrix:Gx,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(I){O.u_inv_rot_matrix=_,O.u_merc_center=v,O.u_tile_id=[l.canonical.x,l.canonical.y,1<<l.canonical.z],O.u_zoom_transition=s.globeToMercatorTransition(C.zoom);const k=v[0]*s.EXTENT,U=v[1]*s.EXTENT;O.u_up_dir=C.projection.upVector(new s.CanonicalTileID(0,0,0),k,U)}return O},fm=m=>{const l=[];return m.paint.get("circle-pitch-alignment")==="map"&&l.push("PITCH_WITH_MAP"),m.paint.get("circle-pitch-scale")==="map"&&l.push("SCALE_WITH_MAP"),l},pm=(m,l,f,_)=>{const v=s.EXTENT/f.tileSize;return{u_matrix:m,u_camera_to_center_distance:l.getCameraToCenterDistance(_),u_extrude_scale:[l.pixelsToGLUnits[0]/v,l.pixelsToGLUnits[1]/v]}},Gf=(m,l,f=1)=>({u_matrix:m,u_color:l,u_overlay:0,u_overlay_scale:f}),oy=s.create(),sy=(m,l,f,_,v,b,C)=>{const I=m.transform,P=I.projection.name==="globe",O=P?s.globePixelsToTileUnits(I.zoom,l.canonical)*I._pixelsPerMercatorPixel:kt(f,1,b),k={u_matrix:l.projMatrix,u_extrude_scale:O,u_intensity:C,u_inv_rot_matrix:oy,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(P){k.u_inv_rot_matrix=_,k.u_merc_center=v,k.u_tile_id=[l.canonical.x,l.canonical.y,1<<l.canonical.z],k.u_zoom_transition=s.globeToMercatorTransition(I.zoom);const U=v[0]*s.EXTENT,W=v[1]*s.EXTENT;k.u_up_dir=I.projection.upVector(new s.CanonicalTileID(0,0,0),U,W)}return k},qx=(m,l,f,_,v,b,C)=>{const I=m.transform,P=I.calculatePixelsToTileUnitsMatrix(l);return{u_matrix:dm(m,l,f,_),u_pixels_to_tile_units:P,u_device_pixel_ratio:b,u_units_to_pixels:[1/I.pixelsToGLUnits[0],1/I.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:v,u_texsize:_h(f)?l.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:Hu(l,m.transform),u_alpha_discard_threshold:0,u_trim_offset:C}},gh=(m,l,f,_,v)=>{const b=m.transform;return{u_matrix:dm(m,l,f,_),u_texsize:l.imageAtlasTexture.size,u_pixels_to_tile_units:b.calculatePixelsToTileUnitsMatrix(l),u_device_pixel_ratio:v,u_image:0,u_tile_units_to_pixels:Hu(l,b),u_units_to_pixels:[1/b.pixelsToGLUnits[0],1/b.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function Hu(m,l){return 1/kt(m,1,l.tileZoom)}function dm(m,l,f,_){return m.translatePosMatrix(_||l.tileID.projMatrix,l,f.paint.get("line-translate"),f.paint.get("line-translate-anchor"))}function _h(m){const l=m.paint.get("line-dasharray").value;return l.value||l.kind!=="constant"}const mm=(m,l,f,_,v,b)=>{return{u_matrix:m,u_tl_parent:l,u_scale_parent:f,u_fade_t:_.mix,u_opacity:_.opacity*v.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:v.paint.get("raster-brightness-min"),u_brightness_high:v.paint.get("raster-brightness-max"),u_saturation_factor:(I=v.paint.get("raster-saturation"),I>0?1-1/(1.001-I):-I),u_contrast_factor:(C=v.paint.get("raster-contrast"),C>0?1/(1-C):1+C),u_spin_weights:ks(v.paint.get("raster-hue-rotate")),u_perspective_transform:b};var C,I};function ks(m){m*=Math.PI/180;const l=Math.sin(m),f=Math.cos(m);return[(2*f+1)/3,(-Math.sqrt(3)*l-f+1)/3,(Math.sqrt(3)*l-f+1)/3]}const qf=s.create(),gm=(m,l,f,_,v,b,C,I,P,O,k,U,W,J,ee,Q)=>{const te=v.transform,V={u_is_size_zoom_constant:+(m==="constant"||m==="source"),u_is_size_feature_constant:+(m==="constant"||m==="camera"),u_size_t:l?l.uSizeT:0,u_size:l?l.uSize:0,u_camera_to_center_distance:te.cameraToCenterDistance,u_rotate_symbol:+f,u_aspect_ratio:te.width/te.height,u_fade_change:v.options.fadeDuration?v.symbolFadeChange:1,u_matrix:b,u_label_plane_matrix:C,u_coord_matrix:I,u_is_text:+P,u_pitch_with_map:+_,u_texsize:O,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:qf,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:qf,u_up_vector:[0,-1,0]};return Q.name==="globe"&&(V.u_tile_id=[k.canonical.x,k.canonical.y,1<<k.canonical.z],V.u_zoom_transition=U,V.u_inv_rot_matrix=J,V.u_merc_center=W,V.u_camera_forward=te._camera.forward(),V.u_ecef_origin=s.globeECEFOrigin(te.globeMatrix,k.toUnwrapped()),V.u_tile_matrix=Float32Array.from(te.globeMatrix),V.u_up_vector=ee),V},Xf=(m,l,f,_,v,b,C,I,P,O,k,U,W,J,ee,Q,te)=>s.extend(gm(m,l,f,_,v,b,C,I,P,O,U,W,J,ee,Q,te),{u_gamma_scale:_?v.transform.cameraToCenterDistance*Math.cos(v.terrain?0:v.transform._pitch):1,u_device_pixel_ratio:s.exported.devicePixelRatio,u_is_halo:+k}),ay=(m,l,f,_,v,b,C,I,P,O,k,U,W,J,ee,Q)=>s.extend(Xf(m,l,f,_,v,b,C,I,!0,P,!0,k,U,W,J,ee,Q),{u_texsize_icon:O,u_texture_icon:1}),_m=(m,l,f)=>({u_matrix:m,u_opacity:l,u_color:f}),Xx=(m,l,f,_,v)=>s.extend(function(b,C,I){const P=C.imageManager.getPattern(b.toString()),{width:O,height:k}=C.imageManager.getPixelSize(),U=Math.pow(2,I.tileID.overscaledZ),W=I.tileSize*Math.pow(2,C.transform.tileZoom)/U,J=W*(I.tileID.canonical.x+I.tileID.wrap*U),ee=W*I.tileID.canonical.y;return{u_image:0,u_pattern_tl:P.tl,u_pattern_br:P.br,u_texsize:[O,k],u_pattern_size:P.displaySize,u_tile_units_to_pixels:1/kt(I,1,C.transform.tileZoom),u_pixel_coord_upper:[J>>16,ee>>16],u_pixel_coord_lower:[65535&J,65535&ee]}}(_,f,v),{u_matrix:m,u_opacity:l}),ym={fillExtrusion:m=>({u_matrix:new s.UniformMatrix4f(m),u_lightpos:new s.Uniform3f(m),u_lightintensity:new s.Uniform1f(m),u_lightcolor:new s.Uniform3f(m),u_vertical_gradient:new s.Uniform1f(m),u_opacity:new s.Uniform1f(m),u_edge_radius:new s.Uniform1f(m),u_ao:new s.Uniform2f(m),u_tile_id:new s.Uniform3f(m),u_zoom_transition:new s.Uniform1f(m),u_inv_rot_matrix:new s.UniformMatrix4f(m),u_merc_center:new s.Uniform2f(m),u_up_dir:new s.Uniform3f(m),u_height_lift:new s.Uniform1f(m)}),fillExtrusionPattern:m=>({u_matrix:new s.UniformMatrix4f(m),u_lightpos:new s.Uniform3f(m),u_lightintensity:new s.Uniform1f(m),u_lightcolor:new s.Uniform3f(m),u_vertical_gradient:new s.Uniform1f(m),u_height_factor:new s.Uniform1f(m),u_edge_radius:new s.Uniform1f(m),u_ao:new s.Uniform2f(m),u_tile_id:new s.Uniform3f(m),u_zoom_transition:new s.Uniform1f(m),u_inv_rot_matrix:new s.UniformMatrix4f(m),u_merc_center:new s.Uniform2f(m),u_up_dir:new s.Uniform3f(m),u_height_lift:new s.Uniform1f(m),u_image:new s.Uniform1i(m),u_texsize:new s.Uniform2f(m),u_pixel_coord_upper:new s.Uniform2f(m),u_pixel_coord_lower:new s.Uniform2f(m),u_tile_units_to_pixels:new s.Uniform1f(m),u_opacity:new s.Uniform1f(m)}),fill:m=>({u_matrix:new s.UniformMatrix4f(m)}),fillPattern:m=>({u_matrix:new s.UniformMatrix4f(m),u_image:new s.Uniform1i(m),u_texsize:new s.Uniform2f(m),u_pixel_coord_upper:new s.Uniform2f(m),u_pixel_coord_lower:new s.Uniform2f(m),u_tile_units_to_pixels:new s.Uniform1f(m)}),fillOutline:m=>({u_matrix:new s.UniformMatrix4f(m),u_world:new s.Uniform2f(m)}),fillOutlinePattern:m=>({u_matrix:new s.UniformMatrix4f(m),u_world:new s.Uniform2f(m),u_image:new s.Uniform1i(m),u_texsize:new s.Uniform2f(m),u_pixel_coord_upper:new s.Uniform2f(m),u_pixel_coord_lower:new s.Uniform2f(m),u_tile_units_to_pixels:new s.Uniform1f(m)}),circle:m=>({u_camera_to_center_distance:new s.Uniform1f(m),u_extrude_scale:new s.UniformMatrix2f(m),u_device_pixel_ratio:new s.Uniform1f(m),u_matrix:new s.UniformMatrix4f(m),u_inv_rot_matrix:new s.UniformMatrix4f(m),u_merc_center:new s.Uniform2f(m),u_tile_id:new s.Uniform3f(m),u_zoom_transition:new s.Uniform1f(m),u_up_dir:new s.Uniform3f(m)}),collisionBox:m=>({u_matrix:new s.UniformMatrix4f(m),u_camera_to_center_distance:new s.Uniform1f(m),u_extrude_scale:new s.Uniform2f(m)}),collisionCircle:m=>({u_matrix:new s.UniformMatrix4f(m),u_inv_matrix:new s.UniformMatrix4f(m),u_camera_to_center_distance:new s.Uniform1f(m),u_viewport_size:new s.Uniform2f(m)}),debug:m=>({u_color:new s.UniformColor(m),u_matrix:new s.UniformMatrix4f(m),u_overlay:new s.Uniform1i(m),u_overlay_scale:new s.Uniform1f(m)}),clippingMask:m=>({u_matrix:new s.UniformMatrix4f(m)}),heatmap:m=>({u_extrude_scale:new s.Uniform1f(m),u_intensity:new s.Uniform1f(m),u_matrix:new s.UniformMatrix4f(m),u_inv_rot_matrix:new s.UniformMatrix4f(m),u_merc_center:new s.Uniform2f(m),u_tile_id:new s.Uniform3f(m),u_zoom_transition:new s.Uniform1f(m),u_up_dir:new s.Uniform3f(m)}),heatmapTexture:m=>({u_image:new s.Uniform1i(m),u_color_ramp:new s.Uniform1i(m),u_opacity:new s.Uniform1f(m)}),hillshade:m=>({u_matrix:new s.UniformMatrix4f(m),u_image:new s.Uniform1i(m),u_latrange:new s.Uniform2f(m),u_light:new s.Uniform2f(m),u_shadow:new s.UniformColor(m),u_highlight:new s.UniformColor(m),u_accent:new s.UniformColor(m)}),hillshadePrepare:m=>({u_matrix:new s.UniformMatrix4f(m),u_image:new s.Uniform1i(m),u_dimension:new s.Uniform2f(m),u_zoom:new s.Uniform1f(m),u_unpack:new s.Uniform4f(m)}),line:m=>({u_matrix:new s.UniformMatrix4f(m),u_pixels_to_tile_units:new s.UniformMatrix2f(m),u_device_pixel_ratio:new s.Uniform1f(m),u_units_to_pixels:new s.Uniform2f(m),u_dash_image:new s.Uniform1i(m),u_gradient_image:new s.Uniform1i(m),u_image_height:new s.Uniform1f(m),u_texsize:new s.Uniform2f(m),u_tile_units_to_pixels:new s.Uniform1f(m),u_alpha_discard_threshold:new s.Uniform1f(m),u_trim_offset:new s.Uniform2f(m)}),linePattern:m=>({u_matrix:new s.UniformMatrix4f(m),u_texsize:new s.Uniform2f(m),u_pixels_to_tile_units:new s.UniformMatrix2f(m),u_device_pixel_ratio:new s.Uniform1f(m),u_image:new s.Uniform1i(m),u_units_to_pixels:new s.Uniform2f(m),u_tile_units_to_pixels:new s.Uniform1f(m),u_alpha_discard_threshold:new s.Uniform1f(m)}),raster:m=>({u_matrix:new s.UniformMatrix4f(m),u_tl_parent:new s.Uniform2f(m),u_scale_parent:new s.Uniform1f(m),u_fade_t:new s.Uniform1f(m),u_opacity:new s.Uniform1f(m),u_image0:new s.Uniform1i(m),u_image1:new s.Uniform1i(m),u_brightness_low:new s.Uniform1f(m),u_brightness_high:new s.Uniform1f(m),u_saturation_factor:new s.Uniform1f(m),u_contrast_factor:new s.Uniform1f(m),u_spin_weights:new s.Uniform3f(m),u_perspective_transform:new s.Uniform2f(m)}),symbolIcon:m=>({u_is_size_zoom_constant:new s.Uniform1i(m),u_is_size_feature_constant:new s.Uniform1i(m),u_size_t:new s.Uniform1f(m),u_size:new s.Uniform1f(m),u_camera_to_center_distance:new s.Uniform1f(m),u_rotate_symbol:new s.Uniform1i(m),u_aspect_ratio:new s.Uniform1f(m),u_fade_change:new s.Uniform1f(m),u_matrix:new s.UniformMatrix4f(m),u_label_plane_matrix:new s.UniformMatrix4f(m),u_coord_matrix:new s.UniformMatrix4f(m),u_is_text:new s.Uniform1i(m),u_pitch_with_map:new s.Uniform1i(m),u_texsize:new s.Uniform2f(m),u_tile_id:new s.Uniform3f(m),u_zoom_transition:new s.Uniform1f(m),u_inv_rot_matrix:new s.UniformMatrix4f(m),u_merc_center:new s.Uniform2f(m),u_camera_forward:new s.Uniform3f(m),u_tile_matrix:new s.UniformMatrix4f(m),u_up_vector:new s.Uniform3f(m),u_ecef_origin:new s.Uniform3f(m),u_texture:new s.Uniform1i(m)}),symbolSDF:m=>({u_is_size_zoom_constant:new s.Uniform1i(m),u_is_size_feature_constant:new s.Uniform1i(m),u_size_t:new s.Uniform1f(m),u_size:new s.Uniform1f(m),u_camera_to_center_distance:new s.Uniform1f(m),u_rotate_symbol:new s.Uniform1i(m),u_aspect_ratio:new s.Uniform1f(m),u_fade_change:new s.Uniform1f(m),u_matrix:new s.UniformMatrix4f(m),u_label_plane_matrix:new s.UniformMatrix4f(m),u_coord_matrix:new s.UniformMatrix4f(m),u_is_text:new s.Uniform1i(m),u_pitch_with_map:new s.Uniform1i(m),u_texsize:new s.Uniform2f(m),u_texture:new s.Uniform1i(m),u_gamma_scale:new s.Uniform1f(m),u_device_pixel_ratio:new s.Uniform1f(m),u_tile_id:new s.Uniform3f(m),u_zoom_transition:new s.Uniform1f(m),u_inv_rot_matrix:new s.UniformMatrix4f(m),u_merc_center:new s.Uniform2f(m),u_camera_forward:new s.Uniform3f(m),u_tile_matrix:new s.UniformMatrix4f(m),u_up_vector:new s.Uniform3f(m),u_ecef_origin:new s.Uniform3f(m),u_is_halo:new s.Uniform1i(m)}),symbolTextAndIcon:m=>({u_is_size_zoom_constant:new s.Uniform1i(m),u_is_size_feature_constant:new s.Uniform1i(m),u_size_t:new s.Uniform1f(m),u_size:new s.Uniform1f(m),u_camera_to_center_distance:new s.Uniform1f(m),u_rotate_symbol:new s.Uniform1i(m),u_aspect_ratio:new s.Uniform1f(m),u_fade_change:new s.Uniform1f(m),u_matrix:new s.UniformMatrix4f(m),u_label_plane_matrix:new s.UniformMatrix4f(m),u_coord_matrix:new s.UniformMatrix4f(m),u_is_text:new s.Uniform1i(m),u_pitch_with_map:new s.Uniform1i(m),u_texsize:new s.Uniform2f(m),u_texsize_icon:new s.Uniform2f(m),u_texture:new s.Uniform1i(m),u_texture_icon:new s.Uniform1i(m),u_gamma_scale:new s.Uniform1f(m),u_device_pixel_ratio:new s.Uniform1f(m),u_is_halo:new s.Uniform1i(m)}),background:m=>({u_matrix:new s.UniformMatrix4f(m),u_opacity:new s.Uniform1f(m),u_color:new s.UniformColor(m)}),backgroundPattern:m=>({u_matrix:new s.UniformMatrix4f(m),u_opacity:new s.Uniform1f(m),u_image:new s.Uniform1i(m),u_pattern_tl:new s.Uniform2f(m),u_pattern_br:new s.Uniform2f(m),u_texsize:new s.Uniform2f(m),u_pattern_size:new s.Uniform2f(m),u_pixel_coord_upper:new s.Uniform2f(m),u_pixel_coord_lower:new s.Uniform2f(m),u_tile_units_to_pixels:new s.Uniform1f(m)}),terrainRaster:om,terrainDepth:om,skybox:m=>({u_matrix:new s.UniformMatrix4f(m),u_sun_direction:new s.Uniform3f(m),u_cubemap:new s.Uniform1i(m),u_opacity:new s.Uniform1f(m),u_temporal_offset:new s.Uniform1f(m)}),skyboxGradient:m=>({u_matrix:new s.UniformMatrix4f(m),u_color_ramp:new s.Uniform1i(m),u_center_direction:new s.Uniform3f(m),u_radius:new s.Uniform1f(m),u_opacity:new s.Uniform1f(m),u_temporal_offset:new s.Uniform1f(m)}),skyboxCapture:m=>({u_matrix_3f:new s.UniformMatrix3f(m),u_sun_direction:new s.Uniform3f(m),u_sun_intensity:new s.Uniform1f(m),u_color_tint_r:new s.Uniform4f(m),u_color_tint_m:new s.Uniform4f(m),u_luminance:new s.Uniform1f(m)}),globeRaster:m=>({u_proj_matrix:new s.UniformMatrix4f(m),u_globe_matrix:new s.UniformMatrix4f(m),u_normalize_matrix:new s.UniformMatrix4f(m),u_merc_matrix:new s.UniformMatrix4f(m),u_zoom_transition:new s.Uniform1f(m),u_merc_center:new s.Uniform2f(m),u_image0:new s.Uniform1i(m),u_grid_matrix:new s.UniformMatrix3f(m),u_skirt_height:new s.Uniform1f(m),u_frustum_tl:new s.Uniform3f(m),u_frustum_tr:new s.Uniform3f(m),u_frustum_br:new s.Uniform3f(m),u_frustum_bl:new s.Uniform3f(m),u_globe_pos:new s.Uniform3f(m),u_globe_radius:new s.Uniform1f(m),u_viewport:new s.Uniform2f(m)}),globeAtmosphere:m=>({u_frustum_tl:new s.Uniform3f(m),u_frustum_tr:new s.Uniform3f(m),u_frustum_br:new s.Uniform3f(m),u_frustum_bl:new s.Uniform3f(m),u_horizon:new s.Uniform1f(m),u_transition:new s.Uniform1f(m),u_fadeout_range:new s.Uniform1f(m),u_color:new s.Uniform4f(m),u_high_color:new s.Uniform4f(m),u_space_color:new s.Uniform4f(m),u_star_intensity:new s.Uniform1f(m),u_star_density:new s.Uniform1f(m),u_star_size:new s.Uniform1f(m),u_temporal_offset:new s.Uniform1f(m),u_horizon_angle:new s.Uniform1f(m),u_rotation_matrix:new s.UniformMatrix4f(m)})};let $f;function yh(m,l,f,_,v,b,C){const I=m.context,P=I.gl,O=m.transform,k=m.useProgram("collisionBox"),U=[];let W=0,J=0;for(let ae=0;ae<_.length;ae++){const ge=_[ae],ve=l.getTile(ge),ye=ve.getBucket(f);if(!ye)continue;const Ie=Do(ge,ye,O);let Ce=Ie;v[0]===0&&v[1]===0||(Ce=m.translatePosMatrix(Ie,ve,v,b));const Ne=C?ye.textCollisionBox:ye.iconCollisionBox,rt=ye.collisionCircleArray;if(rt.length>0){const Le=s.create(),Ye=Ce;s.mul(Le,ye.placementInvProjMatrix,O.glCoordMatrix),s.mul(Le,Le,ye.placementViewportMatrix),U.push({circleArray:rt,circleOffset:J,transform:Ye,invTransform:Le,projection:ye.getProjection()}),W+=rt.length/4,J=W}Ne&&(m.terrain&&m.terrain.setupElevationDraw(ve,k),k.draw(I,P.LINES,s.DepthMode.disabled,s.StencilMode.disabled,m.colorModeForRenderPass(),s.CullFaceMode.disabled,pm(Ce,O,ve,ye.getProjection()),f.id,Ne.layoutVertexBuffer,Ne.indexBuffer,Ne.segments,null,O.zoom,null,[Ne.collisionVertexBuffer,Ne.collisionVertexBufferExt]))}if(!C||!U.length)return;const ee=m.useProgram("collisionCircle"),Q=new s.StructArrayLayout2f1f2i16;Q.resize(4*W),Q._trim();let te=0;for(const ae of U)for(let ge=0;ge<ae.circleArray.length/4;ge++){const ve=4*ge,ye=ae.circleArray[ve+0],Ie=ae.circleArray[ve+1],Ce=ae.circleArray[ve+2],Ne=ae.circleArray[ve+3];Q.emplace(te++,ye,Ie,Ce,Ne,0),Q.emplace(te++,ye,Ie,Ce,Ne,1),Q.emplace(te++,ye,Ie,Ce,Ne,2),Q.emplace(te++,ye,Ie,Ce,Ne,3)}(!$f||$f.length<2*W)&&($f=function(ae){const ge=2*ae,ve=new s.StructArrayLayout3ui6;ve.resize(ge),ve._trim();for(let ye=0;ye<ge;ye++){const Ie=6*ye;ve.uint16[Ie+0]=4*ye+0,ve.uint16[Ie+1]=4*ye+1,ve.uint16[Ie+2]=4*ye+2,ve.uint16[Ie+3]=4*ye+2,ve.uint16[Ie+4]=4*ye+3,ve.uint16[Ie+5]=4*ye+0}return ve}(W));const V=I.createIndexBuffer($f,!0),K=I.createVertexBuffer(Q,s.collisionCircleLayout.members,!0);for(const ae of U){const ge={u_matrix:ae.transform,u_inv_matrix:ae.invTransform,u_camera_to_center_distance:(se=O).getCameraToCenterDistance(ae.projection),u_viewport_size:[se.width,se.height]};ee.draw(I,P.TRIANGLES,s.DepthMode.disabled,s.StencilMode.disabled,m.colorModeForRenderPass(),s.CullFaceMode.disabled,ge,f.id,K,V,s.SegmentVector.simpleSegment(0,2*ae.circleOffset,ae.circleArray.length,ae.circleArray.length/2),null,O.zoom)}var se;K.destroy(),V.destroy()}const ly=s.create();function vm({width:m,height:l,anchor:f,textOffset:_,textScale:v},b){const{horizontalAlign:C,verticalAlign:I}=s.getAnchorAlignment(f),P=-(C-.5)*m,O=-(I-.5)*l,k=s.evaluateVariableOffset(f,_);return new s.Point((P/v+k[0])*b,(O/v+k[1])*b)}function $x(m,l,f,_,v,b,C,I,P,O,k){const U=m.text.placedSymbolArray,W=m.text.dynamicLayoutVertexArray,J=m.icon.dynamicLayoutVertexArray,ee={},Q=m.getProjection(),te=Jn(I,Q,b),V=b.elevation,K=Q.upVectorScale(I.canonical,b.center.lat,b.worldSize).metersToTile;W.clear();for(let se=0;se<U.length;se++){const ae=U.get(se),{tileAnchorX:ge,tileAnchorY:ve,numGlyphs:ye}=ae,Ie=ae.hidden||!ae.crossTileID||m.allowVerticalPlacement&&!ae.placedOrientation?null:_[ae.crossTileID];if(Ie){let Ce=0,Ne=0,rt=0;if(V){const st=V?V.getAtTileOffset(I,ge,ve):0,[Mt,jt,St]=Q.upVector(I.canonical,ge,ve);Ce=st*Mt*K,Ne=st*jt*K,rt=st*St*K}let[Le,Ye,Fe,nt]=Qr(ae.projectedAnchorX+Ce,ae.projectedAnchorY+Ne,ae.projectedAnchorZ+rt,f?te:C);const Re=W_(b.getCameraToCenterDistance(Q),nt);let Ze=v.evaluateSizeForFeature(m.textSizeData,O,ae)*Re/s.ONE_EM;f&&(Ze*=m.tilePixelRatio/P);const ot=vm(Ie,Ze);f?({x:Le,y:Ye,z:Fe}=Q.projectTilePoint(ge+ot.x,ve+ot.y,I.canonical),[Le,Ye,Fe]=Qr(Le+Ce,Ye+Ne,Fe+rt,C)):(l&&ot._rotate(-b.angle),Le+=ot.x,Ye+=ot.y,Fe=0);const Qe=m.allowVerticalPlacement&&ae.placedOrientation===s.WritingMode.vertical?Math.PI/2:0;for(let st=0;st<ye;st++)s.addDynamicAttributes(W,Le,Ye,Fe,Qe);k&&ae.associatedIconIndex>=0&&(ee[ae.associatedIconIndex]={x:Le,y:Ye,z:Fe,angle:Qe})}else is(ye,W)}if(k){J.clear();const se=m.icon.placedSymbolArray;for(let ae=0;ae<se.length;ae++){const ge=se.get(ae),{numGlyphs:ve}=ge,ye=ee[ae];if(ge.hidden||!ye)is(ve,J);else{const{x:Ie,y:Ce,z:Ne,angle:rt}=ye;for(let Le=0;Le<ve;Le++)s.addDynamicAttributes(J,Ie,Ce,Ne,rt)}}m.icon.dynamicLayoutVertexBuffer.updateData(J)}m.text.dynamicLayoutVertexBuffer.updateData(W)}function xm(m,l,f){return f.iconsInText&&l?"symbolTextAndIcon":m?"symbolSDF":"symbolIcon"}function uy(m,l,f,_,v,b,C,I,P,O,k,U){const W=m.context,J=W.gl,ee=m.transform,Q=I==="map",te=P==="map",V=Q&&f.layout.get("symbol-placement")!=="point",K=Q&&!te&&!V,se=f.layout.get("symbol-sort-key").constantOr(1)!==void 0;let ae=!1;const ge=m.depthModeForSublayer(0,s.DepthMode.ReadOnly),ve=[s.mercatorXfromLng(ee.center.lng),s.mercatorYfromLat(ee.center.lat)],ye=f.layout.get("text-variable-anchor"),Ie=ee.projection.name==="globe",Ce=[],Ne=[0,-1,0];let rt=Ne;!Ie&&!ee.mercatorFromTransition||Q||(rt=function(Le){const Ye=Le._camera.getWorldToCamera(Le.worldSize,1),Fe=s.multiply([],Ye,Le.globeMatrix);s.invert(Fe,Fe);const nt=[0,0,0],Re=[0,1,0,0];return s.transformMat4$1(Re,Re,Fe),nt[0]=Re[0],nt[1]=Re[1],nt[2]=Re[2],s.normalize(nt,nt),nt}(ee));for(const Le of _){const Ye=l.getTile(Le),Fe=Ye.getBucket(f);if(!Fe||Fe.projection.name==="mercator"&&Ie)continue;const nt=v?Fe.text:Fe.icon;if(!nt||Fe.fullyClipped||!nt.segments.get().length)continue;const Re=nt.programConfigurations.get(f.id),Ze=v||Fe.sdfIcons,ot=v?Fe.textSizeData:Fe.iconSizeData,Qe=te||ee.pitch!==0,st=s.evaluateSizeForZoom(ot,ee.zoom);let Mt,jt,St,Ot,an=[0,0],nn=null;if(v)jt=Ye.glyphAtlasTexture,St=J.LINEAR,Mt=Ye.glyphAtlasTexture.size,Fe.iconsInText&&(an=Ye.imageAtlasTexture.size,nn=Ye.imageAtlasTexture,Ot=Qe||m.options.rotating||m.options.zooming||ot.kind==="composite"||ot.kind==="camera"?J.LINEAR:J.NEAREST);else{const Sa=f.layout.get("icon-size").constantOr(0)!==1||Fe.iconsNeedLinear;jt=Ye.imageAtlasTexture,St=Ze||m.options.rotating||m.options.zooming||Sa||Qe?J.LINEAR:J.NEAREST,Mt=Ye.imageAtlasTexture.size}const It=Fe.projection.name==="globe",In=It?rt:Ne,Dn=It?s.globeToMercatorTransition(ee.zoom):0,Rn=Jn(Le,Fe.getProjection(),ee),Nn=ee.calculatePixelsToTileUnitsMatrix(Ye),Ei=Ge(Rn,Ye.tileID.canonical,te,Q,ee,Fe.getProjection(),Nn),ti=m.terrain&&te&&V?s.invert(s.create(),Ei):ly,Oo=Ir(Rn,Ye.tileID.canonical,te,Q,ee,Fe.getProjection(),Nn),zs=ye&&Fe.hasTextData(),Qn=f.layout.get("icon-text-fit")!=="none"&&zs&&Fe.hasIconData();if(V){const Sa=ee.elevation,hl=Sa?Sa.getAtTileOffsetFunc(Le,ee.center.lat,ee.worldSize,Fe.getProjection()):null,ru=ga(Rn,Ye.tileID.canonical,te,Q,ee,Fe.getProjection(),Nn);$d(Fe,Rn,m,v,ru,Oo,te,O,hl,Le)}const kn=V||v&&ye||Qn,yn=m.translatePosMatrix(Rn,Ye,b,C),Mr=kn?ly:Ei,Fi=m.translatePosMatrix(Oo,Ye,b,C,!0),Hn=Fe.getProjection().createInversionMatrix(ee,Le.canonical),Yi=[];m.terrainRenderModeElevated()&&te&&Yi.push("PITCH_WITH_MAP_TERRAIN"),It&&Yi.push("PROJECTION_GLOBE_VIEW"),kn&&Yi.push("PROJECTED_POS_ON_VIEWPORT");const lp=Ze&&f.paint.get(v?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let nu;nu=Ze?Fe.iconsInText?ay(ot.kind,st,K,te,m,yn,Mr,Fi,Mt,an,Le,Dn,ve,Hn,In,Fe.getProjection()):Xf(ot.kind,st,K,te,m,yn,Mr,Fi,v,Mt,!0,Le,Dn,ve,Hn,In,Fe.getProjection()):gm(ot.kind,st,K,te,m,yn,Mr,Fi,v,Mt,Le,Dn,ve,Hn,In,Fe.getProjection());const Ah={program:m.useProgram(xm(Ze,v,Fe),Re,Yi),buffers:nt,uniformValues:nu,atlasTexture:jt,atlasTextureIcon:nn,atlasInterpolation:St,atlasInterpolationIcon:Ot,isSDF:Ze,hasHalo:lp,tile:Ye,labelPlaneMatrixInv:ti};if(se&&Fe.canOverlap){ae=!0;const Sa=nt.segments.get();for(const hl of Sa)Ce.push({segments:new s.SegmentVector([hl]),sortKey:hl.sortKey,state:Ah})}else Ce.push({segments:nt.segments,sortKey:0,state:Ah})}ae&&Ce.sort((Le,Ye)=>Le.sortKey-Ye.sortKey);for(const Le of Ce){const Ye=Le.state;if(m.terrain&&m.terrain.setupElevationDraw(Ye.tile,Ye.program,{useDepthForOcclusion:!Ie,labelPlaneMatrixInv:Ye.labelPlaneMatrixInv}),W.activeTexture.set(J.TEXTURE0),Ye.atlasTexture.bind(Ye.atlasInterpolation,J.CLAMP_TO_EDGE),Ye.atlasTextureIcon&&(W.activeTexture.set(J.TEXTURE1),Ye.atlasTextureIcon&&Ye.atlasTextureIcon.bind(Ye.atlasInterpolationIcon,J.CLAMP_TO_EDGE)),Ye.isSDF){const Fe=Ye.uniformValues;Ye.hasHalo&&(Fe.u_is_halo=1,vh(Ye.buffers,Le.segments,f,m,Ye.program,ge,k,U,Fe)),Fe.u_is_halo=0}vh(Ye.buffers,Le.segments,f,m,Ye.program,ge,k,U,Ye.uniformValues)}}function vh(m,l,f,_,v,b,C,I,P){const O=_.context,k=[m.dynamicLayoutVertexBuffer,m.opacityVertexBuffer,m.globeExtVertexBuffer];v.draw(O,O.gl.TRIANGLES,b,C,I,s.CullFaceMode.disabled,P,f.id,m.layoutVertexBuffer,m.indexBuffer,l,f.paint,_.transform.zoom,m.programConfigurations.get(f.id),k)}function cy(m,l,f,_,v,b,C){const I=m.context.gl,P=f.paint.get("fill-pattern"),O=P&&P.constantOr(1);let k,U,W,J,ee;C?(U=O&&!f.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",k=I.LINES):(U=O?"fillPattern":"fill",k=I.TRIANGLES);for(const Q of _){const te=l.getTile(Q);if(O&&!te.patternsLoaded())continue;const V=te.getBucket(f);if(!V)continue;m.prepareDrawTile();const K=V.programConfigurations.get(f.id),se=m.useProgram(U,K);O&&(m.context.activeTexture.set(I.TEXTURE0),te.imageAtlasTexture.bind(I.LINEAR,I.CLAMP_TO_EDGE),K.updatePaintBuffers());const ae=P.constantOr(null);if(ae&&te.imageAtlas){const ve=te.imageAtlas.patternPositions[ae.toString()];ve&&K.setConstantPatternPositions(ve)}const ge=m.translatePosMatrix(Q.projMatrix,te,f.paint.get("fill-translate"),f.paint.get("fill-translate-anchor"));if(C){J=V.indexBuffer2,ee=V.segments2;const ve=m.terrain&&m.terrain.renderingToTexture?m.terrain.drapeBufferSize:[I.drawingBufferWidth,I.drawingBufferHeight];W=U==="fillOutlinePattern"&&O?jx(ge,m,te,ve):Vx(ge,ve)}else J=V.indexBuffer,ee=V.segments,W=O?cm(ge,m,te):Jl(ge);m.prepareDrawProgram(m.context,se,Q.toUnwrapped()),se.draw(m.context,k,v,m.stencilModeForClipping(Q),b,s.CullFaceMode.disabled,W,f.id,V.layoutVertexBuffer,J,ee,f.paint,m.transform.zoom,K)}}function Zf(m,l,f,_,v,b,C){const I=m.context,P=I.gl,O=m.transform,k=f.paint.get("fill-extrusion-pattern"),U=k.constantOr(1),W=f.paint.get("fill-extrusion-opacity"),J=[f.paint.get("fill-extrusion-ambient-occlusion-intensity"),f.paint.get("fill-extrusion-ambient-occlusion-radius")],ee=f.layout.get("fill-extrusion-edge-radius"),Q=ee>0&&!f.paint.get("fill-extrusion-rounded-roof"),te=Q?0:ee,V=O.projection.name==="globe"?s.fillExtrusionHeightLift():0,K=O.projection.name==="globe",se=K?s.globeToMercatorTransition(O.zoom):0,ae=[s.mercatorXfromLng(O.center.lng),s.mercatorYfromLat(O.center.lat)],ge=[];K&&ge.push("PROJECTION_GLOBE_VIEW"),J[0]>0&&ge.push("FAUX_AO"),Q&&ge.push("ZERO_ROOF_RADIUS");for(const ve of _){const ye=l.getTile(ve),Ie=ye.getBucket(f);if(!Ie||Ie.projection.name!==O.projection.name)continue;const Ce=Ie.programConfigurations.get(f.id),Ne=m.useProgram(U?"fillExtrusionPattern":"fillExtrusion",Ce,ge);if(m.terrain){const Ze=m.terrain;if(m.style.terrainSetForDrapingOnly())Ze.setupElevationDraw(ye,Ne,{useMeterToDem:!0});else{if(!Ie.enableTerrain)continue;if(Ze.setupElevationDraw(ye,Ne,{useMeterToDem:!0}),hy(I,l,ve,Ie,f,Ze),!Ie.centroidVertexBuffer){const ot=Ne.attributes.a_centroid_pos;ot!==void 0&&P.vertexAttrib2f(ot,0,0)}}}U&&(m.context.activeTexture.set(P.TEXTURE0),ye.imageAtlasTexture.bind(P.LINEAR,P.CLAMP_TO_EDGE),Ce.updatePaintBuffers());const rt=k.constantOr(null);if(rt&&ye.imageAtlas){const Ze=ye.imageAtlas.patternPositions[rt.toString()];Ze&&Ce.setConstantPatternPositions(Ze)}const Le=m.translatePosMatrix(ve.projMatrix,ye,f.paint.get("fill-extrusion-translate"),f.paint.get("fill-extrusion-translate-anchor")),Ye=O.projection.createInversionMatrix(O,ve.canonical),Fe=f.paint.get("fill-extrusion-vertical-gradient"),nt=U?iy(Le,m,Fe,W,J,te,ve,ye,V,se,ae,Ye):um(Le,m,Fe,W,J,te,ve,V,se,ae,Ye);m.prepareDrawProgram(I,Ne,ve.toUnwrapped());const Re=[];m.terrain&&Re.push(Ie.centroidVertexBuffer),K&&Re.push(Ie.layoutVertexExtBuffer),Ne.draw(I,I.gl.TRIANGLES,v,b,C,s.CullFaceMode.backCCW,nt,f.id,Ie.layoutVertexBuffer,Ie.indexBuffer,Ie.segments,f.paint,m.transform.zoom,Ce,Re)}}function hy(m,l,f,_,v,b){const C=[V=>{let K=V.canonical.x-1,se=V.wrap;return K<0&&(K=(1<<V.canonical.z)-1,se--),new s.OverscaledTileID(V.overscaledZ,se,V.canonical.z,K,V.canonical.y)},V=>{let K=V.canonical.x+1,se=V.wrap;return K===1<<V.canonical.z&&(K=0,se++),new s.OverscaledTileID(V.overscaledZ,se,V.canonical.z,K,V.canonical.y)},V=>new s.OverscaledTileID(V.overscaledZ,V.wrap,V.canonical.z,V.canonical.x,(V.canonical.y===0?1<<V.canonical.z:V.canonical.y)-1),V=>new s.OverscaledTileID(V.overscaledZ,V.wrap,V.canonical.z,V.canonical.x,V.canonical.y===(1<<V.canonical.z)-1?0:V.canonical.y+1)],I=V=>{const K=l.getSource().minzoom,se=ge=>{const ve=l.getTileByID(ge);if(ve&&ve.hasData())return ve.getBucket(v)},ae=[0,-1,1];for(const ge of ae){if(V.overscaledZ+ge<K)continue;const ve=se(V.calculateScaledKey(V.overscaledZ+ge));if(ve)return ve}},P=[0,0,0],O=(V,K)=>(P[0]=Math.min(V.min.y,K.min.y),P[1]=Math.max(V.max.y,K.max.y),P[2]=s.EXTENT-K.min.x>V.max.x?K.min.x-s.EXTENT:V.max.x,P),k=(V,K)=>(P[0]=Math.min(V.min.x,K.min.x),P[1]=Math.max(V.max.x,K.max.x),P[2]=s.EXTENT-K.min.y>V.max.y?K.min.y-s.EXTENT:V.max.y,P),U=[(V,K)=>O(V,K),(V,K)=>O(K,V),(V,K)=>k(V,K),(V,K)=>k(K,V)],W=new s.Point(0,0);let J,ee,Q;const te=(V,K,se,ae,ge)=>{const ve=[[ae?se:V,ae?V:se,0],[ae?se:K,ae?K:se,0]],ye=ge<0?s.EXTENT+ge:ge,Ie=[ae?ye:(V+K)/2,ae?(V+K)/2:ye,0];return se===0&&ge<0||se!==0&&ge>0?b.getForTilePoints(Q,[Ie],!0,ee):ve.push(Ie),b.getForTilePoints(f,ve,!0,J),Math.max(ve[0][2],ve[1][2],Ie[2])/b.exaggeration()};for(let V=0;V<4;V++){const K=(V<2?1:5)-V,se=_.borders[V];if(se.length===0)continue;const ae=Q=C[V](f),ge=I(ae);if(!(ge&&ge instanceof s.FillExtrusionBucket&&ge.enableTerrain)||_.borderDoneWithNeighborZ[V]===ge.canonical.z&&ge.borderDoneWithNeighborZ[K]===_.canonical.z||(ee=b.findDEMTileFor(ae),!ee||!ee.dem))continue;if(!J){const Ce=b.findDEMTileFor(f);if(!Ce||!Ce.dem)return;J=Ce}const ve=ge.borders[K];let ye=0;const Ie=ge.borderDoneWithNeighborZ[K]!==_.canonical.z;if(_.canonical.z===ge.canonical.z){for(let Ce=0;Ce<se.length;Ce++){const Ne=_.featuresOnBorder[se[Ce]],rt=Ne.borders[V];let Le;for(;ye<ve.length&&(Le=ge.featuresOnBorder[ve[ye]],!(Le.borders[K][1]>rt[0]+3));)Ie&&ge.encodeCentroid(void 0,Le,!1),ye++;if(Le&&ye<ve.length){const Ye=ye;let Fe=0;for(;!(Le.borders[K][0]>rt[1]-3)&&(Fe++,++ye!==ve.length);)Le=ge.featuresOnBorder[ve[ye]];if(Le=ge.featuresOnBorder[ve[Ye]],Ne.intersectsCount()>1||Le.intersectsCount()>1||Fe!==1){Fe!==1&&(ye=Ye),_.encodeCentroid(void 0,Ne,!1),Ie&&ge.encodeCentroid(void 0,Le,!1);continue}const nt=U[V](Ne,Le),Re=V%2?s.EXTENT-1:0;W.x=te(nt[0],Math.min(s.EXTENT-1,nt[1]),Re,V<2,nt[2]),W.y=0,_.encodeCentroid(W,Ne,!1),Ie&&ge.encodeCentroid(W,Le,!1)}else _.encodeCentroid(void 0,Ne,!1)}_.borderDoneWithNeighborZ[V]=ge.canonical.z,_.needsCentroidUpdate=!0,Ie&&(ge.borderDoneWithNeighborZ[K]=_.canonical.z,ge.needsCentroidUpdate=!0)}else{for(const Ce of se)_.encodeCentroid(void 0,_.featuresOnBorder[Ce],!1);if(Ie){for(const Ce of ve)ge.encodeCentroid(void 0,ge.featuresOnBorder[Ce],!1);ge.borderDoneWithNeighborZ[K]=_.canonical.z,ge.needsCentroidUpdate=!0}_.borderDoneWithNeighborZ[V]=ge.canonical.z,_.needsCentroidUpdate=!0}}(_.needsCentroidUpdate||!_.centroidVertexBuffer&&_.centroidVertexArray.length!==0)&&_.uploadCentroid(m)}const Yu=new s.Color(1,0,0,1),Zx=new s.Color(0,1,0,1),Wx=new s.Color(0,0,1,1),Hx=new s.Color(1,0,1,1),Yx=new s.Color(0,1,1,1);function Kx(m,l,f){const _=m.context,v=m.transform,b=_.gl,C=v.projection.name==="globe",I=C?["PROJECTION_GLOBE_VIEW"]:null;let P=f.projMatrix;if(C&&s.globeToMercatorTransition(v.zoom)>0){const Ne=s.transitionTileAABBinECEF(f.canonical,v),rt=s.globeDenormalizeECEF(Ne);P=s.multiply(new Float32Array(16),v.globeMatrix,rt),s.multiply(P,v.projMatrix,P)}const O=m.useProgram("debug",null,I),k=l.getTileByID(f.key);m.terrain&&m.terrain.setupElevationDraw(k,O);const U=s.DepthMode.disabled,W=s.StencilMode.disabled,J=m.colorModeForRenderPass(),ee="$debug";_.activeTexture.set(b.TEXTURE0),m.emptyTexture.bind(b.LINEAR,b.CLAMP_TO_EDGE),C?k._makeGlobeTileDebugBuffers(m.context,v):k._makeDebugTileBoundsBuffers(m.context,v.projection);const Q=k._tileDebugBuffer||m.debugBuffer,te=k._tileDebugIndexBuffer||m.debugIndexBuffer,V=k._tileDebugSegments||m.debugSegments;O.draw(_,b.LINE_STRIP,U,W,J,s.CullFaceMode.disabled,Gf(P,s.Color.red),ee,Q,te,V,null,null,null,[k._globeTileDebugBorderBuffer]);const K=k.latestRawTileData,se=Math.floor((K&&K.byteLength||0)/1024),ae=l.getTile(f).tileSize,ge=512/Math.min(ae,512)*(f.overscaledZ/v.zoom)*.5;let ve=f.canonical.toString();f.overscaledZ!==f.canonical.z&&(ve+=` => ${f.overscaledZ}`),ve+=` ${se}kb`,function(Ne,rt){Ne.initDebugOverlayCanvas();const Le=Ne.debugOverlayCanvas,Ye=Ne.context.gl,Fe=Ne.debugOverlayCanvas.getContext("2d");Fe.clearRect(0,0,Le.width,Le.height),Fe.shadowColor="white",Fe.shadowBlur=2,Fe.lineWidth=1.5,Fe.strokeStyle="white",Fe.textBaseline="top",Fe.font="bold 36px Open Sans, sans-serif",Fe.fillText(rt,5,5),Fe.strokeText(rt,5,5),Ne.debugOverlayTexture.update(Le),Ne.debugOverlayTexture.bind(Ye.LINEAR,Ye.CLAMP_TO_EDGE)}(m,ve);const ye=k._tileDebugTextBuffer||m.debugBuffer,Ie=k._tileDebugTextIndexBuffer||m.quadTriangleIndexBuffer,Ce=k._tileDebugTextSegments||m.debugSegments;O.draw(_,b.TRIANGLES,U,W,s.ColorMode.alphaBlended,s.CullFaceMode.disabled,Gf(P,s.Color.transparent,ge),ee,ye,Ie,Ce,null,null,null,[k._globeTileDebugTextBuffer])}function fy(m,l,f,_){Ku(m,0,l+f/2,m.transform.width,f,_)}function Wf(m,l,f,_){Ku(m,l-f/2,0,f,m.transform.height,_)}function Ku(m,l,f,_,v,b){const C=m.context,I=C.gl;I.enable(I.SCISSOR_TEST),I.scissor(l*s.exported.devicePixelRatio,f*s.exported.devicePixelRatio,_*s.exported.devicePixelRatio,v*s.exported.devicePixelRatio),C.clear({color:b}),I.disable(I.SCISSOR_TEST)}const py=s.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:dy}=py;function ba(m,l,f,_){m.emplaceBack(l,f,_)}class Hf{constructor(l){this.vertexArray=new s.StructArrayLayout3f12,this.indices=new s.StructArrayLayout3ui6,ba(this.vertexArray,-1,-1,1),ba(this.vertexArray,1,-1,1),ba(this.vertexArray,-1,1,1),ba(this.vertexArray,1,1,1),ba(this.vertexArray,-1,-1,-1),ba(this.vertexArray,1,-1,-1),ba(this.vertexArray,-1,1,-1),ba(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=l.createVertexBuffer(this.vertexArray,dy),this.indexBuffer=l.createIndexBuffer(this.indices),this.segment=s.SegmentVector.simpleSegment(0,0,36,12)}}function No(m,l,f,_,v,b){const C=m.gl,I=l.paint.get("sky-atmosphere-color"),P=l.paint.get("sky-atmosphere-halo-color"),O=l.paint.get("sky-atmosphere-sun-intensity"),k=((U,W,J,ee,Q)=>({u_matrix_3f:U,u_sun_direction:W,u_sun_intensity:J,u_color_tint_r:[ee.r,ee.g,ee.b,ee.a],u_color_tint_m:[Q.r,Q.g,Q.b,Q.a],u_luminance:5e-5}))(s.fromMat4(s.create$1(),_),v,O,I,P);C.framebufferTexture2D(C.FRAMEBUFFER,C.COLOR_ATTACHMENT0,C.TEXTURE_CUBE_MAP_POSITIVE_X+b,l.skyboxTexture,0),f.draw(m,C.TRIANGLES,s.DepthMode.disabled,s.StencilMode.disabled,s.ColorMode.unblended,s.CullFaceMode.frontCW,k,"skyboxCapture",l.skyboxGeometry.vertexBuffer,l.skyboxGeometry.indexBuffer,l.skyboxGeometry.segment)}const xh=s.createLayout([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class my{constructor(l){const f=new s.StructArrayLayout5f20;f.emplaceBack(-1,1,1,0,0),f.emplaceBack(1,1,1,1,0),f.emplaceBack(1,-1,1,1,1),f.emplaceBack(-1,-1,1,0,1);const _=new s.StructArrayLayout3ui6;_.emplaceBack(0,1,2),_.emplaceBack(2,3,0),this.vertexBuffer=l.createVertexBuffer(f,xh.members),this.indexBuffer=l.createIndexBuffer(_),this.segments=s.SegmentVector.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const Ql={symbol:function(m,l,f,_,v){if(m.renderPass!=="translucent")return;const b=s.StencilMode.disabled,C=m.colorModeForRenderPass();f.layout.get("text-variable-anchor")&&function(I,P,O,k,U,W,J){const ee=P.transform,Q=U==="map",te=W==="map";for(const V of I){const K=k.getTile(V),se=K.getBucket(O);if(!se||!se.text||!se.text.segments.get().length)continue;const ae=s.evaluateSizeForZoom(se.textSizeData,ee.zoom),ge=Jn(V,se.getProjection(),ee),ve=ee.calculatePixelsToTileUnitsMatrix(K),ye=Ge(ge,K.tileID.canonical,te,Q,ee,se.getProjection(),ve),Ie=O.layout.get("icon-text-fit")!=="none"&&se.hasIconData();if(ae){const Ce=Math.pow(2,ee.zoom-K.tileID.overscaledZ);$x(se,Q,te,J,s.symbolSize,ee,ye,V,Ce,ae,Ie)}}}(_,m,f,l,f.layout.get("text-rotation-alignment"),f.layout.get("text-pitch-alignment"),v),f.paint.get("icon-opacity").constantOr(1)!==0&&uy(m,l,f,_,!1,f.paint.get("icon-translate"),f.paint.get("icon-translate-anchor"),f.layout.get("icon-rotation-alignment"),f.layout.get("icon-pitch-alignment"),f.layout.get("icon-keep-upright"),b,C),f.paint.get("text-opacity").constantOr(1)!==0&&uy(m,l,f,_,!0,f.paint.get("text-translate"),f.paint.get("text-translate-anchor"),f.layout.get("text-rotation-alignment"),f.layout.get("text-pitch-alignment"),f.layout.get("text-keep-upright"),b,C),l.map.showCollisionBoxes&&(yh(m,l,f,_,f.paint.get("text-translate"),f.paint.get("text-translate-anchor"),!0),yh(m,l,f,_,f.paint.get("icon-translate"),f.paint.get("icon-translate-anchor"),!1))},circle:function(m,l,f,_){if(m.renderPass!=="translucent")return;const v=f.paint.get("circle-opacity"),b=f.paint.get("circle-stroke-width"),C=f.paint.get("circle-stroke-opacity"),I=f.layout.get("circle-sort-key").constantOr(1)!==void 0;if(v.constantOr(1)===0&&(b.constantOr(1)===0||C.constantOr(1)===0))return;const P=m.context,O=P.gl,k=m.transform,U=m.depthModeForSublayer(0,s.DepthMode.ReadOnly),W=s.StencilMode.disabled,J=m.colorModeForRenderPass(),ee=k.projection.name==="globe",Q=[s.mercatorXfromLng(k.center.lng),s.mercatorYfromLat(k.center.lat)],te=[];for(let K=0;K<_.length;K++){const se=_[K],ae=l.getTile(se),ge=ae.getBucket(f);if(!ge||ge.projection.name!==k.projection.name)continue;const ve=ge.programConfigurations.get(f.id),ye=fm(f);ee&&ye.push("PROJECTION_GLOBE_VIEW");const Ie=m.useProgram("circle",ve,ye),Ce=ge.layoutVertexBuffer,Ne=ge.globeExtVertexBuffer,rt=ge.indexBuffer,Le=k.projection.createInversionMatrix(k,se.canonical),Ye={programConfiguration:ve,program:Ie,layoutVertexBuffer:Ce,globeExtVertexBuffer:Ne,indexBuffer:rt,uniformValues:hm(m,se,ae,Le,Q,f),tile:ae};if(I){const Fe=ge.segments.get();for(const nt of Fe)te.push({segments:new s.SegmentVector([nt]),sortKey:nt.sortKey,state:Ye})}else te.push({segments:ge.segments,sortKey:0,state:Ye})}I&&te.sort((K,se)=>K.sortKey-se.sortKey);const V={useDepthForOcclusion:!ee};for(const K of te){const{programConfiguration:se,program:ae,layoutVertexBuffer:ge,globeExtVertexBuffer:ve,indexBuffer:ye,uniformValues:Ie,tile:Ce}=K.state,Ne=K.segments;m.terrain&&m.terrain.setupElevationDraw(Ce,ae,V),m.prepareDrawProgram(P,ae,Ce.tileID.toUnwrapped()),ae.draw(P,O.TRIANGLES,U,W,J,s.CullFaceMode.disabled,Ie,f.id,ge,ye,Ne,f.paint,k.zoom,se,[ve])}},heatmap:function(m,l,f,_){if(f.paint.get("heatmap-opacity")!==0)if(m.renderPass==="offscreen"){const v=m.context,b=v.gl,C=s.StencilMode.disabled,I=new s.ColorMode([b.ONE,b.ONE],s.Color.transparent,[!0,!0,!0,!0]);(function(J,ee,Q,te){const V=J.gl,K=ee.width*te,se=ee.height*te;J.activeTexture.set(V.TEXTURE1),J.viewport.set([0,0,K,se]);let ae=Q.heatmapFbo;if(!ae||ae&&(ae.width!==K||ae.height!==se)){ae&&ae.destroy();const ge=V.createTexture();V.bindTexture(V.TEXTURE_2D,ge),V.texParameteri(V.TEXTURE_2D,V.TEXTURE_WRAP_S,V.CLAMP_TO_EDGE),V.texParameteri(V.TEXTURE_2D,V.TEXTURE_WRAP_T,V.CLAMP_TO_EDGE),V.texParameteri(V.TEXTURE_2D,V.TEXTURE_MIN_FILTER,V.LINEAR),V.texParameteri(V.TEXTURE_2D,V.TEXTURE_MAG_FILTER,V.LINEAR),ae=Q.heatmapFbo=J.createFramebuffer(K,se,!1),function(ve,ye,Ie,Ce,Ne,rt){const Le=ve.gl;Le.texImage2D(Le.TEXTURE_2D,0,ve.isWebGL2&&ve.extRenderToTextureHalfFloat?Le.RGBA16F:Le.RGBA,Ne,rt,0,Le.RGBA,ve.extRenderToTextureHalfFloat?ve.isWebGL2?Le.HALF_FLOAT:ve.extTextureHalfFloat.HALF_FLOAT_OES:Le.UNSIGNED_BYTE,null),Ce.colorAttachment.set(Ie)}(J,0,ge,ae,K,se)}else V.bindTexture(V.TEXTURE_2D,ae.colorAttachment.get()),J.bindFramebuffer.set(ae.framebuffer)})(v,m,f,m.transform.projection.name==="globe"?.5:.25),v.clear({color:s.Color.transparent});const P=m.transform,O=P.projection.name==="globe",k=O?["PROJECTION_GLOBE_VIEW"]:null,U=O?s.CullFaceMode.frontCCW:s.CullFaceMode.disabled,W=[s.mercatorXfromLng(P.center.lng),s.mercatorYfromLat(P.center.lat)];for(let J=0;J<_.length;J++){const ee=_[J];if(l.hasRenderableParent(ee))continue;const Q=l.getTile(ee),te=Q.getBucket(f);if(!te||te.projection.name!==P.projection.name)continue;const V=te.programConfigurations.get(f.id),K=m.useProgram("heatmap",V,k),{zoom:se}=m.transform;m.terrain&&m.terrain.setupElevationDraw(Q,K),m.prepareDrawProgram(v,K,ee.toUnwrapped());const ae=P.projection.createInversionMatrix(P,ee.canonical);K.draw(v,b.TRIANGLES,s.DepthMode.disabled,C,I,U,sy(m,ee,Q,ae,W,se,f.paint.get("heatmap-intensity")),f.id,te.layoutVertexBuffer,te.indexBuffer,te.segments,f.paint,m.transform.zoom,V,O?[te.globeExtVertexBuffer]:null)}v.viewport.set([0,0,m.width,m.height])}else m.renderPass==="translucent"&&(m.context.setColorMode(m.colorModeForRenderPass()),function(v,b){const C=v.context,I=C.gl,P=b.heatmapFbo;if(!P)return;C.activeTexture.set(I.TEXTURE0),I.bindTexture(I.TEXTURE_2D,P.colorAttachment.get()),C.activeTexture.set(I.TEXTURE1);let O=b.colorRampTexture;O||(O=b.colorRampTexture=new s.Texture(C,b.colorRamp,I.RGBA)),O.bind(I.LINEAR,I.CLAMP_TO_EDGE),v.useProgram("heatmapTexture").draw(C,I.TRIANGLES,s.DepthMode.disabled,s.StencilMode.disabled,v.colorModeForRenderPass(),s.CullFaceMode.disabled,((k,U,W,J)=>({u_image:0,u_color_ramp:1,u_opacity:U.paint.get("heatmap-opacity")}))(0,b),b.id,v.viewportBuffer,v.quadTriangleIndexBuffer,v.viewportSegments,b.paint,v.transform.zoom)}(m,f))},line:function(m,l,f,_){if(m.renderPass!=="translucent")return;const v=f.paint.get("line-opacity"),b=f.paint.get("line-width");if(v.constantOr(1)===0||b.constantOr(1)===0)return;const C=m.depthModeForSublayer(0,s.DepthMode.ReadOnly),I=m.colorModeForRenderPass(),P=m.terrain&&m.terrain.renderingToTexture?1:s.exported.devicePixelRatio,O=f.paint.get("line-dasharray"),k=O.constantOr(1),U=f.layout.get("line-cap"),W=f.paint.get("line-pattern"),J=W.constantOr(1),ee=f.paint.get("line-gradient"),Q=J?"linePattern":"line",te=m.context,V=te.gl,K=(ae=>{const ge=[];_h(ae)&&ge.push("RENDER_LINE_DASH"),ae.paint.get("line-gradient")&&ge.push("RENDER_LINE_GRADIENT");const ve=ae.paint.get("line-trim-offset");ve[0]===0&&ve[1]===0||ge.push("RENDER_LINE_TRIM_OFFSET");const ye=ae.paint.get("line-pattern").constantOr(1),Ie=ae.paint.get("line-opacity").constantOr(1)!==1;return!ye&&Ie&&ge.push("RENDER_LINE_ALPHA_DISCARD"),ge})(f);let se=K.includes("RENDER_LINE_ALPHA_DISCARD");m.terrain&&m.terrain.clipOrMaskOverlapStencilType()&&(se=!1);for(const ae of _){const ge=l.getTile(ae);if(J&&!ge.patternsLoaded())continue;const ve=ge.getBucket(f);if(!ve)continue;m.prepareDrawTile();const ye=ve.programConfigurations.get(f.id),Ie=m.useProgram(Q,ye,K),Ce=W.constantOr(null);if(Ce&&ge.imageAtlas){const Ze=ge.imageAtlas.patternPositions[Ce.toString()];Ze&&ye.setConstantPatternPositions(Ze)}const Ne=O.constantOr(null),rt=U.constantOr(null);if(!J&&Ne&&rt&&ge.lineAtlas){const Ze=ge.lineAtlas.getDash(Ne,rt);Ze&&ye.setConstantPatternPositions(Ze)}let[Le,Ye]=f.paint.get("line-trim-offset");(rt==="round"||rt==="square")&&Le!==Ye&&(Le===0&&(Le-=1),Ye===1&&(Ye+=1));const Fe=m.terrain?ae.projMatrix:null,nt=J?gh(m,ge,f,Fe,P):qx(m,ge,f,Fe,ve.lineClipsArray.length,P,[Le,Ye]);if(ee){const Ze=ve.gradients[f.id];let ot=Ze.texture;if(f.gradientVersion!==Ze.version){let Qe=256;if(f.stepInterpolant){const st=l.getSource().maxzoom,Mt=ae.canonical.z===st?Math.ceil(1<<m.transform.maxZoom-ae.canonical.z):1;Qe=s.clamp(s.nextPowerOfTwo(ve.maxLineLength/s.EXTENT*1024*Mt),256,te.maxTextureSize)}Ze.gradient=s.renderColorRamp({expression:f.gradientExpression(),evaluationKey:"lineProgress",resolution:Qe,image:Ze.gradient||void 0,clips:ve.lineClipsArray}),Ze.texture?Ze.texture.update(Ze.gradient):Ze.texture=new s.Texture(te,Ze.gradient,V.RGBA),Ze.version=f.gradientVersion,ot=Ze.texture}te.activeTexture.set(V.TEXTURE1),ot.bind(f.stepInterpolant?V.NEAREST:V.LINEAR,V.CLAMP_TO_EDGE)}k&&(te.activeTexture.set(V.TEXTURE0),ge.lineAtlasTexture.bind(V.LINEAR,V.REPEAT),ye.updatePaintBuffers()),J&&(te.activeTexture.set(V.TEXTURE0),ge.imageAtlasTexture.bind(V.LINEAR,V.CLAMP_TO_EDGE),ye.updatePaintBuffers()),m.prepareDrawProgram(te,Ie,ae.toUnwrapped());const Re=Ze=>{Ie.draw(te,V.TRIANGLES,C,Ze,I,s.CullFaceMode.disabled,nt,f.id,ve.layoutVertexBuffer,ve.indexBuffer,ve.segments,f.paint,m.transform.zoom,ye,[ve.layoutVertexBuffer2])};if(se){const Ze=m.stencilModeForClipping(ae).ref;Ze===0&&m.terrain&&te.clear({stencil:0});const ot={func:V.EQUAL,mask:255};nt.u_alpha_discard_threshold=.8,Re(new s.StencilMode(ot,Ze,255,V.KEEP,V.KEEP,V.INVERT)),nt.u_alpha_discard_threshold=0,Re(new s.StencilMode(ot,Ze,255,V.KEEP,V.KEEP,V.KEEP))}else Re(m.stencilModeForClipping(ae))}se&&(m.resetStencilClippingMasks(),m.terrain&&te.clear({stencil:0}))},fill:function(m,l,f,_){const v=f.paint.get("fill-color"),b=f.paint.get("fill-opacity");if(b.constantOr(1)===0)return;const C=m.colorModeForRenderPass(),I=f.paint.get("fill-pattern"),P=m.opaquePassEnabledForLayer()&&!I.constantOr(1)&&v.constantOr(s.Color.transparent).a===1&&b.constantOr(0)===1?"opaque":"translucent";if(m.renderPass===P){const O=m.depthModeForSublayer(1,m.renderPass==="opaque"?s.DepthMode.ReadWrite:s.DepthMode.ReadOnly);cy(m,l,f,_,O,C,!1)}if(m.renderPass==="translucent"&&f.paint.get("fill-antialias")){const O=m.depthModeForSublayer(f.getPaintProperty("fill-outline-color")?2:0,s.DepthMode.ReadOnly);cy(m,l,f,_,O,C,!0)}},"fill-extrusion":function(m,l,f,_){const v=f.paint.get("fill-extrusion-opacity");if(v!==0&&m.renderPass==="translucent"){const b=new s.DepthMode(m.context.gl.LEQUAL,s.DepthMode.ReadWrite,m.depthRangeFor3D);if(v!==1||f.paint.get("fill-extrusion-pattern").constantOr(1))Zf(m,l,f,_,b,s.StencilMode.disabled,s.ColorMode.disabled),Zf(m,l,f,_,b,m.stencilModeFor3D(),m.colorModeForRenderPass()),m.resetStencilClippingMasks();else{const C=m.colorModeForRenderPass();Zf(m,l,f,_,b,s.StencilMode.disabled,C)}}},hillshade:function(m,l,f,_){if(m.renderPass!=="offscreen"&&m.renderPass!=="translucent")return;const v=m.context,b=m.depthModeForSublayer(0,s.DepthMode.ReadOnly),C=m.colorModeForRenderPass(),I=m.terrain&&m.terrain.renderingToTexture,[P,O]=m.renderPass!=="translucent"||I?[{},_]:m.stencilConfigForOverlap(_);for(const k of O){const U=l.getTile(k);if(U.needsHillshadePrepare&&m.renderPass==="offscreen")ty(m,U,f,b,s.StencilMode.disabled,C);else if(m.renderPass==="translucent"){const W=I&&m.terrain?m.terrain.stencilModeForRTTOverlap(k):P[k.overscaledZ];ey(m,k,U,f,b,W,C)}}v.viewport.set([0,0,m.width,m.height]),m.resetStencilClippingMasks()},raster:function(m,l,f,_,v,b){if(m.renderPass!=="translucent"||f.paint.get("raster-opacity")===0||!_.length)return;const C=m.context,I=C.gl,P=l.getSource(),O=m.useProgram("raster"),k=m.colorModeForRenderPass(),U=m.terrain&&m.terrain.renderingToTexture,[W,J]=P instanceof en||U?[{},_]:m.stencilConfigForOverlap(_),ee=J[J.length-1].overscaledZ,Q=!m.options.moving;for(const te of J){const V=U?s.DepthMode.disabled:m.depthModeForSublayer(te.overscaledZ-ee,f.paint.get("raster-opacity")===1?s.DepthMode.ReadWrite:s.DepthMode.ReadOnly,I.LESS),K=te.toUnwrapped(),se=l.getTile(te);if(U&&(!se||!se.hasData()))continue;const ae=U?te.projMatrix:m.transform.calculateProjMatrix(K,Q),ge=m.terrain&&U?m.terrain.stencilModeForRTTOverlap(te):W[te.overscaledZ],ve=b?0:f.paint.get("raster-fade-duration");se.registerFadeDuration(ve);const ye=l.findLoadedParent(te,0),Ie=sm(se,ye,l,m.transform,ve);let Ce,Ne;m.terrain&&m.terrain.prepareDrawTile();const rt=f.paint.get("raster-resampling")==="nearest"?I.NEAREST:I.LINEAR;C.activeTexture.set(I.TEXTURE0),se.texture.bind(rt,I.CLAMP_TO_EDGE),C.activeTexture.set(I.TEXTURE1),ye?(ye.texture.bind(rt,I.CLAMP_TO_EDGE),Ce=Math.pow(2,ye.tileID.overscaledZ-se.tileID.overscaledZ),Ne=[se.tileID.canonical.x*Ce%1,se.tileID.canonical.y*Ce%1]):se.texture.bind(rt,I.CLAMP_TO_EDGE),se.texture.useMipmap&&C.extTextureFilterAnisotropic&&m.transform.pitch>20&&I.texParameterf(I.TEXTURE_2D,C.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,C.extTextureFilterAnisotropicMax);const Le=mm(ae,Ne||[0,0],Ce||1,Ie,f,P instanceof en?P.perspectiveTransform:[0,0]);if(m.prepareDrawProgram(C,O,K),P instanceof en)P.boundsBuffer&&P.boundsSegments&&O.draw(C,I.TRIANGLES,V,s.StencilMode.disabled,k,s.CullFaceMode.disabled,Le,f.id,P.boundsBuffer,m.quadTriangleIndexBuffer,P.boundsSegments);else{const{tileBoundsBuffer:Ye,tileBoundsIndexBuffer:Fe,tileBoundsSegments:nt}=m.getTileBoundsBuffers(se);O.draw(C,I.TRIANGLES,V,ge,k,s.CullFaceMode.disabled,Le,f.id,Ye,Fe,nt)}}m.resetStencilClippingMasks()},background:function(m,l,f,_){const v=f.paint.get("background-color"),b=f.paint.get("background-opacity");if(b===0)return;const C=m.context,I=C.gl,P=m.transform,O=P.tileSize,k=f.paint.get("background-pattern");if(m.isPatternMissing(k))return;const U=!k&&v.a===1&&b===1&&m.opaquePassEnabledForLayer()?"opaque":"translucent";if(m.renderPass!==U)return;const W=s.StencilMode.disabled,J=m.depthModeForSublayer(0,U==="opaque"?s.DepthMode.ReadWrite:s.DepthMode.ReadOnly),ee=m.colorModeForRenderPass(),Q=m.useProgram(k?"backgroundPattern":"background");let te,V=_;V||(te=m.getBackgroundTiles(),V=Object.values(te).map(K=>K.tileID)),k&&(C.activeTexture.set(I.TEXTURE0),m.imageManager.bind(m.context));for(const K of V){const se=K.toUnwrapped(),ae=_?K.projMatrix:m.transform.calculateProjMatrix(se);m.prepareDrawTile();const ge=l?l.getTile(K):te?te[K.key]:new s.Tile(K,O,P.zoom,m),ve=k?Xx(ae,b,m,k,{tileID:K,tileSize:O}):_m(ae,b,v);m.prepareDrawProgram(C,Q,se);const{tileBoundsBuffer:ye,tileBoundsIndexBuffer:Ie,tileBoundsSegments:Ce}=m.getTileBoundsBuffers(ge);Q.draw(C,I.TRIANGLES,J,W,ee,s.CullFaceMode.disabled,ve,f.id,ye,Ie,Ce)}},sky:function(m,l,f){const _=m.transform,v=_.projection.name==="mercator"||_.projection.name==="globe"?1:s.smoothstep(7,8,_.zoom),b=f.paint.get("sky-opacity")*v;if(b===0)return;const C=m.context,I=f.paint.get("sky-type"),P=new s.DepthMode(C.gl.LEQUAL,s.DepthMode.ReadOnly,[0,1]),O=m.frameCounter/1e3%1;I==="atmosphere"?m.renderPass==="offscreen"?f.needsSkyboxCapture(m)&&(function(k,U,W,J){const ee=k.context,Q=ee.gl;let te=U.skyboxFbo;if(!te){te=U.skyboxFbo=ee.createFramebuffer(32,32,!1),U.skyboxGeometry=new Hf(ee),U.skyboxTexture=ee.gl.createTexture(),Q.bindTexture(Q.TEXTURE_CUBE_MAP,U.skyboxTexture),Q.texParameteri(Q.TEXTURE_CUBE_MAP,Q.TEXTURE_WRAP_S,Q.CLAMP_TO_EDGE),Q.texParameteri(Q.TEXTURE_CUBE_MAP,Q.TEXTURE_WRAP_T,Q.CLAMP_TO_EDGE),Q.texParameteri(Q.TEXTURE_CUBE_MAP,Q.TEXTURE_MIN_FILTER,Q.LINEAR),Q.texParameteri(Q.TEXTURE_CUBE_MAP,Q.TEXTURE_MAG_FILTER,Q.LINEAR);for(let ae=0;ae<6;++ae)Q.texImage2D(Q.TEXTURE_CUBE_MAP_POSITIVE_X+ae,0,Q.RGBA,32,32,0,Q.RGBA,Q.UNSIGNED_BYTE,null)}ee.bindFramebuffer.set(te.framebuffer),ee.viewport.set([0,0,32,32]);const V=U.getCenter(k,!0),K=k.useProgram("skyboxCapture"),se=new Float64Array(16);s.identity(se),s.rotateY(se,se,.5*-Math.PI),No(ee,U,K,se,V,0),s.identity(se),s.rotateY(se,se,.5*Math.PI),No(ee,U,K,se,V,1),s.identity(se),s.rotateX(se,se,.5*-Math.PI),No(ee,U,K,se,V,2),s.identity(se),s.rotateX(se,se,.5*Math.PI),No(ee,U,K,se,V,3),s.identity(se),No(ee,U,K,se,V,4),s.identity(se),s.rotateY(se,se,Math.PI),No(ee,U,K,se,V,5),ee.viewport.set([0,0,k.width,k.height])}(m,f),f.markSkyboxValid(m)):m.renderPass==="sky"&&function(k,U,W,J,ee){const Q=k.context,te=Q.gl,V=k.transform,K=k.useProgram("skybox");Q.activeTexture.set(te.TEXTURE0),te.bindTexture(te.TEXTURE_CUBE_MAP,U.skyboxTexture);const se=((ae,ge,ve,ye,Ie)=>({u_matrix:ae,u_sun_direction:ge,u_cubemap:0,u_opacity:ye,u_temporal_offset:Ie}))(V.skyboxMatrix,U.getCenter(k,!1),0,J,ee);k.prepareDrawProgram(Q,K),K.draw(Q,te.TRIANGLES,W,s.StencilMode.disabled,k.colorModeForRenderPass(),s.CullFaceMode.backCW,se,"skybox",U.skyboxGeometry.vertexBuffer,U.skyboxGeometry.indexBuffer,U.skyboxGeometry.segment)}(m,f,P,b,O):I==="gradient"&&m.renderPass==="sky"&&function(k,U,W,J,ee){const Q=k.context,te=Q.gl,V=k.transform,K=k.useProgram("skyboxGradient");U.skyboxGeometry||(U.skyboxGeometry=new Hf(Q)),Q.activeTexture.set(te.TEXTURE0);let se=U.colorRampTexture;se||(se=U.colorRampTexture=new s.Texture(Q,U.colorRamp,te.RGBA)),se.bind(te.LINEAR,te.CLAMP_TO_EDGE);const ae=((ge,ve,ye,Ie,Ce)=>({u_matrix:ge,u_color_ramp:0,u_center_direction:ve,u_radius:s.degToRad(ye),u_opacity:Ie,u_temporal_offset:Ce}))(V.skyboxMatrix,U.getCenter(k,!1),U.paint.get("sky-gradient-radius"),J,ee);k.prepareDrawProgram(Q,K),K.draw(Q,te.TRIANGLES,W,s.StencilMode.disabled,k.colorModeForRenderPass(),s.CullFaceMode.backCW,ae,"skyboxGradient",U.skyboxGeometry.vertexBuffer,U.skyboxGeometry.indexBuffer,U.skyboxGeometry.segment)}(m,f,P,b,O)},debug:function(m,l,f){for(let _=0;_<f.length;_++)Kx(m,l,f[_])},custom:function(m,l,f,_){const v=m.context,b=f.implementation;if(!m.transform.projection.unsupportedLayers||!m.transform.projection.unsupportedLayers.includes("custom")||m.terrain&&(m.terrain.renderingToTexture||m.renderPass==="offscreen")&&f.isLayerDraped()){if(m.renderPass==="offscreen"){const C=b.prerender;if(C){if(m.setCustomLayerDefaults(),v.setColorMode(m.colorModeForRenderPass()),m.transform.projection.name==="globe"){const I=m.transform.pointMerc;C.call(b,v.gl,m.transform.customLayerMatrix(),m.transform.getProjection(),m.transform.globeToMercatorMatrix(),s.globeToMercatorTransition(m.transform.zoom),[I.x,I.y],m.transform.pixelsPerMeterRatio)}else C.call(b,v.gl,m.transform.customLayerMatrix());v.setDirty(),m.setBaseState()}}else if(m.renderPass==="translucent"){if(m.terrain&&m.terrain.renderingToTexture){const I=b.renderToTile;if(I){const P=_[0].canonical,O=new s.MercatorCoordinate(P.x+_[0].wrap*(1<<P.z),P.y,P.z);v.setDepthMode(s.DepthMode.disabled),v.setStencilMode(s.StencilMode.disabled),v.setColorMode(m.colorModeForRenderPass()),m.setCustomLayerDefaults(),I.call(b,v.gl,O),v.setDirty(),m.setBaseState()}return}m.setCustomLayerDefaults(),v.setColorMode(m.colorModeForRenderPass()),v.setStencilMode(s.StencilMode.disabled);const C=b.renderingMode==="3d"?new s.DepthMode(m.context.gl.LEQUAL,s.DepthMode.ReadWrite,m.depthRangeFor3D):m.depthModeForSublayer(0,s.DepthMode.ReadOnly);if(v.setDepthMode(C),m.transform.projection.name==="globe"){const I=m.transform.pointMerc;b.render(v.gl,m.transform.customLayerMatrix(),m.transform.getProjection(),m.transform.globeToMercatorMatrix(),s.globeToMercatorTransition(m.transform.zoom),[I.x,I.y],m.transform.pixelsPerMeterRatio)}else b.render(v.gl,m.transform.customLayerMatrix());v.setDirty(),m.setBaseState(),v.bindFramebuffer.set(null)}}else s.warnOnce("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")}};class Ju{constructor(l,f,_=!1){this.context=new ct(l,_),this.transform=f,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=s.SourceCache.maxUnderzooming+s.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(l,f){const _=!!l&&!!l.terrain&&this.transform.projection.supportsTerrain;if(!(_||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new lm(this,l));const v=this._terrain;this.transform.elevation=_?v:null,v.update(l,this.transform,f)}_updateFog(l){const f=l.fog;if(!f||this.transform.projection.name==="globe"||f.getOpacity(this.transform.pitch)<1||f.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[_,v]=f.getFovAdjustedRange(this.transform._fov);if(_>v)return void(this.transform.fogCullDistSq=null);const b=_+.78*(v-_);this.transform.fogCullDistSq=b*b}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(l,f){if(this.width=l*s.exported.devicePixelRatio,this.height=f*s.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const _ of this.style.order)this.style._layers[_].resize()}setup(){const l=this.context,f=new s.StructArrayLayout2i4;f.emplaceBack(0,0),f.emplaceBack(s.EXTENT,0),f.emplaceBack(0,s.EXTENT),f.emplaceBack(s.EXTENT,s.EXTENT),this.tileExtentBuffer=l.createVertexBuffer(f,s.posAttributes.members),this.tileExtentSegments=s.SegmentVector.simpleSegment(0,0,4,2);const _=new s.StructArrayLayout2i4;_.emplaceBack(0,0),_.emplaceBack(s.EXTENT,0),_.emplaceBack(0,s.EXTENT),_.emplaceBack(s.EXTENT,s.EXTENT),this.debugBuffer=l.createVertexBuffer(_,s.posAttributes.members),this.debugSegments=s.SegmentVector.simpleSegment(0,0,4,5);const v=new s.StructArrayLayout2i4;v.emplaceBack(-1,-1),v.emplaceBack(1,-1),v.emplaceBack(-1,1),v.emplaceBack(1,1),this.viewportBuffer=l.createVertexBuffer(v,s.posAttributes.members),this.viewportSegments=s.SegmentVector.simpleSegment(0,0,4,2);const b=new s.StructArrayLayout4i8;b.emplaceBack(0,0,0,0),b.emplaceBack(s.EXTENT,0,s.EXTENT,0),b.emplaceBack(0,s.EXTENT,0,s.EXTENT),b.emplaceBack(s.EXTENT,s.EXTENT,s.EXTENT,s.EXTENT),this.mercatorBoundsBuffer=l.createVertexBuffer(b,s.boundsAttributes.members),this.mercatorBoundsSegments=s.SegmentVector.simpleSegment(0,0,4,2);const C=new s.StructArrayLayout3ui6;C.emplaceBack(0,1,2),C.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=l.createIndexBuffer(C);const I=new s.StructArrayLayout1ui2;for(const O of[0,1,3,2,0])I.emplaceBack(O);this.debugIndexBuffer=l.createIndexBuffer(I),this.emptyTexture=new s.Texture(l,new s.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),l.gl.RGBA),this.identityMat=s.create();const P=this.context.gl;this.stencilClearMode=new s.StencilMode({func:P.ALWAYS,mask:0},0,255,P.ZERO,P.ZERO,P.ZERO),this.loadTimeStamps.push(s.window.performance.now()),this.atmosphereBuffer=new my(this.context)}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(l){return l._makeTileBoundsBuffers(this.context,this.transform.projection),l._tileBoundsBuffer?{tileBoundsBuffer:l._tileBoundsBuffer,tileBoundsIndexBuffer:l._tileBoundsIndexBuffer,tileBoundsSegments:l._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const l=this.context,f=l.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(l,f.TRIANGLES,s.DepthMode.disabled,this.stencilClearMode,s.ColorMode.disabled,s.CullFaceMode.disabled,dh(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(l,f,_){if(!f||this.currentStencilSource===f.id||!l.isTileClipped()||!_||_.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let I=!1;for(const P of _)if(this._tileClippingMaskIDs[P.key]===void 0){I=!0;break}if(!I)return}this.currentStencilSource=f.id;const v=this.context,b=v.gl;this.nextStencilID+_.length>256&&this.clearStencil(),v.setColorMode(s.ColorMode.disabled),v.setDepthMode(s.DepthMode.disabled);const C=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const I of _){const P=f.getTile(I),O=this._tileClippingMaskIDs[I.key]=this.nextStencilID++,{tileBoundsBuffer:k,tileBoundsIndexBuffer:U,tileBoundsSegments:W}=this.getTileBoundsBuffers(P);C.draw(v,b.TRIANGLES,s.DepthMode.disabled,new s.StencilMode({func:b.ALWAYS,mask:0},O,255,b.KEEP,b.KEEP,b.REPLACE),s.ColorMode.disabled,s.CullFaceMode.disabled,dh(I.projMatrix),"$clipping",k,U,W)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const l=this.nextStencilID++,f=this.context.gl;return new s.StencilMode({func:f.NOTEQUAL,mask:255},l,255,f.KEEP,f.KEEP,f.REPLACE)}stencilModeForClipping(l){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(l);const f=this.context.gl;return new s.StencilMode({func:f.EQUAL,mask:255},this._tileClippingMaskIDs[l.key],0,f.KEEP,f.KEEP,f.REPLACE)}stencilConfigForOverlap(l){const f=this.context.gl,_=l.sort((C,I)=>I.overscaledZ-C.overscaledZ),v=_[_.length-1].overscaledZ,b=_[0].overscaledZ-v+1;if(b>1){this.currentStencilSource=void 0,this.nextStencilID+b>256&&this.clearStencil();const C={};for(let I=0;I<b;I++)C[I+v]=new s.StencilMode({func:f.GEQUAL,mask:255},I+this.nextStencilID,255,f.KEEP,f.KEEP,f.REPLACE);return this.nextStencilID+=b,[C,_]}return[{[v]:s.StencilMode.disabled},_]}colorModeForRenderPass(){const l=this.context.gl;return this._showOverdrawInspector?new s.ColorMode([l.CONSTANT_COLOR,l.ONE],new s.Color(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?s.ColorMode.unblended:s.ColorMode.alphaBlended}depthModeForSublayer(l,f,_){if(!this.opaquePassEnabledForLayer())return s.DepthMode.disabled;const v=1-((1+this.currentLayer)*this.numSublayers+l)*this.depthEpsilon;return new s.DepthMode(_||this.context.gl.LEQUAL,f,[v,v])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(l,f){this.style=l,this.options=f,this.imageManager=l.imageManager,this.glyphManager=l.glyphManager,this.symbolFadeChange=l.placement.symbolFadeChange(s.exported.now()),this.imageManager.beginFrame();const _=this.style.order,v=this.style._sourceCaches;for(const O in v){const k=v[O];k.used&&k.prepare(this.context)}const b={},C={},I={};for(const O in v){const k=v[O];b[O]=k.getVisibleCoordinates(),C[O]=b[O].slice().reverse(),I[O]=k.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let O=0;O<_.length;O++)if(this.style._layers[_[O]].is3D()){this.opaquePassCutoff=O;break}if(this.terrain&&(this.terrain.updateTileBinding(I),this.opaquePassCutoff=0),this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new s.GlobeSharedBuffers(this.context)),!s.isMapAuthenticated(this.context.gl))return;this.renderPass="offscreen";for(const O of _){const k=this.style._layers[O],U=l._getLayerSourceCache(k);if(!k.hasOffscreenPass()||k.isHidden(this.transform.zoom))continue;const W=U?C[U.id]:void 0;(k.type==="custom"||k.isSky()||W&&W.length)&&this.renderLayer(this,U,k,W)}this.depthRangeFor3D=[0,1-(l.order.length+2)*this.numSublayers*this.depthEpsilon];const P=this.terrain;if(P&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&P.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]),this.context.clear({color:f.showOverdrawInspector?s.Color.black:s.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=f.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=_.length-1;this.currentLayer>=0;this.currentLayer--){const O=this.style._layers[_[this.currentLayer]],k=l._getLayerSourceCache(O);if(O.isSky())continue;const U=k?C[k.id]:void 0;this._renderTileClippingMasks(O,k,U),this.renderLayer(this,k,O,U)}if(this.style.fog&&this.transform.projection.supportsFog&&function(O,k){const U=O.context,W=U.gl,J=O.transform,ee=new s.DepthMode(W.LEQUAL,s.DepthMode.ReadOnly,[0,1]),Q=O.useProgram("globeAtmosphere",null,J.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"]),te=s.globeToMercatorTransition(J.zoom),V=k.properties.get("color").toArray01(),K=k.properties.get("high-color").toArray01(),se=k.properties.get("space-color").toArray01PremultipliedAlpha(),ae=s.identity$1([]);s.rotateY$1(ae,ae,-s.degToRad(J._center.lng)),s.rotateX$1(ae,ae,s.degToRad(J._center.lat)),s.rotateZ$1(ae,ae,J.angle),s.rotateX$1(ae,ae,-J._pitch);const ge=s.fromQuat(new Float32Array(16),ae),ve=s.mapValue(k.properties.get("star-intensity"),0,1,0,.25),ye=5e-4,Ie=s.mapValue(k.properties.get("horizon-blend"),0,1,ye,.25),Ce=s.globeUseCustomAntiAliasing(O,U,J)&&Ie===ye?J.worldSize/(2*Math.PI*1.025)-1:J.globeRadius,Ne=O.frameCounter/1e3%1,rt=s.length(J.globeCenterInViewSpace),Le=Math.sqrt(Math.pow(rt,2)-Math.pow(Ce,2)),Ye=Math.acos(Le/rt),Fe=((Re,Ze,ot,Qe,st,Mt,jt,St,Ot,an,nn,It,In,Dn)=>({u_frustum_tl:Re,u_frustum_tr:Ze,u_frustum_br:ot,u_frustum_bl:Qe,u_horizon:st,u_transition:Mt,u_fadeout_range:jt,u_color:St,u_high_color:Ot,u_space_color:an,u_star_intensity:nn,u_star_size:5*s.exported.devicePixelRatio,u_star_density:0,u_temporal_offset:It,u_horizon_angle:In,u_rotation_matrix:Dn}))(J.frustumCorners.TL,J.frustumCorners.TR,J.frustumCorners.BR,J.frustumCorners.BL,J.frustumCorners.horizon,te,Ie,V,K,se,ve,Ne,Ye,ge);O.prepareDrawProgram(U,Q);const nt=O.atmosphereBuffer;nt&&Q.draw(U,W.TRIANGLES,ee,s.StencilMode.disabled,s.ColorMode.alphaBlended,s.CullFaceMode.backCW,Fe,"skybox",nt.vertexBuffer,nt.indexBuffer,nt.segments)}(this,this.style.fog),this.renderPass="sky",(s.globeToMercatorTransition(this.transform.zoom)>0||this.transform.projection.name!=="globe")&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<_.length;this.currentLayer++){const O=this.style._layers[_[this.currentLayer]],k=l._getLayerSourceCache(O);O.isSky()&&this.renderLayer(this,k,O,k?C[k.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<_.length;){const O=this.style._layers[_[this.currentLayer]],k=l._getLayerSourceCache(O);if(O.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(O)){if(O.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const U=k?(O.type==="symbol"?I:C)[k.id]:void 0;this._renderTileClippingMasks(O,k,k?b[k.id]:void 0),this.renderLayer(this,k,O,U),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let O=null;s.values(this.style._layers).forEach(k=>{const U=l._getLayerSourceCache(k);U&&!k.isHidden(this.transform.zoom)&&(!O||O.getSource().maxzoom<U.getSource().maxzoom)&&(O=U)}),O&&this.options.showTileBoundaries&&Ql.debug(this,O,O.getVisibleCoordinates())}this.options.showPadding&&function(O){const k=O.transform.padding;fy(O,O.transform.height-(k.top||0),3,Yu),fy(O,k.bottom||0,3,Zx),Wf(O,k.left||0,3,Wx),Wf(O,O.transform.width-(k.right||0),3,Hx);const U=O.transform.centerPoint;(function(W,J,ee,Q){Ku(W,J-1,ee-10,2,20,Q),Ku(W,J-10,ee-1,20,2,Q)})(O,U.x,O.transform.height-U.y,Yx)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(s.window.performance.now()),this.saveCanvasCopy())}renderLayer(l,f,_,v){_.isHidden(this.transform.zoom)||(_.type==="background"||_.type==="sky"||_.type==="custom"||v&&v.length)&&(this.id=_.id,this.gpuTimingStart(_),(!l.transform.projection.unsupportedLayers||!l.transform.projection.unsupportedLayers.includes(_.type)||l.terrain&&_.type==="custom")&&Ql[_.type](l,f,_,v,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(l){if(!this.options.gpuTiming)return;const f=this.context.extTimerQuery;let _=this.gpuTimers[l.id];_||(_=this.gpuTimers[l.id]={calls:0,cpuTime:0,query:f.createQueryEXT()}),_.calls++,f.beginQueryEXT(f.TIME_ELAPSED_EXT,_.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const l=this.context.extTimerQuery,f=l.createQueryEXT();this.deferredRenderGpuTimeQueries.push(f),l.beginQueryEXT(l.TIME_ELAPSED_EXT,f)}}gpuTimingDeferredRenderEnd(){if(!this.options.gpuTimingDeferredRender)return;const l=this.context.extTimerQuery;l.endQueryEXT(l.TIME_ELAPSED_EXT)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const l=this.context.extTimerQuery;l.endQueryEXT(l.TIME_ELAPSED_EXT)}collectGpuTimers(){const l=this.gpuTimers;return this.gpuTimers={},l}collectDeferredRenderGpuQueries(){const l=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],l}queryGpuTimers(l){const f={};for(const _ in l){const v=l[_],b=this.context.extTimerQuery,C=b.getQueryObjectEXT(v.query,b.QUERY_RESULT_EXT)/1e6;b.deleteQueryEXT(v.query),f[_]=C}return f}queryGpuTimeDeferredRender(l){if(!this.options.gpuTimingDeferredRender)return 0;const f=this.context.extTimerQuery;let _=0;for(const v of l)_+=f.getQueryObjectEXT(v,f.QUERY_RESULT_EXT)/1e6,f.deleteQueryEXT(v);return _}translatePosMatrix(l,f,_,v,b){if(!_[0]&&!_[1])return l;const C=b?v==="map"?this.transform.angle:0:v==="viewport"?-this.transform.angle:0;if(C){const O=Math.sin(C),k=Math.cos(C);_=[_[0]*k-_[1]*O,_[0]*O+_[1]*k]}const I=[b?_[0]:kt(f,_[0],this.transform.zoom),b?_[1]:kt(f,_[1],this.transform.zoom),0],P=new Float32Array(16);return s.translate(P,l,I),P}saveTileTexture(l){const f=this._tileTextures[l.size[0]];f?f.push(l):this._tileTextures[l.size[0]]=[l]}getTileTexture(l){const f=this._tileTextures[l];return f&&f.length>0?f.pop():null}isPatternMissing(l){return l===null||l!==void 0&&!this.imageManager.getPattern(l.toString())}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}currentGlobalDefines(){const l=this.terrain&&this.terrain.renderingToTexture,f=this.terrain&&this.terrain.exaggeration()===0,_=this.style&&this.style.fog,v=[];return this.terrainRenderModeElevated()&&v.push("TERRAIN"),this.transform.projection.name==="globe"&&v.push("GLOBE"),f&&v.push("ZERO_EXAGGERATION"),_&&!l&&_.getOpacity(this.transform.pitch)!==0&&v.push("FOG"),l&&v.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&v.push("OVERDRAW_INSPECTOR"),v}useProgram(l,f,_){this.cache=this.cache||{};const v=_||[],b=this.currentGlobalDefines().concat(v),C=mn.cacheKey(nm[l],l,b,f);return this.cache[C]||(this.cache[C]=new mn(this.context,l,nm[l],f,ym[l],b)),this.cache[C]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const l=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(l.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=s.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new s.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.atmosphereBuffer&&this.atmosphereBuffer.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(l,f,_){if(this.terrain&&this.terrain.renderingToTexture)return;const v=this.style.fog;if(v){const b=v.getOpacity(this.transform.pitch),C=((I,P,O,k,U,W,J,ee,Q,te,V)=>{const K=I.transform,se=P.properties.get("color").toArray01();se[3]=k;const ae=I.frameCounter/1e3%1;return{u_fog_matrix:O?K.calculateFogTileMatrix(O):I.identityMat,u_fog_range:P.getFovAdjustedRange(K._fov),u_fog_color:se,u_fog_horizon_blend:P.properties.get("horizon-blend"),u_fog_temporal_offset:ae,u_frustum_tl:U,u_frustum_tr:W,u_frustum_br:J,u_frustum_bl:ee,u_globe_pos:Q,u_globe_radius:te,u_viewport:V,u_globe_transition:s.globeToMercatorTransition(K.zoom),u_is_globe:+(K.projection.name==="globe")}})(this,v,_,b,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*s.exported.devicePixelRatio,this.transform.height*s.exported.devicePixelRatio]);f.setFogUniformValues(l,C)}}setTileLoadedFlag(l){this.tileLoaded=l}saveCanvasCopy(){const l=this.canvasCopy();l&&(this.frameCopies.push(l),this.tileLoaded=!1)}canvasCopy(){const l=this.context.gl,f=l.createTexture();return l.bindTexture(l.TEXTURE_2D,f),l.copyTexImage2D(l.TEXTURE_2D,0,l.RGBA,0,0,l.drawingBufferWidth,l.drawingBufferHeight,0),f}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const l=this.style&&this.style.fog;return!!l&&l.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const l=this._backgroundTiles,f=this._backgroundTiles={},_=this.transform.coveringTiles({tileSize:512});for(const v of _)f[v.key]=l[v.key]||new s.Tile(v,512,this.transform.tileZoom,this);return f}clearBackgroundTiles(){this._backgroundTiles={}}}class Yf{constructor(l=0,f=0,_=0,v=0){if(isNaN(l)||l<0||isNaN(f)||f<0||isNaN(_)||_<0||isNaN(v)||v<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=l,this.bottom=f,this.left=_,this.right=v}interpolate(l,f,_){return f.top!=null&&l.top!=null&&(this.top=s.number(l.top,f.top,_)),f.bottom!=null&&l.bottom!=null&&(this.bottom=s.number(l.bottom,f.bottom,_)),f.left!=null&&l.left!=null&&(this.left=s.number(l.left,f.left,_)),f.right!=null&&l.right!=null&&(this.right=s.number(l.right,f.right,_)),this}getCenter(l,f){const _=s.clamp((this.left+l-this.right)/2,0,l),v=s.clamp((this.top+f-this.bottom)/2,0,f);return new s.Point(_,v)}equals(l){return this.top===l.top&&this.bottom===l.bottom&&this.left===l.left&&this.right===l.right}clone(){return new Yf(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Kf(m,l){const f=s.getColumn(m,3);s.fromQuat(m,l),s.setColumn(m,3,f)}function gn(m,l){const f=s.identity$1([]);return s.rotateZ$1(f,f,-l),s.rotateX$1(f,f,-m),f}function wh(m,l){const f=[m[0],m[1],0],_=[l[0],l[1],0];if(s.length(f)>=1e-15){const C=s.normalize([],f);s.scale$2(_,C,s.dot(_,C)),l[0]=_[0],l[1]=_[1]}const v=s.cross([],l,m);if(s.len(v)<1e-15)return null;const b=Math.atan2(-v[1],v[0]);return gn(Math.atan2(Math.sqrt(m[0]*m[0]+m[1]*m[1]),-m[2]),b)}class gy{constructor(l,f){this.position=l,this.orientation=f}get position(){return this._position}set position(l){if(l){const f=l instanceof s.MercatorCoordinate?l:new s.MercatorCoordinate(l[0],l[1],l[2]);this._renderWorldCopies&&(f.x=s.wrap(f.x,0,1)),this._position=f}else this._position=null}lookAtPoint(l,f){if(this.orientation=null,!this.position)return;const _=this.position,v=this._elevation?this._elevation.getAtPointOrZero(s.MercatorCoordinate.fromLngLat(l)):0,b=s.MercatorCoordinate.fromLngLat(l,v),C=[b.x-_.x,b.y-_.y,b.z-_.z];f||(f=[0,0,1]),f[2]=Math.abs(f[2]),this.orientation=wh(C,f)}setPitchBearing(l,f){this.orientation=gn(s.degToRad(l),s.degToRad(-f))}}class Jf{constructor(l,f){this._transform=s.identity([]),this.orientation=f,this.position=l}get mercatorPosition(){const l=this.position;return new s.MercatorCoordinate(l[0],l[1],l[2])}get position(){const l=s.getColumn(this._transform,3);return[l[0],l[1],l[2]]}set position(l){var f;l&&s.setColumn(this._transform,3,[(f=l)[0],f[1],f[2],1])}get orientation(){return this._orientation}set orientation(l){this._orientation=l||s.identity$1([]),l&&Kf(this._transform,this._orientation)}getPitchBearing(){const l=this.forward(),f=this.right();return{bearing:Math.atan2(-f[1],f[0]),pitch:Math.atan2(Math.sqrt(l[0]*l[0]+l[1]*l[1]),-l[2])}}setPitchBearing(l,f){this._orientation=gn(l,f),Kf(this._transform,this._orientation)}forward(){const l=s.getColumn(this._transform,2);return[-l[0],-l[1],-l[2]]}up(){const l=s.getColumn(this._transform,1);return[-l[0],-l[1],-l[2]]}right(){const l=s.getColumn(this._transform,0);return[l[0],l[1],l[2]]}getCameraToWorld(l,f){const _=new Float64Array(16);return s.invert(_,this.getWorldToCamera(l,f)),_}getWorldToCameraPosition(l,f,_){const v=this.position;s.scale$2(v,v,-l);const b=new Float64Array(16);return s.fromScaling(b,[_,_,_]),s.translate(b,b,v),b[10]*=f,b}getWorldToCamera(l,f){const _=new Float64Array(16),v=new Float64Array(4),b=this.position;return s.conjugate(v,this._orientation),s.scale$2(b,b,-l),s.fromQuat(_,v),s.translate(_,_,b),_[1]*=-1,_[5]*=-1,_[9]*=-1,_[13]*=-1,_[8]*=f,_[9]*=f,_[10]*=f,_[11]*=f,_}getCameraToClipPerspective(l,f,_,v){const b=new Float64Array(16);return s.perspective(b,l,f,_,v),b}getDistanceToElevation(l,f=!1){const _=l===0?0:s.mercatorZfromAltitude(l,f?s.latFromMercatorY(this.position[1]):this.position[1]),v=this.forward();return(_-this.position[2])/v[2]}clone(){return new Jf([...this.position],[...this.orientation])}}function Qu(m,l){const f=Qf(m.projection,m.zoom,m.width,m.height),_=function(b,C,I,P,O){const k=new s.LngLat(I.lng-180*Ea,I.lat),U=new s.LngLat(I.lng+180*Ea,I.lat),W=b.project(k.lng,k.lat),J=b.project(U.lng,U.lat),ee=-Math.atan2(J.y-W.y,J.x-W.x),Q=s.MercatorCoordinate.fromLngLat(I);Q.y=s.clamp(Q.y,-1+Ea,1-Ea);const te=Q.toLngLat(),V=b.project(te.lng,te.lat),K=s.MercatorCoordinate.fromLngLat(te);K.x+=Ea;const se=K.toLngLat(),ae=b.project(se.lng,se.lat),ge=ep(ae.x-V.x,ae.y-V.y,ee),ve=s.MercatorCoordinate.fromLngLat(te);ve.y+=Ea;const ye=ve.toLngLat(),Ie=b.project(ye.lng,ye.lat),Ce=ep(Ie.x-V.x,Ie.y-V.y,ee),Ne=Math.abs(ge.x)/Math.abs(Ce.y),rt=s.identity([]);s.rotateZ(rt,rt,-ee*(1-(O?0:P)));const Le=s.identity([]);return s.scale(Le,Le,[1,1-(1-Ne)*P,1]),Le[4]=-Ce.x/Ce.y*P,s.rotateZ(Le,Le,ee),s.multiply(Le,rt,Le),Le}(m.projection,0,m.center,f,l),v=_y(m);return s.scale(_,_,[v,v,1]),_}function _y(m){const l=m.projection,f=Qf(m.projection,m.zoom,m.width,m.height),_=yy(l,m.center),v=yy(l,s.LngLat.convert(l.center));return Math.pow(2,_*f+(1-f)*v)}function Qf(m,l,f,_,v=1/0){const b=m.range;if(!b)return 0;const C=Math.min(v,Math.max(f,_)),I=Math.log(C/1024)/Math.LN2;return s.smoothstep(b[0]+I,b[1]+I,l)}const Ea=1/4e4;function yy(m,l){const f=s.clamp(l.lat,-s.MAX_MERCATOR_LATITUDE,s.MAX_MERCATOR_LATITUDE),_=new s.LngLat(l.lng-180*Ea,f),v=new s.LngLat(l.lng+180*Ea,f),b=m.project(_.lng,f),C=m.project(v.lng,f),I=s.MercatorCoordinate.fromLngLat(_),P=s.MercatorCoordinate.fromLngLat(v),O=C.x-b.x,k=C.y-b.y,U=P.x-I.x,W=P.y-I.y,J=Math.sqrt((U*U+W*W)/(O*O+k*k));return Math.log(J)/Math.LN2}function ep(m,l,f){const _=Math.cos(f),v=Math.sin(f);return{x:m*_-l*v,y:m*v+l*_}}class ec{constructor(l,f,_,v,b,C,I){this.tileSize=512,this._renderWorldCopies=b===void 0||b,this._minZoom=l||0,this._maxZoom=f||22,this._minPitch=_??0,this._maxPitch=v??60,this.setProjection(C),this.setMaxBounds(I),this.width=0,this.height=0,this._center=new s.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Yf,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new Jf,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1}clone(){const l=new ec(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return l._elevation=this._elevation,l._centerAltitude=this._centerAltitude,l._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,l.tileSize=this.tileSize,l.mercatorFromTransition=this.mercatorFromTransition,l.width=this.width,l.height=this.height,l.cameraElevationReference=this.cameraElevationReference,l._center=this._center,l._setZoom(this.zoom),l._seaLevelZoom=this._seaLevelZoom,l.angle=this.angle,l._fov=this._fov,l._pitch=this._pitch,l._nearZ=this._nearZ,l._farZ=this._farZ,l._averageElevation=this._averageElevation,l._unmodified=this._unmodified,l._edgeInsets=this._edgeInsets.clone(),l._camera=this._camera.clone(),l._calcMatrices(),l.freezeTileCoverage=this.freezeTileCoverage,l.frustumCorners=this.frustumCorners,l}get elevation(){return this._elevation}set elevation(l){this._elevation!==l&&(this._elevation=l,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(l,f=!1){const _=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||_)&&this._updateCameraOnTerrain(),(l||_)&&this._constrainCamera(f),this._calcMatrices()}getProjection(){return s.pick(this.projection,["name","center","parallels"])}setProjection(l){this.projectionOptions=l||{name:"mercator"};const f=this.projection?this.getProjection():void 0;this.projection=s.getProjection(this.projectionOptions);const _=!w(f,this.getProjection());return _&&this._calcMatrices(),this.mercatorFromTransition=!1,_}setMercatorFromTransition(){const l=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=s.getProjection({name:"mercator"});const f=l!==this.projection.name;return f&&this._calcMatrices(),f}get minZoom(){return this._minZoom}set minZoom(l){this._minZoom!==l&&(this._minZoom=l,this.zoom=Math.max(this.zoom,l))}get maxZoom(){return this._maxZoom}set maxZoom(l){this._maxZoom!==l&&(this._maxZoom=l,this.zoom=Math.min(this.zoom,l))}get minPitch(){return this._minPitch}set minPitch(l){this._minPitch!==l&&(this._minPitch=l,this.pitch=Math.max(this.pitch,l))}get maxPitch(){return this._maxPitch}set maxPitch(l){this._maxPitch!==l&&(this._maxPitch=l,this.pitch=Math.min(this.pitch,l))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(l){l===void 0?l=!0:l===null&&(l=!1),this._renderWorldCopies=l}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const l=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(l))}get cameraWorldSize(){const l=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(l))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return s.mercatorZfromAltitude(this.center.lat,this.cameraWorldSizeForFog)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new s.Point(this.width,this.height)}get bearing(){return s.wrap(this.rotation,-180,180)}set bearing(l){this.rotation=l}get rotation(){return-this.angle/Math.PI*180}set rotation(l){const f=-l*Math.PI/180;var _;this.angle!==f&&(this._unmodified=!1,this.angle=f,this._calcMatrices(),this.rotationMatrix=(_=new s.ARRAY_TYPE(4),s.ARRAY_TYPE!=Float32Array&&(_[1]=0,_[2]=0),_[0]=1,_[3]=1,_),function(v,b,C){var I=b[0],P=b[1],O=b[2],k=b[3],U=Math.sin(C),W=Math.cos(C);v[0]=I*W+O*U,v[1]=P*W+k*U,v[2]=I*-U+O*W,v[3]=P*-U+k*W}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(l){const f=s.clamp(l,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==f&&(this._unmodified=!1,this._pitch=f,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const l=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/l)}set fov(l){l=Math.max(.01,Math.min(60,l)),this._fov!==l&&(this._unmodified=!1,this._fov=s.degToRad(l),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(l){this._averageElevation=l,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(l){const f=Math.min(Math.max(l,this.minZoom),this.maxZoom);this._zoom!==f&&(this._unmodified=!1,this._setZoom(f),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(l){this._zoom=l,this.scale=this.zoomScale(l),this.tileZoom=Math.floor(l),this.zoomFraction=l-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const l=this._elevation;this._centerAltitude=l.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=l.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const l=this._elevation,f=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],_=this.horizonLineFromTop();let v=0,b=0;for(let C=0;C<f.length;C++){const I=new s.Point(f[C][0]*this.width,_+f[C][1]*(this.height-_)),P=l.pointCoordinate(I);if(!P)continue;const O=1/Math.hypot(P[0]-this._camera.position[0],P[1]-this._camera.position[1]);v+=P[3]*O,b+=O}return b===0?NaN:v/b}get center(){return this._center}set center(l){l.lat===this._center.lat&&l.lng===this._center.lng||(this._unmodified=!1,this._center=l,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const l=this._seaLevelZoom,f=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),_=this.pixelsPerMeter/this.worldSize*f,v=this._mercatorZfromZoom(l),b=this._mercatorZfromZoom(this._maxZoom),C=Math.max(v-_,b);this._setZoom(this._zoomFromMercatorZ(C))}get padding(){return this._edgeInsets.toJSON()}set padding(l){this._edgeInsets.equals(l)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,l,1),this._calcMatrices())}computeZoomRelativeTo(l){const f=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,l.toAltitude()));let _;_=l.z<this._camera.position[2]?[f.x,f.y,f.z]:[l.x,l.y,l.z];const v=s.length(s.sub([],this._camera.position,_));return s.clamp(this._zoomFromMercatorZ(v),this._minZoom,this._maxZoom)}setFreeCameraOptions(l){if(!this.height||!l.position&&!l.orientation)return;this._updateCameraState();let f=!1;if(l.orientation&&!s.exactEquals(l.orientation,this._camera.orientation)&&(f=this._setCameraOrientation(l.orientation)),l.position){const _=[l.position.x,l.position.y,l.position.z];s.exactEquals$1(_,this._camera.position)||(this._setCameraPosition(_),f=!0)}f&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const l=this._camera.position,f=new gy;return f.position=new s.MercatorCoordinate(l[0],l[1],l[2]),f.orientation=this._camera.orientation,f._elevation=this.elevation,f._renderWorldCopies=this.renderWorldCopies,f}_setCameraOrientation(l){if(!s.length$1(l))return!1;s.normalize$1(l,l);const f=s.transformQuat([],[0,0,-1],l),_=s.transformQuat([],[0,-1,0],l);if(_[2]<0)return!1;const v=wh(f,_);return!!v&&(this._camera.orientation=v,!0)}_setCameraPosition(l){const f=this.zoomScale(this.minZoom)*this.tileSize,_=this.zoomScale(this.maxZoom)*this.tileSize,v=this.cameraToCenterDistance;l[2]=s.clamp(l[2],v/_,v/f),this._camera.position=l}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(l){return this._edgeInsets.equals(l)}interpolatePadding(l,f,_){this._unmodified=!1,this._edgeInsets.interpolate(l,f,_),this._constrain(),this._calcMatrices()}coveringZoomLevel(l){const f=(l.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/l.tileSize));return Math.max(0,f)}getVisibleUnwrappedCoordinates(l){const f=[new s.UnwrappedTileID(0,l)];if(this.renderWorldCopies){const _=this.pointCoordinate(new s.Point(0,0)),v=this.pointCoordinate(new s.Point(this.width,0)),b=this.pointCoordinate(new s.Point(this.width,this.height)),C=this.pointCoordinate(new s.Point(0,this.height)),I=Math.floor(Math.min(_.x,v.x,b.x,C.x)),P=Math.floor(Math.max(_.x,v.x,b.x,C.x)),O=1;for(let k=I-O;k<=P+O;k++)k!==0&&f.push(new s.UnwrappedTileID(k,l))}return f}coveringTiles(l){let f=this.coveringZoomLevel(l);const _=f,v=this.elevation&&!l.isTerrainDEM,b=this.projection.name==="mercator";if(l.minzoom!==void 0&&f<l.minzoom)return[];l.maxzoom!==void 0&&f>l.maxzoom&&(f=l.maxzoom);const C=this.locationCoordinate(this.center),I=this.center.lat,P=1<<f,O=[P*C.x,P*C.y,0],k=this.projection.name==="globe",U=!k,W=s.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,f,U),J=k?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),ee=P*s.mercatorZfromAltitude(1,this.center.lat),Q=this._camera.position[2]/s.mercatorZfromAltitude(1,this.center.lat),te=[P*J.x,P*J.y,Q*(U?1:ee)],V=this.cameraToCenterDistance/l.tileSize*(l.roundZoom?1:.502),K=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?f:0,se=l.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,ae=l.isTerrainDEM?-se:this._elevation?this._elevation.getMinElevationBelowMSL():0,ge=this.projection.isReprojectedInTileSpace?_y(this):1,ve=Re=>{const ot=new s.MercatorCoordinate(Re.x+25e-6,Re.y,Re.z),Qe=new s.MercatorCoordinate(Re.x,Re.y+25e-6,Re.z),st=Re.toLngLat(),Mt=ot.toLngLat(),jt=Qe.toLngLat(),St=this.locationCoordinate(st),Ot=this.locationCoordinate(Mt),an=this.locationCoordinate(jt),nn=Math.hypot(Ot.x-St.x,Ot.y-St.y),It=Math.hypot(an.x-St.x,an.y-St.y);return Math.sqrt(nn*It)*ge/25e-6},ye=Re=>{const Ze=se,ot=ae;return{aabb:s.tileAABB(this,P,0,0,0,Re,ot,Ze,this.projection),zoom:0,x:0,y:0,minZ:ot,maxZ:Ze,wrap:Re,fullyVisible:!1}},Ie=[];let Ce=[];const Ne=f,rt=l.reparseOverscaled?_:f,Le=Re=>Re*Re,Ye=Le((Q-this._centerAltitude)*ee),Fe=Re=>{if(!this._elevation||!Re.tileID||!b)return;const Ze=this._elevation.getMinMaxForTile(Re.tileID),ot=Re.aabb;Ze?(ot.min[2]=Ze.min,ot.max[2]=Ze.max,ot.center[2]=(ot.min[2]+ot.max[2])/2):(Re.shouldSplit=nt(Re),Re.shouldSplit||(ot.min[2]=ot.max[2]=ot.center[2]=this._centerAltitude))},nt=Re=>{if(Re.zoom<K)return!0;if(Re.zoom===Ne)return!1;if(Re.shouldSplit!=null)return Re.shouldSplit;const Ze=Re.aabb.distanceX(te),ot=Re.aabb.distanceY(te);let Qe=Ye,st=1;if(k){Qe=Le(Re.aabb.distanceZ(te));const St=Math.pow(2,Re.zoom),Ot=s.latFromMercatorY((Re.y+1)/St),an=s.latFromMercatorY(Re.y/St),nn=Math.min(Math.max(I,Ot),an),It=s.circumferenceAtLatitude(nn)/s.circumferenceAtLatitude(I);if(st=nn===I?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,It/this._mercatorScaleRatio),this.zoom<=s.GLOBE_ZOOM_THRESHOLD_MIN&&Re.zoom===Ne-1&&It>=.9)return!0}else if(v&&(Qe=Le(Re.aabb.distanceZ(te)*ee)),this.projection.isReprojectedInTileSpace&&_<=5){const St=Math.pow(2,Re.zoom),Ot=ve(new s.MercatorCoordinate((Re.x+.5)/St,(Re.y+.5)/St));st=Ot>.85?1:Ot}const Mt=Ze*Ze+ot*ot+Qe,jt=Le((1<<Ne-Re.zoom)*V*st*((St,Ot)=>{if(Ot*Le(.707)<St)return 1;const an=Math.sqrt(Ot/St);return an/(1.4144271570014144+(Math.pow(1.1,an-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(Qe,Ye),Mt));return Mt<jt};if(this.renderWorldCopies)for(let Re=1;Re<=3;Re++)Ie.push(ye(-Re)),Ie.push(ye(Re));for(Ie.push(ye(0));Ie.length>0;){const Re=Ie.pop(),Ze=Re.x,ot=Re.y;let Qe=Re.fullyVisible;if(!Qe){const st=Re.aabb.intersects(W);if(st===0)continue;Qe=st===2}if(Re.zoom!==Ne&&nt(Re))for(let st=0;st<4;st++){const Mt=(Ze<<1)+st%2,jt=(ot<<1)+(st>>1),St={aabb:b?Re.aabb.quadrant(st):s.tileAABB(this,P,Re.zoom+1,Mt,jt,Re.wrap,Re.minZ,Re.maxZ,this.projection),zoom:Re.zoom+1,x:Mt,y:jt,wrap:Re.wrap,fullyVisible:Qe,tileID:void 0,shouldSplit:void 0,minZ:Re.minZ,maxZ:Re.maxZ};v&&!k&&(St.tileID=new s.OverscaledTileID(Re.zoom+1===Ne?rt:Re.zoom+1,Re.wrap,Re.zoom+1,Mt,jt),Fe(St)),Ie.push(St)}else{const st=Re.zoom===Ne?rt:Re.zoom;if(l.minzoom&&l.minzoom>st)continue;const Mt=O[0]-(.5+Ze+(Re.wrap<<Re.zoom))*(1<<f-Re.zoom),jt=O[1]-.5-ot,St=Re.tileID?Re.tileID:new s.OverscaledTileID(st,Re.wrap,Re.zoom,Ze,ot);Ce.push({tileID:St,distanceSq:Mt*Mt+jt*jt})}}if(this.fogCullDistSq){const Re=this.fogCullDistSq,Ze=this.horizonLineFromTop();Ce=Ce.filter(ot=>{const Qe=[0,0,0,1],st=[s.EXTENT,s.EXTENT,0,1],Mt=this.calculateFogTileMatrix(ot.tileID.toUnwrapped());s.transformMat4$1(Qe,Qe,Mt),s.transformMat4$1(st,st,Mt);const jt=s.getAABBPointSquareDist(Qe,st);if(jt===0)return!0;let St=!1;const Ot=this._elevation;if(Ot&&jt>Re&&Ze!==0){const an=this.calculateProjMatrix(ot.tileID.toUnwrapped());let nn;l.isTerrainDEM||(nn=Ot.getMinMaxForTile(ot.tileID)),nn||(nn={min:ae,max:se});const It=s.furthestTileCorner(this.rotation),In=[It[0]*s.EXTENT,It[1]*s.EXTENT,nn.max];s.transformMat4(In,In,an),St=(1-In[1])*this.height*.5<Ze}return jt<Re||St})}return Ce.sort((Re,Ze)=>Re.distanceSq-Ze.distanceSq).map(Re=>Re.tileID)}resize(l,f){this.width=l,this.height=f,this.pixelsToGLUnits=[2/l,-2/f],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(l){return Math.pow(2,l)}scaleZoom(l){return Math.log(l)/Math.LN2}project(l){const f=s.clamp(l.lat,-s.MAX_MERCATOR_LATITUDE,s.MAX_MERCATOR_LATITUDE),_=this.projection.project(l.lng,f);return new s.Point(_.x*this.worldSize,_.y*this.worldSize)}unproject(l){return this.projection.unproject(l.x/this.worldSize,l.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/s.mercatorZfromAltitude(1,this.center.lat)/this.worldSize}setLocationAtPoint(l,f){let _,v;const b=this.centerPoint;if(this.projection.name==="globe"){const I=this.worldSize;_=(f.x-b.x)/I,v=(f.y-b.y)/I}else{const I=this.pointCoordinate(f),P=this.pointCoordinate(b);_=I.x-P.x,v=I.y-P.y}const C=this.locationCoordinate(l);this.setLocation(new s.MercatorCoordinate(C.x-_,C.y-v))}setLocation(l){this.center=this.coordinateLocation(l),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(l){return this.projection.locationPoint(this,l)}locationPoint3D(l){return this.projection.locationPoint(this,l,!0)}pointLocation(l){return this.coordinateLocation(this.pointCoordinate(l))}pointLocation3D(l){return this.coordinateLocation(this.pointCoordinate3D(l))}locationCoordinate(l,f){const _=f?s.mercatorZfromAltitude(f,l.lat):void 0,v=this.projection.project(l.lng,l.lat);return new s.MercatorCoordinate(v.x,v.y,_)}coordinateLocation(l){return this.projection.unproject(l.x,l.y)}pointRayIntersection(l,f){const _=f??this._centerAltitude,v=[l.x,l.y,0,1],b=[l.x,l.y,1,1];s.transformMat4$1(v,v,this.pixelMatrixInverse),s.transformMat4$1(b,b,this.pixelMatrixInverse);const C=b[3];s.scale$1(v,v,1/v[3]),s.scale$1(b,b,1/C);const I=v[2],P=b[2];return{p0:v,p1:b,t:I===P?0:(_-I)/(P-I)}}screenPointToMercatorRay(l){const f=[l.x,l.y,0,1],_=[l.x,l.y,1,1];return s.transformMat4$1(f,f,this.pixelMatrixInverse),s.transformMat4$1(_,_,this.pixelMatrixInverse),s.scale$1(f,f,1/f[3]),s.scale$1(_,_,1/_[3]),f[2]=s.mercatorZfromAltitude(f[2],this._center.lat)*this.worldSize,_[2]=s.mercatorZfromAltitude(_[2],this._center.lat)*this.worldSize,s.scale$1(f,f,1/this.worldSize),s.scale$1(_,_,1/this.worldSize),new s.Ray([f[0],f[1],f[2]],s.normalize([],s.sub([],_,f)))}rayIntersectionCoordinate(l){const{p0:f,p1:_,t:v}=l,b=s.mercatorZfromAltitude(f[2],this._center.lat),C=s.mercatorZfromAltitude(_[2],this._center.lat);return new s.MercatorCoordinate(s.number(f[0],_[0],v)/this.worldSize,s.number(f[1],_[1],v)/this.worldSize,s.number(b,C,v))}pointCoordinate(l,f=this._centerAltitude){return this.projection.pointCoordinate(this,l.x,l.y,f)}pointCoordinate3D(l){if(!this.elevation)return this.pointCoordinate(l);let f=this.projection.pointCoordinate3D(this,l.x,l.y);if(f)return new s.MercatorCoordinate(f[0],f[1],f[2]);let _=0,v=this.horizonLineFromTop();if(l.y>v)return this.pointCoordinate(l);const b=.02*v,C=l.clone();for(let I=0;I<10&&v-_>b;I++){C.y=s.number(_,v,.66);const P=this.projection.pointCoordinate3D(this,C.x,C.y);P?(v=C.y,f=P):_=C.y}return f?new s.MercatorCoordinate(f[0],f[1],f[2]):this.pointCoordinate(l)}isPointAboveHorizon(l){return this.projection.isPointAboveHorizon(this,l)}isPointOnSurface(l){if(l.y<0||l.y>this.height||l.x<0||l.x>this.width)return!1;if(this.elevation||this.zoom>=s.GLOBE_ZOOM_THRESHOLD_MAX)return!this.isPointAboveHorizon(l);const f=this.pointCoordinate(l);return f.y>=0&&f.y<=1}_coordinatePoint(l,f){const _=f&&this.elevation?this.elevation.getAtPointOrZero(l,this._centerAltitude):this._centerAltitude,v=[l.x*this.worldSize,l.y*this.worldSize,_+l.toAltitude(),1];return s.transformMat4$1(v,v,this.pixelMatrix),v[3]>0?new s.Point(v[0]/v[3],v[1]/v[3]):new s.Point(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:l,left:f}=this._edgeInsets,_=this.height-this._edgeInsets.bottom,v=this.width-this._edgeInsets.right,b=this.pointLocation3D(new s.Point(f,l)),C=this.pointLocation3D(new s.Point(v,l)),I=this.pointLocation3D(new s.Point(v,_)),P=this.pointLocation3D(new s.Point(f,_));let O=Math.min(b.lng,C.lng,I.lng,P.lng),k=Math.max(b.lng,C.lng,I.lng,P.lng),U=Math.min(b.lat,C.lat,I.lat,P.lat),W=Math.max(b.lat,C.lat,I.lat,P.lat);const J=Math.pow(2,-this.zoom)/16*270,ee=this.projection.name==="globe"?1:4,Q=(te,V,K,se,ae)=>{const ge=(te+K)/2,ve=(V+se)/2,ye=new s.Point(ge,ve),{lng:Ie,lat:Ce}=this.pointLocation3D(ye),Ne=Math.max(0,O-Ie,U-Ce,Ie-k,Ce-W);O=Math.min(O,Ie),k=Math.max(k,Ie),U=Math.min(U,Ce),W=Math.max(W,Ce),(ae<ee||Ne>J)&&(Q(te,V,ge,ve,ae+1),Q(ge,ve,K,se,ae+1))};if(Q(f,l,v,l,1),Q(v,l,v,_,1),Q(v,_,f,_,1),Q(f,_,f,l,1),this.projection.name==="globe"){const[te,V]=s.polesInViewport(this);te?(W=90,k=180,O=-180):V&&(U=-90,k=180,O=-180)}return new s.LngLatBounds(new s.LngLat(O,U),new s.LngLat(k,W))}_getBoundsRectangular(l,f){const{top:_,left:v}=this._edgeInsets,b=this.height-this._edgeInsets.bottom,C=this.width-this._edgeInsets.right,I=new s.Point(v,_),P=new s.Point(C,_),O=new s.Point(C,b),k=new s.Point(v,b);let U=this.pointCoordinate(I,l),W=this.pointCoordinate(P,l);const J=this.pointCoordinate(O,f),ee=this.pointCoordinate(k,f),Q=(te,V)=>(V.y-te.y)/(V.x-te.x);return U.y>1&&W.y>=0?U=new s.MercatorCoordinate((1-ee.y)/Q(ee,U)+ee.x,1):U.y<0&&W.y<=1&&(U=new s.MercatorCoordinate(-ee.y/Q(ee,U)+ee.x,0)),W.y>1&&U.y>=0?W=new s.MercatorCoordinate((1-J.y)/Q(J,W)+J.x,1):W.y<0&&U.y<=1&&(W=new s.MercatorCoordinate(-J.y/Q(J,W)+J.x,0)),new s.LngLatBounds().extend(this.coordinateLocation(U)).extend(this.coordinateLocation(W)).extend(this.coordinateLocation(ee)).extend(this.coordinateLocation(J))}_getBoundsRectangularTerrain(){const l=this.elevation;if(!l.visibleDemTiles.length||l.isUsingMockSource())return this._getBoundsRectangular(0,0);const f=l.visibleDemTiles.reduce((_,v)=>{if(v.dem){const b=v.dem.tree;_.min=Math.min(_.min,b.minimums[0]),_.max=Math.max(_.max,b.maximums[0])}return _},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(f.min*l.exaggeration(),f.max*l.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(l=!0){const f=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,_=this.height/2-f*(1-this._horizonShift);return l?Math.max(0,_):_}getMaxBounds(){return this.maxBounds}setMaxBounds(l){this.maxBounds=l,this.minLat=-s.MAX_MERCATOR_LATITUDE,this.maxLat=s.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,l&&(this.minLat=l.getSouth(),this.maxLat=l.getNorth(),this.minLng=l.getWest(),this.maxLng=l.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=s.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=s.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=s.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=s.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(l,f){return this.projection.createTileMatrix(this,f,l)}calculateDistanceTileData(l){const f=l.key,_=this._distanceTileDataCache;if(_[f])return _[f];const v=l.canonical,b=1/this.height,C=this.cameraWorldSize,I=C/this.zoomScale(v.z),P=(v.x+Math.pow(2,v.z)*l.wrap)*I,O=v.y*I,k=this.point;k.x*=C/this.worldSize,k.y*=C/this.worldSize;const U=this.angle,W=Math.sin(-U),J=-Math.cos(-U);return _[f]={bearing:[W,J],center:[(k.x-P)*b,(k.y-O)*b],scale:I/s.EXTENT*b},_[f]}calculateFogTileMatrix(l){const f=l.key,_=this._fogTileMatrixCache;if(_[f])return _[f];const v=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,l);return s.multiply(v,this.worldToFogMatrix,v),_[f]=new Float32Array(v),_[f]}calculateProjMatrix(l,f=!1){const _=l.key,v=f?this._alignedProjMatrixCache:this._projMatrixCache;if(v[_])return v[_];const b=this.calculatePosMatrix(l,this.worldSize);return s.multiply(b,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:f?this.alignedProjMatrix:this.projMatrix,b),v[_]=new Float32Array(b),v[_]}calculatePixelsToTileUnitsMatrix(l){const f=l.tileID.key,_=this._pixelsToTileUnitsCache;if(_[f])return _[f];const v=function(b,C){const{scale:I}=b.tileTransform,P=I*s.EXTENT/(b.tileSize*Math.pow(2,C.zoom-b.tileID.overscaledZ+b.tileID.canonical.z));return O=new Float32Array(4),W=(k=C.inverseAdjustmentMatrix)[1],J=k[2],ee=k[3],te=(U=[P,P])[1],O[0]=k[0]*(Q=U[0]),O[1]=W*Q,O[2]=J*te,O[3]=ee*te,O;var O,k,U,W,J,ee,Q,te}(l,this);return _[f]=v,_[f]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const l=1/this.worldSize,f=s.fromScaling([],[l,l,l]);return s.multiply(f,f,this.globeMatrix),f}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const l=this._elevation;this._updateCameraState();const f=s.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,_=this._computeCameraPosition(f),v=this._camera.forward(),b=s.mercatorZfromAltitude(1,this._center.lat);_[2]/=b,v[2]/=b,s.normalize(v,v);const C=l.raycast(_,v,l.exaggeration());if(C){const I=s.scaleAndAdd([],_,v,C),P=new s.MercatorCoordinate(I[0],I[1],s.mercatorZfromAltitude(I[2],s.latFromMercatorY(I[1]))),O=(P.z+s.length([P.x-_[0],P.y-_[1],P.z-_[2]*b]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(O),this._centerAltitude=P.toAltitude(),this._center=this.coordinateLocation(P),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(l=!1){if(!this._elevation)return;const f=this._elevation,_=s.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,v=this._computeCameraPosition(_),b=f.getAtPointOrZero(new s.MercatorCoordinate(...v)),C=this.pixelsPerMeter/this.worldSize*b,I=this._minimumHeightOverTerrain(),P=v[2]-C;if(P<=I)if(P<0||l){const O=this.locationCoordinate(this._center,this._centerAltitude),k=[v[0],v[1],O.z-v[2]],U=s.length(k);k[2]-=(I-P)/this._pixelsPerMercatorPixel;const W=s.length(k);if(W===0)return;s.scale$2(k,k,U/W*this._pixelsPerMercatorPixel),this._camera.position=[v[0],v[1],O.z*this._pixelsPerMercatorPixel-k[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const l=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||l){const W=this.center;return W.lat=s.clamp(W.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!l)&&(W.lng=s.clamp(W.lng,this.minLng,this.maxLng)),this.center=W,void(this._constraining=!1)}const f=this._unmodified,{x:_,y:v}=this.point;let b=0,C=_,I=v;const P=this.width/2,O=this.height/2,k=this.worldMinY*this.scale,U=this.worldMaxY*this.scale;if(v-O<k&&(I=k+O),v+O>U&&(I=U-O),U-k<this.height&&(b=Math.max(b,this.height/(U-k)),I=(U+k)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const W=this.worldMinX*this.scale,J=this.worldMaxX*this.scale,ee=this.worldSize/2-(W+J)/2;C=(_+ee+this.worldSize)%this.worldSize-ee,C-P<W&&(C=W+P),C+P>J&&(C=J-P),J-W<this.width&&(b=Math.max(b,this.width/(J-W)),C=(J+W)/2)}C===_&&I===v||(this.center=this.unproject(new s.Point(C,I))),b&&(this.zoom+=this.scaleZoom(b)),this._constrainCamera(),this._unmodified=f,this._constraining=!1}_minZoomForBounds(){let l=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(l=Math.max(l,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),l}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const l=this.centerOffset,f=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=s.mercatorZfromAltitude(1,this.center.lat)/s.mercatorZfromAltitude(1,s.GLOBE_SCALE_MATCH_LATITUDE));const _=Qf(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,_),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const v=this.projection.zAxisUnit==="meters"?f:1,b=this._camera.getWorldToCamera(this.worldSize,v),C=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);C[8]=2*-l.x/this.width,C[9]=2*l.y/this.height;let I=s.mul([],C,b);if(this.projection.isReprojectedInTileSpace){const ve=this.locationCoordinate(this.center),ye=s.identity([]);s.translate(ye,ye,[ve.x*this.worldSize,ve.y*this.worldSize,0]),s.multiply(ye,ye,Qu(this)),s.translate(ye,ye,[-ve.x*this.worldSize,-ve.y*this.worldSize,0]),s.multiply(I,I,ye),this.inverseAdjustmentMatrix=function(Ie){const Ce=Qu(Ie,!0);return xe([],[Ce[0],Ce[1],Ce[4],Ce[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=s.scale([],I,[this.worldSize,this.worldSize,this.worldSize/v,1]),this.projMatrix=I,this.invProjMatrix=s.invert(new Float64Array(16),this.projMatrix);const P=s.invert([],C);this.frustumCorners=s.FrustumCorners.fromInvProjectionMatrix(P,this.horizonLineFromTop(),this.height);const O=new Float32Array(16);s.identity(O),s.scale(O,O,[1,-1,1]),s.rotateX(O,O,this._pitch),s.rotateZ(O,O,this.angle);const k=s.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),U=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;k[8]=2*-l.x/this.width,k[9]=2*(l.y+U)/this.height,this.skyboxMatrix=s.multiply(O,k,O);const W=this.point,J=W.x,ee=W.y,Q=this.width%2/2,te=this.height%2/2,V=Math.cos(this.angle),K=Math.sin(this.angle),se=J-Math.round(J)+V*Q+K*te,ae=ee-Math.round(ee)+V*te+K*Q,ge=new Float64Array(I);if(s.translate(ge,ge,[se>.5?se-1:se,ae>.5?ae-1:ae,0]),this.alignedProjMatrix=ge,I=s.create(),s.scale(I,I,[this.width/2,-this.height/2,1]),s.translate(I,I,[1,-1,0]),this.labelPlaneMatrix=I,I=s.create(),s.scale(I,I,[1,-1,1]),s.translate(I,I,[-1,-1,0]),s.scale(I,I,[2/this.width,2/this.height,1]),this.glCoordMatrix=I,this.pixelMatrix=s.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},I=s.invert(new Float64Array(16),this.pixelMatrix),!I)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=I,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=s.calculateGlobeMatrix(this);const ve=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=s.transformMat4(ve,ve,b),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=I;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const l=this.cameraWorldSizeForFog,f=this.cameraPixelsPerMeter,_=this._camera.position,v=1/this.height/this._pixelsPerMercatorPixel,b=[l,l,f];s.scale$2(b,b,v),s.scale$2(_,_,-1),s.multiply$2(_,_,b);const C=s.create();s.translate(C,C,_),s.scale(C,C,b),this.mercatorFogMatrix=C,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(l,f,v)}_computeCameraPosition(l){const f=(l=l||this.pixelsPerMeter)/this.pixelsPerMeter,_=this._camera.forward(),v=this.point,b=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*f-l/this.worldSize*this._centerAltitude;return[v.x/this.worldSize-_[0]*b,v.y/this.worldSize-_[1]*b,l/this.worldSize*this._centerAltitude-_[2]*b]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(l){const f=this._maxCameraBoundsDistance()*Math.cos(this._pitch),_=this._camera.position[2],v=l[2];let b=1;this.projection.wrap&&(this.center=this.center.wrap()),v>0&&(b=Math.min((f-_)/v,1)),this._camera.position=s.scaleAndAdd([],this._camera.position,l,b),this._updateStateFromCamera()}_updateStateFromCamera(){const l=this._camera.position,f=this._camera.forward(),{pitch:_,bearing:v}=this._camera.getPitchBearing(),b=s.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,C=this._mercatorZfromZoom(this._maxZoom)*Math.cos(s.degToRad(this._maxPitch)),I=Math.max((l[2]-b)/Math.cos(_),C),P=this._zoomFromMercatorZ(I);s.scaleAndAdd(l,l,f,I),this._pitch=s.clamp(_,s.degToRad(this.minPitch),s.degToRad(this.maxPitch)),this.angle=s.wrap(v,-Math.PI,Math.PI),this._setZoom(s.clamp(P,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new s.MercatorCoordinate(l[0],l[1],l[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(l){return Math.pow(2,l)*this.tileSize}_mercatorZfromZoom(l){return this.cameraToCenterDistance/this._worldSizeFromZoom(l)}_minimumHeightOverTerrain(){const l=Math.min((this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom)+4,this._maxZoom);return this._mercatorZfromZoom(l)}_zoomFromMercatorZ(l){return this.scaleZoom(this.cameraToCenterDistance/(l*this.tileSize))}zoomFromMercatorZAdjusted(l){let f=0,_=s.GLOBE_ZOOM_THRESHOLD_MAX,v=0,b=1/0;for(;_-f>1e-6&&_>f;){const C=f+.5*(_-f),I=this.tileSize*Math.pow(2,C),P=this.getCameraToCenterDistance(this.projection,C,I),O=this.scaleZoom(P/(l*this.tileSize)),k=Math.abs(C-O);k<b&&(b=k,v=C),C<O?f=C:_=C}return v}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(s.warnOnce("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(l,f){const _=Math.min(l.x,f.x),v=Math.max(l.x,f.x),b=Math.min(l.y,f.y),C=Math.max(l.y,f.y);if(b<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const I=[new s.Point(_,b),new s.Point(v,C),new s.Point(_,C),new s.Point(v,b)],P=this.renderWorldCopies?-3:0,O=this.renderWorldCopies?4:1;for(const k of I){const U=this.pointRayIntersection(k);if(U.t<0)return!0;const W=this.rayIntersectionCoordinate(U);if(W.x<P||W.y<0||W.x>O||W.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+s.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new s.Point(0,0),new s.Point(this.width,this.height))}zoomDeltaToMovement(l,f){const _=s.length(s.sub([],this._camera.position,l)),v=this._zoomFromMercatorZ(_)+f;return _-this._mercatorZfromZoom(v)}getCameraPoint(){if(this.projection.name==="globe"){const l=function([f,_,v],b){const C=[f,_,v,1];s.transformMat4$1(C,C,b);const I=C[3]=Math.max(C[3],1e-6);return C[0]/=I,C[1]/=I,C[2]/=I,C}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new s.Point(l[0],l[1])}{const l=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new s.Point(0,l))}}getCameraToCenterDistance(l,f=this.zoom,_=this.worldSize){const v=Qf(l,f,this.width,this.height,1024),b=l.pixelSpaceConversion(this.center.lat,_,v);return .5/Math.tan(.5*this._fov)*this.height*b}getWorldToCameraMatrix(){const l=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&s.multiply(l,l,this.globeMatrix),l}}function tc(m,l){let f=!1,_=null;const v=()=>{_=null,f&&(m(),_=setTimeout(v,l),f=!1)};return()=>(f=!0,_||v(),_)}class wm{constructor(l){this._hashName=l&&encodeURIComponent(l),s.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=tc(this._updateHashUnthrottled.bind(this),300)}addTo(l){return this._map=l,s.window.addEventListener("hashchange",this._onHashChange,!1),l.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),s.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const l=this._map;if(!l)return"";const f=bh(l);if(this._hashName){const _=this._hashName;let v=!1;const b=s.window.location.hash.slice(1).split("&").map(C=>{const I=C.split("=")[0];return I===_?(v=!0,`${I}=${f}`):C}).filter(C=>C);return v||b.push(`${_}=${f}`),`#${b.join("&")}`}return`#${f}`}_getCurrentHash(){const l=s.window.location.hash.replace("#","");if(this._hashName){let f;return l.split("&").map(_=>_.split("=")).forEach(_=>{_[0]===this._hashName&&(f=_)}),(f&&f[1]||"").split("/")}return l.split("/")}_onHashChange(){const l=this._map;if(!l)return!1;const f=this._getCurrentHash();if(f.length>=3&&!f.some(_=>isNaN(_))){const _=l.dragRotate.isEnabled()&&l.touchZoomRotate.isEnabled()?+(f[3]||0):l.getBearing();return l.jumpTo({center:[+f[2],+f[1]],zoom:+f[0],bearing:_,pitch:+(f[4]||0)}),!0}return!1}_updateHashUnthrottled(){const l=s.window.location.href.replace(/(#.+)?$/,this.getHashString());s.window.history.replaceState(s.window.history.state,null,l)}}function bh(m,l){const f=m.getCenter(),_=Math.round(100*m.getZoom())/100,v=Math.ceil((_*Math.LN2+Math.log(512/360/.5))/Math.LN10),b=Math.pow(10,v),C=Math.round(f.lng*b)/b,I=Math.round(f.lat*b)/b,P=m.getBearing(),O=m.getPitch();let k=l?`/${C}/${I}/${_}`:`${_}/${I}/${C}`;return(P||O)&&(k+="/"+Math.round(10*P)/10),O&&(k+=`/${Math.round(O)}`),k}const Eh={linearity:.3,easing:s.bezier(0,0,.3,1)},tp=s.extend({deceleration:2500,maxSpeed:1400},Eh),np=s.extend({deceleration:20,maxSpeed:1400},Eh),xt=s.extend({deceleration:1e3,maxSpeed:360},Eh),os=s.extend({deceleration:1e3,maxSpeed:90},Eh);class vy{constructor(l){this._map=l,this.clear()}clear(){this._inertiaBuffer=[]}record(l){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:s.exported.now(),settings:l})}_drainInertiaBuffer(){const l=this._inertiaBuffer,f=s.exported.now();for(;l.length>0&&f-l[0].time>160;)l.shift()}_onMoveEnd(l){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const f={zoom:0,bearing:0,pitch:0,pan:new s.Point(0,0),pinchAround:void 0,around:void 0};for(const{settings:b}of this._inertiaBuffer)f.zoom+=b.zoomDelta||0,f.bearing+=b.bearingDelta||0,f.pitch+=b.pitchDelta||0,b.panDelta&&f.pan._add(b.panDelta),b.around&&(f.around=b.around),b.pinchAround&&(f.pinchAround=b.pinchAround);const _=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,v={};if(f.pan.mag()){const b=Th(f.pan.mag(),_,s.extend({},tp,l||{}));v.offset=f.pan.mult(b.amount/f.pan.mag()),v.center=this._map.transform.center,Sh(v,b)}if(f.zoom){const b=Th(f.zoom,_,np);v.zoom=this._map.transform.zoom+b.amount,Sh(v,b)}if(f.bearing){const b=Th(f.bearing,_,xt);v.bearing=this._map.transform.bearing+s.clamp(b.amount,-179,179),Sh(v,b)}if(f.pitch){const b=Th(f.pitch,_,os);v.pitch=this._map.transform.pitch+b.amount,Sh(v,b)}if(v.zoom||v.bearing){const b=f.pinchAround===void 0?f.around:f.pinchAround;v.around=b?this._map.unproject(b):this._map.getCenter()}return this.clear(),v.noMoveStart=!0,v}}function Sh(m,l){(!m.duration||m.duration<l.duration)&&(m.duration=l.duration,m.easing=l.easing)}function Th(m,l,f){const{maxSpeed:_,linearity:v,deceleration:b}=f,C=s.clamp(m*v/(l/1e3),-_,_),I=Math.abs(C)/(b*v);return{easing:f.easing,duration:1e3*I,amount:C*(I/2)}}class ei extends s.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(l,f,_,v={}){const b=de(f.getCanvasContainer(),_),C=f.unproject(b);super(l,s.extend({point:b,lngLat:C,originalEvent:_},v)),this._defaultPrevented=!1,this.target=f}}class Ch extends s.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(l,f,_){const v=l==="touchend"?_.changedTouches:_.touches,b=we(f.getCanvasContainer(),v),C=b.map(P=>f.unproject(P)),I=b.reduce((P,O,k,U)=>P.add(O.div(U.length)),new s.Point(0,0));super(l,{points:b,point:I,lngLats:C,lngLat:f.unproject(I),originalEvent:_}),this._defaultPrevented=!1}}class rp extends s.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(l,f,_){super(l,{originalEvent:_}),this._defaultPrevented=!1}}class bm{constructor(l,f){this._map=l,this._clickTolerance=f.clickTolerance}reset(){this._mousedownPos=void 0}wheel(l){return this._firePreventable(new rp(l.type,this._map,l))}mousedown(l,f){return this._mousedownPos=f,this._firePreventable(new ei(l.type,this._map,l))}mouseup(l){this._map.fire(new ei(l.type,this._map,l))}preclick(l){const f=s.extend({},l);f.type="preclick",this._map.fire(new ei(f.type,this._map,f))}click(l,f){this._mousedownPos&&this._mousedownPos.dist(f)>=this._clickTolerance||(this.preclick(l),this._map.fire(new ei(l.type,this._map,l)))}dblclick(l){return this._firePreventable(new ei(l.type,this._map,l))}mouseover(l){this._map.fire(new ei(l.type,this._map,l))}mouseout(l){this._map.fire(new ei(l.type,this._map,l))}touchstart(l){return this._firePreventable(new Ch(l.type,this._map,l))}touchmove(l){this._map.fire(new Ch(l.type,this._map,l))}touchend(l){this._map.fire(new Ch(l.type,this._map,l))}touchcancel(l){this._map.fire(new Ch(l.type,this._map,l))}_firePreventable(l){if(this._map.fire(l),l.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class ip{constructor(l){this._map=l}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(l){this._map.fire(new ei(l.type,this._map,l))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new ei("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(l){this._delayContextMenu?this._contextMenuEvent=l:this._map.fire(new ei(l.type,this._map,l)),this._map.listens("contextmenu")&&l.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class xy{constructor(l,f){this._map=l,this._el=l.getCanvasContainer(),this._container=l.getContainer(),this._clickTolerance=f.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(l,f){this.isEnabled()&&l.shiftKey&&l.button===0&&(Y(),this._startPos=this._lastPos=f,this._active=!0)}mousemoveWindow(l,f){if(!this._active)return;const _=f,v=this._startPos,b=this._lastPos;if(!v||!b||b.equals(_)||!this._box&&_.dist(v)<this._clickTolerance)return;this._lastPos=_,this._box||(this._box=R("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",l));const C=Math.min(v.x,_.x),I=Math.max(v.x,_.x),P=Math.min(v.y,_.y),O=Math.max(v.y,_.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${C}px,${P}px)`,this._box.style.width=I-C+"px",this._box.style.height=O-P+"px")})}mouseupWindow(l,f){if(!this._active)return;const _=this._startPos,v=f;if(_&&l.button===0){if(this.reset(),oe(),_.x!==v.x||_.y!==v.y)return this._map.fire(new s.Event("boxzoomend",{originalEvent:l})),{cameraAnimation:b=>b.fitScreenCoordinates(_,v,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",l)}}keydown(l){this._active&&l.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",l))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),B(),delete this._startPos,delete this._lastPos}_fireEvent(l,f){return this._map.fire(new s.Event(l,{originalEvent:f}))}}function op(m,l){const f={};for(let _=0;_<m.length;_++)f[m[_].identifier]=l[_];return f}class nc{constructor(l){this.reset(),this.numTouches=l.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(l,f,_){(this.centroid||_.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=l.timeStamp),_.length===this.numTouches&&(this.centroid=function(v){const b=new s.Point(0,0);for(const C of v)b._add(C);return b.div(v.length)}(f),this.touches=op(_,f)))}touchmove(l,f,_){if(this.aborted||!this.centroid)return;const v=op(_,f);for(const b in this.touches){const C=v[b];(!C||C.dist(this.touches[b])>30)&&(this.aborted=!0)}}touchend(l,f,_){if((!this.centroid||l.timeStamp-this.startTime>500)&&(this.aborted=!0),_.length===0){const v=!this.aborted&&this.centroid;if(this.reset(),v)return v}}}class Em{constructor(l){this.singleTap=new nc(l),this.numTaps=l.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(l,f,_){this.singleTap.touchstart(l,f,_)}touchmove(l,f,_){this.singleTap.touchmove(l,f,_)}touchend(l,f,_){const v=this.singleTap.touchend(l,f,_);if(v){const b=l.timeStamp-this.lastTime<500,C=!this.lastTap||this.lastTap.dist(v)<30;if(b&&C||this.reset(),this.count++,this.lastTime=l.timeStamp,this.lastTap=v,this.count===this.numTaps)return this.reset(),v}}}class Jx{constructor(){this._zoomIn=new Em({numTouches:1,numTaps:2}),this._zoomOut=new Em({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(l,f,_){this._zoomIn.touchstart(l,f,_),this._zoomOut.touchstart(l,f,_)}touchmove(l,f,_){this._zoomIn.touchmove(l,f,_),this._zoomOut.touchmove(l,f,_)}touchend(l,f,_){const v=this._zoomIn.touchend(l,f,_),b=this._zoomOut.touchend(l,f,_);return v?(this._active=!0,l.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:C=>C.easeTo({duration:300,zoom:C.getZoom()+1,around:C.unproject(v)},{originalEvent:l})}):b?(this._active=!0,l.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:C=>C.easeTo({duration:300,zoom:C.getZoom()-1,around:C.unproject(b)},{originalEvent:l})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const wy={0:1,2:2};class rc{constructor(l){this.reset(),this._clickTolerance=l.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(l,f){return!1}_move(l,f){return{}}mousedown(l,f){if(this._lastPoint)return;const _=Se(l);this._correctButton(l,_)&&(this._lastPoint=f,this._eventButton=_)}mousemoveWindow(l,f){const _=this._lastPoint;if(_){if(l.preventDefault(),this._eventButton!=null&&function(v,b){const C=wy[b];return v.buttons===void 0||(v.buttons&C)!==C}(l,this._eventButton))this.reset();else if(this._moved||!(f.dist(_)<this._clickTolerance))return this._moved=!0,this._lastPoint=f,this._move(_,f)}}mouseupWindow(l){this._lastPoint&&Se(l)===this._eventButton&&(this._moved&&oe(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Sm extends rc{mousedown(l,f){super.mousedown(l,f),this._lastPoint&&(this._active=!0)}_correctButton(l,f){return f===0&&!l.ctrlKey}_move(l,f){return{around:f,panDelta:f.sub(l)}}}class Tm extends rc{_correctButton(l,f){return f===0&&l.ctrlKey||f===2}_move(l,f){const _=.8*(f.x-l.x);if(_)return this._active=!0,{bearingDelta:_}}contextmenu(l){l.preventDefault()}}class Cm extends rc{_correctButton(l,f){return f===0&&l.ctrlKey||f===2}_move(l,f){const _=-.5*(f.y-l.y);if(_)return this._active=!0,{pitchDelta:_}}contextmenu(l){l.preventDefault()}}class sp{constructor(l,f){this._map=l,this._el=l.getCanvasContainer(),this._minTouches=1,this._clickTolerance=f.clickTolerance||1,this.reset(),s.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new s.Point(0,0)}touchstart(l,f,_){return this._calculateTransform(l,f,_)}touchmove(l,f,_){if(this._active&&!(_.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(_.length===1&&!s.isFullscreen())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return l.cancelable&&l.preventDefault(),this._calculateTransform(l,f,_)}}touchend(l,f,_){this._calculateTransform(l,f,_),this._active&&_.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(l,f,_){_.length>0&&(this._active=!0);const v=op(_,f),b=new s.Point(0,0),C=new s.Point(0,0);let I=0;for(const O in v){const k=v[O],U=this._touches[O];U&&(b._add(k),C._add(k.sub(U)),I++,v[O]=k)}if(this._touches=v,I<this._minTouches||!C.mag())return;const P=C.div(I);return this._sum._add(P),this._sum.mag()<this._clickTolerance?void 0:{around:b.div(I),panDelta:P}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=R("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")},500)}}class Ih{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(l){}_move(l,f,_){return{}}touchstart(l,f,_){this._firstTwoTouches||_.length<2||(this._firstTwoTouches=[_[0].identifier,_[1].identifier],this._start([f[0],f[1]]))}touchmove(l,f,_){const v=this._firstTwoTouches;if(!v)return;l.preventDefault();const[b,C]=v,I=Mh(_,f,b),P=Mh(_,f,C);if(!I||!P)return;const O=this._aroundCenter?null:I.add(P).div(2);return this._move([I,P],O,l)}touchend(l,f,_){if(!this._firstTwoTouches)return;const[v,b]=this._firstTwoTouches,C=Mh(_,f,v),I=Mh(_,f,b);C&&I||(this._active&&oe(),this.reset())}touchcancel(){this.reset()}enable(l){this._enabled=!0,this._aroundCenter=!!l&&l.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Mh(m,l,f){for(let _=0;_<m.length;_++)if(m[_].identifier===f)return l[_]}function Im(m,l){return Math.log(m/l)/Math.LN2}class by extends Ih{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(l){this._startDistance=this._distance=l[0].dist(l[1])}_move(l,f){const _=this._distance;if(this._distance=l[0].dist(l[1]),this._active||!(Math.abs(Im(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Im(this._distance,_),pinchAround:f}}}function Mm(m,l){return 180*m.angleWith(l)/Math.PI}class Ey extends Ih{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(l){this._startVector=this._vector=l[0].sub(l[1]),this._minDiameter=l[0].dist(l[1])}_move(l,f){const _=this._vector;if(this._vector=l[0].sub(l[1]),_&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Mm(this._vector,_),pinchAround:f}}_isBelowThreshold(l){this._minDiameter=Math.min(this._minDiameter,l.mag());const f=25/(Math.PI*this._minDiameter)*360,_=this._startVector;if(!_)return!1;const v=Mm(l,_);return Math.abs(v)<f}}function cl(m){return Math.abs(m.y)>Math.abs(m.x)}class Sy extends Ih{constructor(l){super(),this._map=l}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(l){this._lastPoints=l,cl(l[0].sub(l[1]))&&(this._valid=!1)}_move(l,f,_){const v=this._lastPoints;if(!v)return;const b=l[0].sub(v[0]),C=l[1].sub(v[1]);return this._map._cooperativeGestures&&!s.isFullscreen()&&_.touches.length<3||(this._valid=this.gestureBeginsVertically(b,C,_.timeStamp),!this._valid)?void 0:(this._lastPoints=l,this._active=!0,{pitchDelta:(b.y+C.y)/2*-.5})}gestureBeginsVertically(l,f,_){if(this._valid!==void 0)return this._valid;const v=l.mag()>=2,b=f.mag()>=2;if(!v&&!b)return;if(!v||!b)return this._firstMove==null&&(this._firstMove=_),_-this._firstMove<100&&void 0;const C=l.y>0==f.y>0;return cl(l)&&cl(f)&&C}}const Ty={panStep:100,bearingStep:15,pitchStep:10};class Qx{constructor(){const l=Ty;this._panStep=l.panStep,this._bearingStep=l.bearingStep,this._pitchStep=l.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(l){if(l.altKey||l.ctrlKey||l.metaKey)return;let f=0,_=0,v=0,b=0,C=0;switch(l.keyCode){case 61:case 107:case 171:case 187:f=1;break;case 189:case 109:case 173:f=-1;break;case 37:l.shiftKey?_=-1:(l.preventDefault(),b=-1);break;case 39:l.shiftKey?_=1:(l.preventDefault(),b=1);break;case 38:l.shiftKey?v=1:(l.preventDefault(),C=-1);break;case 40:l.shiftKey?v=-1:(l.preventDefault(),C=1);break;default:return}return this._rotationDisabled&&(_=0,v=0),{cameraAnimation:I=>{const P=I.getZoom();I.easeTo({duration:300,easeId:"keyboardHandler",easing:Cy,zoom:f?Math.round(P)+f*(l.shiftKey?2:1):P,bearing:I.getBearing()+_*this._bearingStep,pitch:I.getPitch()+v*this._pitchStep,offset:[-b*this._panStep,-C*this._panStep],center:I.getCenter()},{originalEvent:l})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Cy(m){return m*(2-m)}const Am=4.000244140625;class Iy{constructor(l,f){this._map=l,this._el=l.getCanvasContainer(),this._handler=f,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,s.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(l){this._defaultZoomRate=l}setWheelZoomRate(l){this._wheelZoomRate=l}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(l){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!l&&l.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(l){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(l.ctrlKey||l.metaKey||this.isZooming()||s.isFullscreen()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let f=l.deltaMode===s.window.WheelEvent.DOM_DELTA_LINE?40*l.deltaY:l.deltaY;const _=s.exported.now(),v=_-(this._lastWheelEventTime||0);this._lastWheelEventTime=_,f!==0&&f%Am==0?this._type="wheel":f!==0&&Math.abs(f)<4?this._type="trackpad":v>400?(this._type=null,this._lastValue=f,this._timeout=setTimeout(this._onTimeout,40,l)):this._type||(this._type=Math.abs(v*f)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,f+=this._lastValue)),l.shiftKey&&f&&(f/=4),this._type&&(this._lastWheelEvent=l,this._delta-=f,this._active||this._start(l)),l.preventDefault()}_onTimeout(l){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(l)}_start(l){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const f=de(this._el,l);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:f,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const l=this._map.transform;this._type==="wheel"&&l.projection.wrap&&(l._center.lng>=180||l._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const f=()=>l._terrainEnabled()&&this._aroundCoord?l.computeZoomRelativeTo(this._aroundCoord):l.zoom;if(this._delta!==0){const P=this._type==="wheel"&&Math.abs(this._delta)>Am?this._wheelZoomRate:this._defaultZoomRate;let O=2/(1+Math.exp(-Math.abs(this._delta*P)));this._delta<0&&O!==0&&(O=1/O);const k=f(),U=Math.pow(2,k),W=typeof this._targetZoom=="number"?l.zoomScale(this._targetZoom):U;this._targetZoom=Math.min(l.maxZoom,Math.max(l.minZoom,l.scaleZoom(W*O))),this._type==="wheel"&&(this._startZoom=k,this._easing=this._smoothOutEasing(200)),this._delta=0}const _=typeof this._targetZoom=="number"?this._targetZoom:f(),v=this._startZoom,b=this._easing;let C,I=!1;if(this._type==="wheel"&&v&&b){const P=Math.min((s.exported.now()-this._lastWheelEventTime)/200,1),O=b(P);C=s.number(v,_,O),P<1?this._frameId||(this._frameId=!0):I=!0}else C=_,I=!0;return this._active=!0,I&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!I,zoomDelta:C-f(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(l){let f=s.ease;if(this._prevEase){const _=this._prevEase,v=(s.exported.now()-_.start)/_.duration,b=_.easing(v+.01)-_.easing(v),C=.27/Math.sqrt(b*b+1e-4)*.01,I=Math.sqrt(.0729-C*C);f=s.bezier(C,I,.25,1)}return this._prevEase={start:s.exported.now(),duration:l,easing:f},f}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=R("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(s.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")},200)}}class My{constructor(l,f){this._clickZoom=l,this._tapZoom=f}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class bi{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(l,f){return l.preventDefault(),{cameraAnimation:_=>{_.easeTo({duration:300,zoom:_.getZoom()+(l.shiftKey?-1:1),around:_.unproject(f)},{originalEvent:l})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class e1{constructor(){this._tap=new Em({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(l,f,_){this._swipePoint||(this._tapTime&&l.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?_.length>0&&(this._swipePoint=f[0],this._swipeTouch=_[0].identifier):this._tap.touchstart(l,f,_))}touchmove(l,f,_){if(this._tapTime){if(this._swipePoint){if(_[0].identifier!==this._swipeTouch)return;const v=f[0],b=v.y-this._swipePoint.y;return this._swipePoint=v,l.preventDefault(),this._active=!0,{zoomDelta:b/128}}}else this._tap.touchmove(l,f,_)}touchend(l,f,_){this._tapTime?this._swipePoint&&_.length===0&&this.reset():this._tap.touchend(l,f,_)&&(this._tapTime=l.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ay{constructor(l,f,_){this._el=l,this._mousePan=f,this._touchPan=_}enable(l){this._inertiaOptions=l||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class t1{constructor(l,f,_){this._pitchWithRotate=l.pitchWithRotate,this._mouseRotate=f,this._mousePitch=_}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class n1{constructor(l,f,_,v){this._el=l,this._touchZoom=f,this._touchRotate=_,this._tapDragZoom=v,this._rotationDisabled=!1,this._enabled=!0}enable(l){this._touchZoom.enable(l),this._rotationDisabled||this._touchRotate.enable(l),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const ko=m=>m.zoom||m.drag||m.pitch||m.rotate;class Py extends s.Event{}class r1{constructor(){this.constants=[1,1,.01],this.radius=0}setup(l,f){const _=s.sub([],f,l);this.radius=s.length(_[2]<0?s.div([],_,this.constants):[_[0],_[1],0])}projectRay(l){s.div(l,l,this.constants),s.normalize(l,l),s.mul$1(l,l,this.constants);const f=s.scale$2([],l,this.radius);if(f[2]>0){const _=s.scale$2([],[0,0,1],s.dot(f,[0,0,1])),v=s.scale$2([],s.normalize([],[f[0],f[1],0]),this.radius),b=s.add([],f,s.scale$2([],s.sub([],s.add([],v,_),f),2));f[0]=b[0],f[1]=b[1]}return f}}function ss(m){return m.panDelta&&m.panDelta.mag()||m.zoomDelta||m.bearingDelta||m.pitchDelta}class Os{constructor(l,f){this._map=l,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new vy(l),this._bearingSnap=f.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new r1,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(f),s.bindAll(["handleEvent","handleWindowEvent"],this);const _=this._el;this._listeners=[[_,"touchstart",{passive:!0}],[_,"touchmove",{passive:!1}],[_,"touchend",void 0],[_,"touchcancel",void 0],[_,"mousedown",void 0],[_,"mousemove",void 0],[_,"mouseup",void 0],[s.window.document,"mousemove",{capture:!0}],[s.window.document,"mouseup",void 0],[_,"mouseover",void 0],[_,"mouseout",void 0],[_,"dblclick",void 0],[_,"click",void 0],[_,"keydown",{capture:!1}],[_,"keyup",void 0],[_,"wheel",{passive:!1}],[_,"contextmenu",void 0],[s.window,"blur",void 0]];for(const[v,b,C]of this._listeners)v.addEventListener(b,v===s.window.document?this.handleWindowEvent:this.handleEvent,C)}destroy(){for(const[l,f,_]of this._listeners)l.removeEventListener(f,l===s.window.document?this.handleWindowEvent:this.handleEvent,_)}_addDefaultHandlers(l){const f=this._map,_=f.getCanvasContainer();this._add("mapEvent",new bm(f,l));const v=f.boxZoom=new xy(f,l);this._add("boxZoom",v);const b=new Jx,C=new bi;f.doubleClickZoom=new My(C,b),this._add("tapZoom",b),this._add("clickZoom",C);const I=new e1;this._add("tapDragZoom",I);const P=f.touchPitch=new Sy(f);this._add("touchPitch",P);const O=new Tm(l),k=new Cm(l);f.dragRotate=new t1(l,O,k),this._add("mouseRotate",O,["mousePitch"]),this._add("mousePitch",k,["mouseRotate"]);const U=new Sm(l),W=new sp(f,l);f.dragPan=new Ay(_,U,W),this._add("mousePan",U),this._add("touchPan",W,["touchZoom","touchRotate"]);const J=new Ey,ee=new by;f.touchZoomRotate=new n1(_,ee,J,I),this._add("touchRotate",J,["touchPan","touchZoom"]),this._add("touchZoom",ee,["touchPan","touchRotate"]),this._add("blockableMapEvent",new ip(f));const Q=f.scrollZoom=new Iy(f,this);this._add("scrollZoom",Q,["mousePan"]);const te=f.keyboard=new Qx;this._add("keyboard",te);for(const V of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])l.interactive&&l[V]&&f[V].enable(l[V])}_add(l,f,_){this._handlers.push({handlerName:l,handler:f,allowed:_}),this._handlersById[l]=f}stop(l){if(!this._updatingCamera){for(const{handler:f}of this._handlers)f.reset();this._inertia.clear(),this._fireEvents({},{},l),this._changes=[]}}isActive(){for(const{handler:l}of this._handlers)if(l.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!ko(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(l,f,_){for(const v in l)if(v!==_&&(!f||f.indexOf(v)<0))return!0;return!1}handleWindowEvent(l){this.handleEvent(l,`${l.type}Window`)}_getMapTouches(l){const f=[];for(const _ of l)this._el.contains(_.target)&&f.push(_);return f}handleEvent(l,f){this._updatingCamera=!0;const _=l.type==="renderFrame",v=_?void 0:l,b={needsRenderFrame:!1},C={},I={},P=l.touches?this._getMapTouches(l.touches):void 0,O=P?we(this._el,P):_?void 0:de(this._el,l);for(const{handlerName:W,handler:J,allowed:ee}of this._handlers){if(!J.isEnabled())continue;let Q;this._blockedByActive(I,ee,W)?J.reset():J[f||l.type]&&(Q=J[f||l.type](l,O,P),this.mergeHandlerResult(b,C,Q,W,v),Q&&Q.needsRenderFrame&&this._triggerRenderFrame()),(Q||J.isActive())&&(I[W]=J)}const k={};for(const W in this._previousActiveHandlers)I[W]||(k[W]=v);this._previousActiveHandlers=I,(Object.keys(k).length||ss(b))&&(this._changes.push([b,C,k]),this._triggerRenderFrame()),(Object.keys(I).length||ss(b))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:U}=b;U&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],U(this._map))}mergeHandlerResult(l,f,_,v,b){if(!_)return;s.extend(l,_);const C={handlerName:v,originalEvent:_.originalEvent||b};_.zoomDelta!==void 0&&(f.zoom=C),_.panDelta!==void 0&&(f.drag=C),_.pitchDelta!==void 0&&(f.pitch=C),_.bearingDelta!==void 0&&(f.rotate=C)}_applyChanges(){const l={},f={},_={};for(const[v,b,C]of this._changes)v.panDelta&&(l.panDelta=(l.panDelta||new s.Point(0,0))._add(v.panDelta)),v.zoomDelta&&(l.zoomDelta=(l.zoomDelta||0)+v.zoomDelta),v.bearingDelta&&(l.bearingDelta=(l.bearingDelta||0)+v.bearingDelta),v.pitchDelta&&(l.pitchDelta=(l.pitchDelta||0)+v.pitchDelta),v.around!==void 0&&(l.around=v.around),v.aroundCoord!==void 0&&(l.aroundCoord=v.aroundCoord),v.pinchAround!==void 0&&(l.pinchAround=v.pinchAround),v.noInertia&&(l.noInertia=v.noInertia),s.extend(f,b),s.extend(_,C);this._updateMapTransform(l,f,_),this._changes=[]}_updateMapTransform(l,f,_){const v=this._map,b=v.transform,C=K=>[K.x,K.y,K.z];if((K=>{const se=this._eventsInProgress.drag;return se&&!this._handlersById[se.handlerName].isActive()})()&&!ss(l)){const K=b.zoom;b.cameraElevationReference="sea",b.recenterOnTerrain(),b.cameraElevationReference="ground",K!==b.zoom&&this._map._update(!0)}if(b._isCameraConstrained&&v._stop(!0),!ss(l))return void this._fireEvents(f,_,!0);let{panDelta:I,zoomDelta:P,bearingDelta:O,pitchDelta:k,around:U,aroundCoord:W,pinchAround:J}=l;b._isCameraConstrained&&(P>0&&(P=0),b._isCameraConstrained=!1),J!==void 0&&(U=J),(P||(K=>f[K]&&!this._eventsInProgress[K])("drag"))&&U&&(this._dragOrigin=C(b.pointCoordinate3D(U)),this._trackingEllipsoid.setup(b._camera.position,this._dragOrigin)),b.cameraElevationReference="sea",v._stop(!0),U=U||v.transform.centerPoint,O&&(b.bearing+=O),k&&(b.pitch+=k),b._updateCameraState();const ee=[0,0,0];if(I)if(b.projection.name==="mercator"){const K=this._trackingEllipsoid.projectRay(b.screenPointToMercatorRay(U).dir),se=this._trackingEllipsoid.projectRay(b.screenPointToMercatorRay(U.sub(I)).dir);ee[0]=se[0]-K[0],ee[1]=se[1]-K[1]}else{const K=b.pointCoordinate(U);if(b.projection.name==="globe"){I=I.rotate(-b.angle);const se=b._pixelsPerMercatorPixel/b.worldSize;ee[0]=-I.x*s.mercatorScale(s.latFromMercatorY(K.y))*se,ee[1]=-I.y*s.mercatorScale(b.center.lat)*se}else{const se=b.pointCoordinate(U.sub(I));K&&se&&(ee[0]=se.x-K.x,ee[1]=se.y-K.y)}}const Q=b.zoom,te=[0,0,0];if(P){const K=C(W||b.pointCoordinate3D(U)),se={dir:s.normalize([],s.sub([],K,b._camera.position))};if(se.dir[2]<0){const ae=b.zoomDeltaToMovement(K,P);s.scale$2(te,se.dir,ae)}}const V=s.add(ee,ee,te);b._translateCameraConstrained(V),P&&Math.abs(b.zoom-Q)>1e-4&&b.recenterOnTerrain(),b.cameraElevationReference="ground",this._map._update(),l.noInertia||this._inertia.record(l),this._fireEvents(f,_,!0)}_fireEvents(l,f,_){const v=ko(this._eventsInProgress),b=ko(l),C={};for(const k in l){const{originalEvent:U}=l[k];this._eventsInProgress[k]||(C[`${k}start`]=U),this._eventsInProgress[k]=l[k]}!v&&b&&this._fireEvent("movestart",b.originalEvent);for(const k in C)this._fireEvent(k,C[k]);b&&this._fireEvent("move",b.originalEvent);for(const k in l){const{originalEvent:U}=l[k];this._fireEvent(k,U)}const I={};let P;for(const k in this._eventsInProgress){const{handlerName:U,originalEvent:W}=this._eventsInProgress[k];this._handlersById[U].isActive()||(delete this._eventsInProgress[k],P=f[U]||W,I[`${k}end`]=P)}for(const k in I)this._fireEvent(k,I[k]);const O=ko(this._eventsInProgress);if(_&&(v||b)&&!O){this._updatingCamera=!0;const k=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),U=W=>W!==0&&-this._bearingSnap<W&&W<this._bearingSnap;k?(U(k.bearing||this._map.getBearing())&&(k.bearing=0),this._map.easeTo(k,{originalEvent:P})):(this._map.fire(new s.Event("moveend",{originalEvent:P})),U(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(l,f){this._map.fire(new s.Event(l,f?{originalEvent:f}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(l=>{this._frameId=void 0,this.handleEvent(new Py("renderFrame",{timeStamp:l})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const eu="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class ap extends s.Evented{constructor(l,f){super(),this._moving=!1,this._zooming=!1,this.transform=l,this._bearingSnap=f.bearingSnap,this._respectPrefersReducedMotion=f.respectPrefersReducedMotion!==!1,s.bindAll(["_renderFrameCallback"],this)}getCenter(){return new s.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(l,f){return this.jumpTo({center:l},f)}panBy(l,f,_){return l=s.Point.convert(l).mult(-1),this.panTo(this.transform.center,s.extend({offset:l},f),_)}panTo(l,f,_){return this.easeTo(s.extend({center:l},f),_)}getZoom(){return this.transform.zoom}setZoom(l,f){return this.jumpTo({zoom:l},f),this}zoomTo(l,f,_){return this.easeTo(s.extend({zoom:l},f),_)}zoomIn(l,f){return this.zoomTo(this.getZoom()+1,l,f),this}zoomOut(l,f){return this.zoomTo(this.getZoom()-1,l,f),this}getBearing(){return this.transform.bearing}setBearing(l,f){return this.jumpTo({bearing:l},f),this}getPadding(){return this.transform.padding}setPadding(l,f){return this.jumpTo({padding:l},f),this}rotateTo(l,f,_){return this.easeTo(s.extend({bearing:l},f),_)}resetNorth(l,f){return this.rotateTo(0,s.extend({duration:1e3},l),f),this}resetNorthPitch(l,f){return this.easeTo(s.extend({bearing:0,pitch:0,duration:1e3},l),f),this}snapToNorth(l,f){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(l,f):this}getPitch(){return this.transform.pitch}setPitch(l,f){return this.jumpTo({pitch:l},f),this}cameraForBounds(l,f){l=s.LngLatBounds.convert(l);const _=f&&f.bearing||0,v=f&&f.pitch||0,b=l.getNorthWest(),C=l.getSouthEast();return this._cameraForBounds(this.transform,b,C,_,v,f)}_extendCameraOptions(l){const f={top:0,bottom:0,right:0,left:0};if(typeof(l=s.extend({padding:f,offset:[0,0],maxZoom:this.transform.maxZoom},l)).padding=="number"){const _=l.padding;l.padding={top:_,bottom:_,right:_,left:_}}return l.padding=s.extend(f,l.padding),l}_minimumAABBFrustumDistance(l,f){const _=f.max[0]-f.min[0],v=f.max[1]-f.min[1];return _/v>l.aspect?_/(2*Math.tan(.5*l.fovX)*l.aspect):v/(2*Math.tan(.5*l.fovY)*l.aspect)}_cameraForBoundsOnGlobe(l,f,_,v,b,C){const I=l.clone(),P=this._extendCameraOptions(C);I.bearing=v,I.pitch=b;const O=s.LngLat.convert(f),k=s.LngLat.convert(_),U=.5*(O.lat+k.lat),W=.5*(O.lng+k.lng),J=s.latLngToECEF(U,W),ee=s.normalize([],J),Q=s.normalize([],s.cross([],ee,[0,1,0])),te=s.cross([],Q,ee),V=[Q[0],Q[1],Q[2],0,te[0],te[1],te[2],0,ee[0],ee[1],ee[2],0,0,0,0,1],K=[J,s.latLngToECEF(O.lat,O.lng),s.latLngToECEF(k.lat,O.lng),s.latLngToECEF(k.lat,k.lng),s.latLngToECEF(O.lat,k.lng),s.latLngToECEF(U,O.lng),s.latLngToECEF(U,k.lng),s.latLngToECEF(O.lat,W),s.latLngToECEF(k.lat,W)];let se=s.Aabb.fromPoints(K.map(Qe=>[s.dot(Q,Qe),s.dot(te,Qe),s.dot(ee,Qe)]));const ae=s.transformMat4([],se.center,V);s.squaredLength(ae)===0&&s.set(ae,0,0,1),s.normalize(ae,ae),s.scale$2(ae,ae,s.GLOBE_RADIUS),I.center=s.ecefToLatLng(ae);const ge=I.getWorldToCameraMatrix(),ve=s.invert(new Float64Array(16),ge);se=s.Aabb.applyTransform(se,s.multiply([],ge,V)),s.transformMat4(ae,ae,ge);const ye=.5*(se.max[2]-se.min[2]),Ie=this._minimumAABBFrustumDistance(I,se),Ce=s.scale$2([],[0,0,1],ye),Ne=s.add(Ce,ae,Ce),rt=Ie+(I.pitch===0?0:s.distance(ae,Ne)),Le=I.globeCenterInViewSpace,Ye=s.sub([],ae,[Le[0],Le[1],Le[2]]);s.normalize(Ye,Ye),s.scale$2(Ye,Ye,rt);const Fe=s.add([],ae,Ye);s.transformMat4(Fe,Fe,ve);const nt=s.earthRadius/s.GLOBE_RADIUS,Re=s.length(Fe),Ze=s.mercatorZfromAltitude(Math.max(Re*nt-s.earthRadius,Number.EPSILON),0),ot=Math.min(I.zoomFromMercatorZAdjusted(Ze),P.maxZoom);return ot>.5*(s.GLOBE_ZOOM_THRESHOLD_MIN+s.GLOBE_ZOOM_THRESHOLD_MAX)?(I.setProjection({name:"mercator"}),I.zoom=ot,this._cameraForBounds(I,f,_,v,b,C)):{center:I.center,zoom:ot,bearing:v,pitch:b}}queryTerrainElevation(l,f){const _=this.transform.elevation;return _?(f=s.extend({},{exaggerated:!0},f),_.getAtPoint(s.MercatorCoordinate.fromLngLat(l),null,f.exaggerated)):null}_cameraForBounds(l,f,_,v,b,C){if(l.projection.name==="globe")return this._cameraForBoundsOnGlobe(l,f,_,v,b,C);const I=l.clone(),P=this._extendCameraOptions(C),O=I.padding;I.bearing=v,I.pitch=b;const k=s.LngLat.convert(f),U=s.LngLat.convert(_),W=new s.LngLat(k.lng,U.lat),J=new s.LngLat(U.lng,k.lat),ee=I.project(k),Q=I.project(U),te=this.queryTerrainElevation(k),V=this.queryTerrainElevation(U),K=this.queryTerrainElevation(W),se=this.queryTerrainElevation(J),ae=[[ee.x,ee.y,Math.min(te||0,V||0,K||0,se||0)],[Q.x,Q.y,Math.max(te||0,V||0,K||0,se||0)]];let ge=s.Aabb.fromPoints(ae);const ve=I.getWorldToCameraMatrix(),ye=s.invert(new Float64Array(16),ve);ge=s.Aabb.applyTransform(ge,ve);const Ie=s.sub([],ge.max,ge.min),Ce=O.left||0,Ne=O.right||0,rt=O.bottom||0,Le=O.top||0,{left:Ye,right:Fe,top:nt,bottom:Re}=P.padding,Ze=.5*(Ce+Ne),ot=.5*(Le+rt),Qe=Math.min(I.scaleZoom(I.scale*Math.min((I.width-(Ce+Ne+Ye+Fe))/Ie[0],(I.height-(rt+Le+Re+nt))/Ie[1])),P.maxZoom),st=I.scale/I.zoomScale(Qe);ge=new s.Aabb([ge.min[0]-(Ye+Ze)*st,ge.min[1]-(Re+ot)*st,ge.min[2]],[ge.max[0]+(Fe+Ze)*st,ge.max[1]+(nt+ot)*st,ge.max[2]]);const Mt=.5*Ie[2],jt=this._minimumAABBFrustumDistance(I,ge),St=[0,0,1,0];s.transformMat4$1(St,St,ve),s.normalize$2(St,St);const Ot=s.scale$2([],St,jt+Mt),an=s.add([],ge.center,Ot),nn=(typeof P.offset.x=="number"&&typeof P.offset.y=="number"?new s.Point(P.offset.x,P.offset.y):s.Point.convert(P.offset)).rotate(-s.degToRad(v));ge.center[0]-=nn.x*st,ge.center[1]+=nn.y*st,s.transformMat4(ge.center,ge.center,ye),s.transformMat4(an,an,ye);const It=[ge.center[0],ge.center[1],an[2]*I.pixelsPerMeter];s.scale$2(It,It,1/I.worldSize);const In=s.lngFromMercatorX(It[0]),Dn=s.latFromMercatorY(It[1]),Rn=Math.min(I._zoomFromMercatorZ(It[2]),P.maxZoom),Nn=new s.LngLat(In,Dn);return I.mercatorFromTransition&&Rn<.5*(s.GLOBE_ZOOM_THRESHOLD_MIN+s.GLOBE_ZOOM_THRESHOLD_MAX)?(I.setProjection({name:"globe"}),I.zoom=Rn,this._cameraForBounds(I,f,_,v,b,C)):{center:Nn,zoom:Rn,bearing:v,pitch:b}}fitBounds(l,f,_){const v=this.cameraForBounds(l,f);return this._fitInternal(v,f,_)}fitScreenCoordinates(l,f,_,v,b){const C=s.Point.convert(l),I=s.Point.convert(f),P=new s.Point(Math.min(C.x,I.x),Math.min(C.y,I.y)),O=new s.Point(Math.max(C.x,I.x),Math.max(C.y,I.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(C,I))return this;const k=this.transform.pointLocation3D(P),U=this.transform.pointLocation3D(O),W=this.transform.pointLocation3D(new s.Point(P.x,O.y)),J=this.transform.pointLocation3D(new s.Point(O.x,P.y)),ee=[Math.min(k.lng,U.lng,W.lng,J.lng),Math.min(k.lat,U.lat,W.lat,J.lat)],Q=[Math.max(k.lng,U.lng,W.lng,J.lng),Math.max(k.lat,U.lat,W.lat,J.lat)],te=v&&v.pitch?v.pitch:this.getPitch(),V=this._cameraForBounds(this.transform,ee,Q,_,te,v);return this._fitInternal(V,v,b)}_fitInternal(l,f,_){return l?(delete(f=s.extend(l,f)).padding,f.linear?this.easeTo(f,_):this.flyTo(f,_)):this}jumpTo(l,f){this.stop();const _=l.preloadOnly?this.transform.clone():this.transform;let v=!1,b=!1,C=!1;return"zoom"in l&&_.zoom!==+l.zoom&&(v=!0,_.zoom=+l.zoom),l.center!==void 0&&(_.center=s.LngLat.convert(l.center)),"bearing"in l&&_.bearing!==+l.bearing&&(b=!0,_.bearing=+l.bearing),"pitch"in l&&_.pitch!==+l.pitch&&(C=!0,_.pitch=+l.pitch),l.padding==null||_.isPaddingEqual(l.padding)||(_.padding=l.padding),l.preloadOnly?(this._preloadTiles(_),this):(this.fire(new s.Event("movestart",f)).fire(new s.Event("move",f)),v&&this.fire(new s.Event("zoomstart",f)).fire(new s.Event("zoom",f)).fire(new s.Event("zoomend",f)),b&&this.fire(new s.Event("rotatestart",f)).fire(new s.Event("rotate",f)).fire(new s.Event("rotateend",f)),C&&this.fire(new s.Event("pitchstart",f)).fire(new s.Event("pitch",f)).fire(new s.Event("pitchend",f)),this.fire(new s.Event("moveend",f)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||s.warnOnce(eu),this.transform.getFreeCameraOptions()}setFreeCameraOptions(l,f){const _=this.transform;if(!_.projection.supportsFreeCamera)return s.warnOnce(eu),this;this.stop();const v=_.zoom,b=_.pitch,C=_.bearing;_.setFreeCameraOptions(l);const I=v!==_.zoom,P=b!==_.pitch,O=C!==_.bearing;return this.fire(new s.Event("movestart",f)).fire(new s.Event("move",f)),I&&this.fire(new s.Event("zoomstart",f)).fire(new s.Event("zoom",f)).fire(new s.Event("zoomend",f)),O&&this.fire(new s.Event("rotatestart",f)).fire(new s.Event("rotate",f)).fire(new s.Event("rotateend",f)),P&&this.fire(new s.Event("pitchstart",f)).fire(new s.Event("pitch",f)).fire(new s.Event("pitchend",f)),this.fire(new s.Event("moveend",f)),this}easeTo(l,f){this._stop(!1,l.easeId),((l=s.extend({offset:[0,0],duration:500,easing:s.ease},l)).animate===!1||this._prefersReducedMotion(l))&&(l.duration=0);const _=this.transform,v=this.getZoom(),b=this.getBearing(),C=this.getPitch(),I=this.getPadding(),P="zoom"in l?+l.zoom:v,O="bearing"in l?this._normalizeBearing(l.bearing,b):b,k="pitch"in l?+l.pitch:C,U="padding"in l?l.padding:_.padding,W=s.Point.convert(l.offset);let J,ee,Q;if(_.projection.name==="globe"){const Ce=s.MercatorCoordinate.fromLngLat(_.center),Ne=W.rotate(-_.angle);Ce.x+=Ne.x/_.worldSize,Ce.y+=Ne.y/_.worldSize;const rt=Ce.toLngLat(),Le=s.LngLat.convert(l.center||rt);this._normalizeCenter(Le),J=_.centerPoint.add(Ne),ee=new s.Point(Ce.x,Ce.y).mult(_.worldSize),Q=new s.Point(s.mercatorXfromLng(Le.lng),s.mercatorYfromLat(Le.lat)).mult(_.worldSize).sub(ee)}else{J=_.centerPoint.add(W);const Ce=_.pointLocation(J),Ne=s.LngLat.convert(l.center||Ce);this._normalizeCenter(Ne),ee=_.project(Ce),Q=_.project(Ne).sub(ee)}const te=_.zoomScale(P-v);let V,K;l.around&&(V=s.LngLat.convert(l.around),K=_.locationPoint(V));const se=this._zooming||P!==v,ae=this._rotating||b!==O,ge=this._pitching||k!==C,ve=!_.isPaddingEqual(U),ye=Ce=>Ne=>{if(se&&(Ce.zoom=s.number(v,P,Ne)),ae&&(Ce.bearing=s.number(b,O,Ne)),ge&&(Ce.pitch=s.number(C,k,Ne)),ve&&(Ce.interpolatePadding(I,U,Ne),J=Ce.centerPoint.add(W)),V)Ce.setLocationAtPoint(V,K);else{const rt=Ce.zoomScale(Ce.zoom-v),Le=P>v?Math.min(2,te):Math.max(.5,te),Ye=Math.pow(Le,1-Ne),Fe=Ce.unproject(ee.add(Q.mult(Ne*Ye)).mult(rt));Ce.setLocationAtPoint(Ce.renderWorldCopies?Fe.wrap():Fe,J)}return l.preloadOnly||this._fireMoveEvents(f),Ce};if(l.preloadOnly){const Ce=this._emulate(ye,l.duration,_);return this._preloadTiles(Ce),this}const Ie={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=se,this._rotating=ae,this._pitching=ge,this._padding=ve,this._easeId=l.easeId,this._prepareEase(f,l.noMoveStart,Ie),this._ease(ye(_),Ce=>{_.recenterOnTerrain(),this._afterEase(f,Ce)},l),this}_prepareEase(l,f,_={}){this._moving=!0,this.transform.cameraElevationReference="sea",f||_.moving||this.fire(new s.Event("movestart",l)),this._zooming&&!_.zooming&&this.fire(new s.Event("zoomstart",l)),this._rotating&&!_.rotating&&this.fire(new s.Event("rotatestart",l)),this._pitching&&!_.pitching&&this.fire(new s.Event("pitchstart",l))}_fireMoveEvents(l){this.fire(new s.Event("move",l)),this._zooming&&this.fire(new s.Event("zoom",l)),this._rotating&&this.fire(new s.Event("rotate",l)),this._pitching&&this.fire(new s.Event("pitch",l))}_afterEase(l,f){if(this._easeId&&f&&this._easeId===f)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const _=this._zooming,v=this._rotating,b=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,_&&this.fire(new s.Event("zoomend",l)),v&&this.fire(new s.Event("rotateend",l)),b&&this.fire(new s.Event("pitchend",l)),this.fire(new s.Event("moveend",l))}flyTo(l,f){if(this._prefersReducedMotion(l)){const Qe=s.pick(l,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Qe,f)}this.stop(),l=s.extend({offset:[0,0],speed:1.2,curve:1.42,easing:s.ease},l);const _=this.transform,v=this.getZoom(),b=this.getBearing(),C=this.getPitch(),I=this.getPadding(),P="zoom"in l?s.clamp(+l.zoom,_.minZoom,_.maxZoom):v,O="bearing"in l?this._normalizeBearing(l.bearing,b):b,k="pitch"in l?+l.pitch:C,U="padding"in l?l.padding:_.padding,W=_.zoomScale(P-v),J=s.Point.convert(l.offset);let ee=_.centerPoint.add(J);const Q=_.pointLocation(ee),te=s.LngLat.convert(l.center||Q);this._normalizeCenter(te);const V=_.project(Q),K=_.project(te).sub(V);let se=l.curve;const ae=Math.max(_.width,_.height),ge=ae/W,ve=K.mag();if("minZoom"in l){const Qe=s.clamp(Math.min(l.minZoom,v,P),_.minZoom,_.maxZoom),st=ae/_.zoomScale(Qe-v);se=Math.sqrt(st/ve*2)}const ye=se*se;function Ie(Qe){const st=(ge*ge-ae*ae+(Qe?-1:1)*ye*ye*ve*ve)/(2*(Qe?ge:ae)*ye*ve);return Math.log(Math.sqrt(st*st+1)-st)}function Ce(Qe){return(Math.exp(Qe)-Math.exp(-Qe))/2}function Ne(Qe){return(Math.exp(Qe)+Math.exp(-Qe))/2}const rt=Ie(0);let Le=function(Qe){return Ne(rt)/Ne(rt+se*Qe)},Ye=function(Qe){return ae*((Ne(rt)*(Ce(st=rt+se*Qe)/Ne(st))-Ce(rt))/ye)/ve;var st},Fe=(Ie(1)-rt)/se;if(Math.abs(ve)<1e-6||!isFinite(Fe)){if(Math.abs(ae-ge)<1e-6)return this.easeTo(l,f);const Qe=ge<ae?-1:1;Fe=Math.abs(Math.log(ge/ae))/se,Ye=function(){return 0},Le=function(st){return Math.exp(Qe*se*st)}}l.duration="duration"in l?+l.duration:1e3*Fe/("screenSpeed"in l?+l.screenSpeed/se:+l.speed),l.maxDuration&&l.duration>l.maxDuration&&(l.duration=0);const nt=b!==O,Re=k!==C,Ze=!_.isPaddingEqual(U),ot=Qe=>st=>{const Mt=st*Fe,jt=1/Le(Mt);Qe.zoom=st===1?P:v+Qe.scaleZoom(jt),nt&&(Qe.bearing=s.number(b,O,st)),Re&&(Qe.pitch=s.number(C,k,st)),Ze&&(Qe.interpolatePadding(I,U,st),ee=Qe.centerPoint.add(J));const St=st===1?te:Qe.unproject(V.add(K.mult(Ye(Mt))).mult(jt));return Qe.setLocationAtPoint(Qe.renderWorldCopies?St.wrap():St,ee),Qe._updateCameraOnTerrain(),l.preloadOnly||this._fireMoveEvents(f),Qe};if(l.preloadOnly){const Qe=this._emulate(ot,l.duration,_);return this._preloadTiles(Qe),this}return this._zooming=!0,this._rotating=nt,this._pitching=Re,this._padding=Ze,this._prepareEase(f,!1),this._ease(ot(_),()=>this._afterEase(f),l),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(l,f){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const _=this._onEaseEnd;this._onEaseEnd=void 0,_.call(this,f)}if(!l){const _=this.handlers;_&&_.stop(!1)}return this}_ease(l,f,_){_.animate===!1||_.duration===0?(l(1),f()):(this._easeStart=s.exported.now(),this._easeOptions=_,this._onEaseFrame=l,this._onEaseEnd=f,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const l=Math.min((s.exported.now()-this._easeStart)/this._easeOptions.duration,1),f=this._onEaseFrame;f&&f(this._easeOptions.easing(l)),l<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(l,f){l=s.wrap(l,-180,180);const _=Math.abs(l-f);return Math.abs(l-360-f)<_&&(l-=360),Math.abs(l+360-f)<_&&(l+=360),l}_normalizeCenter(l){const f=this.transform;if(!f.renderWorldCopies||f.maxBounds)return;const _=l.lng-f.center.lng;l.lng+=_>180?-360:_<-180?360:0}_prefersReducedMotion(l){return this._respectPrefersReducedMotion&&s.exported.prefersReducedMotion&&!(l&&l.essential)}_emulate(l,f,_){const v=Math.ceil(15*f/1e3),b=[],C=l(_.clone());for(let I=0;I<=v;I++){const P=C(I/v);b.push(P.clone())}return b}}class bt{constructor(l={}){this.options=l,s.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(l){const f=this.options&&this.options.compact;return this._map=l,this._container=R("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=R("button","mapboxgl-ctrl-attrib-button",this._container),R("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=R("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),f&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),f===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(l,f){const _=this._map._getUIString(`AttributionControl.${f}`);l.setAttribute("aria-label",_),l.removeAttribute("title"),l.firstElementChild&&l.firstElementChild.setAttribute("title",_)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let l=this._editLink;l||(l=this._editLink=this._container.querySelector(".mapbox-improve-map"));const f=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||s.config.ACCESS_TOKEN}];if(l){const _=f.reduce((v,b,C)=>(b.value&&(v+=`${b.key}=${b.value}${C<f.length-1?"&":""}`),v),"?");l.href=`${s.config.FEEDBACK_URL}/${_}#${bh(this._map,!0)}`,l.rel="noopener nofollow",this._setElementTitle(l,"MapFeedback")}}_updateData(l){!l||l.sourceDataType!=="metadata"&&l.sourceDataType!=="visibility"&&l.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let l=[];if(this._map.style.stylesheet){const v=this._map.style.stylesheet;this.styleOwner=v.owner,this.styleId=v.id}const f=this._map.style._sourceCaches;for(const v in f){const b=f[v];if(b.used){const C=b.getSource();C.attribution&&l.indexOf(C.attribution)<0&&l.push(C.attribution)}}l.sort((v,b)=>v.length-b.length),l=l.filter((v,b)=>{for(let C=b+1;C<l.length;C++)if(l[C].indexOf(v)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?l=[...this.options.customAttribution,...l]:l.unshift(this.options.customAttribution));const _=l.join(" | ");_!==this._attribHTML&&(this._attribHTML=_,l.length?(this._innerContainer.innerHTML=_,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Pm{constructor(){s.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(l){this._map=l,this._container=R("div","mapboxgl-ctrl");const f=R("a","mapboxgl-ctrl-logo");return f.target="_blank",f.rel="noopener nofollow",f.href="https://www.mapbox.com/",f.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),f.setAttribute("rel","noopener nofollow"),this._container.appendChild(f),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(l){l&&l.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const l=this._map.style._sourceCaches;if(Object.entries(l).length===0)return!0;for(const f in l){const _=l[f].getSource();if(_.hasOwnProperty("mapbox_logo")&&!_.mapbox_logo)return!1}return!0}_updateCompact(){const l=this._container.children;if(l.length){const f=l[0];this._map.getCanvasContainer().offsetWidth<250?f.classList.add("mapboxgl-compact"):f.classList.remove("mapboxgl-compact")}}}class Lm{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(l){const f=++this._id;return this._queue.push({callback:l,id:f,cancelled:!1}),f}remove(l){const f=this._currentlyRunning,_=f?this._queue.concat(f):this._queue;for(const v of _)if(v.id===l)return void(v.cancelled=!0)}run(l=0){const f=this._currentlyRunning=this._queue;this._queue=[];for(const _ of f)if(!_.cancelled&&(_.callback(l),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function ic(m,l,f){if(m=new s.LngLat(m.lng,m.lat),l){const _=new s.LngLat(m.lng-360,m.lat),v=new s.LngLat(m.lng+360,m.lat),b=360*Math.ceil(Math.abs(m.lng-f.center.lng)/360),C=f.locationPoint(m).distSqr(l),I=l.x<0||l.y<0||l.x>f.width||l.y>f.height;f.locationPoint(_).distSqr(l)<C&&(I||Math.abs(_.lng-f.center.lng)<b)?m=_:f.locationPoint(v).distSqr(l)<C&&(I||Math.abs(v.lng-f.center.lng)<b)&&(m=v)}for(;Math.abs(m.lng-f.center.lng)>180;){const _=f.locationPoint(m);if(_.x>=0&&_.y>=0&&_.x<=f.width&&_.y<=f.height)break;m.lng>f.center.lng?m.lng-=360:m.lng+=360}return m}const tu={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class yt extends s.Evented{constructor(l,f){if(super(),(l instanceof s.window.HTMLElement||f)&&(l=s.extend({element:l},f)),s.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=l&&l.anchor||"center",this._color=l&&l.color||"#3FB1CE",this._scale=l&&l.scale||1,this._draggable=l&&l.draggable||!1,this._clickTolerance=l&&l.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=l&&l.rotation||0,this._rotationAlignment=l&&l.rotationAlignment||"auto",this._pitchAlignment=l&&l.pitchAlignment&&l.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=l&&l.occludedOpacity||.2,l&&l.element)this._element=l.element,this._offset=s.Point.convert(l&&l.offset||[0,0]);else{this._defaultMarker=!0,this._element=R("div");const v=41,b=27,C=G("svg",{display:"block",height:v*this._scale+"px",width:b*this._scale+"px",viewBox:`0 0 ${b} ${v}`},this._element),I=G("radialGradient",{id:"shadowGradient"},G("defs",{},C));G("stop",{offset:"10%","stop-opacity":.4},I),G("stop",{offset:"100%","stop-opacity":.05},I),G("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},C),G("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},C),G("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},C),G("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},C),this._offset=s.Point.convert(l&&l.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",v=>{v.preventDefault()}),this._element.addEventListener("mousedown",v=>{v.preventDefault()});const _=this._element.classList;for(const v in tu)_.remove(`mapboxgl-marker-anchor-${v}`);_.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(l){return l===this._map||(this.remove(),this._map=l,l.getCanvasContainer().appendChild(this._element),l.on("move",this._updateMoving),l.on("moveend",this._update),l.on("remove",this._clearFadeTimer),l._addMarker(this),this.setDraggable(this._draggable),this._update(),l.on("click",this._onMapClick)),this}remove(){const l=this._map;return l&&(l.off("click",this._onMapClick),l.off("move",this._updateMoving),l.off("moveend",this._update),l.off("mousedown",this._addDragHandler),l.off("touchstart",this._addDragHandler),l.off("mouseup",this._onUp),l.off("touchend",this._onUp),l.off("mousemove",this._onMove),l.off("touchmove",this._onMove),l.off("remove",this._clearFadeTimer),l._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(l){return this._lngLat=s.LngLat.convert(l),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(l){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),l){if(!("offset"in l.options)){const v=Math.sqrt(Math.pow(13.5,2)/2);l.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[v,-1*(38.1-13.5+v)],"bottom-right":[-v,-1*(38.1-13.5+v)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=l,l._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(l){const f=l.code,_=l.charCode||l.keyCode;f!=="Space"&&f!=="Enter"&&_!==32&&_!==13||this.togglePopup()}_onMapClick(l){const f=l.originalEvent.target,_=this._element;this._popup&&(f===_||_.contains(f))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const l=this._popup;return l?(l.isOpen()?(l.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(l.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const l=this._map,f=this._pos;if(!l||!f)return!1;const _=l.unproject(f),v=l.getFreeCameraOptions();if(!v.position)return!1;const b=v.position.toLngLat();return b.distanceTo(_)<.9*b.distanceTo(this._lngLat)}_evaluateOpacity(){const l=this._map;if(!l)return;const f=this._pos;if(!f||f.x<0||f.x>l.transform.width||f.y<0||f.y>l.transform.height)return void this._clearFadeTimer();const _=l.unproject(f);let v;l._showingGlobe()&&s.isLngLatBehindGlobe(l.transform,this._lngLat)?v=0:(v=1-l._queryFogOpacity(_),l.transform._terrainEnabled()&&l.getTerrain()&&this._behindTerrain()&&(v*=this._occludedOpacity)),this._element.style.opacity=`${v}`,this._element.style.pointerEvents=v>0?"auto":"none",this._popup&&this._popup._setOpacity(v),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const l=this._pos;if(!l||!this._map)return;const f=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${l.x}px,${l.y}px)
            ${tu[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${f.x}px,${f.y}px)
        `}_calculateXYTransform(){const l=this._pos,f=this._map,_=this.getPitchAlignment();if(!f||!l||_!=="map")return"";if(!f._showingGlobe()){const P=f.getPitch();return P?`rotateX(${P}deg)`:""}const v=s.radToDeg(s.globeTiltAtLngLat(f.transform,this._lngLat)),b=l.sub(s.globeCenterToScreenPoint(f.transform)),C=Math.abs(b.x)+Math.abs(b.y);if(C===0)return"";const I=v/C;return`rotateX(${-b.y*I}deg) rotateY(${b.x*I}deg)`}_calculateZTransform(){const l=this._pos,f=this._map;if(!f||!l)return"";let _=0;const v=this.getRotationAlignment();if(v==="map")if(f._showingGlobe()){const b=f.project(new s.LngLat(this._lngLat.lng,this._lngLat.lat+.001)),C=f.project(new s.LngLat(this._lngLat.lng,this._lngLat.lat-.001)).sub(b);_=s.radToDeg(Math.atan2(C.y,C.x))-90}else _=-f.getBearing();else if(v==="horizon"){const b=s.smoothstep(4,6,f.getZoom()),C=s.globeCenterToScreenPoint(f.transform);C.y+=b*f.transform.height;const I=l.sub(C),P=s.radToDeg(Math.atan2(I.y,I.x));_=(P>90?P-270:P+90)*(1-b)}return _+=this._rotation,_?`rotateZ(${_}deg)`:""}_update(l){s.window.cancelAnimationFrame(this._updateFrameId);const f=this._map;f&&(f.transform.renderWorldCopies&&(this._lngLat=ic(this._lngLat,this._pos,f.transform)),this._pos=f.project(this._lngLat),l===!0?this._updateFrameId=s.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),f._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(f._showingGlobe()||f.getTerrain()||f.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(l){return this._offset=s.Point.convert(l),this._update(),this}_onMove(l){const f=this._map;if(!f)return;const _=this._pointerdownPos,v=this._positionDelta;if(_&&v){if(!this._isDragging){const b=this._clickTolerance||f._clickTolerance;if(l.point.dist(_)<b)return;this._isDragging=!0}this._pos=l.point.sub(v),this._lngLat=f.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new s.Event("dragstart"))),this.fire(new s.Event("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const l=this._map;l&&(l.off("mousemove",this._onMove),l.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new s.Event("dragend")),this._state="inactive"}_addDragHandler(l){const f=this._map,_=this._pos;f&&_&&this._element.contains(l.originalEvent.target)&&(l.preventDefault(),this._positionDelta=l.point.sub(_),this._pointerdownPos=l.point,this._state="pending",f.on("mousemove",this._onMove),f.on("touchmove",this._onMove),f.once("mouseup",this._onUp),f.once("touchend",this._onUp))}setDraggable(l){this._draggable=!!l;const f=this._map;return f&&(l?(f.on("mousedown",this._addDragHandler),f.on("touchstart",this._addDragHandler)):(f.off("mousedown",this._addDragHandler),f.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(l){return this._rotation=l||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(l){return this._rotationAlignment=l||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(l){return this._pitchAlignment=l||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(l){return this._occludedOpacity=l||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const Dm={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},i1=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Ly(m=new s.Point(0,0),l="bottom"){if(typeof m=="number"){const f=Math.round(Math.sqrt(.5*Math.pow(m,2)));switch(l){case"top":return new s.Point(0,m);case"top-left":return new s.Point(f,f);case"top-right":return new s.Point(-f,f);case"bottom":return new s.Point(0,-m);case"bottom-left":return new s.Point(f,-f);case"bottom-right":return new s.Point(-f,-f);case"left":return new s.Point(m,0);case"right":return new s.Point(-m,0)}return new s.Point(0,0)}return m instanceof s.Point||Array.isArray(m)?s.Point.convert(m):s.Point.convert(m[l]||[0,0])}class Rm{constructor(l){this.jumpTo(l)}getValue(l){if(l<=this._startTime)return this._start;if(l>=this._endTime)return this._end;const f=s.easeCubicInOut((l-this._startTime)/(this._endTime-this._startTime));return this._start*(1-f)+this._end*f}isEasing(l){return l>=this._startTime&&l<=this._endTime}jumpTo(l){this._startTime=-1/0,this._endTime=-1/0,this._start=l,this._end=l}easeTo(l,f,_){this._start=this.getValue(f),this._end=l,this._startTime=f,this._endTime=f+_}}const Dy={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use ⌘ + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},Ry={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0},o1={showCompass:!0,showZoom:!0,visualizePitch:!1};class s1{constructor(l,f,_=!1){this._clickTolerance=10,this.element=f,this.mouseRotate=new Tm({clickTolerance:l.dragRotate._mouseRotate._clickTolerance}),this.map=l,_&&(this.mousePitch=new Cm({clickTolerance:l.dragRotate._mousePitch._clickTolerance})),s.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),f.addEventListener("mousedown",this.mousedown),f.addEventListener("touchstart",this.touchstart,{passive:!1}),f.addEventListener("touchmove",this.touchmove),f.addEventListener("touchend",this.touchend),f.addEventListener("touchcancel",this.reset)}down(l,f){this.mouseRotate.mousedown(l,f),this.mousePitch&&this.mousePitch.mousedown(l,f),Y()}move(l,f){const _=this.map,v=this.mouseRotate.mousemoveWindow(l,f),b=v&&v.bearingDelta;if(b&&_.setBearing(_.getBearing()+b),this.mousePitch){const C=this.mousePitch.mousemoveWindow(l,f),I=C&&C.pitchDelta;I&&_.setPitch(_.getPitch()+I)}}off(){const l=this.element;l.removeEventListener("mousedown",this.mousedown),l.removeEventListener("touchstart",this.touchstart,{passive:!1}),l.removeEventListener("touchmove",this.touchmove),l.removeEventListener("touchend",this.touchend),l.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){B(),s.window.removeEventListener("mousemove",this.mousemove),s.window.removeEventListener("mouseup",this.mouseup)}mousedown(l){this.down(s.extend({},l,{ctrlKey:!0,preventDefault:()=>l.preventDefault()}),de(this.element,l)),s.window.addEventListener("mousemove",this.mousemove),s.window.addEventListener("mouseup",this.mouseup)}mousemove(l){this.move(l,de(this.element,l))}mouseup(l){this.mouseRotate.mouseupWindow(l),this.mousePitch&&this.mousePitch.mouseupWindow(l),this.offTemp()}touchstart(l){l.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=we(this.element,l.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>l.preventDefault()},this._startPos))}touchmove(l){l.targetTouches.length!==1?this.reset():(this._lastPos=we(this.element,l.targetTouches)[0],this.move({preventDefault:()=>l.preventDefault()},this._lastPos))}touchend(l){l.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const Nm={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},km={maxWidth:100,unit:"metric"},Om={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},oc={version:s.version,supported:T,setRTLTextPlugin:s.setRTLTextPlugin,getRTLTextPluginStatus:s.getRTLTextPluginStatus,Map:class extends ap{constructor(m){if(s.LivePerformanceUtils.mark(s.PerformanceMarkers.create),(m=s.extend({},Ry,m)).minZoom!=null&&m.maxZoom!=null&&m.minZoom>m.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(m.minPitch!=null&&m.maxPitch!=null&&m.minPitch>m.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(m.minPitch!=null&&m.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(m.maxPitch!=null&&m.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(m.antialias&&s.isSafariWithAntialiasingBug(s.window)&&(m.antialias=!1,s.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new ec(m.minZoom,m.maxZoom,m.minPitch,m.maxPitch,m.renderWorldCopies),m),this._interactive=m.interactive,this._minTileCacheSize=m.minTileCacheSize,this._maxTileCacheSize=m.maxTileCacheSize,this._failIfMajorPerformanceCaveat=m.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=m.preserveDrawingBuffer,this._antialias=m.antialias,this._useWebGL2=m.useWebGL2,this._trackResize=m.trackResize,this._bearingSnap=m.bearingSnap,this._refreshExpiredTiles=m.refreshExpiredTiles,this._fadeDuration=m.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=m.crossSourceCollisions,this._collectResourceTiming=m.collectResourceTiming,this._optimizeForTerrain=m.optimizeForTerrain,this._language=this._parseLanguage(m.language),this._worldview=m.worldview,this._renderTaskQueue=new Lm,this._domRenderTaskQueue=new Lm,this._controls=[],this._markers=[],this._popups=[],this._mapId=s.uniqueId(),this._locale=s.extend({},Dy,m.locale),this._clickTolerance=m.clickTolerance,this._cooperativeGestures=m.cooperativeGestures,this._performanceMetricsCollection=m.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Rm(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new s.RequestManager(m.transformRequest,m.accessToken,m.testMode),this._silenceAuthErrors=!!m.testMode,typeof m.container=="string"){if(this._container=s.window.document.getElementById(m.container),!this._container)throw new Error(`Container '${m.container}' not found.`)}else{if(!(m.container instanceof s.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=m.container}if(this._container.childNodes.length>0&&s.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),m.maxBounds&&this.setMaxBounds(m.maxBounds),s.bindAll(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),s.window!==void 0&&(s.window.addEventListener("online",this._onWindowOnline,!1),s.window.addEventListener("resize",this._onWindowResize,!1),s.window.addEventListener("orientationchange",this._onWindowResize,!1),s.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1),s.window.addEventListener("visibilitychange",this._onVisibilityChange,!1)),this.handlers=new Os(this,m),this._localFontFamily=m.localFontFamily,this._localIdeographFontFamily=m.localIdeographFontFamily,m.style&&this.setStyle(m.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),m.projection&&this.setProjection(m.projection),this._hash=m.hash&&new wm(typeof m.hash=="string"&&m.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:m.center,zoom:m.zoom,bearing:m.bearing,pitch:m.pitch}),m.bounds&&(this.resize(),this.fitBounds(m.bounds,s.extend({},m.fitBoundsOptions,{duration:0})))),this.resize(),m.attributionControl&&this.addControl(new bt({customAttribution:m.customAttribution})),this._logoControl=new Pm,this.addControl(this._logoControl,m.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",l=>{this._update(l.dataType==="style"),this.fire(new s.Event(`${l.dataType}data`,l))}),this.on("dataloading",l=>{this.fire(new s.Event(`${l.dataType}dataloading`,l))})}_getMapId(){return this._mapId}addControl(m,l){if(l===void 0&&(l=m.getDefaultPosition?m.getDefaultPosition():"top-right"),!m||!m.onAdd)return this.fire(new s.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const f=m.onAdd(this);this._controls.push(m);const _=this._controlPositions[l];return l.indexOf("bottom")!==-1?_.insertBefore(f,_.firstChild):_.appendChild(f),this}removeControl(m){if(!m||!m.onRemove)return this.fire(new s.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const l=this._controls.indexOf(m);return l>-1&&this._controls.splice(l,1),m.onRemove(this),this}hasControl(m){return this._controls.indexOf(m)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(m){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const l=!this._moving;return l&&this.fire(new s.Event("movestart",m)).fire(new s.Event("move",m)),this.fire(new s.Event("resize",m)),l&&this.fire(new s.Event("moveend",m)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(m){return this.transform.setMaxBounds(s.LngLatBounds.convert(m)),this._update()}setMinZoom(m){if((m=m??-2)>=-2&&m<=this.transform.maxZoom)return this.transform.minZoom=m,this._update(),this.getZoom()<m?this.setZoom(m):this.fire(new s.Event("zoomstart")).fire(new s.Event("zoom")).fire(new s.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(m){if((m=m??22)>=this.transform.minZoom)return this.transform.maxZoom=m,this._update(),this.getZoom()>m?this.setZoom(m):this.fire(new s.Event("zoomstart")).fire(new s.Event("zoom")).fire(new s.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(m){if((m=m??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(m>=0&&m<=this.transform.maxPitch)return this.transform.minPitch=m,this._update(),this.getPitch()<m?this.setPitch(m):this.fire(new s.Event("pitchstart")).fire(new s.Event("pitch")).fire(new s.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(m){if((m=m??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(m>=this.transform.minPitch)return this.transform.maxPitch=m,this._update(),this.getPitch()>m?this.setPitch(m):this.fire(new s.Event("pitchstart")).fire(new s.Event("pitch")).fire(new s.Event("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(m){return this.transform.renderWorldCopies=m,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(m){return m==="auto"?s.window.navigator.language:Array.isArray(m)?m.length===0?void 0:m.map(l=>l==="auto"?s.window.navigator.language:l):m}setLanguage(m){const l=this._parseLanguage(m);if(!this.style||l===this._language)return this;this._language=l,this.style._reloadSources();for(const f of this._controls)f._setLanguage&&f._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(m){return this.style&&m!==this._worldview?(this._worldview=m,this.style._reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(m){return this._lazyInitEmptyStyle(),m?typeof m=="string"&&(m={name:m}):m=null,this._useExplicitProjection=!!m,this._prioritizeAndUpdateProjection(m,this.style.stylesheet?this.style.stylesheet.projection:null)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const m=this.transform,l=m.projection.name;let f;l==="globe"&&m.zoom>=s.GLOBE_ZOOM_THRESHOLD_MAX?(m.setMercatorFromTransition(),f=!0):l==="mercator"&&m.zoom<s.GLOBE_ZOOM_THRESHOLD_MAX&&(m.setProjection({name:"globe"}),f=!0),f&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(m,l){return this._updateProjection(m||l||{name:"mercator"})}_updateProjection(m){let l;if(l=m.name==="globe"&&this.transform.zoom>=s.GLOBE_ZOOM_THRESHOLD_MAX?this.transform.setMercatorFromTransition():this.transform.setProjection(m),this.style.applyProjectionUpdate(),l){this.painter.clearBackgroundTiles();for(const f in this.style._sourceCaches)this.style._sourceCaches[f].clearTiles();this._update(!0),this._forceMarkerAndPopupUpdate(!0)}return this}project(m){return this.transform.locationPoint3D(s.LngLat.convert(m))}unproject(m){return this.transform.pointLocation3D(s.Point.convert(m))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(m,l,f){if(m==="mouseenter"||m==="mouseover"){let _=!1;const v=C=>{const I=l.filter(O=>this.getLayer(O)),P=I.length?this.queryRenderedFeatures(C.point,{layers:I}):[];P.length?_||(_=!0,f.call(this,new ei(m,this,C.originalEvent,{features:P}))):_=!1},b=()=>{_=!1};return{layers:new Set(l),listener:f,delegates:{mousemove:v,mouseout:b}}}if(m==="mouseleave"||m==="mouseout"){let _=!1;const v=C=>{const I=l.filter(P=>this.getLayer(P));(I.length?this.queryRenderedFeatures(C.point,{layers:I}):[]).length?_=!0:_&&(_=!1,f.call(this,new ei(m,this,C.originalEvent)))},b=C=>{_&&(_=!1,f.call(this,new ei(m,this,C.originalEvent)))};return{layers:new Set(l),listener:f,delegates:{mousemove:v,mouseout:b}}}{const _=v=>{const b=l.filter(I=>this.getLayer(I)),C=b.length?this.queryRenderedFeatures(v.point,{layers:b}):[];C.length&&(v.features=C,f.call(this,v),delete v.features)};return{layers:new Set(l),listener:f,delegates:{[m]:_}}}}on(m,l,f){if(f===void 0)return super.on(m,l);Array.isArray(l)||(l=[l]);const _=this._createDelegatedListener(m,l,f);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[m]=this._delegatedListeners[m]||[],this._delegatedListeners[m].push(_);for(const v in _.delegates)this.on(v,_.delegates[v]);return this}once(m,l,f){if(f===void 0)return super.once(m,l);Array.isArray(l)||(l=[l]);const _=this._createDelegatedListener(m,l,f);for(const v in _.delegates)this.once(v,_.delegates[v]);return this}off(m,l,f){if(f===void 0)return super.off(m,l);l=new Set(Array.isArray(l)?l:[l]);const _=(b,C)=>{if(b.size!==C.size)return!1;for(const I of b)if(!C.has(I))return!1;return!0},v=this._delegatedListeners?this._delegatedListeners[m]:void 0;return v&&(b=>{for(let C=0;C<b.length;C++){const I=b[C];if(I.listener===f&&_(I.layers,l)){for(const P in I.delegates)this.off(P,I.delegates[P]);return b.splice(C,1),this}}})(v),this}queryRenderedFeatures(m,l){return this.style?(l!==void 0||m===void 0||m instanceof s.Point||Array.isArray(m)||(l=m,m=void 0),this.style.queryRenderedFeatures(m=m||[[0,0],[this.transform.width,this.transform.height]],l=l||{},this.transform)):[]}querySourceFeatures(m,l){return this.style.querySourceFeatures(m,l)}isPointOnSurface(m){const{name:l}=this.transform.projection;return l!=="globe"&&l!=="mercator"&&s.warnOnce(`${l} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(s.Point.convert(m))}setStyle(m,l){return(l=s.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},l)).diff!==!1&&l.localIdeographFontFamily===this._localIdeographFontFamily&&l.localFontFamily===this._localFontFamily&&this.style&&m?(this._diffStyle(m,l),this):(this._localIdeographFontFamily=l.localIdeographFontFamily,this._localFontFamily=l.localFontFamily,this._updateStyle(m,l))}_getUIString(m){const l=this._locale[m];if(l==null)throw new Error(`Missing UI string '${m}'`);return l}_updateStyle(m,l){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),m&&(this.style=new Ns(this,l||{}),this.style.setEventedParent(this,{style:this.style}),typeof m=="string"?this.style.loadURL(m):this.style.loadJSON(m)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Ns(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(m,l){if(typeof m=="string"){const f=this._requestManager.normalizeStyleURL(m),_=this._requestManager.transformRequest(f,s.ResourceType.Style);s.getJSON(_,(v,b)=>{v?this.fire(new s.ErrorEvent(v)):b&&this._updateDiff(b,l)})}else typeof m=="object"&&this._updateDiff(m,l)}_updateDiff(m,l){try{this.style.setState(m)&&this._update(!0)}catch(f){s.warnOnce(`Unable to perform style diff: ${f.message||f.error||f}.  Rebuilding the style from scratch.`),this._updateStyle(m,l)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(s.warnOnce("There is no style added to the map."),!1)}addSource(m,l){return this._lazyInitEmptyStyle(),this.style.addSource(m,l),this._update(!0)}isSourceLoaded(m){return!!this.style&&this.style._isSourceCacheLoaded(m)}areTilesLoaded(){const m=this.style&&this.style._sourceCaches;for(const l in m){const f=m[l]._tiles;for(const _ in f){const v=f[_];if(v.state!=="loaded"&&v.state!=="errored")return!1}}return!0}addSourceType(m,l,f){this._lazyInitEmptyStyle(),this.style.addSourceType(m,l,f)}removeSource(m){return this.style.removeSource(m),this._updateTerrain(),this._update(!0)}getSource(m){return this.style.getSource(m)}addImage(m,l,{pixelRatio:f=1,sdf:_=!1,stretchX:v,stretchY:b,content:C}={}){if(this._lazyInitEmptyStyle(),l instanceof s.window.HTMLImageElement||s.window.ImageBitmap&&l instanceof s.window.ImageBitmap){const{width:I,height:P,data:O}=s.exported.getImageData(l);this.style.addImage(m,{data:new s.RGBAImage({width:I,height:P},O),pixelRatio:f,stretchX:v,stretchY:b,content:C,sdf:_,version:0})}else if(l.width===void 0||l.height===void 0)this.fire(new s.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:I,height:P}=l,O=l;this.style.addImage(m,{data:new s.RGBAImage({width:I,height:P},new Uint8Array(O.data)),pixelRatio:f,stretchX:v,stretchY:b,content:C,sdf:_,version:0,userImage:O}),O.onAdd&&O.onAdd(this,m)}}updateImage(m,l){const f=this.style.getImage(m);if(!f)return void this.fire(new s.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const _=l instanceof s.window.HTMLImageElement||s.window.ImageBitmap&&l instanceof s.window.ImageBitmap?s.exported.getImageData(l):l,{width:v,height:b}=_;v!==void 0&&b!==void 0?v===f.data.width&&b===f.data.height?(f.data.replace(_.data,!(l instanceof s.window.HTMLImageElement||s.window.ImageBitmap&&l instanceof s.window.ImageBitmap)),this.style.updateImage(m,f)):this.fire(new s.ErrorEvent(new Error(`The width and height of the updated image (${v}, ${b})
                must be that same as the previous version of the image
                (${f.data.width}, ${f.data.height})`))):this.fire(new s.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(m){return m?!!this.style.getImage(m):(this.fire(new s.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(m){this.style.removeImage(m)}loadImage(m,l){s.getImage(this._requestManager.transformRequest(m,s.ResourceType.Image),(f,_)=>{l(f,_ instanceof s.window.HTMLImageElement?s.exported.getImageData(_):_)})}listImages(){return this.style.listImages()}addLayer(m,l){return this._lazyInitEmptyStyle(),this.style.addLayer(m,l),this._update(!0)}moveLayer(m,l){return this.style.moveLayer(m,l),this._update(!0)}removeLayer(m){return this.style.removeLayer(m),this._update(!0)}getLayer(m){return this.style.getLayer(m)}setLayerZoomRange(m,l,f){return this.style.setLayerZoomRange(m,l,f),this._update(!0)}setFilter(m,l,f={}){return this.style.setFilter(m,l,f),this._update(!0)}getFilter(m){return this.style.getFilter(m)}setPaintProperty(m,l,f,_={}){return this.style.setPaintProperty(m,l,f,_),this._update(!0)}getPaintProperty(m,l){return this.style.getPaintProperty(m,l)}setLayoutProperty(m,l,f,_={}){return this.style.setLayoutProperty(m,l,f,_),this._update(!0)}getLayoutProperty(m,l){return this.style.getLayoutProperty(m,l)}setLight(m,l={}){return this._lazyInitEmptyStyle(),this.style.setLight(m,l),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(m){return this._lazyInitEmptyStyle(),!m&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(m),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(m){return this._lazyInitEmptyStyle(),this.style.setFog(m),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(m){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(s.LngLat.convert(m),this.transform):0}setFeatureState(m,l){return this.style.setFeatureState(m,l),this._update()}removeFeatureState(m,l){return this.style.removeFeatureState(m,l),this._update()}getFeatureState(m){return this.style.getFeatureState(m)}_updateContainerDimensions(){if(!this._container)return;const m=this._container.getBoundingClientRect().width||400,l=this._container.getBoundingClientRect().height||300;let f,_,v,b=this._container;for(;b&&(!_||!v);){const C=s.window.getComputedStyle(b).transform;C&&C!=="none"&&(f=C.match(/matrix.*\((.+)\)/)[1].split(", "),f[0]&&f[0]!=="0"&&f[0]!=="1"&&(_=f[0]),f[3]&&f[3]!=="0"&&f[3]!=="1"&&(v=f[3])),b=b.parentElement}this._containerWidth=_?Math.abs(m/_):m,this._containerHeight=v?Math.abs(l/v):l}_detectMissingCSS(){s.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&s.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const m=this._container;m.classList.add("mapboxgl-map"),(this._missingCSSCanary=R("div","mapboxgl-canary",m)).style.visibility="hidden",this._detectMissingCSS();const l=this._canvasContainer=R("div","mapboxgl-canvas-container",m);this._interactive&&l.classList.add("mapboxgl-interactive"),this._canvas=R("canvas","mapboxgl-canvas",l),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const f=this._controlContainer=R("div","mapboxgl-control-container",m),_=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(v=>{_[v]=R("div",`mapboxgl-ctrl-${v}`,f)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(m,l){const f=s.exported.devicePixelRatio||1;this._canvas.width=f*Math.ceil(m),this._canvas.height=f*Math.ceil(l),this._canvas.style.width=`${m}px`,this._canvas.style.height=`${l}px`}_addMarker(m){this._markers.push(m)}_removeMarker(m){const l=this._markers.indexOf(m);l!==-1&&this._markers.splice(l,1)}_addPopup(m){this._popups.push(m)}_removePopup(m){const l=this._popups.indexOf(m);l!==-1&&this._popups.splice(l,1)}_setupPainter(){const m=s.extend({},T.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),l=this._useWebGL2&&this._canvas.getContext("webgl2",m),f=l||this._canvas.getContext("webgl",m)||this._canvas.getContext("experimental-webgl",m);f?(this._useWebGL2&&!l&&s.warnOnce("Failed to create WebGL 2 context. Using WebGL 1."),s.storeAuthState(f,!0),this.painter=new Ju(f,this.transform,!!l),this.on("data",_=>{_.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),s.exported$1.testSupport(f)):this.fire(new s.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(m){m.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new s.Event("webglcontextlost",{originalEvent:m}))}_contextRestored(m){this._setupPainter(),this.resize(),this._update(),this.fire(new s.Event("webglcontextrestored",{originalEvent:m}))}_onMapScroll(m){if(m.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(m){return this.style?(this._styleDirty=this._styleDirty||m,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(m){return this._update(),this._renderTaskQueue.add(m)}_cancelRenderFrame(m){this._renderTaskQueue.remove(m)}_requestDomTask(m){!this.loaded()||this.loaded()&&!this.isMoving()?m():this._domRenderTaskQueue.add(m)}_render(m){let l;const f=this.painter.context.extTimerQuery,_=s.exported.now();if(this.listens("gpu-timing-frame")&&(l=f.createQueryEXT(),f.beginQueryEXT(f.TIME_ELAPSED_EXT,l)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],s.window.performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],s.window.performance.now())),this._renderTaskQueue.run(m),this._domRenderTaskQueue.run(m),this._removed)return;this._updateProjectionTransition();const v=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const I=this.transform.zoom,P=this.transform.pitch,O=s.exported.now(),k=new s.EvaluationParameters(I,{now:O,fadeDuration:v,pitch:P,transition:this.style.getTransition()});this.style.update(k)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let b=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),b=this._updateAverageElevation(_),this.style._updateSources(this.transform),this._forceMarkerAndPopupUpdate()):b=this._updateAverageElevation(_),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,v,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:v,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new s.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new s.Event("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),l){const I=s.exported.now()-_;f.endQueryEXT(f.TIME_ELAPSED_EXT,l),setTimeout(()=>{const P=f.getQueryObjectEXT(l,f.QUERY_RESULT_EXT)/1e6;f.deleteQueryEXT(l),this.fire(new s.Event("gpu-timing-frame",{cpuTime:I,gpuTime:P})),s.window.performance.mark("frame-gpu",{startTime:_,detail:{gpuTime:P}})},50)}if(this.listens("gpu-timing-layer")){const I=this.painter.collectGpuTimers();setTimeout(()=>{const P=this.painter.queryGpuTimers(I);this.fire(new s.Event("gpu-timing-layer",{layerTimes:P}))},50)}if(this.listens("gpu-timing-deferred-render")){const I=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const P=this.painter.queryGpuTimeDeferredRender(I);this.fire(new s.Event("gpu-timing-deferred-render",{gpuTime:P}))},50)}const C=this._sourcesDirty||this._styleDirty||this._placementDirty||b;if(C||this._repaint)this.triggerRepaint();else{const I=!this.isMoving()&&this.loaded();if(I&&(b=this._updateAverageElevation(_,!0)),b)this.triggerRepaint();else if(this._triggerFrame(!1),I&&(this.fire(new s.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const P=this._calculateSpeedIndex();this.fire(new s.Event("speedindexcompleted",{speedIndex:P})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||C||(this._fullyLoaded=!0,s.LivePerformanceUtils.mark(s.PerformanceMarkers.fullLoad),this._performanceMetricsCollection&&s.postPerformanceEvent(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(m){for(const l of this._markers)m&&!this.getRenderWorldCopies()&&(l._lngLat=l._lngLat.wrap()),l._update();for(const l of this._popups)!m||this.getRenderWorldCopies()||l._trackPointer||(l._lngLat=l._lngLat.wrap()),l._update()}_updateAverageElevation(m,l=!1){const f=_=>(this.transform.averageElevation=_,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&f(0);if((l||m-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(m)){const _=this.transform.averageElevation;let v=this.transform.sampleAverageElevation(),b=!1;this.transform.elevation&&(b=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(v)?v=0:this._averageElevationLastSampledAt=m;const C=Math.abs(_-v);if(C>1){if(this._isInitialLoad||b)return this._averageElevation.jumpTo(v),f(v);this._averageElevation.easeTo(v,m,300)}else if(C>1e-4)return this._averageElevation.jumpTo(v),f(v)}return!!this._averageElevation.isEasing(m)&&f(this._averageElevation.getValue(m))}_authenticate(){s.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,m=>{if(m&&(m.message===s.AUTH_ERR_MSG||m.status===401)){const l=this.painter.context.gl;s.storeAuthState(l,!1),this._logoControl instanceof Pm&&this._logoControl._updateLogo(),l&&l.clear(l.DEPTH_BUFFER_BIT|l.COLOR_BUFFER_BIT|l.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new s.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),s.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){const m=this._isDragging();this.painter.updateTerrain(this.style,m)}_calculateSpeedIndex(){const m=this.painter.canvasCopy(),l=this.painter.getCanvasCopiesAndTimestamps();l.timeStamps.push(performance.now());const f=this.painter.context.gl,_=f.createFramebuffer();function v(b){f.framebufferTexture2D(f.FRAMEBUFFER,f.COLOR_ATTACHMENT0,f.TEXTURE_2D,b,0);const C=new Uint8Array(f.drawingBufferWidth*f.drawingBufferHeight*4);return f.readPixels(0,0,f.drawingBufferWidth,f.drawingBufferHeight,f.RGBA,f.UNSIGNED_BYTE,C),C}return f.bindFramebuffer(f.FRAMEBUFFER,_),this._canvasPixelComparison(v(m),l.canvasCopies.map(v),l.timeStamps)}_canvasPixelComparison(m,l,f){let _=f[1]-f[0];const v=m.length/4;for(let b=0;b<l.length;b++){const C=l[b];let I=0;for(let P=0;P<C.length;P+=4)C[P]===m[P]&&C[P+1]===m[P+1]&&C[P+2]===m[P+2]&&C[P+3]===m[P+3]&&(I+=1);_+=(f[b+2]-f[b+1])*(1-I/v)}return _}remove(){this._hash&&this._hash.remove();for(const l of this._controls)l.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),s.window!==void 0&&(s.window.removeEventListener("resize",this._onWindowResize,!1),s.window.removeEventListener("orientationchange",this._onWindowResize,!1),s.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),s.window.removeEventListener("online",this._onWindowOnline,!1),s.window.removeEventListener("visibilitychange",this._onVisibilityChange,!1));const m=this.painter.context.gl.getExtension("WEBGL_lose_context");m&&m.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),s.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new s.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(m){this._renderNextFrame=this._renderNextFrame||m,this.style&&!this._frame&&(this._frame=s.exported.frame(l=>{const f=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,f&&this._render(l)}))}_preloadTiles(m){const l=this.style?Object.values(this.style._sourceCaches):[];return s.asyncAll(l,(f,_)=>f._preloadTiles(m,_),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(m){this._trackResize&&this.resize({originalEvent:m})._update()}_onVisibilityChange(){s.window.document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(m){this._showTileBoundaries!==m&&(this._showTileBoundaries=m,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(m){this._showTerrainWireframe!==m&&(this._showTerrainWireframe=m,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(m){this._speedIndexTiming!==m&&(this._speedIndexTiming=m,this._update())}get showPadding(){return!!this._showPadding}set showPadding(m){this._showPadding!==m&&(this._showPadding=m,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(m){this._showCollisionBoxes!==m&&(this._showCollisionBoxes=m,m?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(m){this._showOverdrawInspector!==m&&(this._showOverdrawInspector=m,this._update())}get repaint(){return!!this._repaint}set repaint(m){this._repaint!==m&&(this._repaint=m,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(m){this._vertices=m,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(m){this._showTileAABBs!==m&&(this._showTileAABBs=m,m&&this._update())}_setCacheLimits(m,l){s.setCacheLimits(m,l)}get version(){return s.version}},NavigationControl:class{constructor(m){this.options=s.extend({},o1,m),this._container=R("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",l=>l.preventDefault()),this.options.showZoom&&(s.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",l=>{this._map&&this._map.zoomIn({},{originalEvent:l})}),R("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",l=>{this._map&&this._map.zoomOut({},{originalEvent:l})}),R("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(s.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",l=>{const f=this._map;f&&(this.options.visualizePitch?f.resetNorthPitch({},{originalEvent:l}):f.resetNorth({},{originalEvent:l}))}),this._compassIcon=R("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const m=this._map;if(!m)return;const l=m.getZoom(),f=l===m.getMaxZoom(),_=l===m.getMinZoom();this._zoomInButton.disabled=f,this._zoomOutButton.disabled=_,this._zoomInButton.setAttribute("aria-disabled",f.toString()),this._zoomOutButton.setAttribute("aria-disabled",_.toString())}_rotateCompassArrow(){const m=this._map;if(!m)return;const l=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(m.transform.pitch*(Math.PI/180)),.5)}) rotateX(${m.transform.pitch}deg) rotateZ(${m.transform.angle*(180/Math.PI)}deg)`:`rotate(${m.transform.angle*(180/Math.PI)}deg)`;m._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=l)})}onAdd(m){return this._map=m,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),m.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&m.on("pitch",this._rotateCompassArrow),m.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new s1(m,this._compass,this.options.visualizePitch)),this._container}onRemove(){const m=this._map;m&&(this._container.remove(),this.options.showZoom&&m.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&m.off("pitch",this._rotateCompassArrow),m.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(m,l){const f=R("button",m,this._container);return f.type="button",f.addEventListener("click",l),f}_setButtonTitle(m,l){if(!this._map)return;const f=this._map._getUIString(`NavigationControl.${l}`);m.setAttribute("aria-label",f),m.firstElementChild&&m.firstElementChild.setAttribute("title",f)}},GeolocateControl:class extends s.Evented{constructor(m){super(),this.options=s.extend({geolocation:s.window.navigator.geolocation},Nm,m),s.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=tc(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(m){return this._map=m,this._container=R("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(m){const l=(f=!!this.options.geolocation)=>{this._supportsGeolocation=f,m(f)};this._supportsGeolocation!==void 0?m(this._supportsGeolocation):s.window.navigator.permissions!==void 0?s.window.navigator.permissions.query({name:"geolocation"}).then(f=>l(f.state!=="denied")).catch(()=>l()):l()}_isOutOfMapMaxBounds(m){const l=this._map.getMaxBounds(),f=m.coords;return!!l&&(f.longitude<l.getWest()||f.longitude>l.getEast()||f.latitude<l.getSouth()||f.latitude>l.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(m){if(this._map){if(this._isOutOfMapMaxBounds(m))return this._setErrorState(),this.fire(new s.Event("outofmaxbounds",m)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=m,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(m),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(m),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new s.Event("geolocate",m)),this._finish()}}_updateCamera(m){const l=new s.LngLat(m.coords.longitude,m.coords.latitude),f=m.coords.accuracy,_=this._map.getBearing(),v=s.extend({bearing:_},this.options.fitBoundsOptions);this._map.fitBounds(l.toBounds(f),v,{geolocateSource:!0})}_updateMarker(m){if(m){const l=new s.LngLat(m.coords.longitude,m.coords.latitude);this._accuracyCircleMarker.setLngLat(l).addTo(this._map),this._userLocationDotMarker.setLngLat(l).addTo(this._map),this._accuracy=m.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const m=this._map.transform,l=s.mercatorZfromAltitude(1,m._center.lat)*m.worldSize,f=Math.ceil(2*this._accuracy*l);this._circleElement.style.width=`${f}px`,this._circleElement.style.height=`${f}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(m){if(this._map){if(this.options.trackUserLocation)if(m.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const l=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",l),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",l),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(m.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new s.Event("error",m)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(m){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",l=>l.preventDefault()),this._geolocateButton=R("button","mapboxgl-ctrl-geolocate",this._container),R("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",m===!1){s.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const l=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",l),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",l)}else{const l=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",l),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",l)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=R("div","mapboxgl-user-location"),this._dotElement.appendChild(R("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(R("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new yt({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=R("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new yt({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",l=>{l.geolocateSource||this._watchState!=="ACTIVE_LOCK"||l.originalEvent&&l.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new s.Event("trackuserlocationend")))})}}_onDeviceOrientation(m){this._userLocationDotMarker&&(m.webkitCompassHeading?this._heading=m.webkitCompassHeading:m.absolute===!0&&(this._heading=-1*m.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return s.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new s.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new s.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new s.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let m;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(m={maximumAge:6e5,timeout:0},this._noTimeout=!0):(m=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,m),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const m=()=>{s.window.addEventListener("ondeviceorientationabsolute"in s.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};s.window.DeviceMotionEvent!==void 0&&typeof s.window.DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(l=>{l==="granted"&&m()}).catch(console.error):m()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),s.window.removeEventListener("deviceorientation",this._onDeviceOrientation),s.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:bt,ScaleControl:class{constructor(m){this.options=s.extend({},km,m),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),s.bindAll(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const m=this.options.maxWidth||100,l=this._map,f=l._containerHeight/2,_=l._containerWidth/2-m/2,v=l.unproject([_,f]),b=l.unproject([_+m,f]),C=v.distanceTo(b);if(this.options.unit==="imperial"){const I=3.2808*C;I>5280?this._setScale(m,I/5280,"mile"):this._setScale(m,I,"foot")}else this.options.unit==="nautical"?this._setScale(m,C/1852,"nautical-mile"):C>=1e3?this._setScale(m,C/1e3,"kilometer"):this._setScale(m,C,"meter")}_setScale(m,l,f){this._map._requestDomTask(()=>{const _=function(b){const C=Math.pow(10,`${Math.floor(b)}`.length-1);let I=b/C;return I=I>=10?10:I>=5?5:I>=3?3:I>=2?2:I>=1?1:function(P){const O=Math.pow(10,Math.ceil(-Math.log(P)/Math.LN10));return Math.round(P*O)/O}(I),C*I}(l),v=_/l;this._container.innerHTML=this._isNumberFormatSupported&&f!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:f}).format(_):`${_}&nbsp;${Om[f]}`,this._container.style.width=m*v+"px"})}onAdd(m){return this._map=m,this._language=m.getLanguage(),this._container=R("div","mapboxgl-ctrl mapboxgl-ctrl-scale",m.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(m){this._language=m,this._update()}setUnit(m){this.options.unit=m,this._update()}},FullscreenControl:class{constructor(m){this._fullscreen=!1,m&&m.container&&(m.container instanceof s.window.HTMLElement?this._container=m.container:s.warnOnce("Full screen control 'container' must be a DOM element.")),s.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in s.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in s.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(m){return this._map=m,this._container||(this._container=this._map.getContainer()),this._controlContainer=R("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",s.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,s.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!s.window.document.fullscreenEnabled&&!s.window.document.webkitFullscreenEnabled)}_setupUI(){const m=this._fullscreenButton=R("button","mapboxgl-ctrl-fullscreen",this._controlContainer);R("span","mapboxgl-ctrl-icon",m).setAttribute("aria-hidden","true"),m.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),s.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const m=this._getTitle();this._fullscreenButton.setAttribute("aria-label",m),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",m)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(s.window.document.fullscreenElement||s.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?s.window.document.exitFullscreen?s.window.document.exitFullscreen():s.window.document.webkitCancelFullScreen&&s.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends s.Evented{constructor(m){super(),this.options=s.extend(Object.create(Dm),m),s.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(m&&m.className?m.className.trim().split(/\s+/):[])}addTo(m){return this._map&&this.remove(),this._map=m,this.options.closeOnClick&&m.on("preclick",this._onClose),this.options.closeOnMove&&m.on("move",this._onClose),m.on("remove",this.remove),this._update(),m._addPopup(this),this._focusFirstElement(),this._trackPointer?(m.on("mousemove",this._onMouseEvent),m.on("mouseup",this._onMouseEvent),m._canvasContainer.classList.add("mapboxgl-track-pointer")):m.on("move",this._update),this.fire(new s.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const m=this._map;return m&&(m.off("move",this._update),m.off("move",this._onClose),m.off("preclick",this._onClose),m.off("click",this._onClose),m.off("remove",this.remove),m.off("mousemove",this._onMouseEvent),m.off("mouseup",this._onMouseEvent),m.off("drag",this._onMouseEvent),m._canvasContainer&&m._canvasContainer.classList.remove("mapboxgl-track-pointer"),m._removePopup(this),this._map=void 0),this.fire(new s.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(m){this._lngLat=s.LngLat.convert(m),this._pos=null,this._trackPointer=!1,this._update();const l=this._map;return l&&(l.on("move",this._update),l.off("mousemove",this._onMouseEvent),l._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const m=this._map;return m&&(m.off("move",this._update),m.on("mousemove",this._onMouseEvent),m.on("drag",this._onMouseEvent),m._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(m){return this.setDOMContent(s.window.document.createTextNode(m))}setHTML(m){const l=s.window.document.createDocumentFragment(),f=s.window.document.createElement("body");let _;for(f.innerHTML=m;_=f.firstChild,_;)l.appendChild(_);return this.setDOMContent(l)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(m){return this.options.maxWidth=m,this._update(),this}setDOMContent(m){let l=this._content;if(l)for(;l.hasChildNodes();)l.firstChild&&l.removeChild(l.firstChild);else l=this._content=R("div","mapboxgl-popup-content",this._container||void 0);if(l.appendChild(m),this.options.closeButton){const f=this._closeButton=R("button","mapboxgl-popup-close-button",l);f.type="button",f.setAttribute("aria-label","Close popup"),f.setAttribute("aria-hidden","true"),f.innerHTML="&#215;",f.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(m){return this._classList.add(m),this._updateClassList(),this}removeClassName(m){return this._classList.delete(m),this._updateClassList(),this}setOffset(m){return this.options.offset=m,this._update(),this}toggleClassName(m){let l;return this._classList.delete(m)?l=!1:(this._classList.add(m),l=!0),this._updateClassList(),l}_onMouseEvent(m){this._update(m.point)}_getAnchor(m){if(this.options.anchor)return this.options.anchor;const l=this._map,f=this._container,_=this._pos;if(!l||!f||!_)return"bottom";const v=f.offsetWidth,b=f.offsetHeight,C=_.x<v/2,I=_.x>l.transform.width-v/2;if(_.y+m<b)return C?"top-left":I?"top-right":"top";if(_.y>l.transform.height-b){if(C)return"bottom-left";if(I)return"bottom-right"}return C?"left":I?"right":"bottom"}_updateClassList(){const m=this._container;if(!m)return;const l=[...this._classList];l.push("mapboxgl-popup"),this._anchor&&l.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&l.push("mapboxgl-popup-track-pointer"),m.className=l.join(" ")}_update(m){const l=this._map,f=this._content;if(!l||!this._lngLat&&!this._trackPointer||!f)return;let _=this._container;if(_||(_=this._container=R("div","mapboxgl-popup",l.getContainer()),this._tip=R("div","mapboxgl-popup-tip",_),_.appendChild(f)),this.options.maxWidth&&_.style.maxWidth!==this.options.maxWidth&&(_.style.maxWidth=this.options.maxWidth),l.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=ic(this._lngLat,this._pos,l.transform)),!this._trackPointer||m){const v=this._pos=this._trackPointer&&m?m:l.project(this._lngLat),b=Ly(this.options.offset),C=this._anchor=this._getAnchor(b.y),I=Ly(this.options.offset,C),P=v.add(I).round();l._requestDomTask(()=>{this._container&&C&&(this._container.style.transform=`${tu[C]} translate(${P.x}px,${P.y}px)`)})}if(!this._marker&&l._showingGlobe()){const v=s.isLngLatBehindGlobe(l.transform,this._lngLat)?0:1;this._setOpacity(v)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const m=this._container.querySelector(i1);m&&m.focus()}_onClose(){this.remove()}_setOpacity(m){this._container&&(this._container.style.opacity=`${m}`),this._content&&(this._content.style.pointerEvents=m?"auto":"none")}},Marker:yt,Style:Ns,LngLat:s.LngLat,LngLatBounds:s.LngLatBounds,Point:s.Point,MercatorCoordinate:s.MercatorCoordinate,FreeCameraOptions:gy,Evented:s.Evented,config:s.config,prewarm:function(){Vu().acquire(Ls)},clearPrewarmedResources:function(){const m=zi;m&&(m.isPreloaded()&&m.numActive()===1?(m.release(Ls),zi=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return s.config.ACCESS_TOKEN},set accessToken(m){s.config.ACCESS_TOKEN=m},get baseApiUrl(){return s.config.API_URL},set baseApiUrl(m){s.config.API_URL=m},get workerCount(){return Jr.workerCount},set workerCount(m){Jr.workerCount=m},get maxParallelImageRequests(){return s.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(m){s.config.MAX_PARALLEL_IMAGE_REQUESTS=m},clearStorage(m){s.clearTileCache(m)},workerUrl:"",workerClass:null,setNow:s.exported.setNow,restoreNow:s.exported.restoreNow};return oc});var d=u;return d})})(OL);var b4=OL.exports;const Kw=gE(b4);var Bi=63710088e-1,CS={centimeters:Bi*100,centimetres:Bi*100,degrees:Bi/111325,feet:Bi*3.28084,inches:Bi*39.37,kilometers:Bi/1e3,kilometres:Bi/1e3,meters:Bi,metres:Bi,miles:Bi/1609.344,millimeters:Bi*1e3,millimetres:Bi*1e3,nauticalmiles:Bi/1852,radians:1,yards:Bi*1.0936},E4={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/Bi,yards:1.0936133},sE={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function vs(t,e,n){n===void 0&&(n={});var i={type:"Feature"};return(n.id===0||n.id)&&(i.id=n.id),n.bbox&&(i.bbox=n.bbox),i.properties=e||{},i.geometry=t,i}function S4(t,e,n){switch(t){case"Point":return fs(e).geometry;case"LineString":return Va(e).geometry;case"Polygon":return IS(e).geometry;case"MultiPoint":return FL(e).geometry;case"MultiLineString":return MS(e).geometry;case"MultiPolygon":return BL(e).geometry;default:throw new Error(t+" is invalid")}}function fs(t,e,n){if(n===void 0&&(n={}),!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");if(t.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Z0(t[0])||!Z0(t[1]))throw new Error("coordinates must contain numbers");var i={type:"Point",coordinates:t};return vs(i,e,n)}function T4(t,e,n){return n===void 0&&(n={}),Za(t.map(function(i){return fs(i,e)}),n)}function IS(t,e,n){n===void 0&&(n={});for(var i=0,u=t;i<u.length;i++){var h=u[i];if(h.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var d=0;d<h[h.length-1].length;d++)if(h[h.length-1][d]!==h[0][d])throw new Error("First and last Position are not equivalent.")}var s={type:"Polygon",coordinates:t};return vs(s,e,n)}function C4(t,e,n){return n===void 0&&(n={}),Za(t.map(function(i){return IS(i,e)}),n)}function Va(t,e,n){if(n===void 0&&(n={}),t.length<2)throw new Error("coordinates must be an array of two or more positions");var i={type:"LineString",coordinates:t};return vs(i,e,n)}function I4(t,e,n){return n===void 0&&(n={}),Za(t.map(function(i){return Va(i,e)}),n)}function Za(t,e){e===void 0&&(e={});var n={type:"FeatureCollection"};return e.id&&(n.id=e.id),e.bbox&&(n.bbox=e.bbox),n.features=t,n}function MS(t,e,n){n===void 0&&(n={});var i={type:"MultiLineString",coordinates:t};return vs(i,e,n)}function FL(t,e,n){n===void 0&&(n={});var i={type:"MultiPoint",coordinates:t};return vs(i,e,n)}function BL(t,e,n){n===void 0&&(n={});var i={type:"MultiPolygon",coordinates:t};return vs(i,e,n)}function M4(t,e,n){n===void 0&&(n={});var i={type:"GeometryCollection",geometries:t};return vs(i,e,n)}function A4(t,e){if(e===void 0&&(e=0),e&&!(e>=0))throw new Error("precision must be a positive number");var n=Math.pow(10,e||0);return Math.round(t*n)/n}function AS(t,e){e===void 0&&(e="kilometers");var n=CS[e];if(!n)throw new Error(e+" units is invalid");return t*n}function Sx(t,e){e===void 0&&(e="kilometers");var n=CS[e];if(!n)throw new Error(e+" units is invalid");return t/n}function P4(t,e){return UL(Sx(t,e))}function L4(t){var e=t%360;return e<0&&(e+=360),e}function UL(t){var e=t%(2*Math.PI);return e*180/Math.PI}function D4(t){var e=t%360;return e*Math.PI/180}function R4(t,e,n){if(e===void 0&&(e="kilometers"),n===void 0&&(n="kilometers"),!(t>=0))throw new Error("length must be a positive number");return AS(Sx(t,e),n)}function N4(t,e,n){if(e===void 0&&(e="meters"),n===void 0&&(n="kilometers"),!(t>=0))throw new Error("area must be a positive number");var i=sE[e];if(!i)throw new Error("invalid original units");var u=sE[n];if(!u)throw new Error("invalid final units");return t/i*u}function Z0(t){return!isNaN(t)&&t!==null&&!Array.isArray(t)}function PS(t){return!!t&&t.constructor===Object}function k4(t){if(!t)throw new Error("bbox is required");if(!Array.isArray(t))throw new Error("bbox must be an Array");if(t.length!==4&&t.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");t.forEach(function(e){if(!Z0(e))throw new Error("bbox must only contain numbers")})}function O4(t){if(!t)throw new Error("id is required");if(["string","number"].indexOf(typeof t)===-1)throw new Error("id must be a number or a string")}const z4=Object.freeze(Object.defineProperty({__proto__:null,areaFactors:sE,bearingToAzimuth:L4,convertArea:N4,convertLength:R4,degreesToRadians:D4,earthRadius:Bi,factors:CS,feature:vs,featureCollection:Za,geometry:S4,geometryCollection:M4,isNumber:Z0,isObject:PS,lengthToDegrees:P4,lengthToRadians:Sx,lineString:Va,lineStrings:I4,multiLineString:MS,multiPoint:FL,multiPolygon:BL,point:fs,points:T4,polygon:IS,polygons:C4,radiansToDegrees:UL,radiansToLength:AS,round:A4,unitsFactors:E4,validateBBox:k4,validateId:O4},Symbol.toStringTag,{value:"Module"}));function Od(t,e,n){if(t!==null)for(var i,u,h,d,s,w,T,A=0,D=0,R,G=t.type,$=G==="FeatureCollection",ie=G==="Feature",_e=$?t.features.length:1,Y=0;Y<_e;Y++){T=$?t.features[Y].geometry:ie?t.geometry:t,R=T?T.type==="GeometryCollection":!1,s=R?T.geometries.length:1;for(var B=0;B<s;B++){var q=0,oe=0;if(d=R?T.geometries[B]:T,d!==null){w=d.coordinates;var de=d.type;switch(A=n&&(de==="Polygon"||de==="MultiPolygon")?1:0,de){case null:break;case"Point":if(e(w,D,Y,q,oe)===!1)return!1;D++,q++;break;case"LineString":case"MultiPoint":for(i=0;i<w.length;i++){if(e(w[i],D,Y,q,oe)===!1)return!1;D++,de==="MultiPoint"&&q++}de==="LineString"&&q++;break;case"Polygon":case"MultiLineString":for(i=0;i<w.length;i++){for(u=0;u<w[i].length-A;u++){if(e(w[i][u],D,Y,q,oe)===!1)return!1;D++}de==="MultiLineString"&&q++,de==="Polygon"&&oe++}de==="Polygon"&&q++;break;case"MultiPolygon":for(i=0;i<w.length;i++){for(oe=0,u=0;u<w[i].length;u++){for(h=0;h<w[i][u].length-A;h++){if(e(w[i][u][h],D,Y,q,oe)===!1)return!1;D++}oe++}q++}break;case"GeometryCollection":for(i=0;i<d.geometries.length;i++)if(Od(d.geometries[i],e,n)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function F4(t,e,n,i){var u=n;return Od(t,function(h,d,s,w,T){d===0&&n===void 0?u=h:u=e(u,h,d,s,w,T)},i),u}function VL(t,e){var n;switch(t.type){case"FeatureCollection":for(n=0;n<t.features.length&&e(t.features[n].properties,n)!==!1;n++);break;case"Feature":e(t.properties,0);break}}function B4(t,e,n){var i=n;return VL(t,function(u,h){h===0&&n===void 0?i=u:i=e(i,u,h)}),i}function hd(t,e){if(t.type==="Feature")e(t,0);else if(t.type==="FeatureCollection")for(var n=0;n<t.features.length&&e(t.features[n],n)!==!1;n++);}function U4(t,e,n){var i=n;return hd(t,function(u,h){h===0&&n===void 0?i=u:i=e(i,u,h)}),i}function V4(t){var e=[];return Od(t,function(n){e.push(n)}),e}function F_(t,e){var n,i,u,h,d,s,w,T,A,D,R=0,G=t.type==="FeatureCollection",$=t.type==="Feature",ie=G?t.features.length:1;for(n=0;n<ie;n++){for(s=G?t.features[n].geometry:$?t.geometry:t,T=G?t.features[n].properties:$?t.properties:{},A=G?t.features[n].bbox:$?t.bbox:void 0,D=G?t.features[n].id:$?t.id:void 0,w=s?s.type==="GeometryCollection":!1,d=w?s.geometries.length:1,u=0;u<d;u++){if(h=w?s.geometries[u]:s,h===null){if(e(null,R,T,A,D)===!1)return!1;continue}switch(h.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(e(h,R,T,A,D)===!1)return!1;break}case"GeometryCollection":{for(i=0;i<h.geometries.length;i++)if(e(h.geometries[i],R,T,A,D)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}R++}}function j4(t,e,n){var i=n;return F_(t,function(u,h,d,s,w){h===0&&n===void 0?i=u:i=e(i,u,h,d,s,w)}),i}function Tu(t,e){F_(t,function(n,i,u,h,d){var s=n===null?null:n.type;switch(s){case null:case"Point":case"LineString":case"Polygon":return e(vs(n,u,{bbox:h,id:d}),i,0)===!1?!1:void 0}var w;switch(s){case"MultiPoint":w="Point";break;case"MultiLineString":w="LineString";break;case"MultiPolygon":w="Polygon";break}for(var T=0;T<n.coordinates.length;T++){var A=n.coordinates[T],D={type:w,coordinates:A};if(e(vs(D,u),i,T)===!1)return!1}})}function G4(t,e,n){var i=n;return Tu(t,function(u,h,d){h===0&&d===0&&n===void 0?i=u:i=e(i,u,h,d)}),i}function jL(t,e){Tu(t,function(n,i,u){var h=0;if(n.geometry){var d=n.geometry.type;if(!(d==="Point"||d==="MultiPoint")){var s,w=0,T=0,A=0;if(Od(n,function(D,R,G,$,ie){if(s===void 0||i>w||$>T||ie>A){s=D,w=i,T=$,A=ie,h=0;return}var _e=Va([s,D],n.properties);if(e(_e,i,u,ie,h)===!1)return!1;h++,s=D})===!1)return!1}}})}function q4(t,e,n){var i=n,u=!1;return jL(t,function(h,d,s,w,T){u===!1&&n===void 0?i=h:i=e(i,h,d,s,w,T),u=!0}),i}function GL(t,e){if(!t)throw new Error("geojson is required");Tu(t,function(n,i,u){if(n.geometry!==null){var h=n.geometry.type,d=n.geometry.coordinates;switch(h){case"LineString":if(e(n,i,u,0,0)===!1)return!1;break;case"Polygon":for(var s=0;s<d.length;s++)if(e(Va(d[s],n.properties),i,u,s)===!1)return!1;break}}})}function X4(t,e,n){var i=n;return GL(t,function(u,h,d,s){h===0&&n===void 0?i=u:i=e(i,u,h,d,s)}),i}function $4(t,e){if(e=e||{},!PS(e))throw new Error("options is invalid");var n=e.featureIndex||0,i=e.multiFeatureIndex||0,u=e.geometryIndex||0,h=e.segmentIndex||0,d=e.properties,s;switch(t.type){case"FeatureCollection":n<0&&(n=t.features.length+n),d=d||t.features[n].properties,s=t.features[n].geometry;break;case"Feature":d=d||t.properties,s=t.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":s=t;break;default:throw new Error("geojson is invalid")}if(s===null)return null;var w=s.coordinates;switch(s.type){case"Point":case"MultiPoint":return null;case"LineString":return h<0&&(h=w.length+h-1),Va([w[h],w[h+1]],d,e);case"Polygon":return u<0&&(u=w.length+u),h<0&&(h=w[u].length+h-1),Va([w[u][h],w[u][h+1]],d,e);case"MultiLineString":return i<0&&(i=w.length+i),h<0&&(h=w[i].length+h-1),Va([w[i][h],w[i][h+1]],d,e);case"MultiPolygon":return i<0&&(i=w.length+i),u<0&&(u=w[i].length+u),h<0&&(h=w[i][u].length-h-1),Va([w[i][u][h],w[i][u][h+1]],d,e)}throw new Error("geojson is invalid")}function Z4(t,e){if(e=e||{},!PS(e))throw new Error("options is invalid");var n=e.featureIndex||0,i=e.multiFeatureIndex||0,u=e.geometryIndex||0,h=e.coordIndex||0,d=e.properties,s;switch(t.type){case"FeatureCollection":n<0&&(n=t.features.length+n),d=d||t.features[n].properties,s=t.features[n].geometry;break;case"Feature":d=d||t.properties,s=t.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":s=t;break;default:throw new Error("geojson is invalid")}if(s===null)return null;var w=s.coordinates;switch(s.type){case"Point":return fs(w,d,e);case"MultiPoint":return i<0&&(i=w.length+i),fs(w[i],d,e);case"LineString":return h<0&&(h=w.length+h),fs(w[h],d,e);case"Polygon":return u<0&&(u=w.length+u),h<0&&(h=w[u].length+h),fs(w[u][h],d,e);case"MultiLineString":return i<0&&(i=w.length+i),h<0&&(h=w[i].length+h),fs(w[i][h],d,e);case"MultiPolygon":return i<0&&(i=w.length+i),u<0&&(u=w[i].length+u),h<0&&(h=w[i][u].length-h),fs(w[i][u][h],d,e)}throw new Error("geojson is invalid")}const W4=Object.freeze(Object.defineProperty({__proto__:null,coordAll:V4,coordEach:Od,coordReduce:F4,featureEach:hd,featureReduce:U4,findPoint:Z4,findSegment:$4,flattenEach:Tu,flattenReduce:G4,geomEach:F_,geomReduce:j4,lineEach:GL,lineReduce:X4,propEach:VL,propReduce:B4,segmentEach:jL,segmentReduce:q4},Symbol.toStringTag,{value:"Module"}));function W0(t){var e=[1/0,1/0,-1/0,-1/0];return Od(t,function(n){e[0]>n[0]&&(e[0]=n[0]),e[1]>n[1]&&(e[1]=n[1]),e[2]<n[0]&&(e[2]=n[0]),e[3]<n[1]&&(e[3]=n[1])}),e}W0.default=W0;const H4=Object.freeze(Object.defineProperty({__proto__:null,default:W0},Symbol.toStringTag,{value:"Module"}));function Y4(t){if(!t)throw new Error("coord is required");if(!Array.isArray(t)){if(t.type==="Feature"&&t.geometry!==null&&t.geometry.type==="Point")return t.geometry.coordinates;if(t.type==="Point")return t.coordinates}if(Array.isArray(t)&&t.length>=2&&!Array.isArray(t[0])&&!Array.isArray(t[1]))return t;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function m_(t){if(Array.isArray(t))return t;if(t.type==="Feature"){if(t.geometry!==null)return t.geometry.coordinates}else if(t.coordinates)return t.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function Tx(t){return t.type==="Feature"?t.geometry:t}function g_(t,e,n){if(n===void 0&&(n={}),!t)throw new Error("point is required");if(!e)throw new Error("polygon is required");var i=Y4(t),u=Tx(e),h=u.type,d=e.bbox,s=u.coordinates;if(d&&K4(i,d)===!1)return!1;h==="Polygon"&&(s=[s]);for(var w=!1,T=0;T<s.length&&!w;T++)if(hM(i,s[T][0],n.ignoreBoundary)){for(var A=!1,D=1;D<s[T].length&&!A;)hM(i,s[T][D],!n.ignoreBoundary)&&(A=!0),D++;A||(w=!0)}return w}function hM(t,e,n){var i=!1;e[0][0]===e[e.length-1][0]&&e[0][1]===e[e.length-1][1]&&(e=e.slice(0,e.length-1));for(var u=0,h=e.length-1;u<e.length;h=u++){var d=e[u][0],s=e[u][1],w=e[h][0],T=e[h][1],A=t[1]*(d-w)+s*(w-t[0])+T*(t[0]-d)===0&&(d-t[0])*(w-t[0])<=0&&(s-t[1])*(T-t[1])<=0;if(A)return!n;var D=s>t[1]!=T>t[1]&&t[0]<(w-d)*(t[1]-s)/(T-s)+d;D&&(i=!i)}return i}function K4(t,e){return e[0]<=t[0]&&e[1]<=t[1]&&e[2]>=t[0]&&e[3]>=t[1]}function J4(t,e){e===void 0&&(e={});var n=W0(t),i=(n[0]+n[2])/2,u=(n[1]+n[3])/2;return fs([i,u],e.properties,e)}function fM(t){if(!t)throw new Error("geojson is required");var e=[];return Tu(t,function(n){Q4(n,e)}),Za(e)}function Q4(t,e){var n=[],i=t.geometry;if(i!==null){switch(i.type){case"Polygon":n=m_(i);break;case"LineString":n=[m_(i)]}n.forEach(function(u){var h=eU(u,t.properties);h.forEach(function(d){d.id=e.length,e.push(d)})})}}function eU(t,e){var n=[];return t.reduce(function(i,u){var h=Va([i,u],e);return h.bbox=tU(i,u),n.push(h),u}),n}function tU(t,e){var n=t[0],i=t[1],u=e[0],h=e[1],d=n<u?n:u,s=i<h?i:h,w=n>u?n:u,T=i>h?i:h;return[d,s,w,T]}var LS={exports:{}},qL={exports:{}};(function(t,e){(function(n,i){t.exports=i()})(GM,function(){function n(B,q,oe,de,we){(function Se(Te,xe,et,We,He){for(;We>et;){if(We-et>600){var $e=We-et+1,ze=xe-et+1,Pt=Math.log($e),Bt=.5*Math.exp(2*Pt/3),Zt=.5*Math.sqrt(Pt*Bt*($e-Bt)/$e)*(ze-$e/2<0?-1:1),qe=Math.max(et,Math.floor(xe-ze*Bt/$e+Zt)),Et=Math.min(We,Math.floor(xe+($e-ze)*Bt/$e+Zt));Se(Te,xe,qe,Et,He)}var Ct=Te[xe],kt=et,Vt=We;for(i(Te,et,xe),He(Te[We],Ct)>0&&i(Te,et,We);kt<Vt;){for(i(Te,kt,Vt),kt++,Vt--;He(Te[kt],Ct)<0;)kt++;for(;He(Te[Vt],Ct)>0;)Vt--}He(Te[et],Ct)===0?i(Te,et,Vt):i(Te,++Vt,We),Vt<=xe&&(et=Vt+1),xe<=Vt&&(We=Vt-1)}})(B,q,oe||0,de||B.length-1,we||u)}function i(B,q,oe){var de=B[q];B[q]=B[oe],B[oe]=de}function u(B,q){return B<q?-1:B>q?1:0}var h=function(B){B===void 0&&(B=9),this._maxEntries=Math.max(4,B),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function d(B,q,oe){if(!oe)return q.indexOf(B);for(var de=0;de<q.length;de++)if(oe(B,q[de]))return de;return-1}function s(B,q){w(B,0,B.children.length,q,B)}function w(B,q,oe,de,we){we||(we=_e(null)),we.minX=1/0,we.minY=1/0,we.maxX=-1/0,we.maxY=-1/0;for(var Se=q;Se<oe;Se++){var Te=B.children[Se];T(we,B.leaf?de(Te):Te)}return we}function T(B,q){return B.minX=Math.min(B.minX,q.minX),B.minY=Math.min(B.minY,q.minY),B.maxX=Math.max(B.maxX,q.maxX),B.maxY=Math.max(B.maxY,q.maxY),B}function A(B,q){return B.minX-q.minX}function D(B,q){return B.minY-q.minY}function R(B){return(B.maxX-B.minX)*(B.maxY-B.minY)}function G(B){return B.maxX-B.minX+(B.maxY-B.minY)}function $(B,q){return B.minX<=q.minX&&B.minY<=q.minY&&q.maxX<=B.maxX&&q.maxY<=B.maxY}function ie(B,q){return q.minX<=B.maxX&&q.minY<=B.maxY&&q.maxX>=B.minX&&q.maxY>=B.minY}function _e(B){return{children:B,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function Y(B,q,oe,de,we){for(var Se=[q,oe];Se.length;)if(!((oe=Se.pop())-(q=Se.pop())<=de)){var Te=q+Math.ceil((oe-q)/de/2)*de;n(B,Te,q,oe,we),Se.push(q,Te,Te,oe)}}return h.prototype.all=function(){return this._all(this.data,[])},h.prototype.search=function(B){var q=this.data,oe=[];if(!ie(B,q))return oe;for(var de=this.toBBox,we=[];q;){for(var Se=0;Se<q.children.length;Se++){var Te=q.children[Se],xe=q.leaf?de(Te):Te;ie(B,xe)&&(q.leaf?oe.push(Te):$(B,xe)?this._all(Te,oe):we.push(Te))}q=we.pop()}return oe},h.prototype.collides=function(B){var q=this.data;if(!ie(B,q))return!1;for(var oe=[];q;){for(var de=0;de<q.children.length;de++){var we=q.children[de],Se=q.leaf?this.toBBox(we):we;if(ie(B,Se)){if(q.leaf||$(B,Se))return!0;oe.push(we)}}q=oe.pop()}return!1},h.prototype.load=function(B){if(!B||!B.length)return this;if(B.length<this._minEntries){for(var q=0;q<B.length;q++)this.insert(B[q]);return this}var oe=this._build(B.slice(),0,B.length-1,0);if(this.data.children.length)if(this.data.height===oe.height)this._splitRoot(this.data,oe);else{if(this.data.height<oe.height){var de=this.data;this.data=oe,oe=de}this._insert(oe,this.data.height-oe.height-1,!0)}else this.data=oe;return this},h.prototype.insert=function(B){return B&&this._insert(B,this.data.height-1),this},h.prototype.clear=function(){return this.data=_e([]),this},h.prototype.remove=function(B,q){if(!B)return this;for(var oe,de,we,Se=this.data,Te=this.toBBox(B),xe=[],et=[];Se||xe.length;){if(Se||(Se=xe.pop(),de=xe[xe.length-1],oe=et.pop(),we=!0),Se.leaf){var We=d(B,Se.children,q);if(We!==-1)return Se.children.splice(We,1),xe.push(Se),this._condense(xe),this}we||Se.leaf||!$(Se,Te)?de?(oe++,Se=de.children[oe],we=!1):Se=null:(xe.push(Se),et.push(oe),oe=0,de=Se,Se=Se.children[0])}return this},h.prototype.toBBox=function(B){return B},h.prototype.compareMinX=function(B,q){return B.minX-q.minX},h.prototype.compareMinY=function(B,q){return B.minY-q.minY},h.prototype.toJSON=function(){return this.data},h.prototype.fromJSON=function(B){return this.data=B,this},h.prototype._all=function(B,q){for(var oe=[];B;)B.leaf?q.push.apply(q,B.children):oe.push.apply(oe,B.children),B=oe.pop();return q},h.prototype._build=function(B,q,oe,de){var we,Se=oe-q+1,Te=this._maxEntries;if(Se<=Te)return s(we=_e(B.slice(q,oe+1)),this.toBBox),we;de||(de=Math.ceil(Math.log(Se)/Math.log(Te)),Te=Math.ceil(Se/Math.pow(Te,de-1))),(we=_e([])).leaf=!1,we.height=de;var xe=Math.ceil(Se/Te),et=xe*Math.ceil(Math.sqrt(Te));Y(B,q,oe,et,this.compareMinX);for(var We=q;We<=oe;We+=et){var He=Math.min(We+et-1,oe);Y(B,We,He,xe,this.compareMinY);for(var $e=We;$e<=He;$e+=xe){var ze=Math.min($e+xe-1,He);we.children.push(this._build(B,$e,ze,de-1))}}return s(we,this.toBBox),we},h.prototype._chooseSubtree=function(B,q,oe,de){for(;de.push(q),!q.leaf&&de.length-1!==oe;){for(var we=1/0,Se=1/0,Te=void 0,xe=0;xe<q.children.length;xe++){var et=q.children[xe],We=R(et),He=($e=B,ze=et,(Math.max(ze.maxX,$e.maxX)-Math.min(ze.minX,$e.minX))*(Math.max(ze.maxY,$e.maxY)-Math.min(ze.minY,$e.minY))-We);He<Se?(Se=He,we=We<we?We:we,Te=et):He===Se&&We<we&&(we=We,Te=et)}q=Te||q.children[0]}var $e,ze;return q},h.prototype._insert=function(B,q,oe){var de=oe?B:this.toBBox(B),we=[],Se=this._chooseSubtree(de,this.data,q,we);for(Se.children.push(B),T(Se,de);q>=0&&we[q].children.length>this._maxEntries;)this._split(we,q),q--;this._adjustParentBBoxes(de,we,q)},h.prototype._split=function(B,q){var oe=B[q],de=oe.children.length,we=this._minEntries;this._chooseSplitAxis(oe,we,de);var Se=this._chooseSplitIndex(oe,we,de),Te=_e(oe.children.splice(Se,oe.children.length-Se));Te.height=oe.height,Te.leaf=oe.leaf,s(oe,this.toBBox),s(Te,this.toBBox),q?B[q-1].children.push(Te):this._splitRoot(oe,Te)},h.prototype._splitRoot=function(B,q){this.data=_e([B,q]),this.data.height=B.height+1,this.data.leaf=!1,s(this.data,this.toBBox)},h.prototype._chooseSplitIndex=function(B,q,oe){for(var de,we,Se,Te,xe,et,We,He=1/0,$e=1/0,ze=q;ze<=oe-q;ze++){var Pt=w(B,0,ze,this.toBBox),Bt=w(B,ze,oe,this.toBBox),Zt=(we=Pt,Se=Bt,Te=void 0,xe=void 0,et=void 0,We=void 0,Te=Math.max(we.minX,Se.minX),xe=Math.max(we.minY,Se.minY),et=Math.min(we.maxX,Se.maxX),We=Math.min(we.maxY,Se.maxY),Math.max(0,et-Te)*Math.max(0,We-xe)),qe=R(Pt)+R(Bt);Zt<He?(He=Zt,de=ze,$e=qe<$e?qe:$e):Zt===He&&qe<$e&&($e=qe,de=ze)}return de||oe-q},h.prototype._chooseSplitAxis=function(B,q,oe){var de=B.leaf?this.compareMinX:A,we=B.leaf?this.compareMinY:D;this._allDistMargin(B,q,oe,de)<this._allDistMargin(B,q,oe,we)&&B.children.sort(de)},h.prototype._allDistMargin=function(B,q,oe,de){B.children.sort(de);for(var we=this.toBBox,Se=w(B,0,q,we),Te=w(B,oe-q,oe,we),xe=G(Se)+G(Te),et=q;et<oe-q;et++){var We=B.children[et];T(Se,B.leaf?we(We):We),xe+=G(Se)}for(var He=oe-q-1;He>=q;He--){var $e=B.children[He];T(Te,B.leaf?we($e):$e),xe+=G(Te)}return xe},h.prototype._adjustParentBBoxes=function(B,q,oe){for(var de=oe;de>=0;de--)T(q[de],B)},h.prototype._condense=function(B){for(var q=B.length-1,oe=void 0;q>=0;q--)B[q].children.length===0?q>0?(oe=B[q-1].children).splice(oe.indexOf(B[q]),1):this.clear():s(B[q],this.toBBox)},h})})(qL);var nU=qL.exports;const rU=_E(z4),iU=_E(W4),oU=_E(H4);var bl=nU,XL=rU,$L=iU,Dp=oU.default,sU=$L.featureEach;$L.coordEach;XL.polygon;var pM=XL.featureCollection;function ZL(t){var e=new bl(t);return e.insert=function(n){if(n.type!=="Feature")throw new Error("invalid feature");return n.bbox=n.bbox?n.bbox:Dp(n),bl.prototype.insert.call(this,n)},e.load=function(n){var i=[];return Array.isArray(n)?n.forEach(function(u){if(u.type!=="Feature")throw new Error("invalid features");u.bbox=u.bbox?u.bbox:Dp(u),i.push(u)}):sU(n,function(u){if(u.type!=="Feature")throw new Error("invalid features");u.bbox=u.bbox?u.bbox:Dp(u),i.push(u)}),bl.prototype.load.call(this,i)},e.remove=function(n,i){if(n.type!=="Feature")throw new Error("invalid feature");return n.bbox=n.bbox?n.bbox:Dp(n),bl.prototype.remove.call(this,n,i)},e.clear=function(){return bl.prototype.clear.call(this)},e.search=function(n){var i=bl.prototype.search.call(this,this.toBBox(n));return pM(i)},e.collides=function(n){return bl.prototype.collides.call(this,this.toBBox(n))},e.all=function(){var n=bl.prototype.all.call(this);return pM(n)},e.toJSON=function(){return bl.prototype.toJSON.call(this)},e.fromJSON=function(n){return bl.prototype.fromJSON.call(this,n)},e.toBBox=function(n){var i;if(n.bbox)i=n.bbox;else if(Array.isArray(n)&&n.length===4)i=n;else if(Array.isArray(n)&&n.length===6)i=[n[0],n[1],n[3],n[4]];else if(n.type==="Feature")i=Dp(n);else if(n.type==="FeatureCollection")i=Dp(n);else throw new Error("invalid geojson");return{minX:i[0],minY:i[1],maxX:i[2],maxY:i[3]}},e}LS.exports=ZL;LS.exports.default=ZL;var aU=LS.exports;const lU=gE(aU);function DS(t,e){var n={},i=[];if(t.type==="LineString"&&(t=vs(t)),e.type==="LineString"&&(e=vs(e)),t.type==="Feature"&&e.type==="Feature"&&t.geometry!==null&&e.geometry!==null&&t.geometry.type==="LineString"&&e.geometry.type==="LineString"&&t.geometry.coordinates.length===2&&e.geometry.coordinates.length===2){var u=dM(t,e);return u&&i.push(u),Za(i)}var h=lU();return h.load(fM(e)),hd(fM(t),function(d){hd(h.search(d),function(s){var w=dM(d,s);if(w){var T=m_(w).join(",");n[T]||(n[T]=!0,i.push(w))}})}),Za(i)}function dM(t,e){var n=m_(t),i=m_(e);if(n.length!==2)throw new Error("<intersects> line1 must only contain 2 coordinates");if(i.length!==2)throw new Error("<intersects> line2 must only contain 2 coordinates");var u=n[0][0],h=n[0][1],d=n[1][0],s=n[1][1],w=i[0][0],T=i[0][1],A=i[1][0],D=i[1][1],R=(D-T)*(d-u)-(A-w)*(s-h),G=(A-w)*(h-T)-(D-T)*(u-w),$=(d-u)*(h-T)-(s-h)*(u-w);if(R===0)return null;var ie=G/R,_e=$/R;if(ie>=0&&ie<=1&&_e>=0&&_e<=1){var Y=u+ie*(d-u),B=h+ie*(s-h);return fs([Y,B])}return null}function aE(t,e){e===void 0&&(e={});var n=Tx(t);switch(!e.properties&&t.type==="Feature"&&(e.properties=t.properties),n.type){case"Polygon":return uU(n,e);case"MultiPolygon":return cU(n,e);default:throw new Error("invalid poly")}}function uU(t,e){e===void 0&&(e={});var n=Tx(t),i=n.coordinates,u=e.properties?e.properties:t.type==="Feature"?t.properties:{};return WL(i,u)}function cU(t,e){e===void 0&&(e={});var n=Tx(t),i=n.coordinates,u=e.properties?e.properties:t.type==="Feature"?t.properties:{},h=[];return i.forEach(function(d){h.push(WL(d,u))}),Za(h)}function WL(t,e){return t.length>1?MS(t,e):Va(t[0],e)}function hU(t,e){var n=!0;return Tu(t,function(i){Tu(e,function(u){if(n===!1)return!1;n=fU(i.geometry,u.geometry)})}),n}function fU(t,e){switch(t.type){case"Point":switch(e.type){case"Point":return!gU(t.coordinates,e.coordinates);case"LineString":return!mM(e,t);case"Polygon":return!g_(t,e)}break;case"LineString":switch(e.type){case"Point":return!mM(t,e);case"LineString":return!pU(t,e);case"Polygon":return!gM(e,t)}break;case"Polygon":switch(e.type){case"Point":return!g_(e,t);case"LineString":return!gM(t,e);case"Polygon":return!dU(e,t)}}return!1}function mM(t,e){for(var n=0;n<t.coordinates.length-1;n++)if(mU(t.coordinates[n],t.coordinates[n+1],e.coordinates))return!0;return!1}function pU(t,e){var n=DS(t,e);return n.features.length>0}function gM(t,e){for(var n=0,i=e.coordinates;n<i.length;n++){var u=i[n];if(g_(u,t))return!0}var h=DS(e,aE(t));return h.features.length>0}function dU(t,e){for(var n=0,i=t.coordinates[0];n<i.length;n++){var u=i[n];if(g_(u,e))return!0}for(var h=0,d=e.coordinates[0];h<d.length;h++){var s=d[h];if(g_(s,t))return!0}var w=DS(aE(t),aE(e));return w.features.length>0}function mU(t,e,n){var i=n[0]-t[0],u=n[1]-t[1],h=e[0]-t[0],d=e[1]-t[1],s=i*d-u*h;return s!==0?!1:Math.abs(h)>=Math.abs(d)?h>0?t[0]<=n[0]&&n[0]<=e[0]:e[0]<=n[0]&&n[0]<=t[0]:d>0?t[1]<=n[1]&&n[1]<=e[1]:e[1]<=n[1]&&n[1]<=t[1]}function gU(t,e){return t[0]===e[0]&&t[1]===e[1]}function _U(t,e){var n=!1;return Tu(t,function(i){Tu(e,function(u){if(n===!0)return!0;n=!hU(i.geometry,u.geometry)})}),n}"fill"in Array.prototype||Object.defineProperty(Array.prototype,"fill",{configurable:!0,value:function(e){if(this===void 0||this===null)throw new TypeError(this+" is not an object");var n=Object(this),i=Math.max(Math.min(n.length,9007199254740991),0)||0,u=1 in arguments&&parseInt(Number(arguments[1]),10)||0;u=u<0?Math.max(i+u,0):Math.min(u,i);var h=2 in arguments&&arguments[2]!==void 0?parseInt(Number(arguments[2]),10)||0:i;for(h=h<0?Math.max(i+arguments[2],0):Math.min(h,i);u<h;)n[u]=e,++u;return n},writable:!0});Number.isFinite=Number.isFinite||function(t){return typeof t=="number"&&isFinite(t)};Number.isInteger=Number.isInteger||function(t){return typeof t=="number"&&isFinite(t)&&Math.floor(t)===t};Number.parseFloat=Number.parseFloat||parseFloat;Number.isNaN=Number.isNaN||function(t){return t!==t};Math.trunc=Math.trunc||function(t){return t<0?Math.ceil(t):Math.floor(t)};var cf=function(){};cf.prototype.interfaces_=function(){return[]};cf.prototype.getClass=function(){return cf};cf.prototype.equalsWithTolerance=function(e,n,i){return Math.abs(e-n)<=i};var er=function(t){function e(n){t.call(this,n),this.name="IllegalArgumentException",this.message=n,this.stack=new t().stack}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(Error),Gt=function(){},HL={MAX_VALUE:{configurable:!0}};Gt.isNaN=function(e){return Number.isNaN(e)};Gt.doubleToLongBits=function(e){return e};Gt.longBitsToDouble=function(e){return e};Gt.isInfinite=function(e){return!Number.isFinite(e)};HL.MAX_VALUE.get=function(){return Number.MAX_VALUE};Object.defineProperties(Gt,HL);var ts=function(){},Cx=function(){},fd=function(){};function ns(){}var Me=function t(){if(this.x=null,this.y=null,this.z=null,arguments.length===0)this.x=0,this.y=0,this.z=t.NULL_ORDINATE;else if(arguments.length===1){var e=arguments[0];this.x=e.x,this.y=e.y,this.z=e.z}else arguments.length===2?(this.x=arguments[0],this.y=arguments[1],this.z=t.NULL_ORDINATE):arguments.length===3&&(this.x=arguments[0],this.y=arguments[1],this.z=arguments[2])},Tf={DimensionalComparator:{configurable:!0},serialVersionUID:{configurable:!0},NULL_ORDINATE:{configurable:!0},X:{configurable:!0},Y:{configurable:!0},Z:{configurable:!0}};Me.prototype.setOrdinate=function(e,n){switch(e){case Me.X:this.x=n;break;case Me.Y:this.y=n;break;case Me.Z:this.z=n;break;default:throw new er("Invalid ordinate index: "+e)}};Me.prototype.equals2D=function(){if(arguments.length===1){var e=arguments[0];return!(this.x!==e.x||this.y!==e.y)}else if(arguments.length===2){var n=arguments[0],i=arguments[1];return!(!cf.equalsWithTolerance(this.x,n.x,i)||!cf.equalsWithTolerance(this.y,n.y,i))}};Me.prototype.getOrdinate=function(e){switch(e){case Me.X:return this.x;case Me.Y:return this.y;case Me.Z:return this.z}throw new er("Invalid ordinate index: "+e)};Me.prototype.equals3D=function(e){return this.x===e.x&&this.y===e.y&&(this.z===e.z||Gt.isNaN(this.z))&&Gt.isNaN(e.z)};Me.prototype.equals=function(e){return e instanceof Me?this.equals2D(e):!1};Me.prototype.equalInZ=function(e,n){return cf.equalsWithTolerance(this.z,e.z,n)};Me.prototype.compareTo=function(e){var n=e;return this.x<n.x?-1:this.x>n.x?1:this.y<n.y?-1:this.y>n.y?1:0};Me.prototype.clone=function(){};Me.prototype.copy=function(){return new Me(this)};Me.prototype.toString=function(){return"("+this.x+", "+this.y+", "+this.z+")"};Me.prototype.distance3D=function(e){var n=this.x-e.x,i=this.y-e.y,u=this.z-e.z;return Math.sqrt(n*n+i*i+u*u)};Me.prototype.distance=function(e){var n=this.x-e.x,i=this.y-e.y;return Math.sqrt(n*n+i*i)};Me.prototype.hashCode=function(){var e=17;return e=37*e+Me.hashCode(this.x),e=37*e+Me.hashCode(this.y),e};Me.prototype.setCoordinate=function(e){this.x=e.x,this.y=e.y,this.z=e.z};Me.prototype.interfaces_=function(){return[ts,Cx,ns]};Me.prototype.getClass=function(){return Me};Me.hashCode=function(){if(arguments.length===1){var e=arguments[0],n=Gt.doubleToLongBits(e);return Math.trunc((n^n)>>>32)}};Tf.DimensionalComparator.get=function(){return gu};Tf.serialVersionUID.get=function(){return 6683108902428367e3};Tf.NULL_ORDINATE.get=function(){return Gt.NaN};Tf.X.get=function(){return 0};Tf.Y.get=function(){return 1};Tf.Z.get=function(){return 2};Object.defineProperties(Me,Tf);var gu=function(e){if(this._dimensionsToTest=2,arguments.length!==0){if(arguments.length===1){var n=arguments[0];if(n!==2&&n!==3)throw new er("only 2 or 3 dimensions may be specified");this._dimensionsToTest=n}}};gu.prototype.compare=function(e,n){var i=e,u=n,h=gu.compare(i.x,u.x);if(h!==0)return h;var d=gu.compare(i.y,u.y);if(d!==0)return d;if(this._dimensionsToTest<=2)return 0;var s=gu.compare(i.z,u.z);return s};gu.prototype.interfaces_=function(){return[fd]};gu.prototype.getClass=function(){return gu};gu.compare=function(e,n){return e<n?-1:e>n?1:Gt.isNaN(e)?Gt.isNaN(n)?0:-1:Gt.isNaN(n)?1:0};var pd=function(){};pd.prototype.create=function(){};pd.prototype.interfaces_=function(){return[]};pd.prototype.getClass=function(){return pd};var Oe=function(){},B_={INTERIOR:{configurable:!0},BOUNDARY:{configurable:!0},EXTERIOR:{configurable:!0},NONE:{configurable:!0}};Oe.prototype.interfaces_=function(){return[]};Oe.prototype.getClass=function(){return Oe};Oe.toLocationSymbol=function(e){switch(e){case Oe.EXTERIOR:return"e";case Oe.BOUNDARY:return"b";case Oe.INTERIOR:return"i";case Oe.NONE:return"-"}throw new er("Unknown location value: "+e)};B_.INTERIOR.get=function(){return 0};B_.BOUNDARY.get=function(){return 1};B_.EXTERIOR.get=function(){return 2};B_.NONE.get=function(){return-1};Object.defineProperties(Oe,B_);var Ut=function(t,e){return t.interfaces_&&t.interfaces_().indexOf(e)>-1},Eo=function(){},YL={LOG_10:{configurable:!0}};Eo.prototype.interfaces_=function(){return[]};Eo.prototype.getClass=function(){return Eo};Eo.log10=function(e){var n=Math.log(e);return Gt.isInfinite(n)||Gt.isNaN(n)?n:n/Eo.LOG_10};Eo.min=function(e,n,i,u){var h=e;return n<h&&(h=n),i<h&&(h=i),u<h&&(h=u),h};Eo.clamp=function(){if(typeof arguments[2]=="number"&&typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var e=arguments[0],n=arguments[1],i=arguments[2];return e<n?n:e>i?i:e}else if(Number.isInteger(arguments[2])&&Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var u=arguments[0],h=arguments[1],d=arguments[2];return u<h?h:u>d?d:u}};Eo.wrap=function(e,n){return e<0?n- -e%n:e%n};Eo.max=function(){if(arguments.length===3){var e=arguments[0],n=arguments[1],i=arguments[2],u=e;return n>u&&(u=n),i>u&&(u=i),u}else if(arguments.length===4){var h=arguments[0],d=arguments[1],s=arguments[2],w=arguments[3],T=h;return d>T&&(T=d),s>T&&(T=s),w>T&&(T=w),T}};Eo.average=function(e,n){return(e+n)/2};YL.LOG_10.get=function(){return Math.log(10)};Object.defineProperties(Eo,YL);var ca=function(e){this.str=e};ca.prototype.append=function(e){this.str+=e};ca.prototype.setCharAt=function(e,n){this.str=this.str.substr(0,e)+n+this.str.substr(e+1)};ca.prototype.toString=function(e){return this.str};var ea=function(e){this.value=e};ea.prototype.intValue=function(){return this.value};ea.prototype.compareTo=function(e){return this.value<e?-1:this.value>e?1:0};ea.isNaN=function(e){return Number.isNaN(e)};var __=function(){};__.isWhitespace=function(e){return e<=32&&e>=0||e===127};__.toUpperCase=function(e){return e.toUpperCase()};var Ve=function t(){if(this._hi=0,this._lo=0,arguments.length===0)this.init(0);else if(arguments.length===1){if(typeof arguments[0]=="number"){var e=arguments[0];this.init(e)}else if(arguments[0]instanceof t){var n=arguments[0];this.init(n)}else if(typeof arguments[0]=="string"){var i=arguments[0];t.call(this,t.parse(i))}}else if(arguments.length===2){var u=arguments[0],h=arguments[1];this.init(u,h)}},As={PI:{configurable:!0},TWO_PI:{configurable:!0},PI_2:{configurable:!0},E:{configurable:!0},NaN:{configurable:!0},EPS:{configurable:!0},SPLIT:{configurable:!0},MAX_PRINT_DIGITS:{configurable:!0},TEN:{configurable:!0},ONE:{configurable:!0},SCI_NOT_EXPONENT_CHAR:{configurable:!0},SCI_NOT_ZERO:{configurable:!0}};Ve.prototype.le=function(e){return(this._hi<e._hi||this._hi===e._hi)&&this._lo<=e._lo};Ve.prototype.extractSignificantDigits=function(e,n){var i=this.abs(),u=Ve.magnitude(i._hi),h=Ve.TEN.pow(u);i=i.divide(h),i.gt(Ve.TEN)?(i=i.divide(Ve.TEN),u+=1):i.lt(Ve.ONE)&&(i=i.multiply(Ve.TEN),u-=1);for(var d=u+1,s=new ca,w=Ve.MAX_PRINT_DIGITS-1,T=0;T<=w;T++){e&&T===d&&s.append(".");var A=Math.trunc(i._hi);if(A<0)break;var D=!1,R=0;A>9?(D=!0,R="9"):R="0"+A,s.append(R),i=i.subtract(Ve.valueOf(A)).multiply(Ve.TEN),D&&i.selfAdd(Ve.TEN);var G=!0,$=Ve.magnitude(i._hi);if($<0&&Math.abs($)>=w-T&&(G=!1),!G)break}return n[0]=u,s.toString()};Ve.prototype.sqr=function(){return this.multiply(this)};Ve.prototype.doubleValue=function(){return this._hi+this._lo};Ve.prototype.subtract=function(){if(arguments[0]instanceof Ve){var e=arguments[0];return this.add(e.negate())}else if(typeof arguments[0]=="number"){var n=arguments[0];return this.add(-n)}};Ve.prototype.equals=function(){if(arguments.length===1){var e=arguments[0];return this._hi===e._hi&&this._lo===e._lo}};Ve.prototype.isZero=function(){return this._hi===0&&this._lo===0};Ve.prototype.selfSubtract=function(){if(arguments[0]instanceof Ve){var e=arguments[0];return this.isNaN()?this:this.selfAdd(-e._hi,-e._lo)}else if(typeof arguments[0]=="number"){var n=arguments[0];return this.isNaN()?this:this.selfAdd(-n,0)}};Ve.prototype.getSpecialNumberString=function(){return this.isZero()?"0.0":this.isNaN()?"NaN ":null};Ve.prototype.min=function(e){return this.le(e)?this:e};Ve.prototype.selfDivide=function(){if(arguments.length===1){if(arguments[0]instanceof Ve){var e=arguments[0];return this.selfDivide(e._hi,e._lo)}else if(typeof arguments[0]=="number"){var n=arguments[0];return this.selfDivide(n,0)}}else if(arguments.length===2){var i=arguments[0],u=arguments[1],h=null,d=null,s=null,w=null,T=null,A=null,D=null,R=null;return T=this._hi/i,A=Ve.SPLIT*T,h=A-T,R=Ve.SPLIT*i,h=A-h,d=T-h,s=R-i,D=T*i,s=R-s,w=i-s,R=h*s-D+h*w+d*s+d*w,A=(this._hi-D-R+this._lo-T*u)/i,R=T+A,this._hi=R,this._lo=T-R+A,this}};Ve.prototype.dump=function(){return"DD<"+this._hi+", "+this._lo+">"};Ve.prototype.divide=function(){if(arguments[0]instanceof Ve){var e=arguments[0],n=null,i=null,u=null,h=null,d=null,s=null,w=null,T=null;d=this._hi/e._hi,s=Ve.SPLIT*d,n=s-d,T=Ve.SPLIT*e._hi,n=s-n,i=d-n,u=T-e._hi,w=d*e._hi,u=T-u,h=e._hi-u,T=n*u-w+n*h+i*u+i*h,s=(this._hi-w-T+this._lo-d*e._lo)/e._hi,T=d+s;var A=T,D=d-T+s;return new Ve(A,D)}else if(typeof arguments[0]=="number"){var R=arguments[0];return Gt.isNaN(R)?Ve.createNaN():Ve.copy(this).selfDivide(R,0)}};Ve.prototype.ge=function(e){return(this._hi>e._hi||this._hi===e._hi)&&this._lo>=e._lo};Ve.prototype.pow=function(e){if(e===0)return Ve.valueOf(1);var n=new Ve(this),i=Ve.valueOf(1),u=Math.abs(e);if(u>1)for(;u>0;)u%2===1&&i.selfMultiply(n),u/=2,u>0&&(n=n.sqr());else i=n;return e<0?i.reciprocal():i};Ve.prototype.ceil=function(){if(this.isNaN())return Ve.NaN;var e=Math.ceil(this._hi),n=0;return e===this._hi&&(n=Math.ceil(this._lo)),new Ve(e,n)};Ve.prototype.compareTo=function(e){var n=e;return this._hi<n._hi?-1:this._hi>n._hi?1:this._lo<n._lo?-1:this._lo>n._lo?1:0};Ve.prototype.rint=function(){if(this.isNaN())return this;var e=this.add(.5);return e.floor()};Ve.prototype.setValue=function(){if(arguments[0]instanceof Ve){var e=arguments[0];return this.init(e),this}else if(typeof arguments[0]=="number"){var n=arguments[0];return this.init(n),this}};Ve.prototype.max=function(e){return this.ge(e)?this:e};Ve.prototype.sqrt=function(){if(this.isZero())return Ve.valueOf(0);if(this.isNegative())return Ve.NaN;var e=1/Math.sqrt(this._hi),n=this._hi*e,i=Ve.valueOf(n),u=this.subtract(i.sqr()),h=u._hi*(e*.5);return i.add(h)};Ve.prototype.selfAdd=function(){if(arguments.length===1){if(arguments[0]instanceof Ve){var e=arguments[0];return this.selfAdd(e._hi,e._lo)}else if(typeof arguments[0]=="number"){var n=arguments[0],i=null,u=null,h=null,d=null,s=null,w=null;return h=this._hi+n,s=h-this._hi,d=h-s,d=n-s+(this._hi-d),w=d+this._lo,i=h+w,u=w+(h-i),this._hi=i+u,this._lo=u+(i-this._hi),this}}else if(arguments.length===2){var T=arguments[0],A=arguments[1],D=null,R=null,G=null,$=null,ie=null,_e=null,Y=null,B=null;ie=this._hi+T,G=this._lo+A,Y=ie-this._hi,B=G-this._lo,_e=ie-Y,$=G-B,_e=T-Y+(this._hi-_e),$=A-B+(this._lo-$),Y=_e+G,D=ie+Y,R=Y+(ie-D),Y=$+R;var q=D+Y,oe=Y+(D-q);return this._hi=q,this._lo=oe,this}};Ve.prototype.selfMultiply=function(){if(arguments.length===1){if(arguments[0]instanceof Ve){var e=arguments[0];return this.selfMultiply(e._hi,e._lo)}else if(typeof arguments[0]=="number"){var n=arguments[0];return this.selfMultiply(n,0)}}else if(arguments.length===2){var i=arguments[0],u=arguments[1],h=null,d=null,s=null,w=null,T=null,A=null;T=Ve.SPLIT*this._hi,h=T-this._hi,A=Ve.SPLIT*i,h=T-h,d=this._hi-h,s=A-i,T=this._hi*i,s=A-s,w=i-s,A=h*s-T+h*w+d*s+d*w+(this._hi*u+this._lo*i);var D=T+A;h=T-D;var R=A+h;return this._hi=D,this._lo=R,this}};Ve.prototype.selfSqr=function(){return this.selfMultiply(this)};Ve.prototype.floor=function(){if(this.isNaN())return Ve.NaN;var e=Math.floor(this._hi),n=0;return e===this._hi&&(n=Math.floor(this._lo)),new Ve(e,n)};Ve.prototype.negate=function(){return this.isNaN()?this:new Ve(-this._hi,-this._lo)};Ve.prototype.clone=function(){};Ve.prototype.multiply=function(){if(arguments[0]instanceof Ve){var e=arguments[0];return e.isNaN()?Ve.createNaN():Ve.copy(this).selfMultiply(e)}else if(typeof arguments[0]=="number"){var n=arguments[0];return Gt.isNaN(n)?Ve.createNaN():Ve.copy(this).selfMultiply(n,0)}};Ve.prototype.isNaN=function(){return Gt.isNaN(this._hi)};Ve.prototype.intValue=function(){return Math.trunc(this._hi)};Ve.prototype.toString=function(){var e=Ve.magnitude(this._hi);return e>=-3&&e<=20?this.toStandardNotation():this.toSciNotation()};Ve.prototype.toStandardNotation=function(){var e=this.getSpecialNumberString();if(e!==null)return e;var n=new Array(1).fill(null),i=this.extractSignificantDigits(!0,n),u=n[0]+1,h=i;if(i.charAt(0)===".")h="0"+i;else if(u<0)h="0."+Ve.stringOfChar("0",-u)+i;else if(i.indexOf(".")===-1){var d=u-i.length,s=Ve.stringOfChar("0",d);h=i+s+".0"}return this.isNegative()?"-"+h:h};Ve.prototype.reciprocal=function(){var e=null,n=null,i=null,u=null,h=null,d=null,s=null,w=null;h=1/this._hi,d=Ve.SPLIT*h,e=d-h,w=Ve.SPLIT*this._hi,e=d-e,n=h-e,i=w-this._hi,s=h*this._hi,i=w-i,u=this._hi-i,w=e*i-s+e*u+n*i+n*u,d=(1-s-w-h*this._lo)/this._hi;var T=h+d,A=h-T+d;return new Ve(T,A)};Ve.prototype.toSciNotation=function(){if(this.isZero())return Ve.SCI_NOT_ZERO;var e=this.getSpecialNumberString();if(e!==null)return e;var n=new Array(1).fill(null),i=this.extractSignificantDigits(!1,n),u=Ve.SCI_NOT_EXPONENT_CHAR+n[0];if(i.charAt(0)==="0")throw new Error("Found leading zero: "+i);var h="";i.length>1&&(h=i.substring(1));var d=i.charAt(0)+"."+h;return this.isNegative()?"-"+d+u:d+u};Ve.prototype.abs=function(){return this.isNaN()?Ve.NaN:this.isNegative()?this.negate():new Ve(this)};Ve.prototype.isPositive=function(){return(this._hi>0||this._hi===0)&&this._lo>0};Ve.prototype.lt=function(e){return(this._hi<e._hi||this._hi===e._hi)&&this._lo<e._lo};Ve.prototype.add=function(){if(arguments[0]instanceof Ve){var e=arguments[0];return Ve.copy(this).selfAdd(e)}else if(typeof arguments[0]=="number"){var n=arguments[0];return Ve.copy(this).selfAdd(n)}};Ve.prototype.init=function(){if(arguments.length===1){if(typeof arguments[0]=="number"){var e=arguments[0];this._hi=e,this._lo=0}else if(arguments[0]instanceof Ve){var n=arguments[0];this._hi=n._hi,this._lo=n._lo}}else if(arguments.length===2){var i=arguments[0],u=arguments[1];this._hi=i,this._lo=u}};Ve.prototype.gt=function(e){return(this._hi>e._hi||this._hi===e._hi)&&this._lo>e._lo};Ve.prototype.isNegative=function(){return(this._hi<0||this._hi===0)&&this._lo<0};Ve.prototype.trunc=function(){return this.isNaN()?Ve.NaN:this.isPositive()?this.floor():this.ceil()};Ve.prototype.signum=function(){return this._hi>0?1:this._hi<0?-1:this._lo>0?1:this._lo<0?-1:0};Ve.prototype.interfaces_=function(){return[ns,ts,Cx]};Ve.prototype.getClass=function(){return Ve};Ve.sqr=function(e){return Ve.valueOf(e).selfMultiply(e)};Ve.valueOf=function(){if(typeof arguments[0]=="string"){var e=arguments[0];return Ve.parse(e)}else if(typeof arguments[0]=="number"){var n=arguments[0];return new Ve(n)}};Ve.sqrt=function(e){return Ve.valueOf(e).sqrt()};Ve.parse=function(e){for(var n=0,i=e.length;__.isWhitespace(e.charAt(n));)n++;var u=!1;if(n<i){var h=e.charAt(n);(h==="-"||h==="+")&&(n++,h==="-"&&(u=!0))}for(var d=new Ve,s=0,w=0,T=0;!(n>=i);){var A=e.charAt(n);if(n++,__.isDigit(A)){var D=A-"0";d.selfMultiply(Ve.TEN),d.selfAdd(D),s++;continue}if(A==="."){w=s;continue}if(A==="e"||A==="E"){var R=e.substring(n);try{T=ea.parseInt(R)}catch(Y){throw Y instanceof Error?new Error("Invalid exponent "+R+" in string "+e):Y}finally{}break}throw new Error("Unexpected character '"+A+"' at position "+n+" in string "+e)}var G=d,$=s-w-T;if($===0)G=d;else if($>0){var ie=Ve.TEN.pow($);G=d.divide(ie)}else if($<0){var _e=Ve.TEN.pow(-$);G=d.multiply(_e)}return u?G.negate():G};Ve.createNaN=function(){return new Ve(Gt.NaN,Gt.NaN)};Ve.copy=function(e){return new Ve(e)};Ve.magnitude=function(e){var n=Math.abs(e),i=Math.log(n)/Math.log(10),u=Math.trunc(Math.floor(i)),h=Math.pow(10,u);return h*10<=n&&(u+=1),u};Ve.stringOfChar=function(e,n){for(var i=new ca,u=0;u<n;u++)i.append(e);return i.toString()};As.PI.get=function(){return new Ve(3.141592653589793,12246467991473532e-32)};As.TWO_PI.get=function(){return new Ve(6.283185307179586,24492935982947064e-32)};As.PI_2.get=function(){return new Ve(1.5707963267948966,6123233995736766e-32)};As.E.get=function(){return new Ve(2.718281828459045,14456468917292502e-32)};As.NaN.get=function(){return new Ve(Gt.NaN,Gt.NaN)};As.EPS.get=function(){return 123259516440783e-46};As.SPLIT.get=function(){return 134217729};As.MAX_PRINT_DIGITS.get=function(){return 32};As.TEN.get=function(){return Ve.valueOf(10)};As.ONE.get=function(){return Ve.valueOf(1)};As.SCI_NOT_EXPONENT_CHAR.get=function(){return"E"};As.SCI_NOT_ZERO.get=function(){return"0.0E0"};Object.defineProperties(Ve,As);var ji=function(){},KL={DP_SAFE_EPSILON:{configurable:!0}};ji.prototype.interfaces_=function(){return[]};ji.prototype.getClass=function(){return ji};ji.orientationIndex=function(e,n,i){var u=ji.orientationIndexFilter(e,n,i);if(u<=1)return u;var h=Ve.valueOf(n.x).selfAdd(-e.x),d=Ve.valueOf(n.y).selfAdd(-e.y),s=Ve.valueOf(i.x).selfAdd(-n.x),w=Ve.valueOf(i.y).selfAdd(-n.y);return h.selfMultiply(w).selfSubtract(d.selfMultiply(s)).signum()};ji.signOfDet2x2=function(e,n,i,u){var h=e.multiply(u).selfSubtract(n.multiply(i));return h.signum()};ji.intersection=function(e,n,i,u){var h=Ve.valueOf(u.y).selfSubtract(i.y).selfMultiply(Ve.valueOf(n.x).selfSubtract(e.x)),d=Ve.valueOf(u.x).selfSubtract(i.x).selfMultiply(Ve.valueOf(n.y).selfSubtract(e.y)),s=h.subtract(d),w=Ve.valueOf(u.x).selfSubtract(i.x).selfMultiply(Ve.valueOf(e.y).selfSubtract(i.y)),T=Ve.valueOf(u.y).selfSubtract(i.y).selfMultiply(Ve.valueOf(e.x).selfSubtract(i.x)),A=w.subtract(T),D=A.selfDivide(s).doubleValue(),R=Ve.valueOf(e.x).selfAdd(Ve.valueOf(n.x).selfSubtract(e.x).selfMultiply(D)).doubleValue(),G=Ve.valueOf(n.x).selfSubtract(e.x).selfMultiply(Ve.valueOf(e.y).selfSubtract(i.y)),$=Ve.valueOf(n.y).selfSubtract(e.y).selfMultiply(Ve.valueOf(e.x).selfSubtract(i.x)),ie=G.subtract($),_e=ie.selfDivide(s).doubleValue(),Y=Ve.valueOf(i.y).selfAdd(Ve.valueOf(u.y).selfSubtract(i.y).selfMultiply(_e)).doubleValue();return new Me(R,Y)};ji.orientationIndexFilter=function(e,n,i){var u=null,h=(e.x-i.x)*(n.y-i.y),d=(e.y-i.y)*(n.x-i.x),s=h-d;if(h>0){if(d<=0)return ji.signum(s);u=h+d}else if(h<0){if(d>=0)return ji.signum(s);u=-h-d}else return ji.signum(s);var w=ji.DP_SAFE_EPSILON*u;return s>=w||-s>=w?ji.signum(s):2};ji.signum=function(e){return e>0?1:e<0?-1:0};KL.DP_SAFE_EPSILON.get=function(){return 1e-15};Object.defineProperties(ji,KL);var dn=function(){},U_={X:{configurable:!0},Y:{configurable:!0},Z:{configurable:!0},M:{configurable:!0}};U_.X.get=function(){return 0};U_.Y.get=function(){return 1};U_.Z.get=function(){return 2};U_.M.get=function(){return 3};dn.prototype.setOrdinate=function(e,n,i){};dn.prototype.size=function(){};dn.prototype.getOrdinate=function(e,n){};dn.prototype.getCoordinate=function(){};dn.prototype.getCoordinateCopy=function(e){};dn.prototype.getDimension=function(){};dn.prototype.getX=function(e){};dn.prototype.clone=function(){};dn.prototype.expandEnvelope=function(e){};dn.prototype.copy=function(){};dn.prototype.getY=function(e){};dn.prototype.toCoordinateArray=function(){};dn.prototype.interfaces_=function(){return[Cx]};dn.prototype.getClass=function(){return dn};Object.defineProperties(dn,U_);var JL=function(){},zd=function(t){function e(){t.call(this,"Projective point not representable on the Cartesian plane.")}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(JL),li=function(){};li.arraycopy=function(e,n,i,u,h){for(var d=0,s=n;s<n+h;s++)i[u+d]=e[s],d++};li.getProperty=function(e){return{"line.separator":`
`}[e]};var ms=function t(){if(this.x=null,this.y=null,this.w=null,arguments.length===0)this.x=0,this.y=0,this.w=1;else if(arguments.length===1){var e=arguments[0];this.x=e.x,this.y=e.y,this.w=1}else if(arguments.length===2){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var n=arguments[0],i=arguments[1];this.x=n,this.y=i,this.w=1}else if(arguments[0]instanceof t&&arguments[1]instanceof t){var u=arguments[0],h=arguments[1];this.x=u.y*h.w-h.y*u.w,this.y=h.x*u.w-u.x*h.w,this.w=u.x*h.y-h.x*u.y}else if(arguments[0]instanceof Me&&arguments[1]instanceof Me){var d=arguments[0],s=arguments[1];this.x=d.y-s.y,this.y=s.x-d.x,this.w=d.x*s.y-s.x*d.y}}else if(arguments.length===3){var w=arguments[0],T=arguments[1],A=arguments[2];this.x=w,this.y=T,this.w=A}else if(arguments.length===4){var D=arguments[0],R=arguments[1],G=arguments[2],$=arguments[3],ie=D.y-R.y,_e=R.x-D.x,Y=D.x*R.y-R.x*D.y,B=G.y-$.y,q=$.x-G.x,oe=G.x*$.y-$.x*G.y;this.x=_e*oe-q*Y,this.y=B*Y-ie*oe,this.w=ie*q-B*_e}};ms.prototype.getY=function(){var e=this.y/this.w;if(Gt.isNaN(e)||Gt.isInfinite(e))throw new zd;return e};ms.prototype.getX=function(){var e=this.x/this.w;if(Gt.isNaN(e)||Gt.isInfinite(e))throw new zd;return e};ms.prototype.getCoordinate=function(){var e=new Me;return e.x=this.getX(),e.y=this.getY(),e};ms.prototype.interfaces_=function(){return[]};ms.prototype.getClass=function(){return ms};ms.intersection=function(e,n,i,u){var h=e.y-n.y,d=n.x-e.x,s=e.x*n.y-n.x*e.y,w=i.y-u.y,T=u.x-i.x,A=i.x*u.y-u.x*i.y,D=d*A-T*s,R=w*s-h*A,G=h*T-w*d,$=D/G,ie=R/G;if(Gt.isNaN($)||Gt.isInfinite($)||Gt.isNaN(ie)||Gt.isInfinite(ie))throw new zd;return new Me($,ie)};var Dt=function t(){if(this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,arguments.length===0)this.init();else if(arguments.length===1){if(arguments[0]instanceof Me){var e=arguments[0];this.init(e.x,e.x,e.y,e.y)}else if(arguments[0]instanceof t){var n=arguments[0];this.init(n)}}else if(arguments.length===2){var i=arguments[0],u=arguments[1];this.init(i.x,u.x,i.y,u.y)}else if(arguments.length===4){var h=arguments[0],d=arguments[1],s=arguments[2],w=arguments[3];this.init(h,d,s,w)}},QL={serialVersionUID:{configurable:!0}};Dt.prototype.getArea=function(){return this.getWidth()*this.getHeight()};Dt.prototype.equals=function(e){if(!(e instanceof Dt))return!1;var n=e;return this.isNull()?n.isNull():this._maxx===n.getMaxX()&&this._maxy===n.getMaxY()&&this._minx===n.getMinX()&&this._miny===n.getMinY()};Dt.prototype.intersection=function(e){if(this.isNull()||e.isNull()||!this.intersects(e))return new Dt;var n=this._minx>e._minx?this._minx:e._minx,i=this._miny>e._miny?this._miny:e._miny,u=this._maxx<e._maxx?this._maxx:e._maxx,h=this._maxy<e._maxy?this._maxy:e._maxy;return new Dt(n,u,i,h)};Dt.prototype.isNull=function(){return this._maxx<this._minx};Dt.prototype.getMaxX=function(){return this._maxx};Dt.prototype.covers=function(){if(arguments.length===1){if(arguments[0]instanceof Me){var e=arguments[0];return this.covers(e.x,e.y)}else if(arguments[0]instanceof Dt){var n=arguments[0];return this.isNull()||n.isNull()?!1:n.getMinX()>=this._minx&&n.getMaxX()<=this._maxx&&n.getMinY()>=this._miny&&n.getMaxY()<=this._maxy}}else if(arguments.length===2){var i=arguments[0],u=arguments[1];return this.isNull()?!1:i>=this._minx&&i<=this._maxx&&u>=this._miny&&u<=this._maxy}};Dt.prototype.intersects=function(){if(arguments.length===1){if(arguments[0]instanceof Dt){var e=arguments[0];return this.isNull()||e.isNull()?!1:!(e._minx>this._maxx||e._maxx<this._minx||e._miny>this._maxy||e._maxy<this._miny)}else if(arguments[0]instanceof Me){var n=arguments[0];return this.intersects(n.x,n.y)}}else if(arguments.length===2){var i=arguments[0],u=arguments[1];return this.isNull()?!1:!(i>this._maxx||i<this._minx||u>this._maxy||u<this._miny)}};Dt.prototype.getMinY=function(){return this._miny};Dt.prototype.getMinX=function(){return this._minx};Dt.prototype.expandToInclude=function(){if(arguments.length===1){if(arguments[0]instanceof Me){var e=arguments[0];this.expandToInclude(e.x,e.y)}else if(arguments[0]instanceof Dt){var n=arguments[0];if(n.isNull())return null;this.isNull()?(this._minx=n.getMinX(),this._maxx=n.getMaxX(),this._miny=n.getMinY(),this._maxy=n.getMaxY()):(n._minx<this._minx&&(this._minx=n._minx),n._maxx>this._maxx&&(this._maxx=n._maxx),n._miny<this._miny&&(this._miny=n._miny),n._maxy>this._maxy&&(this._maxy=n._maxy))}}else if(arguments.length===2){var i=arguments[0],u=arguments[1];this.isNull()?(this._minx=i,this._maxx=i,this._miny=u,this._maxy=u):(i<this._minx&&(this._minx=i),i>this._maxx&&(this._maxx=i),u<this._miny&&(this._miny=u),u>this._maxy&&(this._maxy=u))}};Dt.prototype.minExtent=function(){if(this.isNull())return 0;var e=this.getWidth(),n=this.getHeight();return e<n?e:n};Dt.prototype.getWidth=function(){return this.isNull()?0:this._maxx-this._minx};Dt.prototype.compareTo=function(e){var n=e;return this.isNull()?n.isNull()?0:-1:n.isNull()?1:this._minx<n._minx?-1:this._minx>n._minx?1:this._miny<n._miny?-1:this._miny>n._miny?1:this._maxx<n._maxx?-1:this._maxx>n._maxx?1:this._maxy<n._maxy?-1:this._maxy>n._maxy?1:0};Dt.prototype.translate=function(e,n){if(this.isNull())return null;this.init(this.getMinX()+e,this.getMaxX()+e,this.getMinY()+n,this.getMaxY()+n)};Dt.prototype.toString=function(){return"Env["+this._minx+" : "+this._maxx+", "+this._miny+" : "+this._maxy+"]"};Dt.prototype.setToNull=function(){this._minx=0,this._maxx=-1,this._miny=0,this._maxy=-1};Dt.prototype.getHeight=function(){return this.isNull()?0:this._maxy-this._miny};Dt.prototype.maxExtent=function(){if(this.isNull())return 0;var e=this.getWidth(),n=this.getHeight();return e>n?e:n};Dt.prototype.expandBy=function(){if(arguments.length===1){var e=arguments[0];this.expandBy(e,e)}else if(arguments.length===2){var n=arguments[0],i=arguments[1];if(this.isNull())return null;this._minx-=n,this._maxx+=n,this._miny-=i,this._maxy+=i,(this._minx>this._maxx||this._miny>this._maxy)&&this.setToNull()}};Dt.prototype.contains=function(){if(arguments.length===1){if(arguments[0]instanceof Dt){var e=arguments[0];return this.covers(e)}else if(arguments[0]instanceof Me){var n=arguments[0];return this.covers(n)}}else if(arguments.length===2){var i=arguments[0],u=arguments[1];return this.covers(i,u)}};Dt.prototype.centre=function(){return this.isNull()?null:new Me((this.getMinX()+this.getMaxX())/2,(this.getMinY()+this.getMaxY())/2)};Dt.prototype.init=function(){if(arguments.length===0)this.setToNull();else if(arguments.length===1){if(arguments[0]instanceof Me){var e=arguments[0];this.init(e.x,e.x,e.y,e.y)}else if(arguments[0]instanceof Dt){var n=arguments[0];this._minx=n._minx,this._maxx=n._maxx,this._miny=n._miny,this._maxy=n._maxy}}else if(arguments.length===2){var i=arguments[0],u=arguments[1];this.init(i.x,u.x,i.y,u.y)}else if(arguments.length===4){var h=arguments[0],d=arguments[1],s=arguments[2],w=arguments[3];h<d?(this._minx=h,this._maxx=d):(this._minx=d,this._maxx=h),s<w?(this._miny=s,this._maxy=w):(this._miny=w,this._maxy=s)}};Dt.prototype.getMaxY=function(){return this._maxy};Dt.prototype.distance=function(e){if(this.intersects(e))return 0;var n=0;this._maxx<e._minx?n=e._minx-this._maxx:this._minx>e._maxx&&(n=this._minx-e._maxx);var i=0;return this._maxy<e._miny?i=e._miny-this._maxy:this._miny>e._maxy&&(i=this._miny-e._maxy),n===0?i:i===0?n:Math.sqrt(n*n+i*i)};Dt.prototype.hashCode=function(){var e=17;return e=37*e+Me.hashCode(this._minx),e=37*e+Me.hashCode(this._maxx),e=37*e+Me.hashCode(this._miny),e=37*e+Me.hashCode(this._maxy),e};Dt.prototype.interfaces_=function(){return[ts,ns]};Dt.prototype.getClass=function(){return Dt};Dt.intersects=function(){if(arguments.length===3){var e=arguments[0],n=arguments[1],i=arguments[2];return i.x>=(e.x<n.x?e.x:n.x)&&i.x<=(e.x>n.x?e.x:n.x)&&i.y>=(e.y<n.y?e.y:n.y)&&i.y<=(e.y>n.y?e.y:n.y)}else if(arguments.length===4){var u=arguments[0],h=arguments[1],d=arguments[2],s=arguments[3],w=Math.min(d.x,s.x),T=Math.max(d.x,s.x),A=Math.min(u.x,h.x),D=Math.max(u.x,h.x);return!(A>T||D<w||(w=Math.min(d.y,s.y),T=Math.max(d.y,s.y),A=Math.min(u.y,h.y),D=Math.max(u.y,h.y),A>T)||D<w)}};QL.serialVersionUID.get=function(){return 5873921885273102e3};Object.defineProperties(Dt,QL);var js={typeStr:/^\s*(\w+)\s*\(\s*(.*)\s*\)\s*$/,emptyTypeStr:/^\s*(\w+)\s*EMPTY\s*$/,spaces:/\s+/,parenComma:/\)\s*,\s*\(/,doubleParenComma:/\)\s*\)\s*,\s*\(\s*\(/,trimParens:/^\s*\(?(.*?)\)?\s*$/},Ix=function(e){this.geometryFactory=e||new ln};Ix.prototype.read=function(e){var n,i,u;e=e.replace(/[\n\r]/g," ");var h=js.typeStr.exec(e);if(e.search("EMPTY")!==-1&&(h=js.emptyTypeStr.exec(e),h[2]=void 0),h&&(i=h[1].toLowerCase(),u=h[2],Zp[i]&&(n=Zp[i].apply(this,[u]))),n===void 0)throw new Error("Could not parse WKT "+e);return n};Ix.prototype.write=function(e){return this.extractGeometry(e)};Ix.prototype.extractGeometry=function(e){var n=e.getGeometryType().toLowerCase();if(!Tl[n])return null;var i=n.toUpperCase(),u;return e.isEmpty()?u=i+" EMPTY":u=i+"("+Tl[n].apply(this,[e])+")",u};var Tl={coordinate:function(e){return e.x+" "+e.y},point:function(e){return Tl.coordinate.call(this,e._coordinates._coordinates[0])},multipoint:function(e){for(var n=this,i=[],u=0,h=e._geometries.length;u<h;++u)i.push("("+Tl.point.apply(n,[e._geometries[u]])+")");return i.join(",")},linestring:function(e){for(var n=this,i=[],u=0,h=e._points._coordinates.length;u<h;++u)i.push(Tl.coordinate.apply(n,[e._points._coordinates[u]]));return i.join(",")},linearring:function(e){for(var n=this,i=[],u=0,h=e._points._coordinates.length;u<h;++u)i.push(Tl.coordinate.apply(n,[e._points._coordinates[u]]));return i.join(",")},multilinestring:function(e){for(var n=this,i=[],u=0,h=e._geometries.length;u<h;++u)i.push("("+Tl.linestring.apply(n,[e._geometries[u]])+")");return i.join(",")},polygon:function(e){var n=this,i=[];i.push("("+Tl.linestring.apply(this,[e._shell])+")");for(var u=0,h=e._holes.length;u<h;++u)i.push("("+Tl.linestring.apply(n,[e._holes[u]])+")");return i.join(",")},multipolygon:function(e){for(var n=this,i=[],u=0,h=e._geometries.length;u<h;++u)i.push("("+Tl.polygon.apply(n,[e._geometries[u]])+")");return i.join(",")},geometrycollection:function(e){for(var n=this,i=[],u=0,h=e._geometries.length;u<h;++u)i.push(n.extractGeometry(e._geometries[u]));return i.join(",")}},Zp={point:function(e){if(e===void 0)return this.geometryFactory.createPoint();var n=e.trim().split(js.spaces);return this.geometryFactory.createPoint(new Me(Number.parseFloat(n[0]),Number.parseFloat(n[1])))},multipoint:function(e){var n=this;if(e===void 0)return this.geometryFactory.createMultiPoint();for(var i,u=e.trim().split(","),h=[],d=0,s=u.length;d<s;++d)i=u[d].replace(js.trimParens,"$1"),h.push(Zp.point.apply(n,[i]));return this.geometryFactory.createMultiPoint(h)},linestring:function(e){if(e===void 0)return this.geometryFactory.createLineString();for(var n=e.trim().split(","),i=[],u,h=0,d=n.length;h<d;++h)u=n[h].trim().split(js.spaces),i.push(new Me(Number.parseFloat(u[0]),Number.parseFloat(u[1])));return this.geometryFactory.createLineString(i)},linearring:function(e){if(e===void 0)return this.geometryFactory.createLinearRing();for(var n=e.trim().split(","),i=[],u,h=0,d=n.length;h<d;++h)u=n[h].trim().split(js.spaces),i.push(new Me(Number.parseFloat(u[0]),Number.parseFloat(u[1])));return this.geometryFactory.createLinearRing(i)},multilinestring:function(e){var n=this;if(e===void 0)return this.geometryFactory.createMultiLineString();for(var i,u=e.trim().split(js.parenComma),h=[],d=0,s=u.length;d<s;++d)i=u[d].replace(js.trimParens,"$1"),h.push(Zp.linestring.apply(n,[i]));return this.geometryFactory.createMultiLineString(h)},polygon:function(e){var n=this;if(e===void 0)return this.geometryFactory.createPolygon();for(var i,u,h,d=e.trim().split(js.parenComma),s,w=[],T=0,A=d.length;T<A;++T)i=d[T].replace(js.trimParens,"$1"),u=Zp.linestring.apply(n,[i]),h=n.geometryFactory.createLinearRing(u._points),T===0?s=h:w.push(h);return this.geometryFactory.createPolygon(s,w)},multipolygon:function(e){var n=this;if(e===void 0)return this.geometryFactory.createMultiPolygon();for(var i,u=e.trim().split(js.doubleParenComma),h=[],d=0,s=u.length;d<s;++d)i=u[d].replace(js.trimParens,"$1"),h.push(Zp.polygon.apply(n,[i]));return this.geometryFactory.createMultiPolygon(h)},geometrycollection:function(e){var n=this;if(e===void 0)return this.geometryFactory.createGeometryCollection();e=e.replace(/,\s*([A-Za-z])/g,"|$1");for(var i=e.trim().split("|"),u=[],h=0,d=i.length;h<d;++h)u.push(n.read(i[h]));return this.geometryFactory.createGeometryCollection(u)}},xs=function(e){this.parser=new Ix(e)};xs.prototype.write=function(e){return this.parser.write(e)};xs.toLineString=function(e,n){if(arguments.length!==2)throw new Error("Not implemented");return"LINESTRING ( "+e.x+" "+e.y+", "+n.x+" "+n.y+" )"};var Nl=function(t){function e(n){t.call(this,n),this.name="RuntimeException",this.message=n,this.stack=new t().stack}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(Error),H0=function(t){function e(){if(t.call(this),arguments.length===0)t.call(this);else if(arguments.length===1){var n=arguments[0];t.call(this,n)}}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(Nl),Qt=function(){};Qt.prototype.interfaces_=function(){return[]};Qt.prototype.getClass=function(){return Qt};Qt.shouldNeverReachHere=function(){if(arguments.length===0)Qt.shouldNeverReachHere(null);else if(arguments.length===1){var e=arguments[0];throw new H0("Should never reach here"+(e!==null?": "+e:""))}};Qt.isTrue=function(){var e,n;if(arguments.length===1)e=arguments[0],Qt.isTrue(e,null);else if(arguments.length===2&&(e=arguments[0],n=arguments[1],!e))throw n===null?new H0:new H0(n)};Qt.equals=function(){var e,n,i;if(arguments.length===2)e=arguments[0],n=arguments[1],Qt.equals(e,n,null);else if(arguments.length===3&&(e=arguments[0],n=arguments[1],i=arguments[2],!n.equals(e)))throw new H0("Expected "+e+" but encountered "+n+(i!==null?": "+i:""))};var or=function(){this._result=null,this._inputLines=Array(2).fill().map(function(){return Array(2)}),this._intPt=new Array(2).fill(null),this._intLineIndex=null,this._isProper=null,this._pa=null,this._pb=null,this._precisionModel=null,this._intPt[0]=new Me,this._intPt[1]=new Me,this._pa=this._intPt[0],this._pb=this._intPt[1],this._result=0},Cf={DONT_INTERSECT:{configurable:!0},DO_INTERSECT:{configurable:!0},COLLINEAR:{configurable:!0},NO_INTERSECTION:{configurable:!0},POINT_INTERSECTION:{configurable:!0},COLLINEAR_INTERSECTION:{configurable:!0}};or.prototype.getIndexAlongSegment=function(e,n){return this.computeIntLineIndex(),this._intLineIndex[e][n]};or.prototype.getTopologySummary=function(){var e=new ca;return this.isEndPoint()&&e.append(" endpoint"),this._isProper&&e.append(" proper"),this.isCollinear()&&e.append(" collinear"),e.toString()};or.prototype.computeIntersection=function(e,n,i,u){this._inputLines[0][0]=e,this._inputLines[0][1]=n,this._inputLines[1][0]=i,this._inputLines[1][1]=u,this._result=this.computeIntersect(e,n,i,u)};or.prototype.getIntersectionNum=function(){return this._result};or.prototype.computeIntLineIndex=function(){if(arguments.length===0)this._intLineIndex===null&&(this._intLineIndex=Array(2).fill().map(function(){return Array(2)}),this.computeIntLineIndex(0),this.computeIntLineIndex(1));else if(arguments.length===1){var e=arguments[0],n=this.getEdgeDistance(e,0),i=this.getEdgeDistance(e,1);n>i?(this._intLineIndex[e][0]=0,this._intLineIndex[e][1]=1):(this._intLineIndex[e][0]=1,this._intLineIndex[e][1]=0)}};or.prototype.isProper=function(){return this.hasIntersection()&&this._isProper};or.prototype.setPrecisionModel=function(e){this._precisionModel=e};or.prototype.isInteriorIntersection=function(){var e=this;if(arguments.length===0)return!!(this.isInteriorIntersection(0)||this.isInteriorIntersection(1));if(arguments.length===1){for(var n=arguments[0],i=0;i<this._result;i++)if(!(e._intPt[i].equals2D(e._inputLines[n][0])||e._intPt[i].equals2D(e._inputLines[n][1])))return!0;return!1}};or.prototype.getIntersection=function(e){return this._intPt[e]};or.prototype.isEndPoint=function(){return this.hasIntersection()&&!this._isProper};or.prototype.hasIntersection=function(){return this._result!==or.NO_INTERSECTION};or.prototype.getEdgeDistance=function(e,n){var i=or.computeEdgeDistance(this._intPt[n],this._inputLines[e][0],this._inputLines[e][1]);return i};or.prototype.isCollinear=function(){return this._result===or.COLLINEAR_INTERSECTION};or.prototype.toString=function(){return xs.toLineString(this._inputLines[0][0],this._inputLines[0][1])+" - "+xs.toLineString(this._inputLines[1][0],this._inputLines[1][1])+this.getTopologySummary()};or.prototype.getEndpoint=function(e,n){return this._inputLines[e][n]};or.prototype.isIntersection=function(e){for(var n=this,i=0;i<this._result;i++)if(n._intPt[i].equals2D(e))return!0;return!1};or.prototype.getIntersectionAlongSegment=function(e,n){return this.computeIntLineIndex(),this._intPt[this._intLineIndex[e][n]]};or.prototype.interfaces_=function(){return[]};or.prototype.getClass=function(){return or};or.computeEdgeDistance=function(e,n,i){var u=Math.abs(i.x-n.x),h=Math.abs(i.y-n.y),d=-1;if(e.equals(n))d=0;else if(e.equals(i))u>h?d=u:d=h;else{var s=Math.abs(e.x-n.x),w=Math.abs(e.y-n.y);u>h?d=s:d=w,d===0&&!e.equals(n)&&(d=Math.max(s,w))}return Qt.isTrue(!(d===0&&!e.equals(n)),"Bad distance calculation"),d};or.nonRobustComputeEdgeDistance=function(e,n,i){var u=e.x-n.x,h=e.y-n.y,d=Math.sqrt(u*u+h*h);return Qt.isTrue(!(d===0&&!e.equals(n)),"Invalid distance calculation"),d};Cf.DONT_INTERSECT.get=function(){return 0};Cf.DO_INTERSECT.get=function(){return 1};Cf.COLLINEAR.get=function(){return 2};Cf.NO_INTERSECTION.get=function(){return 0};Cf.POINT_INTERSECTION.get=function(){return 1};Cf.COLLINEAR_INTERSECTION.get=function(){return 2};Object.defineProperties(or,Cf);var Yc=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.isInSegmentEnvelopes=function(i){var u=new Dt(this._inputLines[0][0],this._inputLines[0][1]),h=new Dt(this._inputLines[1][0],this._inputLines[1][1]);return u.contains(i)&&h.contains(i)},e.prototype.computeIntersection=function(){if(arguments.length===3){var i=arguments[0],u=arguments[1],h=arguments[2];if(this._isProper=!1,Dt.intersects(u,h,i)&&wt.orientationIndex(u,h,i)===0&&wt.orientationIndex(h,u,i)===0)return this._isProper=!0,(i.equals(u)||i.equals(h))&&(this._isProper=!1),this._result=t.POINT_INTERSECTION,null;this._result=t.NO_INTERSECTION}else return t.prototype.computeIntersection.apply(this,arguments)},e.prototype.normalizeToMinimum=function(i,u,h,d,s){s.x=this.smallestInAbsValue(i.x,u.x,h.x,d.x),s.y=this.smallestInAbsValue(i.y,u.y,h.y,d.y),i.x-=s.x,i.y-=s.y,u.x-=s.x,u.y-=s.y,h.x-=s.x,h.y-=s.y,d.x-=s.x,d.y-=s.y},e.prototype.safeHCoordinateIntersection=function(i,u,h,d){var s=null;try{s=ms.intersection(i,u,h,d)}catch(w){if(w instanceof zd)s=e.nearestEndpoint(i,u,h,d);else throw w}finally{}return s},e.prototype.intersection=function(i,u,h,d){var s=this.intersectionWithNormalization(i,u,h,d);return this.isInSegmentEnvelopes(s)||(s=new Me(e.nearestEndpoint(i,u,h,d))),this._precisionModel!==null&&this._precisionModel.makePrecise(s),s},e.prototype.smallestInAbsValue=function(i,u,h,d){var s=i,w=Math.abs(s);return Math.abs(u)<w&&(s=u,w=Math.abs(u)),Math.abs(h)<w&&(s=h,w=Math.abs(h)),Math.abs(d)<w&&(s=d),s},e.prototype.checkDD=function(i,u,h,d,s){var w=ji.intersection(i,u,h,d),T=this.isInSegmentEnvelopes(w);li.out.println("DD in env = "+T+"  --------------------- "+w),s.distance(w)>1e-4&&li.out.println("Distance = "+s.distance(w))},e.prototype.intersectionWithNormalization=function(i,u,h,d){var s=new Me(i),w=new Me(u),T=new Me(h),A=new Me(d),D=new Me;this.normalizeToEnvCentre(s,w,T,A,D);var R=this.safeHCoordinateIntersection(s,w,T,A);return R.x+=D.x,R.y+=D.y,R},e.prototype.computeCollinearIntersection=function(i,u,h,d){var s=Dt.intersects(i,u,h),w=Dt.intersects(i,u,d),T=Dt.intersects(h,d,i),A=Dt.intersects(h,d,u);return s&&w?(this._intPt[0]=h,this._intPt[1]=d,t.COLLINEAR_INTERSECTION):T&&A?(this._intPt[0]=i,this._intPt[1]=u,t.COLLINEAR_INTERSECTION):s&&T?(this._intPt[0]=h,this._intPt[1]=i,h.equals(i)&&!w&&!A?t.POINT_INTERSECTION:t.COLLINEAR_INTERSECTION):s&&A?(this._intPt[0]=h,this._intPt[1]=u,h.equals(u)&&!w&&!T?t.POINT_INTERSECTION:t.COLLINEAR_INTERSECTION):w&&T?(this._intPt[0]=d,this._intPt[1]=i,d.equals(i)&&!s&&!A?t.POINT_INTERSECTION:t.COLLINEAR_INTERSECTION):w&&A?(this._intPt[0]=d,this._intPt[1]=u,d.equals(u)&&!s&&!T?t.POINT_INTERSECTION:t.COLLINEAR_INTERSECTION):t.NO_INTERSECTION},e.prototype.normalizeToEnvCentre=function(i,u,h,d,s){var w=i.x<u.x?i.x:u.x,T=i.y<u.y?i.y:u.y,A=i.x>u.x?i.x:u.x,D=i.y>u.y?i.y:u.y,R=h.x<d.x?h.x:d.x,G=h.y<d.y?h.y:d.y,$=h.x>d.x?h.x:d.x,ie=h.y>d.y?h.y:d.y,_e=w>R?w:R,Y=A<$?A:$,B=T>G?T:G,q=D<ie?D:ie,oe=(_e+Y)/2,de=(B+q)/2;s.x=oe,s.y=de,i.x-=s.x,i.y-=s.y,u.x-=s.x,u.y-=s.y,h.x-=s.x,h.y-=s.y,d.x-=s.x,d.y-=s.y},e.prototype.computeIntersect=function(i,u,h,d){if(this._isProper=!1,!Dt.intersects(i,u,h,d))return t.NO_INTERSECTION;var s=wt.orientationIndex(i,u,h),w=wt.orientationIndex(i,u,d);if(s>0&&w>0||s<0&&w<0)return t.NO_INTERSECTION;var T=wt.orientationIndex(h,d,i),A=wt.orientationIndex(h,d,u);if(T>0&&A>0||T<0&&A<0)return t.NO_INTERSECTION;var D=s===0&&w===0&&T===0&&A===0;return D?this.computeCollinearIntersection(i,u,h,d):(s===0||w===0||T===0||A===0?(this._isProper=!1,i.equals2D(h)||i.equals2D(d)?this._intPt[0]=i:u.equals2D(h)||u.equals2D(d)?this._intPt[0]=u:s===0?this._intPt[0]=new Me(h):w===0?this._intPt[0]=new Me(d):T===0?this._intPt[0]=new Me(i):A===0&&(this._intPt[0]=new Me(u))):(this._isProper=!0,this._intPt[0]=this.intersection(i,u,h,d)),t.POINT_INTERSECTION)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e.nearestEndpoint=function(i,u,h,d){var s=i,w=wt.distancePointLine(i,h,d),T=wt.distancePointLine(u,h,d);return T<w&&(w=T,s=u),T=wt.distancePointLine(h,i,u),T<w&&(w=T,s=h),T=wt.distancePointLine(d,i,u),T<w&&(w=T,s=d),s},e}(or),hf=function(){};hf.prototype.interfaces_=function(){return[]};hf.prototype.getClass=function(){return hf};hf.orientationIndex=function(e,n,i){var u=n.x-e.x,h=n.y-e.y,d=i.x-n.x,s=i.y-n.y;return hf.signOfDet2x2(u,h,d,s)};hf.signOfDet2x2=function(e,n,i,u){var h=null,d=null,s=null;if(h=1,e===0||u===0)return n===0||i===0?0:n>0?i>0?-h:h:i>0?h:-h;if(n===0||i===0)return u>0?e>0?h:-h:e>0?-h:h;if(n>0?u>0?n<=u||(h=-h,d=e,e=i,i=d,d=n,n=u,u=d):n<=-u?(h=-h,i=-i,u=-u):(d=e,e=-i,i=d,d=n,n=-u,u=d):u>0?-n<=u?(h=-h,e=-e,n=-n):(d=-e,e=i,i=d,d=-n,n=u,u=d):n>=u?(e=-e,n=-n,i=-i,u=-u):(h=-h,d=-e,e=-i,i=d,d=-n,n=-u,u=d),e>0)if(i>0){if(!(e<=i))return h}else return h;else{if(i>0)return-h;if(e>=i)h=-h,e=-e,i=-i;else return-h}for(;;){if(s=Math.floor(i/e),i=i-s*e,u=u-s*n,u<0)return-h;if(u>n)return h;if(e>i+i){if(n<u+u)return h}else{if(n>u+u)return-h;i=e-i,u=n-u,h=-h}if(u===0)return i===0?0:-h;if(i===0||(s=Math.floor(e/i),e=e-s*i,n=n-s*u,n<0))return h;if(n>u)return-h;if(i>e+e){if(u<n+n)return-h}else{if(u>n+n)return h;e=i-e,n=u-n,h=-h}if(n===0)return e===0?0:h;if(e===0)return-h}};var Ys=function(){this._p=null,this._crossingCount=0,this._isPointOnSegment=!1;var e=arguments[0];this._p=e};Ys.prototype.countSegment=function(e,n){if(e.x<this._p.x&&n.x<this._p.x)return null;if(this._p.x===n.x&&this._p.y===n.y)return this._isPointOnSegment=!0,null;if(e.y===this._p.y&&n.y===this._p.y){var i=e.x,u=n.x;return i>u&&(i=n.x,u=e.x),this._p.x>=i&&this._p.x<=u&&(this._isPointOnSegment=!0),null}if(e.y>this._p.y&&n.y<=this._p.y||n.y>this._p.y&&e.y<=this._p.y){var h=e.x-this._p.x,d=e.y-this._p.y,s=n.x-this._p.x,w=n.y-this._p.y,T=hf.signOfDet2x2(h,d,s,w);if(T===0)return this._isPointOnSegment=!0,null;w<d&&(T=-T),T>0&&this._crossingCount++}};Ys.prototype.isPointInPolygon=function(){return this.getLocation()!==Oe.EXTERIOR};Ys.prototype.getLocation=function(){return this._isPointOnSegment?Oe.BOUNDARY:this._crossingCount%2===1?Oe.INTERIOR:Oe.EXTERIOR};Ys.prototype.isOnSegment=function(){return this._isPointOnSegment};Ys.prototype.interfaces_=function(){return[]};Ys.prototype.getClass=function(){return Ys};Ys.locatePointInRing=function(){if(arguments[0]instanceof Me&&Ut(arguments[1],dn)){for(var e=arguments[0],n=arguments[1],i=new Ys(e),u=new Me,h=new Me,d=1;d<n.size();d++)if(n.getCoordinate(d,u),n.getCoordinate(d-1,h),i.countSegment(u,h),i.isOnSegment())return i.getLocation();return i.getLocation()}else if(arguments[0]instanceof Me&&arguments[1]instanceof Array){for(var s=arguments[0],w=arguments[1],T=new Ys(s),A=1;A<w.length;A++){var D=w[A],R=w[A-1];if(T.countSegment(D,R),T.isOnSegment())return T.getLocation()}return T.getLocation()}};var wt=function(){},If={CLOCKWISE:{configurable:!0},RIGHT:{configurable:!0},COUNTERCLOCKWISE:{configurable:!0},LEFT:{configurable:!0},COLLINEAR:{configurable:!0},STRAIGHT:{configurable:!0}};wt.prototype.interfaces_=function(){return[]};wt.prototype.getClass=function(){return wt};wt.orientationIndex=function(e,n,i){return ji.orientationIndex(e,n,i)};wt.signedArea=function(){if(arguments[0]instanceof Array){var e=arguments[0];if(e.length<3)return 0;for(var n=0,i=e[0].x,u=1;u<e.length-1;u++){var h=e[u].x-i,d=e[u+1].y,s=e[u-1].y;n+=h*(s-d)}return n/2}else if(Ut(arguments[0],dn)){var w=arguments[0],T=w.size();if(T<3)return 0;var A=new Me,D=new Me,R=new Me;w.getCoordinate(0,D),w.getCoordinate(1,R);var G=D.x;R.x-=G;for(var $=0,ie=1;ie<T-1;ie++)A.y=D.y,D.x=R.x,D.y=R.y,w.getCoordinate(ie+1,R),R.x-=G,$+=D.x*(A.y-R.y);return $/2}};wt.distanceLineLine=function(e,n,i,u){if(e.equals(n))return wt.distancePointLine(e,i,u);if(i.equals(u))return wt.distancePointLine(u,e,n);var h=!1;if(!Dt.intersects(e,n,i,u))h=!0;else{var d=(n.x-e.x)*(u.y-i.y)-(n.y-e.y)*(u.x-i.x);if(d===0)h=!0;else{var s=(e.y-i.y)*(u.x-i.x)-(e.x-i.x)*(u.y-i.y),w=(e.y-i.y)*(n.x-e.x)-(e.x-i.x)*(n.y-e.y),T=w/d,A=s/d;(A<0||A>1||T<0||T>1)&&(h=!0)}}return h?Eo.min(wt.distancePointLine(e,i,u),wt.distancePointLine(n,i,u),wt.distancePointLine(i,e,n),wt.distancePointLine(u,e,n)):0};wt.isPointInRing=function(e,n){return wt.locatePointInRing(e,n)!==Oe.EXTERIOR};wt.computeLength=function(e){var n=e.size();if(n<=1)return 0;var i=0,u=new Me;e.getCoordinate(0,u);for(var h=u.x,d=u.y,s=1;s<n;s++){e.getCoordinate(s,u);var w=u.x,T=u.y,A=w-h,D=T-d;i+=Math.sqrt(A*A+D*D),h=w,d=T}return i};wt.isCCW=function(e){var n=e.length-1;if(n<3)throw new er("Ring has fewer than 4 points, so orientation cannot be determined");for(var i=e[0],u=0,h=1;h<=n;h++){var d=e[h];d.y>i.y&&(i=d,u=h)}var s=u;do s=s-1,s<0&&(s=n);while(e[s].equals2D(i)&&s!==u);var w=u;do w=(w+1)%n;while(e[w].equals2D(i)&&w!==u);var T=e[s],A=e[w];if(T.equals2D(i)||A.equals2D(i)||T.equals2D(A))return!1;var D=wt.computeOrientation(T,i,A),R=!1;return D===0?R=T.x>A.x:R=D>0,R};wt.locatePointInRing=function(e,n){return Ys.locatePointInRing(e,n)};wt.distancePointLinePerpendicular=function(e,n,i){var u=(i.x-n.x)*(i.x-n.x)+(i.y-n.y)*(i.y-n.y),h=((n.y-e.y)*(i.x-n.x)-(n.x-e.x)*(i.y-n.y))/u;return Math.abs(h)*Math.sqrt(u)};wt.computeOrientation=function(e,n,i){return wt.orientationIndex(e,n,i)};wt.distancePointLine=function(){if(arguments.length===2){var e=arguments[0],n=arguments[1];if(n.length===0)throw new er("Line array must contain at least one vertex");for(var i=e.distance(n[0]),u=0;u<n.length-1;u++){var h=wt.distancePointLine(e,n[u],n[u+1]);h<i&&(i=h)}return i}else if(arguments.length===3){var d=arguments[0],s=arguments[1],w=arguments[2];if(s.x===w.x&&s.y===w.y)return d.distance(s);var T=(w.x-s.x)*(w.x-s.x)+(w.y-s.y)*(w.y-s.y),A=((d.x-s.x)*(w.x-s.x)+(d.y-s.y)*(w.y-s.y))/T;if(A<=0)return d.distance(s);if(A>=1)return d.distance(w);var D=((s.y-d.y)*(w.x-s.x)-(s.x-d.x)*(w.y-s.y))/T;return Math.abs(D)*Math.sqrt(T)}};wt.isOnLine=function(e,n){for(var i=new Yc,u=1;u<n.length;u++){var h=n[u-1],d=n[u];if(i.computeIntersection(e,h,d),i.hasIntersection())return!0}return!1};If.CLOCKWISE.get=function(){return-1};If.RIGHT.get=function(){return wt.CLOCKWISE};If.COUNTERCLOCKWISE.get=function(){return 1};If.LEFT.get=function(){return wt.COUNTERCLOCKWISE};If.COLLINEAR.get=function(){return 0};If.STRAIGHT.get=function(){return wt.COLLINEAR};Object.defineProperties(wt,If);var kl=function(){};kl.prototype.filter=function(e){};kl.prototype.interfaces_=function(){return[]};kl.prototype.getClass=function(){return kl};var Ft=function(){var e=arguments[0];this._envelope=null,this._factory=null,this._SRID=null,this._userData=null,this._factory=e,this._SRID=e.getSRID()},il={serialVersionUID:{configurable:!0},SORTINDEX_POINT:{configurable:!0},SORTINDEX_MULTIPOINT:{configurable:!0},SORTINDEX_LINESTRING:{configurable:!0},SORTINDEX_LINEARRING:{configurable:!0},SORTINDEX_MULTILINESTRING:{configurable:!0},SORTINDEX_POLYGON:{configurable:!0},SORTINDEX_MULTIPOLYGON:{configurable:!0},SORTINDEX_GEOMETRYCOLLECTION:{configurable:!0},geometryChangedFilter:{configurable:!0}};Ft.prototype.isGeometryCollection=function(){return this.getSortIndex()===Ft.SORTINDEX_GEOMETRYCOLLECTION};Ft.prototype.getFactory=function(){return this._factory};Ft.prototype.getGeometryN=function(e){return this};Ft.prototype.getArea=function(){return 0};Ft.prototype.isRectangle=function(){return!1};Ft.prototype.equals=function(){if(arguments[0]instanceof Ft){var e=arguments[0];return e===null?!1:this.equalsTopo(e)}else if(arguments[0]instanceof Object){var n=arguments[0];if(!(n instanceof Ft))return!1;var i=n;return this.equalsExact(i)}};Ft.prototype.equalsExact=function(e){return this===e||this.equalsExact(e,0)};Ft.prototype.geometryChanged=function(){this.apply(Ft.geometryChangedFilter)};Ft.prototype.geometryChangedAction=function(){this._envelope=null};Ft.prototype.equalsNorm=function(e){return e===null?!1:this.norm().equalsExact(e.norm())};Ft.prototype.getLength=function(){return 0};Ft.prototype.getNumGeometries=function(){return 1};Ft.prototype.compareTo=function(){if(arguments.length===1){var e=arguments[0],n=e;return this.getSortIndex()!==n.getSortIndex()?this.getSortIndex()-n.getSortIndex():this.isEmpty()&&n.isEmpty()?0:this.isEmpty()?-1:n.isEmpty()?1:this.compareToSameClass(e)}else if(arguments.length===2){var i=arguments[0],u=arguments[1];return this.getSortIndex()!==i.getSortIndex()?this.getSortIndex()-i.getSortIndex():this.isEmpty()&&i.isEmpty()?0:this.isEmpty()?-1:i.isEmpty()?1:this.compareToSameClass(i,u)}};Ft.prototype.getUserData=function(){return this._userData};Ft.prototype.getSRID=function(){return this._SRID};Ft.prototype.getEnvelope=function(){return this.getFactory().toGeometry(this.getEnvelopeInternal())};Ft.prototype.checkNotGeometryCollection=function(e){if(e.getSortIndex()===Ft.SORTINDEX_GEOMETRYCOLLECTION)throw new er("This method does not support GeometryCollection arguments")};Ft.prototype.equal=function(e,n,i){return i===0?e.equals(n):e.distance(n)<=i};Ft.prototype.norm=function(){var e=this.copy();return e.normalize(),e};Ft.prototype.getPrecisionModel=function(){return this._factory.getPrecisionModel()};Ft.prototype.getEnvelopeInternal=function(){return this._envelope===null&&(this._envelope=this.computeEnvelopeInternal()),new Dt(this._envelope)};Ft.prototype.setSRID=function(e){this._SRID=e};Ft.prototype.setUserData=function(e){this._userData=e};Ft.prototype.compare=function(e,n){for(var i=e.iterator(),u=n.iterator();i.hasNext()&&u.hasNext();){var h=i.next(),d=u.next(),s=h.compareTo(d);if(s!==0)return s}return i.hasNext()?1:u.hasNext()?-1:0};Ft.prototype.hashCode=function(){return this.getEnvelopeInternal().hashCode()};Ft.prototype.isGeometryCollectionOrDerived=function(){return this.getSortIndex()===Ft.SORTINDEX_GEOMETRYCOLLECTION||this.getSortIndex()===Ft.SORTINDEX_MULTIPOINT||this.getSortIndex()===Ft.SORTINDEX_MULTILINESTRING||this.getSortIndex()===Ft.SORTINDEX_MULTIPOLYGON};Ft.prototype.interfaces_=function(){return[Cx,ts,ns]};Ft.prototype.getClass=function(){return Ft};Ft.hasNonEmptyElements=function(e){for(var n=0;n<e.length;n++)if(!e[n].isEmpty())return!0;return!1};Ft.hasNullElements=function(e){for(var n=0;n<e.length;n++)if(e[n]===null)return!0;return!1};il.serialVersionUID.get=function(){return 8763622679187377e3};il.SORTINDEX_POINT.get=function(){return 0};il.SORTINDEX_MULTIPOINT.get=function(){return 1};il.SORTINDEX_LINESTRING.get=function(){return 2};il.SORTINDEX_LINEARRING.get=function(){return 3};il.SORTINDEX_MULTILINESTRING.get=function(){return 4};il.SORTINDEX_POLYGON.get=function(){return 5};il.SORTINDEX_MULTIPOLYGON.get=function(){return 6};il.SORTINDEX_GEOMETRYCOLLECTION.get=function(){return 7};il.geometryChangedFilter.get=function(){return RS};Object.defineProperties(Ft,il);var RS=function(){};RS.interfaces_=function(){return[kl]};RS.filter=function(e){e.geometryChangedAction()};var Wa=function(){};Wa.prototype.filter=function(e){};Wa.prototype.interfaces_=function(){return[]};Wa.prototype.getClass=function(){return Wa};var Jo=function(){},Vl={Mod2BoundaryNodeRule:{configurable:!0},EndPointBoundaryNodeRule:{configurable:!0},MultiValentEndPointBoundaryNodeRule:{configurable:!0},MonoValentEndPointBoundaryNodeRule:{configurable:!0},MOD2_BOUNDARY_RULE:{configurable:!0},ENDPOINT_BOUNDARY_RULE:{configurable:!0},MULTIVALENT_ENDPOINT_BOUNDARY_RULE:{configurable:!0},MONOVALENT_ENDPOINT_BOUNDARY_RULE:{configurable:!0},OGC_SFS_BOUNDARY_RULE:{configurable:!0}};Jo.prototype.isInBoundary=function(e){};Jo.prototype.interfaces_=function(){return[]};Jo.prototype.getClass=function(){return Jo};Vl.Mod2BoundaryNodeRule.get=function(){return dd};Vl.EndPointBoundaryNodeRule.get=function(){return md};Vl.MultiValentEndPointBoundaryNodeRule.get=function(){return gd};Vl.MonoValentEndPointBoundaryNodeRule.get=function(){return _d};Vl.MOD2_BOUNDARY_RULE.get=function(){return new dd};Vl.ENDPOINT_BOUNDARY_RULE.get=function(){return new md};Vl.MULTIVALENT_ENDPOINT_BOUNDARY_RULE.get=function(){return new gd};Vl.MONOVALENT_ENDPOINT_BOUNDARY_RULE.get=function(){return new _d};Vl.OGC_SFS_BOUNDARY_RULE.get=function(){return Jo.MOD2_BOUNDARY_RULE};Object.defineProperties(Jo,Vl);var dd=function(){};dd.prototype.isInBoundary=function(e){return e%2===1};dd.prototype.interfaces_=function(){return[Jo]};dd.prototype.getClass=function(){return dd};var md=function(){};md.prototype.isInBoundary=function(e){return e>0};md.prototype.interfaces_=function(){return[Jo]};md.prototype.getClass=function(){return md};var gd=function(){};gd.prototype.isInBoundary=function(e){return e>1};gd.prototype.interfaces_=function(){return[Jo]};gd.prototype.getClass=function(){return gd};var _d=function(){};_d.prototype.isInBoundary=function(e){return e===1};_d.prototype.interfaces_=function(){return[Jo]};_d.prototype.getClass=function(){return _d};var Or=function(){};Or.prototype.add=function(){};Or.prototype.addAll=function(){};Or.prototype.isEmpty=function(){};Or.prototype.iterator=function(){};Or.prototype.size=function(){};Or.prototype.toArray=function(){};Or.prototype.remove=function(){};function NS(t){this.message=t||""}NS.prototype=new Error;NS.prototype.name="IndexOutOfBoundsException";var Fd=function(){};Fd.prototype.hasNext=function(){};Fd.prototype.next=function(){};Fd.prototype.remove=function(){};var gs=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.get=function(){},e.prototype.set=function(){},e.prototype.isEmpty=function(){},e}(Or);function Bd(t){this.message=t||""}Bd.prototype=new Error;Bd.prototype.name="NoSuchElementException";var gt=function(t){function e(){t.call(this),this.array_=[],arguments[0]instanceof Or&&this.addAll(arguments[0])}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.ensureCapacity=function(){},e.prototype.interfaces_=function(){return[t,Or]},e.prototype.add=function(i){return arguments.length===1?this.array_.push(i):this.array_.splice(arguments[0],arguments[1]),!0},e.prototype.clear=function(){this.array_=[]},e.prototype.addAll=function(i){for(var u=this,h=i.iterator();h.hasNext();)u.add(h.next());return!0},e.prototype.set=function(i,u){var h=this.array_[i];return this.array_[i]=u,h},e.prototype.iterator=function(){return new yU(this)},e.prototype.get=function(i){if(i<0||i>=this.size())throw new NS;return this.array_[i]},e.prototype.isEmpty=function(){return this.array_.length===0},e.prototype.size=function(){return this.array_.length},e.prototype.toArray=function(){for(var i=this,u=[],h=0,d=this.array_.length;h<d;h++)u.push(i.array_[h]);return u},e.prototype.remove=function(i){for(var u=this,h=!1,d=0,s=this.array_.length;d<s;d++)if(u.array_[d]===i){u.array_.splice(d,1),h=!0;break}return h},e}(gs),yU=function(t){function e(n){t.call(this),this.arrayList_=n,this.position_=0}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.next=function(){if(this.position_===this.arrayList_.size())throw new Bd;return this.arrayList_.get(this.position_++)},e.prototype.hasNext=function(){return this.position_<this.arrayList_.size()},e.prototype.set=function(i){return this.arrayList_.set(this.position_-1,i)},e.prototype.remove=function(){this.arrayList_.remove(this.arrayList_.get(this.position_))},e}(Fd),V_=function(t){function e(){if(t.call(this),arguments.length!==0){if(arguments.length===1){var i=arguments[0];this.ensureCapacity(i.length),this.add(i,!0)}else if(arguments.length===2){var u=arguments[0],h=arguments[1];this.ensureCapacity(u.length),this.add(u,h)}}}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={coordArrayType:{configurable:!0}};return n.coordArrayType.get=function(){return new Array(0).fill(null)},e.prototype.getCoordinate=function(u){return this.get(u)},e.prototype.addAll=function(){var u=this;if(arguments.length===2){for(var h=arguments[0],d=arguments[1],s=!1,w=h.iterator();w.hasNext();)u.add(w.next(),d),s=!0;return s}else return t.prototype.addAll.apply(this,arguments)},e.prototype.clone=function(){for(var u=this,h=t.prototype.clone.call(this),d=0;d<this.size();d++)h.add(d,u.get(d).copy());return h},e.prototype.toCoordinateArray=function(){return this.toArray(e.coordArrayType)},e.prototype.add=function(){var u=this;if(arguments.length===1){var h=arguments[0];t.prototype.add.call(this,h)}else if(arguments.length===2){if(arguments[0]instanceof Array&&typeof arguments[1]=="boolean"){var d=arguments[0],s=arguments[1];return this.add(d,s,!0),!0}else if(arguments[0]instanceof Me&&typeof arguments[1]=="boolean"){var w=arguments[0],T=arguments[1];if(!T&&this.size()>=1){var A=this.get(this.size()-1);if(A.equals2D(w))return null}t.prototype.add.call(this,w)}else if(arguments[0]instanceof Object&&typeof arguments[1]=="boolean"){var D=arguments[0],R=arguments[1];return this.add(D,R),!0}}else if(arguments.length===3){if(typeof arguments[2]=="boolean"&&arguments[0]instanceof Array&&typeof arguments[1]=="boolean"){var G=arguments[0],$=arguments[1],ie=arguments[2];if(ie)for(var _e=0;_e<G.length;_e++)u.add(G[_e],$);else for(var Y=G.length-1;Y>=0;Y--)u.add(G[Y],$);return!0}else if(typeof arguments[2]=="boolean"&&Number.isInteger(arguments[0])&&arguments[1]instanceof Me){var B=arguments[0],q=arguments[1],oe=arguments[2];if(!oe){var de=this.size();if(de>0){if(B>0){var we=this.get(B-1);if(we.equals2D(q))return null}if(B<de){var Se=this.get(B);if(Se.equals2D(q))return null}}}t.prototype.add.call(this,B,q)}}else if(arguments.length===4){var Te=arguments[0],xe=arguments[1],et=arguments[2],We=arguments[3],He=1;et>We&&(He=-1);for(var $e=et;$e!==We;$e+=He)u.add(Te[$e],xe);return!0}},e.prototype.closeRing=function(){this.size()>0&&this.add(new Me(this.get(0)),!1)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},Object.defineProperties(e,n),e}(gt),un=function(){},Mx={ForwardComparator:{configurable:!0},BidirectionalComparator:{configurable:!0},coordArrayType:{configurable:!0}};Mx.ForwardComparator.get=function(){return y_};Mx.BidirectionalComparator.get=function(){return yd};Mx.coordArrayType.get=function(){return new Array(0).fill(null)};un.prototype.interfaces_=function(){return[]};un.prototype.getClass=function(){return un};un.isRing=function(e){return!(e.length<4||!e[0].equals2D(e[e.length-1]))};un.ptNotInList=function(e,n){for(var i=0;i<e.length;i++){var u=e[i];if(un.indexOf(u,n)<0)return u}return null};un.scroll=function(e,n){var i=un.indexOf(n,e);if(i<0)return null;var u=new Array(e.length).fill(null);li.arraycopy(e,i,u,0,e.length-i),li.arraycopy(e,0,u,e.length-i,i),li.arraycopy(u,0,e,0,e.length)};un.equals=function(){if(arguments.length===2){var e=arguments[0],n=arguments[1];if(e===n)return!0;if(e===null||n===null||e.length!==n.length)return!1;for(var i=0;i<e.length;i++)if(!e[i].equals(n[i]))return!1;return!0}else if(arguments.length===3){var u=arguments[0],h=arguments[1],d=arguments[2];if(u===h)return!0;if(u===null||h===null||u.length!==h.length)return!1;for(var s=0;s<u.length;s++)if(d.compare(u[s],h[s])!==0)return!1;return!0}};un.intersection=function(e,n){for(var i=new V_,u=0;u<e.length;u++)n.intersects(e[u])&&i.add(e[u],!0);return i.toCoordinateArray()};un.hasRepeatedPoints=function(e){for(var n=1;n<e.length;n++)if(e[n-1].equals(e[n]))return!0;return!1};un.removeRepeatedPoints=function(e){if(!un.hasRepeatedPoints(e))return e;var n=new V_(e,!1);return n.toCoordinateArray()};un.reverse=function(e){for(var n=e.length-1,i=Math.trunc(n/2),u=0;u<=i;u++){var h=e[u];e[u]=e[n-u],e[n-u]=h}};un.removeNull=function(e){for(var n=0,i=0;i<e.length;i++)e[i]!==null&&n++;var u=new Array(n).fill(null);if(n===0)return u;for(var h=0,d=0;d<e.length;d++)e[d]!==null&&(u[h++]=e[d]);return u};un.copyDeep=function(){if(arguments.length===1){for(var e=arguments[0],n=new Array(e.length).fill(null),i=0;i<e.length;i++)n[i]=new Me(e[i]);return n}else if(arguments.length===5)for(var u=arguments[0],h=arguments[1],d=arguments[2],s=arguments[3],w=arguments[4],T=0;T<w;T++)d[s+T]=new Me(u[h+T])};un.isEqualReversed=function(e,n){for(var i=0;i<e.length;i++){var u=e[i],h=n[e.length-i-1];if(u.compareTo(h)!==0)return!1}return!0};un.envelope=function(e){for(var n=new Dt,i=0;i<e.length;i++)n.expandToInclude(e[i]);return n};un.toCoordinateArray=function(e){return e.toArray(un.coordArrayType)};un.atLeastNCoordinatesOrNothing=function(e,n){return n.length>=e?n:[]};un.indexOf=function(e,n){for(var i=0;i<n.length;i++)if(e.equals(n[i]))return i;return-1};un.increasingDirection=function(e){for(var n=0;n<Math.trunc(e.length/2);n++){var i=e.length-1-n,u=e[n].compareTo(e[i]);if(u!==0)return u}return 1};un.compare=function(e,n){for(var i=0;i<e.length&&i<n.length;){var u=e[i].compareTo(n[i]);if(u!==0)return u;i++}return i<n.length?-1:i<e.length?1:0};un.minCoordinate=function(e){for(var n=null,i=0;i<e.length;i++)(n===null||n.compareTo(e[i])>0)&&(n=e[i]);return n};un.extract=function(e,n,i){n=Eo.clamp(n,0,e.length),i=Eo.clamp(i,-1,e.length);var u=i-n+1;i<0&&(u=0),n>=e.length&&(u=0),i<n&&(u=0);var h=new Array(u).fill(null);if(u===0)return h;for(var d=0,s=n;s<=i;s++)h[d++]=e[s];return h};Object.defineProperties(un,Mx);var y_=function(){};y_.prototype.compare=function(e,n){var i=e,u=n;return un.compare(i,u)};y_.prototype.interfaces_=function(){return[fd]};y_.prototype.getClass=function(){return y_};var yd=function(){};yd.prototype.compare=function(e,n){var i=e,u=n;if(i.length<u.length)return-1;if(i.length>u.length)return 1;if(i.length===0)return 0;var h=un.compare(i,u),d=un.isEqualReversed(i,u);return d?0:h};yd.prototype.OLDcompare=function(e,n){var i=e,u=n;if(i.length<u.length)return-1;if(i.length>u.length)return 1;if(i.length===0)return 0;for(var h=un.increasingDirection(i),d=un.increasingDirection(u),s=h>0?0:i.length-1,w=d>0?0:i.length-1,T=0;T<i.length;T++){var A=i[s].compareTo(u[w]);if(A!==0)return A;s+=h,w+=d}return 0};yd.prototype.interfaces_=function(){return[fd]};yd.prototype.getClass=function(){return yd};var Mf=function(){};Mf.prototype.get=function(){};Mf.prototype.put=function(){};Mf.prototype.size=function(){};Mf.prototype.values=function(){};Mf.prototype.entrySet=function(){};var vU=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(Mf);function j_(t){this.message=t||""}j_.prototype=new Error;j_.prototype.name="OperationNotSupported";function Ax(){}Ax.prototype=new Or;Ax.prototype.contains=function(){};var kS=function(t){function e(){t.call(this),this.array_=[],arguments[0]instanceof Or&&this.addAll(arguments[0])}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.contains=function(i){for(var u=this,h=0,d=this.array_.length;h<d;h++){var s=u.array_[h];if(s===i)return!0}return!1},e.prototype.add=function(i){return this.contains(i)?!1:(this.array_.push(i),!0)},e.prototype.addAll=function(i){for(var u=this,h=i.iterator();h.hasNext();)u.add(h.next());return!0},e.prototype.remove=function(i){throw new Error},e.prototype.size=function(){return this.array_.length},e.prototype.isEmpty=function(){return this.array_.length===0},e.prototype.toArray=function(){for(var i=this,u=[],h=0,d=this.array_.length;h<d;h++)u.push(i.array_[h]);return u},e.prototype.iterator=function(){return new xU(this)},e}(Ax),xU=function(t){function e(n){t.call(this),this.hashSet_=n,this.position_=0}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.next=function(){if(this.position_===this.hashSet_.size())throw new Bd;return this.hashSet_.array_[this.position_++]},e.prototype.hasNext=function(){return this.position_<this.hashSet_.size()},e.prototype.remove=function(){throw new j_},e}(Fd),Il=0,yc=1;function _M(t){return t===null?Il:t.color}function Xn(t){return t===null?null:t.parent}function El(t,e){t!==null&&(t.color=e)}function Jw(t){return t===null?null:t.left}function yM(t){return t===null?null:t.right}function yi(){this.root_=null,this.size_=0}yi.prototype=new vU;yi.prototype.get=function(t){for(var e=this.root_;e!==null;){var n=t.compareTo(e.key);if(n<0)e=e.left;else if(n>0)e=e.right;else return e.value}return null};yi.prototype.put=function(t,e){if(this.root_===null)return this.root_={key:t,value:e,left:null,right:null,parent:null,color:Il,getValue:function(){return this.value},getKey:function(){return this.key}},this.size_=1,null;var n=this.root_,i,u;do if(i=n,u=t.compareTo(n.key),u<0)n=n.left;else if(u>0)n=n.right;else{var h=n.value;return n.value=e,h}while(n!==null);var d={key:t,left:null,right:null,value:e,parent:i,color:Il,getValue:function(){return this.value},getKey:function(){return this.key}};return u<0?i.left=d:i.right=d,this.fixAfterInsertion(d),this.size_++,null};yi.prototype.fixAfterInsertion=function(t){var e=this;for(t.color=yc;t!=null&&t!==this.root_&&t.parent.color===yc;)if(Xn(t)===Jw(Xn(Xn(t)))){var n=yM(Xn(Xn(t)));_M(n)===yc?(El(Xn(t),Il),El(n,Il),El(Xn(Xn(t)),yc),t=Xn(Xn(t))):(t===yM(Xn(t))&&(t=Xn(t),e.rotateLeft(t)),El(Xn(t),Il),El(Xn(Xn(t)),yc),e.rotateRight(Xn(Xn(t))))}else{var i=Jw(Xn(Xn(t)));_M(i)===yc?(El(Xn(t),Il),El(i,Il),El(Xn(Xn(t)),yc),t=Xn(Xn(t))):(t===Jw(Xn(t))&&(t=Xn(t),e.rotateRight(t)),El(Xn(t),Il),El(Xn(Xn(t)),yc),e.rotateLeft(Xn(Xn(t))))}this.root_.color=Il};yi.prototype.values=function(){var t=new gt,e=this.getFirstEntry();if(e!==null)for(t.add(e.value);(e=yi.successor(e))!==null;)t.add(e.value);return t};yi.prototype.entrySet=function(){var t=new kS,e=this.getFirstEntry();if(e!==null)for(t.add(e);(e=yi.successor(e))!==null;)t.add(e);return t};yi.prototype.rotateLeft=function(t){if(t!=null){var e=t.right;t.right=e.left,e.left!=null&&(e.left.parent=t),e.parent=t.parent,t.parent===null?this.root_=e:t.parent.left===t?t.parent.left=e:t.parent.right=e,e.left=t,t.parent=e}};yi.prototype.rotateRight=function(t){if(t!=null){var e=t.left;t.left=e.right,e.right!=null&&(e.right.parent=t),e.parent=t.parent,t.parent===null?this.root_=e:t.parent.right===t?t.parent.right=e:t.parent.left=e,e.right=t,t.parent=e}};yi.prototype.getFirstEntry=function(){var t=this.root_;if(t!=null)for(;t.left!=null;)t=t.left;return t};yi.successor=function(t){if(t===null)return null;if(t.right!==null){for(var e=t.right;e.left!==null;)e=e.left;return e}else{for(var n=t.parent,i=t;n!==null&&i===n.right;)i=n,n=n.parent;return n}};yi.prototype.size=function(){return this.size_};var v_=function(){};v_.prototype.interfaces_=function(){return[]};v_.prototype.getClass=function(){return v_};function eD(){}eD.prototype=new Ax;function ta(){this.array_=[],arguments[0]instanceof Or&&this.addAll(arguments[0])}ta.prototype=new eD;ta.prototype.contains=function(t){for(var e=this,n=0,i=this.array_.length;n<i;n++){var u=e.array_[n];if(u.compareTo(t)===0)return!0}return!1};ta.prototype.add=function(t){var e=this;if(this.contains(t))return!1;for(var n=0,i=this.array_.length;n<i;n++){var u=e.array_[n];if(u.compareTo(t)===1)return e.array_.splice(n,0,t),!0}return this.array_.push(t),!0};ta.prototype.addAll=function(t){for(var e=this,n=t.iterator();n.hasNext();)e.add(n.next());return!0};ta.prototype.remove=function(t){throw new j_};ta.prototype.size=function(){return this.array_.length};ta.prototype.isEmpty=function(){return this.array_.length===0};ta.prototype.toArray=function(){for(var t=this,e=[],n=0,i=this.array_.length;n<i;n++)e.push(t.array_[n]);return e};ta.prototype.iterator=function(){return new Px(this)};var Px=function(t){this.treeSet_=t,this.position_=0};Px.prototype.next=function(){if(this.position_===this.treeSet_.size())throw new Bd;return this.treeSet_.array_[this.position_++]};Px.prototype.hasNext=function(){return this.position_<this.treeSet_.size()};Px.prototype.remove=function(){throw new j_};var Nc=function(){};Nc.sort=function(){var e=arguments[0],n,i,u,h;if(arguments.length===1)h=function(s,w){return s.compareTo(w)},e.sort(h);else if(arguments.length===2)u=arguments[1],h=function(s,w){return u.compare(s,w)},e.sort(h);else if(arguments.length===3){i=e.slice(arguments[1],arguments[2]),i.sort();var d=e.slice(0,arguments[1]).concat(i,e.slice(arguments[2],e.length));for(e.splice(0,e.length),n=0;n<d.length;n++)e.push(d[n])}else if(arguments.length===4)for(i=e.slice(arguments[1],arguments[2]),u=arguments[3],h=function(s,w){return u.compare(s,w)},i.sort(h),d=e.slice(0,arguments[1]).concat(i,e.slice(arguments[2],e.length)),e.splice(0,e.length),n=0;n<d.length;n++)e.push(d[n])};Nc.asList=function(e){for(var n=new gt,i=0,u=e.length;i<u;i++)n.add(e[i]);return n};var xn=function(){},Ps={P:{configurable:!0},L:{configurable:!0},A:{configurable:!0},FALSE:{configurable:!0},TRUE:{configurable:!0},DONTCARE:{configurable:!0},SYM_FALSE:{configurable:!0},SYM_TRUE:{configurable:!0},SYM_DONTCARE:{configurable:!0},SYM_P:{configurable:!0},SYM_L:{configurable:!0},SYM_A:{configurable:!0}};Ps.P.get=function(){return 0};Ps.L.get=function(){return 1};Ps.A.get=function(){return 2};Ps.FALSE.get=function(){return-1};Ps.TRUE.get=function(){return-2};Ps.DONTCARE.get=function(){return-3};Ps.SYM_FALSE.get=function(){return"F"};Ps.SYM_TRUE.get=function(){return"T"};Ps.SYM_DONTCARE.get=function(){return"*"};Ps.SYM_P.get=function(){return"0"};Ps.SYM_L.get=function(){return"1"};Ps.SYM_A.get=function(){return"2"};xn.prototype.interfaces_=function(){return[]};xn.prototype.getClass=function(){return xn};xn.toDimensionSymbol=function(e){switch(e){case xn.FALSE:return xn.SYM_FALSE;case xn.TRUE:return xn.SYM_TRUE;case xn.DONTCARE:return xn.SYM_DONTCARE;case xn.P:return xn.SYM_P;case xn.L:return xn.SYM_L;case xn.A:return xn.SYM_A}throw new er("Unknown dimension value: "+e)};xn.toDimensionValue=function(e){switch(__.toUpperCase(e)){case xn.SYM_FALSE:return xn.FALSE;case xn.SYM_TRUE:return xn.TRUE;case xn.SYM_DONTCARE:return xn.DONTCARE;case xn.SYM_P:return xn.P;case xn.SYM_L:return xn.L;case xn.SYM_A:return xn.A}throw new er("Unknown dimension symbol: "+e)};Object.defineProperties(xn,Ps);var na=function(){};na.prototype.filter=function(e){};na.prototype.interfaces_=function(){return[]};na.prototype.getClass=function(){return na};var ws=function(){};ws.prototype.filter=function(e,n){};ws.prototype.isDone=function(){};ws.prototype.isGeometryChanged=function(){};ws.prototype.interfaces_=function(){return[]};ws.prototype.getClass=function(){return ws};var Ri=function(t){function e(i,u){if(t.call(this,u),this._geometries=i||[],t.hasNullElements(this._geometries))throw new er("geometries must not contain null elements")}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={serialVersionUID:{configurable:!0}};return e.prototype.computeEnvelopeInternal=function(){for(var u=this,h=new Dt,d=0;d<this._geometries.length;d++)h.expandToInclude(u._geometries[d].getEnvelopeInternal());return h},e.prototype.getGeometryN=function(u){return this._geometries[u]},e.prototype.getSortIndex=function(){return t.SORTINDEX_GEOMETRYCOLLECTION},e.prototype.getCoordinates=function(){for(var u=this,h=new Array(this.getNumPoints()).fill(null),d=-1,s=0;s<this._geometries.length;s++)for(var w=u._geometries[s].getCoordinates(),T=0;T<w.length;T++)d++,h[d]=w[T];return h},e.prototype.getArea=function(){for(var u=this,h=0,d=0;d<this._geometries.length;d++)h+=u._geometries[d].getArea();return h},e.prototype.equalsExact=function(){var u=this;if(arguments.length===2){var h=arguments[0],d=arguments[1];if(!this.isEquivalentClass(h))return!1;var s=h;if(this._geometries.length!==s._geometries.length)return!1;for(var w=0;w<this._geometries.length;w++)if(!u._geometries[w].equalsExact(s._geometries[w],d))return!1;return!0}else return t.prototype.equalsExact.apply(this,arguments)},e.prototype.normalize=function(){for(var u=this,h=0;h<this._geometries.length;h++)u._geometries[h].normalize();Nc.sort(this._geometries)},e.prototype.getCoordinate=function(){return this.isEmpty()?null:this._geometries[0].getCoordinate()},e.prototype.getBoundaryDimension=function(){for(var u=this,h=xn.FALSE,d=0;d<this._geometries.length;d++)h=Math.max(h,u._geometries[d].getBoundaryDimension());return h},e.prototype.getDimension=function(){for(var u=this,h=xn.FALSE,d=0;d<this._geometries.length;d++)h=Math.max(h,u._geometries[d].getDimension());return h},e.prototype.getLength=function(){for(var u=this,h=0,d=0;d<this._geometries.length;d++)h+=u._geometries[d].getLength();return h},e.prototype.getNumPoints=function(){for(var u=this,h=0,d=0;d<this._geometries.length;d++)h+=u._geometries[d].getNumPoints();return h},e.prototype.getNumGeometries=function(){return this._geometries.length},e.prototype.reverse=function(){for(var u=this,h=this._geometries.length,d=new Array(h).fill(null),s=0;s<this._geometries.length;s++)d[s]=u._geometries[s].reverse();return this.getFactory().createGeometryCollection(d)},e.prototype.compareToSameClass=function(){var u=this;if(arguments.length===1){var h=arguments[0],d=new ta(Nc.asList(this._geometries)),s=new ta(Nc.asList(h._geometries));return this.compare(d,s)}else if(arguments.length===2){for(var w=arguments[0],T=arguments[1],A=w,D=this.getNumGeometries(),R=A.getNumGeometries(),G=0;G<D&&G<R;){var $=u.getGeometryN(G),ie=A.getGeometryN(G),_e=$.compareToSameClass(ie,T);if(_e!==0)return _e;G++}return G<D?1:G<R?-1:0}},e.prototype.apply=function(){var u=this;if(Ut(arguments[0],Wa))for(var h=arguments[0],d=0;d<this._geometries.length;d++)u._geometries[d].apply(h);else if(Ut(arguments[0],ws)){var s=arguments[0];if(this._geometries.length===0)return null;for(var w=0;w<this._geometries.length&&(u._geometries[w].apply(s),!s.isDone());w++);s.isGeometryChanged()&&this.geometryChanged()}else if(Ut(arguments[0],na)){var T=arguments[0];T.filter(this);for(var A=0;A<this._geometries.length;A++)u._geometries[A].apply(T)}else if(Ut(arguments[0],kl)){var D=arguments[0];D.filter(this);for(var R=0;R<this._geometries.length;R++)u._geometries[R].apply(D)}},e.prototype.getBoundary=function(){return this.checkNotGeometryCollection(this),Qt.shouldNeverReachHere(),null},e.prototype.clone=function(){var u=this,h=t.prototype.clone.call(this);h._geometries=new Array(this._geometries.length).fill(null);for(var d=0;d<this._geometries.length;d++)h._geometries[d]=u._geometries[d].clone();return h},e.prototype.getGeometryType=function(){return"GeometryCollection"},e.prototype.copy=function(){for(var u=this,h=new Array(this._geometries.length).fill(null),d=0;d<h.length;d++)h[d]=u._geometries[d].copy();return new e(h,this._factory)},e.prototype.isEmpty=function(){for(var u=this,h=0;h<this._geometries.length;h++)if(!u._geometries[h].isEmpty())return!1;return!0},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},n.serialVersionUID.get=function(){return-5694727726395021e3},Object.defineProperties(e,n),e}(Ft),Fc=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={serialVersionUID:{configurable:!0}};return e.prototype.getSortIndex=function(){return Ft.SORTINDEX_MULTILINESTRING},e.prototype.equalsExact=function(){if(arguments.length===2){var u=arguments[0],h=arguments[1];return this.isEquivalentClass(u)?t.prototype.equalsExact.call(this,u,h):!1}else return t.prototype.equalsExact.apply(this,arguments)},e.prototype.getBoundaryDimension=function(){return this.isClosed()?xn.FALSE:0},e.prototype.isClosed=function(){var u=this;if(this.isEmpty())return!1;for(var h=0;h<this._geometries.length;h++)if(!u._geometries[h].isClosed())return!1;return!0},e.prototype.getDimension=function(){return 1},e.prototype.reverse=function(){for(var u=this,h=this._geometries.length,d=new Array(h).fill(null),s=0;s<this._geometries.length;s++)d[h-1-s]=u._geometries[s].reverse();return this.getFactory().createMultiLineString(d)},e.prototype.getBoundary=function(){return new Ho(this).getBoundary()},e.prototype.getGeometryType=function(){return"MultiLineString"},e.prototype.copy=function(){for(var u=this,h=new Array(this._geometries.length).fill(null),d=0;d<h.length;d++)h[d]=u._geometries[d].copy();return new e(h,this._factory)},e.prototype.interfaces_=function(){return[v_]},e.prototype.getClass=function(){return e},n.serialVersionUID.get=function(){return 8166665132445434e3},Object.defineProperties(e,n),e}(Ri),Ho=function(){if(this._geom=null,this._geomFact=null,this._bnRule=null,this._endpointMap=null,arguments.length===1){var e=arguments[0],n=Jo.MOD2_BOUNDARY_RULE;this._geom=e,this._geomFact=e.getFactory(),this._bnRule=n}else if(arguments.length===2){var i=arguments[0],u=arguments[1];this._geom=i,this._geomFact=i.getFactory(),this._bnRule=u}};Ho.prototype.boundaryMultiLineString=function(e){if(this._geom.isEmpty())return this.getEmptyMultiPoint();var n=this.computeBoundaryCoordinates(e);return n.length===1?this._geomFact.createPoint(n[0]):this._geomFact.createMultiPointFromCoords(n)};Ho.prototype.getBoundary=function(){return this._geom instanceof cr?this.boundaryLineString(this._geom):this._geom instanceof Fc?this.boundaryMultiLineString(this._geom):this._geom.getBoundary()};Ho.prototype.boundaryLineString=function(e){if(this._geom.isEmpty())return this.getEmptyMultiPoint();if(e.isClosed()){var n=this._bnRule.isInBoundary(2);return n?e.getStartPoint():this._geomFact.createMultiPoint()}return this._geomFact.createMultiPoint([e.getStartPoint(),e.getEndPoint()])};Ho.prototype.getEmptyMultiPoint=function(){return this._geomFact.createMultiPoint()};Ho.prototype.computeBoundaryCoordinates=function(e){var n=this,i=new gt;this._endpointMap=new yi;for(var u=0;u<e.getNumGeometries();u++){var h=e.getGeometryN(u);h.getNumPoints()!==0&&(n.addEndpoint(h.getCoordinateN(0)),n.addEndpoint(h.getCoordinateN(h.getNumPoints()-1)))}for(var d=this._endpointMap.entrySet().iterator();d.hasNext();){var s=d.next(),w=s.getValue(),T=w.count;n._bnRule.isInBoundary(T)&&i.add(s.getKey())}return un.toCoordinateArray(i)};Ho.prototype.addEndpoint=function(e){var n=this._endpointMap.get(e);n===null&&(n=new Y0,this._endpointMap.put(e,n)),n.count++};Ho.prototype.interfaces_=function(){return[]};Ho.prototype.getClass=function(){return Ho};Ho.getBoundary=function(){if(arguments.length===1){var e=arguments[0],n=new Ho(e);return n.getBoundary()}else if(arguments.length===2){var i=arguments[0],u=arguments[1],h=new Ho(i,u);return h.getBoundary()}};var Y0=function(){this.count=null};Y0.prototype.interfaces_=function(){return[]};Y0.prototype.getClass=function(){return Y0};function wU(){}function bU(){}var EU=function(){};function SU(){}function TU(){}function CU(){}var Yo=function(){},OS={NEWLINE:{configurable:!0},SIMPLE_ORDINATE_FORMAT:{configurable:!0}};Yo.prototype.interfaces_=function(){return[]};Yo.prototype.getClass=function(){return Yo};Yo.chars=function(e,n){for(var i=new Array(n).fill(null),u=0;u<n;u++)i[u]=e;return String(i)};Yo.getStackTrace=function(){if(arguments.length===1){var e=arguments[0],n=new SU,i=new wU;return e.printStackTrace(i),n.toString()}else if(arguments.length===2){var u=arguments[0],h=arguments[1],d="";new bU(Yo.getStackTrace(u));for(var s=new CU,w=0;w<h;w++)try{d+=s.readLine()+Yo.NEWLINE}catch(T){if(T instanceof TU)Qt.shouldNeverReachHere();else throw T}finally{}return d}};Yo.split=function(e,n){for(var i=n.length,u=new gt,h=""+e,d=h.indexOf(n);d>=0;){var s=h.substring(0,d);u.add(s),h=h.substring(d+i),d=h.indexOf(n)}h.length>0&&u.add(h);for(var w=new Array(u.size()).fill(null),T=0;T<w.length;T++)w[T]=u.get(T);return w};Yo.toString=function(){if(arguments.length===1){var e=arguments[0];return Yo.SIMPLE_ORDINATE_FORMAT.format(e)}};Yo.spaces=function(e){return Yo.chars(" ",e)};OS.NEWLINE.get=function(){return li.getProperty("line.separator")};OS.SIMPLE_ORDINATE_FORMAT.get=function(){return new EU};Object.defineProperties(Yo,OS);var yr=function(){};yr.prototype.interfaces_=function(){return[]};yr.prototype.getClass=function(){return yr};yr.copyCoord=function(e,n,i,u){for(var h=Math.min(e.getDimension(),i.getDimension()),d=0;d<h;d++)i.setOrdinate(u,d,e.getOrdinate(n,d))};yr.isRing=function(e){var n=e.size();return n===0?!0:n<=3?!1:e.getOrdinate(0,dn.X)===e.getOrdinate(n-1,dn.X)&&e.getOrdinate(0,dn.Y)===e.getOrdinate(n-1,dn.Y)};yr.isEqual=function(e,n){var i=e.size(),u=n.size();if(i!==u)return!1;for(var h=Math.min(e.getDimension(),n.getDimension()),d=0;d<i;d++)for(var s=0;s<h;s++){var w=e.getOrdinate(d,s),T=n.getOrdinate(d,s);if(e.getOrdinate(d,s)!==n.getOrdinate(d,s)&&!(Gt.isNaN(w)&&Gt.isNaN(T)))return!1}return!0};yr.extend=function(e,n,i){var u=e.create(i,n.getDimension()),h=n.size();if(yr.copy(n,0,u,0,h),h>0)for(var d=h;d<i;d++)yr.copy(n,h-1,u,d,1);return u};yr.reverse=function(e){for(var n=e.size()-1,i=Math.trunc(n/2),u=0;u<=i;u++)yr.swap(e,u,n-u)};yr.swap=function(e,n,i){if(n===i)return null;for(var u=0;u<e.getDimension();u++){var h=e.getOrdinate(n,u);e.setOrdinate(n,u,e.getOrdinate(i,u)),e.setOrdinate(i,u,h)}};yr.copy=function(e,n,i,u,h){for(var d=0;d<h;d++)yr.copyCoord(e,n+d,i,u+d)};yr.toString=function(){if(arguments.length===1){var e=arguments[0],n=e.size();if(n===0)return"()";var i=e.getDimension(),u=new ca;u.append("(");for(var h=0;h<n;h++){h>0&&u.append(" ");for(var d=0;d<i;d++)d>0&&u.append(","),u.append(Yo.toString(e.getOrdinate(h,d)))}return u.append(")"),u.toString()}};yr.ensureValidRing=function(e,n){var i=n.size();if(i===0)return n;if(i<=3)return yr.createClosedRing(e,n,4);var u=n.getOrdinate(0,dn.X)===n.getOrdinate(i-1,dn.X)&&n.getOrdinate(0,dn.Y)===n.getOrdinate(i-1,dn.Y);return u?n:yr.createClosedRing(e,n,i+1)};yr.createClosedRing=function(e,n,i){var u=e.create(i,n.getDimension()),h=n.size();yr.copy(n,0,u,0,h);for(var d=h;d<i;d++)yr.copy(n,0,u,d,1);return u};var cr=function(t){function e(i,u){t.call(this,u),this._points=null,this.init(i)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={serialVersionUID:{configurable:!0}};return e.prototype.computeEnvelopeInternal=function(){return this.isEmpty()?new Dt:this._points.expandEnvelope(new Dt)},e.prototype.isRing=function(){return this.isClosed()&&this.isSimple()},e.prototype.getSortIndex=function(){return t.SORTINDEX_LINESTRING},e.prototype.getCoordinates=function(){return this._points.toCoordinateArray()},e.prototype.equalsExact=function(){var u=this;if(arguments.length===2){var h=arguments[0],d=arguments[1];if(!this.isEquivalentClass(h))return!1;var s=h;if(this._points.size()!==s._points.size())return!1;for(var w=0;w<this._points.size();w++)if(!u.equal(u._points.getCoordinate(w),s._points.getCoordinate(w),d))return!1;return!0}else return t.prototype.equalsExact.apply(this,arguments)},e.prototype.normalize=function(){for(var u=this,h=0;h<Math.trunc(this._points.size()/2);h++){var d=u._points.size()-1-h;if(!u._points.getCoordinate(h).equals(u._points.getCoordinate(d)))return u._points.getCoordinate(h).compareTo(u._points.getCoordinate(d))>0&&yr.reverse(u._points),null}},e.prototype.getCoordinate=function(){return this.isEmpty()?null:this._points.getCoordinate(0)},e.prototype.getBoundaryDimension=function(){return this.isClosed()?xn.FALSE:0},e.prototype.isClosed=function(){return this.isEmpty()?!1:this.getCoordinateN(0).equals2D(this.getCoordinateN(this.getNumPoints()-1))},e.prototype.getEndPoint=function(){return this.isEmpty()?null:this.getPointN(this.getNumPoints()-1)},e.prototype.getDimension=function(){return 1},e.prototype.getLength=function(){return wt.computeLength(this._points)},e.prototype.getNumPoints=function(){return this._points.size()},e.prototype.reverse=function(){var u=this._points.copy();yr.reverse(u);var h=this.getFactory().createLineString(u);return h},e.prototype.compareToSameClass=function(){var u=this;if(arguments.length===1){for(var h=arguments[0],d=h,s=0,w=0;s<this._points.size()&&w<d._points.size();){var T=u._points.getCoordinate(s).compareTo(d._points.getCoordinate(w));if(T!==0)return T;s++,w++}return s<this._points.size()?1:w<d._points.size()?-1:0}else if(arguments.length===2){var A=arguments[0],D=arguments[1],R=A;return D.compare(this._points,R._points)}},e.prototype.apply=function(){var u=this;if(Ut(arguments[0],Wa))for(var h=arguments[0],d=0;d<this._points.size();d++)h.filter(u._points.getCoordinate(d));else if(Ut(arguments[0],ws)){var s=arguments[0];if(this._points.size()===0)return null;for(var w=0;w<this._points.size()&&(s.filter(u._points,w),!s.isDone());w++);s.isGeometryChanged()&&this.geometryChanged()}else if(Ut(arguments[0],na)){var T=arguments[0];T.filter(this)}else if(Ut(arguments[0],kl)){var A=arguments[0];A.filter(this)}},e.prototype.getBoundary=function(){return new Ho(this).getBoundary()},e.prototype.isEquivalentClass=function(u){return u instanceof e},e.prototype.clone=function(){var u=t.prototype.clone.call(this);return u._points=this._points.clone(),u},e.prototype.getCoordinateN=function(u){return this._points.getCoordinate(u)},e.prototype.getGeometryType=function(){return"LineString"},e.prototype.copy=function(){return new e(this._points.copy(),this._factory)},e.prototype.getCoordinateSequence=function(){return this._points},e.prototype.isEmpty=function(){return this._points.size()===0},e.prototype.init=function(u){if(u===null&&(u=this.getFactory().getCoordinateSequenceFactory().create([])),u.size()===1)throw new er("Invalid number of points in LineString (found "+u.size()+" - must be 0 or >= 2)");this._points=u},e.prototype.isCoordinate=function(u){for(var h=this,d=0;d<this._points.size();d++)if(h._points.getCoordinate(d).equals(u))return!0;return!1},e.prototype.getStartPoint=function(){return this.isEmpty()?null:this.getPointN(0)},e.prototype.getPointN=function(u){return this.getFactory().createPoint(this._points.getCoordinate(u))},e.prototype.interfaces_=function(){return[v_]},e.prototype.getClass=function(){return e},n.serialVersionUID.get=function(){return 0x2b2b51ba435c8e00},Object.defineProperties(e,n),e}(Ft),x_=function(){};x_.prototype.interfaces_=function(){return[]};x_.prototype.getClass=function(){return x_};var lo=function(t){function e(i,u){t.call(this,u),this._coordinates=i||null,this.init(this._coordinates)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={serialVersionUID:{configurable:!0}};return e.prototype.computeEnvelopeInternal=function(){if(this.isEmpty())return new Dt;var u=new Dt;return u.expandToInclude(this._coordinates.getX(0),this._coordinates.getY(0)),u},e.prototype.getSortIndex=function(){return t.SORTINDEX_POINT},e.prototype.getCoordinates=function(){return this.isEmpty()?[]:[this.getCoordinate()]},e.prototype.equalsExact=function(){if(arguments.length===2){var u=arguments[0],h=arguments[1];return this.isEquivalentClass(u)?this.isEmpty()&&u.isEmpty()?!0:this.isEmpty()!==u.isEmpty()?!1:this.equal(u.getCoordinate(),this.getCoordinate(),h):!1}else return t.prototype.equalsExact.apply(this,arguments)},e.prototype.normalize=function(){},e.prototype.getCoordinate=function(){return this._coordinates.size()!==0?this._coordinates.getCoordinate(0):null},e.prototype.getBoundaryDimension=function(){return xn.FALSE},e.prototype.getDimension=function(){return 0},e.prototype.getNumPoints=function(){return this.isEmpty()?0:1},e.prototype.reverse=function(){return this.copy()},e.prototype.getX=function(){if(this.getCoordinate()===null)throw new Error("getX called on empty Point");return this.getCoordinate().x},e.prototype.compareToSameClass=function(){if(arguments.length===1){var u=arguments[0],h=u;return this.getCoordinate().compareTo(h.getCoordinate())}else if(arguments.length===2){var d=arguments[0],s=arguments[1],w=d;return s.compare(this._coordinates,w._coordinates)}},e.prototype.apply=function(){if(Ut(arguments[0],Wa)){var u=arguments[0];if(this.isEmpty())return null;u.filter(this.getCoordinate())}else if(Ut(arguments[0],ws)){var h=arguments[0];if(this.isEmpty())return null;h.filter(this._coordinates,0),h.isGeometryChanged()&&this.geometryChanged()}else if(Ut(arguments[0],na)){var d=arguments[0];d.filter(this)}else if(Ut(arguments[0],kl)){var s=arguments[0];s.filter(this)}},e.prototype.getBoundary=function(){return this.getFactory().createGeometryCollection(null)},e.prototype.clone=function(){var u=t.prototype.clone.call(this);return u._coordinates=this._coordinates.clone(),u},e.prototype.getGeometryType=function(){return"Point"},e.prototype.copy=function(){return new e(this._coordinates.copy(),this._factory)},e.prototype.getCoordinateSequence=function(){return this._coordinates},e.prototype.getY=function(){if(this.getCoordinate()===null)throw new Error("getY called on empty Point");return this.getCoordinate().y},e.prototype.isEmpty=function(){return this._coordinates.size()===0},e.prototype.init=function(u){u===null&&(u=this.getFactory().getCoordinateSequenceFactory().create([])),Qt.isTrue(u.size()<=1),this._coordinates=u},e.prototype.isSimple=function(){return!0},e.prototype.interfaces_=function(){return[x_]},e.prototype.getClass=function(){return e},n.serialVersionUID.get=function(){return 4902022702746615e3},Object.defineProperties(e,n),e}(Ft),Cu=function(){};Cu.prototype.interfaces_=function(){return[]};Cu.prototype.getClass=function(){return Cu};var jr=function(t){function e(i,u,h){if(t.call(this,h),this._shell=null,this._holes=null,i===null&&(i=this.getFactory().createLinearRing()),u===null&&(u=[]),t.hasNullElements(u))throw new er("holes must not contain null elements");if(i.isEmpty()&&t.hasNonEmptyElements(u))throw new er("shell is empty but holes are not");this._shell=i,this._holes=u}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={serialVersionUID:{configurable:!0}};return e.prototype.computeEnvelopeInternal=function(){return this._shell.getEnvelopeInternal()},e.prototype.getSortIndex=function(){return t.SORTINDEX_POLYGON},e.prototype.getCoordinates=function(){var u=this;if(this.isEmpty())return[];for(var h=new Array(this.getNumPoints()).fill(null),d=-1,s=this._shell.getCoordinates(),w=0;w<s.length;w++)d++,h[d]=s[w];for(var T=0;T<this._holes.length;T++)for(var A=u._holes[T].getCoordinates(),D=0;D<A.length;D++)d++,h[d]=A[D];return h},e.prototype.getArea=function(){var u=this,h=0;h+=Math.abs(wt.signedArea(this._shell.getCoordinateSequence()));for(var d=0;d<this._holes.length;d++)h-=Math.abs(wt.signedArea(u._holes[d].getCoordinateSequence()));return h},e.prototype.isRectangle=function(){if(this.getNumInteriorRing()!==0||this._shell===null||this._shell.getNumPoints()!==5)return!1;for(var u=this._shell.getCoordinateSequence(),h=this.getEnvelopeInternal(),d=0;d<5;d++){var s=u.getX(d);if(!(s===h.getMinX()||s===h.getMaxX()))return!1;var w=u.getY(d);if(!(w===h.getMinY()||w===h.getMaxY()))return!1}for(var T=u.getX(0),A=u.getY(0),D=1;D<=4;D++){var R=u.getX(D),G=u.getY(D),$=R!==T,ie=G!==A;if($===ie)return!1;T=R,A=G}return!0},e.prototype.equalsExact=function(){var u=this;if(arguments.length===2){var h=arguments[0],d=arguments[1];if(!this.isEquivalentClass(h))return!1;var s=h,w=this._shell,T=s._shell;if(!w.equalsExact(T,d)||this._holes.length!==s._holes.length)return!1;for(var A=0;A<this._holes.length;A++)if(!u._holes[A].equalsExact(s._holes[A],d))return!1;return!0}else return t.prototype.equalsExact.apply(this,arguments)},e.prototype.normalize=function(){var u=this;if(arguments.length===0){this.normalize(this._shell,!0);for(var h=0;h<this._holes.length;h++)u.normalize(u._holes[h],!1);Nc.sort(this._holes)}else if(arguments.length===2){var d=arguments[0],s=arguments[1];if(d.isEmpty())return null;var w=new Array(d.getCoordinates().length-1).fill(null);li.arraycopy(d.getCoordinates(),0,w,0,w.length);var T=un.minCoordinate(d.getCoordinates());un.scroll(w,T),li.arraycopy(w,0,d.getCoordinates(),0,w.length),d.getCoordinates()[w.length]=w[0],wt.isCCW(d.getCoordinates())===s&&un.reverse(d.getCoordinates())}},e.prototype.getCoordinate=function(){return this._shell.getCoordinate()},e.prototype.getNumInteriorRing=function(){return this._holes.length},e.prototype.getBoundaryDimension=function(){return 1},e.prototype.getDimension=function(){return 2},e.prototype.getLength=function(){var u=this,h=0;h+=this._shell.getLength();for(var d=0;d<this._holes.length;d++)h+=u._holes[d].getLength();return h},e.prototype.getNumPoints=function(){for(var u=this,h=this._shell.getNumPoints(),d=0;d<this._holes.length;d++)h+=u._holes[d].getNumPoints();return h},e.prototype.reverse=function(){var u=this,h=this.copy();h._shell=this._shell.copy().reverse(),h._holes=new Array(this._holes.length).fill(null);for(var d=0;d<this._holes.length;d++)h._holes[d]=u._holes[d].copy().reverse();return h},e.prototype.convexHull=function(){return this.getExteriorRing().convexHull()},e.prototype.compareToSameClass=function(){var u=this;if(arguments.length===1){var h=arguments[0],d=this._shell,s=h._shell;return d.compareToSameClass(s)}else if(arguments.length===2){var w=arguments[0],T=arguments[1],A=w,D=this._shell,R=A._shell,G=D.compareToSameClass(R,T);if(G!==0)return G;for(var $=this.getNumInteriorRing(),ie=A.getNumInteriorRing(),_e=0;_e<$&&_e<ie;){var Y=u.getInteriorRingN(_e),B=A.getInteriorRingN(_e),q=Y.compareToSameClass(B,T);if(q!==0)return q;_e++}return _e<$?1:_e<ie?-1:0}},e.prototype.apply=function(u){var h=this;if(Ut(u,Wa)){this._shell.apply(u);for(var d=0;d<this._holes.length;d++)h._holes[d].apply(u)}else if(Ut(u,ws)){if(this._shell.apply(u),!u.isDone())for(var s=0;s<this._holes.length&&(h._holes[s].apply(u),!u.isDone());s++);u.isGeometryChanged()&&this.geometryChanged()}else if(Ut(u,na))u.filter(this);else if(Ut(u,kl)){u.filter(this),this._shell.apply(u);for(var w=0;w<this._holes.length;w++)h._holes[w].apply(u)}},e.prototype.getBoundary=function(){var u=this;if(this.isEmpty())return this.getFactory().createMultiLineString();var h=new Array(this._holes.length+1).fill(null);h[0]=this._shell;for(var d=0;d<this._holes.length;d++)h[d+1]=u._holes[d];return h.length<=1?this.getFactory().createLinearRing(h[0].getCoordinateSequence()):this.getFactory().createMultiLineString(h)},e.prototype.clone=function(){var u=this,h=t.prototype.clone.call(this);h._shell=this._shell.clone(),h._holes=new Array(this._holes.length).fill(null);for(var d=0;d<this._holes.length;d++)h._holes[d]=u._holes[d].clone();return h},e.prototype.getGeometryType=function(){return"Polygon"},e.prototype.copy=function(){for(var u=this,h=this._shell.copy(),d=new Array(this._holes.length).fill(null),s=0;s<d.length;s++)d[s]=u._holes[s].copy();return new e(h,d,this._factory)},e.prototype.getExteriorRing=function(){return this._shell},e.prototype.isEmpty=function(){return this._shell.isEmpty()},e.prototype.getInteriorRingN=function(u){return this._holes[u]},e.prototype.interfaces_=function(){return[Cu]},e.prototype.getClass=function(){return e},n.serialVersionUID.get=function(){return-0x307ffefd8dc97200},Object.defineProperties(e,n),e}(Ft),vd=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={serialVersionUID:{configurable:!0}};return e.prototype.getSortIndex=function(){return Ft.SORTINDEX_MULTIPOINT},e.prototype.isValid=function(){return!0},e.prototype.equalsExact=function(){if(arguments.length===2){var u=arguments[0],h=arguments[1];return this.isEquivalentClass(u)?t.prototype.equalsExact.call(this,u,h):!1}else return t.prototype.equalsExact.apply(this,arguments)},e.prototype.getCoordinate=function(){if(arguments.length===1){var u=arguments[0];return this._geometries[u].getCoordinate()}else return t.prototype.getCoordinate.apply(this,arguments)},e.prototype.getBoundaryDimension=function(){return xn.FALSE},e.prototype.getDimension=function(){return 0},e.prototype.getBoundary=function(){return this.getFactory().createGeometryCollection(null)},e.prototype.getGeometryType=function(){return"MultiPoint"},e.prototype.copy=function(){for(var u=this,h=new Array(this._geometries.length).fill(null),d=0;d<h.length;d++)h[d]=u._geometries[d].copy();return new e(h,this._factory)},e.prototype.interfaces_=function(){return[x_]},e.prototype.getClass=function(){return e},n.serialVersionUID.get=function(){return-8048474874175356e3},Object.defineProperties(e,n),e}(Ri),Ha=function(t){function e(i,u){i instanceof Me&&u instanceof ln&&(i=u.getCoordinateSequenceFactory().create(i)),t.call(this,i,u),this.validateConstruction()}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={MINIMUM_VALID_SIZE:{configurable:!0},serialVersionUID:{configurable:!0}};return e.prototype.getSortIndex=function(){return Ft.SORTINDEX_LINEARRING},e.prototype.getBoundaryDimension=function(){return xn.FALSE},e.prototype.isClosed=function(){return this.isEmpty()?!0:t.prototype.isClosed.call(this)},e.prototype.reverse=function(){var u=this._points.copy();yr.reverse(u);var h=this.getFactory().createLinearRing(u);return h},e.prototype.validateConstruction=function(){if(!this.isEmpty()&&!t.prototype.isClosed.call(this))throw new er("Points of LinearRing do not form a closed linestring");if(this.getCoordinateSequence().size()>=1&&this.getCoordinateSequence().size()<e.MINIMUM_VALID_SIZE)throw new er("Invalid number of points in LinearRing (found "+this.getCoordinateSequence().size()+" - must be 0 or >= 4)")},e.prototype.getGeometryType=function(){return"LinearRing"},e.prototype.copy=function(){return new e(this._points.copy(),this._factory)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},n.MINIMUM_VALID_SIZE.get=function(){return 4},n.serialVersionUID.get=function(){return-0x3b229e262367a600},Object.defineProperties(e,n),e}(cr),qa=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={serialVersionUID:{configurable:!0}};return e.prototype.getSortIndex=function(){return Ft.SORTINDEX_MULTIPOLYGON},e.prototype.equalsExact=function(){if(arguments.length===2){var u=arguments[0],h=arguments[1];return this.isEquivalentClass(u)?t.prototype.equalsExact.call(this,u,h):!1}else return t.prototype.equalsExact.apply(this,arguments)},e.prototype.getBoundaryDimension=function(){return 1},e.prototype.getDimension=function(){return 2},e.prototype.reverse=function(){for(var u=this,h=this._geometries.length,d=new Array(h).fill(null),s=0;s<this._geometries.length;s++)d[s]=u._geometries[s].reverse();return this.getFactory().createMultiPolygon(d)},e.prototype.getBoundary=function(){var u=this;if(this.isEmpty())return this.getFactory().createMultiLineString();for(var h=new gt,d=0;d<this._geometries.length;d++)for(var s=u._geometries[d],w=s.getBoundary(),T=0;T<w.getNumGeometries();T++)h.add(w.getGeometryN(T));var A=new Array(h.size()).fill(null);return this.getFactory().createMultiLineString(h.toArray(A))},e.prototype.getGeometryType=function(){return"MultiPolygon"},e.prototype.copy=function(){for(var u=this,h=new Array(this._geometries.length).fill(null),d=0;d<h.length;d++)h[d]=u._geometries[d].copy();return new e(h,this._factory)},e.prototype.interfaces_=function(){return[Cu]},e.prototype.getClass=function(){return e},n.serialVersionUID.get=function(){return-0x7a5aa1369171980},Object.defineProperties(e,n),e}(Ri),Qo=function(e){this._factory=e||null,this._isUserDataCopied=!1},Lx={NoOpGeometryOperation:{configurable:!0},CoordinateOperation:{configurable:!0},CoordinateSequenceOperation:{configurable:!0}};Qo.prototype.setCopyUserData=function(e){this._isUserDataCopied=e};Qo.prototype.edit=function(e,n){if(e===null)return null;var i=this.editInternal(e,n);return this._isUserDataCopied&&i.setUserData(e.getUserData()),i};Qo.prototype.editInternal=function(e,n){return this._factory===null&&(this._factory=e.getFactory()),e instanceof Ri?this.editGeometryCollection(e,n):e instanceof jr?this.editPolygon(e,n):e instanceof lo?n.edit(e,this._factory):e instanceof cr?n.edit(e,this._factory):(Qt.shouldNeverReachHere("Unsupported Geometry class: "+e.getClass().getName()),null)};Qo.prototype.editGeometryCollection=function(e,n){for(var i=this,u=n.edit(e,this._factory),h=new gt,d=0;d<u.getNumGeometries();d++){var s=i.edit(u.getGeometryN(d),n);s===null||s.isEmpty()||h.add(s)}return u.getClass()===vd?this._factory.createMultiPoint(h.toArray([])):u.getClass()===Fc?this._factory.createMultiLineString(h.toArray([])):u.getClass()===qa?this._factory.createMultiPolygon(h.toArray([])):this._factory.createGeometryCollection(h.toArray([]))};Qo.prototype.editPolygon=function(e,n){var i=this,u=n.edit(e,this._factory);if(u===null&&(u=this._factory.createPolygon(null)),u.isEmpty())return u;var h=this.edit(u.getExteriorRing(),n);if(h===null||h.isEmpty())return this._factory.createPolygon();for(var d=new gt,s=0;s<u.getNumInteriorRing();s++){var w=i.edit(u.getInteriorRingN(s),n);w===null||w.isEmpty()||d.add(w)}return this._factory.createPolygon(h,d.toArray([]))};Qo.prototype.interfaces_=function(){return[]};Qo.prototype.getClass=function(){return Qo};Qo.GeometryEditorOperation=function(){};Lx.NoOpGeometryOperation.get=function(){return w_};Lx.CoordinateOperation.get=function(){return b_};Lx.CoordinateSequenceOperation.get=function(){return E_};Object.defineProperties(Qo,Lx);var w_=function(){};w_.prototype.edit=function(e,n){return e};w_.prototype.interfaces_=function(){return[Qo.GeometryEditorOperation]};w_.prototype.getClass=function(){return w_};var b_=function(){};b_.prototype.edit=function(e,n){var i=this.editCoordinates(e.getCoordinates(),e);return i===null?e:e instanceof Ha?n.createLinearRing(i):e instanceof cr?n.createLineString(i):e instanceof lo?i.length>0?n.createPoint(i[0]):n.createPoint():e};b_.prototype.interfaces_=function(){return[Qo.GeometryEditorOperation]};b_.prototype.getClass=function(){return b_};var E_=function(){};E_.prototype.edit=function(e,n){return e instanceof Ha?n.createLinearRing(this.edit(e.getCoordinateSequence(),e)):e instanceof cr?n.createLineString(this.edit(e.getCoordinateSequence(),e)):e instanceof lo?n.createPoint(this.edit(e.getCoordinateSequence(),e)):e};E_.prototype.interfaces_=function(){return[Qo.GeometryEditorOperation]};E_.prototype.getClass=function(){return E_};var gr=function(){var e=this;if(this._dimension=3,this._coordinates=null,arguments.length===1){if(arguments[0]instanceof Array)this._coordinates=arguments[0],this._dimension=3;else if(Number.isInteger(arguments[0])){var n=arguments[0];this._coordinates=new Array(n).fill(null);for(var i=0;i<n;i++)e._coordinates[i]=new Me}else if(Ut(arguments[0],dn)){var u=arguments[0];if(u===null)return this._coordinates=new Array(0).fill(null),null;this._dimension=u.getDimension(),this._coordinates=new Array(u.size()).fill(null);for(var h=0;h<this._coordinates.length;h++)e._coordinates[h]=u.getCoordinateCopy(h)}}else if(arguments.length===2){if(arguments[0]instanceof Array&&Number.isInteger(arguments[1])){var d=arguments[0],s=arguments[1];this._coordinates=d,this._dimension=s,d===null&&(this._coordinates=new Array(0).fill(null))}else if(Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var w=arguments[0],T=arguments[1];this._coordinates=new Array(w).fill(null),this._dimension=T;for(var A=0;A<w;A++)e._coordinates[A]=new Me}}},tD={serialVersionUID:{configurable:!0}};gr.prototype.setOrdinate=function(e,n,i){switch(n){case dn.X:this._coordinates[e].x=i;break;case dn.Y:this._coordinates[e].y=i;break;case dn.Z:this._coordinates[e].z=i;break;default:throw new er("invalid ordinateIndex")}};gr.prototype.size=function(){return this._coordinates.length};gr.prototype.getOrdinate=function(e,n){switch(n){case dn.X:return this._coordinates[e].x;case dn.Y:return this._coordinates[e].y;case dn.Z:return this._coordinates[e].z}return Gt.NaN};gr.prototype.getCoordinate=function(){if(arguments.length===1){var e=arguments[0];return this._coordinates[e]}else if(arguments.length===2){var n=arguments[0],i=arguments[1];i.x=this._coordinates[n].x,i.y=this._coordinates[n].y,i.z=this._coordinates[n].z}};gr.prototype.getCoordinateCopy=function(e){return new Me(this._coordinates[e])};gr.prototype.getDimension=function(){return this._dimension};gr.prototype.getX=function(e){return this._coordinates[e].x};gr.prototype.clone=function(){for(var e=this,n=new Array(this.size()).fill(null),i=0;i<this._coordinates.length;i++)n[i]=e._coordinates[i].clone();return new gr(n,this._dimension)};gr.prototype.expandEnvelope=function(e){for(var n=this,i=0;i<this._coordinates.length;i++)e.expandToInclude(n._coordinates[i]);return e};gr.prototype.copy=function(){for(var e=this,n=new Array(this.size()).fill(null),i=0;i<this._coordinates.length;i++)n[i]=e._coordinates[i].copy();return new gr(n,this._dimension)};gr.prototype.toString=function(){var e=this;if(this._coordinates.length>0){var n=new ca(17*this._coordinates.length);n.append("("),n.append(this._coordinates[0]);for(var i=1;i<this._coordinates.length;i++)n.append(", "),n.append(e._coordinates[i]);return n.append(")"),n.toString()}else return"()"};gr.prototype.getY=function(e){return this._coordinates[e].y};gr.prototype.toCoordinateArray=function(){return this._coordinates};gr.prototype.interfaces_=function(){return[dn,ns]};gr.prototype.getClass=function(){return gr};tD.serialVersionUID.get=function(){return-0xcb44a778db18e00};Object.defineProperties(gr,tD);var Ya=function(){},zS={serialVersionUID:{configurable:!0},instanceObject:{configurable:!0}};Ya.prototype.readResolve=function(){return Ya.instance()};Ya.prototype.create=function(){if(arguments.length===1){if(arguments[0]instanceof Array){var e=arguments[0];return new gr(e)}else if(Ut(arguments[0],dn)){var n=arguments[0];return new gr(n)}}else if(arguments.length===2){var i=arguments[0],u=arguments[1];return u>3&&(u=3),u<2?new gr(i):new gr(i,u)}};Ya.prototype.interfaces_=function(){return[pd,ns]};Ya.prototype.getClass=function(){return Ya};Ya.instance=function(){return Ya.instanceObject};zS.serialVersionUID.get=function(){return-0x38e49fa6cf6f2e00};zS.instanceObject.get=function(){return new Ya};Object.defineProperties(Ya,zS);var nD=function(t){function e(){t.call(this),this.map_=new Map}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.get=function(i){return this.map_.get(i)||null},e.prototype.put=function(i,u){return this.map_.set(i,u),u},e.prototype.values=function(){for(var i=new gt,u=this.map_.values(),h=u.next();!h.done;)i.add(h.value),h=u.next();return i},e.prototype.entrySet=function(){var i=new kS;return this.map_.entries().forEach(function(u){return i.add(u)}),i},e.prototype.size=function(){return this.map_.size()},e}(Mf),bn=function t(){if(this._modelType=null,this._scale=null,arguments.length===0)this._modelType=t.FLOATING;else if(arguments.length===1){if(arguments[0]instanceof ra){var e=arguments[0];this._modelType=e,e===t.FIXED&&this.setScale(1)}else if(typeof arguments[0]=="number"){var n=arguments[0];this._modelType=t.FIXED,this.setScale(n)}else if(arguments[0]instanceof t){var i=arguments[0];this._modelType=i._modelType,this._scale=i._scale}}},FS={serialVersionUID:{configurable:!0},maximumPreciseValue:{configurable:!0}};bn.prototype.equals=function(e){if(!(e instanceof bn))return!1;var n=e;return this._modelType===n._modelType&&this._scale===n._scale};bn.prototype.compareTo=function(e){var n=e,i=this.getMaximumSignificantDigits(),u=n.getMaximumSignificantDigits();return new ea(i).compareTo(new ea(u))};bn.prototype.getScale=function(){return this._scale};bn.prototype.isFloating=function(){return this._modelType===bn.FLOATING||this._modelType===bn.FLOATING_SINGLE};bn.prototype.getType=function(){return this._modelType};bn.prototype.toString=function(){var e="UNKNOWN";return this._modelType===bn.FLOATING?e="Floating":this._modelType===bn.FLOATING_SINGLE?e="Floating-Single":this._modelType===bn.FIXED&&(e="Fixed (Scale="+this.getScale()+")"),e};bn.prototype.makePrecise=function(){if(typeof arguments[0]=="number"){var e=arguments[0];if(Gt.isNaN(e))return e;if(this._modelType===bn.FLOATING_SINGLE){var n=e;return n}return this._modelType===bn.FIXED?Math.round(e*this._scale)/this._scale:e}else if(arguments[0]instanceof Me){var i=arguments[0];if(this._modelType===bn.FLOATING)return null;i.x=this.makePrecise(i.x),i.y=this.makePrecise(i.y)}};bn.prototype.getMaximumSignificantDigits=function(){var e=16;return this._modelType===bn.FLOATING?e=16:this._modelType===bn.FLOATING_SINGLE?e=6:this._modelType===bn.FIXED&&(e=1+Math.trunc(Math.ceil(Math.log(this.getScale())/Math.log(10)))),e};bn.prototype.setScale=function(e){this._scale=Math.abs(e)};bn.prototype.interfaces_=function(){return[ns,ts]};bn.prototype.getClass=function(){return bn};bn.mostPrecise=function(e,n){return e.compareTo(n)>=0?e:n};FS.serialVersionUID.get=function(){return 7777263578777804e3};FS.maximumPreciseValue.get=function(){return 9007199254740992};Object.defineProperties(bn,FS);var ra=function t(e){this._name=e||null,t.nameToTypeMap.put(e,this)},BS={serialVersionUID:{configurable:!0},nameToTypeMap:{configurable:!0}};ra.prototype.readResolve=function(){return ra.nameToTypeMap.get(this._name)};ra.prototype.toString=function(){return this._name};ra.prototype.interfaces_=function(){return[ns]};ra.prototype.getClass=function(){return ra};BS.serialVersionUID.get=function(){return-552860263173159e4};BS.nameToTypeMap.get=function(){return new nD};Object.defineProperties(ra,BS);bn.Type=ra;bn.FIXED=new ra("FIXED");bn.FLOATING=new ra("FLOATING");bn.FLOATING_SINGLE=new ra("FLOATING SINGLE");var ln=function t(){this._precisionModel=new bn,this._SRID=0,this._coordinateSequenceFactory=t.getDefaultCoordinateSequenceFactory(),arguments.length===0||(arguments.length===1?Ut(arguments[0],pd)?this._coordinateSequenceFactory=arguments[0]:arguments[0]instanceof bn&&(this._precisionModel=arguments[0]):arguments.length===2?(this._precisionModel=arguments[0],this._SRID=arguments[1]):arguments.length===3&&(this._precisionModel=arguments[0],this._SRID=arguments[1],this._coordinateSequenceFactory=arguments[2]))},rD={serialVersionUID:{configurable:!0}};ln.prototype.toGeometry=function(e){return e.isNull()?this.createPoint(null):e.getMinX()===e.getMaxX()&&e.getMinY()===e.getMaxY()?this.createPoint(new Me(e.getMinX(),e.getMinY())):e.getMinX()===e.getMaxX()||e.getMinY()===e.getMaxY()?this.createLineString([new Me(e.getMinX(),e.getMinY()),new Me(e.getMaxX(),e.getMaxY())]):this.createPolygon(this.createLinearRing([new Me(e.getMinX(),e.getMinY()),new Me(e.getMinX(),e.getMaxY()),new Me(e.getMaxX(),e.getMaxY()),new Me(e.getMaxX(),e.getMinY()),new Me(e.getMinX(),e.getMinY())]),null)};ln.prototype.createLineString=function(e){if(e){if(e instanceof Array)return new cr(this.getCoordinateSequenceFactory().create(e),this);if(Ut(e,dn))return new cr(e,this)}else return new cr(this.getCoordinateSequenceFactory().create([]),this)};ln.prototype.createMultiLineString=function(){if(arguments.length===0)return new Fc(null,this);if(arguments.length===1){var e=arguments[0];return new Fc(e,this)}};ln.prototype.buildGeometry=function(e){for(var n=null,i=!1,u=!1,h=e.iterator();h.hasNext();){var d=h.next(),s=d.getClass();n===null&&(n=s),s!==n&&(i=!0),d.isGeometryCollectionOrDerived()&&(u=!0)}if(n===null)return this.createGeometryCollection();if(i||u)return this.createGeometryCollection(ln.toGeometryArray(e));var w=e.iterator().next(),T=e.size()>1;if(T){if(w instanceof jr)return this.createMultiPolygon(ln.toPolygonArray(e));if(w instanceof cr)return this.createMultiLineString(ln.toLineStringArray(e));if(w instanceof lo)return this.createMultiPoint(ln.toPointArray(e));Qt.shouldNeverReachHere("Unhandled class: "+w.getClass().getName())}return w};ln.prototype.createMultiPointFromCoords=function(e){return this.createMultiPoint(e!==null?this.getCoordinateSequenceFactory().create(e):null)};ln.prototype.createPoint=function(){if(arguments.length===0)return this.createPoint(this.getCoordinateSequenceFactory().create([]));if(arguments.length===1){if(arguments[0]instanceof Me){var e=arguments[0];return this.createPoint(e!==null?this.getCoordinateSequenceFactory().create([e]):null)}else if(Ut(arguments[0],dn)){var n=arguments[0];return new lo(n,this)}}};ln.prototype.getCoordinateSequenceFactory=function(){return this._coordinateSequenceFactory};ln.prototype.createPolygon=function(){if(arguments.length===0)return new jr(null,null,this);if(arguments.length===1){if(Ut(arguments[0],dn)){var e=arguments[0];return this.createPolygon(this.createLinearRing(e))}else if(arguments[0]instanceof Array){var n=arguments[0];return this.createPolygon(this.createLinearRing(n))}else if(arguments[0]instanceof Ha){var i=arguments[0];return this.createPolygon(i,null)}}else if(arguments.length===2){var u=arguments[0],h=arguments[1];return new jr(u,h,this)}};ln.prototype.getSRID=function(){return this._SRID};ln.prototype.createGeometryCollection=function(){if(arguments.length===0)return new Ri(null,this);if(arguments.length===1){var e=arguments[0];return new Ri(e,this)}};ln.prototype.createGeometry=function(e){var n=new Qo(this);return n.edit(e,{edit:function(){if(arguments.length===2){var i=arguments[0];return this._coordinateSequenceFactory.create(i)}}})};ln.prototype.getPrecisionModel=function(){return this._precisionModel};ln.prototype.createLinearRing=function(){if(arguments.length===0)return this.createLinearRing(this.getCoordinateSequenceFactory().create([]));if(arguments.length===1){if(arguments[0]instanceof Array){var e=arguments[0];return this.createLinearRing(e!==null?this.getCoordinateSequenceFactory().create(e):null)}else if(Ut(arguments[0],dn)){var n=arguments[0];return new Ha(n,this)}}};ln.prototype.createMultiPolygon=function(){if(arguments.length===0)return new qa(null,this);if(arguments.length===1){var e=arguments[0];return new qa(e,this)}};ln.prototype.createMultiPoint=function(){var e=this;if(arguments.length===0)return new vd(null,this);if(arguments.length===1){if(arguments[0]instanceof Array){var n=arguments[0];return new vd(n,this)}else if(arguments[0]instanceof Array){var i=arguments[0];return this.createMultiPoint(i!==null?this.getCoordinateSequenceFactory().create(i):null)}else if(Ut(arguments[0],dn)){var u=arguments[0];if(u===null)return this.createMultiPoint(new Array(0).fill(null));for(var h=new Array(u.size()).fill(null),d=0;d<u.size();d++){var s=e.getCoordinateSequenceFactory().create(1,u.getDimension());yr.copy(u,d,s,0,1),h[d]=e.createPoint(s)}return this.createMultiPoint(h)}}};ln.prototype.interfaces_=function(){return[ns]};ln.prototype.getClass=function(){return ln};ln.toMultiPolygonArray=function(e){var n=new Array(e.size()).fill(null);return e.toArray(n)};ln.toGeometryArray=function(e){if(e===null)return null;var n=new Array(e.size()).fill(null);return e.toArray(n)};ln.getDefaultCoordinateSequenceFactory=function(){return Ya.instance()};ln.toMultiLineStringArray=function(e){var n=new Array(e.size()).fill(null);return e.toArray(n)};ln.toLineStringArray=function(e){var n=new Array(e.size()).fill(null);return e.toArray(n)};ln.toMultiPointArray=function(e){var n=new Array(e.size()).fill(null);return e.toArray(n)};ln.toLinearRingArray=function(e){var n=new Array(e.size()).fill(null);return e.toArray(n)};ln.toPointArray=function(e){var n=new Array(e.size()).fill(null);return e.toArray(n)};ln.toPolygonArray=function(e){var n=new Array(e.size()).fill(null);return e.toArray(n)};ln.createPointFromInternalCoord=function(e,n){return n.getPrecisionModel().makePrecise(e),n.getFactory().createPoint(e)};rD.serialVersionUID.get=function(){return-6820524753094096e3};Object.defineProperties(ln,rD);var IU=["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"],Dx=function(e){this.geometryFactory=e||new ln};Dx.prototype.read=function(e){var n;typeof e=="string"?n=JSON.parse(e):n=e;var i=n.type;if(!qs[i])throw new Error("Unknown GeoJSON type: "+n.type);return IU.indexOf(i)!==-1?qs[i].apply(this,[n.coordinates]):i==="GeometryCollection"?qs[i].apply(this,[n.geometries]):qs[i].apply(this,[n])};Dx.prototype.write=function(e){var n=e.getGeometryType();if(!Cl[n])throw new Error("Geometry is not supported");return Cl[n].apply(this,[e])};var qs={Feature:function(t){var e={};for(var n in t)e[n]=t[n];if(t.geometry){var i=t.geometry.type;if(!qs[i])throw new Error("Unknown GeoJSON type: "+t.type);e.geometry=this.read(t.geometry)}return t.bbox&&(e.bbox=qs.bbox.apply(this,[t.bbox])),e},FeatureCollection:function(t){var e=this,n={};if(t.features){n.features=[];for(var i=0;i<t.features.length;++i)n.features.push(e.read(t.features[i]))}return t.bbox&&(n.bbox=this.parse.bbox.apply(this,[t.bbox])),n},coordinates:function(t){for(var e=[],n=0;n<t.length;++n){var i=t[n];e.push(new Me(i[0],i[1]))}return e},bbox:function(t){return this.geometryFactory.createLinearRing([new Me(t[0],t[1]),new Me(t[2],t[1]),new Me(t[2],t[3]),new Me(t[0],t[3]),new Me(t[0],t[1])])},Point:function(t){var e=new Me(t[0],t[1]);return this.geometryFactory.createPoint(e)},MultiPoint:function(t){for(var e=this,n=[],i=0;i<t.length;++i)n.push(qs.Point.apply(e,[t[i]]));return this.geometryFactory.createMultiPoint(n)},LineString:function(t){var e=qs.coordinates.apply(this,[t]);return this.geometryFactory.createLineString(e)},MultiLineString:function(t){for(var e=this,n=[],i=0;i<t.length;++i)n.push(qs.LineString.apply(e,[t[i]]));return this.geometryFactory.createMultiLineString(n)},Polygon:function(t){for(var e=this,n=qs.coordinates.apply(this,[t[0]]),i=this.geometryFactory.createLinearRing(n),u=[],h=1;h<t.length;++h){var d=t[h],s=qs.coordinates.apply(e,[d]),w=e.geometryFactory.createLinearRing(s);u.push(w)}return this.geometryFactory.createPolygon(i,u)},MultiPolygon:function(t){for(var e=this,n=[],i=0;i<t.length;++i){var u=t[i];n.push(qs.Polygon.apply(e,[u]))}return this.geometryFactory.createMultiPolygon(n)},GeometryCollection:function(t){for(var e=this,n=[],i=0;i<t.length;++i){var u=t[i];n.push(e.read(u))}return this.geometryFactory.createGeometryCollection(n)}},Cl={coordinate:function(t){return[t.x,t.y]},Point:function(t){var e=Cl.coordinate.apply(this,[t.getCoordinate()]);return{type:"Point",coordinates:e}},MultiPoint:function(t){for(var e=this,n=[],i=0;i<t._geometries.length;++i){var u=t._geometries[i],h=Cl.Point.apply(e,[u]);n.push(h.coordinates)}return{type:"MultiPoint",coordinates:n}},LineString:function(t){for(var e=this,n=[],i=t.getCoordinates(),u=0;u<i.length;++u){var h=i[u];n.push(Cl.coordinate.apply(e,[h]))}return{type:"LineString",coordinates:n}},MultiLineString:function(t){for(var e=this,n=[],i=0;i<t._geometries.length;++i){var u=t._geometries[i],h=Cl.LineString.apply(e,[u]);n.push(h.coordinates)}return{type:"MultiLineString",coordinates:n}},Polygon:function(t){var e=this,n=[],i=Cl.LineString.apply(this,[t._shell]);n.push(i.coordinates);for(var u=0;u<t._holes.length;++u){var h=t._holes[u],d=Cl.LineString.apply(e,[h]);n.push(d.coordinates)}return{type:"Polygon",coordinates:n}},MultiPolygon:function(t){for(var e=this,n=[],i=0;i<t._geometries.length;++i){var u=t._geometries[i],h=Cl.Polygon.apply(e,[u]);n.push(h.coordinates)}return{type:"MultiPolygon",coordinates:n}},GeometryCollection:function(t){for(var e=this,n=[],i=0;i<t._geometries.length;++i){var u=t._geometries[i],h=u.getGeometryType();n.push(Cl[h].apply(e,[u]))}return{type:"GeometryCollection",geometries:n}}},US=function(e){this.geometryFactory=e||new ln,this.precisionModel=this.geometryFactory.getPrecisionModel(),this.parser=new Dx(this.geometryFactory)};US.prototype.read=function(e){var n=this.parser.read(e);return this.precisionModel.getType()===bn.FIXED&&this.reducePrecision(n),n};US.prototype.reducePrecision=function(e){var n=this,i,u;if(e.coordinate)this.precisionModel.makePrecise(e.coordinate);else if(e.points)for(i=0,u=e.points.length;i<u;i++)n.precisionModel.makePrecise(e.points[i]);else if(e.geometries)for(i=0,u=e.geometries.length;i<u;i++)n.reducePrecision(e.geometries[i])};var iD=function(){this.parser=new Dx(this.geometryFactory)};iD.prototype.write=function(e){return this.parser.write(e)};var ht=function(){},Rx={ON:{configurable:!0},LEFT:{configurable:!0},RIGHT:{configurable:!0}};ht.prototype.interfaces_=function(){return[]};ht.prototype.getClass=function(){return ht};ht.opposite=function(e){return e===ht.LEFT?ht.RIGHT:e===ht.RIGHT?ht.LEFT:e};Rx.ON.get=function(){return 0};Rx.LEFT.get=function(){return 1};Rx.RIGHT.get=function(){return 2};Object.defineProperties(ht,Rx);function Nx(t){this.message=t||""}Nx.prototype=new Error;Nx.prototype.name="EmptyStackException";function ha(){this.array_=[]}ha.prototype=new gs;ha.prototype.add=function(t){return this.array_.push(t),!0};ha.prototype.get=function(t){if(t<0||t>=this.size())throw new Error;return this.array_[t]};ha.prototype.push=function(t){return this.array_.push(t),t};ha.prototype.pop=function(t){if(this.array_.length===0)throw new Nx;return this.array_.pop()};ha.prototype.peek=function(){if(this.array_.length===0)throw new Nx;return this.array_[this.array_.length-1]};ha.prototype.empty=function(){return this.array_.length===0};ha.prototype.isEmpty=function(){return this.empty()};ha.prototype.search=function(t){return this.array_.indexOf(t)};ha.prototype.size=function(){return this.array_.length};ha.prototype.toArray=function(){for(var t=this,e=[],n=0,i=this.array_.length;n<i;n++)e.push(t.array_[n]);return e};var ia=function(){this._minIndex=-1,this._minCoord=null,this._minDe=null,this._orientedDe=null};ia.prototype.getCoordinate=function(){return this._minCoord};ia.prototype.getRightmostSide=function(e,n){var i=this.getRightmostSideOfSegment(e,n);return i<0&&(i=this.getRightmostSideOfSegment(e,n-1)),i<0&&(this._minCoord=null,this.checkForRightmostCoordinate(e)),i};ia.prototype.findRightmostEdgeAtVertex=function(){var e=this._minDe.getEdge().getCoordinates();Qt.isTrue(this._minIndex>0&&this._minIndex<e.length,"rightmost point expected to be interior vertex of edge");var n=e[this._minIndex-1],i=e[this._minIndex+1],u=wt.computeOrientation(this._minCoord,i,n),h=!1;(n.y<this._minCoord.y&&i.y<this._minCoord.y&&u===wt.COUNTERCLOCKWISE||n.y>this._minCoord.y&&i.y>this._minCoord.y&&u===wt.CLOCKWISE)&&(h=!0),h&&(this._minIndex=this._minIndex-1)};ia.prototype.getRightmostSideOfSegment=function(e,n){var i=e.getEdge(),u=i.getCoordinates();if(n<0||n+1>=u.length||u[n].y===u[n+1].y)return-1;var h=ht.LEFT;return u[n].y<u[n+1].y&&(h=ht.RIGHT),h};ia.prototype.getEdge=function(){return this._orientedDe};ia.prototype.checkForRightmostCoordinate=function(e){for(var n=this,i=e.getEdge().getCoordinates(),u=0;u<i.length-1;u++)(n._minCoord===null||i[u].x>n._minCoord.x)&&(n._minDe=e,n._minIndex=u,n._minCoord=i[u])};ia.prototype.findRightmostEdgeAtNode=function(){var e=this._minDe.getNode(),n=e.getEdges();this._minDe=n.getRightmostEdge(),this._minDe.isForward()||(this._minDe=this._minDe.getSym(),this._minIndex=this._minDe.getEdge().getCoordinates().length-1)};ia.prototype.findEdge=function(e){for(var n=this,i=e.iterator();i.hasNext();){var u=i.next();u.isForward()&&n.checkForRightmostCoordinate(u)}Qt.isTrue(this._minIndex!==0||this._minCoord.equals(this._minDe.getCoordinate()),"inconsistency in rightmost processing"),this._minIndex===0?this.findRightmostEdgeAtNode():this.findRightmostEdgeAtVertex(),this._orientedDe=this._minDe;var h=this.getRightmostSide(this._minDe,this._minIndex);h===ht.LEFT&&(this._orientedDe=this._minDe.getSym())};ia.prototype.interfaces_=function(){return[]};ia.prototype.getClass=function(){return ia};var Ol=function(t){function e(n,i){t.call(this,e.msgWithCoord(n,i)),this.pt=i?new Me(i):null,this.name="TopologyException"}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getCoordinate=function(){return this.pt},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e.msgWithCoord=function(i,u){return u?i:i+" [ "+u+" ]"},e}(Nl),kx=function(){this.array_=[]};kx.prototype.addLast=function(e){this.array_.push(e)};kx.prototype.removeFirst=function(){return this.array_.shift()};kx.prototype.isEmpty=function(){return this.array_.length===0};var Ni=function(){this._finder=null,this._dirEdgeList=new gt,this._nodes=new gt,this._rightMostCoord=null,this._env=null,this._finder=new ia};Ni.prototype.clearVisitedEdges=function(){for(var e=this._dirEdgeList.iterator();e.hasNext();){var n=e.next();n.setVisited(!1)}};Ni.prototype.getRightmostCoordinate=function(){return this._rightMostCoord};Ni.prototype.computeNodeDepth=function(e){for(var n=this,i=null,u=e.getEdges().iterator();u.hasNext();){var h=u.next();if(h.isVisited()||h.getSym().isVisited()){i=h;break}}if(i===null)throw new Ol("unable to find edge to compute depths at "+e.getCoordinate());e.getEdges().computeDepths(i);for(var d=e.getEdges().iterator();d.hasNext();){var s=d.next();s.setVisited(!0),n.copySymDepths(s)}};Ni.prototype.computeDepth=function(e){this.clearVisitedEdges();var n=this._finder.getEdge();n.setEdgeDepths(ht.RIGHT,e),this.copySymDepths(n),this.computeDepths(n)};Ni.prototype.create=function(e){this.addReachable(e),this._finder.findEdge(this._dirEdgeList),this._rightMostCoord=this._finder.getCoordinate()};Ni.prototype.findResultEdges=function(){for(var e=this._dirEdgeList.iterator();e.hasNext();){var n=e.next();n.getDepth(ht.RIGHT)>=1&&n.getDepth(ht.LEFT)<=0&&!n.isInteriorAreaEdge()&&n.setInResult(!0)}};Ni.prototype.computeDepths=function(e){var n=this,i=new kS,u=new kx,h=e.getNode();for(u.addLast(h),i.add(h),e.setVisited(!0);!u.isEmpty();){var d=u.removeFirst();i.add(d),n.computeNodeDepth(d);for(var s=d.getEdges().iterator();s.hasNext();){var w=s.next(),T=w.getSym();if(!T.isVisited()){var A=T.getNode();i.contains(A)||(u.addLast(A),i.add(A))}}}};Ni.prototype.compareTo=function(e){var n=e;return this._rightMostCoord.x<n._rightMostCoord.x?-1:this._rightMostCoord.x>n._rightMostCoord.x?1:0};Ni.prototype.getEnvelope=function(){if(this._env===null){for(var e=new Dt,n=this._dirEdgeList.iterator();n.hasNext();)for(var i=n.next(),u=i.getEdge().getCoordinates(),h=0;h<u.length-1;h++)e.expandToInclude(u[h]);this._env=e}return this._env};Ni.prototype.addReachable=function(e){var n=this,i=new ha;for(i.add(e);!i.empty();){var u=i.pop();n.add(u,i)}};Ni.prototype.copySymDepths=function(e){var n=e.getSym();n.setDepth(ht.LEFT,e.getDepth(ht.RIGHT)),n.setDepth(ht.RIGHT,e.getDepth(ht.LEFT))};Ni.prototype.add=function(e,n){var i=this;e.setVisited(!0),this._nodes.add(e);for(var u=e.getEdges().iterator();u.hasNext();){var h=u.next();i._dirEdgeList.add(h);var d=h.getSym(),s=d.getNode();s.isVisited()||n.push(s)}};Ni.prototype.getNodes=function(){return this._nodes};Ni.prototype.getDirectedEdges=function(){return this._dirEdgeList};Ni.prototype.interfaces_=function(){return[ts]};Ni.prototype.getClass=function(){return Ni};var $n=function t(){var e=this;if(this.location=null,arguments.length===1){if(arguments[0]instanceof Array){var n=arguments[0];this.init(n.length)}else if(Number.isInteger(arguments[0])){var i=arguments[0];this.init(1),this.location[ht.ON]=i}else if(arguments[0]instanceof t){var u=arguments[0];if(this.init(u.location.length),u!==null)for(var h=0;h<this.location.length;h++)e.location[h]=u.location[h]}}else if(arguments.length===3){var d=arguments[0],s=arguments[1],w=arguments[2];this.init(3),this.location[ht.ON]=d,this.location[ht.LEFT]=s,this.location[ht.RIGHT]=w}};$n.prototype.setAllLocations=function(e){for(var n=this,i=0;i<this.location.length;i++)n.location[i]=e};$n.prototype.isNull=function(){for(var e=this,n=0;n<this.location.length;n++)if(e.location[n]!==Oe.NONE)return!1;return!0};$n.prototype.setAllLocationsIfNull=function(e){for(var n=this,i=0;i<this.location.length;i++)n.location[i]===Oe.NONE&&(n.location[i]=e)};$n.prototype.isLine=function(){return this.location.length===1};$n.prototype.merge=function(e){var n=this;if(e.location.length>this.location.length){var i=new Array(3).fill(null);i[ht.ON]=this.location[ht.ON],i[ht.LEFT]=Oe.NONE,i[ht.RIGHT]=Oe.NONE,this.location=i}for(var u=0;u<this.location.length;u++)n.location[u]===Oe.NONE&&u<e.location.length&&(n.location[u]=e.location[u])};$n.prototype.getLocations=function(){return this.location};$n.prototype.flip=function(){if(this.location.length<=1)return null;var e=this.location[ht.LEFT];this.location[ht.LEFT]=this.location[ht.RIGHT],this.location[ht.RIGHT]=e};$n.prototype.toString=function(){var e=new ca;return this.location.length>1&&e.append(Oe.toLocationSymbol(this.location[ht.LEFT])),e.append(Oe.toLocationSymbol(this.location[ht.ON])),this.location.length>1&&e.append(Oe.toLocationSymbol(this.location[ht.RIGHT])),e.toString()};$n.prototype.setLocations=function(e,n,i){this.location[ht.ON]=e,this.location[ht.LEFT]=n,this.location[ht.RIGHT]=i};$n.prototype.get=function(e){return e<this.location.length?this.location[e]:Oe.NONE};$n.prototype.isArea=function(){return this.location.length>1};$n.prototype.isAnyNull=function(){for(var e=this,n=0;n<this.location.length;n++)if(e.location[n]===Oe.NONE)return!0;return!1};$n.prototype.setLocation=function(){if(arguments.length===1){var e=arguments[0];this.setLocation(ht.ON,e)}else if(arguments.length===2){var n=arguments[0],i=arguments[1];this.location[n]=i}};$n.prototype.init=function(e){this.location=new Array(e).fill(null),this.setAllLocations(Oe.NONE)};$n.prototype.isEqualOnSide=function(e,n){return this.location[n]===e.location[n]};$n.prototype.allPositionsEqual=function(e){for(var n=this,i=0;i<this.location.length;i++)if(n.location[i]!==e)return!1;return!0};$n.prototype.interfaces_=function(){return[]};$n.prototype.getClass=function(){return $n};var An=function t(){if(this.elt=new Array(2).fill(null),arguments.length===1){if(Number.isInteger(arguments[0])){var e=arguments[0];this.elt[0]=new $n(e),this.elt[1]=new $n(e)}else if(arguments[0]instanceof t){var n=arguments[0];this.elt[0]=new $n(n.elt[0]),this.elt[1]=new $n(n.elt[1])}}else if(arguments.length===2){var i=arguments[0],u=arguments[1];this.elt[0]=new $n(Oe.NONE),this.elt[1]=new $n(Oe.NONE),this.elt[i].setLocation(u)}else if(arguments.length===3){var h=arguments[0],d=arguments[1],s=arguments[2];this.elt[0]=new $n(h,d,s),this.elt[1]=new $n(h,d,s)}else if(arguments.length===4){var w=arguments[0],T=arguments[1],A=arguments[2],D=arguments[3];this.elt[0]=new $n(Oe.NONE,Oe.NONE,Oe.NONE),this.elt[1]=new $n(Oe.NONE,Oe.NONE,Oe.NONE),this.elt[w].setLocations(T,A,D)}};An.prototype.getGeometryCount=function(){var e=0;return this.elt[0].isNull()||e++,this.elt[1].isNull()||e++,e};An.prototype.setAllLocations=function(e,n){this.elt[e].setAllLocations(n)};An.prototype.isNull=function(e){return this.elt[e].isNull()};An.prototype.setAllLocationsIfNull=function(){if(arguments.length===1){var e=arguments[0];this.setAllLocationsIfNull(0,e),this.setAllLocationsIfNull(1,e)}else if(arguments.length===2){var n=arguments[0],i=arguments[1];this.elt[n].setAllLocationsIfNull(i)}};An.prototype.isLine=function(e){return this.elt[e].isLine()};An.prototype.merge=function(e){for(var n=this,i=0;i<2;i++)n.elt[i]===null&&e.elt[i]!==null?n.elt[i]=new $n(e.elt[i]):n.elt[i].merge(e.elt[i])};An.prototype.flip=function(){this.elt[0].flip(),this.elt[1].flip()};An.prototype.getLocation=function(){if(arguments.length===1){var e=arguments[0];return this.elt[e].get(ht.ON)}else if(arguments.length===2){var n=arguments[0],i=arguments[1];return this.elt[n].get(i)}};An.prototype.toString=function(){var e=new ca;return this.elt[0]!==null&&(e.append("A:"),e.append(this.elt[0].toString())),this.elt[1]!==null&&(e.append(" B:"),e.append(this.elt[1].toString())),e.toString()};An.prototype.isArea=function(){if(arguments.length===0)return this.elt[0].isArea()||this.elt[1].isArea();if(arguments.length===1){var e=arguments[0];return this.elt[e].isArea()}};An.prototype.isAnyNull=function(e){return this.elt[e].isAnyNull()};An.prototype.setLocation=function(){if(arguments.length===2){var e=arguments[0],n=arguments[1];this.elt[e].setLocation(ht.ON,n)}else if(arguments.length===3){var i=arguments[0],u=arguments[1],h=arguments[2];this.elt[i].setLocation(u,h)}};An.prototype.isEqualOnSide=function(e,n){return this.elt[0].isEqualOnSide(e.elt[0],n)&&this.elt[1].isEqualOnSide(e.elt[1],n)};An.prototype.allPositionsEqual=function(e,n){return this.elt[e].allPositionsEqual(n)};An.prototype.toLine=function(e){this.elt[e].isArea()&&(this.elt[e]=new $n(this.elt[e].location[0]))};An.prototype.interfaces_=function(){return[]};An.prototype.getClass=function(){return An};An.toLineLabel=function(e){for(var n=new An(Oe.NONE),i=0;i<2;i++)n.setLocation(i,e.getLocation(i));return n};var Tr=function(){this._startDe=null,this._maxNodeDegree=-1,this._edges=new gt,this._pts=new gt,this._label=new An(Oe.NONE),this._ring=null,this._isHole=null,this._shell=null,this._holes=new gt,this._geometryFactory=null;var e=arguments[0],n=arguments[1];this._geometryFactory=n,this.computePoints(e),this.computeRing()};Tr.prototype.computeRing=function(){var e=this;if(this._ring!==null)return null;for(var n=new Array(this._pts.size()).fill(null),i=0;i<this._pts.size();i++)n[i]=e._pts.get(i);this._ring=this._geometryFactory.createLinearRing(n),this._isHole=wt.isCCW(this._ring.getCoordinates())};Tr.prototype.isIsolated=function(){return this._label.getGeometryCount()===1};Tr.prototype.computePoints=function(e){var n=this;this._startDe=e;var i=e,u=!0;do{if(i===null)throw new Ol("Found null DirectedEdge");if(i.getEdgeRing()===n)throw new Ol("Directed Edge visited twice during ring-building at "+i.getCoordinate());n._edges.add(i);var h=i.getLabel();Qt.isTrue(h.isArea()),n.mergeLabel(h),n.addPoints(i.getEdge(),i.isForward(),u),u=!1,n.setEdgeRing(i,n),i=n.getNext(i)}while(i!==this._startDe)};Tr.prototype.getLinearRing=function(){return this._ring};Tr.prototype.getCoordinate=function(e){return this._pts.get(e)};Tr.prototype.computeMaxNodeDegree=function(){var e=this;this._maxNodeDegree=0;var n=this._startDe;do{var i=n.getNode(),u=i.getEdges().getOutgoingDegree(e);u>e._maxNodeDegree&&(e._maxNodeDegree=u),n=e.getNext(n)}while(n!==this._startDe);this._maxNodeDegree*=2};Tr.prototype.addPoints=function(e,n,i){var u=this,h=e.getCoordinates();if(n){var d=1;i&&(d=0);for(var s=d;s<h.length;s++)u._pts.add(h[s])}else{var w=h.length-2;i&&(w=h.length-1);for(var T=w;T>=0;T--)u._pts.add(h[T])}};Tr.prototype.isHole=function(){return this._isHole};Tr.prototype.setInResult=function(){var e=this._startDe;do e.getEdge().setInResult(!0),e=e.getNext();while(e!==this._startDe)};Tr.prototype.containsPoint=function(e){var n=this.getLinearRing(),i=n.getEnvelopeInternal();if(!i.contains(e)||!wt.isPointInRing(e,n.getCoordinates()))return!1;for(var u=this._holes.iterator();u.hasNext();){var h=u.next();if(h.containsPoint(e))return!1}return!0};Tr.prototype.addHole=function(e){this._holes.add(e)};Tr.prototype.isShell=function(){return this._shell===null};Tr.prototype.getLabel=function(){return this._label};Tr.prototype.getEdges=function(){return this._edges};Tr.prototype.getMaxNodeDegree=function(){return this._maxNodeDegree<0&&this.computeMaxNodeDegree(),this._maxNodeDegree};Tr.prototype.getShell=function(){return this._shell};Tr.prototype.mergeLabel=function(){if(arguments.length===1){var e=arguments[0];this.mergeLabel(e,0),this.mergeLabel(e,1)}else if(arguments.length===2){var n=arguments[0],i=arguments[1],u=n.getLocation(i,ht.RIGHT);if(u===Oe.NONE)return null;if(this._label.getLocation(i)===Oe.NONE)return this._label.setLocation(i,u),null}};Tr.prototype.setShell=function(e){this._shell=e,e!==null&&e.addHole(this)};Tr.prototype.toPolygon=function(e){for(var n=this,i=new Array(this._holes.size()).fill(null),u=0;u<this._holes.size();u++)i[u]=n._holes.get(u).getLinearRing();var h=e.createPolygon(this.getLinearRing(),i);return h};Tr.prototype.interfaces_=function(){return[]};Tr.prototype.getClass=function(){return Tr};var MU=function(t){function e(){var n=arguments[0],i=arguments[1];t.call(this,n,i)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.setEdgeRing=function(i,u){i.setMinEdgeRing(u)},e.prototype.getNext=function(i){return i.getNextMin()},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(Tr),AU=function(t){function e(){var n=arguments[0],i=arguments[1];t.call(this,n,i)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.buildMinimalRings=function(){var i=this,u=new gt,h=this._startDe;do{if(h.getMinEdgeRing()===null){var d=new MU(h,i._geometryFactory);u.add(d)}h=h.getNext()}while(h!==this._startDe);return u},e.prototype.setEdgeRing=function(i,u){i.setEdgeRing(u)},e.prototype.linkDirectedEdgesForMinimalEdgeRings=function(){var i=this,u=this._startDe;do{var h=u.getNode();h.getEdges().linkMinimalDirectedEdges(i),u=u.getNext()}while(u!==this._startDe)},e.prototype.getNext=function(i){return i.getNext()},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(Tr),So=function(){if(this._label=null,this._isInResult=!1,this._isCovered=!1,this._isCoveredSet=!1,this._isVisited=!1,arguments.length!==0){if(arguments.length===1){var e=arguments[0];this._label=e}}};So.prototype.setVisited=function(e){this._isVisited=e};So.prototype.setInResult=function(e){this._isInResult=e};So.prototype.isCovered=function(){return this._isCovered};So.prototype.isCoveredSet=function(){return this._isCoveredSet};So.prototype.setLabel=function(e){this._label=e};So.prototype.getLabel=function(){return this._label};So.prototype.setCovered=function(e){this._isCovered=e,this._isCoveredSet=!0};So.prototype.updateIM=function(e){Qt.isTrue(this._label.getGeometryCount()>=2,"found partial label"),this.computeIM(e)};So.prototype.isInResult=function(){return this._isInResult};So.prototype.isVisited=function(){return this._isVisited};So.prototype.interfaces_=function(){return[]};So.prototype.getClass=function(){return So};var Ox=function(t){function e(){t.call(this),this._coord=null,this._edges=null;var n=arguments[0],i=arguments[1];this._coord=n,this._edges=i,this._label=new An(0,Oe.NONE)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.isIncidentEdgeInResult=function(){for(var i=this.getEdges().getEdges().iterator();i.hasNext();){var u=i.next();if(u.getEdge().isInResult())return!0}return!1},e.prototype.isIsolated=function(){return this._label.getGeometryCount()===1},e.prototype.getCoordinate=function(){return this._coord},e.prototype.print=function(i){i.println("node "+this._coord+" lbl: "+this._label)},e.prototype.computeIM=function(i){},e.prototype.computeMergedLocation=function(i,u){var h=Oe.NONE;if(h=this._label.getLocation(u),!i.isNull(u)){var d=i.getLocation(u);h!==Oe.BOUNDARY&&(h=d)}return h},e.prototype.setLabel=function(){if(arguments.length===2){var i=arguments[0],u=arguments[1];this._label===null?this._label=new An(i,u):this._label.setLocation(i,u)}else return t.prototype.setLabel.apply(this,arguments)},e.prototype.getEdges=function(){return this._edges},e.prototype.mergeLabel=function(){var i=this;if(arguments[0]instanceof e){var u=arguments[0];this.mergeLabel(u._label)}else if(arguments[0]instanceof An)for(var h=arguments[0],d=0;d<2;d++){var s=i.computeMergedLocation(h,d),w=i._label.getLocation(d);w===Oe.NONE&&i._label.setLocation(d,s)}},e.prototype.add=function(i){this._edges.insert(i),i.setNode(this)},e.prototype.setLabelBoundary=function(i){if(this._label===null)return null;var u=Oe.NONE;this._label!==null&&(u=this._label.getLocation(i));var h=null;switch(u){case Oe.BOUNDARY:h=Oe.INTERIOR;break;case Oe.INTERIOR:h=Oe.BOUNDARY;break;default:h=Oe.BOUNDARY;break}this._label.setLocation(i,h)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(So),oa=function(){this.nodeMap=new yi,this.nodeFact=null;var e=arguments[0];this.nodeFact=e};oa.prototype.find=function(e){return this.nodeMap.get(e)};oa.prototype.addNode=function(){if(arguments[0]instanceof Me){var e=arguments[0],n=this.nodeMap.get(e);return n===null&&(n=this.nodeFact.createNode(e),this.nodeMap.put(e,n)),n}else if(arguments[0]instanceof Ox){var i=arguments[0],u=this.nodeMap.get(i.getCoordinate());return u===null?(this.nodeMap.put(i.getCoordinate(),i),i):(u.mergeLabel(i),u)}};oa.prototype.print=function(e){for(var n=this.iterator();n.hasNext();){var i=n.next();i.print(e)}};oa.prototype.iterator=function(){return this.nodeMap.values().iterator()};oa.prototype.values=function(){return this.nodeMap.values()};oa.prototype.getBoundaryNodes=function(e){for(var n=new gt,i=this.iterator();i.hasNext();){var u=i.next();u.getLabel().getLocation(e)===Oe.BOUNDARY&&n.add(u)}return n};oa.prototype.add=function(e){var n=e.getCoordinate(),i=this.addNode(n);i.add(e)};oa.prototype.interfaces_=function(){return[]};oa.prototype.getClass=function(){return oa};var Pn=function(){},G_={NE:{configurable:!0},NW:{configurable:!0},SW:{configurable:!0},SE:{configurable:!0}};Pn.prototype.interfaces_=function(){return[]};Pn.prototype.getClass=function(){return Pn};Pn.isNorthern=function(e){return e===Pn.NE||e===Pn.NW};Pn.isOpposite=function(e,n){if(e===n)return!1;var i=(e-n+4)%4;return i===2};Pn.commonHalfPlane=function(e,n){if(e===n)return e;var i=(e-n+4)%4;if(i===2)return-1;var u=e<n?e:n,h=e>n?e:n;return u===0&&h===3?3:u};Pn.isInHalfPlane=function(e,n){return n===Pn.SE?e===Pn.SE||e===Pn.SW:e===n||e===n+1};Pn.quadrant=function(){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var e=arguments[0],n=arguments[1];if(e===0&&n===0)throw new er("Cannot compute the quadrant for point ( "+e+", "+n+" )");return e>=0?n>=0?Pn.NE:Pn.SE:n>=0?Pn.NW:Pn.SW}else if(arguments[0]instanceof Me&&arguments[1]instanceof Me){var i=arguments[0],u=arguments[1];if(u.x===i.x&&u.y===i.y)throw new er("Cannot compute the quadrant for two identical points "+i);return u.x>=i.x?u.y>=i.y?Pn.NE:Pn.SE:u.y>=i.y?Pn.NW:Pn.SW}};G_.NE.get=function(){return 0};G_.NW.get=function(){return 1};G_.SW.get=function(){return 2};G_.SE.get=function(){return 3};Object.defineProperties(Pn,G_);var vi=function(){if(this._edge=null,this._label=null,this._node=null,this._p0=null,this._p1=null,this._dx=null,this._dy=null,this._quadrant=null,arguments.length===1){var e=arguments[0];this._edge=e}else if(arguments.length===3){var n=arguments[0],i=arguments[1],u=arguments[2],h=null;this._edge=n,this.init(i,u),this._label=h}else if(arguments.length===4){var d=arguments[0],s=arguments[1],w=arguments[2],T=arguments[3];this._edge=d,this.init(s,w),this._label=T}};vi.prototype.compareDirection=function(e){return this._dx===e._dx&&this._dy===e._dy?0:this._quadrant>e._quadrant?1:this._quadrant<e._quadrant?-1:wt.computeOrientation(e._p0,e._p1,this._p1)};vi.prototype.getDy=function(){return this._dy};vi.prototype.getCoordinate=function(){return this._p0};vi.prototype.setNode=function(e){this._node=e};vi.prototype.print=function(e){var n=Math.atan2(this._dy,this._dx),i=this.getClass().getName(),u=i.lastIndexOf("."),h=i.substring(u+1);e.print("  "+h+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+n+"   "+this._label)};vi.prototype.compareTo=function(e){var n=e;return this.compareDirection(n)};vi.prototype.getDirectedCoordinate=function(){return this._p1};vi.prototype.getDx=function(){return this._dx};vi.prototype.getLabel=function(){return this._label};vi.prototype.getEdge=function(){return this._edge};vi.prototype.getQuadrant=function(){return this._quadrant};vi.prototype.getNode=function(){return this._node};vi.prototype.toString=function(){var e=Math.atan2(this._dy,this._dx),n=this.getClass().getName(),i=n.lastIndexOf("."),u=n.substring(i+1);return"  "+u+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+e+"   "+this._label};vi.prototype.computeLabel=function(e){};vi.prototype.init=function(e,n){this._p0=e,this._p1=n,this._dx=n.x-e.x,this._dy=n.y-e.y,this._quadrant=Pn.quadrant(this._dx,this._dy),Qt.isTrue(!(this._dx===0&&this._dy===0),"EdgeEnd with identical endpoints found")};vi.prototype.interfaces_=function(){return[ts]};vi.prototype.getClass=function(){return vi};var lE=function(t){function e(){var n=arguments[0],i=arguments[1];if(t.call(this,n),this._isForward=null,this._isInResult=!1,this._isVisited=!1,this._sym=null,this._next=null,this._nextMin=null,this._edgeRing=null,this._minEdgeRing=null,this._depth=[0,-999,-999],this._isForward=i,i)this.init(n.getCoordinate(0),n.getCoordinate(1));else{var u=n.getNumPoints()-1;this.init(n.getCoordinate(u),n.getCoordinate(u-1))}this.computeDirectedLabel()}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getNextMin=function(){return this._nextMin},e.prototype.getDepth=function(i){return this._depth[i]},e.prototype.setVisited=function(i){this._isVisited=i},e.prototype.computeDirectedLabel=function(){this._label=new An(this._edge.getLabel()),this._isForward||this._label.flip()},e.prototype.getNext=function(){return this._next},e.prototype.setDepth=function(i,u){if(this._depth[i]!==-999&&this._depth[i]!==u)throw new Ol("assigned depths do not match",this.getCoordinate());this._depth[i]=u},e.prototype.isInteriorAreaEdge=function(){for(var i=this,u=!0,h=0;h<2;h++)i._label.isArea(h)&&i._label.getLocation(h,ht.LEFT)===Oe.INTERIOR&&i._label.getLocation(h,ht.RIGHT)===Oe.INTERIOR||(u=!1);return u},e.prototype.setNextMin=function(i){this._nextMin=i},e.prototype.print=function(i){t.prototype.print.call(this,i),i.print(" "+this._depth[ht.LEFT]+"/"+this._depth[ht.RIGHT]),i.print(" ("+this.getDepthDelta()+")"),this._isInResult&&i.print(" inResult")},e.prototype.setMinEdgeRing=function(i){this._minEdgeRing=i},e.prototype.isLineEdge=function(){var i=this._label.isLine(0)||this._label.isLine(1),u=!this._label.isArea(0)||this._label.allPositionsEqual(0,Oe.EXTERIOR),h=!this._label.isArea(1)||this._label.allPositionsEqual(1,Oe.EXTERIOR);return i&&u&&h},e.prototype.setEdgeRing=function(i){this._edgeRing=i},e.prototype.getMinEdgeRing=function(){return this._minEdgeRing},e.prototype.getDepthDelta=function(){var i=this._edge.getDepthDelta();return this._isForward||(i=-i),i},e.prototype.setInResult=function(i){this._isInResult=i},e.prototype.getSym=function(){return this._sym},e.prototype.isForward=function(){return this._isForward},e.prototype.getEdge=function(){return this._edge},e.prototype.printEdge=function(i){this.print(i),i.print(" "),this._isForward?this._edge.print(i):this._edge.printReverse(i)},e.prototype.setSym=function(i){this._sym=i},e.prototype.setVisitedEdge=function(i){this.setVisited(i),this._sym.setVisited(i)},e.prototype.setEdgeDepths=function(i,u){var h=this.getEdge().getDepthDelta();this._isForward||(h=-h);var d=1;i===ht.LEFT&&(d=-1);var s=ht.opposite(i),w=h*d,T=u+w;this.setDepth(i,u),this.setDepth(s,T)},e.prototype.getEdgeRing=function(){return this._edgeRing},e.prototype.isInResult=function(){return this._isInResult},e.prototype.setNext=function(i){this._next=i},e.prototype.isVisited=function(){return this._isVisited},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e.depthFactor=function(i,u){return i===Oe.EXTERIOR&&u===Oe.INTERIOR?1:i===Oe.INTERIOR&&u===Oe.EXTERIOR?-1:0},e}(vi),xd=function(){};xd.prototype.createNode=function(e){return new Ox(e,null)};xd.prototype.interfaces_=function(){return[]};xd.prototype.getClass=function(){return xd};var sr=function(){if(this._edges=new gt,this._nodes=null,this._edgeEndList=new gt,arguments.length===0)this._nodes=new oa(new xd);else if(arguments.length===1){var e=arguments[0];this._nodes=new oa(e)}};sr.prototype.printEdges=function(e){var n=this;e.println("Edges:");for(var i=0;i<this._edges.size();i++){e.println("edge "+i+":");var u=n._edges.get(i);u.print(e),u.eiList.print(e)}};sr.prototype.find=function(e){return this._nodes.find(e)};sr.prototype.addNode=function(){if(arguments[0]instanceof Ox){var e=arguments[0];return this._nodes.addNode(e)}else if(arguments[0]instanceof Me){var n=arguments[0];return this._nodes.addNode(n)}};sr.prototype.getNodeIterator=function(){return this._nodes.iterator()};sr.prototype.linkResultDirectedEdges=function(){for(var e=this._nodes.iterator();e.hasNext();){var n=e.next();n.getEdges().linkResultDirectedEdges()}};sr.prototype.debugPrintln=function(e){li.out.println(e)};sr.prototype.isBoundaryNode=function(e,n){var i=this._nodes.find(n);if(i===null)return!1;var u=i.getLabel();return u!==null&&u.getLocation(e)===Oe.BOUNDARY};sr.prototype.linkAllDirectedEdges=function(){for(var e=this._nodes.iterator();e.hasNext();){var n=e.next();n.getEdges().linkAllDirectedEdges()}};sr.prototype.matchInSameDirection=function(e,n,i,u){return e.equals(i)?wt.computeOrientation(e,n,u)===wt.COLLINEAR&&Pn.quadrant(e,n)===Pn.quadrant(i,u):!1};sr.prototype.getEdgeEnds=function(){return this._edgeEndList};sr.prototype.debugPrint=function(e){li.out.print(e)};sr.prototype.getEdgeIterator=function(){return this._edges.iterator()};sr.prototype.findEdgeInSameDirection=function(e,n){for(var i=this,u=0;u<this._edges.size();u++){var h=i._edges.get(u),d=h.getCoordinates();if(i.matchInSameDirection(e,n,d[0],d[1])||i.matchInSameDirection(e,n,d[d.length-1],d[d.length-2]))return h}return null};sr.prototype.insertEdge=function(e){this._edges.add(e)};sr.prototype.findEdgeEnd=function(e){for(var n=this.getEdgeEnds().iterator();n.hasNext();){var i=n.next();if(i.getEdge()===e)return i}return null};sr.prototype.addEdges=function(e){for(var n=this,i=e.iterator();i.hasNext();){var u=i.next();n._edges.add(u);var h=new lE(u,!0),d=new lE(u,!1);h.setSym(d),d.setSym(h),n.add(h),n.add(d)}};sr.prototype.add=function(e){this._nodes.add(e),this._edgeEndList.add(e)};sr.prototype.getNodes=function(){return this._nodes.values()};sr.prototype.findEdge=function(e,n){for(var i=this,u=0;u<this._edges.size();u++){var h=i._edges.get(u),d=h.getCoordinates();if(e.equals(d[0])&&n.equals(d[1]))return h}return null};sr.prototype.interfaces_=function(){return[]};sr.prototype.getClass=function(){return sr};sr.linkResultDirectedEdges=function(e){for(var n=e.iterator();n.hasNext();){var i=n.next();i.getEdges().linkResultDirectedEdges()}};var uo=function(){this._geometryFactory=null,this._shellList=new gt;var e=arguments[0];this._geometryFactory=e};uo.prototype.sortShellsAndHoles=function(e,n,i){for(var u=e.iterator();u.hasNext();){var h=u.next();h.isHole()?i.add(h):n.add(h)}};uo.prototype.computePolygons=function(e){for(var n=this,i=new gt,u=e.iterator();u.hasNext();){var h=u.next(),d=h.toPolygon(n._geometryFactory);i.add(d)}return i};uo.prototype.placeFreeHoles=function(e,n){for(var i=this,u=n.iterator();u.hasNext();){var h=u.next();if(h.getShell()===null){var d=i.findEdgeRingContaining(h,e);if(d===null)throw new Ol("unable to assign hole to a shell",h.getCoordinate(0));h.setShell(d)}}};uo.prototype.buildMinimalEdgeRings=function(e,n,i){for(var u=this,h=new gt,d=e.iterator();d.hasNext();){var s=d.next();if(s.getMaxNodeDegree()>2){s.linkDirectedEdgesForMinimalEdgeRings();var w=s.buildMinimalRings(),T=u.findShell(w);T!==null?(u.placePolygonHoles(T,w),n.add(T)):i.addAll(w)}else h.add(s)}return h};uo.prototype.containsPoint=function(e){for(var n=this._shellList.iterator();n.hasNext();){var i=n.next();if(i.containsPoint(e))return!0}return!1};uo.prototype.buildMaximalEdgeRings=function(e){for(var n=this,i=new gt,u=e.iterator();u.hasNext();){var h=u.next();if(h.isInResult()&&h.getLabel().isArea()&&h.getEdgeRing()===null){var d=new AU(h,n._geometryFactory);i.add(d),d.setInResult()}}return i};uo.prototype.placePolygonHoles=function(e,n){for(var i=n.iterator();i.hasNext();){var u=i.next();u.isHole()&&u.setShell(e)}};uo.prototype.getPolygons=function(){var e=this.computePolygons(this._shellList);return e};uo.prototype.findEdgeRingContaining=function(e,n){for(var i=e.getLinearRing(),u=i.getEnvelopeInternal(),h=i.getCoordinateN(0),d=null,s=null,w=n.iterator();w.hasNext();){var T=w.next(),A=T.getLinearRing(),D=A.getEnvelopeInternal();d!==null&&(s=d.getLinearRing().getEnvelopeInternal());var R=!1;D.contains(u)&&wt.isPointInRing(h,A.getCoordinates())&&(R=!0),R&&(d===null||s.contains(D))&&(d=T)}return d};uo.prototype.findShell=function(e){for(var n=0,i=null,u=e.iterator();u.hasNext();){var h=u.next();h.isHole()||(i=h,n++)}return Qt.isTrue(n<=1,"found two shells in MinimalEdgeRing list"),i};uo.prototype.add=function(){if(arguments.length===1){var e=arguments[0];this.add(e.getEdgeEnds(),e.getNodes())}else if(arguments.length===2){var n=arguments[0],i=arguments[1];sr.linkResultDirectedEdges(i);var u=this.buildMaximalEdgeRings(n),h=new gt,d=this.buildMinimalEdgeRings(u,this._shellList,h);this.sortShellsAndHoles(d,this._shellList,h),this.placeFreeHoles(this._shellList,h)}};uo.prototype.interfaces_=function(){return[]};uo.prototype.getClass=function(){return uo};var wd=function(){};wd.prototype.getBounds=function(){};wd.prototype.interfaces_=function(){return[]};wd.prototype.getClass=function(){return wd};var bs=function(){this._bounds=null,this._item=null;var e=arguments[0],n=arguments[1];this._bounds=e,this._item=n};bs.prototype.getItem=function(){return this._item};bs.prototype.getBounds=function(){return this._bounds};bs.prototype.interfaces_=function(){return[wd,ns]};bs.prototype.getClass=function(){return bs};var zl=function(){this._size=null,this._items=null,this._size=0,this._items=new gt,this._items.add(null)};zl.prototype.poll=function(){if(this.isEmpty())return null;var e=this._items.get(1);return this._items.set(1,this._items.get(this._size)),this._size-=1,this.reorder(1),e};zl.prototype.size=function(){return this._size};zl.prototype.reorder=function(e){for(var n=this,i=null,u=this._items.get(e);e*2<=this._size&&(i=e*2,i!==n._size&&n._items.get(i+1).compareTo(n._items.get(i))<0&&i++,n._items.get(i).compareTo(u)<0);e=i)n._items.set(e,n._items.get(i));this._items.set(e,u)};zl.prototype.clear=function(){this._size=0,this._items.clear()};zl.prototype.isEmpty=function(){return this._size===0};zl.prototype.add=function(e){var n=this;this._items.add(null),this._size+=1;var i=this._size;for(this._items.set(0,e);e.compareTo(this._items.get(Math.trunc(i/2)))<0;i/=2)n._items.set(i,n._items.get(Math.trunc(i/2)));this._items.set(i,e)};zl.prototype.interfaces_=function(){return[]};zl.prototype.getClass=function(){return zl};var Iu=function(){};Iu.prototype.visitItem=function(e){};Iu.prototype.interfaces_=function(){return[]};Iu.prototype.getClass=function(){return Iu};var ff=function(){};ff.prototype.insert=function(e,n){};ff.prototype.remove=function(e,n){};ff.prototype.query=function(){};ff.prototype.interfaces_=function(){return[]};ff.prototype.getClass=function(){return ff};var Br=function(){if(this._childBoundables=new gt,this._bounds=null,this._level=null,arguments.length!==0){if(arguments.length===1){var e=arguments[0];this._level=e}}},oD={serialVersionUID:{configurable:!0}};Br.prototype.getLevel=function(){return this._level};Br.prototype.size=function(){return this._childBoundables.size()};Br.prototype.getChildBoundables=function(){return this._childBoundables};Br.prototype.addChildBoundable=function(e){Qt.isTrue(this._bounds===null),this._childBoundables.add(e)};Br.prototype.isEmpty=function(){return this._childBoundables.isEmpty()};Br.prototype.getBounds=function(){return this._bounds===null&&(this._bounds=this.computeBounds()),this._bounds};Br.prototype.interfaces_=function(){return[wd,ns]};Br.prototype.getClass=function(){return Br};oD.serialVersionUID.get=function(){return 6493722185909574e3};Object.defineProperties(Br,oD);var Es=function(){};Es.reverseOrder=function(){return{compare:function(n,i){return i.compareTo(n)}}};Es.min=function(e){return Es.sort(e),e.get(0)};Es.sort=function(e,n){var i=e.toArray();n?Nc.sort(i,n):Nc.sort(i);for(var u=e.iterator(),h=0,d=i.length;h<d;h++)u.next(),u.set(i[h])};Es.singletonList=function(e){var n=new gt;return n.add(e),n};var Er=function(){this._boundable1=null,this._boundable2=null,this._distance=null,this._itemDistance=null;var e=arguments[0],n=arguments[1],i=arguments[2];this._boundable1=e,this._boundable2=n,this._itemDistance=i,this._distance=this.distance()};Er.prototype.expandToQueue=function(e,n){var i=Er.isComposite(this._boundable1),u=Er.isComposite(this._boundable2);if(i&&u)return Er.area(this._boundable1)>Er.area(this._boundable2)?(this.expand(this._boundable1,this._boundable2,e,n),null):(this.expand(this._boundable2,this._boundable1,e,n),null);if(i)return this.expand(this._boundable1,this._boundable2,e,n),null;if(u)return this.expand(this._boundable2,this._boundable1,e,n),null;throw new er("neither boundable is composite")};Er.prototype.isLeaves=function(){return!(Er.isComposite(this._boundable1)||Er.isComposite(this._boundable2))};Er.prototype.compareTo=function(e){var n=e;return this._distance<n._distance?-1:this._distance>n._distance?1:0};Er.prototype.expand=function(e,n,i,u){for(var h=this,d=e.getChildBoundables(),s=d.iterator();s.hasNext();){var w=s.next(),T=new Er(w,n,h._itemDistance);T.getDistance()<u&&i.add(T)}};Er.prototype.getBoundable=function(e){return e===0?this._boundable1:this._boundable2};Er.prototype.getDistance=function(){return this._distance};Er.prototype.distance=function(){return this.isLeaves()?this._itemDistance.distance(this._boundable1,this._boundable2):this._boundable1.getBounds().distance(this._boundable2.getBounds())};Er.prototype.interfaces_=function(){return[ts]};Er.prototype.getClass=function(){return Er};Er.area=function(e){return e.getBounds().getArea()};Er.isComposite=function(e){return e instanceof Br};var Wr=function t(){if(this._root=null,this._built=!1,this._itemBoundables=new gt,this._nodeCapacity=null,arguments.length===0){var e=t.DEFAULT_NODE_CAPACITY;this._nodeCapacity=e}else if(arguments.length===1){var n=arguments[0];Qt.isTrue(n>1,"Node capacity must be greater than 1"),this._nodeCapacity=n}},zx={IntersectsOp:{configurable:!0},serialVersionUID:{configurable:!0},DEFAULT_NODE_CAPACITY:{configurable:!0}};Wr.prototype.getNodeCapacity=function(){return this._nodeCapacity};Wr.prototype.lastNode=function(e){return e.get(e.size()-1)};Wr.prototype.size=function(){var e=this;if(arguments.length===0)return this.isEmpty()?0:(this.build(),this.size(this._root));if(arguments.length===1){for(var n=arguments[0],i=0,u=n.getChildBoundables().iterator();u.hasNext();){var h=u.next();h instanceof Br?i+=e.size(h):h instanceof bs&&(i+=1)}return i}};Wr.prototype.removeItem=function(e,n){for(var i=null,u=e.getChildBoundables().iterator();u.hasNext();){var h=u.next();h instanceof bs&&h.getItem()===n&&(i=h)}return i!==null?(e.getChildBoundables().remove(i),!0):!1};Wr.prototype.itemsTree=function(){var e=this;if(arguments.length===0){this.build();var n=this.itemsTree(this._root);return n===null?new gt:n}else if(arguments.length===1){for(var i=arguments[0],u=new gt,h=i.getChildBoundables().iterator();h.hasNext();){var d=h.next();if(d instanceof Br){var s=e.itemsTree(d);s!==null&&u.add(s)}else d instanceof bs?u.add(d.getItem()):Qt.shouldNeverReachHere()}return u.size()<=0?null:u}};Wr.prototype.insert=function(e,n){Qt.isTrue(!this._built,"Cannot insert items into an STR packed R-tree after it has been built."),this._itemBoundables.add(new bs(e,n))};Wr.prototype.boundablesAtLevel=function(){var e=this;if(arguments.length===1){var n=arguments[0],i=new gt;return this.boundablesAtLevel(n,this._root,i),i}else if(arguments.length===3){var u=arguments[0],h=arguments[1],d=arguments[2];if(Qt.isTrue(u>-2),h.getLevel()===u)return d.add(h),null;for(var s=h.getChildBoundables().iterator();s.hasNext();){var w=s.next();w instanceof Br?e.boundablesAtLevel(u,w,d):(Qt.isTrue(w instanceof bs),u===-1&&d.add(w))}return null}};Wr.prototype.query=function(){var e=this;if(arguments.length===1){var n=arguments[0];this.build();var i=new gt;return this.isEmpty()||this.getIntersectsOp().intersects(this._root.getBounds(),n)&&this.query(n,this._root,i),i}else if(arguments.length===2){var u=arguments[0],h=arguments[1];if(this.build(),this.isEmpty())return null;this.getIntersectsOp().intersects(this._root.getBounds(),u)&&this.query(u,this._root,h)}else if(arguments.length===3){if(Ut(arguments[2],Iu)&&arguments[0]instanceof Object&&arguments[1]instanceof Br)for(var d=arguments[0],s=arguments[1],w=arguments[2],T=s.getChildBoundables(),A=0;A<T.size();A++){var D=T.get(A);e.getIntersectsOp().intersects(D.getBounds(),d)&&(D instanceof Br?e.query(d,D,w):D instanceof bs?w.visitItem(D.getItem()):Qt.shouldNeverReachHere())}else if(Ut(arguments[2],gs)&&arguments[0]instanceof Object&&arguments[1]instanceof Br)for(var R=arguments[0],G=arguments[1],$=arguments[2],ie=G.getChildBoundables(),_e=0;_e<ie.size();_e++){var Y=ie.get(_e);e.getIntersectsOp().intersects(Y.getBounds(),R)&&(Y instanceof Br?e.query(R,Y,$):Y instanceof bs?$.add(Y.getItem()):Qt.shouldNeverReachHere())}}};Wr.prototype.build=function(){if(this._built)return null;this._root=this._itemBoundables.isEmpty()?this.createNode(0):this.createHigherLevels(this._itemBoundables,-1),this._itemBoundables=null,this._built=!0};Wr.prototype.getRoot=function(){return this.build(),this._root};Wr.prototype.remove=function(){var e=this;if(arguments.length===2){var n=arguments[0],i=arguments[1];return this.build(),this.getIntersectsOp().intersects(this._root.getBounds(),n)?this.remove(n,this._root,i):!1}else if(arguments.length===3){var u=arguments[0],h=arguments[1],d=arguments[2],s=this.removeItem(h,d);if(s)return!0;for(var w=null,T=h.getChildBoundables().iterator();T.hasNext();){var A=T.next();if(e.getIntersectsOp().intersects(A.getBounds(),u)&&A instanceof Br&&(s=e.remove(u,A,d),s)){w=A;break}}return w!==null&&w.getChildBoundables().isEmpty()&&h.getChildBoundables().remove(w),s}};Wr.prototype.createHigherLevels=function(e,n){Qt.isTrue(!e.isEmpty());var i=this.createParentBoundables(e,n+1);return i.size()===1?i.get(0):this.createHigherLevels(i,n+1)};Wr.prototype.depth=function(){var e=this;if(arguments.length===0)return this.isEmpty()?0:(this.build(),this.depth(this._root));if(arguments.length===1){for(var n=arguments[0],i=0,u=n.getChildBoundables().iterator();u.hasNext();){var h=u.next();if(h instanceof Br){var d=e.depth(h);d>i&&(i=d)}}return i+1}};Wr.prototype.createParentBoundables=function(e,n){var i=this;Qt.isTrue(!e.isEmpty());var u=new gt;u.add(this.createNode(n));var h=new gt(e);Es.sort(h,this.getComparator());for(var d=h.iterator();d.hasNext();){var s=d.next();i.lastNode(u).getChildBoundables().size()===i.getNodeCapacity()&&u.add(i.createNode(n)),i.lastNode(u).addChildBoundable(s)}return u};Wr.prototype.isEmpty=function(){return this._built?this._root.isEmpty():this._itemBoundables.isEmpty()};Wr.prototype.interfaces_=function(){return[ns]};Wr.prototype.getClass=function(){return Wr};Wr.compareDoubles=function(e,n){return e>n?1:e<n?-1:0};zx.IntersectsOp.get=function(){return PU};zx.serialVersionUID.get=function(){return-3886435814360241e3};zx.DEFAULT_NODE_CAPACITY.get=function(){return 10};Object.defineProperties(Wr,zx);var PU=function(){},bd=function(){};bd.prototype.distance=function(e,n){};bd.prototype.interfaces_=function(){return[]};bd.prototype.getClass=function(){return bd};var sD=function(t){function e(i){i=i||e.DEFAULT_NODE_CAPACITY,t.call(this,i)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={STRtreeNode:{configurable:!0},serialVersionUID:{configurable:!0},xComparator:{configurable:!0},yComparator:{configurable:!0},intersectsOp:{configurable:!0},DEFAULT_NODE_CAPACITY:{configurable:!0}};return e.prototype.createParentBoundablesFromVerticalSlices=function(u,h){var d=this;Qt.isTrue(u.length>0);for(var s=new gt,w=0;w<u.length;w++)s.addAll(d.createParentBoundablesFromVerticalSlice(u[w],h));return s},e.prototype.createNode=function(u){return new vM(u)},e.prototype.size=function(){return arguments.length===0?t.prototype.size.call(this):t.prototype.size.apply(this,arguments)},e.prototype.insert=function(){if(arguments.length===2){var u=arguments[0],h=arguments[1];if(u.isNull())return null;t.prototype.insert.call(this,u,h)}else return t.prototype.insert.apply(this,arguments)},e.prototype.getIntersectsOp=function(){return e.intersectsOp},e.prototype.verticalSlices=function(u,h){for(var d=Math.trunc(Math.ceil(u.size()/h)),s=new Array(h).fill(null),w=u.iterator(),T=0;T<h;T++){s[T]=new gt;for(var A=0;w.hasNext()&&A<d;){var D=w.next();s[T].add(D),A++}}return s},e.prototype.query=function(){if(arguments.length===1){var u=arguments[0];return t.prototype.query.call(this,u)}else if(arguments.length===2){var h=arguments[0],d=arguments[1];t.prototype.query.call(this,h,d)}else if(arguments.length===3){if(Ut(arguments[2],Iu)&&arguments[0]instanceof Object&&arguments[1]instanceof Br){var s=arguments[0],w=arguments[1],T=arguments[2];t.prototype.query.call(this,s,w,T)}else if(Ut(arguments[2],gs)&&arguments[0]instanceof Object&&arguments[1]instanceof Br){var A=arguments[0],D=arguments[1],R=arguments[2];t.prototype.query.call(this,A,D,R)}}},e.prototype.getComparator=function(){return e.yComparator},e.prototype.createParentBoundablesFromVerticalSlice=function(u,h){return t.prototype.createParentBoundables.call(this,u,h)},e.prototype.remove=function(){if(arguments.length===2){var u=arguments[0],h=arguments[1];return t.prototype.remove.call(this,u,h)}else return t.prototype.remove.apply(this,arguments)},e.prototype.depth=function(){return arguments.length===0?t.prototype.depth.call(this):t.prototype.depth.apply(this,arguments)},e.prototype.createParentBoundables=function(u,h){Qt.isTrue(!u.isEmpty());var d=Math.trunc(Math.ceil(u.size()/this.getNodeCapacity())),s=new gt(u);Es.sort(s,e.xComparator);var w=this.verticalSlices(s,Math.trunc(Math.ceil(Math.sqrt(d))));return this.createParentBoundablesFromVerticalSlices(w,h)},e.prototype.nearestNeighbour=function(){if(arguments.length===1){if(Ut(arguments[0],bd)){var u=arguments[0],h=new Er(this.getRoot(),this.getRoot(),u);return this.nearestNeighbour(h)}else if(arguments[0]instanceof Er){var d=arguments[0];return this.nearestNeighbour(d,Gt.POSITIVE_INFINITY)}}else if(arguments.length===2){if(arguments[0]instanceof e&&Ut(arguments[1],bd)){var s=arguments[0],w=arguments[1],T=new Er(this.getRoot(),s.getRoot(),w);return this.nearestNeighbour(T)}else if(arguments[0]instanceof Er&&typeof arguments[1]=="number"){var A=arguments[0],D=arguments[1],R=D,G=null,$=new zl;for($.add(A);!$.isEmpty()&&R>0;){var ie=$.poll(),_e=ie.getDistance();if(_e>=R)break;ie.isLeaves()?(R=_e,G=ie):ie.expandToQueue($,R)}return[G.getBoundable(0).getItem(),G.getBoundable(1).getItem()]}}else if(arguments.length===3){var Y=arguments[0],B=arguments[1],q=arguments[2],oe=new bs(Y,B),de=new Er(this.getRoot(),oe,q);return this.nearestNeighbour(de)[0]}},e.prototype.interfaces_=function(){return[ff,ns]},e.prototype.getClass=function(){return e},e.centreX=function(u){return e.avg(u.getMinX(),u.getMaxX())},e.avg=function(u,h){return(u+h)/2},e.centreY=function(u){return e.avg(u.getMinY(),u.getMaxY())},n.STRtreeNode.get=function(){return vM},n.serialVersionUID.get=function(){return 0x39920f7d5f261e0},n.xComparator.get=function(){return{interfaces_:function(){return[fd]},compare:function(i,u){return t.compareDoubles(e.centreX(i.getBounds()),e.centreX(u.getBounds()))}}},n.yComparator.get=function(){return{interfaces_:function(){return[fd]},compare:function(i,u){return t.compareDoubles(e.centreY(i.getBounds()),e.centreY(u.getBounds()))}}},n.intersectsOp.get=function(){return{interfaces_:function(){return[t.IntersectsOp]},intersects:function(i,u){return i.intersects(u)}}},n.DEFAULT_NODE_CAPACITY.get=function(){return 10},Object.defineProperties(e,n),e}(Wr),vM=function(t){function e(){var n=arguments[0];t.call(this,n)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.computeBounds=function(){for(var i=null,u=this.getChildBoundables().iterator();u.hasNext();){var h=u.next();i===null?i=new Dt(h.getBounds()):i.expandToInclude(h.getBounds())}return i},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(Br),Vi=function(){};Vi.prototype.interfaces_=function(){return[]};Vi.prototype.getClass=function(){return Vi};Vi.relativeSign=function(e,n){return e<n?-1:e>n?1:0};Vi.compare=function(e,n,i){if(n.equals2D(i))return 0;var u=Vi.relativeSign(n.x,i.x),h=Vi.relativeSign(n.y,i.y);switch(e){case 0:return Vi.compareValue(u,h);case 1:return Vi.compareValue(h,u);case 2:return Vi.compareValue(h,-u);case 3:return Vi.compareValue(-u,h);case 4:return Vi.compareValue(-u,-h);case 5:return Vi.compareValue(-h,-u);case 6:return Vi.compareValue(-h,u);case 7:return Vi.compareValue(u,-h)}return Qt.shouldNeverReachHere("invalid octant value"),0};Vi.compareValue=function(e,n){return e<0?-1:e>0?1:n<0?-1:n>0?1:0};var Mu=function(){this._segString=null,this.coord=null,this.segmentIndex=null,this._segmentOctant=null,this._isInterior=null;var e=arguments[0],n=arguments[1],i=arguments[2],u=arguments[3];this._segString=e,this.coord=new Me(n),this.segmentIndex=i,this._segmentOctant=u,this._isInterior=!n.equals2D(e.getCoordinate(i))};Mu.prototype.getCoordinate=function(){return this.coord};Mu.prototype.print=function(e){e.print(this.coord),e.print(" seg # = "+this.segmentIndex)};Mu.prototype.compareTo=function(e){var n=e;return this.segmentIndex<n.segmentIndex?-1:this.segmentIndex>n.segmentIndex?1:this.coord.equals2D(n.coord)?0:Vi.compare(this._segmentOctant,this.coord,n.coord)};Mu.prototype.isEndPoint=function(e){return this.segmentIndex===0&&!this._isInterior||this.segmentIndex===e};Mu.prototype.isInterior=function(){return this._isInterior};Mu.prototype.interfaces_=function(){return[ts]};Mu.prototype.getClass=function(){return Mu};var ki=function(){this._nodeMap=new yi,this._edge=null;var e=arguments[0];this._edge=e};ki.prototype.getSplitCoordinates=function(){var e=this,n=new V_;this.addEndpoints();for(var i=this.iterator(),u=i.next();i.hasNext();){var h=i.next();e.addEdgeCoordinates(u,h,n),u=h}return n.toCoordinateArray()};ki.prototype.addCollapsedNodes=function(){var e=this,n=new gt;this.findCollapsesFromInsertedNodes(n),this.findCollapsesFromExistingVertices(n);for(var i=n.iterator();i.hasNext();){var u=i.next().intValue();e.add(e._edge.getCoordinate(u),u)}};ki.prototype.print=function(e){e.println("Intersections:");for(var n=this.iterator();n.hasNext();){var i=n.next();i.print(e)}};ki.prototype.findCollapsesFromExistingVertices=function(e){for(var n=this,i=0;i<this._edge.size()-2;i++){var u=n._edge.getCoordinate(i),h=n._edge.getCoordinate(i+2);u.equals2D(h)&&e.add(new ea(i+1))}};ki.prototype.addEdgeCoordinates=function(e,n,i){var u=this,h=this._edge.getCoordinate(n.segmentIndex),d=n.isInterior()||!n.coord.equals2D(h);i.add(new Me(e.coord),!1);for(var s=e.segmentIndex+1;s<=n.segmentIndex;s++)i.add(u._edge.getCoordinate(s));d&&i.add(new Me(n.coord))};ki.prototype.iterator=function(){return this._nodeMap.values().iterator()};ki.prototype.addSplitEdges=function(e){var n=this;this.addEndpoints(),this.addCollapsedNodes();for(var i=this.iterator(),u=i.next();i.hasNext();){var h=i.next(),d=n.createSplitEdge(u,h);e.add(d),u=h}};ki.prototype.findCollapseIndex=function(e,n,i){if(!e.coord.equals2D(n.coord))return!1;var u=n.segmentIndex-e.segmentIndex;return n.isInterior()||u--,u===1?(i[0]=e.segmentIndex+1,!0):!1};ki.prototype.findCollapsesFromInsertedNodes=function(e){for(var n=this,i=new Array(1).fill(null),u=this.iterator(),h=u.next();u.hasNext();){var d=u.next(),s=n.findCollapseIndex(h,d,i);s&&e.add(new ea(i[0])),h=d}};ki.prototype.getEdge=function(){return this._edge};ki.prototype.addEndpoints=function(){var e=this._edge.size()-1;this.add(this._edge.getCoordinate(0),0),this.add(this._edge.getCoordinate(e),e)};ki.prototype.createSplitEdge=function(e,n){var i=this,u=n.segmentIndex-e.segmentIndex+2,h=this._edge.getCoordinate(n.segmentIndex),d=n.isInterior()||!n.coord.equals2D(h);d||u--;var s=new Array(u).fill(null),w=0;s[w++]=new Me(e.coord);for(var T=e.segmentIndex+1;T<=n.segmentIndex;T++)s[w++]=i._edge.getCoordinate(T);return d&&(s[w]=new Me(n.coord)),new vr(s,this._edge.getData())};ki.prototype.add=function(e,n){var i=new Mu(this._edge,e,n,this._edge.getSegmentOctant(n)),u=this._nodeMap.get(i);return u!==null?(Qt.isTrue(u.coord.equals2D(e),"Found equal nodes with different coordinates"),u):(this._nodeMap.put(i,i),i)};ki.prototype.checkSplitEdgesCorrectness=function(e){var n=this._edge.getCoordinates(),i=e.get(0),u=i.getCoordinate(0);if(!u.equals2D(n[0]))throw new Nl("bad split edge start point at "+u);var h=e.get(e.size()-1),d=h.getCoordinates(),s=d[d.length-1];if(!s.equals2D(n[n.length-1]))throw new Nl("bad split edge end point at "+s)};ki.prototype.interfaces_=function(){return[]};ki.prototype.getClass=function(){return ki};var pf=function(){};pf.prototype.interfaces_=function(){return[]};pf.prototype.getClass=function(){return pf};pf.octant=function(){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var e=arguments[0],n=arguments[1];if(e===0&&n===0)throw new er("Cannot compute the octant for point ( "+e+", "+n+" )");var i=Math.abs(e),u=Math.abs(n);return e>=0?n>=0?i>=u?0:1:i>=u?7:6:n>=0?i>=u?3:2:i>=u?4:5}else if(arguments[0]instanceof Me&&arguments[1]instanceof Me){var h=arguments[0],d=arguments[1],s=d.x-h.x,w=d.y-h.y;if(s===0&&w===0)throw new er("Cannot compute the octant for two identical points "+h);return pf.octant(s,w)}};var Ka=function(){};Ka.prototype.getCoordinates=function(){};Ka.prototype.size=function(){};Ka.prototype.getCoordinate=function(e){};Ka.prototype.isClosed=function(){};Ka.prototype.setData=function(e){};Ka.prototype.getData=function(){};Ka.prototype.interfaces_=function(){return[]};Ka.prototype.getClass=function(){return Ka};var S_=function(){};S_.prototype.addIntersection=function(e,n){};S_.prototype.interfaces_=function(){return[Ka]};S_.prototype.getClass=function(){return S_};var vr=function(){this._nodeList=new ki(this),this._pts=null,this._data=null;var e=arguments[0],n=arguments[1];this._pts=e,this._data=n};vr.prototype.getCoordinates=function(){return this._pts};vr.prototype.size=function(){return this._pts.length};vr.prototype.getCoordinate=function(e){return this._pts[e]};vr.prototype.isClosed=function(){return this._pts[0].equals(this._pts[this._pts.length-1])};vr.prototype.getSegmentOctant=function(e){return e===this._pts.length-1?-1:this.safeOctant(this.getCoordinate(e),this.getCoordinate(e+1))};vr.prototype.setData=function(e){this._data=e};vr.prototype.safeOctant=function(e,n){return e.equals2D(n)?0:pf.octant(e,n)};vr.prototype.getData=function(){return this._data};vr.prototype.addIntersection=function(){if(arguments.length===2){var e=arguments[0],n=arguments[1];this.addIntersectionNode(e,n)}else if(arguments.length===4){var i=arguments[0],u=arguments[1],h=arguments[3],d=new Me(i.getIntersection(h));this.addIntersection(d,u)}};vr.prototype.toString=function(){return xs.toLineString(new gr(this._pts))};vr.prototype.getNodeList=function(){return this._nodeList};vr.prototype.addIntersectionNode=function(e,n){var i=n,u=i+1;if(u<this._pts.length){var h=this._pts[u];e.equals2D(h)&&(i=u)}var d=this._nodeList.add(e,i);return d};vr.prototype.addIntersections=function(e,n,i){for(var u=this,h=0;h<e.getIntersectionNum();h++)u.addIntersection(e,n,i,h)};vr.prototype.interfaces_=function(){return[S_]};vr.prototype.getClass=function(){return vr};vr.getNodedSubstrings=function(){if(arguments.length===1){var e=arguments[0],n=new gt;return vr.getNodedSubstrings(e,n),n}else if(arguments.length===2)for(var i=arguments[0],u=arguments[1],h=i.iterator();h.hasNext();){var d=h.next();d.getNodeList().addSplitEdges(u)}};var Nt=function(){if(this.p0=null,this.p1=null,arguments.length===0)this.p0=new Me,this.p1=new Me;else if(arguments.length===1){var e=arguments[0];this.p0=new Me(e.p0),this.p1=new Me(e.p1)}else if(arguments.length===2)this.p0=arguments[0],this.p1=arguments[1];else if(arguments.length===4){var n=arguments[0],i=arguments[1],u=arguments[2],h=arguments[3];this.p0=new Me(n,i),this.p1=new Me(u,h)}},aD={serialVersionUID:{configurable:!0}};Nt.prototype.minX=function(){return Math.min(this.p0.x,this.p1.x)};Nt.prototype.orientationIndex=function(){if(arguments[0]instanceof Nt){var e=arguments[0],n=wt.orientationIndex(this.p0,this.p1,e.p0),i=wt.orientationIndex(this.p0,this.p1,e.p1);return n>=0&&i>=0||n<=0&&i<=0?Math.max(n,i):0}else if(arguments[0]instanceof Me){var u=arguments[0];return wt.orientationIndex(this.p0,this.p1,u)}};Nt.prototype.toGeometry=function(e){return e.createLineString([this.p0,this.p1])};Nt.prototype.isVertical=function(){return this.p0.x===this.p1.x};Nt.prototype.equals=function(e){if(!(e instanceof Nt))return!1;var n=e;return this.p0.equals(n.p0)&&this.p1.equals(n.p1)};Nt.prototype.intersection=function(e){var n=new Yc;return n.computeIntersection(this.p0,this.p1,e.p0,e.p1),n.hasIntersection()?n.getIntersection(0):null};Nt.prototype.project=function(){if(arguments[0]instanceof Me){var e=arguments[0];if(e.equals(this.p0)||e.equals(this.p1))return new Me(e);var n=this.projectionFactor(e),i=new Me;return i.x=this.p0.x+n*(this.p1.x-this.p0.x),i.y=this.p0.y+n*(this.p1.y-this.p0.y),i}else if(arguments[0]instanceof Nt){var u=arguments[0],h=this.projectionFactor(u.p0),d=this.projectionFactor(u.p1);if(h>=1&&d>=1||h<=0&&d<=0)return null;var s=this.project(u.p0);h<0&&(s=this.p0),h>1&&(s=this.p1);var w=this.project(u.p1);return d<0&&(w=this.p0),d>1&&(w=this.p1),new Nt(s,w)}};Nt.prototype.normalize=function(){this.p1.compareTo(this.p0)<0&&this.reverse()};Nt.prototype.angle=function(){return Math.atan2(this.p1.y-this.p0.y,this.p1.x-this.p0.x)};Nt.prototype.getCoordinate=function(e){return e===0?this.p0:this.p1};Nt.prototype.distancePerpendicular=function(e){return wt.distancePointLinePerpendicular(e,this.p0,this.p1)};Nt.prototype.minY=function(){return Math.min(this.p0.y,this.p1.y)};Nt.prototype.midPoint=function(){return Nt.midPoint(this.p0,this.p1)};Nt.prototype.projectionFactor=function(e){if(e.equals(this.p0))return 0;if(e.equals(this.p1))return 1;var n=this.p1.x-this.p0.x,i=this.p1.y-this.p0.y,u=n*n+i*i;if(u<=0)return Gt.NaN;var h=((e.x-this.p0.x)*n+(e.y-this.p0.y)*i)/u;return h};Nt.prototype.closestPoints=function(e){var n=this.intersection(e);if(n!==null)return[n,n];var i=new Array(2).fill(null),u=Gt.MAX_VALUE,h=null,d=this.closestPoint(e.p0);u=d.distance(e.p0),i[0]=d,i[1]=e.p0;var s=this.closestPoint(e.p1);h=s.distance(e.p1),h<u&&(u=h,i[0]=s,i[1]=e.p1);var w=e.closestPoint(this.p0);h=w.distance(this.p0),h<u&&(u=h,i[0]=this.p0,i[1]=w);var T=e.closestPoint(this.p1);return h=T.distance(this.p1),h<u&&(u=h,i[0]=this.p1,i[1]=T),i};Nt.prototype.closestPoint=function(e){var n=this.projectionFactor(e);if(n>0&&n<1)return this.project(e);var i=this.p0.distance(e),u=this.p1.distance(e);return i<u?this.p0:this.p1};Nt.prototype.maxX=function(){return Math.max(this.p0.x,this.p1.x)};Nt.prototype.getLength=function(){return this.p0.distance(this.p1)};Nt.prototype.compareTo=function(e){var n=e,i=this.p0.compareTo(n.p0);return i!==0?i:this.p1.compareTo(n.p1)};Nt.prototype.reverse=function(){var e=this.p0;this.p0=this.p1,this.p1=e};Nt.prototype.equalsTopo=function(e){return this.p0.equals(e.p0)&&(this.p1.equals(e.p1)||this.p0.equals(e.p1))&&this.p1.equals(e.p0)};Nt.prototype.lineIntersection=function(e){try{var n=ms.intersection(this.p0,this.p1,e.p0,e.p1);return n}catch(i){if(!(i instanceof zd))throw i}finally{}return null};Nt.prototype.maxY=function(){return Math.max(this.p0.y,this.p1.y)};Nt.prototype.pointAlongOffset=function(e,n){var i=this.p0.x+e*(this.p1.x-this.p0.x),u=this.p0.y+e*(this.p1.y-this.p0.y),h=this.p1.x-this.p0.x,d=this.p1.y-this.p0.y,s=Math.sqrt(h*h+d*d),w=0,T=0;if(n!==0){if(s<=0)throw new Error("Cannot compute offset from zero-length line segment");w=n*h/s,T=n*d/s}var A=i-T,D=u+w,R=new Me(A,D);return R};Nt.prototype.setCoordinates=function(){if(arguments.length===1){var e=arguments[0];this.setCoordinates(e.p0,e.p1)}else if(arguments.length===2){var n=arguments[0],i=arguments[1];this.p0.x=n.x,this.p0.y=n.y,this.p1.x=i.x,this.p1.y=i.y}};Nt.prototype.segmentFraction=function(e){var n=this.projectionFactor(e);return n<0?n=0:(n>1||Gt.isNaN(n))&&(n=1),n};Nt.prototype.toString=function(){return"LINESTRING( "+this.p0.x+" "+this.p0.y+", "+this.p1.x+" "+this.p1.y+")"};Nt.prototype.isHorizontal=function(){return this.p0.y===this.p1.y};Nt.prototype.distance=function(){if(arguments[0]instanceof Nt){var e=arguments[0];return wt.distanceLineLine(this.p0,this.p1,e.p0,e.p1)}else if(arguments[0]instanceof Me){var n=arguments[0];return wt.distancePointLine(n,this.p0,this.p1)}};Nt.prototype.pointAlong=function(e){var n=new Me;return n.x=this.p0.x+e*(this.p1.x-this.p0.x),n.y=this.p0.y+e*(this.p1.y-this.p0.y),n};Nt.prototype.hashCode=function(){var e=Gt.doubleToLongBits(this.p0.x);e^=Gt.doubleToLongBits(this.p0.y)*31;var n=Math.trunc(e)^Math.trunc(e>>32),i=Gt.doubleToLongBits(this.p1.x);i^=Gt.doubleToLongBits(this.p1.y)*31;var u=Math.trunc(i)^Math.trunc(i>>32);return n^u};Nt.prototype.interfaces_=function(){return[ts,ns]};Nt.prototype.getClass=function(){return Nt};Nt.midPoint=function(e,n){return new Me((e.x+n.x)/2,(e.y+n.y)/2)};aD.serialVersionUID.get=function(){return 0x2d2172135f411c00};Object.defineProperties(Nt,aD);var T_=function(){this.tempEnv1=new Dt,this.tempEnv2=new Dt,this._overlapSeg1=new Nt,this._overlapSeg2=new Nt};T_.prototype.overlap=function(){if(arguments.length!==2){if(arguments.length===4){var e=arguments[0],n=arguments[1],i=arguments[2],u=arguments[3];e.getLineSegment(n,this._overlapSeg1),i.getLineSegment(u,this._overlapSeg2),this.overlap(this._overlapSeg1,this._overlapSeg2)}}};T_.prototype.interfaces_=function(){return[]};T_.prototype.getClass=function(){return T_};var co=function(){this._pts=null,this._start=null,this._end=null,this._env=null,this._context=null,this._id=null;var e=arguments[0],n=arguments[1],i=arguments[2],u=arguments[3];this._pts=e,this._start=n,this._end=i,this._context=u};co.prototype.getLineSegment=function(e,n){n.p0=this._pts[e],n.p1=this._pts[e+1]};co.prototype.computeSelect=function(e,n,i,u){var h=this._pts[n],d=this._pts[i];if(u.tempEnv1.init(h,d),i-n===1)return u.select(this,n),null;if(!e.intersects(u.tempEnv1))return null;var s=Math.trunc((n+i)/2);n<s&&this.computeSelect(e,n,s,u),s<i&&this.computeSelect(e,s,i,u)};co.prototype.getCoordinates=function(){for(var e=this,n=new Array(this._end-this._start+1).fill(null),i=0,u=this._start;u<=this._end;u++)n[i++]=e._pts[u];return n};co.prototype.computeOverlaps=function(e,n){this.computeOverlapsInternal(this._start,this._end,e,e._start,e._end,n)};co.prototype.setId=function(e){this._id=e};co.prototype.select=function(e,n){this.computeSelect(e,this._start,this._end,n)};co.prototype.getEnvelope=function(){if(this._env===null){var e=this._pts[this._start],n=this._pts[this._end];this._env=new Dt(e,n)}return this._env};co.prototype.getEndIndex=function(){return this._end};co.prototype.getStartIndex=function(){return this._start};co.prototype.getContext=function(){return this._context};co.prototype.getId=function(){return this._id};co.prototype.computeOverlapsInternal=function(e,n,i,u,h,d){var s=this._pts[e],w=this._pts[n],T=i._pts[u],A=i._pts[h];if(n-e===1&&h-u===1)return d.overlap(this,e,i,u),null;if(d.tempEnv1.init(s,w),d.tempEnv2.init(T,A),!d.tempEnv1.intersects(d.tempEnv2))return null;var D=Math.trunc((e+n)/2),R=Math.trunc((u+h)/2);e<D&&(u<R&&this.computeOverlapsInternal(e,D,i,u,R,d),R<h&&this.computeOverlapsInternal(e,D,i,R,h,d)),D<n&&(u<R&&this.computeOverlapsInternal(D,n,i,u,R,d),R<h&&this.computeOverlapsInternal(D,n,i,R,h,d))};co.prototype.interfaces_=function(){return[]};co.prototype.getClass=function(){return co};var Ks=function(){};Ks.prototype.interfaces_=function(){return[]};Ks.prototype.getClass=function(){return Ks};Ks.getChainStartIndices=function(e){var n=0,i=new gt;i.add(new ea(n));do{var u=Ks.findChainEnd(e,n);i.add(new ea(u)),n=u}while(n<e.length-1);var h=Ks.toIntArray(i);return h};Ks.findChainEnd=function(e,n){for(var i=n;i<e.length-1&&e[i].equals2D(e[i+1]);)i++;if(i>=e.length-1)return e.length-1;for(var u=Pn.quadrant(e[i],e[i+1]),h=n+1;h<e.length;){if(!e[h-1].equals2D(e[h])){var d=Pn.quadrant(e[h-1],e[h]);if(d!==u)break}h++}return h-1};Ks.getChains=function(){if(arguments.length===1){var e=arguments[0];return Ks.getChains(e,null)}else if(arguments.length===2){for(var n=arguments[0],i=arguments[1],u=new gt,h=Ks.getChainStartIndices(n),d=0;d<h.length-1;d++){var s=new co(n,h[d],h[d+1],i);u.add(s)}return u}};Ks.toIntArray=function(e){for(var n=new Array(e.size()).fill(null),i=0;i<n.length;i++)n[i]=e.get(i).intValue();return n};var Bc=function(){};Bc.prototype.computeNodes=function(e){};Bc.prototype.getNodedSubstrings=function(){};Bc.prototype.interfaces_=function(){return[]};Bc.prototype.getClass=function(){return Bc};var C_=function(){if(this._segInt=null,arguments.length!==0){if(arguments.length===1){var e=arguments[0];this.setSegmentIntersector(e)}}};C_.prototype.setSegmentIntersector=function(e){this._segInt=e};C_.prototype.interfaces_=function(){return[Bc]};C_.prototype.getClass=function(){return C_};var VS=function(t){function e(i){i?t.call(this,i):t.call(this),this._monoChains=new gt,this._index=new sD,this._idCounter=0,this._nodedSegStrings=null,this._nOverlaps=0}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={SegmentOverlapAction:{configurable:!0}};return e.prototype.getMonotoneChains=function(){return this._monoChains},e.prototype.getNodedSubstrings=function(){return vr.getNodedSubstrings(this._nodedSegStrings)},e.prototype.getIndex=function(){return this._index},e.prototype.add=function(u){for(var h=this,d=Ks.getChains(u.getCoordinates(),u),s=d.iterator();s.hasNext();){var w=s.next();w.setId(h._idCounter++),h._index.insert(w.getEnvelope(),w),h._monoChains.add(w)}},e.prototype.computeNodes=function(u){var h=this;this._nodedSegStrings=u;for(var d=u.iterator();d.hasNext();)h.add(d.next());this.intersectChains()},e.prototype.intersectChains=function(){for(var u=this,h=new xM(this._segInt),d=this._monoChains.iterator();d.hasNext();)for(var s=d.next(),w=u._index.query(s.getEnvelope()),T=w.iterator();T.hasNext();){var A=T.next();if(A.getId()>s.getId()&&(s.computeOverlaps(A,h),u._nOverlaps++),u._segInt.isDone())return null}},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},n.SegmentOverlapAction.get=function(){return xM},Object.defineProperties(e,n),e}(C_),xM=function(t){function e(){t.call(this),this._si=null;var n=arguments[0];this._si=n}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.overlap=function(){if(arguments.length===4){var i=arguments[0],u=arguments[1],h=arguments[2],d=arguments[3],s=i.getContext(),w=h.getContext();this._si.processIntersections(s,u,w,d)}else return t.prototype.overlap.apply(this,arguments)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(T_),wn=function t(){if(this._quadrantSegments=t.DEFAULT_QUADRANT_SEGMENTS,this._endCapStyle=t.CAP_ROUND,this._joinStyle=t.JOIN_ROUND,this._mitreLimit=t.DEFAULT_MITRE_LIMIT,this._isSingleSided=!1,this._simplifyFactor=t.DEFAULT_SIMPLIFY_FACTOR,arguments.length!==0){if(arguments.length===1){var e=arguments[0];this.setQuadrantSegments(e)}else if(arguments.length===2){var n=arguments[0],i=arguments[1];this.setQuadrantSegments(n),this.setEndCapStyle(i)}else if(arguments.length===4){var u=arguments[0],h=arguments[1],d=arguments[2],s=arguments[3];this.setQuadrantSegments(u),this.setEndCapStyle(h),this.setJoinStyle(d),this.setMitreLimit(s)}}},jl={CAP_ROUND:{configurable:!0},CAP_FLAT:{configurable:!0},CAP_SQUARE:{configurable:!0},JOIN_ROUND:{configurable:!0},JOIN_MITRE:{configurable:!0},JOIN_BEVEL:{configurable:!0},DEFAULT_QUADRANT_SEGMENTS:{configurable:!0},DEFAULT_MITRE_LIMIT:{configurable:!0},DEFAULT_SIMPLIFY_FACTOR:{configurable:!0}};wn.prototype.getEndCapStyle=function(){return this._endCapStyle};wn.prototype.isSingleSided=function(){return this._isSingleSided};wn.prototype.setQuadrantSegments=function(e){this._quadrantSegments=e,this._quadrantSegments===0&&(this._joinStyle=wn.JOIN_BEVEL),this._quadrantSegments<0&&(this._joinStyle=wn.JOIN_MITRE,this._mitreLimit=Math.abs(this._quadrantSegments)),e<=0&&(this._quadrantSegments=1),this._joinStyle!==wn.JOIN_ROUND&&(this._quadrantSegments=wn.DEFAULT_QUADRANT_SEGMENTS)};wn.prototype.getJoinStyle=function(){return this._joinStyle};wn.prototype.setJoinStyle=function(e){this._joinStyle=e};wn.prototype.setSimplifyFactor=function(e){this._simplifyFactor=e<0?0:e};wn.prototype.getSimplifyFactor=function(){return this._simplifyFactor};wn.prototype.getQuadrantSegments=function(){return this._quadrantSegments};wn.prototype.setEndCapStyle=function(e){this._endCapStyle=e};wn.prototype.getMitreLimit=function(){return this._mitreLimit};wn.prototype.setMitreLimit=function(e){this._mitreLimit=e};wn.prototype.setSingleSided=function(e){this._isSingleSided=e};wn.prototype.interfaces_=function(){return[]};wn.prototype.getClass=function(){return wn};wn.bufferDistanceError=function(e){var n=Math.PI/2/e;return 1-Math.cos(n/2)};jl.CAP_ROUND.get=function(){return 1};jl.CAP_FLAT.get=function(){return 2};jl.CAP_SQUARE.get=function(){return 3};jl.JOIN_ROUND.get=function(){return 1};jl.JOIN_MITRE.get=function(){return 2};jl.JOIN_BEVEL.get=function(){return 3};jl.DEFAULT_QUADRANT_SEGMENTS.get=function(){return 8};jl.DEFAULT_MITRE_LIMIT.get=function(){return 5};jl.DEFAULT_SIMPLIFY_FACTOR.get=function(){return .01};Object.defineProperties(wn,jl);var hr=function(e){this._distanceTol=null,this._isDeleted=null,this._angleOrientation=wt.COUNTERCLOCKWISE,this._inputLine=e||null},q_={INIT:{configurable:!0},DELETE:{configurable:!0},KEEP:{configurable:!0},NUM_PTS_TO_CHECK:{configurable:!0}};hr.prototype.isDeletable=function(e,n,i,u){var h=this._inputLine[e],d=this._inputLine[n],s=this._inputLine[i];return!this.isConcave(h,d,s)||!this.isShallow(h,d,s,u)?!1:this.isShallowSampled(h,d,e,i,u)};hr.prototype.deleteShallowConcavities=function(){for(var e=this,n=1,i=this.findNextNonDeletedIndex(n),u=this.findNextNonDeletedIndex(i),h=!1;u<this._inputLine.length;){var d=!1;e.isDeletable(n,i,u,e._distanceTol)&&(e._isDeleted[i]=hr.DELETE,d=!0,h=!0),d?n=u:n=i,i=e.findNextNonDeletedIndex(n),u=e.findNextNonDeletedIndex(i)}return h};hr.prototype.isShallowConcavity=function(e,n,i,u){var h=wt.computeOrientation(e,n,i),d=h===this._angleOrientation;if(!d)return!1;var s=wt.distancePointLine(n,e,i);return s<u};hr.prototype.isShallowSampled=function(e,n,i,u,h){var d=this,s=Math.trunc((u-i)/hr.NUM_PTS_TO_CHECK);s<=0&&(s=1);for(var w=i;w<u;w+=s)if(!d.isShallow(e,n,d._inputLine[w],h))return!1;return!0};hr.prototype.isConcave=function(e,n,i){var u=wt.computeOrientation(e,n,i),h=u===this._angleOrientation;return h};hr.prototype.simplify=function(e){var n=this;this._distanceTol=Math.abs(e),e<0&&(this._angleOrientation=wt.CLOCKWISE),this._isDeleted=new Array(this._inputLine.length).fill(null);var i=!1;do i=n.deleteShallowConcavities();while(i);return this.collapseLine()};hr.prototype.findNextNonDeletedIndex=function(e){for(var n=e+1;n<this._inputLine.length&&this._isDeleted[n]===hr.DELETE;)n++;return n};hr.prototype.isShallow=function(e,n,i,u){var h=wt.distancePointLine(n,e,i);return h<u};hr.prototype.collapseLine=function(){for(var e=this,n=new V_,i=0;i<this._inputLine.length;i++)e._isDeleted[i]!==hr.DELETE&&n.add(e._inputLine[i]);return n.toCoordinateArray()};hr.prototype.interfaces_=function(){return[]};hr.prototype.getClass=function(){return hr};hr.simplify=function(e,n){var i=new hr(e);return i.simplify(n)};q_.INIT.get=function(){return 0};q_.DELETE.get=function(){return 1};q_.KEEP.get=function(){return 1};q_.NUM_PTS_TO_CHECK.get=function(){return 10};Object.defineProperties(hr,q_);var To=function(){this._ptList=null,this._precisionModel=null,this._minimimVertexDistance=0,this._ptList=new gt},lD={COORDINATE_ARRAY_TYPE:{configurable:!0}};To.prototype.getCoordinates=function(){var e=this._ptList.toArray(To.COORDINATE_ARRAY_TYPE);return e};To.prototype.setPrecisionModel=function(e){this._precisionModel=e};To.prototype.addPt=function(e){var n=new Me(e);if(this._precisionModel.makePrecise(n),this.isRedundant(n))return null;this._ptList.add(n)};To.prototype.revere=function(){};To.prototype.addPts=function(e,n){var i=this;if(n)for(var u=0;u<e.length;u++)i.addPt(e[u]);else for(var h=e.length-1;h>=0;h--)i.addPt(e[h])};To.prototype.isRedundant=function(e){if(this._ptList.size()<1)return!1;var n=this._ptList.get(this._ptList.size()-1),i=e.distance(n);return i<this._minimimVertexDistance};To.prototype.toString=function(){var e=new ln,n=e.createLineString(this.getCoordinates());return n.toString()};To.prototype.closeRing=function(){if(this._ptList.size()<1)return null;var e=new Me(this._ptList.get(0)),n=this._ptList.get(this._ptList.size()-1);if(e.equals(n))return null;this._ptList.add(e)};To.prototype.setMinimumVertexDistance=function(e){this._minimimVertexDistance=e};To.prototype.interfaces_=function(){return[]};To.prototype.getClass=function(){return To};lD.COORDINATE_ARRAY_TYPE.get=function(){return new Array(0).fill(null)};Object.defineProperties(To,lD);var pn=function(){},Af={PI_TIMES_2:{configurable:!0},PI_OVER_2:{configurable:!0},PI_OVER_4:{configurable:!0},COUNTERCLOCKWISE:{configurable:!0},CLOCKWISE:{configurable:!0},NONE:{configurable:!0}};pn.prototype.interfaces_=function(){return[]};pn.prototype.getClass=function(){return pn};pn.toDegrees=function(e){return e*180/Math.PI};pn.normalize=function(e){for(;e>Math.PI;)e-=pn.PI_TIMES_2;for(;e<=-Math.PI;)e+=pn.PI_TIMES_2;return e};pn.angle=function(){if(arguments.length===1){var e=arguments[0];return Math.atan2(e.y,e.x)}else if(arguments.length===2){var n=arguments[0],i=arguments[1],u=i.x-n.x,h=i.y-n.y;return Math.atan2(h,u)}};pn.isAcute=function(e,n,i){var u=e.x-n.x,h=e.y-n.y,d=i.x-n.x,s=i.y-n.y,w=u*d+h*s;return w>0};pn.isObtuse=function(e,n,i){var u=e.x-n.x,h=e.y-n.y,d=i.x-n.x,s=i.y-n.y,w=u*d+h*s;return w<0};pn.interiorAngle=function(e,n,i){var u=pn.angle(n,e),h=pn.angle(n,i);return Math.abs(h-u)};pn.normalizePositive=function(e){if(e<0){for(;e<0;)e+=pn.PI_TIMES_2;e>=pn.PI_TIMES_2&&(e=0)}else{for(;e>=pn.PI_TIMES_2;)e-=pn.PI_TIMES_2;e<0&&(e=0)}return e};pn.angleBetween=function(e,n,i){var u=pn.angle(n,e),h=pn.angle(n,i);return pn.diff(u,h)};pn.diff=function(e,n){var i=null;return e<n?i=n-e:i=e-n,i>Math.PI&&(i=2*Math.PI-i),i};pn.toRadians=function(e){return e*Math.PI/180};pn.getTurn=function(e,n){var i=Math.sin(n-e);return i>0?pn.COUNTERCLOCKWISE:i<0?pn.CLOCKWISE:pn.NONE};pn.angleBetweenOriented=function(e,n,i){var u=pn.angle(n,e),h=pn.angle(n,i),d=h-u;return d<=-Math.PI?d+pn.PI_TIMES_2:d>Math.PI?d-pn.PI_TIMES_2:d};Af.PI_TIMES_2.get=function(){return 2*Math.PI};Af.PI_OVER_2.get=function(){return Math.PI/2};Af.PI_OVER_4.get=function(){return Math.PI/4};Af.COUNTERCLOCKWISE.get=function(){return wt.COUNTERCLOCKWISE};Af.CLOCKWISE.get=function(){return wt.CLOCKWISE};Af.NONE.get=function(){return wt.COLLINEAR};Object.defineProperties(pn,Af);var Kn=function t(){this._maxCurveSegmentError=0,this._filletAngleQuantum=null,this._closingSegLengthFactor=1,this._segList=null,this._distance=0,this._precisionModel=null,this._bufParams=null,this._li=null,this._s0=null,this._s1=null,this._s2=null,this._seg0=new Nt,this._seg1=new Nt,this._offset0=new Nt,this._offset1=new Nt,this._side=0,this._hasNarrowConcaveAngle=!1;var e=arguments[0],n=arguments[1],i=arguments[2];this._precisionModel=e,this._bufParams=n,this._li=new Yc,this._filletAngleQuantum=Math.PI/2/n.getQuadrantSegments(),n.getQuadrantSegments()>=8&&n.getJoinStyle()===wn.JOIN_ROUND&&(this._closingSegLengthFactor=t.MAX_CLOSING_SEG_LEN_FACTOR),this.init(i)},X_={OFFSET_SEGMENT_SEPARATION_FACTOR:{configurable:!0},INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR:{configurable:!0},CURVE_VERTEX_SNAP_DISTANCE_FACTOR:{configurable:!0},MAX_CLOSING_SEG_LEN_FACTOR:{configurable:!0}};Kn.prototype.addNextSegment=function(e,n){if(this._s0=this._s1,this._s1=this._s2,this._s2=e,this._seg0.setCoordinates(this._s0,this._s1),this.computeOffsetSegment(this._seg0,this._side,this._distance,this._offset0),this._seg1.setCoordinates(this._s1,this._s2),this.computeOffsetSegment(this._seg1,this._side,this._distance,this._offset1),this._s1.equals(this._s2))return null;var i=wt.computeOrientation(this._s0,this._s1,this._s2),u=i===wt.CLOCKWISE&&this._side===ht.LEFT||i===wt.COUNTERCLOCKWISE&&this._side===ht.RIGHT;i===0?this.addCollinear(n):u?this.addOutsideTurn(i,n):this.addInsideTurn(i,n)};Kn.prototype.addLineEndCap=function(e,n){var i=new Nt(e,n),u=new Nt;this.computeOffsetSegment(i,ht.LEFT,this._distance,u);var h=new Nt;this.computeOffsetSegment(i,ht.RIGHT,this._distance,h);var d=n.x-e.x,s=n.y-e.y,w=Math.atan2(s,d);switch(this._bufParams.getEndCapStyle()){case wn.CAP_ROUND:this._segList.addPt(u.p1),this.addFilletArc(n,w+Math.PI/2,w-Math.PI/2,wt.CLOCKWISE,this._distance),this._segList.addPt(h.p1);break;case wn.CAP_FLAT:this._segList.addPt(u.p1),this._segList.addPt(h.p1);break;case wn.CAP_SQUARE:var T=new Me;T.x=Math.abs(this._distance)*Math.cos(w),T.y=Math.abs(this._distance)*Math.sin(w);var A=new Me(u.p1.x+T.x,u.p1.y+T.y),D=new Me(h.p1.x+T.x,h.p1.y+T.y);this._segList.addPt(A),this._segList.addPt(D);break}};Kn.prototype.getCoordinates=function(){var e=this._segList.getCoordinates();return e};Kn.prototype.addMitreJoin=function(e,n,i,u){var h=!0,d=null;try{d=ms.intersection(n.p0,n.p1,i.p0,i.p1);var s=u<=0?1:d.distance(e)/Math.abs(u);s>this._bufParams.getMitreLimit()&&(h=!1)}catch(w){if(w instanceof zd)d=new Me(0,0),h=!1;else throw w}finally{}h?this._segList.addPt(d):this.addLimitedMitreJoin(n,i,u,this._bufParams.getMitreLimit())};Kn.prototype.addFilletCorner=function(e,n,i,u,h){var d=n.x-e.x,s=n.y-e.y,w=Math.atan2(s,d),T=i.x-e.x,A=i.y-e.y,D=Math.atan2(A,T);u===wt.CLOCKWISE?w<=D&&(w+=2*Math.PI):w>=D&&(w-=2*Math.PI),this._segList.addPt(n),this.addFilletArc(e,w,D,u,h),this._segList.addPt(i)};Kn.prototype.addOutsideTurn=function(e,n){if(this._offset0.p1.distance(this._offset1.p0)<this._distance*Kn.OFFSET_SEGMENT_SEPARATION_FACTOR)return this._segList.addPt(this._offset0.p1),null;this._bufParams.getJoinStyle()===wn.JOIN_MITRE?this.addMitreJoin(this._s1,this._offset0,this._offset1,this._distance):this._bufParams.getJoinStyle()===wn.JOIN_BEVEL?this.addBevelJoin(this._offset0,this._offset1):(n&&this._segList.addPt(this._offset0.p1),this.addFilletCorner(this._s1,this._offset0.p1,this._offset1.p0,e,this._distance),this._segList.addPt(this._offset1.p0))};Kn.prototype.createSquare=function(e){this._segList.addPt(new Me(e.x+this._distance,e.y+this._distance)),this._segList.addPt(new Me(e.x+this._distance,e.y-this._distance)),this._segList.addPt(new Me(e.x-this._distance,e.y-this._distance)),this._segList.addPt(new Me(e.x-this._distance,e.y+this._distance)),this._segList.closeRing()};Kn.prototype.addSegments=function(e,n){this._segList.addPts(e,n)};Kn.prototype.addFirstSegment=function(){this._segList.addPt(this._offset1.p0)};Kn.prototype.addLastSegment=function(){this._segList.addPt(this._offset1.p1)};Kn.prototype.initSideSegments=function(e,n,i){this._s1=e,this._s2=n,this._side=i,this._seg1.setCoordinates(e,n),this.computeOffsetSegment(this._seg1,i,this._distance,this._offset1)};Kn.prototype.addLimitedMitreJoin=function(e,n,i,u){var h=this._seg0.p1,d=pn.angle(h,this._seg0.p0),s=pn.angleBetweenOriented(this._seg0.p0,h,this._seg1.p1),w=s/2,T=pn.normalize(d+w),A=pn.normalize(T+Math.PI),D=u*i,R=D*Math.abs(Math.sin(w)),G=i-R,$=h.x+D*Math.cos(A),ie=h.y+D*Math.sin(A),_e=new Me($,ie),Y=new Nt(h,_e),B=Y.pointAlongOffset(1,G),q=Y.pointAlongOffset(1,-G);this._side===ht.LEFT?(this._segList.addPt(B),this._segList.addPt(q)):(this._segList.addPt(q),this._segList.addPt(B))};Kn.prototype.computeOffsetSegment=function(e,n,i,u){var h=n===ht.LEFT?1:-1,d=e.p1.x-e.p0.x,s=e.p1.y-e.p0.y,w=Math.sqrt(d*d+s*s),T=h*i*d/w,A=h*i*s/w;u.p0.x=e.p0.x-A,u.p0.y=e.p0.y+T,u.p1.x=e.p1.x-A,u.p1.y=e.p1.y+T};Kn.prototype.addFilletArc=function(e,n,i,u,h){var d=this,s=u===wt.CLOCKWISE?-1:1,w=Math.abs(n-i),T=Math.trunc(w/this._filletAngleQuantum+.5);if(T<1)return null;for(var A=0,D=w/T,R=A,G=new Me;R<w;){var $=n+s*R;G.x=e.x+h*Math.cos($),G.y=e.y+h*Math.sin($),d._segList.addPt(G),R+=D}};Kn.prototype.addInsideTurn=function(e,n){if(this._li.computeIntersection(this._offset0.p0,this._offset0.p1,this._offset1.p0,this._offset1.p1),this._li.hasIntersection())this._segList.addPt(this._li.getIntersection(0));else if(this._hasNarrowConcaveAngle=!0,this._offset0.p1.distance(this._offset1.p0)<this._distance*Kn.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR)this._segList.addPt(this._offset0.p1);else{if(this._segList.addPt(this._offset0.p1),this._closingSegLengthFactor>0){var i=new Me((this._closingSegLengthFactor*this._offset0.p1.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset0.p1.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(i);var u=new Me((this._closingSegLengthFactor*this._offset1.p0.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset1.p0.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(u)}else this._segList.addPt(this._s1);this._segList.addPt(this._offset1.p0)}};Kn.prototype.createCircle=function(e){var n=new Me(e.x+this._distance,e.y);this._segList.addPt(n),this.addFilletArc(e,0,2*Math.PI,-1,this._distance),this._segList.closeRing()};Kn.prototype.addBevelJoin=function(e,n){this._segList.addPt(e.p1),this._segList.addPt(n.p0)};Kn.prototype.init=function(e){this._distance=e,this._maxCurveSegmentError=e*(1-Math.cos(this._filletAngleQuantum/2)),this._segList=new To,this._segList.setPrecisionModel(this._precisionModel),this._segList.setMinimumVertexDistance(e*Kn.CURVE_VERTEX_SNAP_DISTANCE_FACTOR)};Kn.prototype.addCollinear=function(e){this._li.computeIntersection(this._s0,this._s1,this._s1,this._s2);var n=this._li.getIntersectionNum();n>=2&&(this._bufParams.getJoinStyle()===wn.JOIN_BEVEL||this._bufParams.getJoinStyle()===wn.JOIN_MITRE?(e&&this._segList.addPt(this._offset0.p1),this._segList.addPt(this._offset1.p0)):this.addFilletCorner(this._s1,this._offset0.p1,this._offset1.p0,wt.CLOCKWISE,this._distance))};Kn.prototype.closeRing=function(){this._segList.closeRing()};Kn.prototype.hasNarrowConcaveAngle=function(){return this._hasNarrowConcaveAngle};Kn.prototype.interfaces_=function(){return[]};Kn.prototype.getClass=function(){return Kn};X_.OFFSET_SEGMENT_SEPARATION_FACTOR.get=function(){return .001};X_.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR.get=function(){return .001};X_.CURVE_VERTEX_SNAP_DISTANCE_FACTOR.get=function(){return 1e-6};X_.MAX_CLOSING_SEG_LEN_FACTOR.get=function(){return 80};Object.defineProperties(Kn,X_);var Xi=function(){this._distance=0,this._precisionModel=null,this._bufParams=null;var e=arguments[0],n=arguments[1];this._precisionModel=e,this._bufParams=n};Xi.prototype.getOffsetCurve=function(e,n){if(this._distance=n,n===0)return null;var i=n<0,u=Math.abs(n),h=this.getSegGen(u);e.length<=1?this.computePointCurve(e[0],h):this.computeOffsetCurve(e,i,h);var d=h.getCoordinates();return i&&un.reverse(d),d};Xi.prototype.computeSingleSidedBufferCurve=function(e,n,i){var u=this.simplifyTolerance(this._distance);if(n){i.addSegments(e,!0);var h=hr.simplify(e,-u),d=h.length-1;i.initSideSegments(h[d],h[d-1],ht.LEFT),i.addFirstSegment();for(var s=d-2;s>=0;s--)i.addNextSegment(h[s],!0)}else{i.addSegments(e,!1);var w=hr.simplify(e,u),T=w.length-1;i.initSideSegments(w[0],w[1],ht.LEFT),i.addFirstSegment();for(var A=2;A<=T;A++)i.addNextSegment(w[A],!0)}i.addLastSegment(),i.closeRing()};Xi.prototype.computeRingBufferCurve=function(e,n,i){var u=this.simplifyTolerance(this._distance);n===ht.RIGHT&&(u=-u);var h=hr.simplify(e,u),d=h.length-1;i.initSideSegments(h[d-1],h[0],n);for(var s=1;s<=d;s++){var w=s!==1;i.addNextSegment(h[s],w)}i.closeRing()};Xi.prototype.computeLineBufferCurve=function(e,n){var i=this.simplifyTolerance(this._distance),u=hr.simplify(e,i),h=u.length-1;n.initSideSegments(u[0],u[1],ht.LEFT);for(var d=2;d<=h;d++)n.addNextSegment(u[d],!0);n.addLastSegment(),n.addLineEndCap(u[h-1],u[h]);var s=hr.simplify(e,-i),w=s.length-1;n.initSideSegments(s[w],s[w-1],ht.LEFT);for(var T=w-2;T>=0;T--)n.addNextSegment(s[T],!0);n.addLastSegment(),n.addLineEndCap(s[1],s[0]),n.closeRing()};Xi.prototype.computePointCurve=function(e,n){switch(this._bufParams.getEndCapStyle()){case wn.CAP_ROUND:n.createCircle(e);break;case wn.CAP_SQUARE:n.createSquare(e);break}};Xi.prototype.getLineCurve=function(e,n){if(this._distance=n,n<0&&!this._bufParams.isSingleSided()||n===0)return null;var i=Math.abs(n),u=this.getSegGen(i);if(e.length<=1)this.computePointCurve(e[0],u);else if(this._bufParams.isSingleSided()){var h=n<0;this.computeSingleSidedBufferCurve(e,h,u)}else this.computeLineBufferCurve(e,u);var d=u.getCoordinates();return d};Xi.prototype.getBufferParameters=function(){return this._bufParams};Xi.prototype.simplifyTolerance=function(e){return e*this._bufParams.getSimplifyFactor()};Xi.prototype.getRingCurve=function(e,n,i){if(this._distance=i,e.length<=2)return this.getLineCurve(e,i);if(i===0)return Xi.copyCoordinates(e);var u=this.getSegGen(i);return this.computeRingBufferCurve(e,n,u),u.getCoordinates()};Xi.prototype.computeOffsetCurve=function(e,n,i){var u=this.simplifyTolerance(this._distance);if(n){var h=hr.simplify(e,-u),d=h.length-1;i.initSideSegments(h[d],h[d-1],ht.LEFT),i.addFirstSegment();for(var s=d-2;s>=0;s--)i.addNextSegment(h[s],!0)}else{var w=hr.simplify(e,u),T=w.length-1;i.initSideSegments(w[0],w[1],ht.LEFT),i.addFirstSegment();for(var A=2;A<=T;A++)i.addNextSegment(w[A],!0)}i.addLastSegment()};Xi.prototype.getSegGen=function(e){return new Kn(this._precisionModel,this._bufParams,e)};Xi.prototype.interfaces_=function(){return[]};Xi.prototype.getClass=function(){return Xi};Xi.copyCoordinates=function(e){for(var n=new Array(e.length).fill(null),i=0;i<n.length;i++)n[i]=new Me(e[i]);return n};var df=function(){this._subgraphs=null,this._seg=new Nt,this._cga=new wt;var e=arguments[0];this._subgraphs=e},uD={DepthSegment:{configurable:!0}};df.prototype.findStabbedSegments=function(){var e=this;if(arguments.length===1){for(var n=arguments[0],i=new gt,u=this._subgraphs.iterator();u.hasNext();){var h=u.next(),d=h.getEnvelope();n.y<d.getMinY()||n.y>d.getMaxY()||e.findStabbedSegments(n,h.getDirectedEdges(),i)}return i}else if(arguments.length===3){if(Ut(arguments[2],gs)&&arguments[0]instanceof Me&&arguments[1]instanceof lE)for(var s=arguments[0],w=arguments[1],T=arguments[2],A=w.getEdge().getCoordinates(),D=0;D<A.length-1;D++){e._seg.p0=A[D],e._seg.p1=A[D+1],e._seg.p0.y>e._seg.p1.y&&e._seg.reverse();var R=Math.max(e._seg.p0.x,e._seg.p1.x);if(!(R<s.x)&&!e._seg.isHorizontal()&&!(s.y<e._seg.p0.y||s.y>e._seg.p1.y)&&wt.computeOrientation(e._seg.p0,e._seg.p1,s)!==wt.RIGHT){var G=w.getDepth(ht.LEFT);e._seg.p0.equals(A[D])||(G=w.getDepth(ht.RIGHT));var $=new Uc(e._seg,G);T.add($)}}else if(Ut(arguments[2],gs)&&arguments[0]instanceof Me&&Ut(arguments[1],gs))for(var ie=arguments[0],_e=arguments[1],Y=arguments[2],B=_e.iterator();B.hasNext();){var q=B.next();q.isForward()&&e.findStabbedSegments(ie,q,Y)}}};df.prototype.getDepth=function(e){var n=this.findStabbedSegments(e);if(n.size()===0)return 0;var i=Es.min(n);return i._leftDepth};df.prototype.interfaces_=function(){return[]};df.prototype.getClass=function(){return df};uD.DepthSegment.get=function(){return Uc};Object.defineProperties(df,uD);var Uc=function(){this._upwardSeg=null,this._leftDepth=null;var e=arguments[0],n=arguments[1];this._upwardSeg=new Nt(e),this._leftDepth=n};Uc.prototype.compareTo=function(e){var n=e;if(this._upwardSeg.minX()>=n._upwardSeg.maxX())return 1;if(this._upwardSeg.maxX()<=n._upwardSeg.minX())return-1;var i=this._upwardSeg.orientationIndex(n._upwardSeg);return i!==0||(i=-1*n._upwardSeg.orientationIndex(this._upwardSeg),i!==0)?i:this._upwardSeg.compareTo(n._upwardSeg)};Uc.prototype.compareX=function(e,n){var i=e.p0.compareTo(n.p0);return i!==0?i:e.p1.compareTo(n.p1)};Uc.prototype.toString=function(){return this._upwardSeg.toString()};Uc.prototype.interfaces_=function(){return[ts]};Uc.prototype.getClass=function(){return Uc};var En=function(e,n,i){this.p0=e||null,this.p1=n||null,this.p2=i||null};En.prototype.area=function(){return En.area(this.p0,this.p1,this.p2)};En.prototype.signedArea=function(){return En.signedArea(this.p0,this.p1,this.p2)};En.prototype.interpolateZ=function(e){if(e===null)throw new er("Supplied point is null.");return En.interpolateZ(e,this.p0,this.p1,this.p2)};En.prototype.longestSideLength=function(){return En.longestSideLength(this.p0,this.p1,this.p2)};En.prototype.isAcute=function(){return En.isAcute(this.p0,this.p1,this.p2)};En.prototype.circumcentre=function(){return En.circumcentre(this.p0,this.p1,this.p2)};En.prototype.area3D=function(){return En.area3D(this.p0,this.p1,this.p2)};En.prototype.centroid=function(){return En.centroid(this.p0,this.p1,this.p2)};En.prototype.inCentre=function(){return En.inCentre(this.p0,this.p1,this.p2)};En.prototype.interfaces_=function(){return[]};En.prototype.getClass=function(){return En};En.area=function(e,n,i){return Math.abs(((i.x-e.x)*(n.y-e.y)-(n.x-e.x)*(i.y-e.y))/2)};En.signedArea=function(e,n,i){return((i.x-e.x)*(n.y-e.y)-(n.x-e.x)*(i.y-e.y))/2};En.det=function(e,n,i,u){return e*u-n*i};En.interpolateZ=function(e,n,i,u){var h=n.x,d=n.y,s=i.x-h,w=u.x-h,T=i.y-d,A=u.y-d,D=s*A-w*T,R=e.x-h,G=e.y-d,$=(A*R-w*G)/D,ie=(-T*R+s*G)/D,_e=n.z+$*(i.z-n.z)+ie*(u.z-n.z);return _e};En.longestSideLength=function(e,n,i){var u=e.distance(n),h=n.distance(i),d=i.distance(e),s=u;return h>s&&(s=h),d>s&&(s=d),s};En.isAcute=function(e,n,i){return!(!pn.isAcute(e,n,i)||!pn.isAcute(n,i,e)||!pn.isAcute(i,e,n))};En.circumcentre=function(e,n,i){var u=i.x,h=i.y,d=e.x-u,s=e.y-h,w=n.x-u,T=n.y-h,A=2*En.det(d,s,w,T),D=En.det(s,d*d+s*s,T,w*w+T*T),R=En.det(d,d*d+s*s,w,w*w+T*T),G=u-D/A,$=h+R/A;return new Me(G,$)};En.perpendicularBisector=function(e,n){var i=n.x-e.x,u=n.y-e.y,h=new ms(e.x+i/2,e.y+u/2,1),d=new ms(e.x-u+i/2,e.y+i+u/2,1);return new ms(h,d)};En.angleBisector=function(e,n,i){var u=n.distance(e),h=n.distance(i),d=u/(u+h),s=i.x-e.x,w=i.y-e.y,T=new Me(e.x+d*s,e.y+d*w);return T};En.area3D=function(e,n,i){var u=n.x-e.x,h=n.y-e.y,d=n.z-e.z,s=i.x-e.x,w=i.y-e.y,T=i.z-e.z,A=h*T-d*w,D=d*s-u*T,R=u*w-h*s,G=A*A+D*D+R*R,$=Math.sqrt(G)/2;return $};En.centroid=function(e,n,i){var u=(e.x+n.x+i.x)/3,h=(e.y+n.y+i.y)/3;return new Me(u,h)};En.inCentre=function(e,n,i){var u=n.distance(i),h=e.distance(i),d=e.distance(n),s=u+h+d,w=(u*e.x+h*n.x+d*i.x)/s,T=(u*e.y+h*n.y+d*i.y)/s;return new Me(w,T)};var es=function(){this._inputGeom=null,this._distance=null,this._curveBuilder=null,this._curveList=new gt;var e=arguments[0],n=arguments[1],i=arguments[2];this._inputGeom=e,this._distance=n,this._curveBuilder=i};es.prototype.addPoint=function(e){if(this._distance<=0)return null;var n=e.getCoordinates(),i=this._curveBuilder.getLineCurve(n,this._distance);this.addCurve(i,Oe.EXTERIOR,Oe.INTERIOR)};es.prototype.addPolygon=function(e){var n=this,i=this._distance,u=ht.LEFT;this._distance<0&&(i=-this._distance,u=ht.RIGHT);var h=e.getExteriorRing(),d=un.removeRepeatedPoints(h.getCoordinates());if(this._distance<0&&this.isErodedCompletely(h,this._distance)||this._distance<=0&&d.length<3)return null;this.addPolygonRing(d,i,u,Oe.EXTERIOR,Oe.INTERIOR);for(var s=0;s<e.getNumInteriorRing();s++){var w=e.getInteriorRingN(s),T=un.removeRepeatedPoints(w.getCoordinates());n._distance>0&&n.isErodedCompletely(w,-n._distance)||n.addPolygonRing(T,i,ht.opposite(u),Oe.INTERIOR,Oe.EXTERIOR)}};es.prototype.isTriangleErodedCompletely=function(e,n){var i=new En(e[0],e[1],e[2]),u=i.inCentre(),h=wt.distancePointLine(u,i.p0,i.p1);return h<Math.abs(n)};es.prototype.addLineString=function(e){if(this._distance<=0&&!this._curveBuilder.getBufferParameters().isSingleSided())return null;var n=un.removeRepeatedPoints(e.getCoordinates()),i=this._curveBuilder.getLineCurve(n,this._distance);this.addCurve(i,Oe.EXTERIOR,Oe.INTERIOR)};es.prototype.addCurve=function(e,n,i){if(e===null||e.length<2)return null;var u=new vr(e,new An(0,Oe.BOUNDARY,n,i));this._curveList.add(u)};es.prototype.getCurves=function(){return this.add(this._inputGeom),this._curveList};es.prototype.addPolygonRing=function(e,n,i,u,h){if(n===0&&e.length<Ha.MINIMUM_VALID_SIZE)return null;var d=u,s=h;e.length>=Ha.MINIMUM_VALID_SIZE&&wt.isCCW(e)&&(d=h,s=u,i=ht.opposite(i));var w=this._curveBuilder.getRingCurve(e,i,n);this.addCurve(w,d,s)};es.prototype.add=function(e){if(e.isEmpty())return null;e instanceof jr?this.addPolygon(e):e instanceof cr?this.addLineString(e):e instanceof lo?this.addPoint(e):e instanceof vd?this.addCollection(e):e instanceof Fc?this.addCollection(e):e instanceof qa?this.addCollection(e):e instanceof Ri&&this.addCollection(e)};es.prototype.isErodedCompletely=function(e,n){var i=e.getCoordinates();if(i.length<4)return n<0;if(i.length===4)return this.isTriangleErodedCompletely(i,n);var u=e.getEnvelopeInternal(),h=Math.min(u.getHeight(),u.getWidth());return n<0&&2*Math.abs(n)>h};es.prototype.addCollection=function(e){for(var n=this,i=0;i<e.getNumGeometries();i++){var u=e.getGeometryN(i);n.add(u)}};es.prototype.interfaces_=function(){return[]};es.prototype.getClass=function(){return es};var Ed=function(){};Ed.prototype.locate=function(e){};Ed.prototype.interfaces_=function(){return[]};Ed.prototype.getClass=function(){return Ed};var Xa=function(){this._parent=null,this._atStart=null,this._max=null,this._index=null,this._subcollectionIterator=null;var e=arguments[0];this._parent=e,this._atStart=!0,this._index=0,this._max=e.getNumGeometries()};Xa.prototype.next=function(){if(this._atStart)return this._atStart=!1,Xa.isAtomic(this._parent)&&this._index++,this._parent;if(this._subcollectionIterator!==null){if(this._subcollectionIterator.hasNext())return this._subcollectionIterator.next();this._subcollectionIterator=null}if(this._index>=this._max)throw new Bd;var e=this._parent.getGeometryN(this._index++);return e instanceof Ri?(this._subcollectionIterator=new Xa(e),this._subcollectionIterator.next()):e};Xa.prototype.remove=function(){throw new Error(this.getClass().getName())};Xa.prototype.hasNext=function(){if(this._atStart)return!0;if(this._subcollectionIterator!==null){if(this._subcollectionIterator.hasNext())return!0;this._subcollectionIterator=null}return!(this._index>=this._max)};Xa.prototype.interfaces_=function(){return[Fd]};Xa.prototype.getClass=function(){return Xa};Xa.isAtomic=function(e){return!(e instanceof Ri)};var bo=function(){this._geom=null;var e=arguments[0];this._geom=e};bo.prototype.locate=function(e){return bo.locate(e,this._geom)};bo.prototype.interfaces_=function(){return[Ed]};bo.prototype.getClass=function(){return bo};bo.isPointInRing=function(e,n){return n.getEnvelopeInternal().intersects(e)?wt.isPointInRing(e,n.getCoordinates()):!1};bo.containsPointInPolygon=function(e,n){if(n.isEmpty())return!1;var i=n.getExteriorRing();if(!bo.isPointInRing(e,i))return!1;for(var u=0;u<n.getNumInteriorRing();u++){var h=n.getInteriorRingN(u);if(bo.isPointInRing(e,h))return!1}return!0};bo.containsPoint=function(e,n){if(n instanceof jr)return bo.containsPointInPolygon(e,n);if(n instanceof Ri)for(var i=new Xa(n);i.hasNext();){var u=i.next();if(u!==n&&bo.containsPoint(e,u))return!0}return!1};bo.locate=function(e,n){return n.isEmpty()?Oe.EXTERIOR:bo.containsPoint(e,n)?Oe.INTERIOR:Oe.EXTERIOR};var xi=function(){this._edgeMap=new yi,this._edgeList=null,this._ptInAreaLocation=[Oe.NONE,Oe.NONE]};xi.prototype.getNextCW=function(e){this.getEdges();var n=this._edgeList.indexOf(e),i=n-1;return n===0&&(i=this._edgeList.size()-1),this._edgeList.get(i)};xi.prototype.propagateSideLabels=function(e){for(var n=Oe.NONE,i=this.iterator();i.hasNext();){var u=i.next(),h=u.getLabel();h.isArea(e)&&h.getLocation(e,ht.LEFT)!==Oe.NONE&&(n=h.getLocation(e,ht.LEFT))}if(n===Oe.NONE)return null;for(var d=n,s=this.iterator();s.hasNext();){var w=s.next(),T=w.getLabel();if(T.getLocation(e,ht.ON)===Oe.NONE&&T.setLocation(e,ht.ON,d),T.isArea(e)){var A=T.getLocation(e,ht.LEFT),D=T.getLocation(e,ht.RIGHT);if(D!==Oe.NONE){if(D!==d)throw new Ol("side location conflict",w.getCoordinate());A===Oe.NONE&&Qt.shouldNeverReachHere("found single null side (at "+w.getCoordinate()+")"),d=A}else Qt.isTrue(T.getLocation(e,ht.LEFT)===Oe.NONE,"found single null side"),T.setLocation(e,ht.RIGHT,d),T.setLocation(e,ht.LEFT,d)}}};xi.prototype.getCoordinate=function(){var e=this.iterator();if(!e.hasNext())return null;var n=e.next();return n.getCoordinate()};xi.prototype.print=function(e){li.out.println("EdgeEndStar:   "+this.getCoordinate());for(var n=this.iterator();n.hasNext();){var i=n.next();i.print(e)}};xi.prototype.isAreaLabelsConsistent=function(e){return this.computeEdgeEndLabels(e.getBoundaryNodeRule()),this.checkAreaLabelsConsistent(0)};xi.prototype.checkAreaLabelsConsistent=function(e){var n=this.getEdges();if(n.size()<=0)return!0;var i=n.size()-1,u=n.get(i).getLabel(),h=u.getLocation(e,ht.LEFT);Qt.isTrue(h!==Oe.NONE,"Found unlabelled area edge");for(var d=h,s=this.iterator();s.hasNext();){var w=s.next(),T=w.getLabel();Qt.isTrue(T.isArea(e),"Found non-area edge");var A=T.getLocation(e,ht.LEFT),D=T.getLocation(e,ht.RIGHT);if(A===D||D!==d)return!1;d=A}return!0};xi.prototype.findIndex=function(e){var n=this;this.iterator();for(var i=0;i<this._edgeList.size();i++){var u=n._edgeList.get(i);if(u===e)return i}return-1};xi.prototype.iterator=function(){return this.getEdges().iterator()};xi.prototype.getEdges=function(){return this._edgeList===null&&(this._edgeList=new gt(this._edgeMap.values())),this._edgeList};xi.prototype.getLocation=function(e,n,i){return this._ptInAreaLocation[e]===Oe.NONE&&(this._ptInAreaLocation[e]=bo.locate(n,i[e].getGeometry())),this._ptInAreaLocation[e]};xi.prototype.toString=function(){var e=new ca;e.append("EdgeEndStar:   "+this.getCoordinate()),e.append(`
`);for(var n=this.iterator();n.hasNext();){var i=n.next();e.append(i),e.append(`
`)}return e.toString()};xi.prototype.computeEdgeEndLabels=function(e){for(var n=this.iterator();n.hasNext();){var i=n.next();i.computeLabel(e)}};xi.prototype.computeLabelling=function(e){var n=this;this.computeEdgeEndLabels(e[0].getBoundaryNodeRule()),this.propagateSideLabels(0),this.propagateSideLabels(1);for(var i=[!1,!1],u=this.iterator();u.hasNext();)for(var h=u.next(),d=h.getLabel(),s=0;s<2;s++)d.isLine(s)&&d.getLocation(s)===Oe.BOUNDARY&&(i[s]=!0);for(var w=this.iterator();w.hasNext();)for(var T=w.next(),A=T.getLabel(),D=0;D<2;D++)if(A.isAnyNull(D)){var R=Oe.NONE;if(i[D])R=Oe.EXTERIOR;else{var G=T.getCoordinate();R=n.getLocation(D,G,e)}A.setAllLocationsIfNull(D,R)}};xi.prototype.getDegree=function(){return this._edgeMap.size()};xi.prototype.insertEdgeEnd=function(e,n){this._edgeMap.put(e,n),this._edgeList=null};xi.prototype.interfaces_=function(){return[]};xi.prototype.getClass=function(){return xi};var LU=function(t){function e(){t.call(this),this._resultAreaEdgeList=null,this._label=null,this._SCANNING_FOR_INCOMING=1,this._LINKING_TO_OUTGOING=2}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.linkResultDirectedEdges=function(){var i=this;this.getResultAreaEdges();for(var u=null,h=null,d=this._SCANNING_FOR_INCOMING,s=0;s<this._resultAreaEdgeList.size();s++){var w=i._resultAreaEdgeList.get(s),T=w.getSym();if(w.getLabel().isArea())switch(u===null&&w.isInResult()&&(u=w),d){case i._SCANNING_FOR_INCOMING:if(!T.isInResult())continue;h=T,d=i._LINKING_TO_OUTGOING;break;case i._LINKING_TO_OUTGOING:if(!w.isInResult())continue;h.setNext(w),d=i._SCANNING_FOR_INCOMING;break}}if(d===this._LINKING_TO_OUTGOING){if(u===null)throw new Ol("no outgoing dirEdge found",this.getCoordinate());Qt.isTrue(u.isInResult(),"unable to link last incoming dirEdge"),h.setNext(u)}},e.prototype.insert=function(i){var u=i;this.insertEdgeEnd(u,u)},e.prototype.getRightmostEdge=function(){var i=this.getEdges(),u=i.size();if(u<1)return null;var h=i.get(0);if(u===1)return h;var d=i.get(u-1),s=h.getQuadrant(),w=d.getQuadrant();return Pn.isNorthern(s)&&Pn.isNorthern(w)?h:!Pn.isNorthern(s)&&!Pn.isNorthern(w)?d:h.getDy()!==0?h:d.getDy()!==0?d:(Qt.shouldNeverReachHere("found two horizontal edges incident on node"),null)},e.prototype.print=function(i){li.out.println("DirectedEdgeStar: "+this.getCoordinate());for(var u=this.iterator();u.hasNext();){var h=u.next();i.print("out "),h.print(i),i.println(),i.print("in "),h.getSym().print(i),i.println()}},e.prototype.getResultAreaEdges=function(){var i=this;if(this._resultAreaEdgeList!==null)return this._resultAreaEdgeList;this._resultAreaEdgeList=new gt;for(var u=this.iterator();u.hasNext();){var h=u.next();(h.isInResult()||h.getSym().isInResult())&&i._resultAreaEdgeList.add(h)}return this._resultAreaEdgeList},e.prototype.updateLabelling=function(i){for(var u=this.iterator();u.hasNext();){var h=u.next(),d=h.getLabel();d.setAllLocationsIfNull(0,i.getLocation(0)),d.setAllLocationsIfNull(1,i.getLocation(1))}},e.prototype.linkAllDirectedEdges=function(){var i=this;this.getEdges();for(var u=null,h=null,d=this._edgeList.size()-1;d>=0;d--){var s=i._edgeList.get(d),w=s.getSym();h===null&&(h=w),u!==null&&w.setNext(u),u=s}h.setNext(u)},e.prototype.computeDepths=function(){var i=this;if(arguments.length===1){var u=arguments[0],h=this.findIndex(u),d=u.getDepth(ht.LEFT),s=u.getDepth(ht.RIGHT),w=this.computeDepths(h+1,this._edgeList.size(),d),T=this.computeDepths(0,h,w);if(T!==s)throw new Ol("depth mismatch at "+u.getCoordinate())}else if(arguments.length===3){for(var A=arguments[0],D=arguments[1],R=arguments[2],G=R,$=A;$<D;$++){var ie=i._edgeList.get($);ie.setEdgeDepths(ht.RIGHT,G),G=ie.getDepth(ht.LEFT)}return G}},e.prototype.mergeSymLabels=function(){for(var i=this.iterator();i.hasNext();){var u=i.next(),h=u.getLabel();h.merge(u.getSym().getLabel())}},e.prototype.linkMinimalDirectedEdges=function(i){for(var u=this,h=null,d=null,s=this._SCANNING_FOR_INCOMING,w=this._resultAreaEdgeList.size()-1;w>=0;w--){var T=u._resultAreaEdgeList.get(w),A=T.getSym();switch(h===null&&T.getEdgeRing()===i&&(h=T),s){case u._SCANNING_FOR_INCOMING:if(A.getEdgeRing()!==i)continue;d=A,s=u._LINKING_TO_OUTGOING;break;case u._LINKING_TO_OUTGOING:if(T.getEdgeRing()!==i)continue;d.setNextMin(T),s=u._SCANNING_FOR_INCOMING;break}}s===this._LINKING_TO_OUTGOING&&(Qt.isTrue(h!==null,"found null for first outgoing dirEdge"),Qt.isTrue(h.getEdgeRing()===i,"unable to link last incoming dirEdge"),d.setNextMin(h))},e.prototype.getOutgoingDegree=function(){if(arguments.length===0){for(var i=0,u=this.iterator();u.hasNext();){var h=u.next();h.isInResult()&&i++}return i}else if(arguments.length===1){for(var d=arguments[0],s=0,w=this.iterator();w.hasNext();){var T=w.next();T.getEdgeRing()===d&&s++}return s}},e.prototype.getLabel=function(){return this._label},e.prototype.findCoveredLineEdges=function(){for(var i=Oe.NONE,u=this.iterator();u.hasNext();){var h=u.next(),d=h.getSym();if(!h.isLineEdge()){if(h.isInResult()){i=Oe.INTERIOR;break}if(d.isInResult()){i=Oe.EXTERIOR;break}}}if(i===Oe.NONE)return null;for(var s=i,w=this.iterator();w.hasNext();){var T=w.next(),A=T.getSym();T.isLineEdge()?T.getEdge().setCovered(s===Oe.INTERIOR):(T.isInResult()&&(s=Oe.EXTERIOR),A.isInResult()&&(s=Oe.INTERIOR))}},e.prototype.computeLabelling=function(i){var u=this;t.prototype.computeLabelling.call(this,i),this._label=new An(Oe.NONE);for(var h=this.iterator();h.hasNext();)for(var d=h.next(),s=d.getEdge(),w=s.getLabel(),T=0;T<2;T++){var A=w.getLocation(T);(A===Oe.INTERIOR||A===Oe.BOUNDARY)&&u._label.setLocation(T,Oe.INTERIOR)}},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(xi),cD=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.createNode=function(i){return new Ox(i,new LU)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(xd),Au=function t(){this._pts=null,this._orientation=null;var e=arguments[0];this._pts=e,this._orientation=t.orientation(e)};Au.prototype.compareTo=function(e){var n=e,i=Au.compareOriented(this._pts,this._orientation,n._pts,n._orientation);return i};Au.prototype.interfaces_=function(){return[ts]};Au.prototype.getClass=function(){return Au};Au.orientation=function(e){return un.increasingDirection(e)===1};Au.compareOriented=function(e,n,i,u){for(var h=n?1:-1,d=u?1:-1,s=n?e.length:-1,w=u?i.length:-1,T=n?0:e.length-1,A=u?0:i.length-1;;){var D=e[T].compareTo(i[A]);if(D!==0)return D;T+=h,A+=d;var R=T===s,G=A===w;if(R&&!G)return-1;if(!R&&G)return 1;if(R&&G)return 0}};var Ss=function(){this._edges=new gt,this._ocaMap=new yi};Ss.prototype.print=function(e){var n=this;e.print("MULTILINESTRING ( ");for(var i=0;i<this._edges.size();i++){var u=n._edges.get(i);i>0&&e.print(","),e.print("(");for(var h=u.getCoordinates(),d=0;d<h.length;d++)d>0&&e.print(","),e.print(h[d].x+" "+h[d].y);e.println(")")}e.print(")  ")};Ss.prototype.addAll=function(e){for(var n=this,i=e.iterator();i.hasNext();)n.add(i.next())};Ss.prototype.findEdgeIndex=function(e){for(var n=this,i=0;i<this._edges.size();i++)if(n._edges.get(i).equals(e))return i;return-1};Ss.prototype.iterator=function(){return this._edges.iterator()};Ss.prototype.getEdges=function(){return this._edges};Ss.prototype.get=function(e){return this._edges.get(e)};Ss.prototype.findEqualEdge=function(e){var n=new Au(e.getCoordinates()),i=this._ocaMap.get(n);return i};Ss.prototype.add=function(e){this._edges.add(e);var n=new Au(e.getCoordinates());this._ocaMap.put(n,e)};Ss.prototype.interfaces_=function(){return[]};Ss.prototype.getClass=function(){return Ss};var Vc=function(){};Vc.prototype.processIntersections=function(e,n,i,u){};Vc.prototype.isDone=function(){};Vc.prototype.interfaces_=function(){return[]};Vc.prototype.getClass=function(){return Vc};var Co=function(){this._hasIntersection=!1,this._hasProper=!1,this._hasProperInterior=!1,this._hasInterior=!1,this._properIntersectionPoint=null,this._li=null,this._isSelfIntersection=null,this.numIntersections=0,this.numInteriorIntersections=0,this.numProperIntersections=0,this.numTests=0;var e=arguments[0];this._li=e};Co.prototype.isTrivialIntersection=function(e,n,i,u){if(e===i&&this._li.getIntersectionNum()===1){if(Co.isAdjacentSegments(n,u))return!0;if(e.isClosed()){var h=e.size()-1;if(n===0&&u===h||u===0&&n===h)return!0}}return!1};Co.prototype.getProperIntersectionPoint=function(){return this._properIntersectionPoint};Co.prototype.hasProperInteriorIntersection=function(){return this._hasProperInterior};Co.prototype.getLineIntersector=function(){return this._li};Co.prototype.hasProperIntersection=function(){return this._hasProper};Co.prototype.processIntersections=function(e,n,i,u){if(e===i&&n===u)return null;this.numTests++;var h=e.getCoordinates()[n],d=e.getCoordinates()[n+1],s=i.getCoordinates()[u],w=i.getCoordinates()[u+1];this._li.computeIntersection(h,d,s,w),this._li.hasIntersection()&&(this.numIntersections++,this._li.isInteriorIntersection()&&(this.numInteriorIntersections++,this._hasInterior=!0),this.isTrivialIntersection(e,n,i,u)||(this._hasIntersection=!0,e.addIntersections(this._li,n,0),i.addIntersections(this._li,u,1),this._li.isProper()&&(this.numProperIntersections++,this._hasProper=!0,this._hasProperInterior=!0)))};Co.prototype.hasIntersection=function(){return this._hasIntersection};Co.prototype.isDone=function(){return!1};Co.prototype.hasInteriorIntersection=function(){return this._hasInterior};Co.prototype.interfaces_=function(){return[Vc]};Co.prototype.getClass=function(){return Co};Co.isAdjacentSegments=function(e,n){return Math.abs(e-n)===1};var sa=function(){this.coord=null,this.segmentIndex=null,this.dist=null;var e=arguments[0],n=arguments[1],i=arguments[2];this.coord=new Me(e),this.segmentIndex=n,this.dist=i};sa.prototype.getSegmentIndex=function(){return this.segmentIndex};sa.prototype.getCoordinate=function(){return this.coord};sa.prototype.print=function(e){e.print(this.coord),e.print(" seg # = "+this.segmentIndex),e.println(" dist = "+this.dist)};sa.prototype.compareTo=function(e){var n=e;return this.compare(n.segmentIndex,n.dist)};sa.prototype.isEndPoint=function(e){return this.segmentIndex===0&&this.dist===0||this.segmentIndex===e};sa.prototype.toString=function(){return this.coord+" seg # = "+this.segmentIndex+" dist = "+this.dist};sa.prototype.getDistance=function(){return this.dist};sa.prototype.compare=function(e,n){return this.segmentIndex<e?-1:this.segmentIndex>e?1:this.dist<n?-1:this.dist>n?1:0};sa.prototype.interfaces_=function(){return[ts]};sa.prototype.getClass=function(){return sa};var Ja=function(){this._nodeMap=new yi,this.edge=null;var e=arguments[0];this.edge=e};Ja.prototype.print=function(e){e.println("Intersections:");for(var n=this.iterator();n.hasNext();){var i=n.next();i.print(e)}};Ja.prototype.iterator=function(){return this._nodeMap.values().iterator()};Ja.prototype.addSplitEdges=function(e){var n=this;this.addEndpoints();for(var i=this.iterator(),u=i.next();i.hasNext();){var h=i.next(),d=n.createSplitEdge(u,h);e.add(d),u=h}};Ja.prototype.addEndpoints=function(){var e=this.edge.pts.length-1;this.add(this.edge.pts[0],0,0),this.add(this.edge.pts[e],e,0)};Ja.prototype.createSplitEdge=function(e,n){var i=this,u=n.segmentIndex-e.segmentIndex+2,h=this.edge.pts[n.segmentIndex],d=n.dist>0||!n.coord.equals2D(h);d||u--;var s=new Array(u).fill(null),w=0;s[w++]=new Me(e.coord);for(var T=e.segmentIndex+1;T<=n.segmentIndex;T++)s[w++]=i.edge.pts[T];return d&&(s[w]=n.coord),new K0(s,new An(this.edge._label))};Ja.prototype.add=function(e,n,i){var u=new sa(e,n,i),h=this._nodeMap.get(u);return h!==null?h:(this._nodeMap.put(u,u),u)};Ja.prototype.isIntersection=function(e){for(var n=this.iterator();n.hasNext();){var i=n.next();if(i.coord.equals(e))return!0}return!1};Ja.prototype.interfaces_=function(){return[]};Ja.prototype.getClass=function(){return Ja};var jc=function(){};jc.prototype.getChainStartIndices=function(e){var n=this,i=0,u=new gt;u.add(new ea(i));do{var h=n.findChainEnd(e,i);u.add(new ea(h)),i=h}while(i<e.length-1);var d=jc.toIntArray(u);return d};jc.prototype.findChainEnd=function(e,n){for(var i=Pn.quadrant(e[n],e[n+1]),u=n+1;u<e.length;){var h=Pn.quadrant(e[u-1],e[u]);if(h!==i)break;u++}return u-1};jc.prototype.interfaces_=function(){return[]};jc.prototype.getClass=function(){return jc};jc.toIntArray=function(e){for(var n=new Array(e.size()).fill(null),i=0;i<n.length;i++)n[i]=e.get(i).intValue();return n};var Fl=function(){this.e=null,this.pts=null,this.startIndex=null,this.env1=new Dt,this.env2=new Dt;var e=arguments[0];this.e=e,this.pts=e.getCoordinates();var n=new jc;this.startIndex=n.getChainStartIndices(this.pts)};Fl.prototype.getCoordinates=function(){return this.pts};Fl.prototype.getMaxX=function(e){var n=this.pts[this.startIndex[e]].x,i=this.pts[this.startIndex[e+1]].x;return n>i?n:i};Fl.prototype.getMinX=function(e){var n=this.pts[this.startIndex[e]].x,i=this.pts[this.startIndex[e+1]].x;return n<i?n:i};Fl.prototype.computeIntersectsForChain=function(){if(arguments.length===4){var e=arguments[0],n=arguments[1],i=arguments[2],u=arguments[3];this.computeIntersectsForChain(this.startIndex[e],this.startIndex[e+1],n,n.startIndex[i],n.startIndex[i+1],u)}else if(arguments.length===6){var h=arguments[0],d=arguments[1],s=arguments[2],w=arguments[3],T=arguments[4],A=arguments[5],D=this.pts[h],R=this.pts[d],G=s.pts[w],$=s.pts[T];if(d-h===1&&T-w===1)return A.addIntersections(this.e,h,s.e,w),null;if(this.env1.init(D,R),this.env2.init(G,$),!this.env1.intersects(this.env2))return null;var ie=Math.trunc((h+d)/2),_e=Math.trunc((w+T)/2);h<ie&&(w<_e&&this.computeIntersectsForChain(h,ie,s,w,_e,A),_e<T&&this.computeIntersectsForChain(h,ie,s,_e,T,A)),ie<d&&(w<_e&&this.computeIntersectsForChain(ie,d,s,w,_e,A),_e<T&&this.computeIntersectsForChain(ie,d,s,_e,T,A))}};Fl.prototype.getStartIndexes=function(){return this.startIndex};Fl.prototype.computeIntersects=function(e,n){for(var i=this,u=0;u<this.startIndex.length-1;u++)for(var h=0;h<e.startIndex.length-1;h++)i.computeIntersectsForChain(u,e,h,n)};Fl.prototype.interfaces_=function(){return[]};Fl.prototype.getClass=function(){return Fl};var ai=function t(){var e=this;this._depth=Array(2).fill().map(function(){return Array(3)});for(var n=0;n<2;n++)for(var i=0;i<3;i++)e._depth[n][i]=t.NULL_VALUE},hD={NULL_VALUE:{configurable:!0}};ai.prototype.getDepth=function(e,n){return this._depth[e][n]};ai.prototype.setDepth=function(e,n,i){this._depth[e][n]=i};ai.prototype.isNull=function(){var e=this;if(arguments.length===0){for(var n=0;n<2;n++)for(var i=0;i<3;i++)if(e._depth[n][i]!==ai.NULL_VALUE)return!1;return!0}else if(arguments.length===1){var u=arguments[0];return this._depth[u][1]===ai.NULL_VALUE}else if(arguments.length===2){var h=arguments[0],d=arguments[1];return this._depth[h][d]===ai.NULL_VALUE}};ai.prototype.normalize=function(){for(var e=this,n=0;n<2;n++)if(!e.isNull(n)){var i=e._depth[n][1];e._depth[n][2]<i&&(i=e._depth[n][2]),i<0&&(i=0);for(var u=1;u<3;u++){var h=0;e._depth[n][u]>i&&(h=1),e._depth[n][u]=h}}};ai.prototype.getDelta=function(e){return this._depth[e][ht.RIGHT]-this._depth[e][ht.LEFT]};ai.prototype.getLocation=function(e,n){return this._depth[e][n]<=0?Oe.EXTERIOR:Oe.INTERIOR};ai.prototype.toString=function(){return"A: "+this._depth[0][1]+","+this._depth[0][2]+" B: "+this._depth[1][1]+","+this._depth[1][2]};ai.prototype.add=function(){var e=this;if(arguments.length===1)for(var n=arguments[0],i=0;i<2;i++)for(var u=1;u<3;u++){var h=n.getLocation(i,u);(h===Oe.EXTERIOR||h===Oe.INTERIOR)&&(e.isNull(i,u)?e._depth[i][u]=ai.depthAtLocation(h):e._depth[i][u]+=ai.depthAtLocation(h))}else if(arguments.length===3){var d=arguments[0],s=arguments[1],w=arguments[2];w===Oe.INTERIOR&&this._depth[d][s]++}};ai.prototype.interfaces_=function(){return[]};ai.prototype.getClass=function(){return ai};ai.depthAtLocation=function(e){return e===Oe.EXTERIOR?0:e===Oe.INTERIOR?1:ai.NULL_VALUE};hD.NULL_VALUE.get=function(){return-1};Object.defineProperties(ai,hD);var K0=function(t){function e(){if(t.call(this),this.pts=null,this._env=null,this.eiList=new Ja(this),this._name=null,this._mce=null,this._isIsolated=!0,this._depth=new ai,this._depthDelta=0,arguments.length===1){var n=arguments[0];e.call(this,n,null)}else if(arguments.length===2){var i=arguments[0],u=arguments[1];this.pts=i,this._label=u}}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getDepth=function(){return this._depth},e.prototype.getCollapsedEdge=function(){var i=new Array(2).fill(null);i[0]=this.pts[0],i[1]=this.pts[1];var u=new e(i,An.toLineLabel(this._label));return u},e.prototype.isIsolated=function(){return this._isIsolated},e.prototype.getCoordinates=function(){return this.pts},e.prototype.setIsolated=function(i){this._isIsolated=i},e.prototype.setName=function(i){this._name=i},e.prototype.equals=function(i){var u=this;if(!(i instanceof e))return!1;var h=i;if(this.pts.length!==h.pts.length)return!1;for(var d=!0,s=!0,w=this.pts.length,T=0;T<this.pts.length;T++)if(u.pts[T].equals2D(h.pts[T])||(d=!1),u.pts[T].equals2D(h.pts[--w])||(s=!1),!d&&!s)return!1;return!0},e.prototype.getCoordinate=function(){if(arguments.length===0)return this.pts.length>0?this.pts[0]:null;if(arguments.length===1){var i=arguments[0];return this.pts[i]}},e.prototype.print=function(i){var u=this;i.print("edge "+this._name+": "),i.print("LINESTRING (");for(var h=0;h<this.pts.length;h++)h>0&&i.print(","),i.print(u.pts[h].x+" "+u.pts[h].y);i.print(")  "+this._label+" "+this._depthDelta)},e.prototype.computeIM=function(i){e.updateIM(this._label,i)},e.prototype.isCollapsed=function(){return!this._label.isArea()||this.pts.length!==3?!1:!!this.pts[0].equals(this.pts[2])},e.prototype.isClosed=function(){return this.pts[0].equals(this.pts[this.pts.length-1])},e.prototype.getMaximumSegmentIndex=function(){return this.pts.length-1},e.prototype.getDepthDelta=function(){return this._depthDelta},e.prototype.getNumPoints=function(){return this.pts.length},e.prototype.printReverse=function(i){var u=this;i.print("edge "+this._name+": ");for(var h=this.pts.length-1;h>=0;h--)i.print(u.pts[h]+" ");i.println("")},e.prototype.getMonotoneChainEdge=function(){return this._mce===null&&(this._mce=new Fl(this)),this._mce},e.prototype.getEnvelope=function(){var i=this;if(this._env===null){this._env=new Dt;for(var u=0;u<this.pts.length;u++)i._env.expandToInclude(i.pts[u])}return this._env},e.prototype.addIntersection=function(i,u,h,d){var s=new Me(i.getIntersection(d)),w=u,T=i.getEdgeDistance(h,d),A=w+1;if(A<this.pts.length){var D=this.pts[A];s.equals2D(D)&&(w=A,T=0)}this.eiList.add(s,w,T)},e.prototype.toString=function(){var i=this,u=new ca;u.append("edge "+this._name+": "),u.append("LINESTRING (");for(var h=0;h<this.pts.length;h++)h>0&&u.append(","),u.append(i.pts[h].x+" "+i.pts[h].y);return u.append(")  "+this._label+" "+this._depthDelta),u.toString()},e.prototype.isPointwiseEqual=function(i){var u=this;if(this.pts.length!==i.pts.length)return!1;for(var h=0;h<this.pts.length;h++)if(!u.pts[h].equals2D(i.pts[h]))return!1;return!0},e.prototype.setDepthDelta=function(i){this._depthDelta=i},e.prototype.getEdgeIntersectionList=function(){return this.eiList},e.prototype.addIntersections=function(i,u,h){for(var d=this,s=0;s<i.getIntersectionNum();s++)d.addIntersection(i,u,h,s)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e.updateIM=function(){if(arguments.length===2){var i=arguments[0],u=arguments[1];u.setAtLeastIfValid(i.getLocation(0,ht.ON),i.getLocation(1,ht.ON),1),i.isArea()&&(u.setAtLeastIfValid(i.getLocation(0,ht.LEFT),i.getLocation(1,ht.LEFT),2),u.setAtLeastIfValid(i.getLocation(0,ht.RIGHT),i.getLocation(1,ht.RIGHT),2))}else return t.prototype.updateIM.apply(this,arguments)},e}(So),Di=function(e){this._workingPrecisionModel=null,this._workingNoder=null,this._geomFact=null,this._graph=null,this._edgeList=new Ss,this._bufParams=e||null};Di.prototype.setWorkingPrecisionModel=function(e){this._workingPrecisionModel=e};Di.prototype.insertUniqueEdge=function(e){var n=this._edgeList.findEqualEdge(e);if(n!==null){var i=n.getLabel(),u=e.getLabel();n.isPointwiseEqual(e)||(u=new An(e.getLabel()),u.flip()),i.merge(u);var h=Di.depthDelta(u),d=n.getDepthDelta(),s=d+h;n.setDepthDelta(s)}else this._edgeList.add(e),e.setDepthDelta(Di.depthDelta(e.getLabel()))};Di.prototype.buildSubgraphs=function(e,n){for(var i=new gt,u=e.iterator();u.hasNext();){var h=u.next(),d=h.getRightmostCoordinate(),s=new df(i),w=s.getDepth(d);h.computeDepth(w),h.findResultEdges(),i.add(h),n.add(h.getDirectedEdges(),h.getNodes())}};Di.prototype.createSubgraphs=function(e){for(var n=new gt,i=e.getNodes().iterator();i.hasNext();){var u=i.next();if(!u.isVisited()){var h=new Ni;h.create(u),n.add(h)}}return Es.sort(n,Es.reverseOrder()),n};Di.prototype.createEmptyResultGeometry=function(){var e=this._geomFact.createPolygon();return e};Di.prototype.getNoder=function(e){if(this._workingNoder!==null)return this._workingNoder;var n=new VS,i=new Yc;return i.setPrecisionModel(e),n.setSegmentIntersector(new Co(i)),n};Di.prototype.buffer=function(e,n){var i=this._workingPrecisionModel;i===null&&(i=e.getPrecisionModel()),this._geomFact=e.getFactory();var u=new Xi(i,this._bufParams),h=new es(e,n,u),d=h.getCurves();if(d.size()<=0)return this.createEmptyResultGeometry();this.computeNodedEdges(d,i),this._graph=new sr(new cD),this._graph.addEdges(this._edgeList.getEdges());var s=this.createSubgraphs(this._graph),w=new uo(this._geomFact);this.buildSubgraphs(s,w);var T=w.getPolygons();if(T.size()<=0)return this.createEmptyResultGeometry();var A=this._geomFact.buildGeometry(T);return A};Di.prototype.computeNodedEdges=function(e,n){var i=this,u=this.getNoder(n);u.computeNodes(e);for(var h=u.getNodedSubstrings(),d=h.iterator();d.hasNext();){var s=d.next(),w=s.getCoordinates();if(!(w.length===2&&w[0].equals2D(w[1]))){var T=s.getData(),A=new K0(s.getCoordinates(),new An(T));i.insertUniqueEdge(A)}}};Di.prototype.setNoder=function(e){this._workingNoder=e};Di.prototype.interfaces_=function(){return[]};Di.prototype.getClass=function(){return Di};Di.depthDelta=function(e){var n=e.getLocation(0,ht.LEFT),i=e.getLocation(0,ht.RIGHT);return n===Oe.INTERIOR&&i===Oe.EXTERIOR?1:n===Oe.EXTERIOR&&i===Oe.INTERIOR?-1:0};Di.convertSegStrings=function(e){for(var n=new ln,i=new gt;e.hasNext();){var u=e.next(),h=n.createLineString(u.getCoordinates());i.add(h)}return n.buildGeometry(i)};var Pu=function(){if(this._noder=null,this._scaleFactor=null,this._offsetX=null,this._offsetY=null,this._isScaled=!1,arguments.length===2){var e=arguments[0],n=arguments[1];this._noder=e,this._scaleFactor=n,this._offsetX=0,this._offsetY=0,this._isScaled=!this.isIntegerPrecision()}else if(arguments.length===4){var i=arguments[0],u=arguments[1],h=arguments[2],d=arguments[3];this._noder=i,this._scaleFactor=u,this._offsetX=h,this._offsetY=d,this._isScaled=!this.isIntegerPrecision()}};Pu.prototype.rescale=function(){var e=this;if(Ut(arguments[0],Or))for(var n=arguments[0],i=n.iterator();i.hasNext();){var u=i.next();e.rescale(u.getCoordinates())}else if(arguments[0]instanceof Array){for(var h=arguments[0],d=0;d<h.length;d++)h[d].x=h[d].x/e._scaleFactor+e._offsetX,h[d].y=h[d].y/e._scaleFactor+e._offsetY;h.length===2&&h[0].equals2D(h[1])&&li.out.println(h)}};Pu.prototype.scale=function(){var e=this;if(Ut(arguments[0],Or)){for(var n=arguments[0],i=new gt,u=n.iterator();u.hasNext();){var h=u.next();i.add(new vr(e.scale(h.getCoordinates()),h.getData()))}return i}else if(arguments[0]instanceof Array){for(var d=arguments[0],s=new Array(d.length).fill(null),w=0;w<d.length;w++)s[w]=new Me(Math.round((d[w].x-e._offsetX)*e._scaleFactor),Math.round((d[w].y-e._offsetY)*e._scaleFactor),d[w].z);var T=un.removeRepeatedPoints(s);return T}};Pu.prototype.isIntegerPrecision=function(){return this._scaleFactor===1};Pu.prototype.getNodedSubstrings=function(){var e=this._noder.getNodedSubstrings();return this._isScaled&&this.rescale(e),e};Pu.prototype.computeNodes=function(e){var n=e;this._isScaled&&(n=this.scale(e)),this._noder.computeNodes(n)};Pu.prototype.interfaces_=function(){return[Bc]};Pu.prototype.getClass=function(){return Pu};var aa=function(){this._li=new Yc,this._segStrings=null;var e=arguments[0];this._segStrings=e},fD={fact:{configurable:!0}};aa.prototype.checkEndPtVertexIntersections=function(){var e=this;if(arguments.length===0)for(var n=this._segStrings.iterator();n.hasNext();){var i=n.next(),u=i.getCoordinates();e.checkEndPtVertexIntersections(u[0],e._segStrings),e.checkEndPtVertexIntersections(u[u.length-1],e._segStrings)}else if(arguments.length===2){for(var h=arguments[0],d=arguments[1],s=d.iterator();s.hasNext();)for(var w=s.next(),T=w.getCoordinates(),A=1;A<T.length-1;A++)if(T[A].equals(h))throw new Nl("found endpt/interior pt intersection at index "+A+" :pt "+h)}};aa.prototype.checkInteriorIntersections=function(){var e=this;if(arguments.length===0)for(var n=this._segStrings.iterator();n.hasNext();)for(var i=n.next(),u=this._segStrings.iterator();u.hasNext();){var h=u.next();e.checkInteriorIntersections(i,h)}else if(arguments.length===2)for(var d=arguments[0],s=arguments[1],w=d.getCoordinates(),T=s.getCoordinates(),A=0;A<w.length-1;A++)for(var D=0;D<T.length-1;D++)e.checkInteriorIntersections(d,A,s,D);else if(arguments.length===4){var R=arguments[0],G=arguments[1],$=arguments[2],ie=arguments[3];if(R===$&&G===ie)return null;var _e=R.getCoordinates()[G],Y=R.getCoordinates()[G+1],B=$.getCoordinates()[ie],q=$.getCoordinates()[ie+1];if(this._li.computeIntersection(_e,Y,B,q),this._li.hasIntersection()&&(this._li.isProper()||this.hasInteriorIntersection(this._li,_e,Y)||this.hasInteriorIntersection(this._li,B,q)))throw new Nl("found non-noded intersection at "+_e+"-"+Y+" and "+B+"-"+q)}};aa.prototype.checkValid=function(){this.checkEndPtVertexIntersections(),this.checkInteriorIntersections(),this.checkCollapses()};aa.prototype.checkCollapses=function(){var e=this;if(arguments.length===0)for(var n=this._segStrings.iterator();n.hasNext();){var i=n.next();e.checkCollapses(i)}else if(arguments.length===1)for(var u=arguments[0],h=u.getCoordinates(),d=0;d<h.length-2;d++)e.checkCollapse(h[d],h[d+1],h[d+2])};aa.prototype.hasInteriorIntersection=function(e,n,i){for(var u=0;u<e.getIntersectionNum();u++){var h=e.getIntersection(u);if(!(h.equals(n)||h.equals(i)))return!0}return!1};aa.prototype.checkCollapse=function(e,n,i){if(e.equals(i))throw new Nl("found non-noded collapse at "+aa.fact.createLineString([e,n,i]))};aa.prototype.interfaces_=function(){return[]};aa.prototype.getClass=function(){return aa};fD.fact.get=function(){return new ln};Object.defineProperties(aa,fD);var $i=function(){this._li=null,this._pt=null,this._originalPt=null,this._ptScaled=null,this._p0Scaled=null,this._p1Scaled=null,this._scaleFactor=null,this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,this._corner=new Array(4).fill(null),this._safeEnv=null;var e=arguments[0],n=arguments[1],i=arguments[2];if(this._originalPt=e,this._pt=e,this._scaleFactor=n,this._li=i,n<=0)throw new er("Scale factor must be non-zero");n!==1&&(this._pt=new Me(this.scale(e.x),this.scale(e.y)),this._p0Scaled=new Me,this._p1Scaled=new Me),this.initCorners(this._pt)},pD={SAFE_ENV_EXPANSION_FACTOR:{configurable:!0}};$i.prototype.intersectsScaled=function(e,n){var i=Math.min(e.x,n.x),u=Math.max(e.x,n.x),h=Math.min(e.y,n.y),d=Math.max(e.y,n.y),s=this._maxx<i||this._minx>u||this._maxy<h||this._miny>d;if(s)return!1;var w=this.intersectsToleranceSquare(e,n);return Qt.isTrue(!(s&&w),"Found bad envelope test"),w};$i.prototype.initCorners=function(e){var n=.5;this._minx=e.x-n,this._maxx=e.x+n,this._miny=e.y-n,this._maxy=e.y+n,this._corner[0]=new Me(this._maxx,this._maxy),this._corner[1]=new Me(this._minx,this._maxy),this._corner[2]=new Me(this._minx,this._miny),this._corner[3]=new Me(this._maxx,this._miny)};$i.prototype.intersects=function(e,n){return this._scaleFactor===1?this.intersectsScaled(e,n):(this.copyScaled(e,this._p0Scaled),this.copyScaled(n,this._p1Scaled),this.intersectsScaled(this._p0Scaled,this._p1Scaled))};$i.prototype.scale=function(e){return Math.round(e*this._scaleFactor)};$i.prototype.getCoordinate=function(){return this._originalPt};$i.prototype.copyScaled=function(e,n){n.x=this.scale(e.x),n.y=this.scale(e.y)};$i.prototype.getSafeEnvelope=function(){if(this._safeEnv===null){var e=$i.SAFE_ENV_EXPANSION_FACTOR/this._scaleFactor;this._safeEnv=new Dt(this._originalPt.x-e,this._originalPt.x+e,this._originalPt.y-e,this._originalPt.y+e)}return this._safeEnv};$i.prototype.intersectsPixelClosure=function(e,n){return this._li.computeIntersection(e,n,this._corner[0],this._corner[1]),!!(this._li.hasIntersection()||(this._li.computeIntersection(e,n,this._corner[1],this._corner[2]),this._li.hasIntersection())||(this._li.computeIntersection(e,n,this._corner[2],this._corner[3]),this._li.hasIntersection())||(this._li.computeIntersection(e,n,this._corner[3],this._corner[0]),this._li.hasIntersection()))};$i.prototype.intersectsToleranceSquare=function(e,n){var i=!1,u=!1;return this._li.computeIntersection(e,n,this._corner[0],this._corner[1]),!!(this._li.isProper()||(this._li.computeIntersection(e,n,this._corner[1],this._corner[2]),this._li.isProper())||(this._li.hasIntersection()&&(i=!0),this._li.computeIntersection(e,n,this._corner[2],this._corner[3]),this._li.isProper())||(this._li.hasIntersection()&&(u=!0),this._li.computeIntersection(e,n,this._corner[3],this._corner[0]),this._li.isProper())||i&&u||e.equals(this._pt)||n.equals(this._pt))};$i.prototype.addSnappedNode=function(e,n){var i=e.getCoordinate(n),u=e.getCoordinate(n+1);return this.intersects(i,u)?(e.addIntersection(this.getCoordinate(),n),!0):!1};$i.prototype.interfaces_=function(){return[]};$i.prototype.getClass=function(){return $i};pD.SAFE_ENV_EXPANSION_FACTOR.get=function(){return .75};Object.defineProperties($i,pD);var I_=function(){this.tempEnv1=new Dt,this.selectedSegment=new Nt};I_.prototype.select=function(){if(arguments.length!==1){if(arguments.length===2){var e=arguments[0],n=arguments[1];e.getLineSegment(n,this.selectedSegment),this.select(this.selectedSegment)}}};I_.prototype.interfaces_=function(){return[]};I_.prototype.getClass=function(){return I_};var Sd=function(){this._index=null;var e=arguments[0];this._index=e},dD={HotPixelSnapAction:{configurable:!0}};Sd.prototype.snap=function(){if(arguments.length===1){var e=arguments[0];return this.snap(e,null,-1)}else if(arguments.length===3){var n=arguments[0],i=arguments[1],u=arguments[2],h=n.getSafeEnvelope(),d=new mD(n,i,u);return this._index.query(h,{interfaces_:function(){return[Iu]},visitItem:function(s){var w=s;w.select(h,d)}}),d.isNodeAdded()}};Sd.prototype.interfaces_=function(){return[]};Sd.prototype.getClass=function(){return Sd};dD.HotPixelSnapAction.get=function(){return mD};Object.defineProperties(Sd,dD);var mD=function(t){function e(){t.call(this),this._hotPixel=null,this._parentEdge=null,this._hotPixelVertexIndex=null,this._isNodeAdded=!1;var n=arguments[0],i=arguments[1],u=arguments[2];this._hotPixel=n,this._parentEdge=i,this._hotPixelVertexIndex=u}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.isNodeAdded=function(){return this._isNodeAdded},e.prototype.select=function(){if(arguments.length===2){var i=arguments[0],u=arguments[1],h=i.getContext();if(this._parentEdge!==null&&h===this._parentEdge&&u===this._hotPixelVertexIndex)return null;this._isNodeAdded=this._hotPixel.addSnappedNode(h,u)}else return t.prototype.select.apply(this,arguments)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(I_),mf=function(){this._li=null,this._interiorIntersections=null;var e=arguments[0];this._li=e,this._interiorIntersections=new gt};mf.prototype.processIntersections=function(e,n,i,u){var h=this;if(e===i&&n===u)return null;var d=e.getCoordinates()[n],s=e.getCoordinates()[n+1],w=i.getCoordinates()[u],T=i.getCoordinates()[u+1];if(this._li.computeIntersection(d,s,w,T),this._li.hasIntersection()&&this._li.isInteriorIntersection()){for(var A=0;A<this._li.getIntersectionNum();A++)h._interiorIntersections.add(h._li.getIntersection(A));e.addIntersections(this._li,n,0),i.addIntersections(this._li,u,1)}};mf.prototype.isDone=function(){return!1};mf.prototype.getInteriorIntersections=function(){return this._interiorIntersections};mf.prototype.interfaces_=function(){return[Vc]};mf.prototype.getClass=function(){return mf};var Qa=function(){this._pm=null,this._li=null,this._scaleFactor=null,this._noder=null,this._pointSnapper=null,this._nodedSegStrings=null;var e=arguments[0];this._pm=e,this._li=new Yc,this._li.setPrecisionModel(e),this._scaleFactor=e.getScale()};Qa.prototype.checkCorrectness=function(e){var n=vr.getNodedSubstrings(e),i=new aa(n);try{i.checkValid()}catch(u){if(u instanceof JL)u.printStackTrace();else throw u}finally{}};Qa.prototype.getNodedSubstrings=function(){return vr.getNodedSubstrings(this._nodedSegStrings)};Qa.prototype.snapRound=function(e,n){var i=this.findInteriorIntersections(e,n);this.computeIntersectionSnaps(i),this.computeVertexSnaps(e)};Qa.prototype.findInteriorIntersections=function(e,n){var i=new mf(n);return this._noder.setSegmentIntersector(i),this._noder.computeNodes(e),i.getInteriorIntersections()};Qa.prototype.computeVertexSnaps=function(){var e=this;if(Ut(arguments[0],Or))for(var n=arguments[0],i=n.iterator();i.hasNext();){var u=i.next();e.computeVertexSnaps(u)}else if(arguments[0]instanceof vr)for(var h=arguments[0],d=h.getCoordinates(),s=0;s<d.length;s++){var w=new $i(d[s],e._scaleFactor,e._li),T=e._pointSnapper.snap(w,h,s);T&&h.addIntersection(d[s],s)}};Qa.prototype.computeNodes=function(e){this._nodedSegStrings=e,this._noder=new VS,this._pointSnapper=new Sd(this._noder.getIndex()),this.snapRound(e,this._li)};Qa.prototype.computeIntersectionSnaps=function(e){for(var n=this,i=e.iterator();i.hasNext();){var u=i.next(),h=new $i(u,n._scaleFactor,n._li);n._pointSnapper.snap(h)}};Qa.prototype.interfaces_=function(){return[Bc]};Qa.prototype.getClass=function(){return Qa};var si=function(){if(this._argGeom=null,this._distance=null,this._bufParams=new wn,this._resultGeometry=null,this._saveException=null,arguments.length===1){var e=arguments[0];this._argGeom=e}else if(arguments.length===2){var n=arguments[0],i=arguments[1];this._argGeom=n,this._bufParams=i}},Ud={CAP_ROUND:{configurable:!0},CAP_BUTT:{configurable:!0},CAP_FLAT:{configurable:!0},CAP_SQUARE:{configurable:!0},MAX_PRECISION_DIGITS:{configurable:!0}};si.prototype.bufferFixedPrecision=function(e){var n=new Pu(new Qa(new bn(1)),e.getScale()),i=new Di(this._bufParams);i.setWorkingPrecisionModel(e),i.setNoder(n),this._resultGeometry=i.buffer(this._argGeom,this._distance)};si.prototype.bufferReducedPrecision=function(){var e=this;if(arguments.length===0){for(var n=si.MAX_PRECISION_DIGITS;n>=0;n--){try{e.bufferReducedPrecision(n)}catch(d){if(d instanceof Ol)e._saveException=d;else throw d}finally{}if(e._resultGeometry!==null)return null}throw this._saveException}else if(arguments.length===1){var i=arguments[0],u=si.precisionScaleFactor(this._argGeom,this._distance,i),h=new bn(u);this.bufferFixedPrecision(h)}};si.prototype.computeGeometry=function(){if(this.bufferOriginalPrecision(),this._resultGeometry!==null)return null;var e=this._argGeom.getFactory().getPrecisionModel();e.getType()===bn.FIXED?this.bufferFixedPrecision(e):this.bufferReducedPrecision()};si.prototype.setQuadrantSegments=function(e){this._bufParams.setQuadrantSegments(e)};si.prototype.bufferOriginalPrecision=function(){try{var e=new Di(this._bufParams);this._resultGeometry=e.buffer(this._argGeom,this._distance)}catch(n){if(n instanceof Nl)this._saveException=n;else throw n}finally{}};si.prototype.getResultGeometry=function(e){return this._distance=e,this.computeGeometry(),this._resultGeometry};si.prototype.setEndCapStyle=function(e){this._bufParams.setEndCapStyle(e)};si.prototype.interfaces_=function(){return[]};si.prototype.getClass=function(){return si};si.bufferOp=function(){if(arguments.length===2){var e=arguments[0],n=arguments[1],i=new si(e),u=i.getResultGeometry(n);return u}else if(arguments.length===3){if(Number.isInteger(arguments[2])&&arguments[0]instanceof Ft&&typeof arguments[1]=="number"){var h=arguments[0],d=arguments[1],s=arguments[2],w=new si(h);w.setQuadrantSegments(s);var T=w.getResultGeometry(d);return T}else if(arguments[2]instanceof wn&&arguments[0]instanceof Ft&&typeof arguments[1]=="number"){var A=arguments[0],D=arguments[1],R=arguments[2],G=new si(A,R),$=G.getResultGeometry(D);return $}}else if(arguments.length===4){var ie=arguments[0],_e=arguments[1],Y=arguments[2],B=arguments[3],q=new si(ie);q.setQuadrantSegments(Y),q.setEndCapStyle(B);var oe=q.getResultGeometry(_e);return oe}};si.precisionScaleFactor=function(e,n,i){var u=e.getEnvelopeInternal(),h=Eo.max(Math.abs(u.getMaxX()),Math.abs(u.getMaxY()),Math.abs(u.getMinX()),Math.abs(u.getMinY())),d=n>0?n:0,s=h+2*d,w=Math.trunc(Math.log(s)/Math.log(10)+1),T=i-w,A=Math.pow(10,T);return A};Ud.CAP_ROUND.get=function(){return wn.CAP_ROUND};Ud.CAP_BUTT.get=function(){return wn.CAP_FLAT};Ud.CAP_FLAT.get=function(){return wn.CAP_FLAT};Ud.CAP_SQUARE.get=function(){return wn.CAP_SQUARE};Ud.MAX_PRECISION_DIGITS.get=function(){return 12};Object.defineProperties(si,Ud);var Mi=function(){this._pt=[new Me,new Me],this._distance=Gt.NaN,this._isNull=!0};Mi.prototype.getCoordinates=function(){return this._pt};Mi.prototype.getCoordinate=function(e){return this._pt[e]};Mi.prototype.setMinimum=function(){if(arguments.length===1){var e=arguments[0];this.setMinimum(e._pt[0],e._pt[1])}else if(arguments.length===2){var n=arguments[0],i=arguments[1];if(this._isNull)return this.initialize(n,i),null;var u=n.distance(i);u<this._distance&&this.initialize(n,i,u)}};Mi.prototype.initialize=function(){if(arguments.length===0)this._isNull=!0;else if(arguments.length===2){var e=arguments[0],n=arguments[1];this._pt[0].setCoordinate(e),this._pt[1].setCoordinate(n),this._distance=e.distance(n),this._isNull=!1}else if(arguments.length===3){var i=arguments[0],u=arguments[1],h=arguments[2];this._pt[0].setCoordinate(i),this._pt[1].setCoordinate(u),this._distance=h,this._isNull=!1}};Mi.prototype.getDistance=function(){return this._distance};Mi.prototype.setMaximum=function(){if(arguments.length===1){var e=arguments[0];this.setMaximum(e._pt[0],e._pt[1])}else if(arguments.length===2){var n=arguments[0],i=arguments[1];if(this._isNull)return this.initialize(n,i),null;var u=n.distance(i);u>this._distance&&this.initialize(n,i,u)}};Mi.prototype.interfaces_=function(){return[]};Mi.prototype.getClass=function(){return Mi};var Ba=function(){};Ba.prototype.interfaces_=function(){return[]};Ba.prototype.getClass=function(){return Ba};Ba.computeDistance=function(){if(arguments[2]instanceof Mi&&arguments[0]instanceof cr&&arguments[1]instanceof Me)for(var e=arguments[0],n=arguments[1],i=arguments[2],u=e.getCoordinates(),h=new Nt,d=0;d<u.length-1;d++){h.setCoordinates(u[d],u[d+1]);var s=h.closestPoint(n);i.setMinimum(s,n)}else if(arguments[2]instanceof Mi&&arguments[0]instanceof jr&&arguments[1]instanceof Me){var w=arguments[0],T=arguments[1],A=arguments[2];Ba.computeDistance(w.getExteriorRing(),T,A);for(var D=0;D<w.getNumInteriorRing();D++)Ba.computeDistance(w.getInteriorRingN(D),T,A)}else if(arguments[2]instanceof Mi&&arguments[0]instanceof Ft&&arguments[1]instanceof Me){var R=arguments[0],G=arguments[1],$=arguments[2];if(R instanceof cr)Ba.computeDistance(R,G,$);else if(R instanceof jr)Ba.computeDistance(R,G,$);else if(R instanceof Ri)for(var ie=R,_e=0;_e<ie.getNumGeometries();_e++){var Y=ie.getGeometryN(_e);Ba.computeDistance(Y,G,$)}else $.setMinimum(R.getCoordinate(),G)}else if(arguments[2]instanceof Mi&&arguments[0]instanceof Nt&&arguments[1]instanceof Me){var B=arguments[0],q=arguments[1],oe=arguments[2],de=B.closestPoint(q);oe.setMinimum(de,q)}};var Gc=function(e){this._maxPtDist=new Mi,this._inputGeom=e||null},jS={MaxPointDistanceFilter:{configurable:!0},MaxMidpointDistanceFilter:{configurable:!0}};Gc.prototype.computeMaxMidpointDistance=function(e){var n=new Lu(this._inputGeom);e.apply(n),this._maxPtDist.setMaximum(n.getMaxPointDistance())};Gc.prototype.computeMaxVertexDistance=function(e){var n=new gf(this._inputGeom);e.apply(n),this._maxPtDist.setMaximum(n.getMaxPointDistance())};Gc.prototype.findDistance=function(e){return this.computeMaxVertexDistance(e),this.computeMaxMidpointDistance(e),this._maxPtDist.getDistance()};Gc.prototype.getDistancePoints=function(){return this._maxPtDist};Gc.prototype.interfaces_=function(){return[]};Gc.prototype.getClass=function(){return Gc};jS.MaxPointDistanceFilter.get=function(){return gf};jS.MaxMidpointDistanceFilter.get=function(){return Lu};Object.defineProperties(Gc,jS);var gf=function(e){this._maxPtDist=new Mi,this._minPtDist=new Mi,this._geom=e||null};gf.prototype.filter=function(e){this._minPtDist.initialize(),Ba.computeDistance(this._geom,e,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)};gf.prototype.getMaxPointDistance=function(){return this._maxPtDist};gf.prototype.interfaces_=function(){return[Wa]};gf.prototype.getClass=function(){return gf};var Lu=function(e){this._maxPtDist=new Mi,this._minPtDist=new Mi,this._geom=e||null};Lu.prototype.filter=function(e,n){if(n===0)return null;var i=e.getCoordinate(n-1),u=e.getCoordinate(n),h=new Me((i.x+u.x)/2,(i.y+u.y)/2);this._minPtDist.initialize(),Ba.computeDistance(this._geom,h,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)};Lu.prototype.isDone=function(){return!1};Lu.prototype.isGeometryChanged=function(){return!1};Lu.prototype.getMaxPointDistance=function(){return this._maxPtDist};Lu.prototype.interfaces_=function(){return[ws]};Lu.prototype.getClass=function(){return Lu};var Rl=function(e){this._comps=e||null};Rl.prototype.filter=function(e){e instanceof jr&&this._comps.add(e)};Rl.prototype.interfaces_=function(){return[na]};Rl.prototype.getClass=function(){return Rl};Rl.getPolygons=function(){if(arguments.length===1){var e=arguments[0];return Rl.getPolygons(e,new gt)}else if(arguments.length===2){var n=arguments[0],i=arguments[1];return n instanceof jr?i.add(n):n instanceof Ri&&n.apply(new Rl(i)),i}};var ii=function(){if(this._lines=null,this._isForcedToLineString=!1,arguments.length===1){var e=arguments[0];this._lines=e}else if(arguments.length===2){var n=arguments[0],i=arguments[1];this._lines=n,this._isForcedToLineString=i}};ii.prototype.filter=function(e){if(this._isForcedToLineString&&e instanceof Ha){var n=e.getFactory().createLineString(e.getCoordinateSequence());return this._lines.add(n),null}e instanceof cr&&this._lines.add(e)};ii.prototype.setForceToLineString=function(e){this._isForcedToLineString=e};ii.prototype.interfaces_=function(){return[kl]};ii.prototype.getClass=function(){return ii};ii.getGeometry=function(){if(arguments.length===1){var e=arguments[0];return e.getFactory().buildGeometry(ii.getLines(e))}else if(arguments.length===2){var n=arguments[0],i=arguments[1];return n.getFactory().buildGeometry(ii.getLines(n,i))}};ii.getLines=function(){if(arguments.length===1){var e=arguments[0];return ii.getLines(e,!1)}else if(arguments.length===2){if(Ut(arguments[0],Or)&&Ut(arguments[1],Or)){for(var n=arguments[0],i=arguments[1],u=n.iterator();u.hasNext();){var h=u.next();ii.getLines(h,i)}return i}else if(arguments[0]instanceof Ft&&typeof arguments[1]=="boolean"){var d=arguments[0],s=arguments[1],w=new gt;return d.apply(new ii(w,s)),w}else if(arguments[0]instanceof Ft&&Ut(arguments[1],Or)){var T=arguments[0],A=arguments[1];return T instanceof cr?A.add(T):T.apply(new ii(A)),A}}else if(arguments.length===3){if(typeof arguments[2]=="boolean"&&Ut(arguments[0],Or)&&Ut(arguments[1],Or)){for(var D=arguments[0],R=arguments[1],G=arguments[2],$=D.iterator();$.hasNext();){var ie=$.next();ii.getLines(ie,R,G)}return R}else if(typeof arguments[2]=="boolean"&&arguments[0]instanceof Ft&&Ut(arguments[1],Or)){var _e=arguments[0],Y=arguments[1],B=arguments[2];return _e.apply(new ii(Y,B)),Y}}};var Ts=function(){if(this._boundaryRule=Jo.OGC_SFS_BOUNDARY_RULE,this._isIn=null,this._numBoundaries=null,arguments.length!==0){if(arguments.length===1){var e=arguments[0];if(e===null)throw new er("Rule must be non-null");this._boundaryRule=e}}};Ts.prototype.locateInternal=function(){var e=this;if(arguments[0]instanceof Me&&arguments[1]instanceof jr){var n=arguments[0],i=arguments[1];if(i.isEmpty())return Oe.EXTERIOR;var u=i.getExteriorRing(),h=this.locateInPolygonRing(n,u);if(h===Oe.EXTERIOR)return Oe.EXTERIOR;if(h===Oe.BOUNDARY)return Oe.BOUNDARY;for(var d=0;d<i.getNumInteriorRing();d++){var s=i.getInteriorRingN(d),w=e.locateInPolygonRing(n,s);if(w===Oe.INTERIOR)return Oe.EXTERIOR;if(w===Oe.BOUNDARY)return Oe.BOUNDARY}return Oe.INTERIOR}else if(arguments[0]instanceof Me&&arguments[1]instanceof cr){var T=arguments[0],A=arguments[1];if(!A.getEnvelopeInternal().intersects(T))return Oe.EXTERIOR;var D=A.getCoordinates();return!A.isClosed()&&(T.equals(D[0])||T.equals(D[D.length-1]))?Oe.BOUNDARY:wt.isOnLine(T,D)?Oe.INTERIOR:Oe.EXTERIOR}else if(arguments[0]instanceof Me&&arguments[1]instanceof lo){var R=arguments[0],G=arguments[1],$=G.getCoordinate();return $.equals2D(R)?Oe.INTERIOR:Oe.EXTERIOR}};Ts.prototype.locateInPolygonRing=function(e,n){return n.getEnvelopeInternal().intersects(e)?wt.locatePointInRing(e,n.getCoordinates()):Oe.EXTERIOR};Ts.prototype.intersects=function(e,n){return this.locate(e,n)!==Oe.EXTERIOR};Ts.prototype.updateLocationInfo=function(e){e===Oe.INTERIOR&&(this._isIn=!0),e===Oe.BOUNDARY&&this._numBoundaries++};Ts.prototype.computeLocation=function(e,n){var i=this;if(n instanceof lo&&this.updateLocationInfo(this.locateInternal(e,n)),n instanceof cr)this.updateLocationInfo(this.locateInternal(e,n));else if(n instanceof jr)this.updateLocationInfo(this.locateInternal(e,n));else if(n instanceof Fc)for(var u=n,h=0;h<u.getNumGeometries();h++){var d=u.getGeometryN(h);i.updateLocationInfo(i.locateInternal(e,d))}else if(n instanceof qa)for(var s=n,w=0;w<s.getNumGeometries();w++){var T=s.getGeometryN(w);i.updateLocationInfo(i.locateInternal(e,T))}else if(n instanceof Ri)for(var A=new Xa(n);A.hasNext();){var D=A.next();D!==n&&i.computeLocation(e,D)}};Ts.prototype.locate=function(e,n){return n.isEmpty()?Oe.EXTERIOR:n instanceof cr?this.locateInternal(e,n):n instanceof jr?this.locateInternal(e,n):(this._isIn=!1,this._numBoundaries=0,this.computeLocation(e,n),this._boundaryRule.isInBoundary(this._numBoundaries)?Oe.BOUNDARY:this._numBoundaries>0||this._isIn?Oe.INTERIOR:Oe.EXTERIOR)};Ts.prototype.interfaces_=function(){return[]};Ts.prototype.getClass=function(){return Ts};var Ai=function t(){if(this._component=null,this._segIndex=null,this._pt=null,arguments.length===2){var e=arguments[0],n=arguments[1];t.call(this,e,t.INSIDE_AREA,n)}else if(arguments.length===3){var i=arguments[0],u=arguments[1],h=arguments[2];this._component=i,this._segIndex=u,this._pt=h}},gD={INSIDE_AREA:{configurable:!0}};Ai.prototype.isInsideArea=function(){return this._segIndex===Ai.INSIDE_AREA};Ai.prototype.getCoordinate=function(){return this._pt};Ai.prototype.getGeometryComponent=function(){return this._component};Ai.prototype.getSegmentIndex=function(){return this._segIndex};Ai.prototype.interfaces_=function(){return[]};Ai.prototype.getClass=function(){return Ai};gD.INSIDE_AREA.get=function(){return-1};Object.defineProperties(Ai,gD);var yu=function(e){this._pts=e||null};yu.prototype.filter=function(e){e instanceof lo&&this._pts.add(e)};yu.prototype.interfaces_=function(){return[na]};yu.prototype.getClass=function(){return yu};yu.getPoints=function(){if(arguments.length===1){var e=arguments[0];return e instanceof lo?Es.singletonList(e):yu.getPoints(e,new gt)}else if(arguments.length===2){var n=arguments[0],i=arguments[1];return n instanceof lo?i.add(n):n instanceof Ri&&n.apply(new yu(i)),i}};var _f=function(){this._locations=null;var e=arguments[0];this._locations=e};_f.prototype.filter=function(e){(e instanceof lo||e instanceof cr||e instanceof jr)&&this._locations.add(new Ai(e,0,e.getCoordinate()))};_f.prototype.interfaces_=function(){return[na]};_f.prototype.getClass=function(){return _f};_f.getLocations=function(e){var n=new gt;return e.apply(new _f(n)),n};var ui=function(){if(this._geom=null,this._terminateDistance=0,this._ptLocator=new Ts,this._minDistanceLocation=null,this._minDistance=Gt.MAX_VALUE,arguments.length===2){var e=arguments[0],n=arguments[1];this._geom=[e,n],this._terminateDistance=0}else if(arguments.length===3){var i=arguments[0],u=arguments[1],h=arguments[2];this._geom=new Array(2).fill(null),this._geom[0]=i,this._geom[1]=u,this._terminateDistance=h}};ui.prototype.computeContainmentDistance=function(){var e=this;if(arguments.length===0){var n=new Array(2).fill(null);if(this.computeContainmentDistance(0,n),this._minDistance<=this._terminateDistance)return null;this.computeContainmentDistance(1,n)}else if(arguments.length===2){var i=arguments[0],u=arguments[1],h=1-i,d=Rl.getPolygons(this._geom[i]);if(d.size()>0){var s=_f.getLocations(this._geom[h]);if(this.computeContainmentDistance(s,d,u),this._minDistance<=this._terminateDistance)return this._minDistanceLocation[h]=u[0],this._minDistanceLocation[i]=u[1],null}}else if(arguments.length===3){if(arguments[2]instanceof Array&&Ut(arguments[0],gs)&&Ut(arguments[1],gs)){for(var w=arguments[0],T=arguments[1],A=arguments[2],D=0;D<w.size();D++)for(var R=w.get(D),G=0;G<T.size();G++)if(e.computeContainmentDistance(R,T.get(G),A),e._minDistance<=e._terminateDistance)return null}else if(arguments[2]instanceof Array&&arguments[0]instanceof Ai&&arguments[1]instanceof jr){var $=arguments[0],ie=arguments[1],_e=arguments[2],Y=$.getCoordinate();if(Oe.EXTERIOR!==this._ptLocator.locate(Y,ie))return this._minDistance=0,_e[0]=$,_e[1]=new Ai(ie,Y),null}}};ui.prototype.computeMinDistanceLinesPoints=function(e,n,i){for(var u=this,h=0;h<e.size();h++)for(var d=e.get(h),s=0;s<n.size();s++){var w=n.get(s);if(u.computeMinDistance(d,w,i),u._minDistance<=u._terminateDistance)return null}};ui.prototype.computeFacetDistance=function(){var e=new Array(2).fill(null),n=ii.getLines(this._geom[0]),i=ii.getLines(this._geom[1]),u=yu.getPoints(this._geom[0]),h=yu.getPoints(this._geom[1]);if(this.computeMinDistanceLines(n,i,e),this.updateMinDistance(e,!1),this._minDistance<=this._terminateDistance||(e[0]=null,e[1]=null,this.computeMinDistanceLinesPoints(n,h,e),this.updateMinDistance(e,!1),this._minDistance<=this._terminateDistance)||(e[0]=null,e[1]=null,this.computeMinDistanceLinesPoints(i,u,e),this.updateMinDistance(e,!0),this._minDistance<=this._terminateDistance))return null;e[0]=null,e[1]=null,this.computeMinDistancePoints(u,h,e),this.updateMinDistance(e,!1)};ui.prototype.nearestLocations=function(){return this.computeMinDistance(),this._minDistanceLocation};ui.prototype.updateMinDistance=function(e,n){if(e[0]===null)return null;n?(this._minDistanceLocation[0]=e[1],this._minDistanceLocation[1]=e[0]):(this._minDistanceLocation[0]=e[0],this._minDistanceLocation[1]=e[1])};ui.prototype.nearestPoints=function(){this.computeMinDistance();var e=[this._minDistanceLocation[0].getCoordinate(),this._minDistanceLocation[1].getCoordinate()];return e};ui.prototype.computeMinDistance=function(){var e=this;if(arguments.length===0){if(this._minDistanceLocation!==null||(this._minDistanceLocation=new Array(2).fill(null),this.computeContainmentDistance(),this._minDistance<=this._terminateDistance))return null;this.computeFacetDistance()}else if(arguments.length===3){if(arguments[2]instanceof Array&&arguments[0]instanceof cr&&arguments[1]instanceof lo){var n=arguments[0],i=arguments[1],u=arguments[2];if(n.getEnvelopeInternal().distance(i.getEnvelopeInternal())>this._minDistance)return null;for(var h=n.getCoordinates(),d=i.getCoordinate(),s=0;s<h.length-1;s++){var w=wt.distancePointLine(d,h[s],h[s+1]);if(w<e._minDistance){e._minDistance=w;var T=new Nt(h[s],h[s+1]),A=T.closestPoint(d);u[0]=new Ai(n,s,A),u[1]=new Ai(i,0,d)}if(e._minDistance<=e._terminateDistance)return null}}else if(arguments[2]instanceof Array&&arguments[0]instanceof cr&&arguments[1]instanceof cr){var D=arguments[0],R=arguments[1],G=arguments[2];if(D.getEnvelopeInternal().distance(R.getEnvelopeInternal())>this._minDistance)return null;for(var $=D.getCoordinates(),ie=R.getCoordinates(),_e=0;_e<$.length-1;_e++)for(var Y=0;Y<ie.length-1;Y++){var B=wt.distanceLineLine($[_e],$[_e+1],ie[Y],ie[Y+1]);if(B<e._minDistance){e._minDistance=B;var q=new Nt($[_e],$[_e+1]),oe=new Nt(ie[Y],ie[Y+1]),de=q.closestPoints(oe);G[0]=new Ai(D,_e,de[0]),G[1]=new Ai(R,Y,de[1])}if(e._minDistance<=e._terminateDistance)return null}}}};ui.prototype.computeMinDistancePoints=function(e,n,i){for(var u=this,h=0;h<e.size();h++)for(var d=e.get(h),s=0;s<n.size();s++){var w=n.get(s),T=d.getCoordinate().distance(w.getCoordinate());if(T<u._minDistance&&(u._minDistance=T,i[0]=new Ai(d,0,d.getCoordinate()),i[1]=new Ai(w,0,w.getCoordinate())),u._minDistance<=u._terminateDistance)return null}};ui.prototype.distance=function(){if(this._geom[0]===null||this._geom[1]===null)throw new er("null geometries are not supported");return this._geom[0].isEmpty()||this._geom[1].isEmpty()?0:(this.computeMinDistance(),this._minDistance)};ui.prototype.computeMinDistanceLines=function(e,n,i){for(var u=this,h=0;h<e.size();h++)for(var d=e.get(h),s=0;s<n.size();s++){var w=n.get(s);if(u.computeMinDistance(d,w,i),u._minDistance<=u._terminateDistance)return null}};ui.prototype.interfaces_=function(){return[]};ui.prototype.getClass=function(){return ui};ui.distance=function(e,n){var i=new ui(e,n);return i.distance()};ui.isWithinDistance=function(e,n,i){var u=new ui(e,n,i);return u.distance()<=i};ui.nearestPoints=function(e,n){var i=new ui(e,n);return i.nearestPoints()};var _i=function(){this._pt=[new Me,new Me],this._distance=Gt.NaN,this._isNull=!0};_i.prototype.getCoordinates=function(){return this._pt};_i.prototype.getCoordinate=function(e){return this._pt[e]};_i.prototype.setMinimum=function(){if(arguments.length===1){var e=arguments[0];this.setMinimum(e._pt[0],e._pt[1])}else if(arguments.length===2){var n=arguments[0],i=arguments[1];if(this._isNull)return this.initialize(n,i),null;var u=n.distance(i);u<this._distance&&this.initialize(n,i,u)}};_i.prototype.initialize=function(){if(arguments.length===0)this._isNull=!0;else if(arguments.length===2){var e=arguments[0],n=arguments[1];this._pt[0].setCoordinate(e),this._pt[1].setCoordinate(n),this._distance=e.distance(n),this._isNull=!1}else if(arguments.length===3){var i=arguments[0],u=arguments[1],h=arguments[2];this._pt[0].setCoordinate(i),this._pt[1].setCoordinate(u),this._distance=h,this._isNull=!1}};_i.prototype.toString=function(){return xs.toLineString(this._pt[0],this._pt[1])};_i.prototype.getDistance=function(){return this._distance};_i.prototype.setMaximum=function(){if(arguments.length===1){var e=arguments[0];this.setMaximum(e._pt[0],e._pt[1])}else if(arguments.length===2){var n=arguments[0],i=arguments[1];if(this._isNull)return this.initialize(n,i),null;var u=n.distance(i);u>this._distance&&this.initialize(n,i,u)}};_i.prototype.interfaces_=function(){return[]};_i.prototype.getClass=function(){return _i};var Zs=function(){};Zs.prototype.interfaces_=function(){return[]};Zs.prototype.getClass=function(){return Zs};Zs.computeDistance=function(){if(arguments[2]instanceof _i&&arguments[0]instanceof cr&&arguments[1]instanceof Me)for(var e=arguments[0],n=arguments[1],i=arguments[2],u=new Nt,h=e.getCoordinates(),d=0;d<h.length-1;d++){u.setCoordinates(h[d],h[d+1]);var s=u.closestPoint(n);i.setMinimum(s,n)}else if(arguments[2]instanceof _i&&arguments[0]instanceof jr&&arguments[1]instanceof Me){var w=arguments[0],T=arguments[1],A=arguments[2];Zs.computeDistance(w.getExteriorRing(),T,A);for(var D=0;D<w.getNumInteriorRing();D++)Zs.computeDistance(w.getInteriorRingN(D),T,A)}else if(arguments[2]instanceof _i&&arguments[0]instanceof Ft&&arguments[1]instanceof Me){var R=arguments[0],G=arguments[1],$=arguments[2];if(R instanceof cr)Zs.computeDistance(R,G,$);else if(R instanceof jr)Zs.computeDistance(R,G,$);else if(R instanceof Ri)for(var ie=R,_e=0;_e<ie.getNumGeometries();_e++){var Y=ie.getGeometryN(_e);Zs.computeDistance(Y,G,$)}else $.setMinimum(R.getCoordinate(),G)}else if(arguments[2]instanceof _i&&arguments[0]instanceof Nt&&arguments[1]instanceof Me){var B=arguments[0],q=arguments[1],oe=arguments[2],de=B.closestPoint(q);oe.setMinimum(de,q)}};var Ko=function(){this._g0=null,this._g1=null,this._ptDist=new _i,this._densifyFrac=0;var e=arguments[0],n=arguments[1];this._g0=e,this._g1=n},GS={MaxPointDistanceFilter:{configurable:!0},MaxDensifiedByFractionDistanceFilter:{configurable:!0}};Ko.prototype.getCoordinates=function(){return this._ptDist.getCoordinates()};Ko.prototype.setDensifyFraction=function(e){if(e>1||e<=0)throw new er("Fraction is not in range (0.0 - 1.0]");this._densifyFrac=e};Ko.prototype.compute=function(e,n){this.computeOrientedDistance(e,n,this._ptDist),this.computeOrientedDistance(n,e,this._ptDist)};Ko.prototype.distance=function(){return this.compute(this._g0,this._g1),this._ptDist.getDistance()};Ko.prototype.computeOrientedDistance=function(e,n,i){var u=new yf(n);if(e.apply(u),i.setMaximum(u.getMaxPointDistance()),this._densifyFrac>0){var h=new Du(n,this._densifyFrac);e.apply(h),i.setMaximum(h.getMaxPointDistance())}};Ko.prototype.orientedDistance=function(){return this.computeOrientedDistance(this._g0,this._g1,this._ptDist),this._ptDist.getDistance()};Ko.prototype.interfaces_=function(){return[]};Ko.prototype.getClass=function(){return Ko};Ko.distance=function(){if(arguments.length===2){var e=arguments[0],n=arguments[1],i=new Ko(e,n);return i.distance()}else if(arguments.length===3){var u=arguments[0],h=arguments[1],d=arguments[2],s=new Ko(u,h);return s.setDensifyFraction(d),s.distance()}};GS.MaxPointDistanceFilter.get=function(){return yf};GS.MaxDensifiedByFractionDistanceFilter.get=function(){return Du};Object.defineProperties(Ko,GS);var yf=function(){this._maxPtDist=new _i,this._minPtDist=new _i,this._euclideanDist=new Zs,this._geom=null;var e=arguments[0];this._geom=e};yf.prototype.filter=function(e){this._minPtDist.initialize(),Zs.computeDistance(this._geom,e,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)};yf.prototype.getMaxPointDistance=function(){return this._maxPtDist};yf.prototype.interfaces_=function(){return[Wa]};yf.prototype.getClass=function(){return yf};var Du=function(){this._maxPtDist=new _i,this._minPtDist=new _i,this._geom=null,this._numSubSegs=0;var e=arguments[0],n=arguments[1];this._geom=e,this._numSubSegs=Math.trunc(Math.round(1/n))};Du.prototype.filter=function(e,n){var i=this;if(n===0)return null;for(var u=e.getCoordinate(n-1),h=e.getCoordinate(n),d=(h.x-u.x)/this._numSubSegs,s=(h.y-u.y)/this._numSubSegs,w=0;w<this._numSubSegs;w++){var T=u.x+w*d,A=u.y+w*s,D=new Me(T,A);i._minPtDist.initialize(),Zs.computeDistance(i._geom,D,i._minPtDist),i._maxPtDist.setMaximum(i._minPtDist)}};Du.prototype.isDone=function(){return!1};Du.prototype.isGeometryChanged=function(){return!1};Du.prototype.getMaxPointDistance=function(){return this._maxPtDist};Du.prototype.interfaces_=function(){return[ws]};Du.prototype.getClass=function(){return Du};var so=function(e,n,i){this._minValidDistance=null,this._maxValidDistance=null,this._minDistanceFound=null,this._maxDistanceFound=null,this._isValid=!0,this._errMsg=null,this._errorLocation=null,this._errorIndicator=null,this._input=e||null,this._bufDistance=n||null,this._result=i||null},qS={VERBOSE:{configurable:!0},MAX_DISTANCE_DIFF_FRAC:{configurable:!0}};so.prototype.checkMaximumDistance=function(e,n,i){var u=new Ko(n,e);if(u.setDensifyFraction(.25),this._maxDistanceFound=u.orientedDistance(),this._maxDistanceFound>i){this._isValid=!1;var h=u.getCoordinates();this._errorLocation=h[1],this._errorIndicator=e.getFactory().createLineString(h),this._errMsg="Distance between buffer curve and input is too large ("+this._maxDistanceFound+" at "+xs.toLineString(h[0],h[1])+")"}};so.prototype.isValid=function(){var e=Math.abs(this._bufDistance),n=so.MAX_DISTANCE_DIFF_FRAC*e;return this._minValidDistance=e-n,this._maxValidDistance=e+n,this._input.isEmpty()||this._result.isEmpty()?!0:(this._bufDistance>0?this.checkPositiveValid():this.checkNegativeValid(),so.VERBOSE&&li.out.println("Min Dist= "+this._minDistanceFound+"  err= "+(1-this._minDistanceFound/this._bufDistance)+"  Max Dist= "+this._maxDistanceFound+"  err= "+(this._maxDistanceFound/this._bufDistance-1)),this._isValid)};so.prototype.checkNegativeValid=function(){if(!(this._input instanceof jr||this._input instanceof qa||this._input instanceof Ri))return null;var e=this.getPolygonLines(this._input);if(this.checkMinimumDistance(e,this._result,this._minValidDistance),!this._isValid)return null;this.checkMaximumDistance(e,this._result,this._maxValidDistance)};so.prototype.getErrorIndicator=function(){return this._errorIndicator};so.prototype.checkMinimumDistance=function(e,n,i){var u=new ui(e,n,i);if(this._minDistanceFound=u.distance(),this._minDistanceFound<i){this._isValid=!1;var h=u.nearestPoints();this._errorLocation=u.nearestPoints()[1],this._errorIndicator=e.getFactory().createLineString(h),this._errMsg="Distance between buffer curve and input is too small ("+this._minDistanceFound+" at "+xs.toLineString(h[0],h[1])+" )"}};so.prototype.checkPositiveValid=function(){var e=this._result.getBoundary();if(this.checkMinimumDistance(this._input,e,this._minValidDistance),!this._isValid)return null;this.checkMaximumDistance(this._input,e,this._maxValidDistance)};so.prototype.getErrorLocation=function(){return this._errorLocation};so.prototype.getPolygonLines=function(e){for(var n=new gt,i=new ii(n),u=Rl.getPolygons(e),h=u.iterator();h.hasNext();){var d=h.next();d.apply(i)}return e.getFactory().buildGeometry(n)};so.prototype.getErrorMessage=function(){return this._errMsg};so.prototype.interfaces_=function(){return[]};so.prototype.getClass=function(){return so};qS.VERBOSE.get=function(){return!1};qS.MAX_DISTANCE_DIFF_FRAC.get=function(){return .012};Object.defineProperties(so,qS);var ci=function(e,n,i){this._isValid=!0,this._errorMsg=null,this._errorLocation=null,this._errorIndicator=null,this._input=e||null,this._distance=n||null,this._result=i||null},XS={VERBOSE:{configurable:!0},MAX_ENV_DIFF_FRAC:{configurable:!0}};ci.prototype.isValid=function(){return this.checkPolygonal(),this._isValid?(this.checkExpectedEmpty(),this._isValid?(this.checkEnvelope(),this._isValid?(this.checkArea(),this._isValid?(this.checkDistance(),this._isValid):this._isValid):this._isValid):this._isValid):this._isValid};ci.prototype.checkEnvelope=function(){if(this._distance<0)return null;var e=this._distance*ci.MAX_ENV_DIFF_FRAC;e===0&&(e=.001);var n=new Dt(this._input.getEnvelopeInternal());n.expandBy(this._distance);var i=new Dt(this._result.getEnvelopeInternal());i.expandBy(e),i.contains(n)||(this._isValid=!1,this._errorMsg="Buffer envelope is incorrect",this._errorIndicator=this._input.getFactory().toGeometry(i)),this.report("Envelope")};ci.prototype.checkDistance=function(){var e=new so(this._input,this._distance,this._result);e.isValid()||(this._isValid=!1,this._errorMsg=e.getErrorMessage(),this._errorLocation=e.getErrorLocation(),this._errorIndicator=e.getErrorIndicator()),this.report("Distance")};ci.prototype.checkArea=function(){var e=this._input.getArea(),n=this._result.getArea();this._distance>0&&e>n&&(this._isValid=!1,this._errorMsg="Area of positive buffer is smaller than input",this._errorIndicator=this._result),this._distance<0&&e<n&&(this._isValid=!1,this._errorMsg="Area of negative buffer is larger than input",this._errorIndicator=this._result),this.report("Area")};ci.prototype.checkPolygonal=function(){this._result instanceof jr||this._result instanceof qa||(this._isValid=!1),this._errorMsg="Result is not polygonal",this._errorIndicator=this._result,this.report("Polygonal")};ci.prototype.getErrorIndicator=function(){return this._errorIndicator};ci.prototype.getErrorLocation=function(){return this._errorLocation};ci.prototype.checkExpectedEmpty=function(){if(this._input.getDimension()>=2||this._distance>0)return null;this._result.isEmpty()||(this._isValid=!1,this._errorMsg="Result is non-empty",this._errorIndicator=this._result),this.report("ExpectedEmpty")};ci.prototype.report=function(e){if(!ci.VERBOSE)return null;li.out.println("Check "+e+": "+(this._isValid?"passed":"FAILED"))};ci.prototype.getErrorMessage=function(){return this._errorMsg};ci.prototype.interfaces_=function(){return[]};ci.prototype.getClass=function(){return ci};ci.isValidMsg=function(e,n,i){var u=new ci(e,n,i);return u.isValid()?null:u.getErrorMessage()};ci.isValid=function(e,n,i){var u=new ci(e,n,i);return!!u.isValid()};XS.VERBOSE.get=function(){return!1};XS.MAX_ENV_DIFF_FRAC.get=function(){return .012};Object.defineProperties(ci,XS);var la=function(){this._pts=null,this._data=null;var e=arguments[0],n=arguments[1];this._pts=e,this._data=n};la.prototype.getCoordinates=function(){return this._pts};la.prototype.size=function(){return this._pts.length};la.prototype.getCoordinate=function(e){return this._pts[e]};la.prototype.isClosed=function(){return this._pts[0].equals(this._pts[this._pts.length-1])};la.prototype.getSegmentOctant=function(e){return e===this._pts.length-1?-1:pf.octant(this.getCoordinate(e),this.getCoordinate(e+1))};la.prototype.setData=function(e){this._data=e};la.prototype.getData=function(){return this._data};la.prototype.toString=function(){return xs.toLineString(new gr(this._pts))};la.prototype.interfaces_=function(){return[Ka]};la.prototype.getClass=function(){return la};var Hr=function(){this._findAllIntersections=!1,this._isCheckEndSegmentsOnly=!1,this._li=null,this._interiorIntersection=null,this._intSegments=null,this._intersections=new gt,this._intersectionCount=0,this._keepIntersections=!0;var e=arguments[0];this._li=e,this._interiorIntersection=null};Hr.prototype.getInteriorIntersection=function(){return this._interiorIntersection};Hr.prototype.setCheckEndSegmentsOnly=function(e){this._isCheckEndSegmentsOnly=e};Hr.prototype.getIntersectionSegments=function(){return this._intSegments};Hr.prototype.count=function(){return this._intersectionCount};Hr.prototype.getIntersections=function(){return this._intersections};Hr.prototype.setFindAllIntersections=function(e){this._findAllIntersections=e};Hr.prototype.setKeepIntersections=function(e){this._keepIntersections=e};Hr.prototype.processIntersections=function(e,n,i,u){if(!this._findAllIntersections&&this.hasIntersection()||e===i&&n===u)return null;if(this._isCheckEndSegmentsOnly){var h=this.isEndSegment(e,n)||this.isEndSegment(i,u);if(!h)return null}var d=e.getCoordinates()[n],s=e.getCoordinates()[n+1],w=i.getCoordinates()[u],T=i.getCoordinates()[u+1];this._li.computeIntersection(d,s,w,T),this._li.hasIntersection()&&this._li.isInteriorIntersection()&&(this._intSegments=new Array(4).fill(null),this._intSegments[0]=d,this._intSegments[1]=s,this._intSegments[2]=w,this._intSegments[3]=T,this._interiorIntersection=this._li.getIntersection(0),this._keepIntersections&&this._intersections.add(this._interiorIntersection),this._intersectionCount++)};Hr.prototype.isEndSegment=function(e,n){return n===0||n>=e.size()-2};Hr.prototype.hasIntersection=function(){return this._interiorIntersection!==null};Hr.prototype.isDone=function(){return this._findAllIntersections?!1:this._interiorIntersection!==null};Hr.prototype.interfaces_=function(){return[Vc]};Hr.prototype.getClass=function(){return Hr};Hr.createAllIntersectionsFinder=function(e){var n=new Hr(e);return n.setFindAllIntersections(!0),n};Hr.createAnyIntersectionFinder=function(e){return new Hr(e)};Hr.createIntersectionCounter=function(e){var n=new Hr(e);return n.setFindAllIntersections(!0),n.setKeepIntersections(!1),n};var Cs=function(){this._li=new Yc,this._segStrings=null,this._findAllIntersections=!1,this._segInt=null,this._isValid=!0;var e=arguments[0];this._segStrings=e};Cs.prototype.execute=function(){if(this._segInt!==null)return null;this.checkInteriorIntersections()};Cs.prototype.getIntersections=function(){return this._segInt.getIntersections()};Cs.prototype.isValid=function(){return this.execute(),this._isValid};Cs.prototype.setFindAllIntersections=function(e){this._findAllIntersections=e};Cs.prototype.checkInteriorIntersections=function(){this._isValid=!0,this._segInt=new Hr(this._li),this._segInt.setFindAllIntersections(this._findAllIntersections);var e=new VS;if(e.setSegmentIntersector(this._segInt),e.computeNodes(this._segStrings),this._segInt.hasIntersection())return this._isValid=!1,null};Cs.prototype.checkValid=function(){if(this.execute(),!this._isValid)throw new Ol(this.getErrorMessage(),this._segInt.getInteriorIntersection())};Cs.prototype.getErrorMessage=function(){if(this._isValid)return"no intersections found";var e=this._segInt.getIntersectionSegments();return"found non-noded intersection between "+xs.toLineString(e[0],e[1])+" and "+xs.toLineString(e[2],e[3])};Cs.prototype.interfaces_=function(){return[]};Cs.prototype.getClass=function(){return Cs};Cs.computeIntersections=function(e){var n=new Cs(e);return n.setFindAllIntersections(!0),n.isValid(),n.getIntersections()};var qc=function t(){this._nv=null;var e=arguments[0];this._nv=new Cs(t.toSegmentStrings(e))};qc.prototype.checkValid=function(){this._nv.checkValid()};qc.prototype.interfaces_=function(){return[]};qc.prototype.getClass=function(){return qc};qc.toSegmentStrings=function(e){for(var n=new gt,i=e.iterator();i.hasNext();){var u=i.next();n.add(new la(u.getCoordinates(),u))}return n};qc.checkValid=function(e){var n=new qc(e);n.checkValid()};var vf=function(e){this._mapOp=e};vf.prototype.map=function(e){for(var n=this,i=new gt,u=0;u<e.getNumGeometries();u++){var h=n._mapOp.map(e.getGeometryN(u));h.isEmpty()||i.add(h)}return e.getFactory().createGeometryCollection(ln.toGeometryArray(i))};vf.prototype.interfaces_=function(){return[]};vf.prototype.getClass=function(){return vf};vf.map=function(e,n){var i=new vf(n);return i.map(e)};var ua=function(){this._op=null,this._geometryFactory=null,this._ptLocator=null,this._lineEdgesList=new gt,this._resultLineList=new gt;var e=arguments[0],n=arguments[1],i=arguments[2];this._op=e,this._geometryFactory=n,this._ptLocator=i};ua.prototype.collectLines=function(e){for(var n=this,i=this._op.getGraph().getEdgeEnds().iterator();i.hasNext();){var u=i.next();n.collectLineEdge(u,e,n._lineEdgesList),n.collectBoundaryTouchEdge(u,e,n._lineEdgesList)}};ua.prototype.labelIsolatedLine=function(e,n){var i=this._ptLocator.locate(e.getCoordinate(),this._op.getArgGeometry(n));e.getLabel().setLocation(n,i)};ua.prototype.build=function(e){return this.findCoveredLineEdges(),this.collectLines(e),this.buildLines(e),this._resultLineList};ua.prototype.collectLineEdge=function(e,n,i){var u=e.getLabel(),h=e.getEdge();e.isLineEdge()&&!e.isVisited()&&Jt.isResultOfOp(u,n)&&!h.isCovered()&&(i.add(h),e.setVisitedEdge(!0))};ua.prototype.findCoveredLineEdges=function(){for(var e=this,n=this._op.getGraph().getNodes().iterator();n.hasNext();){var i=n.next();i.getEdges().findCoveredLineEdges()}for(var u=this._op.getGraph().getEdgeEnds().iterator();u.hasNext();){var h=u.next(),d=h.getEdge();if(h.isLineEdge()&&!d.isCoveredSet()){var s=e._op.isCoveredByA(h.getCoordinate());d.setCovered(s)}}};ua.prototype.labelIsolatedLines=function(e){for(var n=this,i=e.iterator();i.hasNext();){var u=i.next(),h=u.getLabel();u.isIsolated()&&(h.isNull(0)?n.labelIsolatedLine(u,0):n.labelIsolatedLine(u,1))}};ua.prototype.buildLines=function(e){for(var n=this,i=this._lineEdgesList.iterator();i.hasNext();){var u=i.next(),h=n._geometryFactory.createLineString(u.getCoordinates());n._resultLineList.add(h),u.setInResult(!0)}};ua.prototype.collectBoundaryTouchEdge=function(e,n,i){var u=e.getLabel();if(e.isLineEdge()||e.isVisited()||e.isInteriorAreaEdge()||e.getEdge().isInResult())return null;Qt.isTrue(!(e.isInResult()||e.getSym().isInResult())||!e.getEdge().isInResult()),Jt.isResultOfOp(u,n)&&n===Jt.INTERSECTION&&(i.add(e.getEdge()),e.setVisitedEdge(!0))};ua.prototype.interfaces_=function(){return[]};ua.prototype.getClass=function(){return ua};var xf=function(){this._op=null,this._geometryFactory=null,this._resultPointList=new gt;var e=arguments[0],n=arguments[1];this._op=e,this._geometryFactory=n};xf.prototype.filterCoveredNodeToPoint=function(e){var n=e.getCoordinate();if(!this._op.isCoveredByLA(n)){var i=this._geometryFactory.createPoint(n);this._resultPointList.add(i)}};xf.prototype.extractNonCoveredResultNodes=function(e){for(var n=this,i=this._op.getGraph().getNodes().iterator();i.hasNext();){var u=i.next();if(!u.isInResult()&&!u.isIncidentEdgeInResult()&&(u.getEdges().getDegree()===0||e===Jt.INTERSECTION)){var h=u.getLabel();Jt.isResultOfOp(h,e)&&n.filterCoveredNodeToPoint(u)}}};xf.prototype.build=function(e){return this.extractNonCoveredResultNodes(e),this._resultPointList};xf.prototype.interfaces_=function(){return[]};xf.prototype.getClass=function(){return xf};var Zi=function(){this._inputGeom=null,this._factory=null,this._pruneEmptyGeometry=!0,this._preserveGeometryCollectionType=!0,this._preserveCollections=!1,this._preserveType=!1};Zi.prototype.transformPoint=function(e,n){return this._factory.createPoint(this.transformCoordinates(e.getCoordinateSequence(),e))};Zi.prototype.transformPolygon=function(e,n){var i=this,u=!0,h=this.transformLinearRing(e.getExteriorRing(),e);(h===null||!(h instanceof Ha)||h.isEmpty())&&(u=!1);for(var d=new gt,s=0;s<e.getNumInteriorRing();s++){var w=i.transformLinearRing(e.getInteriorRingN(s),e);w===null||w.isEmpty()||(w instanceof Ha||(u=!1),d.add(w))}if(u)return this._factory.createPolygon(h,d.toArray([]));var T=new gt;return h!==null&&T.add(h),T.addAll(d),this._factory.buildGeometry(T)};Zi.prototype.createCoordinateSequence=function(e){return this._factory.getCoordinateSequenceFactory().create(e)};Zi.prototype.getInputGeometry=function(){return this._inputGeom};Zi.prototype.transformMultiLineString=function(e,n){for(var i=this,u=new gt,h=0;h<e.getNumGeometries();h++){var d=i.transformLineString(e.getGeometryN(h),e);d!==null&&(d.isEmpty()||u.add(d))}return this._factory.buildGeometry(u)};Zi.prototype.transformCoordinates=function(e,n){return this.copy(e)};Zi.prototype.transformLineString=function(e,n){return this._factory.createLineString(this.transformCoordinates(e.getCoordinateSequence(),e))};Zi.prototype.transformMultiPoint=function(e,n){for(var i=this,u=new gt,h=0;h<e.getNumGeometries();h++){var d=i.transformPoint(e.getGeometryN(h),e);d!==null&&(d.isEmpty()||u.add(d))}return this._factory.buildGeometry(u)};Zi.prototype.transformMultiPolygon=function(e,n){for(var i=this,u=new gt,h=0;h<e.getNumGeometries();h++){var d=i.transformPolygon(e.getGeometryN(h),e);d!==null&&(d.isEmpty()||u.add(d))}return this._factory.buildGeometry(u)};Zi.prototype.copy=function(e){return e.copy()};Zi.prototype.transformGeometryCollection=function(e,n){for(var i=this,u=new gt,h=0;h<e.getNumGeometries();h++){var d=i.transform(e.getGeometryN(h));d!==null&&(i._pruneEmptyGeometry&&d.isEmpty()||u.add(d))}return this._preserveGeometryCollectionType?this._factory.createGeometryCollection(ln.toGeometryArray(u)):this._factory.buildGeometry(u)};Zi.prototype.transform=function(e){if(this._inputGeom=e,this._factory=e.getFactory(),e instanceof lo)return this.transformPoint(e,null);if(e instanceof vd)return this.transformMultiPoint(e,null);if(e instanceof Ha)return this.transformLinearRing(e,null);if(e instanceof cr)return this.transformLineString(e,null);if(e instanceof Fc)return this.transformMultiLineString(e,null);if(e instanceof jr)return this.transformPolygon(e,null);if(e instanceof qa)return this.transformMultiPolygon(e,null);if(e instanceof Ri)return this.transformGeometryCollection(e,null);throw new er("Unknown Geometry subtype: "+e.getClass().getName())};Zi.prototype.transformLinearRing=function(e,n){var i=this.transformCoordinates(e.getCoordinateSequence(),e);if(i===null)return this._factory.createLinearRing(null);var u=i.size();return u>0&&u<4&&!this._preserveType?this._factory.createLineString(i):this._factory.createLinearRing(i)};Zi.prototype.interfaces_=function(){return[]};Zi.prototype.getClass=function(){return Zi};var el=function t(){if(this._snapTolerance=0,this._srcPts=null,this._seg=new Nt,this._allowSnappingToSourceVertices=!1,this._isClosed=!1,arguments[0]instanceof cr&&typeof arguments[1]=="number"){var e=arguments[0],n=arguments[1];t.call(this,e.getCoordinates(),n)}else if(arguments[0]instanceof Array&&typeof arguments[1]=="number"){var i=arguments[0],u=arguments[1];this._srcPts=i,this._isClosed=t.isClosed(i),this._snapTolerance=u}};el.prototype.snapVertices=function(e,n){for(var i=this,u=this._isClosed?e.size()-1:e.size(),h=0;h<u;h++){var d=e.get(h),s=i.findSnapForVertex(d,n);s!==null&&(e.set(h,new Me(s)),h===0&&i._isClosed&&e.set(e.size()-1,new Me(s)))}};el.prototype.findSnapForVertex=function(e,n){for(var i=this,u=0;u<n.length;u++){if(e.equals2D(n[u]))return null;if(e.distance(n[u])<i._snapTolerance)return n[u]}return null};el.prototype.snapTo=function(e){var n=new V_(this._srcPts);this.snapVertices(n,e),this.snapSegments(n,e);var i=n.toCoordinateArray();return i};el.prototype.snapSegments=function(e,n){var i=this;if(n.length===0)return null;var u=n.length;n[0].equals2D(n[n.length-1])&&(u=n.length-1);for(var h=0;h<u;h++){var d=n[h],s=i.findSegmentIndexToSnap(d,e);s>=0&&e.add(s+1,new Me(d),!1)}};el.prototype.findSegmentIndexToSnap=function(e,n){for(var i=this,u=Gt.MAX_VALUE,h=-1,d=0;d<n.size()-1;d++){if(i._seg.p0=n.get(d),i._seg.p1=n.get(d+1),i._seg.p0.equals2D(e)||i._seg.p1.equals2D(e)){if(i._allowSnappingToSourceVertices)continue;return-1}var s=i._seg.distance(e);s<i._snapTolerance&&s<u&&(u=s,h=d)}return h};el.prototype.setAllowSnappingToSourceVertices=function(e){this._allowSnappingToSourceVertices=e};el.prototype.interfaces_=function(){return[]};el.prototype.getClass=function(){return el};el.isClosed=function(e){return e.length<=1?!1:e[0].equals2D(e[e.length-1])};var _r=function(e){this._srcGeom=e||null},_D={SNAP_PRECISION_FACTOR:{configurable:!0}};_r.prototype.snapTo=function(e,n){var i=this.extractTargetCoordinates(e),u=new yD(n,i);return u.transform(this._srcGeom)};_r.prototype.snapToSelf=function(e,n){var i=this.extractTargetCoordinates(this._srcGeom),u=new yD(e,i,!0),h=u.transform(this._srcGeom),d=h;return n&&Ut(d,Cu)&&(d=h.buffer(0)),d};_r.prototype.computeSnapTolerance=function(e){var n=this.computeMinimumSegmentLength(e),i=n/10;return i};_r.prototype.extractTargetCoordinates=function(e){for(var n=new ta,i=e.getCoordinates(),u=0;u<i.length;u++)n.add(i[u]);return n.toArray(new Array(0).fill(null))};_r.prototype.computeMinimumSegmentLength=function(e){for(var n=Gt.MAX_VALUE,i=0;i<e.length-1;i++){var u=e[i].distance(e[i+1]);u<n&&(n=u)}return n};_r.prototype.interfaces_=function(){return[]};_r.prototype.getClass=function(){return _r};_r.snap=function(e,n,i){var u=new Array(2).fill(null),h=new _r(e);u[0]=h.snapTo(n,i);var d=new _r(n);return u[1]=d.snapTo(u[0],i),u};_r.computeOverlaySnapTolerance=function(){if(arguments.length===1){var e=arguments[0],n=_r.computeSizeBasedSnapTolerance(e),i=e.getPrecisionModel();if(i.getType()===bn.FIXED){var u=1/i.getScale()*2/1.415;u>n&&(n=u)}return n}else if(arguments.length===2){var h=arguments[0],d=arguments[1];return Math.min(_r.computeOverlaySnapTolerance(h),_r.computeOverlaySnapTolerance(d))}};_r.computeSizeBasedSnapTolerance=function(e){var n=e.getEnvelopeInternal(),i=Math.min(n.getHeight(),n.getWidth()),u=i*_r.SNAP_PRECISION_FACTOR;return u};_r.snapToSelf=function(e,n,i){var u=new _r(e);return u.snapToSelf(n,i)};_D.SNAP_PRECISION_FACTOR.get=function(){return 1e-9};Object.defineProperties(_r,_D);var yD=function(t){function e(n,i,u){t.call(this),this._snapTolerance=n||null,this._snapPts=i||null,this._isSelfSnap=u!==void 0?u:!1}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.snapLine=function(i,u){var h=new el(i,this._snapTolerance);return h.setAllowSnappingToSourceVertices(this._isSelfSnap),h.snapTo(u)},e.prototype.transformCoordinates=function(i,u){var h=i.toCoordinateArray(),d=this.snapLine(h,this._snapPts);return this._factory.getCoordinateSequenceFactory().create(d)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(Zi),Ii=function(){this._isFirst=!0,this._commonMantissaBitsCount=53,this._commonBits=0,this._commonSignExp=null};Ii.prototype.getCommon=function(){return Gt.longBitsToDouble(this._commonBits)};Ii.prototype.add=function(e){var n=Gt.doubleToLongBits(e);if(this._isFirst)return this._commonBits=n,this._commonSignExp=Ii.signExpBits(this._commonBits),this._isFirst=!1,null;var i=Ii.signExpBits(n);if(i!==this._commonSignExp)return this._commonBits=0,null;this._commonMantissaBitsCount=Ii.numCommonMostSigMantissaBits(this._commonBits,n),this._commonBits=Ii.zeroLowerBits(this._commonBits,64-(12+this._commonMantissaBitsCount))};Ii.prototype.toString=function(){if(arguments.length===1){var e=arguments[0],n=Gt.longBitsToDouble(e),i=Gt.toBinaryString(e),u="0000000000000000000000000000000000000000000000000000000000000000"+i,h=u.substring(u.length-64),d=h.substring(0,1)+"  "+h.substring(1,12)+"(exp) "+h.substring(12)+" [ "+n+" ]";return d}};Ii.prototype.interfaces_=function(){return[]};Ii.prototype.getClass=function(){return Ii};Ii.getBit=function(e,n){var i=1<<n;return e&i?1:0};Ii.signExpBits=function(e){return e>>52};Ii.zeroLowerBits=function(e,n){var i=(1<<n)-1,u=~i,h=e&u;return h};Ii.numCommonMostSigMantissaBits=function(e,n){for(var i=0,u=52;u>=0;u--){if(Ii.getBit(e,u)!==Ii.getBit(n,u))return i;i++}return 52};var Ru=function(){this._commonCoord=null,this._ccFilter=new wf},$S={CommonCoordinateFilter:{configurable:!0},Translater:{configurable:!0}};Ru.prototype.addCommonBits=function(e){var n=new Nu(this._commonCoord);e.apply(n),e.geometryChanged()};Ru.prototype.removeCommonBits=function(e){if(this._commonCoord.x===0&&this._commonCoord.y===0)return e;var n=new Me(this._commonCoord);n.x=-n.x,n.y=-n.y;var i=new Nu(n);return e.apply(i),e.geometryChanged(),e};Ru.prototype.getCommonCoordinate=function(){return this._commonCoord};Ru.prototype.add=function(e){e.apply(this._ccFilter),this._commonCoord=this._ccFilter.getCommonCoordinate()};Ru.prototype.interfaces_=function(){return[]};Ru.prototype.getClass=function(){return Ru};$S.CommonCoordinateFilter.get=function(){return wf};$S.Translater.get=function(){return Nu};Object.defineProperties(Ru,$S);var wf=function(){this._commonBitsX=new Ii,this._commonBitsY=new Ii};wf.prototype.filter=function(e){this._commonBitsX.add(e.x),this._commonBitsY.add(e.y)};wf.prototype.getCommonCoordinate=function(){return new Me(this._commonBitsX.getCommon(),this._commonBitsY.getCommon())};wf.prototype.interfaces_=function(){return[Wa]};wf.prototype.getClass=function(){return wf};var Nu=function(){this.trans=null;var e=arguments[0];this.trans=e};Nu.prototype.filter=function(e,n){var i=e.getOrdinate(n,0)+this.trans.x,u=e.getOrdinate(n,1)+this.trans.y;e.setOrdinate(n,0,i),e.setOrdinate(n,1,u)};Nu.prototype.isDone=function(){return!1};Nu.prototype.isGeometryChanged=function(){return!0};Nu.prototype.interfaces_=function(){return[ws]};Nu.prototype.getClass=function(){return Nu};var Yr=function(e,n){this._geom=new Array(2).fill(null),this._snapTolerance=null,this._cbr=null,this._geom[0]=e,this._geom[1]=n,this.computeSnapTolerance()};Yr.prototype.selfSnap=function(e){var n=new _r(e),i=n.snapTo(e,this._snapTolerance);return i};Yr.prototype.removeCommonBits=function(e){this._cbr=new Ru,this._cbr.add(e[0]),this._cbr.add(e[1]);var n=new Array(2).fill(null);return n[0]=this._cbr.removeCommonBits(e[0].copy()),n[1]=this._cbr.removeCommonBits(e[1].copy()),n};Yr.prototype.prepareResult=function(e){return this._cbr.addCommonBits(e),e};Yr.prototype.getResultGeometry=function(e){var n=this.snap(this._geom),i=Jt.overlayOp(n[0],n[1],e);return this.prepareResult(i)};Yr.prototype.checkValid=function(e){e.isValid()||li.out.println("Snapped geometry is invalid")};Yr.prototype.computeSnapTolerance=function(){this._snapTolerance=_r.computeOverlaySnapTolerance(this._geom[0],this._geom[1])};Yr.prototype.snap=function(e){var n=this.removeCommonBits(e),i=_r.snap(n[0],n[1],this._snapTolerance);return i};Yr.prototype.interfaces_=function(){return[]};Yr.prototype.getClass=function(){return Yr};Yr.overlayOp=function(e,n,i){var u=new Yr(e,n);return u.getResultGeometry(i)};Yr.union=function(e,n){return Yr.overlayOp(e,n,Jt.UNION)};Yr.intersection=function(e,n){return Yr.overlayOp(e,n,Jt.INTERSECTION)};Yr.symDifference=function(e,n){return Yr.overlayOp(e,n,Jt.SYMDIFFERENCE)};Yr.difference=function(e,n){return Yr.overlayOp(e,n,Jt.DIFFERENCE)};var Oi=function(e,n){this._geom=new Array(2).fill(null),this._geom[0]=e,this._geom[1]=n};Oi.prototype.getResultGeometry=function(e){var n=null,i=!1,u=null;try{n=Jt.overlayOp(this._geom[0],this._geom[1],e);var h=!0;h&&(i=!0)}catch(d){if(d instanceof Nl)u=d;else throw d}finally{}if(!i)try{n=Yr.overlayOp(this._geom[0],this._geom[1],e)}catch(d){throw d instanceof Nl?u:d}finally{}return n};Oi.prototype.interfaces_=function(){return[]};Oi.prototype.getClass=function(){return Oi};Oi.overlayOp=function(e,n,i){var u=new Oi(e,n);return u.getResultGeometry(i)};Oi.union=function(e,n){return Oi.overlayOp(e,n,Jt.UNION)};Oi.intersection=function(e,n){return Oi.overlayOp(e,n,Jt.INTERSECTION)};Oi.symDifference=function(e,n){return Oi.overlayOp(e,n,Jt.SYMDIFFERENCE)};Oi.difference=function(e,n){return Oi.overlayOp(e,n,Jt.DIFFERENCE)};var M_=function(){this.mce=null,this.chainIndex=null;var e=arguments[0],n=arguments[1];this.mce=e,this.chainIndex=n};M_.prototype.computeIntersections=function(e,n){this.mce.computeIntersectsForChain(this.chainIndex,e.mce,e.chainIndex,n)};M_.prototype.interfaces_=function(){return[]};M_.prototype.getClass=function(){return M_};var ho=function t(){if(this._label=null,this._xValue=null,this._eventType=null,this._insertEvent=null,this._deleteEventIndex=null,this._obj=null,arguments.length===2){var e=arguments[0],n=arguments[1];this._eventType=t.DELETE,this._xValue=e,this._insertEvent=n}else if(arguments.length===3){var i=arguments[0],u=arguments[1],h=arguments[2];this._eventType=t.INSERT,this._label=i,this._xValue=u,this._obj=h}},ZS={INSERT:{configurable:!0},DELETE:{configurable:!0}};ho.prototype.isDelete=function(){return this._eventType===ho.DELETE};ho.prototype.setDeleteEventIndex=function(e){this._deleteEventIndex=e};ho.prototype.getObject=function(){return this._obj};ho.prototype.compareTo=function(e){var n=e;return this._xValue<n._xValue?-1:this._xValue>n._xValue?1:this._eventType<n._eventType?-1:this._eventType>n._eventType?1:0};ho.prototype.getInsertEvent=function(){return this._insertEvent};ho.prototype.isInsert=function(){return this._eventType===ho.INSERT};ho.prototype.isSameLabel=function(e){return this._label===null?!1:this._label===e._label};ho.prototype.getDeleteEventIndex=function(){return this._deleteEventIndex};ho.prototype.interfaces_=function(){return[ts]};ho.prototype.getClass=function(){return ho};ZS.INSERT.get=function(){return 1};ZS.DELETE.get=function(){return 2};Object.defineProperties(ho,ZS);var J0=function(){};J0.prototype.interfaces_=function(){return[]};J0.prototype.getClass=function(){return J0};var hi=function(){this._hasIntersection=!1,this._hasProper=!1,this._hasProperInterior=!1,this._properIntersectionPoint=null,this._li=null,this._includeProper=null,this._recordIsolated=null,this._isSelfIntersection=null,this._numIntersections=0,this.numTests=0,this._bdyNodes=null,this._isDone=!1,this._isDoneWhenProperInt=!1;var e=arguments[0],n=arguments[1],i=arguments[2];this._li=e,this._includeProper=n,this._recordIsolated=i};hi.prototype.isTrivialIntersection=function(e,n,i,u){if(e===i&&this._li.getIntersectionNum()===1){if(hi.isAdjacentSegments(n,u))return!0;if(e.isClosed()){var h=e.getNumPoints()-1;if(n===0&&u===h||u===0&&n===h)return!0}}return!1};hi.prototype.getProperIntersectionPoint=function(){return this._properIntersectionPoint};hi.prototype.setIsDoneIfProperInt=function(e){this._isDoneWhenProperInt=e};hi.prototype.hasProperInteriorIntersection=function(){return this._hasProperInterior};hi.prototype.isBoundaryPointInternal=function(e,n){for(var i=n.iterator();i.hasNext();){var u=i.next(),h=u.getCoordinate();if(e.isIntersection(h))return!0}return!1};hi.prototype.hasProperIntersection=function(){return this._hasProper};hi.prototype.hasIntersection=function(){return this._hasIntersection};hi.prototype.isDone=function(){return this._isDone};hi.prototype.isBoundaryPoint=function(e,n){return n===null?!1:!!(this.isBoundaryPointInternal(e,n[0])||this.isBoundaryPointInternal(e,n[1]))};hi.prototype.setBoundaryNodes=function(e,n){this._bdyNodes=new Array(2).fill(null),this._bdyNodes[0]=e,this._bdyNodes[1]=n};hi.prototype.addIntersections=function(e,n,i,u){if(e===i&&n===u)return null;this.numTests++;var h=e.getCoordinates()[n],d=e.getCoordinates()[n+1],s=i.getCoordinates()[u],w=i.getCoordinates()[u+1];this._li.computeIntersection(h,d,s,w),this._li.hasIntersection()&&(this._recordIsolated&&(e.setIsolated(!1),i.setIsolated(!1)),this._numIntersections++,this.isTrivialIntersection(e,n,i,u)||(this._hasIntersection=!0,(this._includeProper||!this._li.isProper())&&(e.addIntersections(this._li,n,0),i.addIntersections(this._li,u,1)),this._li.isProper()&&(this._properIntersectionPoint=this._li.getIntersection(0).copy(),this._hasProper=!0,this._isDoneWhenProperInt&&(this._isDone=!0),this.isBoundaryPoint(this._li,this._bdyNodes)||(this._hasProperInterior=!0))))};hi.prototype.interfaces_=function(){return[]};hi.prototype.getClass=function(){return hi};hi.isAdjacentSegments=function(e,n){return Math.abs(e-n)===1};var DU=function(t){function e(){t.call(this),this.events=new gt,this.nOverlaps=null}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.prepareEvents=function(){var i=this;Es.sort(this.events);for(var u=0;u<this.events.size();u++){var h=i.events.get(u);h.isDelete()&&h.getInsertEvent().setDeleteEventIndex(u)}},e.prototype.computeIntersections=function(){var i=this;if(arguments.length===1){var u=arguments[0];this.nOverlaps=0,this.prepareEvents();for(var h=0;h<this.events.size();h++){var d=i.events.get(h);if(d.isInsert()&&i.processOverlaps(h,d.getDeleteEventIndex(),d,u),u.isDone())break}}else if(arguments.length===3){if(arguments[2]instanceof hi&&Ut(arguments[0],gs)&&Ut(arguments[1],gs)){var s=arguments[0],w=arguments[1],T=arguments[2];this.addEdges(s,s),this.addEdges(w,w),this.computeIntersections(T)}else if(typeof arguments[2]=="boolean"&&Ut(arguments[0],gs)&&arguments[1]instanceof hi){var A=arguments[0],D=arguments[1],R=arguments[2];R?this.addEdges(A,null):this.addEdges(A),this.computeIntersections(D)}}},e.prototype.addEdge=function(i,u){for(var h=this,d=i.getMonotoneChainEdge(),s=d.getStartIndexes(),w=0;w<s.length-1;w++){var T=new M_(d,w),A=new ho(u,d.getMinX(w),T);h.events.add(A),h.events.add(new ho(d.getMaxX(w),A))}},e.prototype.processOverlaps=function(i,u,h,d){for(var s=this,w=h.getObject(),T=i;T<u;T++){var A=s.events.get(T);if(A.isInsert()){var D=A.getObject();h.isSameLabel(A)||(w.computeIntersections(D,d),s.nOverlaps++)}}},e.prototype.addEdges=function(){var i=this;if(arguments.length===1)for(var u=arguments[0],h=u.iterator();h.hasNext();){var d=h.next();i.addEdge(d,d)}else if(arguments.length===2)for(var s=arguments[0],w=arguments[1],T=s.iterator();T.hasNext();){var A=T.next();i.addEdge(A,w)}},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(J0),tl=function(){this._min=Gt.POSITIVE_INFINITY,this._max=Gt.NEGATIVE_INFINITY},vD={NodeComparator:{configurable:!0}};tl.prototype.getMin=function(){return this._min};tl.prototype.intersects=function(e,n){return!(this._min>n||this._max<e)};tl.prototype.getMax=function(){return this._max};tl.prototype.toString=function(){return xs.toLineString(new Me(this._min,0),new Me(this._max,0))};tl.prototype.interfaces_=function(){return[]};tl.prototype.getClass=function(){return tl};vD.NodeComparator.get=function(){return A_};Object.defineProperties(tl,vD);var A_=function(){};A_.prototype.compare=function(e,n){var i=e,u=n,h=(i._min+i._max)/2,d=(u._min+u._max)/2;return h<d?-1:h>d?1:0};A_.prototype.interfaces_=function(){return[fd]};A_.prototype.getClass=function(){return A_};var RU=function(t){function e(){t.call(this),this._item=null;var n=arguments[0],i=arguments[1],u=arguments[2];this._min=n,this._max=i,this._item=u}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.query=function(i,u,h){if(!this.intersects(i,u))return null;h.visitItem(this._item)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(tl),NU=function(t){function e(){t.call(this),this._node1=null,this._node2=null;var n=arguments[0],i=arguments[1];this._node1=n,this._node2=i,this.buildExtent(this._node1,this._node2)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.buildExtent=function(i,u){this._min=Math.min(i._min,u._min),this._max=Math.max(i._max,u._max)},e.prototype.query=function(i,u,h){if(!this.intersects(i,u))return null;this._node1!==null&&this._node1.query(i,u,h),this._node2!==null&&this._node2.query(i,u,h)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(tl),nl=function(){this._leaves=new gt,this._root=null,this._level=0};nl.prototype.buildTree=function(){var e=this;Es.sort(this._leaves,new tl.NodeComparator);for(var n=this._leaves,i=null,u=new gt;;){if(e.buildLevel(n,u),u.size()===1)return u.get(0);i=n,n=u,u=i}};nl.prototype.insert=function(e,n,i){if(this._root!==null)throw new Error("Index cannot be added to once it has been queried");this._leaves.add(new RU(e,n,i))};nl.prototype.query=function(e,n,i){this.init(),this._root.query(e,n,i)};nl.prototype.buildRoot=function(){if(this._root!==null)return null;this._root=this.buildTree()};nl.prototype.printNode=function(e){li.out.println(xs.toLineString(new Me(e._min,this._level),new Me(e._max,this._level)))};nl.prototype.init=function(){if(this._root!==null)return null;this.buildRoot()};nl.prototype.buildLevel=function(e,n){this._level++,n.clear();for(var i=0;i<e.size();i+=2){var u=e.get(i),h=i+1<e.size()?e.get(i):null;if(h===null)n.add(u);else{var d=new NU(e.get(i),e.get(i+1));n.add(d)}}};nl.prototype.interfaces_=function(){return[]};nl.prototype.getClass=function(){return nl};var Td=function(){this._items=new gt};Td.prototype.visitItem=function(e){this._items.add(e)};Td.prototype.getItems=function(){return this._items};Td.prototype.interfaces_=function(){return[Iu]};Td.prototype.getClass=function(){return Td};var Cd=function(){this._index=null;var e=arguments[0];if(!Ut(e,Cu))throw new er("Argument must be Polygonal");this._index=new Xc(e)},WS={SegmentVisitor:{configurable:!0},IntervalIndexedGeometry:{configurable:!0}};Cd.prototype.locate=function(e){var n=new Ys(e),i=new Id(n);return this._index.query(e.y,e.y,i),n.getLocation()};Cd.prototype.interfaces_=function(){return[Ed]};Cd.prototype.getClass=function(){return Cd};WS.SegmentVisitor.get=function(){return Id};WS.IntervalIndexedGeometry.get=function(){return Xc};Object.defineProperties(Cd,WS);var Id=function(){this._counter=null;var e=arguments[0];this._counter=e};Id.prototype.visitItem=function(e){var n=e;this._counter.countSegment(n.getCoordinate(0),n.getCoordinate(1))};Id.prototype.interfaces_=function(){return[Iu]};Id.prototype.getClass=function(){return Id};var Xc=function(){this._index=new nl;var e=arguments[0];this.init(e)};Xc.prototype.init=function(e){for(var n=this,i=ii.getLines(e),u=i.iterator();u.hasNext();){var h=u.next(),d=h.getCoordinates();n.addLine(d)}};Xc.prototype.addLine=function(e){for(var n=this,i=1;i<e.length;i++){var u=new Nt(e[i-1],e[i]),h=Math.min(u.p0.y,u.p1.y),d=Math.max(u.p0.y,u.p1.y);n._index.insert(h,d,u)}};Xc.prototype.query=function(){if(arguments.length===2){var e=arguments[0],n=arguments[1],i=new Td;return this._index.query(e,n,i),i.getItems()}else if(arguments.length===3){var u=arguments[0],h=arguments[1],d=arguments[2];this._index.query(u,h,d)}};Xc.prototype.interfaces_=function(){return[]};Xc.prototype.getClass=function(){return Xc};var Ag=function(t){function e(){if(t.call(this),this._parentGeom=null,this._lineEdgeMap=new nD,this._boundaryNodeRule=null,this._useBoundaryDeterminationRule=!0,this._argIndex=null,this._boundaryNodes=null,this._hasTooFewPoints=!1,this._invalidPoint=null,this._areaPtLocator=null,this._ptLocator=new Ts,arguments.length===2){var n=arguments[0],i=arguments[1],u=Jo.OGC_SFS_BOUNDARY_RULE;this._argIndex=n,this._parentGeom=i,this._boundaryNodeRule=u,i!==null&&this.add(i)}else if(arguments.length===3){var h=arguments[0],d=arguments[1],s=arguments[2];this._argIndex=h,this._parentGeom=d,this._boundaryNodeRule=s,d!==null&&this.add(d)}}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.insertBoundaryPoint=function(i,u){var h=this._nodes.addNode(u),d=h.getLabel(),s=1,w=Oe.NONE;w=d.getLocation(i,ht.ON),w===Oe.BOUNDARY&&s++;var T=e.determineBoundary(this._boundaryNodeRule,s);d.setLocation(i,T)},e.prototype.computeSelfNodes=function(){if(arguments.length===2){var i=arguments[0],u=arguments[1];return this.computeSelfNodes(i,u,!1)}else if(arguments.length===3){var h=arguments[0],d=arguments[1],s=arguments[2],w=new hi(h,!0,!1);w.setIsDoneIfProperInt(s);var T=this.createEdgeSetIntersector(),A=this._parentGeom instanceof Ha||this._parentGeom instanceof jr||this._parentGeom instanceof qa,D=d||!A;return T.computeIntersections(this._edges,w,D),this.addSelfIntersectionNodes(this._argIndex),w}},e.prototype.computeSplitEdges=function(i){for(var u=this._edges.iterator();u.hasNext();){var h=u.next();h.eiList.addSplitEdges(i)}},e.prototype.computeEdgeIntersections=function(i,u,h){var d=new hi(u,h,!0);d.setBoundaryNodes(this.getBoundaryNodes(),i.getBoundaryNodes());var s=this.createEdgeSetIntersector();return s.computeIntersections(this._edges,i._edges,d),d},e.prototype.getGeometry=function(){return this._parentGeom},e.prototype.getBoundaryNodeRule=function(){return this._boundaryNodeRule},e.prototype.hasTooFewPoints=function(){return this._hasTooFewPoints},e.prototype.addPoint=function(){if(arguments[0]instanceof lo){var i=arguments[0],u=i.getCoordinate();this.insertPoint(this._argIndex,u,Oe.INTERIOR)}else if(arguments[0]instanceof Me){var h=arguments[0];this.insertPoint(this._argIndex,h,Oe.INTERIOR)}},e.prototype.addPolygon=function(i){var u=this;this.addPolygonRing(i.getExteriorRing(),Oe.EXTERIOR,Oe.INTERIOR);for(var h=0;h<i.getNumInteriorRing();h++){var d=i.getInteriorRingN(h);u.addPolygonRing(d,Oe.INTERIOR,Oe.EXTERIOR)}},e.prototype.addEdge=function(i){this.insertEdge(i);var u=i.getCoordinates();this.insertPoint(this._argIndex,u[0],Oe.BOUNDARY),this.insertPoint(this._argIndex,u[u.length-1],Oe.BOUNDARY)},e.prototype.addLineString=function(i){var u=un.removeRepeatedPoints(i.getCoordinates());if(u.length<2)return this._hasTooFewPoints=!0,this._invalidPoint=u[0],null;var h=new K0(u,new An(this._argIndex,Oe.INTERIOR));this._lineEdgeMap.put(i,h),this.insertEdge(h),Qt.isTrue(u.length>=2,"found LineString with single point"),this.insertBoundaryPoint(this._argIndex,u[0]),this.insertBoundaryPoint(this._argIndex,u[u.length-1])},e.prototype.getInvalidPoint=function(){return this._invalidPoint},e.prototype.getBoundaryPoints=function(){for(var i=this.getBoundaryNodes(),u=new Array(i.size()).fill(null),h=0,d=i.iterator();d.hasNext();){var s=d.next();u[h++]=s.getCoordinate().copy()}return u},e.prototype.getBoundaryNodes=function(){return this._boundaryNodes===null&&(this._boundaryNodes=this._nodes.getBoundaryNodes(this._argIndex)),this._boundaryNodes},e.prototype.addSelfIntersectionNode=function(i,u,h){if(this.isBoundaryNode(i,u))return null;h===Oe.BOUNDARY&&this._useBoundaryDeterminationRule?this.insertBoundaryPoint(i,u):this.insertPoint(i,u,h)},e.prototype.addPolygonRing=function(i,u,h){if(i.isEmpty())return null;var d=un.removeRepeatedPoints(i.getCoordinates());if(d.length<4)return this._hasTooFewPoints=!0,this._invalidPoint=d[0],null;var s=u,w=h;wt.isCCW(d)&&(s=h,w=u);var T=new K0(d,new An(this._argIndex,Oe.BOUNDARY,s,w));this._lineEdgeMap.put(i,T),this.insertEdge(T),this.insertPoint(this._argIndex,d[0],Oe.BOUNDARY)},e.prototype.insertPoint=function(i,u,h){var d=this._nodes.addNode(u),s=d.getLabel();s===null?d._label=new An(i,h):s.setLocation(i,h)},e.prototype.createEdgeSetIntersector=function(){return new DU},e.prototype.addSelfIntersectionNodes=function(i){for(var u=this,h=this._edges.iterator();h.hasNext();)for(var d=h.next(),s=d.getLabel().getLocation(i),w=d.eiList.iterator();w.hasNext();){var T=w.next();u.addSelfIntersectionNode(i,T.coord,s)}},e.prototype.add=function(){if(arguments.length===1){var i=arguments[0];if(i.isEmpty())return null;if(i instanceof qa&&(this._useBoundaryDeterminationRule=!1),i instanceof jr)this.addPolygon(i);else if(i instanceof cr)this.addLineString(i);else if(i instanceof lo)this.addPoint(i);else if(i instanceof vd)this.addCollection(i);else if(i instanceof Fc)this.addCollection(i);else if(i instanceof qa)this.addCollection(i);else if(i instanceof Ri)this.addCollection(i);else throw new Error(i.getClass().getName())}else return t.prototype.add.apply(this,arguments)},e.prototype.addCollection=function(i){for(var u=this,h=0;h<i.getNumGeometries();h++){var d=i.getGeometryN(h);u.add(d)}},e.prototype.locate=function(i){return Ut(this._parentGeom,Cu)&&this._parentGeom.getNumGeometries()>50?(this._areaPtLocator===null&&(this._areaPtLocator=new Cd(this._parentGeom)),this._areaPtLocator.locate(i)):this._ptLocator.locate(i,this._parentGeom)},e.prototype.findEdge=function(){if(arguments.length===1){var i=arguments[0];return this._lineEdgeMap.get(i)}else return t.prototype.findEdge.apply(this,arguments)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e.determineBoundary=function(i,u){return i.isInBoundary(u)?Oe.BOUNDARY:Oe.INTERIOR},e}(sr),Md=function(){if(this._li=new Yc,this._resultPrecisionModel=null,this._arg=null,arguments.length===1){var e=arguments[0];this.setComputationPrecision(e.getPrecisionModel()),this._arg=new Array(1).fill(null),this._arg[0]=new Ag(0,e)}else if(arguments.length===2){var n=arguments[0],i=arguments[1],u=Jo.OGC_SFS_BOUNDARY_RULE;n.getPrecisionModel().compareTo(i.getPrecisionModel())>=0?this.setComputationPrecision(n.getPrecisionModel()):this.setComputationPrecision(i.getPrecisionModel()),this._arg=new Array(2).fill(null),this._arg[0]=new Ag(0,n,u),this._arg[1]=new Ag(1,i,u)}else if(arguments.length===3){var h=arguments[0],d=arguments[1],s=arguments[2];h.getPrecisionModel().compareTo(d.getPrecisionModel())>=0?this.setComputationPrecision(h.getPrecisionModel()):this.setComputationPrecision(d.getPrecisionModel()),this._arg=new Array(2).fill(null),this._arg[0]=new Ag(0,h,s),this._arg[1]=new Ag(1,d,s)}};Md.prototype.getArgGeometry=function(e){return this._arg[e].getGeometry()};Md.prototype.setComputationPrecision=function(e){this._resultPrecisionModel=e,this._li.setPrecisionModel(this._resultPrecisionModel)};Md.prototype.interfaces_=function(){return[]};Md.prototype.getClass=function(){return Md};var kc=function(){};kc.prototype.interfaces_=function(){return[]};kc.prototype.getClass=function(){return kc};kc.map=function(){if(arguments[0]instanceof Ft&&Ut(arguments[1],kc.MapOp)){for(var e=arguments[0],n=arguments[1],i=new gt,u=0;u<e.getNumGeometries();u++){var h=n.map(e.getGeometryN(u));h!==null&&i.add(h)}return e.getFactory().buildGeometry(i)}else if(Ut(arguments[0],Or)&&Ut(arguments[1],kc.MapOp)){for(var d=arguments[0],s=arguments[1],w=new gt,T=d.iterator();T.hasNext();){var A=T.next(),D=s.map(A);D!==null&&w.add(D)}return w}};kc.MapOp=function(){};var Jt=function(t){function e(){var n=arguments[0],i=arguments[1];t.call(this,n,i),this._ptLocator=new Ts,this._geomFact=null,this._resultGeom=null,this._graph=null,this._edgeList=new Ss,this._resultPolyList=new gt,this._resultLineList=new gt,this._resultPointList=new gt,this._graph=new sr(new cD),this._geomFact=n.getFactory()}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.insertUniqueEdge=function(i){var u=this._edgeList.findEqualEdge(i);if(u!==null){var h=u.getLabel(),d=i.getLabel();u.isPointwiseEqual(i)||(d=new An(i.getLabel()),d.flip());var s=u.getDepth();s.isNull()&&s.add(h),s.add(d),h.merge(d)}else this._edgeList.add(i)},e.prototype.getGraph=function(){return this._graph},e.prototype.cancelDuplicateResultEdges=function(){for(var i=this._graph.getEdgeEnds().iterator();i.hasNext();){var u=i.next(),h=u.getSym();u.isInResult()&&h.isInResult()&&(u.setInResult(!1),h.setInResult(!1))}},e.prototype.isCoveredByLA=function(i){return!!(this.isCovered(i,this._resultLineList)||this.isCovered(i,this._resultPolyList))},e.prototype.computeGeometry=function(i,u,h,d){var s=new gt;return s.addAll(i),s.addAll(u),s.addAll(h),s.isEmpty()?e.createEmptyResult(d,this._arg[0].getGeometry(),this._arg[1].getGeometry(),this._geomFact):this._geomFact.buildGeometry(s)},e.prototype.mergeSymLabels=function(){for(var i=this._graph.getNodes().iterator();i.hasNext();){var u=i.next();u.getEdges().mergeSymLabels()}},e.prototype.isCovered=function(i,u){for(var h=this,d=u.iterator();d.hasNext();){var s=d.next(),w=h._ptLocator.locate(i,s);if(w!==Oe.EXTERIOR)return!0}return!1},e.prototype.replaceCollapsedEdges=function(){for(var i=new gt,u=this._edgeList.iterator();u.hasNext();){var h=u.next();h.isCollapsed()&&(u.remove(),i.add(h.getCollapsedEdge()))}this._edgeList.addAll(i)},e.prototype.updateNodeLabelling=function(){for(var i=this._graph.getNodes().iterator();i.hasNext();){var u=i.next(),h=u.getEdges().getLabel();u.getLabel().merge(h)}},e.prototype.getResultGeometry=function(i){return this.computeOverlay(i),this._resultGeom},e.prototype.insertUniqueEdges=function(i){for(var u=this,h=i.iterator();h.hasNext();){var d=h.next();u.insertUniqueEdge(d)}},e.prototype.computeOverlay=function(i){this.copyPoints(0),this.copyPoints(1),this._arg[0].computeSelfNodes(this._li,!1),this._arg[1].computeSelfNodes(this._li,!1),this._arg[0].computeEdgeIntersections(this._arg[1],this._li,!0);var u=new gt;this._arg[0].computeSplitEdges(u),this._arg[1].computeSplitEdges(u),this.insertUniqueEdges(u),this.computeLabelsFromDepths(),this.replaceCollapsedEdges(),qc.checkValid(this._edgeList.getEdges()),this._graph.addEdges(this._edgeList.getEdges()),this.computeLabelling(),this.labelIncompleteNodes(),this.findResultAreaEdges(i),this.cancelDuplicateResultEdges();var h=new uo(this._geomFact);h.add(this._graph),this._resultPolyList=h.getPolygons();var d=new ua(this,this._geomFact,this._ptLocator);this._resultLineList=d.build(i);var s=new xf(this,this._geomFact,this._ptLocator);this._resultPointList=s.build(i),this._resultGeom=this.computeGeometry(this._resultPointList,this._resultLineList,this._resultPolyList,i)},e.prototype.labelIncompleteNode=function(i,u){var h=this._ptLocator.locate(i.getCoordinate(),this._arg[u].getGeometry());i.getLabel().setLocation(u,h)},e.prototype.copyPoints=function(i){for(var u=this,h=this._arg[i].getNodeIterator();h.hasNext();){var d=h.next(),s=u._graph.addNode(d.getCoordinate());s.setLabel(i,d.getLabel().getLocation(i))}},e.prototype.findResultAreaEdges=function(i){for(var u=this._graph.getEdgeEnds().iterator();u.hasNext();){var h=u.next(),d=h.getLabel();d.isArea()&&!h.isInteriorAreaEdge()&&e.isResultOfOp(d.getLocation(0,ht.RIGHT),d.getLocation(1,ht.RIGHT),i)&&h.setInResult(!0)}},e.prototype.computeLabelsFromDepths=function(){for(var i=this._edgeList.iterator();i.hasNext();){var u=i.next(),h=u.getLabel(),d=u.getDepth();if(!d.isNull()){d.normalize();for(var s=0;s<2;s++)!h.isNull(s)&&h.isArea()&&!d.isNull(s)&&(d.getDelta(s)===0?h.toLine(s):(Qt.isTrue(!d.isNull(s,ht.LEFT),"depth of LEFT side has not been initialized"),h.setLocation(s,ht.LEFT,d.getLocation(s,ht.LEFT)),Qt.isTrue(!d.isNull(s,ht.RIGHT),"depth of RIGHT side has not been initialized"),h.setLocation(s,ht.RIGHT,d.getLocation(s,ht.RIGHT))))}}},e.prototype.computeLabelling=function(){for(var i=this,u=this._graph.getNodes().iterator();u.hasNext();){var h=u.next();h.getEdges().computeLabelling(i._arg)}this.mergeSymLabels(),this.updateNodeLabelling()},e.prototype.labelIncompleteNodes=function(){for(var i=this,u=this._graph.getNodes().iterator();u.hasNext();){var h=u.next(),d=h.getLabel();h.isIsolated()&&(d.isNull(0)?i.labelIncompleteNode(h,0):i.labelIncompleteNode(h,1)),h.getEdges().updateLabelling(d)}},e.prototype.isCoveredByA=function(i){return!!this.isCovered(i,this._resultPolyList)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(Md);Jt.overlayOp=function(t,e,n){var i=new Jt(t,e),u=i.getResultGeometry(n);return u};Jt.intersection=function(t,e){if(t.isEmpty()||e.isEmpty())return Jt.createEmptyResult(Jt.INTERSECTION,t,e,t.getFactory());if(t.isGeometryCollection()){var n=e;return vf.map(t,{interfaces_:function(){return[kc.MapOp]},map:function(i){return i.intersection(n)}})}return t.checkNotGeometryCollection(t),t.checkNotGeometryCollection(e),Oi.overlayOp(t,e,Jt.INTERSECTION)};Jt.symDifference=function(t,e){if(t.isEmpty()||e.isEmpty()){if(t.isEmpty()&&e.isEmpty())return Jt.createEmptyResult(Jt.SYMDIFFERENCE,t,e,t.getFactory());if(t.isEmpty())return e.copy();if(e.isEmpty())return t.copy()}return t.checkNotGeometryCollection(t),t.checkNotGeometryCollection(e),Oi.overlayOp(t,e,Jt.SYMDIFFERENCE)};Jt.resultDimension=function(t,e,n){var i=e.getDimension(),u=n.getDimension(),h=-1;switch(t){case Jt.INTERSECTION:h=Math.min(i,u);break;case Jt.UNION:h=Math.max(i,u);break;case Jt.DIFFERENCE:h=i;break;case Jt.SYMDIFFERENCE:h=Math.max(i,u);break}return h};Jt.createEmptyResult=function(t,e,n,i){var u=null;switch(Jt.resultDimension(t,e,n)){case-1:u=i.createGeometryCollection(new Array(0).fill(null));break;case 0:u=i.createPoint();break;case 1:u=i.createLineString();break;case 2:u=i.createPolygon();break}return u};Jt.difference=function(t,e){return t.isEmpty()?Jt.createEmptyResult(Jt.DIFFERENCE,t,e,t.getFactory()):e.isEmpty()?t.copy():(t.checkNotGeometryCollection(t),t.checkNotGeometryCollection(e),Oi.overlayOp(t,e,Jt.DIFFERENCE))};Jt.isResultOfOp=function(){if(arguments.length===2){var t=arguments[0],e=arguments[1],n=t.getLocation(0),i=t.getLocation(1);return Jt.isResultOfOp(n,i,e)}else if(arguments.length===3){var u=arguments[0],h=arguments[1],d=arguments[2];switch(u===Oe.BOUNDARY&&(u=Oe.INTERIOR),h===Oe.BOUNDARY&&(h=Oe.INTERIOR),d){case Jt.INTERSECTION:return u===Oe.INTERIOR&&h===Oe.INTERIOR;case Jt.UNION:return u===Oe.INTERIOR||h===Oe.INTERIOR;case Jt.DIFFERENCE:return u===Oe.INTERIOR&&h!==Oe.INTERIOR;case Jt.SYMDIFFERENCE:return u===Oe.INTERIOR&&h!==Oe.INTERIOR||u!==Oe.INTERIOR&&h===Oe.INTERIOR}return!1}};Jt.INTERSECTION=1;Jt.UNION=2;Jt.DIFFERENCE=3;Jt.SYMDIFFERENCE=4;var vu=function(){this._g=null,this._boundaryDistanceTolerance=null,this._linework=null,this._ptLocator=new Ts,this._seg=new Nt;var e=arguments[0],n=arguments[1];this._g=e,this._boundaryDistanceTolerance=n,this._linework=this.extractLinework(e)};vu.prototype.isWithinToleranceOfBoundary=function(e){for(var n=this,i=0;i<this._linework.getNumGeometries();i++)for(var u=n._linework.getGeometryN(i),h=u.getCoordinateSequence(),d=0;d<h.size()-1;d++){h.getCoordinate(d,n._seg.p0),h.getCoordinate(d+1,n._seg.p1);var s=n._seg.distance(e);if(s<=n._boundaryDistanceTolerance)return!0}return!1};vu.prototype.getLocation=function(e){return this.isWithinToleranceOfBoundary(e)?Oe.BOUNDARY:this._ptLocator.locate(e,this._g)};vu.prototype.extractLinework=function(e){var n=new Ad;e.apply(n);var i=n.getLinework(),u=ln.toLineStringArray(i);return e.getFactory().createMultiLineString(u)};vu.prototype.interfaces_=function(){return[]};vu.prototype.getClass=function(){return vu};var Ad=function(){this._linework=null,this._linework=new gt};Ad.prototype.getLinework=function(){return this._linework};Ad.prototype.filter=function(e){var n=this;if(e instanceof jr){var i=e;this._linework.add(i.getExteriorRing());for(var u=0;u<i.getNumInteriorRing();u++)n._linework.add(i.getInteriorRingN(u))}};Ad.prototype.interfaces_=function(){return[na]};Ad.prototype.getClass=function(){return Ad};var $c=function(){this._g=null,this._doLeft=!0,this._doRight=!0;var e=arguments[0];this._g=e};$c.prototype.extractPoints=function(e,n,i){for(var u=this,h=e.getCoordinates(),d=0;d<h.length-1;d++)u.computeOffsetPoints(h[d],h[d+1],n,i)};$c.prototype.setSidesToGenerate=function(e,n){this._doLeft=e,this._doRight=n};$c.prototype.getPoints=function(e){for(var n=this,i=new gt,u=ii.getLines(this._g),h=u.iterator();h.hasNext();){var d=h.next();n.extractPoints(d,e,i)}return i};$c.prototype.computeOffsetPoints=function(e,n,i,u){var h=n.x-e.x,d=n.y-e.y,s=Math.sqrt(h*h+d*d),w=i*h/s,T=i*d/s,A=(n.x+e.x)/2,D=(n.y+e.y)/2;if(this._doLeft){var R=new Me(A-T,D+w);u.add(R)}if(this._doRight){var G=new Me(A+T,D-w);u.add(G)}};$c.prototype.interfaces_=function(){return[]};$c.prototype.getClass=function(){return $c};var Io=function t(){this._geom=null,this._locFinder=null,this._location=new Array(3).fill(null),this._invalidLocation=null,this._boundaryDistanceTolerance=t.TOLERANCE,this._testCoords=new gt;var e=arguments[0],n=arguments[1],i=arguments[2];this._boundaryDistanceTolerance=t.computeBoundaryDistanceTolerance(e,n),this._geom=[e,n,i],this._locFinder=[new vu(this._geom[0],this._boundaryDistanceTolerance),new vu(this._geom[1],this._boundaryDistanceTolerance),new vu(this._geom[2],this._boundaryDistanceTolerance)]},xD={TOLERANCE:{configurable:!0}};Io.prototype.reportResult=function(e,n,i){li.out.println("Overlay result invalid - A:"+Oe.toLocationSymbol(n[0])+" B:"+Oe.toLocationSymbol(n[1])+" expected:"+(i?"i":"e")+" actual:"+Oe.toLocationSymbol(n[2]))};Io.prototype.isValid=function(e){this.addTestPts(this._geom[0]),this.addTestPts(this._geom[1]);var n=this.checkValid(e);return n};Io.prototype.checkValid=function(){var e=this;if(arguments.length===1){for(var n=arguments[0],i=0;i<this._testCoords.size();i++){var u=e._testCoords.get(i);if(!e.checkValid(n,u))return e._invalidLocation=u,!1}return!0}else if(arguments.length===2){var h=arguments[0],d=arguments[1];return this._location[0]=this._locFinder[0].getLocation(d),this._location[1]=this._locFinder[1].getLocation(d),this._location[2]=this._locFinder[2].getLocation(d),Io.hasLocation(this._location,Oe.BOUNDARY)?!0:this.isValidResult(h,this._location)}};Io.prototype.addTestPts=function(e){var n=new $c(e);this._testCoords.addAll(n.getPoints(5*this._boundaryDistanceTolerance))};Io.prototype.isValidResult=function(e,n){var i=Jt.isResultOfOp(n[0],n[1],e),u=n[2]===Oe.INTERIOR,h=!(i^u);return h||this.reportResult(e,n,i),h};Io.prototype.getInvalidLocation=function(){return this._invalidLocation};Io.prototype.interfaces_=function(){return[]};Io.prototype.getClass=function(){return Io};Io.hasLocation=function(e,n){for(var i=0;i<3;i++)if(e[i]===n)return!0;return!1};Io.computeBoundaryDistanceTolerance=function(e,n){return Math.min(_r.computeSizeBasedSnapTolerance(e),_r.computeSizeBasedSnapTolerance(n))};Io.isValid=function(e,n,i,u){var h=new Io(e,n,u);return h.isValid(i)};xD.TOLERANCE.get=function(){return 1e-6};Object.defineProperties(Io,xD);var xo=function t(e){this._geomFactory=null,this._skipEmpty=!1,this._inputGeoms=null,this._geomFactory=t.extractFactory(e),this._inputGeoms=e};xo.prototype.extractElements=function(e,n){var i=this;if(e===null)return null;for(var u=0;u<e.getNumGeometries();u++){var h=e.getGeometryN(u);i._skipEmpty&&h.isEmpty()||n.add(h)}};xo.prototype.combine=function(){for(var e=this,n=new gt,i=this._inputGeoms.iterator();i.hasNext();){var u=i.next();e.extractElements(u,n)}return n.size()===0?this._geomFactory!==null?this._geomFactory.createGeometryCollection(null):null:this._geomFactory.buildGeometry(n)};xo.prototype.interfaces_=function(){return[]};xo.prototype.getClass=function(){return xo};xo.combine=function(){if(arguments.length===1){var e=arguments[0],n=new xo(e);return n.combine()}else if(arguments.length===2){var i=arguments[0],u=arguments[1],h=new xo(xo.createList(i,u));return h.combine()}else if(arguments.length===3){var d=arguments[0],s=arguments[1],w=arguments[2],T=new xo(xo.createList(d,s,w));return T.combine()}};xo.extractFactory=function(e){return e.isEmpty()?null:e.iterator().next().getFactory()};xo.createList=function(){if(arguments.length===2){var e=arguments[0],n=arguments[1],i=new gt;return i.add(e),i.add(n),i}else if(arguments.length===3){var u=arguments[0],h=arguments[1],d=arguments[2],s=new gt;return s.add(u),s.add(h),s.add(d),s}};var Sr=function(){this._inputPolys=null,this._geomFactory=null;var e=arguments[0];this._inputPolys=e,this._inputPolys===null&&(this._inputPolys=new gt)},wD={STRTREE_NODE_CAPACITY:{configurable:!0}};Sr.prototype.reduceToGeometries=function(e){for(var n=this,i=new gt,u=e.iterator();u.hasNext();){var h=u.next(),d=null;Ut(h,gs)?d=n.unionTree(h):h instanceof Ft&&(d=h),i.add(d)}return i};Sr.prototype.extractByEnvelope=function(e,n,i){for(var u=new gt,h=0;h<n.getNumGeometries();h++){var d=n.getGeometryN(h);d.getEnvelopeInternal().intersects(e)?u.add(d):i.add(d)}return this._geomFactory.buildGeometry(u)};Sr.prototype.unionOptimized=function(e,n){var i=e.getEnvelopeInternal(),u=n.getEnvelopeInternal();if(!i.intersects(u)){var h=xo.combine(e,n);return h}if(e.getNumGeometries()<=1&&n.getNumGeometries()<=1)return this.unionActual(e,n);var d=i.intersection(u);return this.unionUsingEnvelopeIntersection(e,n,d)};Sr.prototype.union=function(){if(this._inputPolys===null)throw new Error("union() method cannot be called twice");if(this._inputPolys.isEmpty())return null;this._geomFactory=this._inputPolys.iterator().next().getFactory();for(var e=new sD(Sr.STRTREE_NODE_CAPACITY),n=this._inputPolys.iterator();n.hasNext();){var i=n.next();e.insert(i.getEnvelopeInternal(),i)}this._inputPolys=null;var u=e.itemsTree(),h=this.unionTree(u);return h};Sr.prototype.binaryUnion=function(){if(arguments.length===1){var e=arguments[0];return this.binaryUnion(e,0,e.size())}else if(arguments.length===3){var n=arguments[0],i=arguments[1],u=arguments[2];if(u-i<=1){var h=Sr.getGeometry(n,i);return this.unionSafe(h,null)}else{if(u-i===2)return this.unionSafe(Sr.getGeometry(n,i),Sr.getGeometry(n,i+1));var d=Math.trunc((u+i)/2),s=this.binaryUnion(n,i,d),w=this.binaryUnion(n,d,u);return this.unionSafe(s,w)}}};Sr.prototype.repeatedUnion=function(e){for(var n=null,i=e.iterator();i.hasNext();){var u=i.next();n===null?n=u.copy():n=n.union(u)}return n};Sr.prototype.unionSafe=function(e,n){return e===null&&n===null?null:e===null?n.copy():n===null?e.copy():this.unionOptimized(e,n)};Sr.prototype.unionActual=function(e,n){return Sr.restrictToPolygons(e.union(n))};Sr.prototype.unionTree=function(e){var n=this.reduceToGeometries(e),i=this.binaryUnion(n);return i};Sr.prototype.unionUsingEnvelopeIntersection=function(e,n,i){var u=new gt,h=this.extractByEnvelope(i,e,u),d=this.extractByEnvelope(i,n,u),s=this.unionActual(h,d);u.add(s);var w=xo.combine(u);return w};Sr.prototype.bufferUnion=function(){if(arguments.length===1){var e=arguments[0],n=e.get(0).getFactory(),i=n.buildGeometry(e),u=i.buffer(0);return u}else if(arguments.length===2){var h=arguments[0],d=arguments[1],s=h.getFactory(),w=s.createGeometryCollection([h,d]),T=w.buffer(0);return T}};Sr.prototype.interfaces_=function(){return[]};Sr.prototype.getClass=function(){return Sr};Sr.restrictToPolygons=function(e){if(Ut(e,Cu))return e;var n=Rl.getPolygons(e);return n.size()===1?n.get(0):e.getFactory().createMultiPolygon(ln.toPolygonArray(n))};Sr.getGeometry=function(e,n){return n>=e.size()?null:e.get(n)};Sr.union=function(e){var n=new Sr(e);return n.union()};wD.STRTREE_NODE_CAPACITY.get=function(){return 4};Object.defineProperties(Sr,wD);var Q0=function(){};Q0.prototype.interfaces_=function(){return[]};Q0.prototype.getClass=function(){return Q0};Q0.union=function(e,n){if(e.isEmpty()||n.isEmpty()){if(e.isEmpty()&&n.isEmpty())return Jt.createEmptyResult(Jt.UNION,e,n,e.getFactory());if(e.isEmpty())return n.copy();if(n.isEmpty())return e.copy()}return e.checkNotGeometryCollection(e),e.checkNotGeometryCollection(n),Oi.overlayOp(e,n,Jt.UNION)};function Kc(){return new ex}function ex(){this.reset()}ex.prototype={constructor:ex,reset:function(){this.s=this.t=0},add:function(t){wM(Vv,t,this.t),wM(this,Vv.s,this.s),this.s?this.t+=Vv.t:this.s=Vv.t},valueOf:function(){return this.s}};var Vv=new ex;function wM(t,e,n){var i=t.s=e+n,u=i-e,h=i-u;t.t=e-h+(n-u)}var lr=1e-6,Un=Math.PI,Al=Un/2,bM=Un/4,Bl=Un*2,vc=180/Un,Gs=Un/180,Pi=Math.abs,kU=Math.atan,Pd=Math.atan2,zr=Math.cos,Fr=Math.sin,Vd=Math.sqrt;function bD(t){return t>1?0:t<-1?Un:Math.acos(t)}function bf(t){return t>1?Al:t<-1?-Al:Math.asin(t)}function zg(){}function tx(t,e){t&&SM.hasOwnProperty(t.type)&&SM[t.type](t,e)}var EM={Feature:function(t,e){tx(t.geometry,e)},FeatureCollection:function(t,e){for(var n=t.features,i=-1,u=n.length;++i<u;)tx(n[i].geometry,e)}},SM={Sphere:function(t,e){e.sphere()},Point:function(t,e){t=t.coordinates,e.point(t[0],t[1],t[2])},MultiPoint:function(t,e){for(var n=t.coordinates,i=-1,u=n.length;++i<u;)t=n[i],e.point(t[0],t[1],t[2])},LineString:function(t,e){uE(t.coordinates,e,0)},MultiLineString:function(t,e){for(var n=t.coordinates,i=-1,u=n.length;++i<u;)uE(n[i],e,0)},Polygon:function(t,e){TM(t.coordinates,e)},MultiPolygon:function(t,e){for(var n=t.coordinates,i=-1,u=n.length;++i<u;)TM(n[i],e)},GeometryCollection:function(t,e){for(var n=t.geometries,i=-1,u=n.length;++i<u;)tx(n[i],e)}};function uE(t,e,n){var i=-1,u=t.length-n,h;for(e.lineStart();++i<u;)h=t[i],e.point(h[0],h[1],h[2]);e.lineEnd()}function TM(t,e){var n=-1,i=t.length;for(e.polygonStart();++n<i;)uE(t[n],e,1);e.polygonEnd()}function OU(t,e){t&&EM.hasOwnProperty(t.type)?EM[t.type](t,e):tx(t,e)}Kc();Kc();function cE(t){return[Pd(t[1],t[0]),bf(t[2])]}function Ld(t){var e=t[0],n=t[1],i=zr(n);return[i*zr(e),i*Fr(e),Fr(n)]}function jv(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function nx(t,e){return[t[1]*e[2]-t[2]*e[1],t[2]*e[0]-t[0]*e[2],t[0]*e[1]-t[1]*e[0]]}function Qw(t,e){t[0]+=e[0],t[1]+=e[1],t[2]+=e[2]}function Gv(t,e){return[t[0]*e,t[1]*e,t[2]*e]}function hE(t){var e=Vd(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]/=e,t[1]/=e,t[2]/=e}Kc();function ED(t,e){function n(i,u){return i=t(i,u),e(i[0],i[1])}return t.invert&&e.invert&&(n.invert=function(i,u){return i=e.invert(i,u),i&&t.invert(i[0],i[1])}),n}function fE(t,e){return[t>Un?t-Bl:t<-Un?t+Bl:t,e]}fE.invert=fE;function zU(t,e,n){return(t%=Bl)?e||n?ED(IM(t),MM(e,n)):IM(t):e||n?MM(e,n):fE}function CM(t){return function(e,n){return e+=t,[e>Un?e-Bl:e<-Un?e+Bl:e,n]}}function IM(t){var e=CM(t);return e.invert=CM(-t),e}function MM(t,e){var n=zr(t),i=Fr(t),u=zr(e),h=Fr(e);function d(s,w){var T=zr(w),A=zr(s)*T,D=Fr(s)*T,R=Fr(w),G=R*n+A*i;return[Pd(D*u-G*h,A*n-R*i),bf(G*u+D*h)]}return d.invert=function(s,w){var T=zr(w),A=zr(s)*T,D=Fr(s)*T,R=Fr(w),G=R*u-D*h;return[Pd(D*u+R*h,A*n+G*i),bf(G*n-A*i)]},d}function FU(t,e,n,i,u,h){if(n){var d=zr(e),s=Fr(e),w=i*n;u==null?(u=e+i*Bl,h=e-w/2):(u=AM(d,u),h=AM(d,h),(i>0?u<h:u>h)&&(u+=i*Bl));for(var T,A=u;i>0?A>h:A<h;A-=w)T=cE([d,-s*zr(A),-s*Fr(A)]),t.point(T[0],T[1])}}function AM(t,e){e=Ld(e),e[0]-=t,hE(e);var n=bD(-e[1]);return((-e[2]<0?-n:n)+Bl-lr)%Bl}function SD(){var t=[],e;return{point:function(n,i){e.push([n,i])},lineStart:function(){t.push(e=[])},lineEnd:zg,rejoin:function(){t.length>1&&t.push(t.pop().concat(t.shift()))},result:function(){var n=t;return t=[],e=null,n}}}function BU(t,e,n,i,u,h){var d=t[0],s=t[1],w=e[0],T=e[1],A=0,D=1,R=w-d,G=T-s,$;if($=n-d,!(!R&&$>0)){if($/=R,R<0){if($<A)return;$<D&&(D=$)}else if(R>0){if($>D)return;$>A&&(A=$)}if($=u-d,!(!R&&$<0)){if($/=R,R<0){if($>D)return;$>A&&(A=$)}else if(R>0){if($<A)return;$<D&&(D=$)}if($=i-s,!(!G&&$>0)){if($/=G,G<0){if($<A)return;$<D&&(D=$)}else if(G>0){if($>D)return;$>A&&(A=$)}if($=h-s,!(!G&&$<0)){if($/=G,G<0){if($>D)return;$>A&&(A=$)}else if(G>0){if($<A)return;$<D&&(D=$)}return A>0&&(t[0]=d+A*R,t[1]=s+A*G),D<1&&(e[0]=d+D*R,e[1]=s+D*G),!0}}}}}function c0(t,e){return Pi(t[0]-e[0])<lr&&Pi(t[1]-e[1])<lr}function qv(t,e,n,i){this.x=t,this.z=e,this.o=n,this.e=i,this.v=!1,this.n=this.p=null}function TD(t,e,n,i,u){var h=[],d=[],s,w;if(t.forEach(function($){if(!((ie=$.length-1)<=0)){var ie,_e=$[0],Y=$[ie],B;if(c0(_e,Y)){for(u.lineStart(),s=0;s<ie;++s)u.point((_e=$[s])[0],_e[1]);u.lineEnd();return}h.push(B=new qv(_e,$,null,!0)),d.push(B.o=new qv(_e,null,B,!1)),h.push(B=new qv(Y,$,null,!1)),d.push(B.o=new qv(Y,null,B,!0))}}),!!h.length){for(d.sort(e),PM(h),PM(d),s=0,w=d.length;s<w;++s)d[s].e=n=!n;for(var T=h[0],A,D;;){for(var R=T,G=!0;R.v;)if((R=R.n)===T)return;A=R.z,u.lineStart();do{if(R.v=R.o.v=!0,R.e){if(G)for(s=0,w=A.length;s<w;++s)u.point((D=A[s])[0],D[1]);else i(R.x,R.n.x,1,u);R=R.n}else{if(G)for(A=R.p.z,s=A.length-1;s>=0;--s)u.point((D=A[s])[0],D[1]);else i(R.x,R.p.x,-1,u);R=R.p}R=R.o,A=R.z,G=!G}while(!R.v);u.lineEnd()}}}function PM(t){if(e=t.length){for(var e,n=0,i=t[0],u;++n<e;)i.n=u=t[n],u.p=i,i=u;i.n=u=t[0],u.p=i}}function CD(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function UU(t){return t.length===1&&(t=VU(t)),{left:function(e,n,i,u){for(i==null&&(i=0),u==null&&(u=e.length);i<u;){var h=i+u>>>1;t(e[h],n)<0?i=h+1:u=h}return i},right:function(e,n,i,u){for(i==null&&(i=0),u==null&&(u=e.length);i<u;){var h=i+u>>>1;t(e[h],n)>0?u=h:i=h+1}return i}}}function VU(t){return function(e,n){return CD(t(e),n)}}UU(CD);function ID(t){for(var e=t.length,n,i=-1,u=0,h,d;++i<e;)u+=t[i].length;for(h=new Array(u);--e>=0;)for(d=t[e],n=d.length;--n>=0;)h[--u]=d[n];return h}var Fg=1e9,Xv=-Fg;function jU(t,e,n,i){function u(T,A){return t<=T&&T<=n&&e<=A&&A<=i}function h(T,A,D,R){var G=0,$=0;if(T==null||(G=d(T,D))!==($=d(A,D))||w(T,A)<0^D>0)do R.point(G===0||G===3?t:n,G>1?i:e);while((G=(G+D+4)%4)!==$);else R.point(A[0],A[1])}function d(T,A){return Pi(T[0]-t)<lr?A>0?0:3:Pi(T[0]-n)<lr?A>0?2:1:Pi(T[1]-e)<lr?A>0?1:0:A>0?3:2}function s(T,A){return w(T.x,A.x)}function w(T,A){var D=d(T,1),R=d(A,1);return D!==R?D-R:D===0?A[1]-T[1]:D===1?T[0]-A[0]:D===2?T[1]-A[1]:A[0]-T[0]}return function(T){var A=T,D=SD(),R,G,$,ie,_e,Y,B,q,oe,de,we,Se={point:Te,lineStart:He,lineEnd:$e,polygonStart:et,polygonEnd:We};function Te(Pt,Bt){u(Pt,Bt)&&A.point(Pt,Bt)}function xe(){for(var Pt=0,Bt=0,Zt=G.length;Bt<Zt;++Bt)for(var qe=G[Bt],Et=1,Ct=qe.length,kt=qe[0],Vt,hn,tr=kt[0],Wn=kt[1];Et<Ct;++Et)Vt=tr,hn=Wn,kt=qe[Et],tr=kt[0],Wn=kt[1],hn<=i?Wn>i&&(tr-Vt)*(i-hn)>(Wn-hn)*(t-Vt)&&++Pt:Wn<=i&&(tr-Vt)*(i-hn)<(Wn-hn)*(t-Vt)&&--Pt;return Pt}function et(){A=D,R=[],G=[],we=!0}function We(){var Pt=xe(),Bt=we&&Pt,Zt=(R=ID(R)).length;(Bt||Zt)&&(T.polygonStart(),Bt&&(T.lineStart(),h(null,null,1,T),T.lineEnd()),Zt&&TD(R,s,Pt,h,T),T.polygonEnd()),A=T,R=G=$=null}function He(){Se.point=ze,G&&G.push($=[]),de=!0,oe=!1,B=q=NaN}function $e(){R&&(ze(ie,_e),Y&&oe&&D.rejoin(),R.push(D.result())),Se.point=Te,oe&&A.lineEnd()}function ze(Pt,Bt){var Zt=u(Pt,Bt);if(G&&$.push([Pt,Bt]),de)ie=Pt,_e=Bt,Y=Zt,de=!1,Zt&&(A.lineStart(),A.point(Pt,Bt));else if(Zt&&oe)A.point(Pt,Bt);else{var qe=[B=Math.max(Xv,Math.min(Fg,B)),q=Math.max(Xv,Math.min(Fg,q))],Et=[Pt=Math.max(Xv,Math.min(Fg,Pt)),Bt=Math.max(Xv,Math.min(Fg,Bt))];BU(qe,Et,t,e,n,i)?(oe||(A.lineStart(),A.point(qe[0],qe[1])),A.point(Et[0],Et[1]),Zt||A.lineEnd(),we=!1):Zt&&(A.lineStart(),A.point(Pt,Bt),we=!1)}B=Pt,q=Bt,oe=Zt}return Se}}var eb=Kc();function GU(t,e){var n=e[0],i=e[1],u=[Fr(n),-zr(n),0],h=0,d=0;eb.reset();for(var s=0,w=t.length;s<w;++s)if(A=(T=t[s]).length)for(var T,A,D=T[A-1],R=D[0],G=D[1]/2+bM,$=Fr(G),ie=zr(G),_e=0;_e<A;++_e,R=B,$=oe,ie=de,D=Y){var Y=T[_e],B=Y[0],q=Y[1]/2+bM,oe=Fr(q),de=zr(q),we=B-R,Se=we>=0?1:-1,Te=Se*we,xe=Te>Un,et=$*oe;if(eb.add(Pd(et*Se*Fr(Te),ie*de+et*zr(Te))),h+=xe?we+Se*Bl:we,xe^R>=n^B>=n){var We=nx(Ld(D),Ld(Y));hE(We);var He=nx(u,We);hE(He);var $e=(xe^we>=0?-1:1)*bf(He[2]);(i>$e||i===$e&&(We[0]||We[1]))&&(d+=xe^we>=0?1:-1)}}return(h<-lr||h<lr&&eb<-lr)^d&1}Kc();function LM(t){return t}Kc();Kc();var Dd=1/0,rx=Dd,P_=-Dd,ix=P_,DM={point:qU,lineStart:zg,lineEnd:zg,polygonStart:zg,polygonEnd:zg,result:function(){var t=[[Dd,rx],[P_,ix]];return P_=ix=-(rx=Dd=1/0),t}};function qU(t,e){t<Dd&&(Dd=t),t>P_&&(P_=t),e<rx&&(rx=e),e>ix&&(ix=e)}Kc();function MD(t,e,n,i){return function(u,h){var d=e(h),s=u.invert(i[0],i[1]),w=SD(),T=e(w),A=!1,D,R,G,$={point:ie,lineStart:Y,lineEnd:B,polygonStart:function(){$.point=q,$.lineStart=oe,$.lineEnd=de,R=[],D=[]},polygonEnd:function(){$.point=ie,$.lineStart=Y,$.lineEnd=B,R=ID(R);var we=GU(D,s);R.length?(A||(h.polygonStart(),A=!0),TD(R,$U,we,n,h)):we&&(A||(h.polygonStart(),A=!0),h.lineStart(),n(null,null,1,h),h.lineEnd()),A&&(h.polygonEnd(),A=!1),R=D=null},sphere:function(){h.polygonStart(),h.lineStart(),n(null,null,1,h),h.lineEnd(),h.polygonEnd()}};function ie(we,Se){var Te=u(we,Se);t(we=Te[0],Se=Te[1])&&h.point(we,Se)}function _e(we,Se){var Te=u(we,Se);d.point(Te[0],Te[1])}function Y(){$.point=_e,d.lineStart()}function B(){$.point=ie,d.lineEnd()}function q(we,Se){G.push([we,Se]);var Te=u(we,Se);T.point(Te[0],Te[1])}function oe(){T.lineStart(),G=[]}function de(){q(G[0][0],G[0][1]),T.lineEnd();var we=T.clean(),Se=w.result(),Te,xe=Se.length,et,We,He;if(G.pop(),D.push(G),G=null,!!xe){if(we&1){if(We=Se[0],(et=We.length-1)>0){for(A||(h.polygonStart(),A=!0),h.lineStart(),Te=0;Te<et;++Te)h.point((He=We[Te])[0],He[1]);h.lineEnd()}return}xe>1&&we&2&&Se.push(Se.pop().concat(Se.shift())),R.push(Se.filter(XU))}}return $}}function XU(t){return t.length>1}function $U(t,e){return((t=t.x)[0]<0?t[1]-Al-lr:Al-t[1])-((e=e.x)[0]<0?e[1]-Al-lr:Al-e[1])}const RM=MD(function(){return!0},ZU,HU,[-Un,-Al]);function ZU(t){var e=NaN,n=NaN,i=NaN,u;return{lineStart:function(){t.lineStart(),u=1},point:function(h,d){var s=h>0?Un:-Un,w=Pi(h-e);Pi(w-Un)<lr?(t.point(e,n=(n+d)/2>0?Al:-Al),t.point(i,n),t.lineEnd(),t.lineStart(),t.point(s,n),t.point(h,n),u=0):i!==s&&w>=Un&&(Pi(e-i)<lr&&(e-=i*lr),Pi(h-s)<lr&&(h-=s*lr),n=WU(e,n,h,d),t.point(i,n),t.lineEnd(),t.lineStart(),t.point(s,n),u=0),t.point(e=h,n=d),i=s},lineEnd:function(){t.lineEnd(),e=n=NaN},clean:function(){return 2-u}}}function WU(t,e,n,i){var u,h,d=Fr(t-n);return Pi(d)>lr?kU((Fr(e)*(h=zr(i))*Fr(n)-Fr(i)*(u=zr(e))*Fr(t))/(u*h*d)):(e+i)/2}function HU(t,e,n,i){var u;if(t==null)u=n*Al,i.point(-Un,u),i.point(0,u),i.point(Un,u),i.point(Un,0),i.point(Un,-u),i.point(0,-u),i.point(-Un,-u),i.point(-Un,0),i.point(-Un,u);else if(Pi(t[0]-e[0])>lr){var h=t[0]<e[0]?Un:-Un;u=n*h/2,i.point(-h,u),i.point(0,u),i.point(h,u)}else i.point(e[0],e[1])}function YU(t,e){var n=zr(t),i=n>0,u=Pi(n)>lr;function h(A,D,R,G){FU(G,t,e,R,A,D)}function d(A,D){return zr(A)*zr(D)>n}function s(A){var D,R,G,$,ie;return{lineStart:function(){$=G=!1,ie=1},point:function(_e,Y){var B=[_e,Y],q,oe=d(_e,Y),de=i?oe?0:T(_e,Y):oe?T(_e+(_e<0?Un:-Un),Y):0;if(!D&&($=G=oe)&&A.lineStart(),oe!==G&&(q=w(D,B),(!q||c0(D,q)||c0(B,q))&&(B[0]+=lr,B[1]+=lr,oe=d(B[0],B[1]))),oe!==G)ie=0,oe?(A.lineStart(),q=w(B,D),A.point(q[0],q[1])):(q=w(D,B),A.point(q[0],q[1]),A.lineEnd()),D=q;else if(u&&D&&i^oe){var we;!(de&R)&&(we=w(B,D,!0))&&(ie=0,i?(A.lineStart(),A.point(we[0][0],we[0][1]),A.point(we[1][0],we[1][1]),A.lineEnd()):(A.point(we[1][0],we[1][1]),A.lineEnd(),A.lineStart(),A.point(we[0][0],we[0][1])))}oe&&(!D||!c0(D,B))&&A.point(B[0],B[1]),D=B,G=oe,R=de},lineEnd:function(){G&&A.lineEnd(),D=null},clean:function(){return ie|($&&G)<<1}}}function w(A,D,R){var G=Ld(A),$=Ld(D),ie=[1,0,0],_e=nx(G,$),Y=jv(_e,_e),B=_e[0],q=Y-B*B;if(!q)return!R&&A;var oe=n*Y/q,de=-n*B/q,we=nx(ie,_e),Se=Gv(ie,oe),Te=Gv(_e,de);Qw(Se,Te);var xe=we,et=jv(Se,xe),We=jv(xe,xe),He=et*et-We*(jv(Se,Se)-1);if(!(He<0)){var $e=Vd(He),ze=Gv(xe,(-et-$e)/We);if(Qw(ze,Se),ze=cE(ze),!R)return ze;var Pt=A[0],Bt=D[0],Zt=A[1],qe=D[1],Et;Bt<Pt&&(Et=Pt,Pt=Bt,Bt=Et);var Ct=Bt-Pt,kt=Pi(Ct-Un)<lr,Vt=kt||Ct<lr;if(!kt&&qe<Zt&&(Et=Zt,Zt=qe,qe=Et),Vt?kt?Zt+qe>0^ze[1]<(Pi(ze[0]-Pt)<lr?Zt:qe):Zt<=ze[1]&&ze[1]<=qe:Ct>Un^(Pt<=ze[0]&&ze[0]<=Bt)){var hn=Gv(xe,(-et+$e)/We);return Qw(hn,Se),[ze,cE(hn)]}}}function T(A,D){var R=i?t:Un-t,G=0;return A<-R?G|=1:A>R&&(G|=2),D<-R?G|=4:D>R&&(G|=8),G}return MD(d,s,h,i?[0,-t]:[-Un,t-Un])}function AD(t){return function(e){var n=new pE;for(var i in t)n[i]=t[i];return n.stream=e,n}}function pE(){}pE.prototype={constructor:pE,point:function(t,e){this.stream.point(t,e)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};function PD(t,e,n){var i=e[1][0]-e[0][0],u=e[1][1]-e[0][1],h=t.clipExtent&&t.clipExtent();t.scale(150).translate([0,0]),h!=null&&t.clipExtent(null),OU(n,t.stream(DM));var d=DM.result(),s=Math.min(i/(d[1][0]-d[0][0]),u/(d[1][1]-d[0][1])),w=+e[0][0]+(i-s*(d[1][0]+d[0][0]))/2,T=+e[0][1]+(u-s*(d[1][1]+d[0][1]))/2;return h!=null&&t.clipExtent(h),t.scale(s*150).translate([w,T])}function KU(t,e,n){return PD(t,[[0,0],e],n)}var NM=16,JU=zr(30*Gs);function kM(t,e){return+e?eV(t,e):QU(t)}function QU(t){return AD({point:function(e,n){e=t(e,n),this.stream.point(e[0],e[1])}})}function eV(t,e){function n(i,u,h,d,s,w,T,A,D,R,G,$,ie,_e){var Y=T-i,B=A-u,q=Y*Y+B*B;if(q>4*e&&ie--){var oe=d+R,de=s+G,we=w+$,Se=Vd(oe*oe+de*de+we*we),Te=bf(we/=Se),xe=Pi(Pi(we)-1)<lr||Pi(h-D)<lr?(h+D)/2:Pd(de,oe),et=t(xe,Te),We=et[0],He=et[1],$e=We-i,ze=He-u,Pt=B*$e-Y*ze;(Pt*Pt/q>e||Pi((Y*$e+B*ze)/q-.5)>.3||d*R+s*G+w*$<JU)&&(n(i,u,h,d,s,w,We,He,xe,oe/=Se,de/=Se,we,ie,_e),_e.point(We,He),n(We,He,xe,oe,de,we,T,A,D,R,G,$,ie,_e))}}return function(i){var u,h,d,s,w,T,A,D,R,G,$,ie,_e={point:Y,lineStart:B,lineEnd:oe,polygonStart:function(){i.polygonStart(),_e.lineStart=de},polygonEnd:function(){i.polygonEnd(),_e.lineStart=B}};function Y(Te,xe){Te=t(Te,xe),i.point(Te[0],Te[1])}function B(){D=NaN,_e.point=q,i.lineStart()}function q(Te,xe){var et=Ld([Te,xe]),We=t(Te,xe);n(D,R,A,G,$,ie,D=We[0],R=We[1],A=Te,G=et[0],$=et[1],ie=et[2],NM,i),i.point(D,R)}function oe(){_e.point=Y,i.lineEnd()}function de(){B(),_e.point=we,_e.lineEnd=Se}function we(Te,xe){q(u=Te,xe),h=D,d=R,s=G,w=$,T=ie,_e.point=q}function Se(){n(D,R,A,G,$,ie,h,d,u,s,w,T,NM,i),_e.lineEnd=oe,oe()}return _e}}var tV=AD({point:function(t,e){this.stream.point(t*Gs,e*Gs)}});function nV(t){return rV(function(){return t})()}function rV(t){var e,n=150,i=480,u=250,h,d,s=0,w=0,T=0,A=0,D=0,R,G,$=null,ie=RM,_e=null,Y,B,q,oe=LM,de=.5,we=kM(We,de),Se,Te;function xe(ze){return ze=G(ze[0]*Gs,ze[1]*Gs),[ze[0]*n+h,d-ze[1]*n]}function et(ze){return ze=G.invert((ze[0]-h)/n,(d-ze[1])/n),ze&&[ze[0]*vc,ze[1]*vc]}function We(ze,Pt){return ze=e(ze,Pt),[ze[0]*n+h,d-ze[1]*n]}xe.stream=function(ze){return Se&&Te===ze?Se:Se=tV(ie(R,we(oe(Te=ze))))},xe.clipAngle=function(ze){return arguments.length?(ie=+ze?YU($=ze*Gs,6*Gs):($=null,RM),$e()):$*vc},xe.clipExtent=function(ze){return arguments.length?(oe=ze==null?(_e=Y=B=q=null,LM):jU(_e=+ze[0][0],Y=+ze[0][1],B=+ze[1][0],q=+ze[1][1]),$e()):_e==null?null:[[_e,Y],[B,q]]},xe.scale=function(ze){return arguments.length?(n=+ze,He()):n},xe.translate=function(ze){return arguments.length?(i=+ze[0],u=+ze[1],He()):[i,u]},xe.center=function(ze){return arguments.length?(s=ze[0]%360*Gs,w=ze[1]%360*Gs,He()):[s*vc,w*vc]},xe.rotate=function(ze){return arguments.length?(T=ze[0]%360*Gs,A=ze[1]%360*Gs,D=ze.length>2?ze[2]%360*Gs:0,He()):[T*vc,A*vc,D*vc]},xe.precision=function(ze){return arguments.length?(we=kM(We,de=ze*ze),$e()):Vd(de)},xe.fitExtent=function(ze,Pt){return PD(xe,ze,Pt)},xe.fitSize=function(ze,Pt){return KU(xe,ze,Pt)};function He(){G=ED(R=zU(T,A,D),e);var ze=e(s,w);return h=i-ze[0]*n,d=u+ze[1]*n,$e()}function $e(){return Se=Te=null,xe}return function(){return e=t.apply(this,arguments),xe.invert=e.invert&&et,He()}}function LD(t){return function(e,n){var i=zr(e),u=zr(n),h=t(i*u);return[h*u*Fr(e),h*Fr(n)]}}function DD(t){return function(e,n){var i=Vd(e*e+n*n),u=t(i),h=Fr(u),d=zr(u);return[Pd(e*h,i*d),bf(i&&n*h/i)]}}var iV=LD(function(t){return Vd(2/(1+t))});iV.invert=DD(function(t){return 2*bf(t/2)});var RD=LD(function(t){return(t=bD(t))&&t/Fr(t)});RD.invert=DD(function(t){return t});function oV(){return nV(RD).scale(79.4188).clipAngle(180-.001)}function OM(t,e){return[t,e]}OM.invert=OM;function ND(t,e,n){n=n||{};var i=n.units||"kilometers",u=n.steps||8;if(!t)throw new Error("geojson is required");if(typeof n!="object")throw new Error("options must be an object");if(typeof u!="number")throw new Error("steps must be an number");if(e===void 0)throw new Error("radius is required");if(u<=0)throw new Error("steps must be greater than 0");var h=[];switch(t.type){case"GeometryCollection":return F_(t,function(d){var s=h0(d,e,i,u);s&&h.push(s)}),Za(h);case"FeatureCollection":return hd(t,function(d){var s=h0(d,e,i,u);s&&hd(s,function(w){w&&h.push(w)})}),Za(h)}return h0(t,e,i,u)}function h0(t,e,n,i){var u=t.properties||{},h=t.type==="Feature"?t.geometry:t;if(h.type==="GeometryCollection"){var d=[];return F_(t,function(ie){var _e=h0(ie,e,n,i);_e&&d.push(_e)}),Za(d)}var s=sV(h),w={type:h.type,coordinates:OD(h.coordinates,s)},T=new US,A=T.read(w),D=AS(Sx(e,n),"meters"),R=si.bufferOp(A,D,i),G=new iD;if(R=G.write(R),!kD(R.coordinates)){var $={type:R.type,coordinates:zD(R.coordinates,s)};return vs($,u)}}function kD(t){return Array.isArray(t[0])?kD(t[0]):isNaN(t[0])}function OD(t,e){return typeof t[0]!="object"?e(t):t.map(function(n){return OD(n,e)})}function zD(t,e){return typeof t[0]!="object"?e.invert(t):t.map(function(n){return zD(n,e)})}function sV(t){var e=J4(t).geometry.coordinates,n=[-e[0],-e[1]];return oV().rotate(n).scale(Bi)}const aV="/vacant-crossing-posts-storymap/assets/hand-c2d7326e.png",lV="/vacant-crossing-posts-storymap/assets/hand_filled-c5d41953.png";function FD(t){const n=JSON.parse(JSON.stringify(t)).reduce((i,u)=>{const h=u.geometry.coordinates.map(d=>d.toFixed(5)).join(",");return h in i||(i[h]=[]),i[h].push(u),i},{});return Object.keys(n).reduce((i,u)=>{const h=n[u].map((d,s)=>(d.geometry.coordinates=u.split(",").map(w=>Number(w)),d.geometry.coordinates[1]+=s*5e-5,d));return[...i,...h]},[])}function uV(t,e,n=80){const i=ND(fs(t.coordinates),n,{units:"meters"});return e.filter(u=>_U(i,u))}const cV=()=>{const{map:t,setMap:e,crashes:n,posts:i}=Mn.useContext($_),u=Mn.useRef(null),[h,d]=Mn.useState(-73.925),[s,w]=Mn.useState(40.862),[T,A]=Mn.useState(16.25);return Mn.useEffect(()=>{if(Kw.accessToken="pk.eyJ1IjoiY2xvdWRsdW4iLCJhIjoiY2s3ZWl4b3V1MDlkejNkb2JpZmtmbHp4ZiJ9.MbJU7PCa2LWBk9mENFkgxw",n&&i){const D=new Kw.Map({container:u.current,style:"mapbox://styles/cloudlun/cll18o57a00t501qg18da32hr",center:[h,s],zoom:T,interactive:!0,doubleClickZoom:!1});return D.on("move",()=>{d(D.getCenter().lng.toFixed(4)),w(D.getCenter().lat.toFixed(4)),A(D.getZoom().toFixed(2))}),D.on("load",async()=>{e(D);const R=n.filter($=>+$.properties.hour>7&&+$.properties.hour<16&&+$.properties.hour!=11&&+$.properties.hour!=12&&+$.geometry.coordinates[0]!==void 0&&+$.geometry.coordinates[1]>40.8491885183316),G=FD(R);D.addSource("guards",{type:"geojson",data:{type:"FeatureCollection",features:[]}}),D.addSource("crashes",{type:"geojson",data:{type:"FeatureCollection",features:G}}),D.addSource("buffer",{type:"geojson",data:{type:"FeatureCollection",features:[]}}),D.loadImage(aV,($,ie)=>{if($)throw $;D.addImage("icon_hand",ie,{sdf:!0})}),D.loadImage(lV,($,ie)=>{if($)throw $;D.addImage("icon_hand_filled",ie)}),D.addLayer({id:"guards_vacant",type:"symbol",source:"guards",layout:{"icon-image":"icon_hand","icon-size":.072,"icon-allow-overlap":!0},paint:{"icon-color":"#fdeca6","icon-opacity":0}}),D.addLayer({id:"guards",type:"symbol",source:"guards",layout:{"icon-image":"icon_hand_filled","icon-size":.14,"icon-allow-overlap":!1},paint:{"icon-opacity":0}}),D.addLayer({id:"crashes_all",type:"circle",source:"crashes",paint:{"circle-radius":6.5,"circle-stroke-width":0,"circle-color":["case",["all",[">=",["get","hour"],7],["<=",["get","hour"],10]],"#ffd4d2",["all",[">=",["get","hour"],13],["<=",["get","hour"],16]],"#ff727c","#e5e5e5"],"circle-opacity":["case",["all",[">=",["get","hour"],7],["<=",["get","hour"],10]],.8,["all",[">=",["get","hour"],13],["<=",["get","hour"],16]],.8,.15]}}),D.addLayer({id:"outline",type:"line",source:"buffer",layout:{"line-cap":"round"},paint:{"line-color":"#fdeca6","line-width":3,"line-dasharray":[0,2]}}),D.on("click","guards",$=>{const{geometry:ie,properties:_e}=$.features[0];let{coordinates:Y}=ie;for(;Math.abs($.lngLat.lng-Y[0])>180;)Y[0]+=$.lngLat.lng>Y[0]?360:-360;const B=uV(ie,R,80),q=B.reduce((ze,Pt)=>(Pt.properties.hour>=7&&Pt.properties.hour<=10?ze[0].count++:ze[1].count++,ze),[{time:"morning",count:0},{time:"afternoon",count:0}]);let oe=Y.slice(),de=`<div class="content">
                          <h4>Post ${_e["POST #"]} is ${_e["LAST NAME"]==="VACANT"?'<span class="vacant">Vacant</span>':"Staffed"}</h4>
                          <span style="font-size:24px;font-weight:bold">${B.length===0?0:q[0].count+q[1].count}</span> 
                          <br/> crashes occurred near this post on the ${_e["STREET NAME 1"]} and ${_e["STREET NAME 2"]} intersection
                        </div>
                        <div class="barChart"></div>`;new Kw.Popup({offset:[0,-30],anchor:"bottom-left",closeButton:!1,closeOnClick:!0}).setLngLat(oe).setHTML(de).addTo(D);const Se=ND(fs(oe),80,{units:"meters"});D.getSource("buffer").setData({type:"FeatureCollection",features:[Se]});const Te=200,xe=150,et=15,We=dS(".barChart").append("svg").attr("width",Te+et).attr("height",xe+et),He=SS().range([0,Te]).domain(q.map(ze=>ze.time)).padding(.1);We.append("g").attr("transform","translate(0,"+xe+")").call(iL(He).tickSize(0).tickPadding(5)).select(".domain").remove();const $e=TS().domain([0,12]).range([xe,0]);We.selectAll("bars").data(q).enter().append("rect").attr("x",ze=>He(ze.time)).attr("y",ze=>$e(ze.count)).attr("width",He.bandwidth()).attr("height",ze=>xe-$e(ze.count)).attr("fill",ze=>ze.time==="morning"?"#ffd4d2":ze.time==="afternoon"?"#ff727c":"#e5e5e5"),We.selectAll("nums").data(q).enter().append("text").attr("x",ze=>He(ze.time)+He.bandwidth()/2-6).attr("y",ze=>$e(ze.count)-4).text(ze=>ze.count).style("fill","white")})}),()=>{D.remove()}}},[n,i]),pt.jsx("div",{className:"fixed w-[100vw] h-[100vh]",ref:u})};function zM(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(u){return Object.getOwnPropertyDescriptor(t,u).enumerable})),n.push.apply(n,i)}return n}function FM(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?zM(Object(n),!0).forEach(function(i){hV(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):zM(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}function hV(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function dE(t,e){return fV(t)||pV(t,e)||dV(t,e)||mV()}function fV(t){if(Array.isArray(t))return t}function pV(t,e){var n=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(n!=null){var i=[],u=!0,h=!1,d,s;try{for(n=n.call(t);!(u=(d=n.next()).done)&&(i.push(d.value),!(e&&i.length===e));u=!0);}catch(w){h=!0,s=w}finally{try{!u&&n.return!=null&&n.return()}finally{if(h)throw s}}return i}}function dV(t,e){if(t){if(typeof t=="string")return BM(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if(n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set")return Array.from(t);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return BM(t,e)}}function BM(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function mV(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var BD=function(e){return typeof e=="string"&&e.includes("px")},gV={position:"fixed",left:0,width:"100%",height:0,borderTop:"2px dashed black",zIndex:9999},_V={fontSize:"12px",fontFamily:"monospace",margin:0,padding:6},yV=function(e){var n=BD(e);return n?e:"".concat(e*100,"%")},vV=function(e){var n=e.offset,i=yV(n);return hs.createElement("div",{style:FM(FM({},gV),{},{top:i})},hs.createElement("p",{style:_V},"trigger: ",n))},xV=function(e,n){for(var i=Math.ceil(n/e),u=[],h=1/i,d=0;d<=i;d+=1)u.push(d*h);return u},UD=function(e){var n=e.debug,i=e.children,u=e.offset,h=e.onStepEnter,d=e.onStepExit,s=e.onStepProgress,w=e.threshold,T=BD(u),A=Mn.useState(0),D=dE(A,2),R=D[0],G=D[1],$=Mn.useState(null),ie=dE($,2),_e=ie[0],Y=ie[1],B=function(xe){G(xe)},q=function(xe){Y(window.innerHeight)};hs.useEffect(function(){if(T)return window.addEventListener("resize",q),function(){window.removeEventListener("resize",q)}},[]);var oe=typeof window<"u",de=oe?_e||window.innerHeight:0,we=T?+u.replace("px","")/de:u,Se=Mn.useMemo(function(){return xV(w,de)},[de]);return hs.createElement(hs.Fragment,null,n&&hs.createElement(vV,{offset:u}),hs.Children.map(i,function(Te,xe){return hs.cloneElement(Te,{scrollamaId:"react-scrollama-".concat(xe),offset:we,onStepEnter:h,onStepExit:d,onStepProgress:s,lastScrollTop:R,handleSetLastScrollTop:B,progressThreshold:Se,innerHeight:de})}))};UD.defaultProps={onStepProgress:null,onStepEnter:function(){},onStepExit:function(){},threshold:4,offset:.3};const mE=new Map,$v=new WeakMap;let UM=0,wV;function bV(t){return t?($v.has(t)||(UM+=1,$v.set(t,UM.toString())),$v.get(t)):"0"}function EV(t){return Object.keys(t).sort().filter(e=>t[e]!==void 0).map(e=>`${e}_${e==="root"?bV(t.root):t[e]}`).toString()}function SV(t){let e=EV(t),n=mE.get(e);if(!n){const i=new Map;let u;const h=new IntersectionObserver(d=>{d.forEach(s=>{var w;const T=s.isIntersecting&&u.some(A=>s.intersectionRatio>=A);t.trackVisibility&&typeof s.isVisible>"u"&&(s.isVisible=T),(w=i.get(s.target))==null||w.forEach(A=>{A(T,s)})})},t);u=h.thresholds||(Array.isArray(t.threshold)?t.threshold:[t.threshold||0]),n={id:e,observer:h,elements:i},mE.set(e,n)}return n}function TV(t,e,n={},i=wV){if(typeof window.IntersectionObserver>"u"&&i!==void 0){const w=t.getBoundingClientRect();return e(i,{isIntersecting:i,target:t,intersectionRatio:typeof n.threshold=="number"?n.threshold:0,time:0,boundingClientRect:w,intersectionRect:w,rootBounds:w}),()=>{}}const{id:u,observer:h,elements:d}=SV(n);let s=d.get(t)||[];return d.has(t)||d.set(t,s),s.push(e),h.observe(t),function(){s.splice(s.indexOf(e),1),s.length===0&&(d.delete(t),h.unobserve(t)),d.size===0&&(h.disconnect(),mE.delete(u))}}function VM({threshold:t,delay:e,trackVisibility:n,rootMargin:i,root:u,triggerOnce:h,skip:d,initialInView:s,fallbackInView:w,onChange:T}={}){const A=Mn.useRef(),D=Mn.useRef(),[R,G]=Mn.useState({inView:!!s});D.current=T;const $=Mn.useCallback(_e=>{A.current!==void 0&&(A.current(),A.current=void 0),!d&&_e&&(A.current=TV(_e,(Y,B)=>{G({inView:Y,entry:B}),D.current&&D.current(Y,B),B.isIntersecting&&h&&A.current&&(A.current(),A.current=void 0)},{root:u,rootMargin:i,threshold:t,trackVisibility:n,delay:e},w))},[Array.isArray(t)?t.toString():t,u,i,h,d,n,w,e]);Mn.useEffect(()=>{!A.current&&R.entry&&!h&&!d&&G({inView:!!s})});const ie=[$,R.inView,R.entry];return ie.ref=ie[0],ie.inView=ie[1],ie.entry=ie[2],ie}var CV=function(e){return"-".concat(e*100,"% 0px -").concat(100-e*100,"% 0px")},IV=function(e,n,i,u){if(!i.current)return"0px";var h=i.current.offsetHeight/u;return e==="down"?"".concat((h-n)*100,"% 0px ").concat(n*100-100,"% 0px"):"-".concat(n*100,"% 0px ").concat(h*100-(100-n*100),"% 0px")},Wh=function(e){var n=e.children,i=e.data,u=e.handleSetLastScrollTop,h=e.lastScrollTop,d=e.onStepEnter,s=e.onStepExit,w=e.onStepProgress,T=e.offset,A=e.scrollamaId,D=e.progressThreshold,R=e.innerHeight,G=typeof window<"u",$=G?document.documentElement.scrollTop:0,ie=h<$?"down":"up",_e=CV(T),Y=Mn.useRef(null),B=Mn.useState(!1),q=dE(B,2),oe=q[0],de=q[1],we=VM({rootMargin:_e,threshold:0}),Se=we.ref,Te=we.entry,xe=Mn.useMemo(function(){return IV(ie,T,Y,R)},[ie,T,Y,R]),et=VM({rootMargin:xe,threshold:D}),We=et.ref,He=et.entry,$e=Mn.useCallback(function(ze){Y.current=ze,Se(ze),We(ze)},[Se,We]);return hs.useEffect(function(){if(oe){var ze=He.target.getBoundingClientRect(),Pt=ze.height,Bt=ze.top,Zt=Math.min(1,Math.max(0,(window.innerHeight*T-Bt)/Pt));w&&w({progress:Zt,scrollamaId:A,data:i,element:He.target,entry:He,direction:ie})}},[He]),hs.useEffect(function(){Te&&!Te.isIntersecting&&oe?(s({element:Te.target,scrollamaId:A,data:i,entry:Te,direction:ie}),de(!1),u($)):Te&&Te.isIntersecting&&!oe&&(de(!0),d({element:Te.target,scrollamaId:A,data:i,entry:Te,direction:ie}),u($))},[Te]),hs.cloneElement(hs.Children.only(n),{"data-react-scrollama-id":A,ref:$e,entry:Te})};Wh.defaultProps={onStepProgress:null,onStepEnter:function(){},onStepExit:function(){}};const jM=()=>pt.jsxs("div",{className:"relative flex flex-col justify-between my-[calc(50vh-200px)] p-[25px] max-w-[400px]  bg-[rgba(0,0,0,0.8)]",children:[pt.jsxs("div",{children:[pt.jsx("div",{className:"font-bold text-[20px]",children:"NYPD is struggling to fill the shortage of crossing guards, leaving students who commute to school at risk."}),pt.jsxs("p",{className:"mt-[30px] mb-[20px]",children:["Without enough crossing guards at key intersections near schools, students and other pedestrians are less protected during (morning) drop off and (afternoon) pick up."," "]})]}),pt.jsxs("div",{className:"flex flex-row justify-start mt-10",id:"scroll-down",children:[pt.jsxs("div",{className:"flex flex-col  m-auto",children:[pt.jsx("div",{className:"w-[10px] h-[10px] bg-[rgba(0,0,0,0)] border-l-[1.5px] border-b-[1.5px] rotate-[-45deg]"}),pt.jsx("div",{className:"w-[10px] h-[10px] bg-[rgba(0,0,0,0)] border-l-[1.5px] border-b-[1.5px] rotate-[-45deg]"})]}),pt.jsxs("p",{className:"ml-2 text-sm align-top",children:[pt.jsx("span",{className:"font-bold text-[#fdeca6]",children:"SCROLL DOWN"})," to check the related data and how crossing guards can protect."]})]})]}),MV=()=>{const{crashes:t}=Mn.useContext($_),e=Mn.useRef(null);return Mn.useEffect(()=>{if(t){const n=e.current.clientHeight,i=e.current.clientWidth,u=t.filter(T=>T.geometry.coordinates[0]!==void 0&&T.geometry.coordinates[1]>40.8491885183316),h=[...Array(24).keys()].map(T=>({hour:T,value:u.filter(A=>A.properties.hour===T).length}));let d=dS(e.current).append("svg").attr("width",i).attr("height",n);const s=SS().range([0,i]).domain(h.map(T=>T.hour)).padding(.3);d.append("g").attr("transform","translate(0,"+(n-25)+")").call(iL(s).tickSize(0).tickPadding(5)).select(".domain").remove();const w=TS().domain([0,100]).range([n,0]);d.selectAll("bars").data(h).enter().append("rect").attr("x",T=>s(T.hour)).attr("y",T=>w(T.value)).attr("width",s.bandwidth()).attr("height",T=>n-30-w(T.value)).attr("fill",T=>T.hour>=7&&T.hour<=10?"#ffd4d2":T.hour>=13&&T.hour<=16?"#ff727c":"#e5e5e5").attr("opacity",T=>T.hour>=7&&T.hour<=10||T.hour>=13&&T.hour<=16?1:.05)}},[t]),pt.jsxs("div",{className:"my-[calc(100vh)] p-[25px] bg-[rgba(0,0,0,0.8)]",children:[pt.jsx("div",{className:"font-bold text-[20px]",children:"1. High Frequency of Crashes During School Hours"}),pt.jsx("div",{className:"mt-[15px] text-[16px]",children:pt.jsxs("p",{children:["Students are facing significant risks during their commutes. ",pt.jsxs("span",{className:"font-bold text-[18px]",children:[((197+316)/1442*100).toFixed(0),"%"]})," ","crashes occur during school drop off and pick times."," "]})}),pt.jsxs("div",{className:"mt-[10px] text-[16px]",children:[pt.jsxs("p",{children:["Morning Shift (7-10):"," ",pt.jsx("span",{className:"font-bold text-[18px] text-[#ffd4d2]",children:" 197"})]}),pt.jsxs("p",{children:["Afternoon Shift (13-16):"," ",pt.jsx("span",{className:"font-bold text-[18px] text-[#ff727c]",children:" 316"})]})]}),pt.jsx("svg",{className:"m-auto w-[350px] h-[300px]",ref:e})]})},AV=()=>pt.jsxs("div",{className:"my-[calc(100vh)] p-[25px] bg-[rgba(0,0,0,0.8)]",children:[pt.jsx("div",{className:"font-bold text-[20px]",children:"2. Crossing Guards can be a Solution"}),pt.jsxs("div",{className:"mt-[15px] text-[16px]",children:[pt.jsx("p",{children:"Crossing guards play a vital role in reducing the risk of traffic accidents involving children, particularly in guiding individuals away from harm's way and preventing students as they navigate busy streets."}),pt.jsxs("p",{className:"mt-[10px]",children:["There are ",pt.jsx("span",{className:"font-bold text-[#fdeca6]",children:"26"}),"  crossing guards positions in the Washington Heights North and Marble Hill-Inwood neighborhoods. The working shifts are 7AM to 10AM and 1PM to 4PM"]})]})]}),PV=()=>{const t=Mn.useRef(null);return Mn.useEffect(()=>{const e=dS(t.current),n=t.current.clientHeight,i=t.current.clientWidth,u={vacant:19,guards:8},h=ES().range(["#e5e5e5","#fdeca6"]),d=Math.min(i,n)/2.5,w=w4().value(T=>T[1])(Object.entries(u));e.selectAll("vacant").data(w).join("path").attr("d",_4().innerRadius(0).outerRadius(d)).attr("fill",T=>h(T.data[1])).attr("stroke","black").style("stroke-width","0px").style("opacity",T=>T.data[1]===19?.1:.4).attr("transform",`translate(${i/2},${n/2})`)}),pt.jsxs("div",{className:"my-[calc(100vh)] p-[25px] max-w-[400px] bg-[rgba(0,0,0,0.8)]",children:[pt.jsx("div",{className:"font-bold text-[20px]",children:"3. Crossing Guards Shortage"}),pt.jsxs("div",{className:"mt-[15px] text-[16px]",children:[pt.jsx("p",{children:"Crossing guards play a vital role in ensuring the safety of students near school zones. Unfortunately, there is a shortage of crossing guards at intersections adjacent to schools."}),pt.jsxs("p",{className:"mt-[10px]",children:["Currently, only ",pt.jsxs("span",{className:"font-bold text-[16px] text-[#fdeca6]",children:[(8/27*100).toFixed(0),"%"," "]}),"of the total available positions for guards have been successfully filled."]})]}),pt.jsx("svg",{className:"mt-[20px] w-[300px] h-[300px]",ref:t}),pt.jsx("p",{className:"my-4 text-sm",children:"🖰 Click on a hand icon for more details at that intersection."})]})},LV=()=>pt.jsxs("div",{className:"my-[calc(100vh)] p-[25px] max-w-[400px] bg-[rgba(0,0,0,0.8)]",children:[pt.jsx("div",{className:"font-bold text-[20px]",children:"4. The Crashes That Vacant Crossing Guards Might Solve"}),pt.jsxs("div",{className:"mt-[15px] text-[16px]",children:[pt.jsxs("p",{children:["From 2020 onwards, a concerning total of 51 crashes have occurred in the ",pt.jsx("span",{className:"font-bold text-[#ffd4d2]",children:"morning"})," and"," ",pt.jsx("span",{className:"font-bold text-[#ff727c]",children:"afternoon"})," at locations where positions for crossing guards."]}),pt.jsx("p",{className:"mt-[10px]",children:"Filling these vacant positions could potentially reduce the likelihood of crashes and enhance student safety during their commutes."})]}),pt.jsx("div",{className:"flex items-center mt-[20px] w-[350px] h-[300px]",children:pt.jsxs("div",{className:"flex items-center",children:[pt.jsx("div",{className:"pt-[150px] w-[125px] h-[300px] text-[#191919] text-center bg-[rgb(255,212,210,.95)]",children:"19"}),pt.jsx("div",{className:"pt-[150px] w-[225px] h-[300px] text-[#191919] text-center bg-[rgb(255,114,124,.95)]",children:"32"})]})})]}),DV=()=>pt.jsxs("div",{className:"my-[calc(100vh)] p-[25px] bg-[rgba(0,0,0,0.8)]",children:[pt.jsx("div",{className:"flex font-bold text-[20px] ",children:"Credits:"}),pt.jsxs("div",{className:"mt-[20px] ",children:[pt.jsxs("div",{className:"flex items-start",children:[pt.jsx("div",{className:"font-bold mb-[10px] text-[18px] text-[#fdeca6]",children:"BetaNYC Lab"}),pt.jsxs("div",{className:"ml-[20px] text-[16px]",children:[pt.jsx("div",{className:"mb-[5px]",children:"Zhi Keng He"}),pt.jsx("div",{className:"",children:"Hao Lun Hung"})]})]}),pt.jsx("div",{className:"my-[20px] w-[100%] h-[1px] bg-[rgba(255,255,255,0.12)]"}),pt.jsxs("div",{className:"flex items-start",children:[pt.jsx("div",{className:"font-bold mr-[10px] mb-[10px] text-[18px] text-[#fdeca6]",children:"Data Source"}),pt.jsxs("div",{className:"ml-[20px] text-[16px]",children:[pt.jsx("div",{className:"mb-[5px]",children:"NYPD - School Crossing Guards Data"}),pt.jsx("div",{children:"NYC OpenData - Motor Vehicle Collisions - Crashes"})]})]})]})]}),RV=()=>{const{map:t,posts:e}=Mn.useContext($_),[n,i]=Mn.useState(0);if(t&&e.length&&t.getSource("guards")){t.getSource("guards").setData({type:"FeatureCollection",features:e}),console.log(e);const u=({data:h})=>{i(h),h===3&&(t.setPaintProperty("guards","icon-opacity",["match",["get","LAST NAME"],"VACANT",1,1]),t.setPaintProperty("guards_vacant","icon-opacity",["match",["get","LAST NAME"],"VACANT",0,0]),t.flyTo({center:[-73.927,40.86],zoom:14.5})),h>3&&(t.setPaintProperty("guards","icon-opacity",["match",["get","LAST NAME"],"VACANT",0,1]),t.setPaintProperty("guards_vacant","icon-opacity",["match",["get","LAST NAME"],"VACANT",1,0])),h===5&&t.setPaintProperty("guards","icon-opacity",["match",["get","LAST NAME"],"VACANT",0,0])};return pt.jsx("div",{className:"absolute left-[0px] top-0 px-[18px] text-white z-2",children:pt.jsxs(UD,{offset:.5,onStepEnter:u,children:[pt.jsx(Wh,{data:1,children:pt.jsx("div",{children:pt.jsx(jM,{})})}),pt.jsx(Wh,{data:2,children:pt.jsx("div",{children:pt.jsx(MV,{})})}),pt.jsx(Wh,{data:3,children:pt.jsx("div",{children:pt.jsx(AV,{})})}),pt.jsx(Wh,{data:4,children:pt.jsx("div",{children:pt.jsx(PV,{})})}),pt.jsx(Wh,{data:5,children:pt.jsx("div",{children:pt.jsx(LV,{})})}),pt.jsx(Wh,{data:6,children:pt.jsx("div",{children:pt.jsx(DV,{})})})]})})}return pt.jsx("div",{className:"absolute left-[0px] top-0 px-[18px] text-white  z-2",children:pt.jsx("div",{children:pt.jsx(jM,{})})})},NV=()=>{const{map:t,crashes:e}=Mn.useContext($_),[n,i]=Mn.useState("all"),u=h=>{i(h);let d=[];switch(h){case"morning":d=e.filter(s=>s.properties.hour>=7&&s.properties.hour<=10);break;case"afternoon":d=e.filter(s=>s.properties.hour>=13&&s.properties.hour<=16);break;default:d=e;break}t.getSource("crashes").setData({type:"FeatureCollection",features:FD(d)})};return pt.jsxs("select",{className:"fixed right-[20px] top-[40px] px-[14px] py-[5px] text-[20px] text-white bg-[rgba(0,0,0,0.5)] rounded-[3px]",onChange:h=>u(h.target.value),children:[pt.jsx("option",{value:"all",children:"All"}),pt.jsx("option",{value:"morning",children:"Morning"}),pt.jsx("option",{value:"afternoon",children:"Afternoon"})]})},$_=Mn.createContext("");function kV(){const[t,e]=Mn.useState(null),[n,i]=Mn.useState([]),[u,h]=Mn.useState([]);return Mn.useEffect(()=>{const d=tM("./crashes_2020_08_2023.csv",eM),s=tM("./crossing_posts.csv",eM);Promise.all([d,s]).then(w=>{const[T,A]=w.map(D=>D.map(R=>({type:"Feature",properties:{...R},geometry:{coordinates:[+R.LONGITUDE,+R.LATITUDE],type:"Point"}})));i(T),h(A)})},[]),pt.jsx("div",{className:"relative w-[100vw] h-[100vh] overflow-scroll",children:pt.jsxs($_.Provider,{value:{map:t,setMap:e,crashes:n,posts:u},children:[pt.jsx(cV,{}),pt.jsx(NV,{}),pt.jsx(RV,{})]})})}tb.createRoot(document.getElementById("root")).render(pt.jsx(hs.StrictMode,{children:pt.jsx(kV,{})}));
